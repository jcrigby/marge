{"created": 1771629218.1771185, "duration": 283.79258131980896, "exitcode": 1, "root": "/home/jcrigby/fun/marge", "environment": {}, "summary": {"passed": 580, "failed": 910, "skipped": 239, "total": 1729, "collected": 1729}, "collectors": [{"nodeid": "", "outcome": "passed", "result": [{"nodeid": "tests", "type": "Dir"}]}, {"nodeid": "tests/api/test_api_misc_endpoints.py", "outcome": "passed", "result": [{"nodeid": "tests/api/test_api_misc_endpoints.py::test_api_root_status", "type": "Coroutine", "lineno": 15}, {"nodeid": "tests/api/test_api_misc_endpoints.py::test_list_services_returns_list", "type": "Coroutine", "lineno": 29}, {"nodeid": "tests/api/test_api_misc_endpoints.py::test_list_services_has_domain", "type": "Coroutine", "lineno": 41}, {"nodeid": "tests/api/test_api_misc_endpoints.py::test_list_services_has_light", "type": "Coroutine", "lineno": 53}, {"nodeid": "tests/api/test_api_misc_endpoints.py::test_list_services_light_has_turn_on", "type": "Coroutine", "lineno": 64}, {"nodeid": "tests/api/test_api_misc_endpoints.py::test_list_events_returns_list", "type": "Coroutine", "lineno": 77}, {"nodeid": "tests/api/test_api_misc_endpoints.py::test_webhook_accepts_post", "type": "Coroutine", "lineno": 90}, {"nodeid": "tests/api/test_api_misc_endpoints.py::test_backup_returns_data", "type": "Coroutine", "lineno": 102}, {"nodeid": "tests/api/test_api_misc_endpoints.py::test_statistics_endpoint", "type": "Coroutine", "lineno": 113}, {"nodeid": "tests/api/test_api_misc_endpoints.py::test_sim_time_set_and_verify", "type": "Coroutine", "lineno": 125}, {"nodeid": "tests/api/test_api_misc_endpoints.py::test_metrics_endpoint", "type": "Coroutine", "lineno": 142}, {"nodeid": "tests/api/test_api_misc_endpoints.py::test_get_automation_yaml", "type": "Coroutine", "lineno": 152}, {"nodeid": "tests/api/test_api_misc_endpoints.py::test_automation_reload_via_alt_path", "type": "Coroutine", "lineno": 162}]}, {"nodeid": "tests/api/test_api_root_config_format.py", "outcome": "passed", "result": [{"nodeid": "tests/api/test_api_root_config_format.py::test_api_root_returns_200", "type": "Coroutine", "lineno": 15}, {"nodeid": "tests/api/test_api_root_config_format.py::test_api_root_has_message", "type": "Coroutine", "lineno": 24}, {"nodeid": "tests/api/test_api_root_config_format.py::test_api_root_message_content", "type": "Coroutine", "lineno": 36}, {"nodeid": "tests/api/test_api_root_config_format.py::test_config_has_coordinates", "type": "Coroutine", "lineno": 47}, {"nodeid": "tests/api/test_api_root_config_format.py::test_config_has_time_zone", "type": "Coroutine", "lineno": 60}, {"nodeid": "tests/api/test_api_root_config_format.py::test_config_is_json", "type": "Coroutine", "lineno": 71}]}, {"nodeid": "tests/api/test_area_label_lifecycle.py", "outcome": "passed", "result": [{"nodeid": "tests/api/test_area_label_lifecycle.py::test_area_create", "type": "Coroutine", "lineno": 15}, {"nodeid": "tests/api/test_area_label_lifecycle.py::test_area_list_includes_created", "type": "Coroutine", "lineno": 26}, {"nodeid": "tests/api/test_area_label_lifecycle.py::test_area_delete", "type": "Coroutine", "lineno": 44}, {"nodeid": "tests/api/test_area_label_lifecycle.py::test_area_assign_entity", "type": "Coroutine", "lineno": 60}, {"nodeid": "tests/api/test_area_label_lifecycle.py::test_area_list_entities", "type": "Coroutine", "lineno": 77}, {"nodeid": "tests/api/test_area_label_lifecycle.py::test_area_unassign_entity", "type": "Coroutine", "lineno": 100}, {"nodeid": "tests/api/test_area_label_lifecycle.py::test_label_create", "type": "Coroutine", "lineno": 124}, {"nodeid": "tests/api/test_area_label_lifecycle.py::test_label_list_includes_created", "type": "Coroutine", "lineno": 135}, {"nodeid": "tests/api/test_area_label_lifecycle.py::test_label_delete", "type": "Coroutine", "lineno": 153}, {"nodeid": "tests/api/test_area_label_lifecycle.py::test_label_assign_entity", "type": "Coroutine", "lineno": 169}, {"nodeid": "tests/api/test_area_label_lifecycle.py::test_label_unassign_entity", "type": "Coroutine", "lineno": 186}, {"nodeid": "tests/api/test_area_label_lifecycle.py::test_device_create", "type": "Coroutine", "lineno": 210}, {"nodeid": "tests/api/test_area_label_lifecycle.py::test_device_list", "type": "Coroutine", "lineno": 226}, {"nodeid": "tests/api/test_area_label_lifecycle.py::test_device_assign_entity", "type": "Coroutine", "lineno": 237}, {"nodeid": "tests/api/test_area_label_lifecycle.py::test_area_entity_listing_includes_state", "type": "Coroutine", "lineno": 256}, {"nodeid": "tests/api/test_area_label_lifecycle.py::test_area_duplicate_entity_assignment", "type": "Coroutine", "lineno": 287}]}, {"nodeid": "tests/api/test_auth_edge_cases.py", "outcome": "passed", "result": [{"nodeid": "tests/api/test_auth_edge_cases.py::test_open_mode_no_header_allowed", "type": "Coroutine", "lineno": 18}, {"nodeid": "tests/api/test_auth_edge_cases.py::test_open_mode_arbitrary_bearer_allowed", "type": "Coroutine", "lineno": 25}, {"nodeid": "tests/api/test_auth_edge_cases.py::test_open_mode_empty_header_allowed", "type": "Coroutine", "lineno": 35}, {"nodeid": "tests/api/test_auth_edge_cases.py::test_open_mode_config_accessible", "type": "Coroutine", "lineno": 45}, {"nodeid": "tests/api/test_auth_edge_cases.py::test_open_mode_services_accessible", "type": "Coroutine", "lineno": 54}, {"nodeid": "tests/api/test_auth_edge_cases.py::test_health_endpoint_always_accessible", "type": "Coroutine", "lineno": 71}, {"nodeid": "tests/api/test_auth_edge_cases.py::test_create_token", "type": "Coroutine", "lineno": 80}, {"nodeid": "tests/api/test_auth_edge_cases.py::test_create_token_missing_name", "type": "Coroutine", "lineno": 97}, {"nodeid": "tests/api/test_auth_edge_cases.py::test_list_tokens", "type": "Coroutine", "lineno": 107}, {"nodeid": "tests/api/test_auth_edge_cases.py::test_delete_token", "type": "Coroutine", "lineno": 136}, {"nodeid": "tests/api/test_auth_edge_cases.py::test_delete_nonexistent_token", "type": "Coroutine", "lineno": 163}, {"nodeid": "tests/api/test_auth_edge_cases.py::test_created_token_has_correct_format", "type": "Coroutine", "lineno": 172}, {"nodeid": "tests/api/test_auth_edge_cases.py::test_token_id_has_correct_format", "type": "Coroutine", "lineno": 185}]}, {"nodeid": "tests/api/test_auth_token_lifecycle.py", "outcome": "passed", "result": [{"nodeid": "tests/api/test_auth_token_lifecycle.py::test_create_token", "type": "Coroutine", "lineno": 39}, {"nodeid": "tests/api/test_auth_token_lifecycle.py::test_list_tokens", "type": "Coroutine", "lineno": 51}, {"nodeid": "tests/api/test_auth_token_lifecycle.py::test_list_tokens_hides_value", "type": "Coroutine", "lineno": 63}, {"nodeid": "tests/api/test_auth_token_lifecycle.py::test_delete_token", "type": "Coroutine", "lineno": 73}, {"nodeid": "tests/api/test_auth_token_lifecycle.py::test_delete_nonexistent_token_404", "type": "Coroutine", "lineno": 89}, {"nodeid": "tests/api/test_auth_token_lifecycle.py::test_create_token_missing_name_400", "type": "Coroutine", "lineno": 95}, {"nodeid": "tests/api/test_auth_token_lifecycle.py::test_token_field_format[id-tok_-10]", "type": "Coroutine", "lineno": 105}, {"nodeid": "tests/api/test_auth_token_lifecycle.py::test_token_field_format[token-marge_-10]", "type": "Coroutine", "lineno": 105}, {"nodeid": "tests/api/test_auth_token_lifecycle.py::test_multiple_tokens_unique_ids", "type": "Coroutine", "lineno": 117}, {"nodeid": "tests/api/test_auth_token_lifecycle.py::test_token_has_created_at", "type": "Coroutine", "lineno": 131}, {"nodeid": "tests/api/test_auth_token_lifecycle.py::test_listed_token_has_name", "type": "Coroutine", "lineno": 142}, {"nodeid": "tests/api/test_auth_token_lifecycle.py::test_token_full_lifecycle", "type": "Coroutine", "lineno": 155}, {"nodeid": "tests/api/test_auth_token_lifecycle.py::test_listed_tokens_have_all_fields", "type": "Coroutine", "lineno": 173}]}, {"nodeid": "tests/api/test_automation_yaml_roundtrip.py", "outcome": "passed", "result": [{"nodeid": "tests/api/test_automation_yaml_roundtrip.py::test_get_automation_yaml_not_empty", "type": "Coroutine", "lineno": 12}, {"nodeid": "tests/api/test_automation_yaml_roundtrip.py::test_automation_yaml_contains_alias", "type": "Coroutine", "lineno": 22}, {"nodeid": "tests/api/test_automation_yaml_roundtrip.py::test_automation_yaml_contains_trigger", "type": "Coroutine", "lineno": 31}, {"nodeid": "tests/api/test_automation_yaml_roundtrip.py::test_automation_yaml_contains_action", "type": "Coroutine", "lineno": 40}, {"nodeid": "tests/api/test_automation_yaml_roundtrip.py::test_scene_yaml_contains_name", "type": "Coroutine", "lineno": 49}, {"nodeid": "tests/api/test_automation_yaml_roundtrip.py::test_scene_yaml_contains_entities", "type": "Coroutine", "lineno": 59}, {"nodeid": "tests/api/test_automation_yaml_roundtrip.py::test_reload_then_list_consistent", "type": "Coroutine", "lineno": 68}, {"nodeid": "tests/api/test_automation_yaml_roundtrip.py::test_reload_count_matches_automations", "type": "Coroutine", "lineno": 93}, {"nodeid": "tests/api/test_automation_yaml_roundtrip.py::test_check_config_returns_valid", "type": "Coroutine", "lineno": 111}]}, {"nodeid": "tests/api/test_backup_error_log.py", "outcome": "passed", "result": [{"nodeid": "tests/api/test_backup_error_log.py::test_backup_returns_200", "type": "Coroutine", "lineno": 18}, {"nodeid": "tests/api/test_backup_error_log.py::test_backup_returns_gzip", "type": "Coroutine", "lineno": 27}, {"nodeid": "tests/api/test_backup_error_log.py::test_backup_has_content_disposition", "type": "Coroutine", "lineno": 38}, {"nodeid": "tests/api/test_backup_error_log.py::test_backup_is_valid_targz", "type": "Coroutine", "lineno": 51}, {"nodeid": "tests/api/test_backup_error_log.py::test_backup_contains_file[marge.db]", "type": "Coroutine", "lineno": 67}, {"nodeid": "tests/api/test_backup_error_log.py::test_backup_contains_file[automations.yaml]", "type": "Coroutine", "lineno": 67}, {"nodeid": "tests/api/test_backup_error_log.py::test_backup_contains_file[scenes.yaml]", "type": "Coroutine", "lineno": 67}, {"nodeid": "tests/api/test_backup_error_log.py::test_backup_nonzero_size", "type": "Coroutine", "lineno": 84}, {"nodeid": "tests/api/test_backup_error_log.py::test_error_log_returns_200", "type": "Coroutine", "lineno": 97}, {"nodeid": "tests/api/test_backup_error_log.py::test_error_log_returns_string", "type": "Coroutine", "lineno": 106}]}, {"nodeid": "tests/api/test_backup_statistics_endpoints.py", "outcome": "passed", "result": [{"nodeid": "tests/api/test_backup_statistics_endpoints.py::test_backup_returns_200", "type": "Coroutine", "lineno": 16}, {"nodeid": "tests/api/test_backup_statistics_endpoints.py::test_backup_content_type_gzip", "type": "Coroutine", "lineno": 25}, {"nodeid": "tests/api/test_backup_statistics_endpoints.py::test_backup_has_content_disposition", "type": "Coroutine", "lineno": 35}, {"nodeid": "tests/api/test_backup_statistics_endpoints.py::test_backup_body_non_empty", "type": "Coroutine", "lineno": 46}, {"nodeid": "tests/api/test_backup_statistics_endpoints.py::test_backup_is_valid_gzip", "type": "Coroutine", "lineno": 55}, {"nodeid": "tests/api/test_backup_statistics_endpoints.py::test_statistics_returns_200", "type": "Coroutine", "lineno": 69}, {"nodeid": "tests/api/test_backup_statistics_endpoints.py::test_statistics_returns_list", "type": "Coroutine", "lineno": 84}, {"nodeid": "tests/api/test_backup_statistics_endpoints.py::test_statistics_has_bucket_fields", "type": "Coroutine", "lineno": 99}, {"nodeid": "tests/api/test_backup_statistics_endpoints.py::test_statistics_min_max_correct", "type": "Coroutine", "lineno": 123}, {"nodeid": "tests/api/test_backup_statistics_endpoints.py::test_statistics_empty_for_new_entity", "type": "Coroutine", "lineno": 143}, {"nodeid": "tests/api/test_backup_statistics_endpoints.py::test_statistics_non_numeric_entity", "type": "Coroutine", "lineno": 157}, {"nodeid": "tests/api/test_backup_statistics_endpoints.py::test_error_log_returns_200", "type": "Coroutine", "lineno": 175}, {"nodeid": "tests/api/test_backup_statistics_endpoints.py::test_error_log_returns_text", "type": "Coroutine", "lineno": 184}]}, {"nodeid": "tests/api/test_check_config_endpoint.py", "outcome": "passed", "result": [{"nodeid": "tests/api/test_check_config_endpoint.py::test_check_config_returns_200", "type": "Coroutine", "lineno": 13}, {"nodeid": "tests/api/test_check_config_endpoint.py::test_check_config_has_result_field", "type": "Coroutine", "lineno": 22}, {"nodeid": "tests/api/test_check_config_endpoint.py::test_check_config_valid_result", "type": "Coroutine", "lineno": 32}, {"nodeid": "tests/api/test_check_config_endpoint.py::test_check_config_has_errors_field", "type": "Coroutine", "lineno": 42}, {"nodeid": "tests/api/test_check_config_endpoint.py::test_check_config_errors_null_when_valid", "type": "Coroutine", "lineno": 52}, {"nodeid": "tests/api/test_check_config_endpoint.py::test_check_config_response_is_json", "type": "Coroutine", "lineno": 62}, {"nodeid": "tests/api/test_check_config_endpoint.py::test_check_config_idempotent", "type": "Coroutine", "lineno": 71}, {"nodeid": "tests/api/test_check_config_endpoint.py::test_check_config_after_reload", "type": "Coroutine", "lineno": 83}]}, {"nodeid": "tests/api/test_concurrent_operations.py", "outcome": "passed", "result": [{"nodeid": "tests/api/test_concurrent_operations.py::test_concurrent_writes_same_entity", "type": "Coroutine", "lineno": 21}, {"nodeid": "tests/api/test_concurrent_operations.py::test_concurrent_writes_different_entities", "type": "Coroutine", "lineno": 36}, {"nodeid": "tests/api/test_concurrent_operations.py::test_concurrent_read_write", "type": "Coroutine", "lineno": 51}, {"nodeid": "tests/api/test_concurrent_operations.py::test_concurrent_service_calls", "type": "Coroutine", "lineno": 79}, {"nodeid": "tests/api/test_concurrent_operations.py::test_concurrent_toggle_same_entity", "type": "Coroutine", "lineno": 102}, {"nodeid": "tests/api/test_concurrent_operations.py::test_concurrent_template_renders", "type": "Coroutine", "lineno": 125}, {"nodeid": "tests/api/test_concurrent_operations.py::test_concurrent_search_queries", "type": "Coroutine", "lineno": 144}, {"nodeid": "tests/api/test_concurrent_operations.py::test_mixed_operations_concurrent", "type": "Coroutine", "lineno": 160}, {"nodeid": "tests/api/test_concurrent_operations.py::test_burst_100_state_sets", "type": "Coroutine", "lineno": 185}, {"nodeid": "tests/api/test_concurrent_operations.py::test_delete_while_reading", "type": "Coroutine", "lineno": 205}, {"nodeid": "tests/api/test_concurrent_operations.py::test_concurrent_health_checks", "type": "Coroutine", "lineno": 232}]}, {"nodeid": "tests/api/test_config_endpoints.py", "outcome": "passed", "result": [{"nodeid": "tests/api/test_config_endpoints.py::test_config_has_state", "type": "Coroutine", "lineno": 15}, {"nodeid": "tests/api/test_config_endpoints.py::test_config_has_location", "type": "Coroutine", "lineno": 22}, {"nodeid": "tests/api/test_config_endpoints.py::test_config_has_unit_system", "type": "Coroutine", "lineno": 30}, {"nodeid": "tests/api/test_config_endpoints.py::test_config_has_version", "type": "Coroutine", "lineno": 36}, {"nodeid": "tests/api/test_config_endpoints.py::test_error_log_endpoint", "type": "Coroutine", "lineno": 45}, {"nodeid": "tests/api/test_config_endpoints.py::test_check_config", "type": "Coroutine", "lineno": 56}, {"nodeid": "tests/api/test_config_endpoints.py::test_health_has_status", "type": "Coroutine", "lineno": 69}, {"nodeid": "tests/api/test_config_endpoints.py::test_health_has_entity_count", "type": "Coroutine", "lineno": 76}, {"nodeid": "tests/api/test_config_endpoints.py::test_health_has_uptime", "type": "Coroutine", "lineno": 84}, {"nodeid": "tests/api/test_config_endpoints.py::test_health_has_memory", "type": "Coroutine", "lineno": 91}, {"nodeid": "tests/api/test_config_endpoints.py::test_automation_reload_endpoint", "type": "Coroutine", "lineno": 100}, {"nodeid": "tests/api/test_config_endpoints.py::test_prometheus_metrics_endpoint", "type": "Coroutine", "lineno": 111}, {"nodeid": "tests/api/test_config_endpoints.py::test_devices_list", "type": "Coroutine", "lineno": 122}, {"nodeid": "tests/api/test_config_endpoints.py::test_device_create", "type": "Coroutine", "lineno": 132}, {"nodeid": "tests/api/test_config_endpoints.py::test_device_delete", "type": "Coroutine", "lineno": 162}, {"nodeid": "tests/api/test_config_endpoints.py::test_device_entity_assignment", "type": "Coroutine", "lineno": 189}, {"nodeid": "tests/api/test_config_endpoints.py::test_api_root_status", "type": "Coroutine", "lineno": 219}, {"nodeid": "tests/api/test_config_endpoints.py::test_config_has_location_name", "type": "Coroutine", "lineno": 233}, {"nodeid": "tests/api/test_config_endpoints.py::test_config_has_coordinates_in_range", "type": "Coroutine", "lineno": 244}, {"nodeid": "tests/api/test_config_endpoints.py::test_config_has_elevation", "type": "Coroutine", "lineno": 255}, {"nodeid": "tests/api/test_config_endpoints.py::test_config_has_unit_system_fields", "type": "Coroutine", "lineno": 266}, {"nodeid": "tests/api/test_config_endpoints.py::test_config_has_timezone", "type": "Coroutine", "lineno": 280}, {"nodeid": "tests/api/test_config_endpoints.py::test_health_has_version", "type": "Coroutine", "lineno": 293}, {"nodeid": "tests/api/test_config_endpoints.py::test_health_has_memory_fields", "type": "Coroutine", "lineno": 303}, {"nodeid": "tests/api/test_config_endpoints.py::test_health_has_latency_fields", "type": "Coroutine", "lineno": 315}, {"nodeid": "tests/api/test_config_endpoints.py::test_health_has_startup_time", "type": "Coroutine", "lineno": 326}, {"nodeid": "tests/api/test_config_endpoints.py::test_health_has_counters", "type": "Coroutine", "lineno": 338}, {"nodeid": "tests/api/test_config_endpoints.py::test_health_has_sim_fields", "type": "Coroutine", "lineno": 349}, {"nodeid": "tests/api/test_config_endpoints.py::test_ws_config_matches_rest", "type": "Coroutine", "lineno": 368}, {"nodeid": "tests/api/test_config_endpoints.py::test_health_startup_under_5ms", "type": "Coroutine", "lineno": 386}]}, {"nodeid": "tests/api/test_config_yaml.py", "outcome": "passed", "result": [{"nodeid": "tests/api/test_config_yaml.py::test_list_automations_returns_list", "type": "Coroutine", "lineno": 16}, {"nodeid": "tests/api/test_config_yaml.py::test_list_automations_has_id", "type": "Coroutine", "lineno": 28}, {"nodeid": "tests/api/test_config_yaml.py::test_list_automations_has_alias", "type": "Coroutine", "lineno": 39}, {"nodeid": "tests/api/test_config_yaml.py::test_list_automations_has_counts", "type": "Coroutine", "lineno": 50}, {"nodeid": "tests/api/test_config_yaml.py::test_reload_automations", "type": "Coroutine", "lineno": 66}, {"nodeid": "tests/api/test_config_yaml.py::test_reload_preserves_entities", "type": "Coroutine", "lineno": 79}, {"nodeid": "tests/api/test_config_yaml.py::test_check_config_valid", "type": "Coroutine", "lineno": 101}, {"nodeid": "tests/api/test_config_yaml.py::test_error_log_endpoint", "type": "Coroutine", "lineno": 116}, {"nodeid": "tests/api/test_config_yaml.py::test_config_has_version", "type": "Coroutine", "lineno": 128}, {"nodeid": "tests/api/test_config_yaml.py::test_config_has_location_name", "type": "Coroutine", "lineno": 135}, {"nodeid": "tests/api/test_config_yaml.py::test_config_has_elevation", "type": "Coroutine", "lineno": 142}, {"nodeid": "tests/api/test_config_yaml.py::test_automation_config_returns_list", "type": "Coroutine", "lineno": 151}, {"nodeid": "tests/api/test_config_yaml.py::test_automation_config_has_metadata", "type": "Coroutine", "lineno": 172}, {"nodeid": "tests/api/test_config_yaml.py::test_automation_entity_has_friendly_name", "type": "Coroutine", "lineno": 188}, {"nodeid": "tests/api/test_config_yaml.py::test_automation_trigger_updates_metadata", "type": "Coroutine", "lineno": 207}, {"nodeid": "tests/api/test_config_yaml.py::test_automation_trigger_via_service", "type": "Coroutine", "lineno": 235}]}, {"nodeid": "tests/api/test_device_registry_rest.py", "outcome": "passed", "result": [{"nodeid": "tests/api/test_device_registry_rest.py::test_create_device", "type": "Coroutine", "lineno": 13}, {"nodeid": "tests/api/test_device_registry_rest.py::test_list_devices", "type": "Coroutine", "lineno": 30}, {"nodeid": "tests/api/test_device_registry_rest.py::test_device_has_fields", "type": "Coroutine", "lineno": 50}, {"nodeid": "tests/api/test_device_registry_rest.py::test_delete_device", "type": "Coroutine", "lineno": 80}, {"nodeid": "tests/api/test_device_registry_rest.py::test_assign_entity_to_device", "type": "Coroutine", "lineno": 104}, {"nodeid": "tests/api/test_device_registry_rest.py::test_device_upsert_updates_fields", "type": "Coroutine", "lineno": 136}, {"nodeid": "tests/api/test_device_registry_rest.py::test_device_missing_name_400", "type": "Coroutine", "lineno": 162}, {"nodeid": "tests/api/test_device_registry_rest.py::test_device_missing_id_400", "type": "Coroutine", "lineno": 173}, {"nodeid": "tests/api/test_device_registry_rest.py::test_device_with_area", "type": "Coroutine", "lineno": 183}]}, {"nodeid": "tests/api/test_discovery_advanced.py", "outcome": "passed", "result": [{"nodeid": "tests/api/test_discovery_advanced.py::test_discovery_duplicate_payload", "type": "Coroutine", "lineno": 43}, {"nodeid": "tests/api/test_discovery_advanced.py::test_discovery_state_tracks_topic", "type": "Coroutine", "lineno": 62}, {"nodeid": "tests/api/test_discovery_advanced.py::test_discovery_state_multiple_updates", "type": "Coroutine", "lineno": 80}, {"nodeid": "tests/api/test_discovery_advanced.py::test_discovery_json_state_payload", "type": "Coroutine", "lineno": 101}, {"nodeid": "tests/api/test_discovery_advanced.py::test_discovery_multi_entity_device", "type": "Coroutine", "lineno": 126}, {"nodeid": "tests/api/test_discovery_advanced.py::test_discovery_number", "type": "Coroutine", "lineno": 159}, {"nodeid": "tests/api/test_discovery_advanced.py::test_discovery_select", "type": "Coroutine", "lineno": 177}, {"nodeid": "tests/api/test_discovery_advanced.py::test_discovery_button", "type": "Coroutine", "lineno": 194}, {"nodeid": "tests/api/test_discovery_advanced.py::test_discovery_fan", "type": "Coroutine", "lineno": 209}, {"nodeid": "tests/api/test_discovery_advanced.py::test_discovery_siren", "type": "Coroutine", "lineno": 228}, {"nodeid": "tests/api/test_discovery_advanced.py::test_discovery_valve", "type": "Coroutine", "lineno": 245}, {"nodeid": "tests/api/test_discovery_advanced.py::test_discovery_unit_of_measurement", "type": "Coroutine", "lineno": 264}, {"nodeid": "tests/api/test_discovery_advanced.py::test_discovery_friendly_name_from_name", "type": "Coroutine", "lineno": 282}, {"nodeid": "tests/api/test_discovery_advanced.py::test_discovery_create_then_remove", "type": "Coroutine", "lineno": 300}, {"nodeid": "tests/api/test_discovery_advanced.py::test_discovery_removal_idempotent", "type": "Coroutine", "lineno": 326}, {"nodeid": "tests/api/test_discovery_advanced.py::test_discovery_recreate_after_removal", "type": "Coroutine", "lineno": 349}, {"nodeid": "tests/api/test_discovery_advanced.py::test_discovery_availability_status[online-False]", "type": "Coroutine", "lineno": 379}, {"nodeid": "tests/api/test_discovery_advanced.py::test_discovery_availability_status[offline-True]", "type": "Coroutine", "lineno": 379}, {"nodeid": "tests/api/test_discovery_advanced.py::test_discovery_climate_multiple_topics", "type": "Coroutine", "lineno": 412}, {"nodeid": "tests/api/test_discovery_advanced.py::test_discovery_cover_position_topic", "type": "Coroutine", "lineno": 434}, {"nodeid": "tests/api/test_discovery_advanced.py::test_discovery_fan_speed_range", "type": "Coroutine", "lineno": 456}, {"nodeid": "tests/api/test_discovery_advanced.py::test_discovery_lock_payloads", "type": "Coroutine", "lineno": 478}, {"nodeid": "tests/api/test_discovery_advanced.py::test_discovery_light_color_modes", "type": "Coroutine", "lineno": 498}, {"nodeid": "tests/api/test_discovery_advanced.py::test_discovery_number_attributes", "type": "Coroutine", "lineno": 519}, {"nodeid": "tests/api/test_discovery_advanced.py::test_discovery_select_options", "type": "Coroutine", "lineno": 544}, {"nodeid": "tests/api/test_discovery_advanced.py::test_discovery_node_id_topic", "type": "Coroutine", "lineno": 563}]}, {"nodeid": "tests/api/test_history_logbook.py", "outcome": "passed", "result": [{"nodeid": "tests/api/test_history_logbook.py::test_history_records_state_changes", "type": "Coroutine", "lineno": 16}, {"nodeid": "tests/api/test_history_logbook.py::test_history_includes_entity_id", "type": "Coroutine", "lineno": 38}, {"nodeid": "tests/api/test_history_logbook.py::test_history_includes_timestamps", "type": "Coroutine", "lineno": 53}, {"nodeid": "tests/api/test_history_logbook.py::test_history_includes_attributes", "type": "Coroutine", "lineno": 70}, {"nodeid": "tests/api/test_history_logbook.py::test_history_empty_for_unknown_entity", "type": "Coroutine", "lineno": 86}, {"nodeid": "tests/api/test_history_logbook.py::test_logbook_entity_returns_changes", "type": "Coroutine", "lineno": 98}, {"nodeid": "tests/api/test_history_logbook.py::test_logbook_deduplicates_same_state", "type": "Coroutine", "lineno": 117}, {"nodeid": "tests/api/test_history_logbook.py::test_logbook_global_returns_entries", "type": "Coroutine", "lineno": 139}, {"nodeid": "tests/api/test_history_logbook.py::test_logbook_entries_have_when_field", "type": "Coroutine", "lineno": 157}, {"nodeid": "tests/api/test_history_logbook.py::test_history_returns_list", "type": "Coroutine", "lineno": 174}, {"nodeid": "tests/api/test_history_logbook.py::test_history_entry_has_fields", "type": "Coroutine", "lineno": 190}, {"nodeid": "tests/api/test_history_logbook.py::test_history_multiple_states", "type": "Coroutine", "lineno": 210}, {"nodeid": "tests/api/test_history_logbook.py::test_history_with_time_range", "type": "Coroutine", "lineno": 226}, {"nodeid": "tests/api/test_history_logbook.py::test_history_chronological_order", "type": "Coroutine", "lineno": 241}, {"nodeid": "tests/api/test_history_logbook.py::test_history_preserves_attributes", "type": "Coroutine", "lineno": 259}, {"nodeid": "tests/api/test_history_logbook.py::test_logbook_returns_list", "type": "Coroutine", "lineno": 277}, {"nodeid": "tests/api/test_history_logbook.py::test_logbook_entry_has_fields", "type": "Coroutine", "lineno": 288}, {"nodeid": "tests/api/test_history_logbook.py::test_logbook_entity_specific", "type": "Coroutine", "lineno": 307}, {"nodeid": "tests/api/test_history_logbook.py::test_logbook_with_time_range", "type": "Coroutine", "lineno": 328}, {"nodeid": "tests/api/test_history_logbook.py::test_history_future_range_empty", "type": "Coroutine", "lineno": 341}]}, {"nodeid": "tests/api/test_logbook_global.py", "outcome": "passed", "result": [{"nodeid": "tests/api/test_logbook_global.py::test_global_logbook_returns_list", "type": "Coroutine", "lineno": 15}, {"nodeid": "tests/api/test_logbook_global.py::test_logbook_after_state_change", "type": "Coroutine", "lineno": 26}, {"nodeid": "tests/api/test_logbook_global.py::test_logbook_entry_has_fields", "type": "Coroutine", "lineno": 42}, {"nodeid": "tests/api/test_logbook_global.py::test_logbook_unknown_entity", "type": "Coroutine", "lineno": 60}, {"nodeid": "tests/api/test_logbook_global.py::test_events_list_has_state_changed", "type": "Coroutine", "lineno": 72}, {"nodeid": "tests/api/test_logbook_global.py::test_events_after_fire", "type": "Coroutine", "lineno": 85}, {"nodeid": "tests/api/test_logbook_global.py::test_history_multiple_changes", "type": "Coroutine", "lineno": 101}, {"nodeid": "tests/api/test_logbook_global.py::test_history_has_state_and_timestamp", "type": "Coroutine", "lineno": 118}, {"nodeid": "tests/api/test_logbook_global.py::test_logbook_time_range[2020-01-01T00:00:00Z-2030-01-01T00:00:00Z-False]", "type": "Coroutine", "lineno": 141}, {"nodeid": "tests/api/test_logbook_global.py::test_logbook_time_range[2020-01-01T00:00:00Z-2020-01-01T00:00:01Z-True]", "type": "Coroutine", "lineno": 141}, {"nodeid": "tests/api/test_logbook_global.py::test_logbook_entity_captures_changes", "type": "Coroutine", "lineno": 162}, {"nodeid": "tests/api/test_logbook_global.py::test_logbook_per_entity_filtered", "type": "Coroutine", "lineno": 186}, {"nodeid": "tests/api/test_logbook_global.py::test_statistics_numeric_entity", "type": "Coroutine", "lineno": 206}, {"nodeid": "tests/api/test_logbook_global.py::test_history_with_start_param", "type": "Coroutine", "lineno": 227}, {"nodeid": "tests/api/test_logbook_global.py::test_history_with_start_and_end", "type": "Coroutine", "lineno": 246}, {"nodeid": "tests/api/test_logbook_global.py::test_history_narrow_window_empty", "type": "Coroutine", "lineno": 266}, {"nodeid": "tests/api/test_logbook_global.py::test_history_entity_has_all_fields", "type": "Coroutine", "lineno": 286}, {"nodeid": "tests/api/test_logbook_global.py::test_history_nonexistent_entity_empty", "type": "Coroutine", "lineno": 306}]}, {"nodeid": "tests/api/test_mqtt_bridge_topics.py", "outcome": "passed", "result": [{"nodeid": "tests/api/test_mqtt_bridge_topics.py::test_mqtt_sensor_state_update", "type": "Coroutine", "lineno": 47}, {"nodeid": "tests/api/test_mqtt_bridge_topics.py::test_mqtt_binary_sensor_state", "type": "Coroutine", "lineno": 58}, {"nodeid": "tests/api/test_mqtt_bridge_topics.py::test_mqtt_switch_on_off", "type": "Coroutine", "lineno": 69}, {"nodeid": "tests/api/test_mqtt_bridge_topics.py::test_mqtt_preserves_attributes", "type": "Coroutine", "lineno": 85}, {"nodeid": "tests/api/test_mqtt_bridge_topics.py::test_mqtt_non_matching_topic_ignored", "type": "Coroutine", "lineno": 101}, {"nodeid": "tests/api/test_mqtt_bridge_topics.py::test_mqtt_light_domain", "type": "Coroutine", "lineno": 111}, {"nodeid": "tests/api/test_mqtt_bridge_topics.py::test_mqtt_multiple_domains", "type": "Coroutine", "lineno": 122}]}, {"nodeid": "tests/api/test_mqtt_discovery.py", "outcome": "passed", "result": [{"nodeid": "tests/api/test_mqtt_discovery.py::test_discovery_sensor", "type": "Coroutine", "lineno": 43}, {"nodeid": "tests/api/test_mqtt_discovery.py::test_discovery_sensor_state_update", "type": "Coroutine", "lineno": 63}, {"nodeid": "tests/api/test_mqtt_discovery.py::test_discovery_binary_sensor", "type": "Coroutine", "lineno": 86}, {"nodeid": "tests/api/test_mqtt_discovery.py::test_discovery_light", "type": "Coroutine", "lineno": 107}, {"nodeid": "tests/api/test_mqtt_discovery.py::test_discovery_switch", "type": "Coroutine", "lineno": 126}, {"nodeid": "tests/api/test_mqtt_discovery.py::test_discovery_climate", "type": "Coroutine", "lineno": 145}, {"nodeid": "tests/api/test_mqtt_discovery.py::test_discovery_cover", "type": "Coroutine", "lineno": 167}, {"nodeid": "tests/api/test_mqtt_discovery.py::test_discovery_lock", "type": "Coroutine", "lineno": 186}, {"nodeid": "tests/api/test_mqtt_discovery.py::test_discovery_with_device_info", "type": "Coroutine", "lineno": 207}, {"nodeid": "tests/api/test_mqtt_discovery.py::test_discovery_5_part_topic", "type": "Coroutine", "lineno": 231}, {"nodeid": "tests/api/test_mqtt_discovery.py::test_discovery_empty_payload_removes_entity", "type": "Coroutine", "lineno": 249}, {"nodeid": "tests/api/test_mqtt_discovery.py::test_discovery_value_template", "type": "Coroutine", "lineno": 276}]}, {"nodeid": "tests/api/test_mqtt_entity_command_bridge.py", "outcome": "passed", "result": [{"nodeid": "tests/api/test_mqtt_entity_command_bridge.py::test_mqtt_state_topic_creates_entity", "type": "Coroutine", "lineno": 34}, {"nodeid": "tests/api/test_mqtt_entity_command_bridge.py::test_mqtt_binary_sensor_state", "type": "Coroutine", "lineno": 44}, {"nodeid": "tests/api/test_mqtt_entity_command_bridge.py::test_mqtt_switch_state", "type": "Coroutine", "lineno": 54}, {"nodeid": "tests/api/test_mqtt_entity_command_bridge.py::test_mqtt_state_update_preserves_attributes", "type": "Coroutine", "lineno": 64}, {"nodeid": "tests/api/test_mqtt_entity_command_bridge.py::test_mqtt_sequential_updates", "type": "Coroutine", "lineno": 80}, {"nodeid": "tests/api/test_mqtt_entity_command_bridge.py::test_mqtt_non_state_topic_ignored", "type": "Coroutine", "lineno": 91}, {"nodeid": "tests/api/test_mqtt_entity_command_bridge.py::test_mqtt_light_domain", "type": "Coroutine", "lineno": 101}, {"nodeid": "tests/api/test_mqtt_entity_command_bridge.py::test_mqtt_numeric_state", "type": "Coroutine", "lineno": 111}, {"nodeid": "tests/api/test_mqtt_entity_command_bridge.py::test_mqtt_state_triggers_automation", "type": "Coroutine", "lineno": 120}]}, {"nodeid": "tests/api/test_notification_lifecycle.py", "outcome": "passed", "result": [{"nodeid": "tests/api/test_notification_lifecycle.py::test_notification_create_via_service", "type": "Coroutine", "lineno": 17}, {"nodeid": "tests/api/test_notification_lifecycle.py::test_notification_has_fields", "type": "Coroutine", "lineno": 36}, {"nodeid": "tests/api/test_notification_lifecycle.py::test_notification_dismiss_by_id", "type": "Coroutine", "lineno": 56}, {"nodeid": "tests/api/test_notification_lifecycle.py::test_notification_dismiss_all", "type": "Coroutine", "lineno": 82}, {"nodeid": "tests/api/test_notification_lifecycle.py::test_notification_overwrite", "type": "Coroutine", "lineno": 109}, {"nodeid": "tests/api/test_notification_lifecycle.py::test_ws_notification_roundtrip", "type": "Coroutine", "lineno": 137}, {"nodeid": "tests/api/test_notification_lifecycle.py::test_notification_has_created_at", "type": "Coroutine", "lineno": 184}, {"nodeid": "tests/api/test_notification_lifecycle.py::test_ws_create_notification", "type": "Coroutine", "lineno": 210}, {"nodeid": "tests/api/test_notification_lifecycle.py::test_notification_count_changes", "type": "Coroutine", "lineno": 235}]}, {"nodeid": "tests/api/test_notifications_rest.py", "outcome": "passed", "result": [{"nodeid": "tests/api/test_notifications_rest.py::test_create_notification_via_service", "type": "Coroutine", "lineno": 12}, {"nodeid": "tests/api/test_notifications_rest.py::test_dismiss_nonexistent_returns_404", "type": "Coroutine", "lineno": 30}, {"nodeid": "tests/api/test_notifications_rest.py::test_dismiss_via_service", "type": "Coroutine", "lineno": 39}, {"nodeid": "tests/api/test_notifications_rest.py::test_dismiss_all_via_service", "type": "Coroutine", "lineno": 59}]}, {"nodeid": "tests/api/test_prometheus_metrics.py", "outcome": "passed", "result": [{"nodeid": "tests/api/test_prometheus_metrics.py::test_metrics_returns_200", "type": "Coroutine", "lineno": 12}, {"nodeid": "tests/api/test_prometheus_metrics.py::test_metrics_content_type", "type": "Coroutine", "lineno": 21}, {"nodeid": "tests/api/test_prometheus_metrics.py::test_metrics_has_info", "type": "Coroutine", "lineno": 31}, {"nodeid": "tests/api/test_prometheus_metrics.py::test_metrics_has_uptime", "type": "Coroutine", "lineno": 39}, {"nodeid": "tests/api/test_prometheus_metrics.py::test_metrics_has_startup", "type": "Coroutine", "lineno": 47}, {"nodeid": "tests/api/test_prometheus_metrics.py::test_metrics_has_entity_count", "type": "Coroutine", "lineno": 54}, {"nodeid": "tests/api/test_prometheus_metrics.py::test_metrics_has_state_changes", "type": "Coroutine", "lineno": 62}, {"nodeid": "tests/api/test_prometheus_metrics.py::test_metrics_has_events_fired", "type": "Coroutine", "lineno": 70}, {"nodeid": "tests/api/test_prometheus_metrics.py::test_metrics_has_latency", "type": "Coroutine", "lineno": 77}, {"nodeid": "tests/api/test_prometheus_metrics.py::test_metrics_has_memory", "type": "Coroutine", "lineno": 85}, {"nodeid": "tests/api/test_prometheus_metrics.py::test_metrics_has_ws_connections", "type": "Coroutine", "lineno": 93}, {"nodeid": "tests/api/test_prometheus_metrics.py::test_metrics_has_automation_triggers", "type": "Coroutine", "lineno": 100}, {"nodeid": "tests/api/test_prometheus_metrics.py::test_metrics_valid_prometheus_format", "type": "Coroutine", "lineno": 107}, {"nodeid": "tests/api/test_prometheus_metrics.py::test_metrics_entity_count_positive", "type": "Coroutine", "lineno": 121}]}, {"nodeid": "tests/api/test_recorder_history.py", "outcome": "passed", "result": [{"nodeid": "tests/api/test_recorder_history.py::test_history_records_state_changes", "type": "Coroutine", "lineno": 15}, {"nodeid": "tests/api/test_recorder_history.py::test_history_has_state_values", "type": "Coroutine", "lineno": 32}, {"nodeid": "tests/api/test_recorder_history.py::test_history_empty_for_unknown_entity", "type": "Coroutine", "lineno": 52}, {"nodeid": "tests/api/test_recorder_history.py::test_area_create_and_list", "type": "Coroutine", "lineno": 66}, {"nodeid": "tests/api/test_recorder_history.py::test_area_entity_assignment", "type": "Coroutine", "lineno": 85}, {"nodeid": "tests/api/test_recorder_history.py::test_device_registry_via_ws", "type": "Coroutine", "lineno": 120}, {"nodeid": "tests/api/test_recorder_history.py::test_label_list_via_ws", "type": "Coroutine", "lineno": 129}, {"nodeid": "tests/api/test_recorder_history.py::test_logbook_records_events", "type": "Coroutine", "lineno": 138}, {"nodeid": "tests/api/test_recorder_history.py::test_logbook_filtered_by_entity", "type": "Coroutine", "lineno": 152}]}, {"nodeid": "tests/api/test_rest_error_handling.py", "outcome": "passed", "result": [{"nodeid": "tests/api/test_rest_error_handling.py::test_get_nonexistent_state_404", "type": "Coroutine", "lineno": 25}, {"nodeid": "tests/api/test_rest_error_handling.py::test_delete_nonexistent_state_404", "type": "Coroutine", "lineno": 35}, {"nodeid": "tests/api/test_rest_error_handling.py::test_dismiss_nonexistent_notification_404", "type": "Coroutine", "lineno": 45}, {"nodeid": "tests/api/test_rest_error_handling.py::test_unknown_api_path_handled", "type": "Coroutine", "lineno": 55}, {"nodeid": "tests/api/test_rest_error_handling.py::test_405_get_on_post_only", "type": "Coroutine", "lineno": 65}, {"nodeid": "tests/api/test_rest_error_handling.py::test_get_history_nonexistent_entity", "type": "Coroutine", "lineno": 77}, {"nodeid": "tests/api/test_rest_error_handling.py::test_logbook_nonexistent_entity_empty", "type": "Coroutine", "lineno": 89}, {"nodeid": "tests/api/test_rest_error_handling.py::test_logbook_global_returns_list", "type": "Coroutine", "lineno": 100}, {"nodeid": "tests/api/test_rest_error_handling.py::test_statistics_nonexistent_entity", "type": "Coroutine", "lineno": 110}, {"nodeid": "tests/api/test_rest_error_handling.py::test_set_state_no_body_422", "type": "Coroutine", "lineno": 124}, {"nodeid": "tests/api/test_rest_error_handling.py::test_set_state_invalid_json", "type": "Coroutine", "lineno": 134}, {"nodeid": "tests/api/test_rest_error_handling.py::test_set_state_missing_state_field", "type": "Coroutine", "lineno": 144}, {"nodeid": "tests/api/test_rest_error_handling.py::test_service_call_invalid_json", "type": "Coroutine", "lineno": 155}, {"nodeid": "tests/api/test_rest_error_handling.py::test_template_missing_template_field", "type": "Coroutine", "lineno": 165}, {"nodeid": "tests/api/test_rest_error_handling.py::test_missing_required_fields_400[area-empty]", "type": "Coroutine", "lineno": 175}, {"nodeid": "tests/api/test_rest_error_handling.py::test_missing_required_fields_400[label-empty]", "type": "Coroutine", "lineno": 175}, {"nodeid": "tests/api/test_rest_error_handling.py::test_missing_required_fields_400[device-partial]", "type": "Coroutine", "lineno": 175}, {"nodeid": "tests/api/test_rest_error_handling.py::test_invalid_yaml_400[automation]", "type": "Coroutine", "lineno": 190}, {"nodeid": "tests/api/test_rest_error_handling.py::test_invalid_yaml_400[scene]", "type": "Coroutine", "lineno": 190}, {"nodeid": "tests/api/test_rest_error_handling.py::test_template_syntax_error_400[undefined-filter]", "type": "Coroutine", "lineno": 207}, {"nodeid": "tests/api/test_rest_error_handling.py::test_template_syntax_error_400[unclosed-tag]", "type": "Coroutine", "lineno": 207}, {"nodeid": "tests/api/test_rest_error_handling.py::test_template_syntax_error_400[nonexistent-filter]", "type": "Coroutine", "lineno": 207}, {"nodeid": "tests/api/test_rest_error_handling.py::test_template_syntax_error_400[bad-syntax]", "type": "Coroutine", "lineno": 207}, {"nodeid": "tests/api/test_rest_error_handling.py::test_template_empty_string", "type": "Coroutine", "lineno": 228}, {"nodeid": "tests/api/test_rest_error_handling.py::test_template_deeply_nested", "type": "Coroutine", "lineno": 239}, {"nodeid": "tests/api/test_rest_error_handling.py::test_template_string_concatenation", "type": "Coroutine", "lineno": 250}, {"nodeid": "tests/api/test_rest_error_handling.py::test_template_comparison", "type": "Coroutine", "lineno": 261}, {"nodeid": "tests/api/test_rest_error_handling.py::test_call_service_unknown_domain", "type": "Coroutine", "lineno": 275}, {"nodeid": "tests/api/test_rest_error_handling.py::test_nonexistent_service", "type": "Coroutine", "lineno": 289}, {"nodeid": "tests/api/test_rest_error_handling.py::test_service_call_empty_body", "type": "Coroutine", "lineno": 299}, {"nodeid": "tests/api/test_rest_error_handling.py::test_service_call_nonexistent_entity", "type": "Coroutine", "lineno": 309}, {"nodeid": "tests/api/test_rest_error_handling.py::test_service_empty_entity_id_array", "type": "Coroutine", "lineno": 319}, {"nodeid": "tests/api/test_rest_error_handling.py::test_service_call_returns_200", "type": "Coroutine", "lineno": 329}, {"nodeid": "tests/api/test_rest_error_handling.py::test_service_call_returns_changed_states", "type": "Coroutine", "lineno": 342}, {"nodeid": "tests/api/test_rest_error_handling.py::test_service_call_returns_json", "type": "Coroutine", "lineno": 358}, {"nodeid": "tests/api/test_rest_error_handling.py::test_fire_event_empty_type", "type": "Coroutine", "lineno": 376}, {"nodeid": "tests/api/test_rest_error_handling.py::test_fire_event_returns_200", "type": "Coroutine", "lineno": 387}, {"nodeid": "tests/api/test_rest_error_handling.py::test_fire_event_empty_body", "type": "Coroutine", "lineno": 397}, {"nodeid": "tests/api/test_rest_error_handling.py::test_fire_event_with_special_chars", "type": "Coroutine", "lineno": 407}, {"nodeid": "tests/api/test_rest_error_handling.py::test_set_state_returns_entity_id", "type": "Coroutine", "lineno": 420}, {"nodeid": "tests/api/test_rest_error_handling.py::test_set_state_returns_state", "type": "Coroutine", "lineno": 434}, {"nodeid": "tests/api/test_rest_error_handling.py::test_set_state_returns_attributes", "type": "Coroutine", "lineno": 447}, {"nodeid": "tests/api/test_rest_error_handling.py::test_set_state_returns_entity_format", "type": "Coroutine", "lineno": 460}, {"nodeid": "tests/api/test_rest_error_handling.py::test_set_state_preserves_entity_id_case", "type": "Coroutine", "lineno": 479}, {"nodeid": "tests/api/test_rest_error_handling.py::test_health_no_auth_required", "type": "Coroutine", "lineno": 491}, {"nodeid": "tests/api/test_rest_error_handling.py::test_health_returns_version", "type": "Coroutine", "lineno": 499}, {"nodeid": "tests/api/test_rest_error_handling.py::test_health_returns_ws_connections", "type": "Coroutine", "lineno": 506}, {"nodeid": "tests/api/test_rest_error_handling.py::test_config_returns_valid_json", "type": "Coroutine", "lineno": 515}, {"nodeid": "tests/api/test_rest_error_handling.py::test_config_check_returns_result", "type": "Coroutine", "lineno": 528}, {"nodeid": "tests/api/test_rest_error_handling.py::test_get_states_always_returns_list", "type": "Coroutine", "lineno": 544}, {"nodeid": "tests/api/test_rest_error_handling.py::test_api_root_returns_message", "type": "Coroutine", "lineno": 555}, {"nodeid": "tests/api/test_rest_error_handling.py::test_token_create_empty_name", "type": "Coroutine", "lineno": 569}, {"nodeid": "tests/api/test_rest_error_handling.py::test_delete_then_get_returns_none", "type": "Coroutine", "lineno": 584}, {"nodeid": "tests/api/test_rest_error_handling.py::test_create_update_delete_lifecycle", "type": "Coroutine", "lineno": 598}, {"nodeid": "tests/api/test_rest_error_handling.py::test_concurrent_state_updates", "type": "Coroutine", "lineno": 624}, {"nodeid": "tests/api/test_rest_error_handling.py::test_ws_unknown_command", "type": "Coroutine", "lineno": 640}, {"nodeid": "tests/api/test_rest_error_handling.py::test_ws_call_service_missing_domain", "type": "Coroutine", "lineno": 647}]}, {"nodeid": "tests/api/test_rest_notification_endpoints.py", "outcome": "passed", "result": [{"nodeid": "tests/api/test_rest_notification_endpoints.py::test_list_notifications_returns_200", "type": "Coroutine", "lineno": 24}, {"nodeid": "tests/api/test_rest_notification_endpoints.py::test_list_notifications_is_array", "type": "Coroutine", "lineno": 33}, {"nodeid": "tests/api/test_rest_notification_endpoints.py::test_created_notification_appears", "type": "Coroutine", "lineno": 42}, {"nodeid": "tests/api/test_rest_notification_endpoints.py::test_notification_has_title_and_message", "type": "Coroutine", "lineno": 56}, {"nodeid": "tests/api/test_rest_notification_endpoints.py::test_dismiss_notification_via_rest", "type": "Coroutine", "lineno": 75}, {"nodeid": "tests/api/test_rest_notification_endpoints.py::test_dismiss_nonexistent_notification", "type": "Coroutine", "lineno": 96}, {"nodeid": "tests/api/test_rest_notification_endpoints.py::test_dismiss_all_notifications", "type": "Coroutine", "lineno": 106}, {"nodeid": "tests/api/test_rest_notification_endpoints.py::test_create_overwrite_notification", "type": "Coroutine", "lineno": 126}, {"nodeid": "tests/api/test_rest_notification_endpoints.py::test_notification_has_created_at", "type": "Coroutine", "lineno": 146}]}, {"nodeid": "tests/api/test_rest_service_arrays.py", "outcome": "passed", "result": [{"nodeid": "tests/api/test_rest_service_arrays.py::test_entity_id_array_turn_on", "type": "Coroutine", "lineno": 12}, {"nodeid": "tests/api/test_rest_service_arrays.py::test_entity_id_array_turn_off", "type": "Coroutine", "lineno": 32}, {"nodeid": "tests/api/test_rest_service_arrays.py::test_target_entity_id_pattern", "type": "Coroutine", "lineno": 47}, {"nodeid": "tests/api/test_rest_service_arrays.py::test_target_entity_id_array_pattern", "type": "Coroutine", "lineno": 60}, {"nodeid": "tests/api/test_rest_service_arrays.py::test_service_with_data_array", "type": "Coroutine", "lineno": 77}, {"nodeid": "tests/api/test_rest_service_arrays.py::test_service_changed_states_all_fields", "type": "Coroutine", "lineno": 98}, {"nodeid": "tests/api/test_rest_service_arrays.py::test_homeassistant_turn_on_array", "type": "Coroutine", "lineno": 118}, {"nodeid": "tests/api/test_rest_service_arrays.py::test_toggle_array", "type": "Coroutine", "lineno": 136}]}, {"nodeid": "tests/api/test_rest_service_dispatch_patterns.py", "outcome": "passed", "result": [{"nodeid": "tests/api/test_rest_service_dispatch_patterns.py::test_service_array_entity_id", "type": "Coroutine", "lineno": 17}, {"nodeid": "tests/api/test_rest_service_dispatch_patterns.py::test_service_single_entity_id_string", "type": "Coroutine", "lineno": 36}, {"nodeid": "tests/api/test_rest_service_dispatch_patterns.py::test_service_target_entity_id", "type": "Coroutine", "lineno": 50}, {"nodeid": "tests/api/test_rest_service_dispatch_patterns.py::test_service_target_array_entity_id", "type": "Coroutine", "lineno": 67}, {"nodeid": "tests/api/test_rest_service_dispatch_patterns.py::test_automation_trigger_service", "type": "Coroutine", "lineno": 88}, {"nodeid": "tests/api/test_rest_service_dispatch_patterns.py::test_automation_turn_off_service", "type": "Coroutine", "lineno": 99}, {"nodeid": "tests/api/test_rest_service_dispatch_patterns.py::test_automation_toggle_service", "type": "Coroutine", "lineno": 121}, {"nodeid": "tests/api/test_rest_service_dispatch_patterns.py::test_notification_create_via_service", "type": "Coroutine", "lineno": 149}, {"nodeid": "tests/api/test_rest_service_dispatch_patterns.py::test_notification_dismiss_via_service", "type": "Coroutine", "lineno": 174}, {"nodeid": "tests/api/test_rest_service_dispatch_patterns.py::test_notification_dismiss_all_via_service", "type": "Coroutine", "lineno": 196}, {"nodeid": "tests/api/test_rest_service_dispatch_patterns.py::test_scene_turn_on_via_rest", "type": "Coroutine", "lineno": 208}, {"nodeid": "tests/api/test_rest_service_dispatch_patterns.py::test_simple_state_transition[alarm_arm_home]", "type": "Coroutine", "lineno": 283}, {"nodeid": "tests/api/test_rest_service_dispatch_patterns.py::test_simple_state_transition[alarm_disarm]", "type": "Coroutine", "lineno": 283}, {"nodeid": "tests/api/test_rest_service_dispatch_patterns.py::test_simple_state_transition[climate_set_hvac_mode]", "type": "Coroutine", "lineno": 283}, {"nodeid": "tests/api/test_rest_service_dispatch_patterns.py::test_simple_state_transition[vacuum_return_to_base]", "type": "Coroutine", "lineno": 283}, {"nodeid": "tests/api/test_rest_service_dispatch_patterns.py::test_simple_state_transition[vacuum_pause]", "type": "Coroutine", "lineno": 283}, {"nodeid": "tests/api/test_rest_service_dispatch_patterns.py::test_simple_state_transition[number_set_value]", "type": "Coroutine", "lineno": 283}, {"nodeid": "tests/api/test_rest_service_dispatch_patterns.py::test_simple_state_transition[select_option]", "type": "Coroutine", "lineno": 283}, {"nodeid": "tests/api/test_rest_service_dispatch_patterns.py::test_simple_state_transition[input_number_set_value]", "type": "Coroutine", "lineno": 283}, {"nodeid": "tests/api/test_rest_service_dispatch_patterns.py::test_simple_state_transition[input_text_set_value]", "type": "Coroutine", "lineno": 283}, {"nodeid": "tests/api/test_rest_service_dispatch_patterns.py::test_simple_state_transition[input_text_set_value_service]", "type": "Coroutine", "lineno": 283}, {"nodeid": "tests/api/test_rest_service_dispatch_patterns.py::test_simple_state_transition[input_select_select_option]", "type": "Coroutine", "lineno": 283}, {"nodeid": "tests/api/test_rest_service_dispatch_patterns.py::test_simple_state_transition[input_select_select_option_service]", "type": "Coroutine", "lineno": 283}, {"nodeid": "tests/api/test_rest_service_dispatch_patterns.py::test_attribute_setting_service[climate_set_temperature]", "type": "Coroutine", "lineno": 342}, {"nodeid": "tests/api/test_rest_service_dispatch_patterns.py::test_attribute_setting_service[media_player_volume_set]", "type": "Coroutine", "lineno": 342}, {"nodeid": "tests/api/test_rest_service_dispatch_patterns.py::test_attribute_setting_service[cover_set_position]", "type": "Coroutine", "lineno": 342}, {"nodeid": "tests/api/test_rest_service_dispatch_patterns.py::test_attribute_setting_service[fan_set_percentage]", "type": "Coroutine", "lineno": 342}, {"nodeid": "tests/api/test_rest_service_dispatch_patterns.py::test_attribute_setting_service[cover_position_tracking]", "type": "Coroutine", "lineno": 342}, {"nodeid": "tests/api/test_rest_service_dispatch_patterns.py::test_attribute_setting_service[fan_percentage_tracking]", "type": "Coroutine", "lineno": 342}, {"nodeid": "tests/api/test_rest_service_dispatch_patterns.py::test_attribute_setting_service[media_player_select_source]", "type": "Coroutine", "lineno": 342}, {"nodeid": "tests/api/test_rest_service_dispatch_patterns.py::test_two_step_cycle[lock_lock_unlock]", "type": "Coroutine", "lineno": 401}, {"nodeid": "tests/api/test_rest_service_dispatch_patterns.py::test_two_step_cycle[media_player_play_pause]", "type": "Coroutine", "lineno": 401}, {"nodeid": "tests/api/test_rest_service_dispatch_patterns.py::test_two_step_cycle[media_player_turn_on_off]", "type": "Coroutine", "lineno": 401}, {"nodeid": "tests/api/test_rest_service_dispatch_patterns.py::test_two_step_cycle[vacuum_start_stop]", "type": "Coroutine", "lineno": 401}, {"nodeid": "tests/api/test_rest_service_dispatch_patterns.py::test_two_step_cycle[siren_on_off]", "type": "Coroutine", "lineno": 401}, {"nodeid": "tests/api/test_rest_service_dispatch_patterns.py::test_two_step_cycle[valve_open_close]", "type": "Coroutine", "lineno": 401}, {"nodeid": "tests/api/test_rest_service_dispatch_patterns.py::test_two_step_cycle[cover_open_close_cycle]", "type": "Coroutine", "lineno": 401}, {"nodeid": "tests/api/test_rest_service_dispatch_patterns.py::test_two_step_cycle[input_boolean_toggle_cycle]", "type": "Coroutine", "lineno": 401}, {"nodeid": "tests/api/test_rest_service_dispatch_patterns.py::test_toggle_cycle[siren_toggle]", "type": "Coroutine", "lineno": 443}, {"nodeid": "tests/api/test_rest_service_dispatch_patterns.py::test_toggle_cycle[valve_toggle]", "type": "Coroutine", "lineno": 443}, {"nodeid": "tests/api/test_rest_service_dispatch_patterns.py::test_toggle_cycle[fan_toggle]", "type": "Coroutine", "lineno": 443}, {"nodeid": "tests/api/test_rest_service_dispatch_patterns.py::test_cover_toggle_with_position", "type": "Coroutine", "lineno": 467}, {"nodeid": "tests/api/test_rest_service_dispatch_patterns.py::test_multi_step_cycle[input_boolean_on_off_cycle]", "type": "Coroutine", "lineno": 505}, {"nodeid": "tests/api/test_rest_service_dispatch_patterns.py::test_multi_step_cycle[input_boolean_services]", "type": "Coroutine", "lineno": 505}, {"nodeid": "tests/api/test_rest_service_dispatch_patterns.py::test_cover_stop_preserves_state", "type": "Coroutine", "lineno": 526}, {"nodeid": "tests/api/test_rest_service_dispatch_patterns.py::test_media_player_next_previous_preserves_playing", "type": "Coroutine", "lineno": 537}]}, {"nodeid": "tests/api/test_rest_states_bulk_ops.py", "outcome": "passed", "result": [{"nodeid": "tests/api/test_rest_states_bulk_ops.py::test_get_all_states_returns_list", "type": "Coroutine", "lineno": 16}, {"nodeid": "tests/api/test_rest_states_bulk_ops.py::test_get_all_states_nonempty", "type": "Coroutine", "lineno": 22}, {"nodeid": "tests/api/test_rest_states_bulk_ops.py::test_state_entry_has_entity_id", "type": "Coroutine", "lineno": 28}, {"nodeid": "tests/api/test_rest_states_bulk_ops.py::test_state_entry_has_state", "type": "Coroutine", "lineno": 36}, {"nodeid": "tests/api/test_rest_states_bulk_ops.py::test_state_entry_has_attributes", "type": "Coroutine", "lineno": 44}, {"nodeid": "tests/api/test_rest_states_bulk_ops.py::test_state_entry_has_timestamps", "type": "Coroutine", "lineno": 52}, {"nodeid": "tests/api/test_rest_states_bulk_ops.py::test_state_entry_has_context", "type": "Coroutine", "lineno": 60}, {"nodeid": "tests/api/test_rest_states_bulk_ops.py::test_created_entity_in_get_all", "type": "Coroutine", "lineno": 68}, {"nodeid": "tests/api/test_rest_states_bulk_ops.py::test_delete_entity_returns_200", "type": "Coroutine", "lineno": 81}, {"nodeid": "tests/api/test_rest_states_bulk_ops.py::test_delete_entity_removes_from_states", "type": "Coroutine", "lineno": 94}, {"nodeid": "tests/api/test_rest_states_bulk_ops.py::test_delete_entity_then_recreate", "type": "Coroutine", "lineno": 109}, {"nodeid": "tests/api/test_rest_states_bulk_ops.py::test_delete_nonexistent_entity", "type": "Coroutine", "lineno": 126}, {"nodeid": "tests/api/test_rest_states_bulk_ops.py::test_set_and_get_consistency", "type": "Coroutine", "lineno": 138}, {"nodeid": "tests/api/test_rest_states_bulk_ops.py::test_multiple_entities_unique", "type": "Coroutine", "lineno": 149}]}, {"nodeid": "tests/api/test_rest_states_patterns.py", "outcome": "passed", "result": [{"nodeid": "tests/api/test_rest_states_patterns.py::test_get_states_returns_list", "type": "Coroutine", "lineno": 15}, {"nodeid": "tests/api/test_rest_states_patterns.py::test_set_state_creates_entity", "type": "Coroutine", "lineno": 26}, {"nodeid": "tests/api/test_rest_states_patterns.py::test_set_state_updates_existing", "type": "Coroutine", "lineno": 43}, {"nodeid": "tests/api/test_rest_states_patterns.py::test_delete_state_removes_entity", "type": "Coroutine", "lineno": 54}, {"nodeid": "tests/api/test_rest_states_patterns.py::test_delete_nonexistent_returns_404", "type": "Coroutine", "lineno": 73}, {"nodeid": "tests/api/test_rest_states_patterns.py::test_get_nonexistent_returns_404", "type": "Coroutine", "lineno": 82}, {"nodeid": "tests/api/test_rest_states_patterns.py::test_set_state_with_numeric_string", "type": "Coroutine", "lineno": 91}, {"nodeid": "tests/api/test_rest_states_patterns.py::test_set_state_with_boolean_attributes", "type": "Coroutine", "lineno": 101}, {"nodeid": "tests/api/test_rest_states_patterns.py::test_set_state_with_nested_attributes", "type": "Coroutine", "lineno": 112}, {"nodeid": "tests/api/test_rest_states_patterns.py::test_set_state_empty_string", "type": "Coroutine", "lineno": 126}, {"nodeid": "tests/api/test_rest_states_patterns.py::test_set_state_long_value", "type": "Coroutine", "lineno": 136}, {"nodeid": "tests/api/test_rest_states_patterns.py::test_entity_id_with_underscores", "type": "Coroutine", "lineno": 147}, {"nodeid": "tests/api/test_rest_states_patterns.py::test_set_state_response_has_entity_fields", "type": "Coroutine", "lineno": 157}]}, {"nodeid": "tests/api/test_rest_template_endpoint.py", "outcome": "passed", "result": [{"nodeid": "tests/api/test_rest_template_endpoint.py::test_template_simple_expression", "type": "Coroutine", "lineno": 17}, {"nodeid": "tests/api/test_rest_template_endpoint.py::test_template_string_literal", "type": "Coroutine", "lineno": 28}, {"nodeid": "tests/api/test_rest_template_endpoint.py::test_template_is_state_function", "type": "Coroutine", "lineno": 39}, {"nodeid": "tests/api/test_rest_template_endpoint.py::test_template_invalid_syntax_returns_400", "type": "Coroutine", "lineno": 54}, {"nodeid": "tests/api/test_rest_template_endpoint.py::test_template_plain_text", "type": "Coroutine", "lineno": 64}, {"nodeid": "tests/api/test_rest_template_endpoint.py::test_template_state_attr_function", "type": "Coroutine", "lineno": 75}, {"nodeid": "tests/api/test_rest_template_endpoint.py::test_template_multiple_expressions", "type": "Coroutine", "lineno": 90}]}, {"nodeid": "tests/api/test_scene_config_api.py", "outcome": "passed", "result": [{"nodeid": "tests/api/test_scene_config_api.py::test_list_scenes_returns_list", "type": "Coroutine", "lineno": 14}, {"nodeid": "tests/api/test_scene_config_api.py::test_list_scenes_has_id", "type": "Coroutine", "lineno": 26}, {"nodeid": "tests/api/test_scene_config_api.py::test_list_scenes_has_name", "type": "Coroutine", "lineno": 37}, {"nodeid": "tests/api/test_scene_config_api.py::test_list_scenes_has_entity_count", "type": "Coroutine", "lineno": 48}, {"nodeid": "tests/api/test_scene_config_api.py::test_get_scene_yaml", "type": "Coroutine", "lineno": 60}, {"nodeid": "tests/api/test_scene_config_api.py::test_scene_evening_in_list", "type": "Coroutine", "lineno": 70}, {"nodeid": "tests/api/test_scene_config_api.py::test_scene_goodnight_in_list", "type": "Coroutine", "lineno": 81}, {"nodeid": "tests/api/test_scene_config_api.py::test_scene_config_returns_list", "type": "Coroutine", "lineno": 94}, {"nodeid": "tests/api/test_scene_config_api.py::test_scene_entity_has_friendly_name", "type": "Coroutine", "lineno": 113}, {"nodeid": "tests/api/test_scene_config_api.py::test_scene_activation_sets_entity_states", "type": "Coroutine", "lineno": 132}]}, {"nodeid": "tests/api/test_scene_yaml_endpoints.py", "outcome": "passed", "result": [{"nodeid": "tests/api/test_scene_yaml_endpoints.py::test_get_scene_yaml_returns_200", "type": "Coroutine", "lineno": 13}, {"nodeid": "tests/api/test_scene_yaml_endpoints.py::test_get_scene_yaml_content_type", "type": "Coroutine", "lineno": 22}, {"nodeid": "tests/api/test_scene_yaml_endpoints.py::test_get_scene_yaml_contains_scenes", "type": "Coroutine", "lineno": 31}, {"nodeid": "tests/api/test_scene_yaml_endpoints.py::test_get_scene_yaml_has_evening", "type": "Coroutine", "lineno": 41}, {"nodeid": "tests/api/test_scene_yaml_endpoints.py::test_get_scene_yaml_has_goodnight", "type": "Coroutine", "lineno": 50}, {"nodeid": "tests/api/test_scene_yaml_endpoints.py::test_put_scene_yaml_invalid_returns_400", "type": "Coroutine", "lineno": 59}, {"nodeid": "tests/api/test_scene_yaml_endpoints.py::test_put_scene_yaml_valid_roundtrip", "type": "Coroutine", "lineno": 69}, {"nodeid": "tests/api/test_scene_yaml_endpoints.py::test_scene_config_list_returns_200", "type": "Coroutine", "lineno": 87}, {"nodeid": "tests/api/test_scene_yaml_endpoints.py::test_scene_config_list_is_array", "type": "Coroutine", "lineno": 96}, {"nodeid": "tests/api/test_scene_yaml_endpoints.py::test_scene_config_has_at_least_two", "type": "Coroutine", "lineno": 106}, {"nodeid": "tests/api/test_scene_yaml_endpoints.py::test_scene_config_entry_has_fields", "type": "Coroutine", "lineno": 116}]}, {"nodeid": "tests/api/test_search_and_registry.py", "outcome": "passed", "result": [{"nodeid": "tests/api/test_search_and_registry.py::test_search_by_domain", "type": "Coroutine", "lineno": 14}, {"nodeid": "tests/api/test_search_and_registry.py::test_search_by_state", "type": "Coroutine", "lineno": 24}, {"nodeid": "tests/api/test_search_and_registry.py::test_search_by_text", "type": "Coroutine", "lineno": 34}, {"nodeid": "tests/api/test_search_and_registry.py::test_search_combined_filters", "type": "Coroutine", "lineno": 44}, {"nodeid": "tests/api/test_search_and_registry.py::test_search_returns_sorted", "type": "Coroutine", "lineno": 55}, {"nodeid": "tests/api/test_search_and_registry.py::test_area_crud_lifecycle", "type": "Coroutine", "lineno": 68}, {"nodeid": "tests/api/test_search_and_registry.py::test_device_crud_lifecycle", "type": "Coroutine", "lineno": 114}, {"nodeid": "tests/api/test_search_and_registry.py::test_label_crud_lifecycle", "type": "Coroutine", "lineno": 146}, {"nodeid": "tests/api/test_search_and_registry.py::test_backup_download", "type": "Coroutine", "lineno": 184}, {"nodeid": "tests/api/test_search_and_registry.py::test_logbook_entity", "type": "Coroutine", "lineno": 195}, {"nodeid": "tests/api/test_search_and_registry.py::test_statistics_endpoint", "type": "Coroutine", "lineno": 208}, {"nodeid": "tests/api/test_search_and_registry.py::test_events_list", "type": "Coroutine", "lineno": 219}, {"nodeid": "tests/api/test_search_and_registry.py::test_services_list_all_domains", "type": "Coroutine", "lineno": 231}, {"nodeid": "tests/api/test_search_and_registry.py::test_config_check_valid", "type": "Coroutine", "lineno": 244}, {"nodeid": "tests/api/test_search_and_registry.py::test_webhook_set_state", "type": "Coroutine", "lineno": 254}, {"nodeid": "tests/api/test_search_and_registry.py::test_webhook_fire_event", "type": "Coroutine", "lineno": 265}, {"nodeid": "tests/api/test_search_and_registry.py::test_webhook_default_event", "type": "Coroutine", "lineno": 275}, {"nodeid": "tests/api/test_search_and_registry.py::test_prometheus_metrics", "type": "Coroutine", "lineno": 287}, {"nodeid": "tests/api/test_search_and_registry.py::test_automation_yaml_roundtrip", "type": "Coroutine", "lineno": 299}, {"nodeid": "tests/api/test_search_and_registry.py::test_scene_yaml_roundtrip", "type": "Coroutine", "lineno": 319}, {"nodeid": "tests/api/test_search_and_registry.py::test_token_create_and_revoke", "type": "Coroutine", "lineno": 338}]}, {"nodeid": "tests/api/test_search_combined_filters.py", "outcome": "passed", "result": [{"nodeid": "tests/api/test_search_combined_filters.py::test_search_domain_only", "type": "Coroutine", "lineno": 23}, {"nodeid": "tests/api/test_search_combined_filters.py::test_search_state_only", "type": "Coroutine", "lineno": 38}, {"nodeid": "tests/api/test_search_combined_filters.py::test_search_domain_and_state", "type": "Coroutine", "lineno": 52}, {"nodeid": "tests/api/test_search_combined_filters.py::test_search_domain_and_q", "type": "Coroutine", "lineno": 68}, {"nodeid": "tests/api/test_search_combined_filters.py::test_search_q_matches_friendly_name", "type": "Coroutine", "lineno": 84}, {"nodeid": "tests/api/test_search_combined_filters.py::test_search_q_case_insensitive", "type": "Coroutine", "lineno": 98}, {"nodeid": "tests/api/test_search_combined_filters.py::test_search_no_filters_returns_all", "type": "Coroutine", "lineno": 112}, {"nodeid": "tests/api/test_search_combined_filters.py::test_search_no_match_returns_empty", "type": "Coroutine", "lineno": 122}, {"nodeid": "tests/api/test_search_combined_filters.py::test_search_results_sorted_by_entity_id", "type": "Coroutine", "lineno": 133}, {"nodeid": "tests/api/test_search_combined_filters.py::test_search_state_and_q", "type": "Coroutine", "lineno": 145}, {"nodeid": "tests/api/test_search_combined_filters.py::test_search_all_three_filters", "type": "Coroutine", "lineno": 161}, {"nodeid": "tests/api/test_search_combined_filters.py::test_search_by_area", "type": "Coroutine", "lineno": 179}]}, {"nodeid": "tests/api/test_search_edge_cases.py", "outcome": "passed", "result": [{"nodeid": "tests/api/test_search_edge_cases.py::test_search_by_domain", "type": "Coroutine", "lineno": 16}, {"nodeid": "tests/api/test_search_edge_cases.py::test_search_by_state_value", "type": "Coroutine", "lineno": 30}, {"nodeid": "tests/api/test_search_edge_cases.py::test_search_by_text_query", "type": "Coroutine", "lineno": 44}, {"nodeid": "tests/api/test_search_edge_cases.py::test_search_case_insensitive", "type": "Coroutine", "lineno": 58}, {"nodeid": "tests/api/test_search_edge_cases.py::test_search_domain_and_state_combined", "type": "Coroutine", "lineno": 70}, {"nodeid": "tests/api/test_search_edge_cases.py::test_search_no_match", "type": "Coroutine", "lineno": 86}, {"nodeid": "tests/api/test_search_edge_cases.py::test_search_by_friendly_name", "type": "Coroutine", "lineno": 96}, {"nodeid": "tests/api/test_search_edge_cases.py::test_search_sorted_by_entity_id", "type": "Coroutine", "lineno": 108}, {"nodeid": "tests/api/test_search_edge_cases.py::test_webhook_set_state", "type": "Coroutine", "lineno": 124}, {"nodeid": "tests/api/test_search_edge_cases.py::test_webhook_set_state_with_attributes", "type": "Coroutine", "lineno": 138}, {"nodeid": "tests/api/test_search_edge_cases.py::test_webhook_fire_event", "type": "Coroutine", "lineno": 154}, {"nodeid": "tests/api/test_search_edge_cases.py::test_webhook_default_event", "type": "Coroutine", "lineno": 165}, {"nodeid": "tests/api/test_search_edge_cases.py::test_webhook_no_body", "type": "Coroutine", "lineno": 175}, {"nodeid": "tests/api/test_search_edge_cases.py::test_fire_event_returns_message", "type": "Coroutine", "lineno": 185}, {"nodeid": "tests/api/test_search_edge_cases.py::test_fire_event_triggers_automation", "type": "Coroutine", "lineno": 197}, {"nodeid": "tests/api/test_search_edge_cases.py::test_sim_time_set_and_read", "type": "Coroutine", "lineno": 212}, {"nodeid": "tests/api/test_search_edge_cases.py::test_sim_time_partial_update", "type": "Coroutine", "lineno": 228}, {"nodeid": "tests/api/test_search_edge_cases.py::test_backup_returns_tar_gz", "type": "Coroutine", "lineno": 249}, {"nodeid": "tests/api/test_search_edge_cases.py::test_prometheus_metrics_format", "type": "Coroutine", "lineno": 265}, {"nodeid": "tests/api/test_search_edge_cases.py::test_prometheus_has_core_metrics", "type": "Coroutine", "lineno": 275}, {"nodeid": "tests/api/test_search_edge_cases.py::test_prometheus_has_automation_metrics", "type": "Coroutine", "lineno": 294}, {"nodeid": "tests/api/test_search_edge_cases.py::test_prometheus_content_type", "type": "Coroutine", "lineno": 301}]}, {"nodeid": "tests/api/test_service_listing_format.py", "outcome": "passed", "result": [{"nodeid": "tests/api/test_service_listing_format.py::test_services_returns_list", "type": "Coroutine", "lineno": 52}, {"nodeid": "tests/api/test_service_listing_format.py::test_services_entry_format", "type": "Coroutine", "lineno": 63}, {"nodeid": "tests/api/test_service_listing_format.py::test_services_light_has_expected_services", "type": "Coroutine", "lineno": 76}, {"nodeid": "tests/api/test_service_listing_format.py::test_services_climate_has_expected_services", "type": "Coroutine", "lineno": 90}, {"nodeid": "tests/api/test_service_listing_format.py::test_services_cover_has_expected_services", "type": "Coroutine", "lineno": 105}, {"nodeid": "tests/api/test_service_listing_format.py::test_services_counter_has_expected_services", "type": "Coroutine", "lineno": 120}, {"nodeid": "tests/api/test_service_listing_format.py::test_services_fan_has_expected_services", "type": "Coroutine", "lineno": 134}, {"nodeid": "tests/api/test_service_listing_format.py::test_services_vacuum_has_expected_services", "type": "Coroutine", "lineno": 148}, {"nodeid": "tests/api/test_service_listing_format.py::test_services_timer_has_expected_services", "type": "Coroutine", "lineno": 162}, {"nodeid": "tests/api/test_service_listing_format.py::test_services_humidifier_has_expected_services", "type": "Coroutine", "lineno": 177}, {"nodeid": "tests/api/test_service_listing_format.py::test_services_all_expected_domains_present", "type": "Coroutine", "lineno": 193}, {"nodeid": "tests/api/test_service_listing_format.py::test_services_domains_sorted", "type": "Coroutine", "lineno": 205}, {"nodeid": "tests/api/test_service_listing_format.py::test_services_service_description_present", "type": "Coroutine", "lineno": 216}, {"nodeid": "tests/api/test_service_listing_format.py::test_events_returns_list", "type": "Coroutine", "lineno": 233}, {"nodeid": "tests/api/test_service_listing_format.py::test_events_has_standard_types", "type": "Coroutine", "lineno": 245}, {"nodeid": "tests/api/test_service_listing_format.py::test_events_has_listener_count", "type": "Coroutine", "lineno": 258}, {"nodeid": "tests/api/test_service_listing_format.py::test_services_automation_domain", "type": "Coroutine", "lineno": 270}, {"nodeid": "tests/api/test_service_listing_format.py::test_services_description_format", "type": "Coroutine", "lineno": 285}, {"nodeid": "tests/api/test_service_listing_format.py::test_services_total_domains", "type": "Coroutine", "lineno": 298}, {"nodeid": "tests/api/test_service_listing_format.py::test_services_total_service_count", "type": "Coroutine", "lineno": 308}]}, {"nodeid": "tests/api/test_sim_reload_config.py", "outcome": "passed", "result": [{"nodeid": "tests/api/test_sim_reload_config.py::test_sim_time_reflected_in_health", "type": "Coroutine", "lineno": 14}, {"nodeid": "tests/api/test_sim_reload_config.py::test_reload_automations_alt_path", "type": "Coroutine", "lineno": 32}, {"nodeid": "tests/api/test_sim_reload_config.py::test_scene_config_list", "type": "Coroutine", "lineno": 42}, {"nodeid": "tests/api/test_sim_reload_config.py::test_scene_yaml_get", "type": "Coroutine", "lineno": 54}, {"nodeid": "tests/api/test_sim_reload_config.py::test_automation_config_list", "type": "Coroutine", "lineno": 65}, {"nodeid": "tests/api/test_sim_reload_config.py::test_automation_yaml_get", "type": "Coroutine", "lineno": 77}]}, {"nodeid": "tests/api/test_sim_time_backup.py", "outcome": "passed", "result": [{"nodeid": "tests/api/test_sim_time_backup.py::test_sim_time_set", "type": "Coroutine", "lineno": 13}, {"nodeid": "tests/api/test_sim_time_backup.py::test_sim_time_read_via_health", "type": "Coroutine", "lineno": 23}, {"nodeid": "tests/api/test_sim_time_backup.py::test_sim_time_set_chapter", "type": "Coroutine", "lineno": 35}, {"nodeid": "tests/api/test_sim_time_backup.py::test_sim_time_set_speed", "type": "Coroutine", "lineno": 45}, {"nodeid": "tests/api/test_sim_time_backup.py::test_sim_time_partial_update", "type": "Coroutine", "lineno": 55}, {"nodeid": "tests/api/test_sim_time_backup.py::test_backup_returns_tarball", "type": "Coroutine", "lineno": 67}, {"nodeid": "tests/api/test_sim_time_backup.py::test_backup_has_content_type", "type": "Coroutine", "lineno": 78}, {"nodeid": "tests/api/test_sim_time_backup.py::test_backup_not_empty", "type": "Coroutine", "lineno": 89}, {"nodeid": "tests/api/test_sim_time_backup.py::test_prometheus_metrics_endpoint", "type": "Coroutine", "lineno": 100}, {"nodeid": "tests/api/test_sim_time_backup.py::test_prometheus_metrics_has_latency", "type": "Coroutine", "lineno": 109}, {"nodeid": "tests/api/test_sim_time_backup.py::test_prometheus_metrics_content_type", "type": "Coroutine", "lineno": 116}]}, {"nodeid": "tests/api/test_state_search_extended.py", "outcome": "passed", "result": [{"nodeid": "tests/api/test_state_search_extended.py::test_search_by_q_text", "type": "Coroutine", "lineno": 13}, {"nodeid": "tests/api/test_state_search_extended.py::test_search_combined_domain_and_state", "type": "Coroutine", "lineno": 30}, {"nodeid": "tests/api/test_state_search_extended.py::test_search_no_results", "type": "Coroutine", "lineno": 48}, {"nodeid": "tests/api/test_state_search_extended.py::test_search_domain_case_sensitive", "type": "Coroutine", "lineno": 60}, {"nodeid": "tests/api/test_state_search_extended.py::test_search_results_are_sorted", "type": "Coroutine", "lineno": 78}]}, {"nodeid": "tests/api/test_template_engine.py", "outcome": "passed", "result": [{"nodeid": "tests/api/test_template_engine.py::test_template_arithmetic[{{ 1 + 2 }}-3]", "type": "Coroutine", "lineno": 28}, {"nodeid": "tests/api/test_template_engine.py::test_template_arithmetic[{{ 5 + 3 }}-8]", "type": "Coroutine", "lineno": 28}, {"nodeid": "tests/api/test_template_engine.py::test_template_arithmetic[{{ 7 * 6 }}-42]", "type": "Coroutine", "lineno": 28}, {"nodeid": "tests/api/test_template_engine.py::test_template_arithmetic[{{ 100 / 4 }}-25]", "type": "Coroutine", "lineno": 28}, {"nodeid": "tests/api/test_template_engine.py::test_template_arithmetic[{{ 17 % 5 }}-2]", "type": "Coroutine", "lineno": 28}, {"nodeid": "tests/api/test_template_engine.py::test_template_arithmetic[{{ (10 + 20) * 2 }}-60]", "type": "Coroutine", "lineno": 28}, {"nodeid": "tests/api/test_template_engine.py::test_template_arithmetic[{{ (10 + 5) * 2 }}-30]", "type": "Coroutine", "lineno": 28}, {"nodeid": "tests/api/test_template_engine.py::test_template_float_division", "type": "Coroutine", "lineno": 44}, {"nodeid": "tests/api/test_template_engine.py::test_filter_string_case[{{ 'HELLO' | lower }}-hello]", "type": "Coroutine", "lineno": 53}, {"nodeid": "tests/api/test_template_engine.py::test_filter_string_case[{{ 'WORLD' | lower }}-world]", "type": "Coroutine", "lineno": 53}, {"nodeid": "tests/api/test_template_engine.py::test_filter_string_case[{{ 'hello' | upper }}-HELLO]", "type": "Coroutine", "lineno": 53}, {"nodeid": "tests/api/test_template_engine.py::test_filter_string_case[{{ 'hello world' | title }}-Hello World]", "type": "Coroutine", "lineno": 53}, {"nodeid": "tests/api/test_template_engine.py::test_filter_trim", "type": "Coroutine", "lineno": 66}, {"nodeid": "tests/api/test_template_engine.py::test_filter_replace", "type": "Coroutine", "lineno": 73}, {"nodeid": "tests/api/test_template_engine.py::test_filter_length", "type": "Coroutine", "lineno": 80}, {"nodeid": "tests/api/test_template_engine.py::test_filter_numeric_conversion[{{ '42' | int }}-42]", "type": "Coroutine", "lineno": 89}, {"nodeid": "tests/api/test_template_engine.py::test_filter_numeric_conversion[{{ '3.14' | float }}-3.14]", "type": "Coroutine", "lineno": 89}, {"nodeid": "tests/api/test_template_engine.py::test_filter_numeric_conversion[{{ -42 | abs }}-42]", "type": "Coroutine", "lineno": 89}, {"nodeid": "tests/api/test_template_engine.py::test_filter_int_from_float_string", "type": "Coroutine", "lineno": 101}, {"nodeid": "tests/api/test_template_engine.py::test_filter_round[{{ 3.7 | round }}-4]", "type": "Coroutine", "lineno": 108}, {"nodeid": "tests/api/test_template_engine.py::test_filter_round[{{ 3.14159 | round(2) }}-3.14]", "type": "Coroutine", "lineno": 108}, {"nodeid": "tests/api/test_template_engine.py::test_filter_round[{{ 3.7 | round(0) }}-expected2]", "type": "Coroutine", "lineno": 108}, {"nodeid": "tests/api/test_template_engine.py::test_filter_min_max[{{ 3 | max(7) }}-7]", "type": "Coroutine", "lineno": 123}, {"nodeid": "tests/api/test_template_engine.py::test_filter_min_max[{{ 3 | min(7) }}-3]", "type": "Coroutine", "lineno": 123}, {"nodeid": "tests/api/test_template_engine.py::test_filter_min_max[{{ 5 | max(10) | int }}-10]", "type": "Coroutine", "lineno": 123}, {"nodeid": "tests/api/test_template_engine.py::test_filter_min_max[{{ 5 | min(10) | int }}-5]", "type": "Coroutine", "lineno": 123}, {"nodeid": "tests/api/test_template_engine.py::test_filter_log[{{ 1 | log }}-0]", "type": "Coroutine", "lineno": 136}, {"nodeid": "tests/api/test_template_engine.py::test_filter_log[{{ 1 | log | round(1) }}-0.0]", "type": "Coroutine", "lineno": 136}, {"nodeid": "tests/api/test_template_engine.py::test_filter_log[{{ 100 | log(10) | round(1) }}-2.0]", "type": "Coroutine", "lineno": 136}, {"nodeid": "tests/api/test_template_engine.py::test_filter_iif[{{ 1 | iif('yes', 'no') }}-yes]", "type": "Coroutine", "lineno": 150}, {"nodeid": "tests/api/test_template_engine.py::test_filter_iif[{{ 0 | iif('yes', 'no') }}-no]", "type": "Coroutine", "lineno": 150}, {"nodeid": "tests/api/test_template_engine.py::test_filter_iif[{{ true | iif('on', 'off') }}-on]", "type": "Coroutine", "lineno": 150}, {"nodeid": "tests/api/test_template_engine.py::test_filter_iif[{{ false | iif('on', 'off') }}-off]", "type": "Coroutine", "lineno": 150}, {"nodeid": "tests/api/test_template_engine.py::test_filter_iif[{{ '' | iif('yes', 'no') }}-no]", "type": "Coroutine", "lineno": 150}, {"nodeid": "tests/api/test_template_engine.py::test_filter_default_undefined", "type": "Coroutine", "lineno": 164}, {"nodeid": "tests/api/test_template_engine.py::test_filter_default_with_value", "type": "Coroutine", "lineno": 171}, {"nodeid": "tests/api/test_template_engine.py::test_filter_is_defined", "type": "Coroutine", "lineno": 178}, {"nodeid": "tests/api/test_template_engine.py::test_filter_from_json_attr", "type": "Coroutine", "lineno": 187}, {"nodeid": "tests/api/test_template_engine.py::test_filter_from_json_basic", "type": "Coroutine", "lineno": 194}, {"nodeid": "tests/api/test_template_engine.py::test_filter_from_json_with_state", "type": "Coroutine", "lineno": 202}, {"nodeid": "tests/api/test_template_engine.py::test_filter_to_json", "type": "Coroutine", "lineno": 210}, {"nodeid": "tests/api/test_template_engine.py::test_states_function", "type": "Coroutine", "lineno": 219}, {"nodeid": "tests/api/test_template_engine.py::test_states_unknown_entity", "type": "Coroutine", "lineno": 230}, {"nodeid": "tests/api/test_template_engine.py::test_is_state_true", "type": "Coroutine", "lineno": 237}, {"nodeid": "tests/api/test_template_engine.py::test_is_state_false", "type": "Coroutine", "lineno": 248}, {"nodeid": "tests/api/test_template_engine.py::test_state_attr_function", "type": "Coroutine", "lineno": 259}, {"nodeid": "tests/api/test_template_engine.py::test_now_function", "type": "Coroutine", "lineno": 270}, {"nodeid": "tests/api/test_template_engine.py::test_states_with_float_comparison", "type": "Coroutine", "lineno": 278}, {"nodeid": "tests/api/test_template_engine.py::test_fn_float_conversion", "type": "Coroutine", "lineno": 288}, {"nodeid": "tests/api/test_template_engine.py::test_fn_float_default", "type": "Coroutine", "lineno": 295}, {"nodeid": "tests/api/test_template_engine.py::test_fn_int_conversion", "type": "Coroutine", "lineno": 302}, {"nodeid": "tests/api/test_template_engine.py::test_fn_int_from_float_string", "type": "Coroutine", "lineno": 309}, {"nodeid": "tests/api/test_template_engine.py::test_fn_int_default", "type": "Coroutine", "lineno": 316}, {"nodeid": "tests/api/test_template_engine.py::test_fn_bool[true-true]", "type": "Coroutine", "lineno": 323}, {"nodeid": "tests/api/test_template_engine.py::test_fn_bool[yes-true]", "type": "Coroutine", "lineno": 323}, {"nodeid": "tests/api/test_template_engine.py::test_fn_bool[on-true]", "type": "Coroutine", "lineno": 323}, {"nodeid": "tests/api/test_template_engine.py::test_fn_bool[1-true]", "type": "Coroutine", "lineno": 323}, {"nodeid": "tests/api/test_template_engine.py::test_fn_bool[false-false]", "type": "Coroutine", "lineno": 323}, {"nodeid": "tests/api/test_template_engine.py::test_fn_bool[no-false]", "type": "Coroutine", "lineno": 323}, {"nodeid": "tests/api/test_template_engine.py::test_fn_bool[off-false]", "type": "Coroutine", "lineno": 323}, {"nodeid": "tests/api/test_template_engine.py::test_fn_bool[0-false]", "type": "Coroutine", "lineno": 323}, {"nodeid": "tests/api/test_template_engine.py::test_fn_bool_numeric", "type": "Coroutine", "lineno": 340}, {"nodeid": "tests/api/test_template_engine.py::test_template_syntax_error", "type": "Coroutine", "lineno": 349}, {"nodeid": "tests/api/test_template_engine.py::test_template_undefined_function", "type": "Coroutine", "lineno": 355}, {"nodeid": "tests/api/test_template_engine.py::test_template_conditional[{{ 'yes' if 2 > 1 else 'no' }}-yes]", "type": "Coroutine", "lineno": 363}, {"nodeid": "tests/api/test_template_engine.py::test_template_conditional[{{ 'yes' if 1 > 2 else 'no' }}-no]", "type": "Coroutine", "lineno": 363}, {"nodeid": "tests/api/test_template_engine.py::test_template_conditional_with_is_state", "type": "Coroutine", "lineno": 374}, {"nodeid": "tests/api/test_template_engine.py::test_template_tilde_concat[{{ 'a' ~ 'b' ~ 'c' }}-abc]", "type": "Coroutine", "lineno": 384}, {"nodeid": "tests/api/test_template_engine.py::test_template_tilde_concat[{{ 'hello' ~ ' ' ~ 'world' }}-hello world]", "type": "Coroutine", "lineno": 384}, {"nodeid": "tests/api/test_template_engine.py::test_template_iif_with_is_state", "type": "Coroutine", "lineno": 397}, {"nodeid": "tests/api/test_template_engine.py::test_template_state_attr_missing", "type": "Coroutine", "lineno": 407}, {"nodeid": "tests/api/test_template_engine.py::test_template_for_loop", "type": "Coroutine", "lineno": 417}, {"nodeid": "tests/api/test_template_engine.py::test_template_multiline", "type": "Coroutine", "lineno": 426}, {"nodeid": "tests/api/test_template_engine.py::test_filter_chain_round_int", "type": "Coroutine", "lineno": 438}, {"nodeid": "tests/api/test_template_engine.py::test_states_with_float_filter", "type": "Coroutine", "lineno": 445}, {"nodeid": "tests/api/test_template_engine.py::test_filter_chain_trim_float_round_int", "type": "Coroutine", "lineno": 458}, {"nodeid": "tests/api/test_template_engine.py::test_filter_chain_float_round_precision", "type": "Coroutine", "lineno": 465}, {"nodeid": "tests/api/test_template_engine.py::test_filter_chain_int_abs", "type": "Coroutine", "lineno": 473}, {"nodeid": "tests/api/test_template_engine.py::test_filter_chain_default_upper", "type": "Coroutine", "lineno": 480}, {"nodeid": "tests/api/test_template_engine.py::test_filter_chain_trim_lower_replace", "type": "Coroutine", "lineno": 487}]}, {"nodeid": "tests/api/test_template_state_functions.py", "outcome": "passed", "result": [{"nodeid": "tests/api/test_template_state_functions.py::test_states_function_returns_value", "type": "Coroutine", "lineno": 35}, {"nodeid": "tests/api/test_template_state_functions.py::test_states_unknown_entity", "type": "Coroutine", "lineno": 43}, {"nodeid": "tests/api/test_template_state_functions.py::test_is_state_true", "type": "Coroutine", "lineno": 52}, {"nodeid": "tests/api/test_template_state_functions.py::test_is_state_false", "type": "Coroutine", "lineno": 60}, {"nodeid": "tests/api/test_template_state_functions.py::test_is_state_nonexistent", "type": "Coroutine", "lineno": 68}, {"nodeid": "tests/api/test_template_state_functions.py::test_state_attr_returns_value", "type": "Coroutine", "lineno": 77}, {"nodeid": "tests/api/test_template_state_functions.py::test_state_attr_numeric", "type": "Coroutine", "lineno": 85}, {"nodeid": "tests/api/test_template_state_functions.py::test_state_attr_missing_attr", "type": "Coroutine", "lineno": 93}, {"nodeid": "tests/api/test_template_state_functions.py::test_now_function", "type": "Coroutine", "lineno": 105}, {"nodeid": "tests/api/test_template_state_functions.py::test_states_in_conditional", "type": "Coroutine", "lineno": 114}, {"nodeid": "tests/api/test_template_state_functions.py::test_states_with_math", "type": "Coroutine", "lineno": 122}, {"nodeid": "tests/api/test_template_state_functions.py::test_multiple_state_functions", "type": "Coroutine", "lineno": 130}, {"nodeid": "tests/api/test_template_state_functions.py::test_is_state_in_template_logic", "type": "Coroutine", "lineno": 140}, {"nodeid": "tests/api/test_template_state_functions.py::test_ws_states_returns_entity_state", "type": "Coroutine", "lineno": 150}, {"nodeid": "tests/api/test_template_state_functions.py::test_ws_states_unknown_entity", "type": "Coroutine", "lineno": 159}, {"nodeid": "tests/api/test_template_state_functions.py::test_ws_is_state_true", "type": "Coroutine", "lineno": 165}, {"nodeid": "tests/api/test_template_state_functions.py::test_ws_is_state_false", "type": "Coroutine", "lineno": 174}, {"nodeid": "tests/api/test_template_state_functions.py::test_ws_is_state_nonexistent", "type": "Coroutine", "lineno": 183}, {"nodeid": "tests/api/test_template_state_functions.py::test_ws_state_attr_returns_value", "type": "Coroutine", "lineno": 189}, {"nodeid": "tests/api/test_template_state_functions.py::test_ws_state_attr_friendly_name", "type": "Coroutine", "lineno": 198}, {"nodeid": "tests/api/test_template_state_functions.py::test_ws_now_returns_timestamp", "type": "Coroutine", "lineno": 207}, {"nodeid": "tests/api/test_template_state_functions.py::test_ws_template_conditional", "type": "Coroutine", "lineno": 216}, {"nodeid": "tests/api/test_template_state_functions.py::test_ws_template_arithmetic", "type": "Coroutine", "lineno": 226}, {"nodeid": "tests/api/test_template_state_functions.py::test_ws_template_float_filter", "type": "Coroutine", "lineno": 236}, {"nodeid": "tests/api/test_template_state_functions.py::test_ws_template_default_filter", "type": "Coroutine", "lineno": 246}, {"nodeid": "tests/api/test_template_state_functions.py::test_ws_template_lower_upper", "type": "Coroutine", "lineno": 252}]}, {"nodeid": "tests/api/test_ws_comprehensive.py", "outcome": "passed", "result": [{"nodeid": "tests/api/test_ws_comprehensive.py::test_ws_get_services_has_service_names", "type": "Coroutine", "lineno": 49}, {"nodeid": "tests/api/test_ws_comprehensive.py::test_ws_get_notifications", "type": "Coroutine", "lineno": 59}, {"nodeid": "tests/api/test_ws_comprehensive.py::test_ws_subscribe_and_receive", "type": "Coroutine", "lineno": 68}, {"nodeid": "tests/api/test_ws_comprehensive.py::test_ws_unsubscribe", "type": "Coroutine", "lineno": 82}, {"nodeid": "tests/api/test_ws_comprehensive.py::test_ws_call_service_timer", "type": "Coroutine", "lineno": 105}, {"nodeid": "tests/api/test_ws_comprehensive.py::test_ws_call_service_counter", "type": "Coroutine", "lineno": 116}, {"nodeid": "tests/api/test_ws_comprehensive.py::test_ws_render_template_states", "type": "Coroutine", "lineno": 129}, {"nodeid": "tests/api/test_ws_comprehensive.py::test_ws_notification_lifecycle", "type": "Coroutine", "lineno": 140}, {"nodeid": "tests/api/test_ws_comprehensive.py::test_mqtt_state_appears_in_rest", "type": "Coroutine", "lineno": 174}, {"nodeid": "tests/api/test_ws_comprehensive.py::test_mqtt_state_triggers_ws_event", "type": "Coroutine", "lineno": 185}, {"nodeid": "tests/api/test_ws_comprehensive.py::test_mqtt_update_triggers_ws_with_old_state", "type": "Coroutine", "lineno": 213}, {"nodeid": "tests/api/test_ws_comprehensive.py::test_mqtt_multiple_domains", "type": "Coroutine", "lineno": 246}, {"nodeid": "tests/api/test_ws_comprehensive.py::test_mqtt_state_update_preserves_attributes", "type": "Coroutine", "lineno": 267}, {"nodeid": "tests/api/test_ws_comprehensive.py::test_mqtt_rapid_updates_all_recorded", "type": "Coroutine", "lineno": 285}, {"nodeid": "tests/api/test_ws_comprehensive.py::test_mqtt_bad_topic_ignored[wrong_prefix]", "type": "Coroutine", "lineno": 300}, {"nodeid": "tests/api/test_ws_comprehensive.py::test_mqtt_bad_topic_ignored[missing_state_segment]", "type": "Coroutine", "lineno": 300}, {"nodeid": "tests/api/test_ws_comprehensive.py::test_parallel_state_sets_10", "type": "Coroutine", "lineno": 318}, {"nodeid": "tests/api/test_ws_comprehensive.py::test_parallel_service_calls", "type": "Coroutine", "lineno": 333}, {"nodeid": "tests/api/test_ws_comprehensive.py::test_concurrent_get_endpoint[get_states]", "type": "Coroutine", "lineno": 350}, {"nodeid": "tests/api/test_ws_comprehensive.py::test_concurrent_get_endpoint[health_checks]", "type": "Coroutine", "lineno": 350}, {"nodeid": "tests/api/test_ws_comprehensive.py::test_concurrent_get_endpoint[search_requests]", "type": "Coroutine", "lineno": 350}, {"nodeid": "tests/api/test_ws_comprehensive.py::test_mixed_read_write_concurrent", "type": "Coroutine", "lineno": 368}, {"nodeid": "tests/api/test_ws_comprehensive.py::test_concurrent_template_renders", "type": "Coroutine", "lineno": 392}]}, {"nodeid": "tests/api/test_ws_registries.py", "outcome": "passed", "result": [{"nodeid": "tests/api/test_ws_registries.py::test_ws_ping_multiple", "type": "Coroutine", "lineno": 17}, {"nodeid": "tests/api/test_ws_registries.py::test_ws_area_registry_list", "type": "Coroutine", "lineno": 25}, {"nodeid": "tests/api/test_ws_registries.py::test_ws_area_registry_create", "type": "Coroutine", "lineno": 32}, {"nodeid": "tests/api/test_ws_registries.py::test_ws_area_registry_update", "type": "Coroutine", "lineno": 47}, {"nodeid": "tests/api/test_ws_registries.py::test_ws_area_registry_delete", "type": "Coroutine", "lineno": 70}, {"nodeid": "tests/api/test_ws_registries.py::test_ws_area_create_empty_fails", "type": "Coroutine", "lineno": 89}, {"nodeid": "tests/api/test_ws_registries.py::test_ws_area_registry_create_missing_fields", "type": "Coroutine", "lineno": 99}, {"nodeid": "tests/api/test_ws_registries.py::test_ws_area_create_missing_id", "type": "Coroutine", "lineno": 108}, {"nodeid": "tests/api/test_ws_registries.py::test_ws_area_create_list_delete_roundtrip", "type": "Coroutine", "lineno": 115}, {"nodeid": "tests/api/test_ws_registries.py::test_ws_device_registry_list", "type": "Coroutine", "lineno": 151}, {"nodeid": "tests/api/test_ws_registries.py::test_ws_device_registry_entry_format", "type": "Coroutine", "lineno": 158}, {"nodeid": "tests/api/test_ws_registries.py::test_ws_label_registry_list", "type": "Coroutine", "lineno": 170}, {"nodeid": "tests/api/test_ws_registries.py::test_ws_label_registry_create", "type": "Coroutine", "lineno": 177}, {"nodeid": "tests/api/test_ws_registries.py::test_ws_label_registry_delete", "type": "Coroutine", "lineno": 192}, {"nodeid": "tests/api/test_ws_registries.py::test_ws_label_create_empty_fails", "type": "Coroutine", "lineno": 212}, {"nodeid": "tests/api/test_ws_registries.py::test_ws_label_registry_missing_fields", "type": "Coroutine", "lineno": 222}, {"nodeid": "tests/api/test_ws_registries.py::test_ws_label_create_list_delete_roundtrip", "type": "Coroutine", "lineno": 231}, {"nodeid": "tests/api/test_ws_registries.py::test_ws_entity_registry_list", "type": "Coroutine", "lineno": 261}, {"nodeid": "tests/api/test_ws_registries.py::test_ws_entity_registry_entry_fields", "type": "Coroutine", "lineno": 271}, {"nodeid": "tests/api/test_ws_registries.py::test_ws_entity_registry_field_value[disabled_by-None]", "type": "Coroutine", "lineno": 282}, {"nodeid": "tests/api/test_ws_registries.py::test_ws_entity_registry_field_value[platform-mqtt]", "type": "Coroutine", "lineno": 282}, {"nodeid": "tests/api/test_ws_registries.py::test_ws_entity_registry_update_name", "type": "Coroutine", "lineno": 300}, {"nodeid": "tests/api/test_ws_registries.py::test_ws_entity_registry_update_icon", "type": "Coroutine", "lineno": 316}, {"nodeid": "tests/api/test_ws_registries.py::test_ws_entity_update_name_and_icon", "type": "Coroutine", "lineno": 331}, {"nodeid": "tests/api/test_ws_registries.py::test_ws_entity_update_area_assignment", "type": "Coroutine", "lineno": 350}, {"nodeid": "tests/api/test_ws_registries.py::test_ws_entity_update_clear_area", "type": "Coroutine", "lineno": 374}, {"nodeid": "tests/api/test_ws_registries.py::test_ws_entity_update_preserves_state", "type": "Coroutine", "lineno": 401}, {"nodeid": "tests/api/test_ws_registries.py::test_ws_entity_registry_update_nonexistent", "type": "Coroutine", "lineno": 419}, {"nodeid": "tests/api/test_ws_registries.py::test_ws_get_config_fields", "type": "Coroutine", "lineno": 431}, {"nodeid": "tests/api/test_ws_registries.py::test_ws_lovelace_config", "type": "Coroutine", "lineno": 447}, {"nodeid": "tests/api/test_ws_registries.py::test_ws_subscribe_trigger", "type": "Coroutine", "lineno": 457}, {"nodeid": "tests/api/test_ws_registries.py::test_ws_unknown_command_fails", "type": "Coroutine", "lineno": 465}]}, {"nodeid": "tests/api/test_ws_service_dispatch.py", "outcome": "passed", "result": [{"nodeid": "tests/api/test_ws_service_dispatch.py::test_ws_call_service_with_target", "type": "Coroutine", "lineno": 27}, {"nodeid": "tests/api/test_ws_service_dispatch.py::test_ws_call_service_with_service_data", "type": "Coroutine", "lineno": 39}, {"nodeid": "tests/api/test_ws_service_dispatch.py::test_ws_call_service_entity_array", "type": "Coroutine", "lineno": 53}, {"nodeid": "tests/api/test_ws_service_dispatch.py::test_ws_call_service_with_data", "type": "Coroutine", "lineno": 71}, {"nodeid": "tests/api/test_ws_service_dispatch.py::test_ws_call_service_toggle", "type": "Coroutine", "lineno": 87}, {"nodeid": "tests/api/test_ws_service_dispatch.py::test_ws_call_service_climate", "type": "Coroutine", "lineno": 103}, {"nodeid": "tests/api/test_ws_service_dispatch.py::test_ws_call_service_lock", "type": "Coroutine", "lineno": 119}, {"nodeid": "tests/api/test_ws_service_dispatch.py::test_ws_call_service_scene", "type": "Coroutine", "lineno": 134}, {"nodeid": "tests/api/test_ws_service_dispatch.py::test_ws_call_service_light_with_brightness", "type": "Coroutine", "lineno": 145}, {"nodeid": "tests/api/test_ws_service_dispatch.py::test_ws_call_service_target_entity_array", "type": "Coroutine", "lineno": 161}, {"nodeid": "tests/api/test_ws_service_dispatch.py::test_ws_call_service_attribute_domains[cover-position]", "type": "Coroutine", "lineno": 179}, {"nodeid": "tests/api/test_ws_service_dispatch.py::test_ws_call_service_attribute_domains[fan-percentage]", "type": "Coroutine", "lineno": 179}, {"nodeid": "tests/api/test_ws_service_dispatch.py::test_ws_call_service_attribute_domains[media-player-volume]", "type": "Coroutine", "lineno": 179}, {"nodeid": "tests/api/test_ws_service_dispatch.py::test_ws_call_counter_increment", "type": "Coroutine", "lineno": 200}, {"nodeid": "tests/api/test_ws_service_dispatch.py::test_ws_automation_trigger", "type": "Coroutine", "lineno": 217}, {"nodeid": "tests/api/test_ws_service_dispatch.py::test_ws_automation_turn_off", "type": "Coroutine", "lineno": 228}, {"nodeid": "tests/api/test_ws_service_dispatch.py::test_ws_automation_toggle", "type": "Coroutine", "lineno": 251}, {"nodeid": "tests/api/test_ws_service_dispatch.py::test_ws_fire_event", "type": "Coroutine", "lineno": 282}, {"nodeid": "tests/api/test_ws_service_dispatch.py::test_fire_event_edge_cases[no-event-type]", "type": "Coroutine", "lineno": 292}, {"nodeid": "tests/api/test_ws_service_dispatch.py::test_fire_event_edge_cases[empty-event-type]", "type": "Coroutine", "lineno": 292}, {"nodeid": "tests/api/test_ws_service_dispatch.py::test_fire_event_multiple_sequential", "type": "Coroutine", "lineno": 305}, {"nodeid": "tests/api/test_ws_service_dispatch.py::test_fire_event_custom_type", "type": "Coroutine", "lineno": 315}, {"nodeid": "tests/api/test_ws_service_dispatch.py::test_fire_event_no_data", "type": "Coroutine", "lineno": 325}, {"nodeid": "tests/api/test_ws_service_dispatch.py::test_ws_get_services", "type": "Coroutine", "lineno": 337}, {"nodeid": "tests/api/test_ws_service_dispatch.py::test_get_services_has_domain[light]", "type": "Coroutine", "lineno": 349}, {"nodeid": "tests/api/test_ws_service_dispatch.py::test_get_services_has_domain[switch]", "type": "Coroutine", "lineno": 349}, {"nodeid": "tests/api/test_ws_service_dispatch.py::test_get_services_has_domain[climate]", "type": "Coroutine", "lineno": 349}, {"nodeid": "tests/api/test_ws_service_dispatch.py::test_get_services_domain_entry_format", "type": "Coroutine", "lineno": 358}, {"nodeid": "tests/api/test_ws_service_dispatch.py::test_get_services_light_has_turn_on", "type": "Coroutine", "lineno": 367}, {"nodeid": "tests/api/test_ws_service_dispatch.py::test_get_services_service_has_description", "type": "Coroutine", "lineno": 374}, {"nodeid": "tests/api/test_ws_service_dispatch.py::test_get_services_matches_rest", "type": "Coroutine", "lineno": 382}, {"nodeid": "tests/api/test_ws_service_dispatch.py::test_get_services_sorted_by_domain", "type": "Coroutine", "lineno": 397}, {"nodeid": "tests/api/test_ws_service_dispatch.py::test_ws_get_config", "type": "Coroutine", "lineno": 407}, {"nodeid": "tests/api/test_ws_service_dispatch.py::test_call_service_returns_result", "type": "Coroutine", "lineno": 420}, {"nodeid": "tests/api/test_ws_service_dispatch.py::test_call_service_result_is_list", "type": "Coroutine", "lineno": 436}, {"nodeid": "tests/api/test_ws_service_dispatch.py::test_changed_state_has_entity_id", "type": "Coroutine", "lineno": 453}, {"nodeid": "tests/api/test_ws_service_dispatch.py::test_changed_state_has_state_field", "type": "Coroutine", "lineno": 469}, {"nodeid": "tests/api/test_ws_service_dispatch.py::test_changed_state_has_attributes", "type": "Coroutine", "lineno": 485}, {"nodeid": "tests/api/test_ws_service_dispatch.py::test_changed_state_has_timestamps", "type": "Coroutine", "lineno": 502}, {"nodeid": "tests/api/test_ws_service_dispatch.py::test_changed_state_has_context", "type": "Coroutine", "lineno": 519}, {"nodeid": "tests/api/test_ws_service_dispatch.py::test_multi_entity_service_response", "type": "Coroutine", "lineno": 536}, {"nodeid": "tests/api/test_ws_service_dispatch.py::test_toggle_response_reflects_new_state", "type": "Coroutine", "lineno": 558}, {"nodeid": "tests/api/test_ws_service_dispatch.py::test_service_preserves_attributes_in_response", "type": "Coroutine", "lineno": 574}, {"nodeid": "tests/api/test_ws_service_dispatch.py::test_create_notification", "type": "Coroutine", "lineno": 595}, {"nodeid": "tests/api/test_ws_service_dispatch.py::test_get_notifications", "type": "Coroutine", "lineno": 611}, {"nodeid": "tests/api/test_ws_service_dispatch.py::test_create_and_list_notification", "type": "Coroutine", "lineno": 619}, {"nodeid": "tests/api/test_ws_service_dispatch.py::test_notification_fields", "type": "Coroutine", "lineno": 643}, {"nodeid": "tests/api/test_ws_service_dispatch.py::test_dismiss_notification", "type": "Coroutine", "lineno": 668}, {"nodeid": "tests/api/test_ws_service_dispatch.py::test_dismiss_all_notifications", "type": "Coroutine", "lineno": 698}, {"nodeid": "tests/api/test_ws_service_dispatch.py::test_overwrite_notification", "type": "Coroutine", "lineno": 731}, {"nodeid": "tests/api/test_ws_service_dispatch.py::test_ws_notification_dismiss_via_call_service", "type": "Coroutine", "lineno": 765}, {"nodeid": "tests/api/test_ws_service_dispatch.py::test_ws_unsubscribe_events", "type": "Coroutine", "lineno": 793}]}, {"nodeid": "tests/api/test_ws_subscribe.py", "outcome": "passed", "result": [{"nodeid": "tests/api/test_ws_subscribe.py::test_ws_connect_and_auth", "type": "Coroutine", "lineno": 20}, {"nodeid": "tests/api/test_ws_subscribe.py::test_ws_ping", "type": "Coroutine", "lineno": 30}, {"nodeid": "tests/api/test_ws_subscribe.py::test_ws_repeated_pings[multiple_pings]", "type": "Coroutine", "lineno": 36}, {"nodeid": "tests/api/test_ws_subscribe.py::test_ws_repeated_pings[rapid_pings]", "type": "Coroutine", "lineno": 36}, {"nodeid": "tests/api/test_ws_subscribe.py::test_ws_get_states", "type": "Coroutine", "lineno": 48}, {"nodeid": "tests/api/test_ws_subscribe.py::test_ws_subscribe_events", "type": "Coroutine", "lineno": 58}, {"nodeid": "tests/api/test_ws_subscribe.py::test_ws_event_contains_entity_id", "type": "Coroutine", "lineno": 72}, {"nodeid": "tests/api/test_ws_subscribe.py::test_ws_event_has_old_and_new_state", "type": "Coroutine", "lineno": 82}, {"nodeid": "tests/api/test_ws_subscribe.py::test_ws_multiple_subscriptions", "type": "Coroutine", "lineno": 100}, {"nodeid": "tests/api/test_ws_subscribe.py::test_ws_subscribe_unsubscribe", "type": "Coroutine", "lineno": 126}, {"nodeid": "tests/api/test_ws_subscribe.py::test_ws_subscribe_then_unsubscribe_no_leak", "type": "Coroutine", "lineno": 136}, {"nodeid": "tests/api/test_ws_subscribe.py::test_ws_unsubscribe_nonexistent_id", "type": "Coroutine", "lineno": 158}, {"nodeid": "tests/api/test_ws_subscribe.py::test_ws_sequential_commands", "type": "Coroutine", "lineno": 169}, {"nodeid": "tests/api/test_ws_subscribe.py::test_ws_response_ids_increment", "type": "Coroutine", "lineno": 187}, {"nodeid": "tests/api/test_ws_subscribe.py::test_ws_interleaved_commands", "type": "Coroutine", "lineno": 197}, {"nodeid": "tests/api/test_ws_subscribe.py::test_ws_get_config_field[version]", "type": "Coroutine", "lineno": 216}, {"nodeid": "tests/api/test_ws_subscribe.py::test_ws_get_config_field[location_name]", "type": "Coroutine", "lineno": 216}, {"nodeid": "tests/api/test_ws_subscribe.py::test_ws_get_config_field[latitude]", "type": "Coroutine", "lineno": 216}, {"nodeid": "tests/api/test_ws_subscribe.py::test_ws_get_config_field[longitude]", "type": "Coroutine", "lineno": 216}, {"nodeid": "tests/api/test_ws_subscribe.py::test_ws_get_services_returns_list", "type": "Coroutine", "lineno": 231}, {"nodeid": "tests/api/test_ws_subscribe.py::test_ws_call_service_light", "type": "Coroutine", "lineno": 248}, {"nodeid": "tests/api/test_ws_subscribe.py::test_ws_unknown_command", "type": "Coroutine", "lineno": 270}, {"nodeid": "tests/api/test_ws_subscribe.py::test_ws_call_service_empty_domain", "type": "Coroutine", "lineno": 276}, {"nodeid": "tests/api/test_ws_subscribe.py::test_ws_render_template_valid", "type": "Coroutine", "lineno": 292}, {"nodeid": "tests/api/test_ws_subscribe.py::test_ws_render_template_error", "type": "Coroutine", "lineno": 302}]}, {"nodeid": "tests/api/test_ws_subscription_delivery.py", "outcome": "passed", "result": [{"nodeid": "tests/api/test_ws_subscription_delivery.py::test_ws_event_has_event_type", "type": "Coroutine", "lineno": 18}, {"nodeid": "tests/api/test_ws_subscription_delivery.py::test_ws_event_has_timestamp", "type": "Coroutine", "lineno": 27}, {"nodeid": "tests/api/test_ws_subscription_delivery.py::test_ws_event_entity_id_matches", "type": "Coroutine", "lineno": 36}, {"nodeid": "tests/api/test_ws_subscription_delivery.py::test_ws_event_new_state_has_attributes", "type": "Coroutine", "lineno": 46}, {"nodeid": "tests/api/test_ws_subscription_delivery.py::test_ws_event_old_state_preserved", "type": "Coroutine", "lineno": 57}, {"nodeid": "tests/api/test_ws_subscription_delivery.py::test_ws_subscribe_receives_state_change", "type": "Coroutine", "lineno": 68}, {"nodeid": "tests/api/test_ws_subscription_delivery.py::test_ws_event_has_new_state", "type": "Coroutine", "lineno": 86}, {"nodeid": "tests/api/test_ws_subscription_delivery.py::test_ws_state_changed_event_format", "type": "Coroutine", "lineno": 106}, {"nodeid": "tests/api/test_ws_subscription_delivery.py::test_ws_event_includes_context", "type": "Coroutine", "lineno": 120}, {"nodeid": "tests/api/test_ws_subscription_delivery.py::test_ws_event_new_state_has_timestamp_field[last_changed]", "type": "Coroutine", "lineno": 138}, {"nodeid": "tests/api/test_ws_subscription_delivery.py::test_ws_event_new_state_has_timestamp_field[last_updated]", "type": "Coroutine", "lineno": 138}, {"nodeid": "tests/api/test_ws_subscription_delivery.py::test_ws_event_subscription_id_matches", "type": "Coroutine", "lineno": 148}, {"nodeid": "tests/api/test_ws_subscription_delivery.py::test_ws_service_call_triggers_event", "type": "Coroutine", "lineno": 158}, {"nodeid": "tests/api/test_ws_subscription_delivery.py::test_ws_rapid_state_changes", "type": "Coroutine", "lineno": 172}, {"nodeid": "tests/api/test_ws_subscription_delivery.py::test_ws_multiple_events_in_order", "type": "Coroutine", "lineno": 195}, {"nodeid": "tests/api/test_ws_subscription_delivery.py::test_ws_new_entity_triggers_event", "type": "Coroutine", "lineno": 211}, {"nodeid": "tests/api/test_ws_subscription_delivery.py::test_ws_unsubscribe_stops_events", "type": "Coroutine", "lineno": 229}, {"nodeid": "tests/api/test_ws_subscription_delivery.py::test_ws_event_ids_increment", "type": "Coroutine", "lineno": 251}, {"nodeid": "tests/api/test_ws_subscription_delivery.py::test_ws_get_states_returns_list", "type": "Coroutine", "lineno": 261}, {"nodeid": "tests/api/test_ws_subscription_delivery.py::test_ws_get_states_entity_format", "type": "Coroutine", "lineno": 271}, {"nodeid": "tests/api/test_ws_subscription_delivery.py::test_ws_call_service", "type": "Coroutine", "lineno": 281}]}, {"nodeid": "tests/api/test_ws_template_render.py", "outcome": "passed", "result": [{"nodeid": "tests/api/test_ws_template_render.py::test_ws_render_simple_template", "type": "Coroutine", "lineno": 14}, {"nodeid": "tests/api/test_ws_template_render.py::test_ws_render_string_template", "type": "Coroutine", "lineno": 24}, {"nodeid": "tests/api/test_ws_template_render.py::test_ws_render_math_template", "type": "Coroutine", "lineno": 39}, {"nodeid": "tests/api/test_ws_template_render.py::test_ws_render_state_template", "type": "Coroutine", "lineno": 48}, {"nodeid": "tests/api/test_ws_template_render.py::test_ws_render_is_state_template", "type": "Coroutine", "lineno": 58}, {"nodeid": "tests/api/test_ws_template_render.py::test_ws_render_state_attr_template", "type": "Coroutine", "lineno": 68}, {"nodeid": "tests/api/test_ws_template_render.py::test_ws_render_filter_chain", "type": "Coroutine", "lineno": 78}, {"nodeid": "tests/api/test_ws_template_render.py::test_ws_render_conditional", "type": "Coroutine", "lineno": 87}, {"nodeid": "tests/api/test_ws_template_render.py::test_ws_render_now_function", "type": "Coroutine", "lineno": 96}, {"nodeid": "tests/api/test_ws_template_render.py::test_ws_render_iif_filter", "type": "Coroutine", "lineno": 105}]}, {"nodeid": "tests/api/test_yaml_roundtrip.py", "outcome": "passed", "result": [{"nodeid": "tests/api/test_yaml_roundtrip.py::test_automation_yaml_content_type", "type": "Coroutine", "lineno": 14}, {"nodeid": "tests/api/test_yaml_roundtrip.py::test_automation_yaml_has_entries", "type": "Coroutine", "lineno": 25}, {"nodeid": "tests/api/test_yaml_roundtrip.py::test_automation_yaml_roundtrip", "type": "Coroutine", "lineno": 37}, {"nodeid": "tests/api/test_yaml_roundtrip.py::test_automation_yaml_invalid_rejected", "type": "Coroutine", "lineno": 61}, {"nodeid": "tests/api/test_yaml_roundtrip.py::test_scene_yaml_content_type", "type": "Coroutine", "lineno": 73}, {"nodeid": "tests/api/test_yaml_roundtrip.py::test_scene_yaml_has_entries", "type": "Coroutine", "lineno": 84}, {"nodeid": "tests/api/test_yaml_roundtrip.py::test_scene_yaml_roundtrip", "type": "Coroutine", "lineno": 95}, {"nodeid": "tests/api/test_yaml_roundtrip.py::test_scene_yaml_invalid_rejected", "type": "Coroutine", "lineno": 117}]}, {"nodeid": "tests/api", "outcome": "passed", "result": [{"nodeid": "tests/api/test_api_misc_endpoints.py", "type": "Module"}, {"nodeid": "tests/api/test_api_root_config_format.py", "type": "Module"}, {"nodeid": "tests/api/test_area_label_lifecycle.py", "type": "Module"}, {"nodeid": "tests/api/test_auth_edge_cases.py", "type": "Module"}, {"nodeid": "tests/api/test_auth_token_lifecycle.py", "type": "Module"}, {"nodeid": "tests/api/test_automation_yaml_roundtrip.py", "type": "Module"}, {"nodeid": "tests/api/test_backup_error_log.py", "type": "Module"}, {"nodeid": "tests/api/test_backup_statistics_endpoints.py", "type": "Module"}, {"nodeid": "tests/api/test_check_config_endpoint.py", "type": "Module"}, {"nodeid": "tests/api/test_concurrent_operations.py", "type": "Module"}, {"nodeid": "tests/api/test_config_endpoints.py", "type": "Module"}, {"nodeid": "tests/api/test_config_yaml.py", "type": "Module"}, {"nodeid": "tests/api/test_device_registry_rest.py", "type": "Module"}, {"nodeid": "tests/api/test_discovery_advanced.py", "type": "Module"}, {"nodeid": "tests/api/test_history_logbook.py", "type": "Module"}, {"nodeid": "tests/api/test_logbook_global.py", "type": "Module"}, {"nodeid": "tests/api/test_mqtt_bridge_topics.py", "type": "Module"}, {"nodeid": "tests/api/test_mqtt_discovery.py", "type": "Module"}, {"nodeid": "tests/api/test_mqtt_entity_command_bridge.py", "type": "Module"}, {"nodeid": "tests/api/test_notification_lifecycle.py", "type": "Module"}, {"nodeid": "tests/api/test_notifications_rest.py", "type": "Module"}, {"nodeid": "tests/api/test_prometheus_metrics.py", "type": "Module"}, {"nodeid": "tests/api/test_recorder_history.py", "type": "Module"}, {"nodeid": "tests/api/test_rest_error_handling.py", "type": "Module"}, {"nodeid": "tests/api/test_rest_notification_endpoints.py", "type": "Module"}, {"nodeid": "tests/api/test_rest_service_arrays.py", "type": "Module"}, {"nodeid": "tests/api/test_rest_service_dispatch_patterns.py", "type": "Module"}, {"nodeid": "tests/api/test_rest_states_bulk_ops.py", "type": "Module"}, {"nodeid": "tests/api/test_rest_states_patterns.py", "type": "Module"}, {"nodeid": "tests/api/test_rest_template_endpoint.py", "type": "Module"}, {"nodeid": "tests/api/test_scene_config_api.py", "type": "Module"}, {"nodeid": "tests/api/test_scene_yaml_endpoints.py", "type": "Module"}, {"nodeid": "tests/api/test_search_and_registry.py", "type": "Module"}, {"nodeid": "tests/api/test_search_combined_filters.py", "type": "Module"}, {"nodeid": "tests/api/test_search_edge_cases.py", "type": "Module"}, {"nodeid": "tests/api/test_service_listing_format.py", "type": "Module"}, {"nodeid": "tests/api/test_sim_reload_config.py", "type": "Module"}, {"nodeid": "tests/api/test_sim_time_backup.py", "type": "Module"}, {"nodeid": "tests/api/test_state_search_extended.py", "type": "Module"}, {"nodeid": "tests/api/test_template_engine.py", "type": "Module"}, {"nodeid": "tests/api/test_template_state_functions.py", "type": "Module"}, {"nodeid": "tests/api/test_ws_comprehensive.py", "type": "Module"}, {"nodeid": "tests/api/test_ws_registries.py", "type": "Module"}, {"nodeid": "tests/api/test_ws_service_dispatch.py", "type": "Module"}, {"nodeid": "tests/api/test_ws_subscribe.py", "type": "Module"}, {"nodeid": "tests/api/test_ws_subscription_delivery.py", "type": "Module"}, {"nodeid": "tests/api/test_ws_template_render.py", "type": "Module"}, {"nodeid": "tests/api/test_yaml_roundtrip.py", "type": "Module"}]}, {"nodeid": "tests/automation/test_automation_api.py", "outcome": "passed", "result": [{"nodeid": "tests/automation/test_automation_api.py::test_automation_list_returns_list", "type": "Coroutine", "lineno": 15}, {"nodeid": "tests/automation/test_automation_api.py::test_automation_list_has_field[id]", "type": "Coroutine", "lineno": 27}, {"nodeid": "tests/automation/test_automation_api.py::test_automation_list_has_field[alias]", "type": "Coroutine", "lineno": 27}, {"nodeid": "tests/automation/test_automation_api.py::test_automation_list_has_field[enabled]", "type": "Coroutine", "lineno": 27}, {"nodeid": "tests/automation/test_automation_api.py::test_automation_list_has_field[mode]", "type": "Coroutine", "lineno": 27}, {"nodeid": "tests/automation/test_automation_api.py::test_automation_list_has_field[trigger_count]", "type": "Coroutine", "lineno": 27}, {"nodeid": "tests/automation/test_automation_api.py::test_automation_list_has_field[condition_count]", "type": "Coroutine", "lineno": 27}, {"nodeid": "tests/automation/test_automation_api.py::test_automation_list_has_field[action_count]", "type": "Coroutine", "lineno": 27}, {"nodeid": "tests/automation/test_automation_api.py::test_automation_list_has_field[description]", "type": "Coroutine", "lineno": 27}, {"nodeid": "tests/automation/test_automation_api.py::test_automation_list_has_id_and_alias", "type": "Coroutine", "lineno": 43}, {"nodeid": "tests/automation/test_automation_api.py::test_automation_list_has_counts", "type": "Coroutine", "lineno": 56}, {"nodeid": "tests/automation/test_automation_api.py::test_automation_list_has_mode", "type": "Coroutine", "lineno": 68}, {"nodeid": "tests/automation/test_automation_api.py::test_automation_yaml_read", "type": "Coroutine", "lineno": 81}, {"nodeid": "tests/automation/test_automation_api.py::test_scene_yaml_read", "type": "Coroutine", "lineno": 95}, {"nodeid": "tests/automation/test_automation_api.py::test_trigger_nonexistent_automation", "type": "Coroutine", "lineno": 108}, {"nodeid": "tests/automation/test_automation_api.py::test_trigger_automation_rest", "type": "Coroutine", "lineno": 120}, {"nodeid": "tests/automation/test_automation_api.py::test_trigger_increments_count", "type": "Coroutine", "lineno": 130}, {"nodeid": "tests/automation/test_automation_api.py::test_automation_has_last_triggered", "type": "Coroutine", "lineno": 146}, {"nodeid": "tests/automation/test_automation_api.py::test_trigger_ws", "type": "Coroutine", "lineno": 162}, {"nodeid": "tests/automation/test_automation_api.py::test_automation_turn_off_on_cycle", "type": "Coroutine", "lineno": 175}, {"nodeid": "tests/automation/test_automation_api.py::test_force_trigger_bypasses_disabled", "type": "Coroutine", "lineno": 196}, {"nodeid": "tests/automation/test_automation_api.py::test_automation_ids_unique", "type": "Coroutine", "lineno": 234}, {"nodeid": "tests/automation/test_automation_api.py::test_trigger_without_prefix", "type": "Coroutine", "lineno": 245}, {"nodeid": "tests/automation/test_automation_api.py::test_trigger_empty_entity_id", "type": "Coroutine", "lineno": 255}]}, {"nodeid": "tests/automation/test_automation_conditions.py", "outcome": "passed", "result": [{"nodeid": "tests/automation/test_automation_conditions.py::test_automation_turn_off", "type": "Coroutine", "lineno": 17}, {"nodeid": "tests/automation/test_automation_conditions.py::test_automation_turn_on", "type": "Coroutine", "lineno": 30}, {"nodeid": "tests/automation/test_automation_conditions.py::test_disabled_automation_not_triggered", "type": "Coroutine", "lineno": 42}, {"nodeid": "tests/automation/test_automation_conditions.py::test_trigger_existing_automation", "type": "Coroutine", "lineno": 63}, {"nodeid": "tests/automation/test_automation_conditions.py::test_automation_config_has_description", "type": "Coroutine", "lineno": 75}, {"nodeid": "tests/automation/test_automation_conditions.py::test_automation_config_has_last_triggered", "type": "Coroutine", "lineno": 86}, {"nodeid": "tests/automation/test_automation_conditions.py::test_automation_config_has_total_triggers", "type": "Coroutine", "lineno": 97}, {"nodeid": "tests/automation/test_automation_conditions.py::test_automation_reload", "type": "Coroutine", "lineno": 111}, {"nodeid": "tests/automation/test_automation_conditions.py::test_automation_reload_via_automation_endpoint", "type": "Coroutine", "lineno": 123}, {"nodeid": "tests/automation/test_automation_conditions.py::test_scene_config_list", "type": "Coroutine", "lineno": 137}, {"nodeid": "tests/automation/test_automation_conditions.py::test_scene_config_has_name", "type": "Coroutine", "lineno": 149}, {"nodeid": "tests/automation/test_automation_conditions.py::test_scene_config_has_entities", "type": "Coroutine", "lineno": 161}]}, {"nodeid": "tests/automation/test_automation_entity_state.py", "outcome": "passed", "result": [{"nodeid": "tests/automation/test_automation_entity_state.py::test_automation_entities_exist", "type": "Coroutine", "lineno": 14}, {"nodeid": "tests/automation/test_automation_entity_state.py::test_automation_entity_has_friendly_name", "type": "Coroutine", "lineno": 21}, {"nodeid": "tests/automation/test_automation_entity_state.py::test_automation_entity_state_on", "type": "Coroutine", "lineno": 31}, {"nodeid": "tests/automation/test_automation_entity_state.py::test_automation_config_has_fields", "type": "Coroutine", "lineno": 46}, {"nodeid": "tests/automation/test_automation_entity_state.py::test_automation_config_trigger_count", "type": "Coroutine", "lineno": 66}, {"nodeid": "tests/automation/test_automation_entity_state.py::test_automation_config_mode", "type": "Coroutine", "lineno": 78}, {"nodeid": "tests/automation/test_automation_entity_state.py::test_automation_disable_changes_state", "type": "Coroutine", "lineno": 89}, {"nodeid": "tests/automation/test_automation_entity_state.py::test_automation_config_enabled_tracks_state", "type": "Coroutine", "lineno": 110}, {"nodeid": "tests/automation/test_automation_entity_state.py::test_scene_entities_exist", "type": "Coroutine", "lineno": 144}, {"nodeid": "tests/automation/test_automation_entity_state.py::test_scene_config_api", "type": "Coroutine", "lineno": 151}, {"nodeid": "tests/automation/test_automation_entity_state.py::test_automation_total_triggers_counter", "type": "Coroutine", "lineno": 167}, {"nodeid": "tests/automation/test_automation_entity_state.py::test_automation_entity_default_on", "type": "Coroutine", "lineno": 182}, {"nodeid": "tests/automation/test_automation_entity_state.py::test_automation_entity_has_attributes", "type": "Coroutine", "lineno": 190}, {"nodeid": "tests/automation/test_automation_entity_state.py::test_automation_trigger_succeeds", "type": "Coroutine", "lineno": 200}, {"nodeid": "tests/automation/test_automation_entity_state.py::test_automation_trigger_increments_count", "type": "Coroutine", "lineno": 214}, {"nodeid": "tests/automation/test_automation_entity_state.py::test_automation_trigger_sets_last_triggered", "type": "Coroutine", "lineno": 238}]}, {"nodeid": "tests/automation/test_automation_execution.py", "outcome": "passed", "result": [{"nodeid": "tests/automation/test_automation_execution.py::test_automation_disable_sets_off", "type": "Coroutine", "lineno": 13}, {"nodeid": "tests/automation/test_automation_execution.py::test_force_trigger_executes_actions", "type": "Coroutine", "lineno": 31}, {"nodeid": "tests/automation/test_automation_execution.py::test_force_trigger_records_last_triggered", "type": "Coroutine", "lineno": 44}, {"nodeid": "tests/automation/test_automation_execution.py::test_force_trigger_increments_count", "type": "Coroutine", "lineno": 55}, {"nodeid": "tests/automation/test_automation_execution.py::test_reload_preserves_trigger_counts", "type": "Coroutine", "lineno": 72}, {"nodeid": "tests/automation/test_automation_execution.py::test_automations_info_endpoint", "type": "Coroutine", "lineno": 92}, {"nodeid": "tests/automation/test_automation_execution.py::test_automations_info_has_fields", "type": "Coroutine", "lineno": 104}, {"nodeid": "tests/automation/test_automation_execution.py::test_automations_info_trigger_counts", "type": "Coroutine", "lineno": 117}, {"nodeid": "tests/automation/test_automation_execution.py::test_state_trigger_fires_automation", "type": "Coroutine", "lineno": 132}, {"nodeid": "tests/automation/test_automation_execution.py::test_fire_event_triggers_automation", "type": "Coroutine", "lineno": 149}]}, {"nodeid": "tests/automation/test_automation_multi_entity_trigger.py", "outcome": "passed", "result": [{"nodeid": "tests/automation/test_automation_multi_entity_trigger.py::test_smoke_co_has_two_triggers", "type": "Coroutine", "lineno": 16}, {"nodeid": "tests/automation/test_automation_multi_entity_trigger.py::test_goodnight_has_event_trigger", "type": "Coroutine", "lineno": 27}, {"nodeid": "tests/automation/test_automation_multi_entity_trigger.py::test_lock_verification_has_1_trigger", "type": "Coroutine", "lineno": 38}, {"nodeid": "tests/automation/test_automation_multi_entity_trigger.py::test_lock_verification_has_or_condition", "type": "Coroutine", "lineno": 49}, {"nodeid": "tests/automation/test_automation_multi_entity_trigger.py::test_security_alert_has_condition", "type": "Coroutine", "lineno": 60}, {"nodeid": "tests/automation/test_automation_multi_entity_trigger.py::test_all_six_automations_loaded", "type": "Coroutine", "lineno": 73}, {"nodeid": "tests/automation/test_automation_multi_entity_trigger.py::test_all_automations_have_alias", "type": "Coroutine", "lineno": 88}, {"nodeid": "tests/automation/test_automation_multi_entity_trigger.py::test_all_automations_mode_single", "type": "Coroutine", "lineno": 99}, {"nodeid": "tests/automation/test_automation_multi_entity_trigger.py::test_all_automation_entities_exist", "type": "Coroutine", "lineno": 110}, {"nodeid": "tests/automation/test_automation_multi_entity_trigger.py::test_all_automation_entities_on", "type": "Coroutine", "lineno": 121}, {"nodeid": "tests/automation/test_automation_multi_entity_trigger.py::test_automation_toggle_disables", "type": "Coroutine", "lineno": 143}, {"nodeid": "tests/automation/test_automation_multi_entity_trigger.py::test_automation_toggle_roundtrip", "type": "Coroutine", "lineno": 163}]}, {"nodeid": "tests/automation/test_condition_edge_cases.py", "outcome": "passed", "result": [{"nodeid": "tests/automation/test_condition_edge_cases.py::test_disabled_automation_no_trigger", "type": "Coroutine", "lineno": 16}, {"nodeid": "tests/automation/test_condition_edge_cases.py::test_toggle_automation_twice_re_enables", "type": "Coroutine", "lineno": 45}, {"nodeid": "tests/automation/test_condition_edge_cases.py::test_ws_force_trigger", "type": "Coroutine", "lineno": 71}, {"nodeid": "tests/automation/test_condition_edge_cases.py::test_ws_scene_turn_on", "type": "Coroutine", "lineno": 88}, {"nodeid": "tests/automation/test_condition_edge_cases.py::test_ws_service_call_standard", "type": "Coroutine", "lineno": 105}, {"nodeid": "tests/automation/test_condition_edge_cases.py::test_ws_service_call_with_target", "type": "Coroutine", "lineno": 119}, {"nodeid": "tests/automation/test_condition_edge_cases.py::test_ws_service_call_multiple_entities", "type": "Coroutine", "lineno": 134}, {"nodeid": "tests/automation/test_condition_edge_cases.py::test_ws_notification_create_and_list", "type": "Coroutine", "lineno": 153}, {"nodeid": "tests/automation/test_condition_edge_cases.py::test_ws_notification_dismiss", "type": "Coroutine", "lineno": 173}, {"nodeid": "tests/automation/test_condition_edge_cases.py::test_ws_notification_dismiss_all", "type": "Coroutine", "lineno": 196}, {"nodeid": "tests/automation/test_condition_edge_cases.py::test_automation_info_has_mode", "type": "Coroutine", "lineno": 209}, {"nodeid": "tests/automation/test_condition_edge_cases.py::test_automation_info_has_counts", "type": "Coroutine", "lineno": 221}]}, {"nodeid": "tests/automation/test_demo_automation_morning_sunset.py", "outcome": "passed", "result": [{"nodeid": "tests/automation/test_demo_automation_morning_sunset.py::test_morning_force_trigger_turns_on_bedroom", "type": "Coroutine", "lineno": 27}, {"nodeid": "tests/automation/test_demo_automation_morning_sunset.py::test_morning_force_trigger_sets_brightness_51", "type": "Coroutine", "lineno": 38}, {"nodeid": "tests/automation/test_demo_automation_morning_sunset.py::test_morning_force_trigger_sets_color_temp", "type": "Coroutine", "lineno": 49}, {"nodeid": "tests/automation/test_demo_automation_morning_sunset.py::test_morning_force_trigger_sets_thermostat_70", "type": "Coroutine", "lineno": 60}, {"nodeid": "tests/automation/test_demo_automation_morning_sunset.py::test_morning_force_trigger_turns_on_coffee", "type": "Coroutine", "lineno": 71}, {"nodeid": "tests/automation/test_demo_automation_morning_sunset.py::test_morning_entity_state_on", "type": "Coroutine", "lineno": 82}, {"nodeid": "tests/automation/test_demo_automation_morning_sunset.py::test_morning_has_time_trigger", "type": "Coroutine", "lineno": 89}, {"nodeid": "tests/automation/test_demo_automation_morning_sunset.py::test_morning_has_3_actions", "type": "Coroutine", "lineno": 100}, {"nodeid": "tests/automation/test_demo_automation_morning_sunset.py::test_sunset_force_trigger_turns_on_porch", "type": "Coroutine", "lineno": 124}, {"nodeid": "tests/automation/test_demo_automation_morning_sunset.py::test_sunset_force_trigger_turns_on_pathway", "type": "Coroutine", "lineno": 135}, {"nodeid": "tests/automation/test_demo_automation_morning_sunset.py::test_sunset_force_trigger_activates_evening_scene", "type": "Coroutine", "lineno": 146}, {"nodeid": "tests/automation/test_demo_automation_morning_sunset.py::test_sunset_has_sun_trigger", "type": "Coroutine", "lineno": 158}, {"nodeid": "tests/automation/test_demo_automation_morning_sunset.py::test_sunset_has_2_actions", "type": "Coroutine", "lineno": 169}]}, {"nodeid": "tests/automation/test_demo_automation_security.py", "outcome": "passed", "result": [{"nodeid": "tests/automation/test_demo_automation_security.py::test_security_alert_fires_when_armed_away", "type": "Coroutine", "lineno": 26}, {"nodeid": "tests/automation/test_demo_automation_security.py::test_security_alert_blocked_when_armed_home", "type": "Coroutine", "lineno": 41}, {"nodeid": "tests/automation/test_demo_automation_security.py::test_security_alert_blocked_when_disarmed", "type": "Coroutine", "lineno": 57}, {"nodeid": "tests/automation/test_demo_automation_security.py::test_lock_verify_fires_when_door_unlocked", "type": "Coroutine", "lineno": 86}, {"nodeid": "tests/automation/test_demo_automation_security.py::test_lock_verify_fires_when_back_door_unlocked", "type": "Coroutine", "lineno": 106}, {"nodeid": "tests/automation/test_demo_automation_security.py::test_lock_verify_skipped_when_all_locked", "type": "Coroutine", "lineno": 124}, {"nodeid": "tests/automation/test_demo_automation_security.py::test_goodnight_force_trigger_turns_off_lights", "type": "Coroutine", "lineno": 166}, {"nodeid": "tests/automation/test_demo_automation_security.py::test_goodnight_force_trigger_locks_doors", "type": "Coroutine", "lineno": 179}, {"nodeid": "tests/automation/test_demo_automation_security.py::test_goodnight_force_trigger_arms_night", "type": "Coroutine", "lineno": 191}, {"nodeid": "tests/automation/test_demo_automation_security.py::test_goodnight_force_trigger_lowers_thermostat", "type": "Coroutine", "lineno": 203}, {"nodeid": "tests/automation/test_demo_automation_security.py::test_goodnight_force_trigger_stops_media", "type": "Coroutine", "lineno": 215}, {"nodeid": "tests/automation/test_demo_automation_security.py::test_goodnight_event_trigger_fires", "type": "Coroutine", "lineno": 227}]}, {"nodeid": "tests/automation/test_demo_automation_smoke_co.py", "outcome": "passed", "result": [{"nodeid": "tests/automation/test_demo_automation_smoke_co.py::test_smoke_trigger_unlocks_front_door", "type": "Coroutine", "lineno": 43}, {"nodeid": "tests/automation/test_demo_automation_smoke_co.py::test_smoke_trigger_unlocks_back_door", "type": "Coroutine", "lineno": 52}, {"nodeid": "tests/automation/test_demo_automation_smoke_co.py::test_smoke_trigger_turns_on_all_lights", "type": "Coroutine", "lineno": 61}, {"nodeid": "tests/automation/test_demo_automation_smoke_co.py::test_smoke_trigger_sets_brightness_255", "type": "Coroutine", "lineno": 74}, {"nodeid": "tests/automation/test_demo_automation_smoke_co.py::test_smoke_trigger_disarms_alarm", "type": "Coroutine", "lineno": 83}, {"nodeid": "tests/automation/test_demo_automation_smoke_co.py::test_co_trigger_also_fires_emergency", "type": "Coroutine", "lineno": 94}, {"nodeid": "tests/automation/test_demo_automation_smoke_co.py::test_co_trigger_turns_on_lights", "type": "Coroutine", "lineno": 103}, {"nodeid": "tests/automation/test_demo_automation_smoke_co.py::test_force_trigger_executes_all_actions", "type": "Coroutine", "lineno": 114}, {"nodeid": "tests/automation/test_demo_automation_smoke_co.py::test_force_trigger_updates_metadata", "type": "Coroutine", "lineno": 126}, {"nodeid": "tests/automation/test_demo_automation_smoke_co.py::test_disabled_emergency_does_not_fire", "type": "Coroutine", "lineno": 143}, {"nodeid": "tests/automation/test_demo_automation_smoke_co.py::test_re_enabled_emergency_fires_again", "type": "Coroutine", "lineno": 163}]}, {"nodeid": "tests/automation/test_lifecycle.py", "outcome": "passed", "result": [{"nodeid": "tests/automation/test_lifecycle.py::test_list_automations", "type": "Coroutine", "lineno": 14}, {"nodeid": "tests/automation/test_lifecycle.py::test_automation_info_fields", "type": "Coroutine", "lineno": 30}, {"nodeid": "tests/automation/test_lifecycle.py::test_automation_disable", "type": "Coroutine", "lineno": 48}, {"nodeid": "tests/automation/test_lifecycle.py::test_automation_enable", "type": "Coroutine", "lineno": 58}, {"nodeid": "tests/automation/test_lifecycle.py::test_automation_toggle", "type": "Coroutine", "lineno": 73}, {"nodeid": "tests/automation/test_lifecycle.py::test_disabled_automation_does_not_fire", "type": "Coroutine", "lineno": 99}, {"nodeid": "tests/automation/test_lifecycle.py::test_reload_automations", "type": "Coroutine", "lineno": 128}, {"nodeid": "tests/automation/test_lifecycle.py::test_reload_via_automation_path", "type": "Coroutine", "lineno": 140}, {"nodeid": "tests/automation/test_lifecycle.py::test_force_trigger_sets_last_triggered", "type": "Coroutine", "lineno": 153}, {"nodeid": "tests/automation/test_lifecycle.py::test_trigger_count_increments", "type": "Coroutine", "lineno": 184}]}, {"nodeid": "tests/automation/test_state_trigger_behavior.py", "outcome": "passed", "result": [{"nodeid": "tests/automation/test_state_trigger_behavior.py::test_smoke_trigger_unlocks_door", "type": "Coroutine", "lineno": 13}, {"nodeid": "tests/automation/test_state_trigger_behavior.py::test_non_matching_state_no_trigger", "type": "Coroutine", "lineno": 28}, {"nodeid": "tests/automation/test_state_trigger_behavior.py::test_automation_entity_tracks_state", "type": "Coroutine", "lineno": 42}, {"nodeid": "tests/automation/test_state_trigger_behavior.py::test_trigger_updates_last_triggered", "type": "Coroutine", "lineno": 49}, {"nodeid": "tests/automation/test_state_trigger_behavior.py::test_disabled_automation_state", "type": "Coroutine", "lineno": 65}, {"nodeid": "tests/automation/test_state_trigger_behavior.py::test_multiple_automations_exist", "type": "Coroutine", "lineno": 86}, {"nodeid": "tests/automation/test_state_trigger_behavior.py::test_automation_friendly_name", "type": "Coroutine", "lineno": 97}]}, {"nodeid": "tests/automation", "outcome": "passed", "result": [{"nodeid": "tests/automation/test_automation_api.py", "type": "Module"}, {"nodeid": "tests/automation/test_automation_conditions.py", "type": "Module"}, {"nodeid": "tests/automation/test_automation_entity_state.py", "type": "Module"}, {"nodeid": "tests/automation/test_automation_execution.py", "type": "Module"}, {"nodeid": "tests/automation/test_automation_multi_entity_trigger.py", "type": "Module"}, {"nodeid": "tests/automation/test_condition_edge_cases.py", "type": "Module"}, {"nodeid": "tests/automation/test_demo_automation_morning_sunset.py", "type": "Module"}, {"nodeid": "tests/automation/test_demo_automation_security.py", "type": "Module"}, {"nodeid": "tests/automation/test_demo_automation_smoke_co.py", "type": "Module"}, {"nodeid": "tests/automation/test_lifecycle.py", "type": "Module"}, {"nodeid": "tests/automation/test_state_trigger_behavior.py", "type": "Module"}]}, {"nodeid": "tests/core/test_concurrent_operations.py", "outcome": "passed", "result": [{"nodeid": "tests/core/test_concurrent_operations.py::test_concurrent_state_sets", "type": "Coroutine", "lineno": 14}, {"nodeid": "tests/core/test_concurrent_operations.py::test_concurrent_reads", "type": "Coroutine", "lineno": 31}, {"nodeid": "tests/core/test_concurrent_operations.py::test_concurrent_same_entity", "type": "Coroutine", "lineno": 45}, {"nodeid": "tests/core/test_concurrent_operations.py::test_concurrent_service_calls", "type": "Coroutine", "lineno": 60}, {"nodeid": "tests/core/test_concurrent_operations.py::test_concurrent_mixed_operations", "type": "Coroutine", "lineno": 83}, {"nodeid": "tests/core/test_concurrent_operations.py::test_concurrent_get_states", "type": "Coroutine", "lineno": 104}, {"nodeid": "tests/core/test_concurrent_operations.py::test_concurrent_search", "type": "Coroutine", "lineno": 119}, {"nodeid": "tests/core/test_concurrent_operations.py::test_concurrent_template_renders", "type": "Coroutine", "lineno": 137}]}, {"nodeid": "tests/core/test_concurrent_state_ops.py", "outcome": "passed", "result": [{"nodeid": "tests/core/test_concurrent_state_ops.py::test_concurrent_writes_same_entity", "type": "Coroutine", "lineno": 15}, {"nodeid": "tests/core/test_concurrent_state_ops.py::test_concurrent_writes_different_entities", "type": "Coroutine", "lineno": 32}, {"nodeid": "tests/core/test_concurrent_state_ops.py::test_rapid_state_toggle", "type": "Coroutine", "lineno": 50}, {"nodeid": "tests/core/test_concurrent_state_ops.py::test_concurrent_create_delete", "type": "Coroutine", "lineno": 64}, {"nodeid": "tests/core/test_concurrent_state_ops.py::test_concurrent_attribute_updates", "type": "Coroutine", "lineno": 91}, {"nodeid": "tests/core/test_concurrent_state_ops.py::test_many_entities_bulk_create", "type": "Coroutine", "lineno": 112}, {"nodeid": "tests/core/test_concurrent_state_ops.py::test_concurrent_service_same_entity", "type": "Coroutine", "lineno": 128}]}, {"nodeid": "tests/core/test_mqtt_broker_lifecycle.py", "outcome": "passed", "result": [{"nodeid": "tests/core/test_mqtt_broker_lifecycle.py::test_broker_accepts_connection", "type": "Coroutine", "lineno": 27}, {"nodeid": "tests/core/test_mqtt_broker_lifecycle.py::test_publish_and_subscribe", "type": "Coroutine", "lineno": 35}, {"nodeid": "tests/core/test_mqtt_broker_lifecycle.py::test_retained_message_delivery", "type": "Coroutine", "lineno": 67}, {"nodeid": "tests/core/test_mqtt_broker_lifecycle.py::test_wildcard_subscription", "type": "Coroutine", "lineno": 98}, {"nodeid": "tests/core/test_mqtt_broker_lifecycle.py::test_multiple_clients_concurrent", "type": "Coroutine", "lineno": 130}, {"nodeid": "tests/core/test_mqtt_broker_lifecycle.py::test_home_topic_state_bridge", "type": "Coroutine", "lineno": 164}, {"nodeid": "tests/core/test_mqtt_broker_lifecycle.py::test_non_home_topic_no_entity", "type": "Coroutine", "lineno": 180}, {"nodeid": "tests/core/test_mqtt_broker_lifecycle.py::test_disconnect_reconnect", "type": "Coroutine", "lineno": 195}, {"nodeid": "tests/core/test_mqtt_broker_lifecycle.py::test_json_payload_publish", "type": "Coroutine", "lineno": 212}, {"nodeid": "tests/core/test_mqtt_broker_lifecycle.py::test_empty_payload_publish", "type": "Coroutine", "lineno": 244}]}, {"nodeid": "tests/core/test_multi_entity_service_calls.py", "outcome": "passed", "result": [{"nodeid": "tests/core/test_multi_entity_service_calls.py::test_service_call_array_entity_ids", "type": "Coroutine", "lineno": 14}, {"nodeid": "tests/core/test_multi_entity_service_calls.py::test_service_call_single_entity_id_string", "type": "Coroutine", "lineno": 33}, {"nodeid": "tests/core/test_multi_entity_service_calls.py::test_service_call_returns_changed_states", "type": "Coroutine", "lineno": 50}, {"nodeid": "tests/core/test_multi_entity_service_calls.py::test_service_call_empty_array", "type": "Coroutine", "lineno": 68}, {"nodeid": "tests/core/test_multi_entity_service_calls.py::test_service_call_preserves_existing_attributes", "type": "Coroutine", "lineno": 82}, {"nodeid": "tests/core/test_multi_entity_service_calls.py::test_service_call_no_handler_logs_warning", "type": "Coroutine", "lineno": 101}, {"nodeid": "tests/core/test_multi_entity_service_calls.py::test_toggle_multiple_entities_mixed_states", "type": "Coroutine", "lineno": 119}, {"nodeid": "tests/core/test_multi_entity_service_calls.py::test_service_call_ten_entities", "type": "Coroutine", "lineno": 139}]}, {"nodeid": "tests/core/test_service_registry_consistency.py", "outcome": "passed", "result": [{"nodeid": "tests/core/test_service_registry_consistency.py::test_services_list_is_array", "type": "Coroutine", "lineno": 14}, {"nodeid": "tests/core/test_service_registry_consistency.py::test_services_list_has_domains", "type": "Coroutine", "lineno": 25}, {"nodeid": "tests/core/test_service_registry_consistency.py::test_services_entry_has_services_map", "type": "Coroutine", "lineno": 37}, {"nodeid": "tests/core/test_service_registry_consistency.py::test_light_services_registered", "type": "Coroutine", "lineno": 50}, {"nodeid": "tests/core/test_service_registry_consistency.py::test_climate_services_registered", "type": "Coroutine", "lineno": 64}, {"nodeid": "tests/core/test_service_registry_consistency.py::test_service_entry_has_description", "type": "Coroutine", "lineno": 77}, {"nodeid": "tests/core/test_service_registry_consistency.py::test_fallback_turn_on_unknown_domain", "type": "Coroutine", "lineno": 89}, {"nodeid": "tests/core/test_service_registry_consistency.py::test_fallback_turn_off_unknown_domain", "type": "Coroutine", "lineno": 101}, {"nodeid": "tests/core/test_service_registry_consistency.py::test_fallback_toggle_unknown_domain", "type": "Coroutine", "lineno": 113}, {"nodeid": "tests/core/test_service_registry_consistency.py::test_unknown_service_no_crash", "type": "Coroutine", "lineno": 125}, {"nodeid": "tests/core/test_service_registry_consistency.py::test_service_call_empty_entity_list", "type": "Coroutine", "lineno": 136}, {"nodeid": "tests/core/test_service_registry_consistency.py::test_rest_and_ws_services_match", "type": "Coroutine", "lineno": 146}, {"nodeid": "tests/core/test_service_registry_consistency.py::test_services_sorted_by_domain", "type": "Coroutine", "lineno": 160}]}, {"nodeid": "tests/core/test_state_delete_recreate.py", "outcome": "passed", "result": [{"nodeid": "tests/core/test_state_delete_recreate.py::test_delete_entity_returns_200", "type": "Coroutine", "lineno": 14}, {"nodeid": "tests/core/test_state_delete_recreate.py::test_deleted_entity_gone_from_list", "type": "Coroutine", "lineno": 27}, {"nodeid": "tests/core/test_state_delete_recreate.py::test_get_nonexistent_entity_404", "type": "Coroutine", "lineno": 46}, {"nodeid": "tests/core/test_state_delete_recreate.py::test_recreate_after_delete", "type": "Coroutine", "lineno": 55}, {"nodeid": "tests/core/test_state_delete_recreate.py::test_recreated_entity_fresh_context", "type": "Coroutine", "lineno": 71}, {"nodeid": "tests/core/test_state_delete_recreate.py::test_delete_preserves_other_entities", "type": "Coroutine", "lineno": 92}, {"nodeid": "tests/core/test_state_delete_recreate.py::test_delete_entity_with_attributes", "type": "Coroutine", "lineno": 110}, {"nodeid": "tests/core/test_state_delete_recreate.py::test_recreated_entity_starts_clean", "type": "Coroutine", "lineno": 129}, {"nodeid": "tests/core/test_state_delete_recreate.py::test_multiple_deletes_idempotent", "type": "Coroutine", "lineno": 146}]}, {"nodeid": "tests/core/test_state_machine.py", "outcome": "passed", "result": [{"nodeid": "tests/core/test_state_machine.py::test_api_running", "type": "Coroutine", "lineno": 17}, {"nodeid": "tests/core/test_state_machine.py::test_get_states_returns_list", "type": "Coroutine", "lineno": 23}, {"nodeid": "tests/core/test_state_machine.py::test_set_and_get_state", "type": "Coroutine", "lineno": 29}, {"nodeid": "tests/core/test_state_machine.py::test_set_state_creates_entity", "type": "Coroutine", "lineno": 42}, {"nodeid": "tests/core/test_state_machine.py::test_set_state_updates_existing", "type": "Coroutine", "lineno": 50}, {"nodeid": "tests/core/test_state_machine.py::test_get_nonexistent_returns_404", "type": "Coroutine", "lineno": 58}, {"nodeid": "tests/core/test_state_machine.py::test_state_has_timestamps", "type": "Coroutine", "lineno": 64}, {"nodeid": "tests/core/test_state_machine.py::test_last_changed_updates_on_value_change", "type": "Coroutine", "lineno": 73}, {"nodeid": "tests/core/test_state_machine.py::test_last_changed_stable_on_same_value", "type": "Coroutine", "lineno": 87}, {"nodeid": "tests/core/test_state_machine.py::test_last_updated_changes_on_attribute_change", "type": "Coroutine", "lineno": 100}, {"nodeid": "tests/core/test_state_machine.py::test_context_id_unique_per_update", "type": "Coroutine", "lineno": 113}, {"nodeid": "tests/core/test_state_machine.py::test_empty_attributes_default", "type": "Coroutine", "lineno": 121}, {"nodeid": "tests/core/test_state_machine.py::test_attributes_merge_replaced", "type": "Coroutine", "lineno": 128}, {"nodeid": "tests/core/test_state_machine.py::test_entity_id_format", "type": "Coroutine", "lineno": 137}, {"nodeid": "tests/core/test_state_machine.py::test_state_is_string", "type": "Coroutine", "lineno": 144}, {"nodeid": "tests/core/test_state_machine.py::test_concurrent_writes", "type": "Coroutine", "lineno": 152}]}, {"nodeid": "tests/core/test_state_machine_edge_cases.py", "outcome": "passed", "result": [{"nodeid": "tests/core/test_state_machine_edge_cases.py::test_state_value_edge_cases[-empty]", "type": "Coroutine", "lineno": 18}, {"nodeid": "tests/core/test_state_machine_edge_cases.py::test_state_value_edge_cases[42.5-numeric]", "type": "Coroutine", "lineno": 18}, {"nodeid": "tests/core/test_state_machine_edge_cases.py::test_state_value_edge_cases[xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx-long]", "type": "Coroutine", "lineno": 18}, {"nodeid": "tests/core/test_state_machine_edge_cases.py::test_state_value_edge_cases[xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx-very_long]", "type": "Coroutine", "lineno": 18}, {"nodeid": "tests/core/test_state_machine_edge_cases.py::test_state_value_edge_cases[23\\xb0C with wind-unicode]", "type": "Coroutine", "lineno": 18}, {"nodeid": "tests/core/test_state_machine_edge_cases.py::test_state_value_edge_cases[\\u6e29\\u5ea6-cjk]", "type": "Coroutine", "lineno": 18}, {"nodeid": "tests/core/test_state_machine_edge_cases.py::test_state_value_edge_cases[on/off <test> & 'value'-special_chars]", "type": "Coroutine", "lineno": 18}, {"nodeid": "tests/core/test_state_machine_edge_cases.py::test_state_value_edge_cases[He said \"hello\"-quotes]", "type": "Coroutine", "lineno": 18}, {"nodeid": "tests/core/test_state_machine_edge_cases.py::test_state_value_edge_cases[line1\\nline2-newlines]", "type": "Coroutine", "lineno": 18}, {"nodeid": "tests/core/test_state_machine_edge_cases.py::test_state_value_edge_cases[path\\\\to\\\\file-backslashes]", "type": "Coroutine", "lineno": 18}, {"nodeid": "tests/core/test_state_machine_edge_cases.py::test_state_value_edge_cases[-273.15-negative]", "type": "Coroutine", "lineno": 18}, {"nodeid": "tests/core/test_state_machine_edge_cases.py::test_state_value_edge_cases[1.23e10-scientific]", "type": "Coroutine", "lineno": 18}, {"nodeid": "tests/core/test_state_machine_edge_cases.py::test_state_value_edge_cases[   -whitespace]", "type": "Coroutine", "lineno": 18}, {"nodeid": "tests/core/test_state_machine_edge_cases.py::test_state_value_edge_cases[x-single_char]", "type": "Coroutine", "lineno": 18}, {"nodeid": "tests/core/test_state_machine_edge_cases.py::test_state_value_edge_cases[0-zero]", "type": "Coroutine", "lineno": 18}, {"nodeid": "tests/core/test_state_machine_edge_cases.py::test_unicode_attribute_value", "type": "Coroutine", "lineno": 45}, {"nodeid": "tests/core/test_state_machine_edge_cases.py::test_nested_attribute_values", "type": "Coroutine", "lineno": 56}, {"nodeid": "tests/core/test_state_machine_edge_cases.py::test_boolean_attribute_values", "type": "Coroutine", "lineno": 70}, {"nodeid": "tests/core/test_state_machine_edge_cases.py::test_null_attribute_value", "type": "Coroutine", "lineno": 81}, {"nodeid": "tests/core/test_state_machine_edge_cases.py::test_rapid_updates_last_wins", "type": "Coroutine", "lineno": 91}, {"nodeid": "tests/core/test_state_machine_edge_cases.py::test_many_attributes", "type": "Coroutine", "lineno": 103}, {"nodeid": "tests/core/test_state_machine_edge_cases.py::test_entity_id_variations[123abc-numbers_in_name]", "type": "Coroutine", "lineno": 118}, {"nodeid": "tests/core/test_state_machine_edge_cases.py::test_entity_id_variations[a_b_c_d-underscores]", "type": "Coroutine", "lineno": 118}, {"nodeid": "tests/core/test_state_machine_edge_cases.py::test_unicode_cjk_attribute", "type": "Coroutine", "lineno": 134}, {"nodeid": "tests/core/test_state_machine_edge_cases.py::test_overwrite_replaces_state", "type": "Coroutine", "lineno": 146}, {"nodeid": "tests/core/test_state_machine_edge_cases.py::test_overwrite_replaces_attributes", "type": "Coroutine", "lineno": 156}, {"nodeid": "tests/core/test_state_machine_edge_cases.py::test_overwrite_empty_attrs_clears", "type": "Coroutine", "lineno": 168}, {"nodeid": "tests/core/test_state_machine_edge_cases.py::test_get_all_contains_created_entity", "type": "Coroutine", "lineno": 181}, {"nodeid": "tests/core/test_state_machine_edge_cases.py::test_attribute_numeric_type_preserved[42-integer]", "type": "Coroutine", "lineno": 195}, {"nodeid": "tests/core/test_state_machine_edge_cases.py::test_attribute_numeric_type_preserved[72.5-float]", "type": "Coroutine", "lineno": 195}, {"nodeid": "tests/core/test_state_machine_edge_cases.py::test_overwrite_preserves_entity_id", "type": "Coroutine", "lineno": 211}, {"nodeid": "tests/core/test_state_machine_edge_cases.py::test_timestamps_advance_on_state_update", "type": "Coroutine", "lineno": 224}]}, {"nodeid": "tests/core/test_state_operations.py", "outcome": "passed", "result": [{"nodeid": "tests/core/test_state_operations.py::test_set_state_returns_full_entity", "type": "Coroutine", "lineno": 16}, {"nodeid": "tests/core/test_state_operations.py::test_set_state_preserves_existing_attrs", "type": "Coroutine", "lineno": 24}, {"nodeid": "tests/core/test_state_operations.py::test_get_state_returns_none_for_missing", "type": "Coroutine", "lineno": 34}, {"nodeid": "tests/core/test_state_operations.py::test_get_all_states_is_list", "type": "Coroutine", "lineno": 40}, {"nodeid": "tests/core/test_state_operations.py::test_set_state_with_empty_attrs", "type": "Coroutine", "lineno": 48}, {"nodeid": "tests/core/test_state_operations.py::test_set_state_with_null_like_value", "type": "Coroutine", "lineno": 55}, {"nodeid": "tests/core/test_state_operations.py::test_context_id_present", "type": "Coroutine", "lineno": 63}, {"nodeid": "tests/core/test_state_operations.py::test_many_entities_created", "type": "Coroutine", "lineno": 74}, {"nodeid": "tests/core/test_state_operations.py::test_concurrent_different_entities", "type": "Coroutine", "lineno": 82}, {"nodeid": "tests/core/test_state_operations.py::test_delete_and_verify_absent", "type": "Coroutine", "lineno": 96}, {"nodeid": "tests/core/test_state_operations.py::test_state_numeric_string", "type": "Coroutine", "lineno": 115}, {"nodeid": "tests/core/test_state_operations.py::test_state_long_value", "type": "Coroutine", "lineno": 121}, {"nodeid": "tests/core/test_state_operations.py::test_state_special_chars", "type": "Coroutine", "lineno": 128}, {"nodeid": "tests/core/test_state_operations.py::test_attribute_nested_object", "type": "Coroutine", "lineno": 134}, {"nodeid": "tests/core/test_state_operations.py::test_attribute_array_value", "type": "Coroutine", "lineno": 143}]}, {"nodeid": "tests/core/test_state_timestamp_semantics.py", "outcome": "passed", "result": [{"nodeid": "tests/core/test_state_timestamp_semantics.py::test_first_set_timestamps_all_equal", "type": "Coroutine", "lineno": 14}, {"nodeid": "tests/core/test_state_timestamp_semantics.py::test_same_state_last_changed_stable", "type": "Coroutine", "lineno": 25}, {"nodeid": "tests/core/test_state_timestamp_semantics.py::test_different_state_last_changed_advances", "type": "Coroutine", "lineno": 41}, {"nodeid": "tests/core/test_state_timestamp_semantics.py::test_last_reported_always_advances", "type": "Coroutine", "lineno": 57}, {"nodeid": "tests/core/test_state_timestamp_semantics.py::test_attribute_only_change_last_updated_advances", "type": "Coroutine", "lineno": 73}, {"nodeid": "tests/core/test_state_timestamp_semantics.py::test_same_state_same_attrs_last_updated_stable", "type": "Coroutine", "lineno": 91}, {"nodeid": "tests/core/test_state_timestamp_semantics.py::test_context_has_uuid_format", "type": "Coroutine", "lineno": 107}, {"nodeid": "tests/core/test_state_timestamp_semantics.py::test_context_id_has_dashes", "type": "Coroutine", "lineno": 119}, {"nodeid": "tests/core/test_state_timestamp_semantics.py::test_context_changes_on_each_set", "type": "Coroutine", "lineno": 130}, {"nodeid": "tests/core/test_state_timestamp_semantics.py::test_state_change_event_via_ws", "type": "Coroutine", "lineno": 143}, {"nodeid": "tests/core/test_state_timestamp_semantics.py::test_old_state_none_on_first_set", "type": "Coroutine", "lineno": 174}, {"nodeid": "tests/core/test_state_timestamp_semantics.py::test_timestamps_are_iso8601", "type": "Coroutine", "lineno": 202}, {"nodeid": "tests/core/test_state_timestamp_semantics.py::test_entity_count_increases", "type": "Coroutine", "lineno": 218}, {"nodeid": "tests/core/test_state_timestamp_semantics.py::test_delete_entity_decreases_count", "type": "Coroutine", "lineno": 227}, {"nodeid": "tests/core/test_state_timestamp_semantics.py::test_entity_id_in_state", "type": "Coroutine", "lineno": 245}, {"nodeid": "tests/core/test_state_timestamp_semantics.py::test_state_value_is_string", "type": "Coroutine", "lineno": 254}, {"nodeid": "tests/core/test_state_timestamp_semantics.py::test_attributes_default_empty", "type": "Coroutine", "lineno": 267}, {"nodeid": "tests/core/test_state_timestamp_semantics.py::test_attributes_preserved_on_state_change", "type": "Coroutine", "lineno": 276}, {"nodeid": "tests/core/test_state_timestamp_semantics.py::test_rapid_updates_maintain_ordering", "type": "Coroutine", "lineno": 291}, {"nodeid": "tests/core/test_state_timestamp_semantics.py::test_multiple_entities_independent_timestamps", "type": "Coroutine", "lineno": 305}]}, {"nodeid": "tests/core/test_template_state_functions.py", "outcome": "passed", "result": [{"nodeid": "tests/core/test_template_state_functions.py::test_states_returns_current_value", "type": "Coroutine", "lineno": 28}, {"nodeid": "tests/core/test_template_state_functions.py::test_states_unknown_entity", "type": "Coroutine", "lineno": 38}, {"nodeid": "tests/core/test_template_state_functions.py::test_states_in_arithmetic", "type": "Coroutine", "lineno": 44}, {"nodeid": "tests/core/test_template_state_functions.py::test_is_state_true", "type": "Coroutine", "lineno": 56}, {"nodeid": "tests/core/test_template_state_functions.py::test_is_state_false", "type": "Coroutine", "lineno": 66}, {"nodeid": "tests/core/test_template_state_functions.py::test_is_state_nonexistent", "type": "Coroutine", "lineno": 76}, {"nodeid": "tests/core/test_template_state_functions.py::test_state_attr_returns_value", "type": "Coroutine", "lineno": 84}, {"nodeid": "tests/core/test_template_state_functions.py::test_state_attr_friendly_name", "type": "Coroutine", "lineno": 94}, {"nodeid": "tests/core/test_template_state_functions.py::test_state_attr_missing", "type": "Coroutine", "lineno": 104}, {"nodeid": "tests/core/test_template_state_functions.py::test_now_returns_timestamp", "type": "Coroutine", "lineno": 116}, {"nodeid": "tests/core/test_template_state_functions.py::test_states_with_round_filter", "type": "Coroutine", "lineno": 125}, {"nodeid": "tests/core/test_template_state_functions.py::test_states_with_default_filter", "type": "Coroutine", "lineno": 135}, {"nodeid": "tests/core/test_template_state_functions.py::test_conditional_template", "type": "Coroutine", "lineno": 146}, {"nodeid": "tests/core/test_template_state_functions.py::test_template_with_int_global_function", "type": "Coroutine", "lineno": 159}, {"nodeid": "tests/core/test_template_state_functions.py::test_template_with_bool_global_function", "type": "Coroutine", "lineno": 169}]}, {"nodeid": "tests/core", "outcome": "passed", "result": [{"nodeid": "tests/core/test_concurrent_operations.py", "type": "Module"}, {"nodeid": "tests/core/test_concurrent_state_ops.py", "type": "Module"}, {"nodeid": "tests/core/test_mqtt_broker_lifecycle.py", "type": "Module"}, {"nodeid": "tests/core/test_multi_entity_service_calls.py", "type": "Module"}, {"nodeid": "tests/core/test_service_registry_consistency.py", "type": "Module"}, {"nodeid": "tests/core/test_state_delete_recreate.py", "type": "Module"}, {"nodeid": "tests/core/test_state_machine.py", "type": "Module"}, {"nodeid": "tests/core/test_state_machine_edge_cases.py", "type": "Module"}, {"nodeid": "tests/core/test_state_operations.py", "type": "Module"}, {"nodeid": "tests/core/test_state_timestamp_semantics.py", "type": "Module"}, {"nodeid": "tests/core/test_template_state_functions.py", "type": "Module"}]}, {"nodeid": "tests/entity/test_alarm_climate_water_heater.py", "outcome": "passed", "result": [{"nodeid": "tests/entity/test_alarm_climate_water_heater.py::test_alarm_service[arm_home-disarmed-armed_home]", "type": "Coroutine", "lineno": 15}, {"nodeid": "tests/entity/test_alarm_climate_water_heater.py::test_alarm_service[arm_away-disarmed-armed_away]", "type": "Coroutine", "lineno": 15}, {"nodeid": "tests/entity/test_alarm_climate_water_heater.py::test_alarm_service[arm_night-disarmed-armed_night]", "type": "Coroutine", "lineno": 15}, {"nodeid": "tests/entity/test_alarm_climate_water_heater.py::test_alarm_service[disarm-armed_home-disarmed]", "type": "Coroutine", "lineno": 15}, {"nodeid": "tests/entity/test_alarm_climate_water_heater.py::test_alarm_service[trigger-armed_home-triggered]", "type": "Coroutine", "lineno": 15}, {"nodeid": "tests/entity/test_alarm_climate_water_heater.py::test_alarm_full_lifecycle", "type": "Coroutine", "lineno": 38}, {"nodeid": "tests/entity/test_alarm_climate_water_heater.py::test_climate_set_temperature_stores_attr", "type": "Coroutine", "lineno": 62}]}, {"nodeid": "tests/entity/test_attribute_preservation.py", "outcome": "passed", "result": [{"nodeid": "tests/entity/test_attribute_preservation.py::test_light_turn_on_preserves_brightness", "type": "Coroutine", "lineno": 15}, {"nodeid": "tests/entity/test_attribute_preservation.py::test_light_turn_on_adds_brightness", "type": "Coroutine", "lineno": 26}, {"nodeid": "tests/entity/test_attribute_preservation.py::test_light_color_temp_preserved", "type": "Coroutine", "lineno": 39}, {"nodeid": "tests/entity/test_attribute_preservation.py::test_light_multiple_attrs_on_turn_on", "type": "Coroutine", "lineno": 50}, {"nodeid": "tests/entity/test_attribute_preservation.py::test_climate_set_temp_preserves_fan_mode", "type": "Coroutine", "lineno": 67}, {"nodeid": "tests/entity/test_attribute_preservation.py::test_climate_set_fan_mode_preserves_temp", "type": "Coroutine", "lineno": 79}, {"nodeid": "tests/entity/test_attribute_preservation.py::test_fan_turn_on_preserves_direction", "type": "Coroutine", "lineno": 93}, {"nodeid": "tests/entity/test_attribute_preservation.py::test_fan_set_direction_preserves_percentage", "type": "Coroutine", "lineno": 104}, {"nodeid": "tests/entity/test_attribute_preservation.py::test_media_player_volume_preserves_source", "type": "Coroutine", "lineno": 118}, {"nodeid": "tests/entity/test_attribute_preservation.py::test_media_player_source_preserves_volume", "type": "Coroutine", "lineno": 130}, {"nodeid": "tests/entity/test_attribute_preservation.py::test_cover_toggle_updates_position", "type": "Coroutine", "lineno": 144}, {"nodeid": "tests/entity/test_attribute_preservation.py::test_cover_toggle_from_closed_sets_position", "type": "Coroutine", "lineno": 155}, {"nodeid": "tests/entity/test_attribute_preservation.py::test_humidifier_turn_off_preserves_humidity", "type": "Coroutine", "lineno": 168}, {"nodeid": "tests/entity/test_attribute_preservation.py::test_humidifier_set_mode_preserves_humidity", "type": "Coroutine", "lineno": 179}]}, {"nodeid": "tests/entity/test_climate_extended.py", "outcome": "passed", "result": [{"nodeid": "tests/entity/test_climate_extended.py::test_climate_set_temperature_high_low", "type": "Coroutine", "lineno": 14}, {"nodeid": "tests/entity/test_climate_extended.py::test_climate_set_preset_mode", "type": "Coroutine", "lineno": 35}, {"nodeid": "tests/entity/test_climate_extended.py::test_climate_set_swing_mode", "type": "Coroutine", "lineno": 51}, {"nodeid": "tests/entity/test_climate_extended.py::test_climate_turn_on", "type": "Coroutine", "lineno": 67}, {"nodeid": "tests/entity/test_climate_extended.py::test_climate_turn_off", "type": "Coroutine", "lineno": 83}, {"nodeid": "tests/entity/test_climate_extended.py::test_climate_lifecycle", "type": "Coroutine", "lineno": 99}, {"nodeid": "tests/entity/test_climate_extended.py::test_climate_temperature_preserves_across_mode_changes", "type": "Coroutine", "lineno": 115}, {"nodeid": "tests/entity/test_climate_extended.py::test_climate_set_temperature", "type": "Coroutine", "lineno": 141}, {"nodeid": "tests/entity/test_climate_extended.py::test_climate_set_hvac_mode", "type": "Coroutine", "lineno": 153}, {"nodeid": "tests/entity/test_climate_extended.py::test_climate_set_hvac_mode_off", "type": "Coroutine", "lineno": 165}, {"nodeid": "tests/entity/test_climate_extended.py::test_climate_set_fan_mode", "type": "Coroutine", "lineno": 178}, {"nodeid": "tests/entity/test_climate_extended.py::test_climate_set_temperature_preserves_mode", "type": "Coroutine", "lineno": 191}]}, {"nodeid": "tests/entity/test_domain_state_formats.py", "outcome": "passed", "result": [{"nodeid": "tests/entity/test_domain_state_formats.py::test_light_on_off_states", "type": "Coroutine", "lineno": 14}, {"nodeid": "tests/entity/test_domain_state_formats.py::test_switch_on_off_states", "type": "Coroutine", "lineno": 25}, {"nodeid": "tests/entity/test_domain_state_formats.py::test_lock_locked_unlocked_states", "type": "Coroutine", "lineno": 36}, {"nodeid": "tests/entity/test_domain_state_formats.py::test_cover_open_closed_states", "type": "Coroutine", "lineno": 47}, {"nodeid": "tests/entity/test_domain_state_formats.py::test_siren_on_off_states", "type": "Coroutine", "lineno": 58}, {"nodeid": "tests/entity/test_domain_state_formats.py::test_vacuum_state_values", "type": "Coroutine", "lineno": 69}, {"nodeid": "tests/entity/test_domain_state_formats.py::test_vacuum_lifecycle", "type": "Coroutine", "lineno": 88}, {"nodeid": "tests/entity/test_domain_state_formats.py::test_valve_open_closed_states", "type": "Coroutine", "lineno": 107}, {"nodeid": "tests/entity/test_domain_state_formats.py::test_alarm_arm_states", "type": "Coroutine", "lineno": 118}, {"nodeid": "tests/entity/test_domain_state_formats.py::test_fan_on_off_states", "type": "Coroutine", "lineno": 137}, {"nodeid": "tests/entity/test_domain_state_formats.py::test_camera_streaming_idle", "type": "Coroutine", "lineno": 148}, {"nodeid": "tests/entity/test_domain_state_formats.py::test_number_set_value_state", "type": "Coroutine", "lineno": 159}, {"nodeid": "tests/entity/test_domain_state_formats.py::test_select_option_state", "type": "Coroutine", "lineno": 171}]}, {"nodeid": "tests/entity/test_domain_toggles.py", "outcome": "passed", "result": [{"nodeid": "tests/entity/test_domain_toggles.py::test_light_turn_on", "type": "Coroutine", "lineno": 15}, {"nodeid": "tests/entity/test_domain_toggles.py::test_light_turn_off", "type": "Coroutine", "lineno": 23}, {"nodeid": "tests/entity/test_domain_toggles.py::test_light_turn_on_with_attribute[brightness-128]", "type": "Coroutine", "lineno": 31}, {"nodeid": "tests/entity/test_domain_toggles.py::test_light_turn_on_with_attribute[color_temp-400]", "type": "Coroutine", "lineno": 31}, {"nodeid": "tests/entity/test_domain_toggles.py::test_light_turn_on_multiple", "type": "Coroutine", "lineno": 48}, {"nodeid": "tests/entity/test_domain_toggles.py::test_light_preserves_attributes_on_off", "type": "Coroutine", "lineno": 59}, {"nodeid": "tests/entity/test_domain_toggles.py::test_switch_turn_on", "type": "Coroutine", "lineno": 70}, {"nodeid": "tests/entity/test_domain_toggles.py::test_switch_turn_off", "type": "Coroutine", "lineno": 78}, {"nodeid": "tests/entity/test_domain_toggles.py::test_switch_toggle_on_to_off", "type": "Coroutine", "lineno": 86}, {"nodeid": "tests/entity/test_domain_toggles.py::test_switch_toggle_off_to_on", "type": "Coroutine", "lineno": 94}, {"nodeid": "tests/entity/test_domain_toggles.py::test_switch_preserves_attributes", "type": "Coroutine", "lineno": 102}, {"nodeid": "tests/entity/test_domain_toggles.py::test_input_boolean_turn_on", "type": "Coroutine", "lineno": 114}, {"nodeid": "tests/entity/test_domain_toggles.py::test_input_boolean_turn_off", "type": "Coroutine", "lineno": 122}, {"nodeid": "tests/entity/test_domain_toggles.py::test_siren_toggle_on_to_off", "type": "Coroutine", "lineno": 132}, {"nodeid": "tests/entity/test_domain_toggles.py::test_siren_toggle_off_to_on", "type": "Coroutine", "lineno": 140}, {"nodeid": "tests/entity/test_domain_toggles.py::test_valve_toggle_open_to_closed", "type": "Coroutine", "lineno": 150}, {"nodeid": "tests/entity/test_domain_toggles.py::test_valve_toggle_closed_to_open", "type": "Coroutine", "lineno": 158}, {"nodeid": "tests/entity/test_domain_toggles.py::test_fan_toggle_on_to_off", "type": "Coroutine", "lineno": 168}, {"nodeid": "tests/entity/test_domain_toggles.py::test_fan_toggle_off_to_on", "type": "Coroutine", "lineno": 176}, {"nodeid": "tests/entity/test_domain_toggles.py::test_homeassistant_toggle_on_to_off", "type": "Coroutine", "lineno": 186}, {"nodeid": "tests/entity/test_domain_toggles.py::test_homeassistant_toggle_off_to_on", "type": "Coroutine", "lineno": 194}, {"nodeid": "tests/entity/test_domain_toggles.py::test_homeassistant_turn_on_any", "type": "Coroutine", "lineno": 202}, {"nodeid": "tests/entity/test_domain_toggles.py::test_homeassistant_turn_off_any", "type": "Coroutine", "lineno": 210}, {"nodeid": "tests/entity/test_domain_toggles.py::test_humidifier_toggle_on_to_off", "type": "Coroutine", "lineno": 220}, {"nodeid": "tests/entity/test_domain_toggles.py::test_humidifier_toggle_off_to_on", "type": "Coroutine", "lineno": 228}, {"nodeid": "tests/entity/test_domain_toggles.py::test_alarm_arm_home", "type": "Coroutine", "lineno": 238}, {"nodeid": "tests/entity/test_domain_toggles.py::test_alarm_arm_away", "type": "Coroutine", "lineno": 248}, {"nodeid": "tests/entity/test_domain_toggles.py::test_alarm_arm_night", "type": "Coroutine", "lineno": 258}, {"nodeid": "tests/entity/test_domain_toggles.py::test_alarm_disarm", "type": "Coroutine", "lineno": 268}, {"nodeid": "tests/entity/test_domain_toggles.py::test_alarm_trigger", "type": "Coroutine", "lineno": 278}]}, {"nodeid": "tests/entity/test_entity_delete.py", "outcome": "passed", "result": [{"nodeid": "tests/entity/test_entity_delete.py::test_delete_entity", "type": "Coroutine", "lineno": 14}, {"nodeid": "tests/entity/test_entity_delete.py::test_delete_nonexistent_returns_404", "type": "Coroutine", "lineno": 36}, {"nodeid": "tests/entity/test_entity_delete.py::test_delete_then_recreate", "type": "Coroutine", "lineno": 46}, {"nodeid": "tests/entity/test_entity_delete.py::test_delete_reduces_entity_count", "type": "Coroutine", "lineno": 68}, {"nodeid": "tests/entity/test_entity_delete.py::test_search_by_label", "type": "Coroutine", "lineno": 88}, {"nodeid": "tests/entity/test_entity_delete.py::test_search_by_area", "type": "Coroutine", "lineno": 129}]}, {"nodeid": "tests/entity/test_entity_format_consistency.py", "outcome": "passed", "result": [{"nodeid": "tests/entity/test_entity_format_consistency.py::test_create_entity_minimal", "type": "Coroutine", "lineno": 14}, {"nodeid": "tests/entity/test_entity_format_consistency.py::test_create_entity_with_attributes", "type": "Coroutine", "lineno": 26}, {"nodeid": "tests/entity/test_entity_format_consistency.py::test_delete_and_recreate", "type": "Coroutine", "lineno": 37}, {"nodeid": "tests/entity/test_entity_format_consistency.py::test_entity_has_context", "type": "Coroutine", "lineno": 58}, {"nodeid": "tests/entity/test_entity_format_consistency.py::test_context_changes_on_update", "type": "Coroutine", "lineno": 70}, {"nodeid": "tests/entity/test_entity_format_consistency.py::test_last_changed_only_on_state_change", "type": "Coroutine", "lineno": 84}, {"nodeid": "tests/entity/test_entity_format_consistency.py::test_many_domains", "type": "Coroutine", "lineno": 102}, {"nodeid": "tests/entity/test_entity_format_consistency.py::test_entity_id_preserved_exactly", "type": "Coroutine", "lineno": 116}, {"nodeid": "tests/entity/test_entity_format_consistency.py::test_large_attributes", "type": "Coroutine", "lineno": 126}, {"nodeid": "tests/entity/test_entity_format_consistency.py::test_numeric_attribute_types", "type": "Coroutine", "lineno": 139}, {"nodeid": "tests/entity/test_entity_format_consistency.py::test_nested_attribute_objects", "type": "Coroutine", "lineno": 157}, {"nodeid": "tests/entity/test_entity_format_consistency.py::test_response_has_required_fields", "type": "Coroutine", "lineno": 171}, {"nodeid": "tests/entity/test_entity_format_consistency.py::test_state_empty_string", "type": "Coroutine", "lineno": 187}]}, {"nodeid": "tests/entity/test_extended_domains.py", "outcome": "passed", "result": [{"nodeid": "tests/entity/test_extended_domains.py::test_camera_turn_on", "type": "Coroutine", "lineno": 13}, {"nodeid": "tests/entity/test_extended_domains.py::test_camera_turn_off", "type": "Coroutine", "lineno": 23}, {"nodeid": "tests/entity/test_extended_domains.py::test_device_tracker_see", "type": "Coroutine", "lineno": 35}, {"nodeid": "tests/entity/test_extended_domains.py::test_services_include_persistent_notification", "type": "Coroutine", "lineno": 49}, {"nodeid": "tests/entity/test_extended_domains.py::test_services_include_camera", "type": "Coroutine", "lineno": 63}, {"nodeid": "tests/entity/test_extended_domains.py::test_services_include_device_tracker", "type": "Coroutine", "lineno": 74}, {"nodeid": "tests/entity/test_extended_domains.py::test_services_total_domain_count", "type": "Coroutine", "lineno": 85}]}, {"nodeid": "tests/entity/test_fan_cover_extended.py", "outcome": "passed", "result": [{"nodeid": "tests/entity/test_fan_cover_extended.py::test_fan_turn_on", "type": "Coroutine", "lineno": 16}, {"nodeid": "tests/entity/test_fan_cover_extended.py::test_fan_turn_off", "type": "Coroutine", "lineno": 26}, {"nodeid": "tests/entity/test_fan_cover_extended.py::test_fan_toggle", "type": "Coroutine", "lineno": 36}, {"nodeid": "tests/entity/test_fan_cover_extended.py::test_fan_turn_on_with_percentage", "type": "Coroutine", "lineno": 52}, {"nodeid": "tests/entity/test_fan_cover_extended.py::test_fan_turn_on_with_preset", "type": "Coroutine", "lineno": 70}, {"nodeid": "tests/entity/test_fan_cover_extended.py::test_fan_set_direction", "type": "Coroutine", "lineno": 87}, {"nodeid": "tests/entity/test_fan_cover_extended.py::test_fan_set_preset_mode", "type": "Coroutine", "lineno": 104}, {"nodeid": "tests/entity/test_fan_cover_extended.py::test_fan_set_percentage_zero_is_off", "type": "Coroutine", "lineno": 120}, {"nodeid": "tests/entity/test_fan_cover_extended.py::test_fan_set_percentage_nonzero_is_on", "type": "Coroutine", "lineno": 137}, {"nodeid": "tests/entity/test_fan_cover_extended.py::test_cover_open_sets_position_100", "type": "Coroutine", "lineno": 156}, {"nodeid": "tests/entity/test_fan_cover_extended.py::test_cover_close_sets_position_0", "type": "Coroutine", "lineno": 174}, {"nodeid": "tests/entity/test_fan_cover_extended.py::test_cover_toggle_open_to_closed", "type": "Coroutine", "lineno": 191}, {"nodeid": "tests/entity/test_fan_cover_extended.py::test_cover_toggle_closed_to_open", "type": "Coroutine", "lineno": 208}, {"nodeid": "tests/entity/test_fan_cover_extended.py::test_cover_set_position_partial", "type": "Coroutine", "lineno": 225}, {"nodeid": "tests/entity/test_fan_cover_extended.py::test_cover_set_position_zero_is_closed", "type": "Coroutine", "lineno": 242}, {"nodeid": "tests/entity/test_fan_cover_extended.py::test_cover_stop_preserves_state", "type": "Coroutine", "lineno": 258}]}, {"nodeid": "tests/entity/test_generic_fallback_services.py", "outcome": "passed", "result": [{"nodeid": "tests/entity/test_generic_fallback_services.py::test_unknown_domain_turn_on", "type": "Coroutine", "lineno": 12}, {"nodeid": "tests/entity/test_generic_fallback_services.py::test_unknown_domain_turn_off", "type": "Coroutine", "lineno": 22}, {"nodeid": "tests/entity/test_generic_fallback_services.py::test_unknown_domain_toggle_on_to_off", "type": "Coroutine", "lineno": 32}, {"nodeid": "tests/entity/test_generic_fallback_services.py::test_unknown_domain_toggle_off_to_on", "type": "Coroutine", "lineno": 42}, {"nodeid": "tests/entity/test_generic_fallback_services.py::test_fallback_preserves_attrs", "type": "Coroutine", "lineno": 52}, {"nodeid": "tests/entity/test_generic_fallback_services.py::test_fallback_unknown_service", "type": "Coroutine", "lineno": 63}, {"nodeid": "tests/entity/test_generic_fallback_services.py::test_binary_sensor_domain_fallback", "type": "Coroutine", "lineno": 77}]}, {"nodeid": "tests/entity/test_homeassistant_domain_services.py", "outcome": "passed", "result": [{"nodeid": "tests/entity/test_homeassistant_domain_services.py::test_homeassistant_turn_on", "type": "Coroutine", "lineno": 14}, {"nodeid": "tests/entity/test_homeassistant_domain_services.py::test_homeassistant_turn_off", "type": "Coroutine", "lineno": 24}, {"nodeid": "tests/entity/test_homeassistant_domain_services.py::test_homeassistant_toggle", "type": "Coroutine", "lineno": 34}, {"nodeid": "tests/entity/test_homeassistant_domain_services.py::test_homeassistant_restart_stub", "type": "Coroutine", "lineno": 44}, {"nodeid": "tests/entity/test_homeassistant_domain_services.py::test_homeassistant_stop_stub", "type": "Coroutine", "lineno": 54}, {"nodeid": "tests/entity/test_homeassistant_domain_services.py::test_homeassistant_reload_core_config_stub", "type": "Coroutine", "lineno": 64}, {"nodeid": "tests/entity/test_homeassistant_domain_services.py::test_homeassistant_turn_on_preserves_attributes", "type": "Coroutine", "lineno": 74}, {"nodeid": "tests/entity/test_homeassistant_domain_services.py::test_homeassistant_works_across_domains", "type": "Coroutine", "lineno": 87}]}, {"nodeid": "tests/entity/test_homeassistant_service.py", "outcome": "passed", "result": [{"nodeid": "tests/entity/test_homeassistant_service.py::test_ha_turn_on", "type": "Coroutine", "lineno": 13}, {"nodeid": "tests/entity/test_homeassistant_service.py::test_ha_turn_off", "type": "Coroutine", "lineno": 30}, {"nodeid": "tests/entity/test_homeassistant_service.py::test_ha_toggle", "type": "Coroutine", "lineno": 47}, {"nodeid": "tests/entity/test_homeassistant_service.py::test_ha_turn_on_multiple", "type": "Coroutine", "lineno": 63}, {"nodeid": "tests/entity/test_homeassistant_service.py::test_ha_turn_off_multiple", "type": "Coroutine", "lineno": 82}, {"nodeid": "tests/entity/test_homeassistant_service.py::test_ha_toggle_mixed_states", "type": "Coroutine", "lineno": 100}, {"nodeid": "tests/entity/test_homeassistant_service.py::test_ha_turn_on_different_domains", "type": "Coroutine", "lineno": 120}, {"nodeid": "tests/entity/test_homeassistant_service.py::test_ha_check_config", "type": "Coroutine", "lineno": 143}, {"nodeid": "tests/entity/test_homeassistant_service.py::test_ha_turn_on_preserves_attributes", "type": "Coroutine", "lineno": 155}, {"nodeid": "tests/entity/test_homeassistant_service.py::test_group_set", "type": "Coroutine", "lineno": 174}, {"nodeid": "tests/entity/test_homeassistant_service.py::test_update_install", "type": "Coroutine", "lineno": 188}]}, {"nodeid": "tests/entity/test_input_number_select_button.py", "outcome": "passed", "result": [{"nodeid": "tests/entity/test_input_number_select_button.py::test_input_number_set_value", "type": "Coroutine", "lineno": 15}, {"nodeid": "tests/entity/test_input_number_select_button.py::test_input_number_set_zero", "type": "Coroutine", "lineno": 32}, {"nodeid": "tests/entity/test_input_number_select_button.py::test_input_number_set_negative", "type": "Coroutine", "lineno": 48}, {"nodeid": "tests/entity/test_input_number_select_button.py::test_input_text_set_value", "type": "Coroutine", "lineno": 66}, {"nodeid": "tests/entity/test_input_number_select_button.py::test_input_text_set_empty", "type": "Coroutine", "lineno": 82}, {"nodeid": "tests/entity/test_input_number_select_button.py::test_input_select_select_option", "type": "Coroutine", "lineno": 100}, {"nodeid": "tests/entity/test_input_number_select_button.py::test_input_select_empty_option", "type": "Coroutine", "lineno": 116}, {"nodeid": "tests/entity/test_input_number_select_button.py::test_input_boolean_turn_on", "type": "Coroutine", "lineno": 134}, {"nodeid": "tests/entity/test_input_number_select_button.py::test_input_boolean_turn_off", "type": "Coroutine", "lineno": 150}, {"nodeid": "tests/entity/test_input_number_select_button.py::test_input_boolean_toggle_on_to_off", "type": "Coroutine", "lineno": 166}, {"nodeid": "tests/entity/test_input_number_select_button.py::test_input_boolean_toggle_off_to_on", "type": "Coroutine", "lineno": 182}, {"nodeid": "tests/entity/test_input_number_select_button.py::test_number_set_value", "type": "Coroutine", "lineno": 200}, {"nodeid": "tests/entity/test_input_number_select_button.py::test_select_select_option", "type": "Coroutine", "lineno": 218}, {"nodeid": "tests/entity/test_input_number_select_button.py::test_button_press_no_state_change", "type": "Coroutine", "lineno": 236}, {"nodeid": "tests/entity/test_input_number_select_button.py::test_button_press_multiple_times", "type": "Coroutine", "lineno": 253}, {"nodeid": "tests/entity/test_input_number_select_button.py::test_input_number_preserves_attributes", "type": "Coroutine", "lineno": 272}, {"nodeid": "tests/entity/test_input_number_select_button.py::test_input_select_preserves_options", "type": "Coroutine", "lineno": 289}]}, {"nodeid": "tests/entity/test_media_player_extended.py", "outcome": "passed", "result": [{"nodeid": "tests/entity/test_media_player_extended.py::test_media_player_state_service[off-turn_on-on]", "type": "Coroutine", "lineno": 16}, {"nodeid": "tests/entity/test_media_player_extended.py::test_media_player_state_service[playing-turn_off-off]", "type": "Coroutine", "lineno": 16}, {"nodeid": "tests/entity/test_media_player_extended.py::test_media_player_state_service[paused-media_play-playing]", "type": "Coroutine", "lineno": 16}, {"nodeid": "tests/entity/test_media_player_extended.py::test_media_player_state_service[playing-media_pause-paused]", "type": "Coroutine", "lineno": 16}, {"nodeid": "tests/entity/test_media_player_extended.py::test_media_player_state_service[playing-media_stop-idle]", "type": "Coroutine", "lineno": 16}, {"nodeid": "tests/entity/test_media_player_extended.py::test_media_player_track_service[media_next_track]", "type": "Coroutine", "lineno": 41}, {"nodeid": "tests/entity/test_media_player_extended.py::test_media_player_track_service[media_previous_track]", "type": "Coroutine", "lineno": 41}, {"nodeid": "tests/entity/test_media_player_extended.py::test_media_player_attribute_set[select_source-payload0-source-Spotify]", "type": "Coroutine", "lineno": 62}, {"nodeid": "tests/entity/test_media_player_extended.py::test_media_player_attribute_set[volume_set-payload1-volume_level-0.75]", "type": "Coroutine", "lineno": 62}, {"nodeid": "tests/entity/test_media_player_extended.py::test_media_player_attribute_set[volume_mute-payload2-is_volume_muted-True]", "type": "Coroutine", "lineno": 62}, {"nodeid": "tests/entity/test_media_player_extended.py::test_media_player_attribute_set[shuffle_set-payload3-shuffle-True]", "type": "Coroutine", "lineno": 62}, {"nodeid": "tests/entity/test_media_player_extended.py::test_media_player_attribute_set[repeat_set-payload4-repeat-all]", "type": "Coroutine", "lineno": 62}, {"nodeid": "tests/entity/test_media_player_extended.py::test_media_player_turn_on_with_source", "type": "Coroutine", "lineno": 86}, {"nodeid": "tests/entity/test_media_player_extended.py::test_media_player_lifecycle", "type": "Coroutine", "lineno": 104}, {"nodeid": "tests/entity/test_media_player_extended.py::test_media_player_play_media", "type": "Coroutine", "lineno": 129}, {"nodeid": "tests/entity/test_media_player_extended.py::test_media_player_play_media_preserves_volume", "type": "Coroutine", "lineno": 145}, {"nodeid": "tests/entity/test_media_player_extended.py::test_media_player_select_source_preserves_state", "type": "Coroutine", "lineno": 162}, {"nodeid": "tests/entity/test_media_player_extended.py::test_media_player_select_sound_mode", "type": "Coroutine", "lineno": 177}, {"nodeid": "tests/entity/test_media_player_extended.py::test_media_player_volume_unmute", "type": "Coroutine", "lineno": 191}]}, {"nodeid": "tests/entity/test_media_player_lock_camera_group.py", "outcome": "passed", "result": [{"nodeid": "tests/entity/test_media_player_lock_camera_group.py::test_media_player_play_media", "type": "Coroutine", "lineno": 17}, {"nodeid": "tests/entity/test_media_player_lock_camera_group.py::test_media_player_select_sound_mode", "type": "Coroutine", "lineno": 40}, {"nodeid": "tests/entity/test_media_player_lock_camera_group.py::test_lock_open", "type": "Coroutine", "lineno": 59}, {"nodeid": "tests/entity/test_media_player_lock_camera_group.py::test_lock_unlock_then_open", "type": "Coroutine", "lineno": 76}, {"nodeid": "tests/entity/test_media_player_lock_camera_group.py::test_lock_locks", "type": "Coroutine", "lineno": 99}, {"nodeid": "tests/entity/test_media_player_lock_camera_group.py::test_lock_unlocks", "type": "Coroutine", "lineno": 109}, {"nodeid": "tests/entity/test_media_player_lock_camera_group.py::test_lock_toggle_locked_to_unlocked", "type": "Coroutine", "lineno": 119}, {"nodeid": "tests/entity/test_media_player_lock_camera_group.py::test_lock_preserves_attributes", "type": "Coroutine", "lineno": 130}, {"nodeid": "tests/entity/test_media_player_lock_camera_group.py::test_camera_enable_motion_detection", "type": "Coroutine", "lineno": 144}, {"nodeid": "tests/entity/test_media_player_lock_camera_group.py::test_camera_disable_motion_detection", "type": "Coroutine", "lineno": 161}, {"nodeid": "tests/entity/test_media_player_lock_camera_group.py::test_camera_motion_preserves_state", "type": "Coroutine", "lineno": 178}, {"nodeid": "tests/entity/test_media_player_lock_camera_group.py::test_group_set_state", "type": "Coroutine", "lineno": 197}, {"nodeid": "tests/entity/test_media_player_lock_camera_group.py::test_group_set_default_on", "type": "Coroutine", "lineno": 214}, {"nodeid": "tests/entity/test_media_player_lock_camera_group.py::test_update_skip", "type": "Coroutine", "lineno": 232}, {"nodeid": "tests/entity/test_media_player_lock_camera_group.py::test_generic_turn_on_unknown_domain", "type": "Coroutine", "lineno": 251}, {"nodeid": "tests/entity/test_media_player_lock_camera_group.py::test_generic_turn_off_unknown_domain", "type": "Coroutine", "lineno": 268}, {"nodeid": "tests/entity/test_media_player_lock_camera_group.py::test_generic_toggle_unknown_domain", "type": "Coroutine", "lineno": 285}]}, {"nodeid": "tests/entity/test_media_player_state_transitions.py", "outcome": "passed", "result": [{"nodeid": "tests/entity/test_media_player_state_transitions.py::test_media_player_play", "type": "Coroutine", "lineno": 15}, {"nodeid": "tests/entity/test_media_player_state_transitions.py::test_media_player_pause", "type": "Coroutine", "lineno": 25}, {"nodeid": "tests/entity/test_media_player_state_transitions.py::test_media_player_stop", "type": "Coroutine", "lineno": 35}, {"nodeid": "tests/entity/test_media_player_state_transitions.py::test_media_player_next_track", "type": "Coroutine", "lineno": 45}, {"nodeid": "tests/entity/test_media_player_state_transitions.py::test_media_player_previous_track", "type": "Coroutine", "lineno": 55}, {"nodeid": "tests/entity/test_media_player_state_transitions.py::test_media_player_turn_on", "type": "Coroutine", "lineno": 65}, {"nodeid": "tests/entity/test_media_player_state_transitions.py::test_media_player_turn_off", "type": "Coroutine", "lineno": 75}, {"nodeid": "tests/entity/test_media_player_state_transitions.py::test_media_player_volume_mute", "type": "Coroutine", "lineno": 85}, {"nodeid": "tests/entity/test_media_player_state_transitions.py::test_media_player_repeat_set", "type": "Coroutine", "lineno": 99}, {"nodeid": "tests/entity/test_media_player_state_transitions.py::test_media_player_lifecycle", "type": "Coroutine", "lineno": 113}]}, {"nodeid": "tests/entity/test_multi_entity_operations.py", "outcome": "passed", "result": [{"nodeid": "tests/entity/test_multi_entity_operations.py::test_turn_on_multiple_lights", "type": "Coroutine", "lineno": 16}, {"nodeid": "tests/entity/test_multi_entity_operations.py::test_turn_off_multiple_switches", "type": "Coroutine", "lineno": 31}, {"nodeid": "tests/entity/test_multi_entity_operations.py::test_toggle_multiple_entities", "type": "Coroutine", "lineno": 46}, {"nodeid": "tests/entity/test_multi_entity_operations.py::test_get_all_states_includes_created", "type": "Coroutine", "lineno": 62}, {"nodeid": "tests/entity/test_multi_entity_operations.py::test_get_states_returns_all_fields", "type": "Coroutine", "lineno": 72}, {"nodeid": "tests/entity/test_multi_entity_operations.py::test_create_many_entities", "type": "Coroutine", "lineno": 84}, {"nodeid": "tests/entity/test_multi_entity_operations.py::test_homeassistant_turn_on_multiple_domains", "type": "Coroutine", "lineno": 98}, {"nodeid": "tests/entity/test_multi_entity_operations.py::test_homeassistant_turn_off_multiple_domains", "type": "Coroutine", "lineno": 112}, {"nodeid": "tests/entity/test_multi_entity_operations.py::test_entities_are_isolated", "type": "Coroutine", "lineno": 127}, {"nodeid": "tests/entity/test_multi_entity_operations.py::test_attributes_are_isolated", "type": "Coroutine", "lineno": 140}, {"nodeid": "tests/entity/test_multi_entity_operations.py::test_service_calls_are_isolated", "type": "Coroutine", "lineno": 151}]}, {"nodeid": "tests/entity/test_new_domains.py", "outcome": "passed", "result": [{"nodeid": "tests/entity/test_new_domains.py::test_water_heater_set_temperature", "type": "Coroutine", "lineno": 13}, {"nodeid": "tests/entity/test_new_domains.py::test_water_heater_set_operation_mode", "type": "Coroutine", "lineno": 24}, {"nodeid": "tests/entity/test_new_domains.py::test_water_heater_turn_on", "type": "Coroutine", "lineno": 35}, {"nodeid": "tests/entity/test_new_domains.py::test_water_heater_turn_off", "type": "Coroutine", "lineno": 45}, {"nodeid": "tests/entity/test_new_domains.py::test_lawn_mower_start", "type": "Coroutine", "lineno": 57}, {"nodeid": "tests/entity/test_new_domains.py::test_lawn_mower_pause", "type": "Coroutine", "lineno": 67}, {"nodeid": "tests/entity/test_new_domains.py::test_lawn_mower_dock", "type": "Coroutine", "lineno": 77}, {"nodeid": "tests/entity/test_new_domains.py::test_remote_turn_on", "type": "Coroutine", "lineno": 89}, {"nodeid": "tests/entity/test_new_domains.py::test_remote_turn_off", "type": "Coroutine", "lineno": 99}, {"nodeid": "tests/entity/test_new_domains.py::test_remote_send_command", "type": "Coroutine", "lineno": 109}, {"nodeid": "tests/entity/test_new_domains.py::test_services_include_water_heater", "type": "Coroutine", "lineno": 122}, {"nodeid": "tests/entity/test_new_domains.py::test_services_include_humidifier", "type": "Coroutine", "lineno": 132}, {"nodeid": "tests/entity/test_new_domains.py::test_services_include_lawn_mower", "type": "Coroutine", "lineno": 142}, {"nodeid": "tests/entity/test_new_domains.py::test_services_include_remote", "type": "Coroutine", "lineno": 152}, {"nodeid": "tests/entity/test_new_domains.py::test_services_total_at_least_40", "type": "Coroutine", "lineno": 162}]}, {"nodeid": "tests/entity/test_number_select.py", "outcome": "passed", "result": [{"nodeid": "tests/entity/test_number_select.py::test_number_set_value", "type": "Coroutine", "lineno": 14}, {"nodeid": "tests/entity/test_number_select.py::test_number_set_float_value", "type": "Coroutine", "lineno": 27}, {"nodeid": "tests/entity/test_number_select.py::test_select_option", "type": "Coroutine", "lineno": 43}, {"nodeid": "tests/entity/test_number_select.py::test_select_preserves_options", "type": "Coroutine", "lineno": 56}]}, {"nodeid": "tests/entity/test_person_zone_weather.py", "outcome": "passed", "result": [{"nodeid": "tests/entity/test_person_zone_weather.py::test_person_set_state", "type": "Coroutine", "lineno": 13}, {"nodeid": "tests/entity/test_person_zone_weather.py::test_person_state_transitions", "type": "Coroutine", "lineno": 23}, {"nodeid": "tests/entity/test_person_zone_weather.py::test_zone_entity", "type": "Coroutine", "lineno": 38}, {"nodeid": "tests/entity/test_person_zone_weather.py::test_zone_multiple", "type": "Coroutine", "lineno": 54}, {"nodeid": "tests/entity/test_person_zone_weather.py::test_weather_entity", "type": "Coroutine", "lineno": 68}, {"nodeid": "tests/entity/test_person_zone_weather.py::test_weather_state_changes", "type": "Coroutine", "lineno": 84}, {"nodeid": "tests/entity/test_person_zone_weather.py::test_image_entity", "type": "Coroutine", "lineno": 94}, {"nodeid": "tests/entity/test_person_zone_weather.py::test_script_entity", "type": "Coroutine", "lineno": 107}, {"nodeid": "tests/entity/test_person_zone_weather.py::test_group_entity", "type": "Coroutine", "lineno": 116}, {"nodeid": "tests/entity/test_person_zone_weather.py::test_number_entity_set_value", "type": "Coroutine", "lineno": 130}, {"nodeid": "tests/entity/test_person_zone_weather.py::test_select_entity_select_option", "type": "Coroutine", "lineno": 147}, {"nodeid": "tests/entity/test_person_zone_weather.py::test_button_press", "type": "Coroutine", "lineno": 164}]}, {"nodeid": "tests/entity/test_scene_activation.py", "outcome": "passed", "result": [{"nodeid": "tests/entity/test_scene_activation.py::test_evening_scene_activates", "type": "Coroutine", "lineno": 13}, {"nodeid": "tests/entity/test_scene_activation.py::test_evening_scene_sets_accent_light", "type": "Coroutine", "lineno": 29}, {"nodeid": "tests/entity/test_scene_activation.py::test_goodnight_scene_turns_off_lights", "type": "Coroutine", "lineno": 43}, {"nodeid": "tests/entity/test_scene_activation.py::test_scene_merges_attributes", "type": "Coroutine", "lineno": 59}, {"nodeid": "tests/entity/test_scene_activation.py::test_scene_reactivation_idempotent", "type": "Coroutine", "lineno": 73}, {"nodeid": "tests/entity/test_scene_activation.py::test_scene_via_ws", "type": "Coroutine", "lineno": 91}, {"nodeid": "tests/entity/test_scene_activation.py::test_scene_entity_exists", "type": "Coroutine", "lineno": 106}, {"nodeid": "tests/entity/test_scene_activation.py::test_scene_sets_media_player", "type": "Coroutine", "lineno": 113}]}, {"nodeid": "tests/entity/test_service_attribute_passthrough.py", "outcome": "passed", "result": [{"nodeid": "tests/entity/test_service_attribute_passthrough.py::test_light_brightness_stored", "type": "Coroutine", "lineno": 16}, {"nodeid": "tests/entity/test_service_attribute_passthrough.py::test_light_color_temp_stored", "type": "Coroutine", "lineno": 31}, {"nodeid": "tests/entity/test_service_attribute_passthrough.py::test_light_rgb_color_stored", "type": "Coroutine", "lineno": 45}, {"nodeid": "tests/entity/test_service_attribute_passthrough.py::test_light_multiple_attrs_at_once", "type": "Coroutine", "lineno": 59}, {"nodeid": "tests/entity/test_service_attribute_passthrough.py::test_fan_percentage_stored", "type": "Coroutine", "lineno": 77}, {"nodeid": "tests/entity/test_service_attribute_passthrough.py::test_media_player_select_source", "type": "Coroutine", "lineno": 94}]}, {"nodeid": "tests/entity/test_service_data_validation.py", "outcome": "passed", "result": [{"nodeid": "tests/entity/test_service_data_validation.py::test_light_brightness_int", "type": "Coroutine", "lineno": 13}, {"nodeid": "tests/entity/test_service_data_validation.py::test_light_brightness_float", "type": "Coroutine", "lineno": 31}, {"nodeid": "tests/entity/test_service_data_validation.py::test_light_rgb_array", "type": "Coroutine", "lineno": 48}, {"nodeid": "tests/entity/test_service_data_validation.py::test_climate_temperature_int", "type": "Coroutine", "lineno": 65}, {"nodeid": "tests/entity/test_service_data_validation.py::test_climate_temperature_float", "type": "Coroutine", "lineno": 82}, {"nodeid": "tests/entity/test_service_data_validation.py::test_fan_percentage_boundary_0", "type": "Coroutine", "lineno": 99}, {"nodeid": "tests/entity/test_service_data_validation.py::test_fan_percentage_boundary_100", "type": "Coroutine", "lineno": 113}, {"nodeid": "tests/entity/test_service_data_validation.py::test_cover_position_boundary", "type": "Coroutine", "lineno": 130}, {"nodeid": "tests/entity/test_service_data_validation.py::test_media_player_volume_float", "type": "Coroutine", "lineno": 157}, {"nodeid": "tests/entity/test_service_data_validation.py::test_extra_service_data_ignored", "type": "Coroutine", "lineno": 174}, {"nodeid": "tests/entity/test_service_data_validation.py::test_service_with_no_entity_id", "type": "Coroutine", "lineno": 195}, {"nodeid": "tests/entity/test_service_data_validation.py::test_target_pattern_entity_id", "type": "Coroutine", "lineno": 205}]}, {"nodeid": "tests/entity/test_service_edge_cases.py", "outcome": "passed", "result": [{"nodeid": "tests/entity/test_service_edge_cases.py::test_service_call_nonexistent_entity", "type": "Coroutine", "lineno": 14}, {"nodeid": "tests/entity/test_service_edge_cases.py::test_service_call_empty_entity_id", "type": "Coroutine", "lineno": 26}, {"nodeid": "tests/entity/test_service_edge_cases.py::test_light_turn_on_preserves_brightness", "type": "Coroutine", "lineno": 36}, {"nodeid": "tests/entity/test_service_edge_cases.py::test_light_turn_on_sets_brightness", "type": "Coroutine", "lineno": 49}, {"nodeid": "tests/entity/test_service_edge_cases.py::test_light_turn_on_sets_color_temp", "type": "Coroutine", "lineno": 65}, {"nodeid": "tests/entity/test_service_edge_cases.py::test_light_turn_on_sets_rgb", "type": "Coroutine", "lineno": 80}, {"nodeid": "tests/entity/test_service_edge_cases.py::test_climate_set_temperature", "type": "Coroutine", "lineno": 95}, {"nodeid": "tests/entity/test_service_edge_cases.py::test_climate_set_hvac_mode", "type": "Coroutine", "lineno": 110}, {"nodeid": "tests/entity/test_service_edge_cases.py::test_fan_set_percentage", "type": "Coroutine", "lineno": 125}, {"nodeid": "tests/entity/test_service_edge_cases.py::test_fan_set_percentage_zero_turns_off", "type": "Coroutine", "lineno": 141}, {"nodeid": "tests/entity/test_service_edge_cases.py::test_cover_open_close", "type": "Coroutine", "lineno": 156}, {"nodeid": "tests/entity/test_service_edge_cases.py::test_cover_set_position", "type": "Coroutine", "lineno": 171}, {"nodeid": "tests/entity/test_service_edge_cases.py::test_cover_set_position_zero_closes", "type": "Coroutine", "lineno": 187}, {"nodeid": "tests/entity/test_service_edge_cases.py::test_lock_lock_unlock", "type": "Coroutine", "lineno": 202}, {"nodeid": "tests/entity/test_service_edge_cases.py::test_number_set_value", "type": "Coroutine", "lineno": 217}, {"nodeid": "tests/entity/test_service_edge_cases.py::test_select_select_option", "type": "Coroutine", "lineno": 232}, {"nodeid": "tests/entity/test_service_edge_cases.py::test_toggle_generic_entity", "type": "Coroutine", "lineno": 247}, {"nodeid": "tests/entity/test_service_edge_cases.py::test_service_call_multiple_entities", "type": "Coroutine", "lineno": 262}, {"nodeid": "tests/entity/test_service_edge_cases.py::test_input_boolean_toggle", "type": "Coroutine", "lineno": 280}]}, {"nodeid": "tests/entity/test_service_interactions.py", "outcome": "passed", "result": [{"nodeid": "tests/entity/test_service_interactions.py::test_light_turn_on_with_brightness", "type": "Coroutine", "lineno": 14}, {"nodeid": "tests/entity/test_service_interactions.py::test_light_turn_on_with_color", "type": "Coroutine", "lineno": 26}, {"nodeid": "tests/entity/test_service_interactions.py::test_light_toggle_from_on", "type": "Coroutine", "lineno": 38}, {"nodeid": "tests/entity/test_service_interactions.py::test_light_toggle_from_off", "type": "Coroutine", "lineno": 48}, {"nodeid": "tests/entity/test_service_interactions.py::test_climate_set_multiple_attributes", "type": "Coroutine", "lineno": 60}, {"nodeid": "tests/entity/test_service_interactions.py::test_cover_toggle_from_open", "type": "Coroutine", "lineno": 73}, {"nodeid": "tests/entity/test_service_interactions.py::test_media_player_volume_set", "type": "Coroutine", "lineno": 85}, {"nodeid": "tests/entity/test_service_interactions.py::test_media_player_shuffle_set", "type": "Coroutine", "lineno": 96}, {"nodeid": "tests/entity/test_service_interactions.py::test_media_player_source", "type": "Coroutine", "lineno": 107}, {"nodeid": "tests/entity/test_service_interactions.py::test_media_player_state_transitions", "type": "Coroutine", "lineno": 118}, {"nodeid": "tests/entity/test_service_interactions.py::test_input_select_option", "type": "Coroutine", "lineno": 137}]}, {"nodeid": "tests/entity/test_service_response_format.py", "outcome": "passed", "result": [{"nodeid": "tests/entity/test_service_response_format.py::test_service_response_is_list", "type": "Coroutine", "lineno": 12}, {"nodeid": "tests/entity/test_service_response_format.py::test_service_response_changed_has_entity_id", "type": "Coroutine", "lineno": 25}, {"nodeid": "tests/entity/test_service_response_format.py::test_service_response_changed_has_state", "type": "Coroutine", "lineno": 40}, {"nodeid": "tests/entity/test_service_response_format.py::test_service_response_changed_has_attributes", "type": "Coroutine", "lineno": 54}, {"nodeid": "tests/entity/test_service_response_format.py::test_service_response_changed_has_timestamps", "type": "Coroutine", "lineno": 67}, {"nodeid": "tests/entity/test_service_response_format.py::test_service_response_changed_has_context", "type": "Coroutine", "lineno": 81}, {"nodeid": "tests/entity/test_service_response_format.py::test_toggle_returns_changed_state", "type": "Coroutine", "lineno": 95}, {"nodeid": "tests/entity/test_service_response_format.py::test_turn_off_returns_changed_state", "type": "Coroutine", "lineno": 108}, {"nodeid": "tests/entity/test_service_response_format.py::test_climate_service_returns_changed", "type": "Coroutine", "lineno": 121}, {"nodeid": "tests/entity/test_service_response_format.py::test_lock_service_returns_changed", "type": "Coroutine", "lineno": 136}]}, {"nodeid": "tests/entity/test_siren_valve.py", "outcome": "passed", "result": [{"nodeid": "tests/entity/test_siren_valve.py::test_siren_turn_on", "type": "Coroutine", "lineno": 15}, {"nodeid": "tests/entity/test_siren_valve.py::test_siren_turn_off", "type": "Coroutine", "lineno": 25}, {"nodeid": "tests/entity/test_siren_valve.py::test_siren_toggle", "type": "Coroutine", "lineno": 35}, {"nodeid": "tests/entity/test_siren_valve.py::test_valve_open", "type": "Coroutine", "lineno": 51}, {"nodeid": "tests/entity/test_siren_valve.py::test_valve_close", "type": "Coroutine", "lineno": 61}, {"nodeid": "tests/entity/test_siren_valve.py::test_valve_toggle", "type": "Coroutine", "lineno": 71}, {"nodeid": "tests/entity/test_siren_valve.py::test_alarm_lifecycle", "type": "Coroutine", "lineno": 87}]}, {"nodeid": "tests/entity/test_state_edge_cases.py", "outcome": "passed", "result": [{"nodeid": "tests/entity/test_state_edge_cases.py::test_state_with_spaces", "type": "Coroutine", "lineno": 18}, {"nodeid": "tests/entity/test_state_edge_cases.py::test_state_with_unicode", "type": "Coroutine", "lineno": 25}, {"nodeid": "tests/entity/test_state_edge_cases.py::test_state_with_empty_string", "type": "Coroutine", "lineno": 32}, {"nodeid": "tests/entity/test_state_edge_cases.py::test_state_long_value", "type": "Coroutine", "lineno": 39}, {"nodeid": "tests/entity/test_state_edge_cases.py::test_attributes_preserve_types", "type": "Coroutine", "lineno": 49}, {"nodeid": "tests/entity/test_state_edge_cases.py::test_attributes_nested_object", "type": "Coroutine", "lineno": 69}, {"nodeid": "tests/entity/test_state_edge_cases.py::test_attributes_overwrite_on_update", "type": "Coroutine", "lineno": 77}, {"nodeid": "tests/entity/test_state_edge_cases.py::test_state_has_last_changed", "type": "Coroutine", "lineno": 90}, {"nodeid": "tests/entity/test_state_edge_cases.py::test_state_has_last_updated", "type": "Coroutine", "lineno": 98}, {"nodeid": "tests/entity/test_state_edge_cases.py::test_timestamps_update_on_change", "type": "Coroutine", "lineno": 105}, {"nodeid": "tests/entity/test_state_edge_cases.py::test_concurrent_state_updates", "type": "Coroutine", "lineno": 117}, {"nodeid": "tests/entity/test_state_edge_cases.py::test_entity_id_with_numbers", "type": "Coroutine", "lineno": 132}, {"nodeid": "tests/entity/test_state_edge_cases.py::test_entity_id_with_underscores", "type": "Coroutine", "lineno": 139}, {"nodeid": "tests/entity/test_state_edge_cases.py::test_states_returns_all_entities", "type": "Coroutine", "lineno": 148}, {"nodeid": "tests/entity/test_state_edge_cases.py::test_states_entity_format", "type": "Coroutine", "lineno": 157}, {"nodeid": "tests/entity/test_state_edge_cases.py::test_set_state_returns_entity", "type": "Coroutine", "lineno": 170}]}, {"nodeid": "tests/entity/test_stub_services.py", "outcome": "passed", "result": [{"nodeid": "tests/entity/test_stub_services.py::test_script_turn_on", "type": "Coroutine", "lineno": 15}, {"nodeid": "tests/entity/test_stub_services.py::test_script_reload", "type": "Coroutine", "lineno": 25}, {"nodeid": "tests/entity/test_stub_services.py::test_notify_send_message", "type": "Coroutine", "lineno": 37}, {"nodeid": "tests/entity/test_stub_services.py::test_weather_get_forecasts", "type": "Coroutine", "lineno": 49}, {"nodeid": "tests/entity/test_stub_services.py::test_image_reload", "type": "Coroutine", "lineno": 61}, {"nodeid": "tests/entity/test_stub_services.py::test_person_reload", "type": "Coroutine", "lineno": 73}, {"nodeid": "tests/entity/test_stub_services.py::test_zone_reload", "type": "Coroutine", "lineno": 83}, {"nodeid": "tests/entity/test_stub_services.py::test_homeassistant_restart", "type": "Coroutine", "lineno": 95}, {"nodeid": "tests/entity/test_stub_services.py::test_homeassistant_stop", "type": "Coroutine", "lineno": 105}, {"nodeid": "tests/entity/test_stub_services.py::test_homeassistant_reload_core_config", "type": "Coroutine", "lineno": 115}, {"nodeid": "tests/entity/test_stub_services.py::test_button_press", "type": "Coroutine", "lineno": 127}, {"nodeid": "tests/entity/test_stub_services.py::test_input_datetime_set", "type": "Coroutine", "lineno": 139}, {"nodeid": "tests/entity/test_stub_services.py::test_input_datetime_set_time", "type": "Coroutine", "lineno": 150}, {"nodeid": "tests/entity/test_stub_services.py::test_homeassistant_turn_on_generic", "type": "Coroutine", "lineno": 163}, {"nodeid": "tests/entity/test_stub_services.py::test_homeassistant_turn_off_generic", "type": "Coroutine", "lineno": 173}, {"nodeid": "tests/entity/test_stub_services.py::test_homeassistant_toggle_generic", "type": "Coroutine", "lineno": 183}]}, {"nodeid": "tests/entity/test_timer_counter.py", "outcome": "passed", "result": [{"nodeid": "tests/entity/test_timer_counter.py::test_timer_service[idle-start-active]", "type": "Coroutine", "lineno": 14}, {"nodeid": "tests/entity/test_timer_counter.py::test_timer_service[active-pause-paused]", "type": "Coroutine", "lineno": 14}, {"nodeid": "tests/entity/test_timer_counter.py::test_timer_service[active-cancel-idle]", "type": "Coroutine", "lineno": 14}, {"nodeid": "tests/entity/test_timer_counter.py::test_timer_service[active-finish-idle]", "type": "Coroutine", "lineno": 14}, {"nodeid": "tests/entity/test_timer_counter.py::test_timer_lifecycle", "type": "Coroutine", "lineno": 29}, {"nodeid": "tests/entity/test_timer_counter.py::test_counter_increment", "type": "Coroutine", "lineno": 53}, {"nodeid": "tests/entity/test_timer_counter.py::test_counter_decrement", "type": "Coroutine", "lineno": 62}, {"nodeid": "tests/entity/test_timer_counter.py::test_counter_reset[42-initial_attr0-0]", "type": "Coroutine", "lineno": 71}, {"nodeid": "tests/entity/test_timer_counter.py::test_counter_reset[99-initial_attr1-10]", "type": "Coroutine", "lineno": 71}, {"nodeid": "tests/entity/test_timer_counter.py::test_counter_reset[10-initial_attr2-5]", "type": "Coroutine", "lineno": 71}, {"nodeid": "tests/entity/test_timer_counter.py::test_counter_reset[5-initial_attr3-0]", "type": "Coroutine", "lineno": 71}, {"nodeid": "tests/entity/test_timer_counter.py::test_counter_multiple_increments", "type": "Coroutine", "lineno": 86}, {"nodeid": "tests/entity/test_timer_counter.py::test_counter_negative", "type": "Coroutine", "lineno": 96}, {"nodeid": "tests/entity/test_timer_counter.py::test_counter_preserves_attrs", "type": "Coroutine", "lineno": 107}]}, {"nodeid": "tests/entity/test_timer_counter_humidifier_text.py", "outcome": "passed", "result": [{"nodeid": "tests/entity/test_timer_counter_humidifier_text.py::test_timer_start", "type": "Coroutine", "lineno": 16}, {"nodeid": "tests/entity/test_timer_counter_humidifier_text.py::test_timer_pause", "type": "Coroutine", "lineno": 33}, {"nodeid": "tests/entity/test_timer_counter_humidifier_text.py::test_timer_cancel", "type": "Coroutine", "lineno": 50}, {"nodeid": "tests/entity/test_timer_counter_humidifier_text.py::test_timer_finish", "type": "Coroutine", "lineno": 67}, {"nodeid": "tests/entity/test_timer_counter_humidifier_text.py::test_counter_increment", "type": "Coroutine", "lineno": 86}, {"nodeid": "tests/entity/test_timer_counter_humidifier_text.py::test_counter_decrement", "type": "Coroutine", "lineno": 103}, {"nodeid": "tests/entity/test_timer_counter_humidifier_text.py::test_counter_reset_with_initial", "type": "Coroutine", "lineno": 120}, {"nodeid": "tests/entity/test_timer_counter_humidifier_text.py::test_counter_reset_default_zero", "type": "Coroutine", "lineno": 137}, {"nodeid": "tests/entity/test_timer_counter_humidifier_text.py::test_counter_increment_from_zero", "type": "Coroutine", "lineno": 153}, {"nodeid": "tests/entity/test_timer_counter_humidifier_text.py::test_counter_decrement_below_zero", "type": "Coroutine", "lineno": 169}, {"nodeid": "tests/entity/test_timer_counter_humidifier_text.py::test_humidifier_turn_on", "type": "Coroutine", "lineno": 187}, {"nodeid": "tests/entity/test_timer_counter_humidifier_text.py::test_humidifier_turn_off", "type": "Coroutine", "lineno": 203}, {"nodeid": "tests/entity/test_timer_counter_humidifier_text.py::test_humidifier_toggle", "type": "Coroutine", "lineno": 219}, {"nodeid": "tests/entity/test_timer_counter_humidifier_text.py::test_humidifier_set_humidity", "type": "Coroutine", "lineno": 235}, {"nodeid": "tests/entity/test_timer_counter_humidifier_text.py::test_humidifier_set_mode", "type": "Coroutine", "lineno": 251}, {"nodeid": "tests/entity/test_timer_counter_humidifier_text.py::test_text_set_value", "type": "Coroutine", "lineno": 269}, {"nodeid": "tests/entity/test_timer_counter_humidifier_text.py::test_text_set_empty_value", "type": "Coroutine", "lineno": 285}, {"nodeid": "tests/entity/test_timer_counter_humidifier_text.py::test_input_datetime_set_datetime", "type": "Coroutine", "lineno": 303}, {"nodeid": "tests/entity/test_timer_counter_humidifier_text.py::test_input_datetime_set_date", "type": "Coroutine", "lineno": 319}, {"nodeid": "tests/entity/test_timer_counter_humidifier_text.py::test_input_datetime_set_time", "type": "Coroutine", "lineno": 335}]}, {"nodeid": "tests/entity/test_toggle_semantics.py", "outcome": "passed", "result": [{"nodeid": "tests/entity/test_toggle_semantics.py::test_light_toggle_on_to_off", "type": "Coroutine", "lineno": 14}, {"nodeid": "tests/entity/test_toggle_semantics.py::test_light_toggle_off_to_on", "type": "Coroutine", "lineno": 23}, {"nodeid": "tests/entity/test_toggle_semantics.py::test_switch_toggle_roundtrip", "type": "Coroutine", "lineno": 32}, {"nodeid": "tests/entity/test_toggle_semantics.py::test_fan_toggle_roundtrip", "type": "Coroutine", "lineno": 43}, {"nodeid": "tests/entity/test_toggle_semantics.py::test_siren_toggle_roundtrip", "type": "Coroutine", "lineno": 54}, {"nodeid": "tests/entity/test_toggle_semantics.py::test_cover_toggle_roundtrip", "type": "Coroutine", "lineno": 65}, {"nodeid": "tests/entity/test_toggle_semantics.py::test_valve_toggle_roundtrip", "type": "Coroutine", "lineno": 76}, {"nodeid": "tests/entity/test_toggle_semantics.py::test_humidifier_toggle_roundtrip", "type": "Coroutine", "lineno": 87}, {"nodeid": "tests/entity/test_toggle_semantics.py::test_input_boolean_toggle_roundtrip", "type": "Coroutine", "lineno": 98}, {"nodeid": "tests/entity/test_toggle_semantics.py::test_homeassistant_toggle_roundtrip", "type": "Coroutine", "lineno": 109}, {"nodeid": "tests/entity/test_toggle_semantics.py::test_generic_fallback_toggle", "type": "Coroutine", "lineno": 120}]}, {"nodeid": "tests/entity", "outcome": "passed", "result": [{"nodeid": "tests/entity/test_alarm_climate_water_heater.py", "type": "Module"}, {"nodeid": "tests/entity/test_attribute_preservation.py", "type": "Module"}, {"nodeid": "tests/entity/test_climate_extended.py", "type": "Module"}, {"nodeid": "tests/entity/test_domain_state_formats.py", "type": "Module"}, {"nodeid": "tests/entity/test_domain_toggles.py", "type": "Module"}, {"nodeid": "tests/entity/test_entity_delete.py", "type": "Module"}, {"nodeid": "tests/entity/test_entity_format_consistency.py", "type": "Module"}, {"nodeid": "tests/entity/test_extended_domains.py", "type": "Module"}, {"nodeid": "tests/entity/test_fan_cover_extended.py", "type": "Module"}, {"nodeid": "tests/entity/test_generic_fallback_services.py", "type": "Module"}, {"nodeid": "tests/entity/test_homeassistant_domain_services.py", "type": "Module"}, {"nodeid": "tests/entity/test_homeassistant_service.py", "type": "Module"}, {"nodeid": "tests/entity/test_input_number_select_button.py", "type": "Module"}, {"nodeid": "tests/entity/test_media_player_extended.py", "type": "Module"}, {"nodeid": "tests/entity/test_media_player_lock_camera_group.py", "type": "Module"}, {"nodeid": "tests/entity/test_media_player_state_transitions.py", "type": "Module"}, {"nodeid": "tests/entity/test_multi_entity_operations.py", "type": "Module"}, {"nodeid": "tests/entity/test_new_domains.py", "type": "Module"}, {"nodeid": "tests/entity/test_number_select.py", "type": "Module"}, {"nodeid": "tests/entity/test_person_zone_weather.py", "type": "Module"}, {"nodeid": "tests/entity/test_scene_activation.py", "type": "Module"}, {"nodeid": "tests/entity/test_service_attribute_passthrough.py", "type": "Module"}, {"nodeid": "tests/entity/test_service_data_validation.py", "type": "Module"}, {"nodeid": "tests/entity/test_service_edge_cases.py", "type": "Module"}, {"nodeid": "tests/entity/test_service_interactions.py", "type": "Module"}, {"nodeid": "tests/entity/test_service_response_format.py", "type": "Module"}, {"nodeid": "tests/entity/test_siren_valve.py", "type": "Module"}, {"nodeid": "tests/entity/test_state_edge_cases.py", "type": "Module"}, {"nodeid": "tests/entity/test_stub_services.py", "type": "Module"}, {"nodeid": "tests/entity/test_timer_counter.py", "type": "Module"}, {"nodeid": "tests/entity/test_timer_counter_humidifier_text.py", "type": "Module"}, {"nodeid": "tests/entity/test_toggle_semantics.py", "type": "Module"}]}, {"nodeid": "tests/integration/test_cross_api.py", "outcome": "passed", "result": [{"nodeid": "tests/integration/test_cross_api.py::test_rest_set_ws_read", "type": "Coroutine", "lineno": 14}, {"nodeid": "tests/integration/test_cross_api.py::test_ws_service_rest_read", "type": "Coroutine", "lineno": 24}, {"nodeid": "tests/integration/test_cross_api.py::test_rest_service_ws_event", "type": "Coroutine", "lineno": 37}, {"nodeid": "tests/integration/test_cross_api.py::test_scene_via_rest_ws_verify", "type": "Coroutine", "lineno": 48}, {"nodeid": "tests/integration/test_cross_api.py::test_config_consistent_rest_ws", "type": "Coroutine", "lineno": 60}, {"nodeid": "tests/integration/test_cross_api.py::test_services_consistent_rest_ws", "type": "Coroutine", "lineno": 71}, {"nodeid": "tests/integration/test_cross_api.py::test_delete_via_rest_invisible_ws", "type": "Coroutine", "lineno": 87}, {"nodeid": "tests/integration/test_cross_api.py::test_health_ws_connections_accurate", "type": "Coroutine", "lineno": 101}]}, {"nodeid": "tests/integration/test_cross_feature.py", "outcome": "passed", "result": [{"nodeid": "tests/integration/test_cross_feature.py::test_state_change_recorded_in_history", "type": "Coroutine", "lineno": 18}, {"nodeid": "tests/integration/test_cross_feature.py::test_service_call_appears_in_history", "type": "Coroutine", "lineno": 35}, {"nodeid": "tests/integration/test_cross_feature.py::test_service_call_triggers_ws_event", "type": "Coroutine", "lineno": 54}, {"nodeid": "tests/integration/test_cross_feature.py::test_automation_trigger_changes_state", "type": "Coroutine", "lineno": 68}, {"nodeid": "tests/integration/test_cross_feature.py::test_scene_activation_triggers_ws_events", "type": "Coroutine", "lineno": 85}, {"nodeid": "tests/integration/test_cross_feature.py::test_template_reflects_service_change", "type": "Coroutine", "lineno": 107}, {"nodeid": "tests/integration/test_cross_feature.py::test_area_search_reflects_state_changes", "type": "Coroutine", "lineno": 123}, {"nodeid": "tests/integration/test_cross_feature.py::test_webhook_state_triggers_ws_event", "type": "Coroutine", "lineno": 152}, {"nodeid": "tests/integration/test_cross_feature.py::test_logbook_records_service_changes", "type": "Coroutine", "lineno": 170}, {"nodeid": "tests/integration/test_cross_feature.py::test_health_state_changes_increment", "type": "Coroutine", "lineno": 188}]}, {"nodeid": "tests/integration/test_end_to_end.py", "outcome": "passed", "result": [{"nodeid": "tests/integration/test_end_to_end.py::test_set_state_and_read_back", "type": "Coroutine", "lineno": 44}, {"nodeid": "tests/integration/test_end_to_end.py::test_service_call_changes_state", "type": "Coroutine", "lineno": 55}, {"nodeid": "tests/integration/test_end_to_end.py::test_ws_receives_state_change", "type": "Coroutine", "lineno": 67}, {"nodeid": "tests/integration/test_end_to_end.py::test_discovery_creates_entity_then_service_controls", "type": "Coroutine", "lineno": 77}, {"nodeid": "tests/integration/test_end_to_end.py::test_mqtt_bridge_updates_state", "type": "Coroutine", "lineno": 107}, {"nodeid": "tests/integration/test_end_to_end.py::test_discovery_state_update_with_template", "type": "Coroutine", "lineno": 117}, {"nodeid": "tests/integration/test_end_to_end.py::test_automation_trigger_fires_actions", "type": "Coroutine", "lineno": 137}, {"nodeid": "tests/integration/test_end_to_end.py::test_scene_activation_multiple_entities", "type": "Coroutine", "lineno": 155}, {"nodeid": "tests/integration/test_end_to_end.py::test_health_after_operations", "type": "Coroutine", "lineno": 174}]}, {"nodeid": "tests/integration/test_esphome_zwave_bridge.py", "outcome": "passed", "result": [{"nodeid": "tests/integration/test_esphome_zwave_bridge.py::test_zwave_node_update", "type": "Coroutine", "lineno": 44}, {"nodeid": "tests/integration/test_esphome_zwave_bridge.py::test_zwave_node_value", "type": "Coroutine", "lineno": 58}, {"nodeid": "tests/integration/test_esphome_zwave_bridge.py::test_zwave_gateway_status", "type": "Coroutine", "lineno": 68}, {"nodeid": "tests/integration/test_esphome_zwave_bridge.py::test_zwave_node_list", "type": "Coroutine", "lineno": 74}, {"nodeid": "tests/integration/test_esphome_zwave_bridge.py::test_esphome_status_online", "type": "Coroutine", "lineno": 87}, {"nodeid": "tests/integration/test_esphome_zwave_bridge.py::test_esphome_status_offline", "type": "Coroutine", "lineno": 95}, {"nodeid": "tests/integration/test_esphome_zwave_bridge.py::test_esphome_sensor_state", "type": "Coroutine", "lineno": 105}, {"nodeid": "tests/integration/test_esphome_zwave_bridge.py::test_esphome_switch_state", "type": "Coroutine", "lineno": 117}, {"nodeid": "tests/integration/test_esphome_zwave_bridge.py::test_esphome_binary_sensor", "type": "Coroutine", "lineno": 127}]}, {"nodeid": "tests/integration/test_history_logbook_integration.py", "outcome": "passed", "result": [{"nodeid": "tests/integration/test_history_logbook_integration.py::test_history_returns_200", "type": "Coroutine", "lineno": 17}, {"nodeid": "tests/integration/test_history_logbook_integration.py::test_history_returns_list", "type": "Coroutine", "lineno": 31}, {"nodeid": "tests/integration/test_history_logbook_integration.py::test_history_entry_has_fields", "type": "Coroutine", "lineno": 46}, {"nodeid": "tests/integration/test_history_logbook_integration.py::test_history_records_state_change", "type": "Coroutine", "lineno": 66}, {"nodeid": "tests/integration/test_history_logbook_integration.py::test_history_preserves_order", "type": "Coroutine", "lineno": 87}, {"nodeid": "tests/integration/test_history_logbook_integration.py::test_history_empty_for_unknown_entity", "type": "Coroutine", "lineno": 106}, {"nodeid": "tests/integration/test_history_logbook_integration.py::test_global_logbook_returns_200", "type": "Coroutine", "lineno": 119}, {"nodeid": "tests/integration/test_history_logbook_integration.py::test_global_logbook_returns_list", "type": "Coroutine", "lineno": 128}, {"nodeid": "tests/integration/test_history_logbook_integration.py::test_global_logbook_entry_has_fields", "type": "Coroutine", "lineno": 138}, {"nodeid": "tests/integration/test_history_logbook_integration.py::test_entity_logbook_returns_200", "type": "Coroutine", "lineno": 161}, {"nodeid": "tests/integration/test_history_logbook_integration.py::test_entity_logbook_only_shows_changes", "type": "Coroutine", "lineno": 175}]}, {"nodeid": "tests/integration/test_mqtt_discovery_entities.py", "outcome": "passed", "result": [{"nodeid": "tests/integration/test_mqtt_discovery_entities.py::test_discovery_sensor_creates_entity", "type": "Coroutine", "lineno": 42}, {"nodeid": "tests/integration/test_mqtt_discovery_entities.py::test_discovery_binary_sensor", "type": "Coroutine", "lineno": 62}, {"nodeid": "tests/integration/test_mqtt_discovery_entities.py::test_discovery_switch", "type": "Coroutine", "lineno": 83}, {"nodeid": "tests/integration/test_mqtt_discovery_entities.py::test_discovery_light", "type": "Coroutine", "lineno": 104}, {"nodeid": "tests/integration/test_mqtt_discovery_entities.py::test_discovery_empty_payload_removes_entity", "type": "Coroutine", "lineno": 125}, {"nodeid": "tests/integration/test_mqtt_discovery_entities.py::test_discovery_with_device_info", "type": "Coroutine", "lineno": 149}, {"nodeid": "tests/integration/test_mqtt_discovery_entities.py::test_discovery_with_value_template", "type": "Coroutine", "lineno": 170}, {"nodeid": "tests/integration/test_mqtt_discovery_entities.py::test_discovery_climate", "type": "Coroutine", "lineno": 197}, {"nodeid": "tests/integration/test_mqtt_discovery_entities.py::test_discovery_cover", "type": "Coroutine", "lineno": 219}, {"nodeid": "tests/integration/test_mqtt_discovery_entities.py::test_discovery_with_availability", "type": "Coroutine", "lineno": 240}, {"nodeid": "tests/integration/test_mqtt_discovery_entities.py::test_discovery_four_level_topic", "type": "Coroutine", "lineno": 255}]}, {"nodeid": "tests/integration/test_service_history_flow.py", "outcome": "passed", "result": [{"nodeid": "tests/integration/test_service_history_flow.py::test_service_state_in_history", "type": "Coroutine", "lineno": 17}, {"nodeid": "tests/integration/test_service_history_flow.py::test_multiple_service_calls_in_history", "type": "Coroutine", "lineno": 38}, {"nodeid": "tests/integration/test_service_history_flow.py::test_history_entry_has_required_fields", "type": "Coroutine", "lineno": 61}, {"nodeid": "tests/integration/test_service_history_flow.py::test_history_attributes_preserved", "type": "Coroutine", "lineno": 81}, {"nodeid": "tests/integration/test_service_history_flow.py::test_history_empty_for_nonexistent", "type": "Coroutine", "lineno": 104}, {"nodeid": "tests/integration/test_service_history_flow.py::test_statistics_after_numeric_states", "type": "Coroutine", "lineno": 117}, {"nodeid": "tests/integration/test_service_history_flow.py::test_logbook_after_service_call", "type": "Coroutine", "lineno": 143}, {"nodeid": "tests/integration/test_service_history_flow.py::test_history_ordered_chronologically", "type": "Coroutine", "lineno": 161}, {"nodeid": "tests/integration/test_service_history_flow.py::test_delete_entity_history_persists", "type": "Coroutine", "lineno": 181}]}, {"nodeid": "tests/integration/test_tasmota_bridge.py", "outcome": "passed", "result": [{"nodeid": "tests/integration/test_tasmota_bridge.py::test_tasmota_lwt_online", "type": "Coroutine", "lineno": 41}, {"nodeid": "tests/integration/test_tasmota_bridge.py::test_tasmota_power_on", "type": "Coroutine", "lineno": 54}, {"nodeid": "tests/integration/test_tasmota_bridge.py::test_tasmota_power_off", "type": "Coroutine", "lineno": 71}, {"nodeid": "tests/integration/test_tasmota_bridge.py::test_tasmota_tele_state", "type": "Coroutine", "lineno": 86}, {"nodeid": "tests/integration/test_tasmota_bridge.py::test_tasmota_tele_sensor", "type": "Coroutine", "lineno": 99}, {"nodeid": "tests/integration/test_tasmota_bridge.py::test_tasmota_lwt_offline", "type": "Coroutine", "lineno": 114}, {"nodeid": "tests/integration/test_tasmota_bridge.py::test_tasmota_multi_relay", "type": "Coroutine", "lineno": 127}]}, {"nodeid": "tests/integration/test_webhook_event_integration.py", "outcome": "passed", "result": [{"nodeid": "tests/integration/test_webhook_event_integration.py::test_webhook_sets_entity_state", "type": "Coroutine", "lineno": 20}, {"nodeid": "tests/integration/test_webhook_event_integration.py::test_webhook_sets_state_with_attributes", "type": "Coroutine", "lineno": 38}, {"nodeid": "tests/integration/test_webhook_event_integration.py::test_webhook_overwrites_existing_state", "type": "Coroutine", "lineno": 59}, {"nodeid": "tests/integration/test_webhook_event_integration.py::test_webhook_fires_event", "type": "Coroutine", "lineno": 78}, {"nodeid": "tests/integration/test_webhook_event_integration.py::test_webhook_default_fires_webhook_event", "type": "Coroutine", "lineno": 91}, {"nodeid": "tests/integration/test_webhook_event_integration.py::test_webhook_empty_body", "type": "Coroutine", "lineno": 105}, {"nodeid": "tests/integration/test_webhook_event_integration.py::test_webhook_event_triggers_automation", "type": "Coroutine", "lineno": 120}, {"nodeid": "tests/integration/test_webhook_event_integration.py::test_webhook_state_set_triggers_automation", "type": "Coroutine", "lineno": 146}, {"nodeid": "tests/integration/test_webhook_event_integration.py::test_rapid_webhook_state_updates", "type": "Coroutine", "lineno": 172}, {"nodeid": "tests/integration/test_webhook_event_integration.py::test_webhook_different_ids_independent", "type": "Coroutine", "lineno": 186}]}, {"nodeid": "tests/integration/test_zigbee2mqtt_bridge.py", "outcome": "passed", "result": [{"nodeid": "tests/integration/test_zigbee2mqtt_bridge.py::test_z2m_bridge_state_online", "type": "Coroutine", "lineno": 42}, {"nodeid": "tests/integration/test_zigbee2mqtt_bridge.py::test_z2m_bridge_state_offline", "type": "Coroutine", "lineno": 52}, {"nodeid": "tests/integration/test_zigbee2mqtt_bridge.py::test_z2m_device_state_update", "type": "Coroutine", "lineno": 61}, {"nodeid": "tests/integration/test_zigbee2mqtt_bridge.py::test_z2m_bridge_devices_message", "type": "Coroutine", "lineno": 78}, {"nodeid": "tests/integration/test_zigbee2mqtt_bridge.py::test_z2m_device_availability", "type": "Coroutine", "lineno": 107}, {"nodeid": "tests/integration/test_zigbee2mqtt_bridge.py::test_z2m_bridge_groups", "type": "Coroutine", "lineno": 116}, {"nodeid": "tests/integration/test_zigbee2mqtt_bridge.py::test_z2m_device_set_command", "type": "Coroutine", "lineno": 132}]}, {"nodeid": "tests/integration", "outcome": "passed", "result": [{"nodeid": "tests/integration/test_cross_api.py", "type": "Module"}, {"nodeid": "tests/integration/test_cross_feature.py", "type": "Module"}, {"nodeid": "tests/integration/test_end_to_end.py", "type": "Module"}, {"nodeid": "tests/integration/test_esphome_zwave_bridge.py", "type": "Module"}, {"nodeid": "tests/integration/test_history_logbook_integration.py", "type": "Module"}, {"nodeid": "tests/integration/test_mqtt_discovery_entities.py", "type": "Module"}, {"nodeid": "tests/integration/test_service_history_flow.py", "type": "Module"}, {"nodeid": "tests/integration/test_tasmota_bridge.py", "type": "Module"}, {"nodeid": "tests/integration/test_webhook_event_integration.py", "type": "Module"}, {"nodeid": "tests/integration/test_zigbee2mqtt_bridge.py", "type": "Module"}]}, {"nodeid": "tests/performance/test_health_metric_accuracy.py", "outcome": "passed", "result": [{"nodeid": "tests/performance/test_health_metric_accuracy.py::test_state_changes_increments_on_set", "type": "Coroutine", "lineno": 15}, {"nodeid": "tests/performance/test_health_metric_accuracy.py::test_entity_count_increases_on_create", "type": "Coroutine", "lineno": 34}, {"nodeid": "tests/performance/test_health_metric_accuracy.py::test_uptime_increases", "type": "Coroutine", "lineno": 53}, {"nodeid": "tests/performance/test_health_metric_accuracy.py::test_health_has_status_ok", "type": "Coroutine", "lineno": 71}, {"nodeid": "tests/performance/test_health_metric_accuracy.py::test_health_has_version", "type": "Coroutine", "lineno": 80}, {"nodeid": "tests/performance/test_health_metric_accuracy.py::test_health_has_startup_us", "type": "Coroutine", "lineno": 91}, {"nodeid": "tests/performance/test_health_metric_accuracy.py::test_health_has_startup_ms", "type": "Coroutine", "lineno": 102}, {"nodeid": "tests/performance/test_health_metric_accuracy.py::test_health_has_latency_metrics", "type": "Coroutine", "lineno": 113}, {"nodeid": "tests/performance/test_health_metric_accuracy.py::test_health_has_ws_connections", "type": "Coroutine", "lineno": 126}, {"nodeid": "tests/performance/test_health_metric_accuracy.py::test_health_has_memory_metrics", "type": "Coroutine", "lineno": 137}, {"nodeid": "tests/performance/test_health_metric_accuracy.py::test_health_rss_mb_matches_kb", "type": "Coroutine", "lineno": 149}, {"nodeid": "tests/performance/test_health_metric_accuracy.py::test_health_events_fired_nonnegative", "type": "Coroutine", "lineno": 160}, {"nodeid": "tests/performance/test_health_metric_accuracy.py::test_health_sim_fields_present", "type": "Coroutine", "lineno": 171}]}, {"nodeid": "tests/performance/test_latency_throughput.py", "outcome": "passed", "result": [{"nodeid": "tests/performance/test_latency_throughput.py::test_state_set_latency", "type": "Coroutine", "lineno": 20}, {"nodeid": "tests/performance/test_latency_throughput.py::test_state_get_latency", "type": "Coroutine", "lineno": 35}, {"nodeid": "tests/performance/test_latency_throughput.py::test_sequential_state_throughput", "type": "Coroutine", "lineno": 54}, {"nodeid": "tests/performance/test_latency_throughput.py::test_concurrent_state_throughput", "type": "Coroutine", "lineno": 70}, {"nodeid": "tests/performance/test_latency_throughput.py::test_service_call_latency", "type": "Coroutine", "lineno": 92}, {"nodeid": "tests/performance/test_latency_throughput.py::test_health_endpoint_latency", "type": "Coroutine", "lineno": 112}, {"nodeid": "tests/performance/test_latency_throughput.py::test_config_endpoint_latency", "type": "Coroutine", "lineno": 122}, {"nodeid": "tests/performance/test_latency_throughput.py::test_search_latency", "type": "Coroutine", "lineno": 132}, {"nodeid": "tests/performance/test_latency_throughput.py::test_template_render_latency", "type": "Coroutine", "lineno": 146}]}, {"nodeid": "tests/performance/test_throughput.py", "outcome": "passed", "result": [{"nodeid": "tests/performance/test_throughput.py::test_state_set_throughput", "type": "Coroutine", "lineno": 19}, {"nodeid": "tests/performance/test_throughput.py::test_state_get_throughput", "type": "Coroutine", "lineno": 35}, {"nodeid": "tests/performance/test_throughput.py::test_concurrent_state_sets", "type": "Coroutine", "lineno": 58}, {"nodeid": "tests/performance/test_throughput.py::test_health_endpoint_fast", "type": "Coroutine", "lineno": 72}, {"nodeid": "tests/performance/test_throughput.py::test_service_call_throughput", "type": "Coroutine", "lineno": 82}, {"nodeid": "tests/performance/test_throughput.py::test_template_render_throughput", "type": "Coroutine", "lineno": 106}, {"nodeid": "tests/performance/test_throughput.py::test_search_throughput", "type": "Coroutine", "lineno": 123}]}, {"nodeid": "tests/performance", "outcome": "passed", "result": [{"nodeid": "tests/performance/test_health_metric_accuracy.py", "type": "Module"}, {"nodeid": "tests/performance/test_latency_throughput.py", "type": "Module"}, {"nodeid": "tests/performance/test_throughput.py", "type": "Module"}]}, {"nodeid": "tests/test_cast.py", "outcome": "passed", "result": [{"nodeid": "tests/test_cast.py::test_cast_appears_in_integration_list", "type": "Coroutine", "lineno": 20}, {"nodeid": "tests/test_cast.py::test_cast_integration_entry_has_required_fields", "type": "Coroutine", "lineno": 32}, {"nodeid": "tests/test_cast.py::test_cast_integration_inactive_when_no_devices", "type": "Coroutine", "lineno": 47}, {"nodeid": "tests/test_cast.py::test_cast_status_endpoint_returns_200", "type": "Coroutine", "lineno": 61}, {"nodeid": "tests/test_cast.py::test_cast_status_has_device_count", "type": "Coroutine", "lineno": 70}, {"nodeid": "tests/test_cast.py::test_cast_status_has_devices_list", "type": "Coroutine", "lineno": 81}, {"nodeid": "tests/test_cast.py::test_cast_status_empty_when_no_devices", "type": "Coroutine", "lineno": 92}, {"nodeid": "tests/test_cast.py::test_cast_status_device_count_matches_devices_length", "type": "Coroutine", "lineno": 103}, {"nodeid": "tests/test_cast.py::test_cast_discover_missing_ip_returns_400", "type": "Coroutine", "lineno": 115}, {"nodeid": "tests/test_cast.py::test_cast_discover_null_ip_returns_400", "type": "Coroutine", "lineno": 125}, {"nodeid": "tests/test_cast.py::test_cast_discover_numeric_ip_returns_400", "type": "Coroutine", "lineno": 135}, {"nodeid": "tests/test_cast.py::test_cast_media_player_entity_naming", "type": "Coroutine", "lineno": 147}, {"nodeid": "tests/test_cast.py::test_cast_entities_appear_in_global_state_list", "type": "Coroutine", "lineno": 163}, {"nodeid": "tests/test_cast.py::test_cast_entity_services_work", "type": "Coroutine", "lineno": 173}]}, {"nodeid": "tests/test_hue.py", "outcome": "passed", "result": [{"nodeid": "tests/test_hue.py::test_hue_appears_in_integration_list", "type": "Coroutine", "lineno": 21}, {"nodeid": "tests/test_hue.py::test_hue_integration_entry_has_required_fields", "type": "Coroutine", "lineno": 33}, {"nodeid": "tests/test_hue.py::test_hue_integration_inactive_when_no_bridges", "type": "Coroutine", "lineno": 48}, {"nodeid": "tests/test_hue.py::test_hue_status_endpoint_returns_200", "type": "Coroutine", "lineno": 62}, {"nodeid": "tests/test_hue.py::test_hue_status_has_bridges_list", "type": "Coroutine", "lineno": 71}, {"nodeid": "tests/test_hue.py::test_hue_status_has_bridge_count", "type": "Coroutine", "lineno": 82}, {"nodeid": "tests/test_hue.py::test_hue_status_empty_when_no_bridges", "type": "Coroutine", "lineno": 93}, {"nodeid": "tests/test_hue.py::test_hue_pair_missing_ip_returns_400", "type": "Coroutine", "lineno": 106}, {"nodeid": "tests/test_hue.py::test_hue_pair_null_ip_returns_400", "type": "Coroutine", "lineno": 116}, {"nodeid": "tests/test_hue.py::test_hue_add_missing_fields_returns_400", "type": "Coroutine", "lineno": 128}, {"nodeid": "tests/test_hue.py::test_hue_add_missing_username_returns_400", "type": "Coroutine", "lineno": 138}, {"nodeid": "tests/test_hue.py::test_hue_light_entity_naming", "type": "Coroutine", "lineno": 150}, {"nodeid": "tests/test_hue.py::test_hue_sensor_entity_naming", "type": "Coroutine", "lineno": 168}, {"nodeid": "tests/test_hue.py::test_hue_entities_appear_in_global_state_list", "type": "Coroutine", "lineno": 184}]}, {"nodeid": "tests/test_matter.py", "outcome": "passed", "result": [{"nodeid": "tests/test_matter.py::test_matter_appears_in_integration_list", "type": "Coroutine", "lineno": 19}, {"nodeid": "tests/test_matter.py::test_matter_integration_entry_has_required_fields", "type": "Coroutine", "lineno": 31}, {"nodeid": "tests/test_matter.py::test_matter_integration_inactive_when_no_sidecar", "type": "Coroutine", "lineno": 46}, {"nodeid": "tests/test_matter.py::test_matter_status_endpoint_returns_200", "type": "Coroutine", "lineno": 60}, {"nodeid": "tests/test_matter.py::test_matter_status_has_device_count", "type": "Coroutine", "lineno": 69}, {"nodeid": "tests/test_matter.py::test_matter_status_has_devices_list", "type": "Coroutine", "lineno": 80}, {"nodeid": "tests/test_matter.py::test_matter_status_has_status_field", "type": "Coroutine", "lineno": 91}, {"nodeid": "tests/test_matter.py::test_matter_status_has_server_version", "type": "Coroutine", "lineno": 102}, {"nodeid": "tests/test_matter.py::test_matter_status_empty_when_no_sidecar", "type": "Coroutine", "lineno": 114}, {"nodeid": "tests/test_matter.py::test_matter_status_device_count_matches_devices_length", "type": "Coroutine", "lineno": 125}, {"nodeid": "tests/test_matter.py::test_matter_status_via_alias_path", "type": "Coroutine", "lineno": 135}, {"nodeid": "tests/test_matter.py::test_matter_light_entity_naming", "type": "Coroutine", "lineno": 149}, {"nodeid": "tests/test_matter.py::test_matter_lock_entity_naming", "type": "Coroutine", "lineno": 167}, {"nodeid": "tests/test_matter.py::test_matter_climate_entity_naming", "type": "Coroutine", "lineno": 182}, {"nodeid": "tests/test_matter.py::test_matter_entities_appear_in_global_state_list", "type": "Coroutine", "lineno": 198}, {"nodeid": "tests/test_matter.py::test_matter_entity_services_work", "type": "Coroutine", "lineno": 208}]}, {"nodeid": "tests/test_shelly.py", "outcome": "passed", "result": [{"nodeid": "tests/test_shelly.py::test_shelly_appears_in_integration_list", "type": "Coroutine", "lineno": 20}, {"nodeid": "tests/test_shelly.py::test_shelly_integration_entry_has_required_fields", "type": "Coroutine", "lineno": 32}, {"nodeid": "tests/test_shelly.py::test_shelly_integration_status_inactive_when_no_devices", "type": "Coroutine", "lineno": 47}, {"nodeid": "tests/test_shelly.py::test_shelly_status_endpoint_returns_200", "type": "Coroutine", "lineno": 63}, {"nodeid": "tests/test_shelly.py::test_shelly_status_has_device_count", "type": "Coroutine", "lineno": 72}, {"nodeid": "tests/test_shelly.py::test_shelly_status_has_devices_list", "type": "Coroutine", "lineno": 83}, {"nodeid": "tests/test_shelly.py::test_shelly_status_empty_when_no_devices", "type": "Coroutine", "lineno": 94}, {"nodeid": "tests/test_shelly.py::test_shelly_status_device_count_matches_devices_length", "type": "Coroutine", "lineno": 105}, {"nodeid": "tests/test_shelly.py::test_shelly_discover_missing_ip_returns_400", "type": "Coroutine", "lineno": 117}, {"nodeid": "tests/test_shelly.py::test_shelly_discover_null_ip_returns_400", "type": "Coroutine", "lineno": 127}, {"nodeid": "tests/test_shelly.py::test_shelly_discover_numeric_ip_returns_400", "type": "Coroutine", "lineno": 137}, {"nodeid": "tests/test_shelly.py::test_shelly_entity_naming_switch", "type": "Coroutine", "lineno": 153}, {"nodeid": "tests/test_shelly.py::test_shelly_entity_naming_light", "type": "Coroutine", "lineno": 172}, {"nodeid": "tests/test_shelly.py::test_shelly_entity_naming_sensor", "type": "Coroutine", "lineno": 189}, {"nodeid": "tests/test_shelly.py::test_shelly_entities_appear_in_global_state_list", "type": "Coroutine", "lineno": 206}, {"nodeid": "tests/test_shelly.py::test_shelly_entity_services_work", "type": "Coroutine", "lineno": 216}]}, {"nodeid": "tests/test_sonos.py", "outcome": "passed", "result": [{"nodeid": "tests/test_sonos.py::test_sonos_appears_in_integration_list", "type": "Coroutine", "lineno": 20}, {"nodeid": "tests/test_sonos.py::test_sonos_integration_entry_has_required_fields", "type": "Coroutine", "lineno": 32}, {"nodeid": "tests/test_sonos.py::test_sonos_integration_inactive_when_no_devices", "type": "Coroutine", "lineno": 47}, {"nodeid": "tests/test_sonos.py::test_sonos_status_endpoint_returns_200", "type": "Coroutine", "lineno": 61}, {"nodeid": "tests/test_sonos.py::test_sonos_status_has_device_count", "type": "Coroutine", "lineno": 70}, {"nodeid": "tests/test_sonos.py::test_sonos_status_has_devices_list", "type": "Coroutine", "lineno": 81}, {"nodeid": "tests/test_sonos.py::test_sonos_status_empty_when_no_devices", "type": "Coroutine", "lineno": 92}, {"nodeid": "tests/test_sonos.py::test_sonos_status_device_count_matches_devices_length", "type": "Coroutine", "lineno": 103}, {"nodeid": "tests/test_sonos.py::test_sonos_discover_missing_ip_returns_400", "type": "Coroutine", "lineno": 115}, {"nodeid": "tests/test_sonos.py::test_sonos_discover_null_ip_returns_400", "type": "Coroutine", "lineno": 125}, {"nodeid": "tests/test_sonos.py::test_sonos_discover_numeric_ip_returns_400", "type": "Coroutine", "lineno": 135}, {"nodeid": "tests/test_sonos.py::test_sonos_media_player_entity_naming", "type": "Coroutine", "lineno": 147}, {"nodeid": "tests/test_sonos.py::test_sonos_entities_appear_in_global_state_list", "type": "Coroutine", "lineno": 166}, {"nodeid": "tests/test_sonos.py::test_sonos_entity_services_work", "type": "Coroutine", "lineno": 176}]}, {"nodeid": "tests", "outcome": "passed", "result": [{"nodeid": "tests/api", "type": "Package"}, {"nodeid": "tests/automation", "type": "Package"}, {"nodeid": "tests/core", "type": "Dir"}, {"nodeid": "tests/entity", "type": "Dir"}, {"nodeid": "tests/integration", "type": "Package"}, {"nodeid": "tests/performance", "type": "Package"}, {"nodeid": "tests/test_cast.py", "type": "Module"}, {"nodeid": "tests/test_hue.py", "type": "Module"}, {"nodeid": "tests/test_matter.py", "type": "Module"}, {"nodeid": "tests/test_shelly.py", "type": "Module"}, {"nodeid": "tests/test_sonos.py", "type": "Module"}]}], "tests": [{"nodeid": "tests/api/test_api_misc_endpoints.py::test_api_root_status", "lineno": 15, "outcome": "passed", "keywords": ["test_api_root_status", "test_api_misc_endpoints.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.022186086978763342, "outcome": "passed"}, "call": {"duration": 0.008317094296216965, "outcome": "passed"}, "teardown": {"duration": 0.0005599190481007099, "outcome": "passed"}}, {"nodeid": "tests/api/test_api_misc_endpoints.py::test_list_services_returns_list", "lineno": 29, "outcome": "passed", "keywords": ["test_list_services_returns_list", "test_api_misc_endpoints.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.00561494892463088, "outcome": "passed"}, "call": {"duration": 0.004161418881267309, "outcome": "passed"}, "teardown": {"duration": 0.0004662820138037205, "outcome": "passed"}}, {"nodeid": "tests/api/test_api_misc_endpoints.py::test_list_services_has_domain", "lineno": 41, "outcome": "passed", "keywords": ["test_list_services_has_domain", "test_api_misc_endpoints.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005255532450973988, "outcome": "passed"}, "call": {"duration": 0.0027816761285066605, "outcome": "passed"}, "teardown": {"duration": 0.00043298909440636635, "outcome": "passed"}}, {"nodeid": "tests/api/test_api_misc_endpoints.py::test_list_services_has_light", "lineno": 53, "outcome": "failed", "keywords": ["test_list_services_has_light", "test_api_misc_endpoints.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005228959023952484, "outcome": "passed"}, "call": {"duration": 0.0029965508729219437, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_api_misc_endpoints.py", "lineno": 62, "message": "AssertionError: assert 'light' in ['homeassistant', 'persistent_notification', 'logger', 'system_log', 'person', 'frontend', ...]"}, "traceback": [{"path": "tests/api/test_api_misc_endpoints.py", "lineno": 62, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b15439a0>\n\n    async def test_list_services_has_light(rest):\n        \"\"\"Light domain appears in service listing.\"\"\"\n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/services\",\n            headers=rest._headers(),\n        )\n        data = resp.json()\n        domains = [e[\"domain\"] for e in data]\n>       assert \"light\" in domains\nE       AssertionError: assert 'light' in ['homeassistant', 'persistent_notification', 'logger', 'system_log', 'person', 'frontend', ...]\n\ntests/api/test_api_misc_endpoints.py:62: AssertionError"}, "teardown": {"duration": 0.0006489139050245285, "outcome": "passed"}}, {"nodeid": "tests/api/test_api_misc_endpoints.py::test_list_services_light_has_turn_on", "lineno": 64, "outcome": "failed", "keywords": ["test_list_services_light_has_turn_on", "test_api_misc_endpoints.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.004964863881468773, "outcome": "passed"}, "call": {"duration": 0.0034616109915077686, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/asyncio/base_events.py", "lineno": 647, "message": "RuntimeError: coroutine raised StopIteration"}, "traceback": [{"path": "../../anaconda3/lib/python3.9/site-packages/pytest_asyncio/plugin.py", "lineno": 440, "message": ""}, {"path": "../../anaconda3/lib/python3.9/site-packages/pytest_asyncio/plugin.py", "lineno": 906, "message": "in inner"}, {"path": "../../anaconda3/lib/python3.9/asyncio/base_events.py", "lineno": 647, "message": "RuntimeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b1329b80>\n\n    async def test_list_services_light_has_turn_on(rest):\n        \"\"\"Light domain has turn_on service.\"\"\"\n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/services\",\n            headers=rest._headers(),\n        )\n        data = resp.json()\n>       light = next(e for e in data if e[\"domain\"] == \"light\")\nE       StopIteration\n\ntests/api/test_api_misc_endpoints.py:72: StopIteration\n\nThe above exception was the direct cause of the following exception:\n\nself = <Coroutine test_list_services_light_has_turn_on>\n\n    def runtest(self) -> None:\n        self.obj = wrap_in_sync(\n            # https://github.com/pytest-dev/pytest-asyncio/issues/596\n            self.obj,  # type: ignore[has-type]\n        )\n>       super().runtest()\n\n../../anaconda3/lib/python3.9/site-packages/pytest_asyncio/plugin.py:440: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/pytest_asyncio/plugin.py:906: in inner\n    _loop.run_until_complete(task)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <_UnixSelectorEventLoop running=False closed=False debug=False>\nfuture = <Task finished name='Task-18' coro=<test_list_services_light_has_turn_on() done, defined at /home/jcrigby/fun/marge/tests/api/test_api_misc_endpoints.py:65> exception=RuntimeError('coroutine raised StopIteration')>\n\n    def run_until_complete(self, future):\n        \"\"\"Run until the Future is done.\n    \n        If the argument is a coroutine, it is wrapped in a Task.\n    \n        WARNING: It would be disastrous to call run_until_complete()\n        with the same coroutine twice -- it would wrap it in two\n        different Tasks and that can't be good.\n    \n        Return the Future's result, or raise its exception.\n        \"\"\"\n        self._check_closed()\n        self._check_running()\n    \n        new_task = not futures.isfuture(future)\n        future = tasks.ensure_future(future, loop=self)\n        if new_task:\n            # An exception is raised if the future didn't complete, so there\n            # is no need to log the \"destroy pending task\" message\n            future._log_destroy_pending = False\n    \n        future.add_done_callback(_run_until_complete_cb)\n        try:\n            self.run_forever()\n        except:\n            if new_task and future.done() and not future.cancelled():\n                # The coroutine raised a BaseException. Consume the exception\n                # to not log a warning, the caller doesn't have access to the\n                # local task.\n                future.exception()\n            raise\n        finally:\n            future.remove_done_callback(_run_until_complete_cb)\n        if not future.done():\n            raise RuntimeError('Event loop stopped before Future completed.')\n    \n>       return future.result()\nE       RuntimeError: coroutine raised StopIteration\n\n../../anaconda3/lib/python3.9/asyncio/base_events.py:647: RuntimeError"}, "teardown": {"duration": 0.000750803854316473, "outcome": "passed"}}, {"nodeid": "tests/api/test_api_misc_endpoints.py::test_list_events_returns_list", "lineno": 77, "outcome": "passed", "keywords": ["test_list_events_returns_list", "test_api_misc_endpoints.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005079308059066534, "outcome": "passed"}, "call": {"duration": 0.002588822040706873, "outcome": "passed"}, "teardown": {"duration": 0.00047289812937378883, "outcome": "passed"}}, {"nodeid": "tests/api/test_api_misc_endpoints.py::test_webhook_accepts_post", "lineno": 90, "outcome": "failed", "keywords": ["test_webhook_accepts_post", "test_api_misc_endpoints.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.004872714169323444, "outcome": "passed"}, "call": {"duration": 0.0025193169713020325, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_api_misc_endpoints.py", "lineno": 98, "message": "assert 404 == 200\n +  where 404 = <Response [404 Not Found]>.status_code"}, "traceback": [{"path": "tests/api/test_api_misc_endpoints.py", "lineno": 98, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0a22af0>\n\n    async def test_webhook_accepts_post(rest):\n        \"\"\"POST /api/webhook/{id} returns 200.\"\"\"\n        resp = await rest.client.post(\n            f\"{rest.base_url}/api/webhook/test_hook_depth\",\n            json={\"payload\": \"test\"},\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 404 == 200\nE        +  where 404 = <Response [404 Not Found]>.status_code\n\ntests/api/test_api_misc_endpoints.py:98: AssertionError"}, "teardown": {"duration": 0.0005007758736610413, "outcome": "passed"}}, {"nodeid": "tests/api/test_api_misc_endpoints.py::test_backup_returns_data", "lineno": 102, "outcome": "failed", "keywords": ["test_backup_returns_data", "test_api_misc_endpoints.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.004960022866725922, "outcome": "passed"}, "call": {"duration": 0.0030888677574694157, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_api_misc_endpoints.py", "lineno": 109, "message": "assert 404 == 200\n +  where 404 = <Response [404 Not Found]>.status_code"}, "traceback": [{"path": "tests/api/test_api_misc_endpoints.py", "lineno": 109, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0a664c0>\n\n    async def test_backup_returns_data(rest):\n        \"\"\"GET /api/backup returns backup data.\"\"\"\n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/backup\",\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 404 == 200\nE        +  where 404 = <Response [404 Not Found]>.status_code\n\ntests/api/test_api_misc_endpoints.py:109: AssertionError"}, "teardown": {"duration": 0.0007585687562823296, "outcome": "passed"}}, {"nodeid": "tests/api/test_api_misc_endpoints.py::test_statistics_endpoint", "lineno": 113, "outcome": "failed", "keywords": ["test_statistics_endpoint", "test_api_misc_endpoints.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005200288724154234, "outcome": "passed"}, "call": {"duration": 0.004462289158254862, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_api_misc_endpoints.py", "lineno": 121, "message": "assert 404 == 200\n +  where 404 = <Response [404 Not Found]>.status_code"}, "traceback": [{"path": "tests/api/test_api_misc_endpoints.py", "lineno": 121, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b08711c0>\n\n    async def test_statistics_endpoint(rest):\n        \"\"\"GET /api/statistics/{entity_id} returns data.\"\"\"\n        await rest.set_state(\"sensor.stat_depth_test\", \"42\")\n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/statistics/sensor.stat_depth_test\",\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 404 == 200\nE        +  where 404 = <Response [404 Not Found]>.status_code\n\ntests/api/test_api_misc_endpoints.py:121: AssertionError"}, "teardown": {"duration": 0.0007003010250627995, "outcome": "passed"}}, {"nodeid": "tests/api/test_api_misc_endpoints.py::test_sim_time_set_and_verify", "lineno": 125, "outcome": "failed", "keywords": ["test_sim_time_set_and_verify", "test_api_misc_endpoints.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005173539277166128, "outcome": "passed"}, "call": {"duration": 0.002644589636474848, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_api_misc_endpoints.py", "lineno": 133, "message": "assert 404 == 200\n +  where 404 = <Response [404 Not Found]>.status_code"}, "traceback": [{"path": "tests/api/test_api_misc_endpoints.py", "lineno": 133, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0a800d0>\n\n    async def test_sim_time_set_and_verify(rest):\n        \"\"\"POST /api/sim/time updates sim time visible in health.\"\"\"\n        resp = await rest.client.post(\n            f\"{rest.base_url}/api/sim/time\",\n            json={\"time\": \"14:30:00\", \"chapter\": \"afternoon\", \"speed\": 5},\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 404 == 200\nE        +  where 404 = <Response [404 Not Found]>.status_code\n\ntests/api/test_api_misc_endpoints.py:133: AssertionError"}, "teardown": {"duration": 0.0005132169462740421, "outcome": "passed"}}, {"nodeid": "tests/api/test_api_misc_endpoints.py::test_metrics_endpoint", "lineno": 142, "outcome": "failed", "keywords": ["test_metrics_endpoint", "test_api_misc_endpoints.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005699270870536566, "outcome": "passed"}, "call": {"duration": 0.002936634235084057, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_api_misc_endpoints.py", "lineno": 146, "message": "assert 404 == 200\n +  where 404 = <Response [404 Not Found]>.status_code"}, "traceback": [{"path": "tests/api/test_api_misc_endpoints.py", "lineno": 146, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0a7d160>\n\n    async def test_metrics_endpoint(rest):\n        \"\"\"GET /metrics returns Prometheus format.\"\"\"\n        resp = await rest.client.get(f\"{rest.base_url}/metrics\")\n>       assert resp.status_code == 200\nE       assert 404 == 200\nE        +  where 404 = <Response [404 Not Found]>.status_code\n\ntests/api/test_api_misc_endpoints.py:146: AssertionError"}, "teardown": {"duration": 0.0005462500266730785, "outcome": "passed"}}, {"nodeid": "tests/api/test_api_misc_endpoints.py::test_get_automation_yaml", "lineno": 152, "outcome": "failed", "keywords": ["test_get_automation_yaml", "test_api_misc_endpoints.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005095809232443571, "outcome": "passed"}, "call": {"duration": 0.0028547253459692, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_api_misc_endpoints.py", "lineno": 159, "message": "assert 404 == 200\n +  where 404 = <Response [404 Not Found]>.status_code"}, "traceback": [{"path": "tests/api/test_api_misc_endpoints.py", "lineno": 159, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0869d00>\n\n    async def test_get_automation_yaml(rest):\n        \"\"\"GET /api/config/automation/yaml returns YAML text.\"\"\"\n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/config/automation/yaml\",\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 404 == 200\nE        +  where 404 = <Response [404 Not Found]>.status_code\n\ntests/api/test_api_misc_endpoints.py:159: AssertionError"}, "teardown": {"duration": 0.0005919099785387516, "outcome": "passed"}}, {"nodeid": "tests/api/test_api_misc_endpoints.py::test_automation_reload_via_alt_path", "lineno": 162, "outcome": "failed", "keywords": ["test_automation_reload_via_alt_path", "test_api_misc_endpoints.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005170044023543596, "outcome": "passed"}, "call": {"duration": 0.0027480507269501686, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_api_misc_endpoints.py", "lineno": 170, "message": "assert 404 == 200\n +  where 404 = <Response [404 Not Found]>.status_code"}, "traceback": [{"path": "tests/api/test_api_misc_endpoints.py", "lineno": 170, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b08f3430>\n\n    async def test_automation_reload_via_alt_path(rest):\n        \"\"\"POST /api/config/automation/reload also works.\"\"\"\n        resp = await rest.client.post(\n            f\"{rest.base_url}/api/config/automation/reload\",\n            json={},\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 404 == 200\nE        +  where 404 = <Response [404 Not Found]>.status_code\n\ntests/api/test_api_misc_endpoints.py:170: AssertionError"}, "teardown": {"duration": 0.0007368233054876328, "outcome": "passed"}}, {"nodeid": "tests/api/test_api_root_config_format.py::test_api_root_returns_200", "lineno": 15, "outcome": "passed", "keywords": ["test_api_root_returns_200", "test_api_root_config_format.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005518971011042595, "outcome": "passed"}, "call": {"duration": 0.0026091882027685642, "outcome": "passed"}, "teardown": {"duration": 0.0004726848565042019, "outcome": "passed"}}, {"nodeid": "tests/api/test_api_root_config_format.py::test_api_root_has_message", "lineno": 24, "outcome": "passed", "keywords": ["test_api_root_has_message", "test_api_root_config_format.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005166119895875454, "outcome": "passed"}, "call": {"duration": 0.002882095053792, "outcome": "passed"}, "teardown": {"duration": 0.0005756402388215065, "outcome": "passed"}}, {"nodeid": "tests/api/test_api_root_config_format.py::test_api_root_message_content", "lineno": 36, "outcome": "passed", "keywords": ["test_api_root_message_content", "test_api_root_config_format.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005312968976795673, "outcome": "passed"}, "call": {"duration": 0.004130994901061058, "outcome": "passed"}, "teardown": {"duration": 0.0005706539377570152, "outcome": "passed"}}, {"nodeid": "tests/api/test_api_root_config_format.py::test_config_has_coordinates", "lineno": 47, "outcome": "passed", "keywords": ["test_config_has_coordinates", "test_api_root_config_format.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005302286706864834, "outcome": "passed"}, "call": {"duration": 0.003167843446135521, "outcome": "passed"}, "teardown": {"duration": 0.000559006817638874, "outcome": "passed"}}, {"nodeid": "tests/api/test_api_root_config_format.py::test_config_has_time_zone", "lineno": 60, "outcome": "passed", "keywords": ["test_config_has_time_zone", "test_api_root_config_format.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005069753620773554, "outcome": "passed"}, "call": {"duration": 0.002644473221153021, "outcome": "passed"}, "teardown": {"duration": 0.0005021989345550537, "outcome": "passed"}}, {"nodeid": "tests/api/test_api_root_config_format.py::test_config_is_json", "lineno": 71, "outcome": "passed", "keywords": ["test_config_is_json", "test_api_root_config_format.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005249567795544863, "outcome": "passed"}, "call": {"duration": 0.002548525109887123, "outcome": "passed"}, "teardown": {"duration": 0.0004724320024251938, "outcome": "passed"}}, {"nodeid": "tests/api/test_area_label_lifecycle.py::test_area_create", "lineno": 15, "outcome": "failed", "keywords": ["test_area_create", "test_area_label_lifecycle.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005241458769887686, "outcome": "passed"}, "call": {"duration": 0.005221701227128506, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_area_label_lifecycle.py", "lineno": 24, "message": "assert 404 == 200\n +  where 404 = <Response [404 Not Found]>.status_code"}, "traceback": [{"path": "tests/api/test_area_label_lifecycle.py", "lineno": 24, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0a7ce50>\n\n    async def test_area_create(rest):\n        \"\"\"Create area via REST POST.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        resp = await rest.client.post(\n            f\"{rest.base_url}/api/areas\",\n            json={\"area_id\": f\"lc_area_{tag}\", \"name\": f\"LC Room {tag}\"},\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 404 == 200\nE        +  where 404 = <Response [404 Not Found]>.status_code\n\ntests/api/test_area_label_lifecycle.py:24: AssertionError"}, "teardown": {"duration": 0.0006380067206919193, "outcome": "passed"}}, {"nodeid": "tests/api/test_area_label_lifecycle.py::test_area_list_includes_created", "lineno": 26, "outcome": "failed", "keywords": ["test_area_list_includes_created", "test_area_label_lifecycle.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.0054222820326685905, "outcome": "passed"}, "call": {"duration": 0.003897502087056637, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)"}, "traceback": [{"path": "tests/api/test_area_label_lifecycle.py", "lineno": 39, "message": ""}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 832, "message": "in json"}, {"path": "../../anaconda3/lib/python3.9/json/__init__.py", "lineno": 346, "message": "in loads"}, {"path": "../../anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "JSONDecodeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0a81700>\n\n    async def test_area_list_includes_created(rest):\n        \"\"\"Created area appears in area list.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        await rest.client.post(\n            f\"{rest.base_url}/api/areas\",\n            json={\"area_id\": f\"lc_list_{tag}\", \"name\": f\"Listed {tag}\"},\n            headers=rest._headers(),\n        )\n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/areas\",\n            headers=rest._headers(),\n        )\n>       areas = resp.json()\n\ntests/api/test_area_label_lifecycle.py:39: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:832: in json\n    return jsonlib.loads(self.content, **kwargs)\n../../anaconda3/lib/python3.9/json/__init__.py:346: in loads\n    return _default_decoder.decode(s)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <json.decoder.JSONDecoder object at 0x7f47b2e5fe50>, s = '404: Not Found'\n_w = <built-in method match of re.Pattern object at 0x7f47b3015cf0>\n\n    def decode(self, s, _w=WHITESPACE.match):\n        \"\"\"Return the Python representation of ``s`` (a ``str`` instance\n        containing a JSON document).\n    \n        \"\"\"\n        obj, end = self.raw_decode(s, idx=_w(s, 0).end())\n        end = _w(s, end).end()\n        if end != len(s):\n>           raise JSONDecodeError(\"Extra data\", s, end)\nE           json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)\n\n../../anaconda3/lib/python3.9/json/decoder.py:340: JSONDecodeError"}, "teardown": {"duration": 0.0007175952196121216, "outcome": "passed"}}, {"nodeid": "tests/api/test_area_label_lifecycle.py::test_area_delete", "lineno": 44, "outcome": "failed", "keywords": ["test_area_delete", "test_area_label_lifecycle.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005609224084764719, "outcome": "passed"}, "call": {"duration": 0.004277534317225218, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_area_label_lifecycle.py", "lineno": 58, "message": "assert 404 == 200\n +  where 404 = <Response [404 Not Found]>.status_code"}, "traceback": [{"path": "tests/api/test_area_label_lifecycle.py", "lineno": 58, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b073a580>\n\n    async def test_area_delete(rest):\n        \"\"\"Delete area via REST DELETE.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        await rest.client.post(\n            f\"{rest.base_url}/api/areas\",\n            json={\"area_id\": f\"lc_del_{tag}\", \"name\": f\"Delete Me {tag}\"},\n            headers=rest._headers(),\n        )\n        resp = await rest.client.request(\n            \"DELETE\",\n            f\"{rest.base_url}/api/areas/lc_del_{tag}\",\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 404 == 200\nE        +  where 404 = <Response [404 Not Found]>.status_code\n\ntests/api/test_area_label_lifecycle.py:58: AssertionError"}, "teardown": {"duration": 0.000565970316529274, "outcome": "passed"}}, {"nodeid": "tests/api/test_area_label_lifecycle.py::test_area_assign_entity", "lineno": 60, "outcome": "failed", "keywords": ["test_area_assign_entity", "test_area_label_lifecycle.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005097190849483013, "outcome": "passed"}, "call": {"duration": 0.005516116041690111, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_area_label_lifecycle.py", "lineno": 75, "message": "assert 404 == 200\n +  where 404 = <Response [404 Not Found]>.status_code"}, "traceback": [{"path": "tests/api/test_area_label_lifecycle.py", "lineno": 75, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0a662b0>\n\n    async def test_area_assign_entity(rest):\n        \"\"\"Assign entity to area.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        await rest.client.post(\n            f\"{rest.base_url}/api/areas\",\n            json={\"area_id\": f\"lc_asgn_{tag}\", \"name\": f\"Assign {tag}\"},\n            headers=rest._headers(),\n        )\n        await rest.set_state(f\"sensor.lc_ent_{tag}\", \"50\")\n        resp = await rest.client.post(\n            f\"{rest.base_url}/api/areas/lc_asgn_{tag}/entities/sensor.lc_ent_{tag}\",\n            json={},\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 404 == 200\nE        +  where 404 = <Response [404 Not Found]>.status_code\n\ntests/api/test_area_label_lifecycle.py:75: AssertionError"}, "teardown": {"duration": 0.000684044323861599, "outcome": "passed"}}, {"nodeid": "tests/api/test_area_label_lifecycle.py::test_area_list_entities", "lineno": 77, "outcome": "failed", "keywords": ["test_area_list_entities", "test_area_label_lifecycle.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005136881023645401, "outcome": "passed"}, "call": {"duration": 0.006504559889435768, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_area_label_lifecycle.py", "lineno": 96, "message": "assert 404 == 200\n +  where 404 = <Response [404 Not Found]>.status_code"}, "traceback": [{"path": "tests/api/test_area_label_lifecycle.py", "lineno": 96, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0a806a0>\n\n    async def test_area_list_entities(rest):\n        \"\"\"List entities in area.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        await rest.client.post(\n            f\"{rest.base_url}/api/areas\",\n            json={\"area_id\": f\"lc_le_{tag}\", \"name\": f\"ListEnt {tag}\"},\n            headers=rest._headers(),\n        )\n        await rest.set_state(f\"sensor.lc_lent_{tag}\", \"50\")\n        await rest.client.post(\n            f\"{rest.base_url}/api/areas/lc_le_{tag}/entities/sensor.lc_lent_{tag}\",\n            json={},\n            headers=rest._headers(),\n        )\n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/areas/lc_le_{tag}/entities\",\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 404 == 200\nE        +  where 404 = <Response [404 Not Found]>.status_code\n\ntests/api/test_area_label_lifecycle.py:96: AssertionError"}, "teardown": {"duration": 0.0005015130154788494, "outcome": "passed"}}, {"nodeid": "tests/api/test_area_label_lifecycle.py::test_area_unassign_entity", "lineno": 100, "outcome": "failed", "keywords": ["test_area_unassign_entity", "test_area_label_lifecycle.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005016231909394264, "outcome": "passed"}, "call": {"duration": 0.00687818881124258, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_area_label_lifecycle.py", "lineno": 120, "message": "assert 404 == 200\n +  where 404 = <Response [404 Not Found]>.status_code"}, "traceback": [{"path": "tests/api/test_area_label_lifecycle.py", "lineno": 120, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0869b20>\n\n    async def test_area_unassign_entity(rest):\n        \"\"\"Unassign entity from area.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        await rest.client.post(\n            f\"{rest.base_url}/api/areas\",\n            json={\"area_id\": f\"lc_un_{tag}\", \"name\": f\"Unassign {tag}\"},\n            headers=rest._headers(),\n        )\n        await rest.set_state(f\"sensor.lc_unent_{tag}\", \"50\")\n        await rest.client.post(\n            f\"{rest.base_url}/api/areas/lc_un_{tag}/entities/sensor.lc_unent_{tag}\",\n            json={},\n            headers=rest._headers(),\n        )\n        resp = await rest.client.request(\n            \"DELETE\",\n            f\"{rest.base_url}/api/areas/lc_un_{tag}/entities/sensor.lc_unent_{tag}\",\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 404 == 200\nE        +  where 404 = <Response [404 Not Found]>.status_code\n\ntests/api/test_area_label_lifecycle.py:120: AssertionError"}, "teardown": {"duration": 0.0008047823794186115, "outcome": "passed"}}, {"nodeid": "tests/api/test_area_label_lifecycle.py::test_label_create", "lineno": 124, "outcome": "failed", "keywords": ["test_label_create", "test_area_label_lifecycle.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005488061811774969, "outcome": "passed"}, "call": {"duration": 0.0029214760288596153, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_area_label_lifecycle.py", "lineno": 133, "message": "assert 404 == 200\n +  where 404 = <Response [404 Not Found]>.status_code"}, "traceback": [{"path": "tests/api/test_area_label_lifecycle.py", "lineno": 133, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b095ddc0>\n\n    async def test_label_create(rest):\n        \"\"\"Create label via REST POST.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        resp = await rest.client.post(\n            f\"{rest.base_url}/api/labels\",\n            json={\"label_id\": f\"lc_lbl_{tag}\", \"name\": f\"Label {tag}\", \"color\": \"#ff0000\"},\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 404 == 200\nE        +  where 404 = <Response [404 Not Found]>.status_code\n\ntests/api/test_area_label_lifecycle.py:133: AssertionError"}, "teardown": {"duration": 0.0006552902050316334, "outcome": "passed"}}, {"nodeid": "tests/api/test_area_label_lifecycle.py::test_label_list_includes_created", "lineno": 135, "outcome": "failed", "keywords": ["test_label_list_includes_created", "test_area_label_lifecycle.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005098134744912386, "outcome": "passed"}, "call": {"duration": 0.0038367467932403088, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)"}, "traceback": [{"path": "tests/api/test_area_label_lifecycle.py", "lineno": 148, "message": ""}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 832, "message": "in json"}, {"path": "../../anaconda3/lib/python3.9/json/__init__.py", "lineno": 346, "message": "in loads"}, {"path": "../../anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "JSONDecodeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0963a00>\n\n    async def test_label_list_includes_created(rest):\n        \"\"\"Created label appears in label list.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        await rest.client.post(\n            f\"{rest.base_url}/api/labels\",\n            json={\"label_id\": f\"lc_ll_{tag}\", \"name\": f\"Listed {tag}\", \"color\": \"#00ff00\"},\n            headers=rest._headers(),\n        )\n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/labels\",\n            headers=rest._headers(),\n        )\n>       labels = resp.json()\n\ntests/api/test_area_label_lifecycle.py:148: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:832: in json\n    return jsonlib.loads(self.content, **kwargs)\n../../anaconda3/lib/python3.9/json/__init__.py:346: in loads\n    return _default_decoder.decode(s)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <json.decoder.JSONDecoder object at 0x7f47b2e5fe50>, s = '404: Not Found'\n_w = <built-in method match of re.Pattern object at 0x7f47b3015cf0>\n\n    def decode(self, s, _w=WHITESPACE.match):\n        \"\"\"Return the Python representation of ``s`` (a ``str`` instance\n        containing a JSON document).\n    \n        \"\"\"\n        obj, end = self.raw_decode(s, idx=_w(s, 0).end())\n        end = _w(s, end).end()\n        if end != len(s):\n>           raise JSONDecodeError(\"Extra data\", s, end)\nE           json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)\n\n../../anaconda3/lib/python3.9/json/decoder.py:340: JSONDecodeError"}, "teardown": {"duration": 0.0007938449271023273, "outcome": "passed"}}, {"nodeid": "tests/api/test_area_label_lifecycle.py::test_label_delete", "lineno": 153, "outcome": "failed", "keywords": ["test_label_delete", "test_area_label_lifecycle.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005508613307029009, "outcome": "passed"}, "call": {"duration": 0.004035359714180231, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_area_label_lifecycle.py", "lineno": 167, "message": "assert 404 == 200\n +  where 404 = <Response [404 Not Found]>.status_code"}, "traceback": [{"path": "tests/api/test_area_label_lifecycle.py", "lineno": 167, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b08d94c0>\n\n    async def test_label_delete(rest):\n        \"\"\"Delete label via REST DELETE.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        await rest.client.post(\n            f\"{rest.base_url}/api/labels\",\n            json={\"label_id\": f\"lc_ld_{tag}\", \"name\": f\"Delete {tag}\", \"color\": \"#0000ff\"},\n            headers=rest._headers(),\n        )\n        resp = await rest.client.request(\n            \"DELETE\",\n            f\"{rest.base_url}/api/labels/lc_ld_{tag}\",\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 404 == 200\nE        +  where 404 = <Response [404 Not Found]>.status_code\n\ntests/api/test_area_label_lifecycle.py:167: AssertionError"}, "teardown": {"duration": 0.0006538601592183113, "outcome": "passed"}}, {"nodeid": "tests/api/test_area_label_lifecycle.py::test_label_assign_entity", "lineno": 169, "outcome": "failed", "keywords": ["test_label_assign_entity", "test_area_label_lifecycle.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005265593063086271, "outcome": "passed"}, "call": {"duration": 0.007453103084117174, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_area_label_lifecycle.py", "lineno": 184, "message": "assert 404 == 200\n +  where 404 = <Response [404 Not Found]>.status_code"}, "traceback": [{"path": "tests/api/test_area_label_lifecycle.py", "lineno": 184, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b08326a0>\n\n    async def test_label_assign_entity(rest):\n        \"\"\"Assign label to entity.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        await rest.client.post(\n            f\"{rest.base_url}/api/labels\",\n            json={\"label_id\": f\"lc_la_{tag}\", \"name\": f\"Assign {tag}\", \"color\": \"\"},\n            headers=rest._headers(),\n        )\n        await rest.set_state(f\"sensor.lc_lblent_{tag}\", \"50\")\n        resp = await rest.client.post(\n            f\"{rest.base_url}/api/labels/lc_la_{tag}/entities/sensor.lc_lblent_{tag}\",\n            json={},\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 404 == 200\nE        +  where 404 = <Response [404 Not Found]>.status_code\n\ntests/api/test_area_label_lifecycle.py:184: AssertionError"}, "teardown": {"duration": 0.0005959318950772285, "outcome": "passed"}}, {"nodeid": "tests/api/test_area_label_lifecycle.py::test_label_unassign_entity", "lineno": 186, "outcome": "failed", "keywords": ["test_label_unassign_entity", "test_area_label_lifecycle.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.0052752308547496796, "outcome": "passed"}, "call": {"duration": 0.006477460265159607, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_area_label_lifecycle.py", "lineno": 206, "message": "assert 404 == 200\n +  where 404 = <Response [404 Not Found]>.status_code"}, "traceback": [{"path": "tests/api/test_area_label_lifecycle.py", "lineno": 206, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b073a190>\n\n    async def test_label_unassign_entity(rest):\n        \"\"\"Unassign label from entity.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        await rest.client.post(\n            f\"{rest.base_url}/api/labels\",\n            json={\"label_id\": f\"lc_lu_{tag}\", \"name\": f\"Unassign {tag}\", \"color\": \"\"},\n            headers=rest._headers(),\n        )\n        await rest.set_state(f\"sensor.lc_luent_{tag}\", \"50\")\n        await rest.client.post(\n            f\"{rest.base_url}/api/labels/lc_lu_{tag}/entities/sensor.lc_luent_{tag}\",\n            json={},\n            headers=rest._headers(),\n        )\n        resp = await rest.client.request(\n            \"DELETE\",\n            f\"{rest.base_url}/api/labels/lc_lu_{tag}/entities/sensor.lc_luent_{tag}\",\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 404 == 200\nE        +  where 404 = <Response [404 Not Found]>.status_code\n\ntests/api/test_area_label_lifecycle.py:206: AssertionError"}, "teardown": {"duration": 0.0006195288151502609, "outcome": "passed"}}, {"nodeid": "tests/api/test_area_label_lifecycle.py::test_device_create", "lineno": 210, "outcome": "failed", "keywords": ["test_device_create", "test_area_label_lifecycle.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005218731705099344, "outcome": "passed"}, "call": {"duration": 0.002551889047026634, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_area_label_lifecycle.py", "lineno": 224, "message": "assert 404 == 200\n +  where 404 = <Response [404 Not Found]>.status_code"}, "traceback": [{"path": "tests/api/test_area_label_lifecycle.py", "lineno": 224, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0935880>\n\n    async def test_device_create(rest):\n        \"\"\"Create device via REST POST.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        resp = await rest.client.post(\n            f\"{rest.base_url}/api/devices\",\n            json={\n                \"device_id\": f\"lc_dev_{tag}\",\n                \"name\": f\"Device {tag}\",\n                \"manufacturer\": \"TestCo\",\n                \"model\": \"T100\",\n            },\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 404 == 200\nE        +  where 404 = <Response [404 Not Found]>.status_code\n\ntests/api/test_area_label_lifecycle.py:224: AssertionError"}, "teardown": {"duration": 0.0006072861142456532, "outcome": "passed"}}, {"nodeid": "tests/api/test_area_label_lifecycle.py::test_device_list", "lineno": 226, "outcome": "failed", "keywords": ["test_device_list", "test_area_label_lifecycle.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005044478923082352, "outcome": "passed"}, "call": {"duration": 0.0025216899812221527, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_area_label_lifecycle.py", "lineno": 233, "message": "assert 404 == 200\n +  where 404 = <Response [404 Not Found]>.status_code"}, "traceback": [{"path": "tests/api/test_area_label_lifecycle.py", "lineno": 233, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0ac2b50>\n\n    async def test_device_list(rest):\n        \"\"\"List devices via REST GET.\"\"\"\n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/devices\",\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 404 == 200\nE        +  where 404 = <Response [404 Not Found]>.status_code\n\ntests/api/test_area_label_lifecycle.py:233: AssertionError"}, "teardown": {"duration": 0.000640092883259058, "outcome": "passed"}}, {"nodeid": "tests/api/test_area_label_lifecycle.py::test_device_assign_entity", "lineno": 237, "outcome": "failed", "keywords": ["test_device_assign_entity", "test_area_label_lifecycle.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005164904985576868, "outcome": "passed"}, "call": {"duration": 0.005361661780625582, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_area_label_lifecycle.py", "lineno": 252, "message": "assert 404 == 200\n +  where 404 = <Response [404 Not Found]>.status_code"}, "traceback": [{"path": "tests/api/test_area_label_lifecycle.py", "lineno": 252, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0a227f0>\n\n    async def test_device_assign_entity(rest):\n        \"\"\"Assign entity to device.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        await rest.client.post(\n            f\"{rest.base_url}/api/devices\",\n            json={\"device_id\": f\"lc_da_{tag}\", \"name\": f\"Dev {tag}\"},\n            headers=rest._headers(),\n        )\n        await rest.set_state(f\"sensor.lc_dent_{tag}\", \"50\")\n        resp = await rest.client.post(\n            f\"{rest.base_url}/api/devices/lc_da_{tag}/entities/sensor.lc_dent_{tag}\",\n            json={},\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 404 == 200\nE        +  where 404 = <Response [404 Not Found]>.status_code\n\ntests/api/test_area_label_lifecycle.py:252: AssertionError"}, "teardown": {"duration": 0.0005219168961048126, "outcome": "passed"}}, {"nodeid": "tests/api/test_area_label_lifecycle.py::test_area_entity_listing_includes_state", "lineno": 256, "outcome": "failed", "keywords": ["test_area_entity_listing_includes_state", "test_area_label_lifecycle.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005237821023911238, "outcome": "passed"}, "call": {"duration": 0.006226254161447287, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_area_label_lifecycle.py", "lineno": 274, "message": "assert 404 == 200\n +  where 404 = <Response [404 Not Found]>.status_code"}, "traceback": [{"path": "tests/api/test_area_label_lifecycle.py", "lineno": 274, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0a808e0>\n\n    async def test_area_entity_listing_includes_state(rest):\n        \"\"\"GET /api/areas/:id/entities returns full entity state objects.\"\"\"\n        await rest.set_state(\"sensor.area_state_test\", \"55\", {\"unit_of_measurement\": \"W\"})\n        await rest.client.post(\n            f\"{rest.base_url}/api/areas\",\n            headers=rest._headers(),\n            json={\"area_id\": \"cts_state_room\", \"name\": \"State Room\"},\n        )\n        await rest.client.post(\n            f\"{rest.base_url}/api/areas/cts_state_room/entities/sensor.area_state_test\",\n            headers=rest._headers(),\n        )\n    \n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/areas/cts_state_room/entities\",\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 404 == 200\nE        +  where 404 = <Response [404 Not Found]>.status_code\n\ntests/api/test_area_label_lifecycle.py:274: AssertionError"}, "teardown": {"duration": 0.0007724338211119175, "outcome": "passed"}}, {"nodeid": "tests/api/test_area_label_lifecycle.py::test_area_duplicate_entity_assignment", "lineno": 287, "outcome": "failed", "keywords": ["test_area_duplicate_entity_assignment", "test_area_label_lifecycle.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005423673894256353, "outcome": "passed"}, "call": {"duration": 0.005543522071093321, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_area_label_lifecycle.py", "lineno": 303, "message": "assert 404 == 200\n +  where 404 = <Response [404 Not Found]>.status_code"}, "traceback": [{"path": "tests/api/test_area_label_lifecycle.py", "lineno": 303, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0854cd0>\n\n    async def test_area_duplicate_entity_assignment(rest):\n        \"\"\"Assigning same entity to area twice is idempotent.\"\"\"\n        await rest.set_state(\"sensor.dup_area_test\", \"10\")\n        await rest.client.post(\n            f\"{rest.base_url}/api/areas\",\n            headers=rest._headers(),\n            json={\"area_id\": \"dup_test_room\", \"name\": \"Dup Room\"},\n        )\n    \n        # Assign twice\n        for _ in range(2):\n            resp = await rest.client.post(\n                f\"{rest.base_url}/api/areas/dup_test_room/entities/sensor.dup_area_test\",\n                headers=rest._headers(),\n            )\n>           assert resp.status_code == 200\nE           assert 404 == 200\nE            +  where 404 = <Response [404 Not Found]>.status_code\n\ntests/api/test_area_label_lifecycle.py:303: AssertionError"}, "teardown": {"duration": 0.0005407007411122322, "outcome": "passed"}}, {"nodeid": "tests/api/test_auth_edge_cases.py::test_open_mode_no_header_allowed", "lineno": 18, "outcome": "skipped", "keywords": ["test_open_mode_no_header_allowed", "test_auth_edge_cases.py", "asyncio", "marge_only", "api", "tests", "marge", ""], "setup": {"duration": 0.00024992600083351135, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/api/test_auth_edge_cases.py', 19, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.0001318957656621933, "outcome": "passed"}}, {"nodeid": "tests/api/test_auth_edge_cases.py::test_open_mode_arbitrary_bearer_allowed", "lineno": 25, "outcome": "skipped", "keywords": ["test_open_mode_arbitrary_bearer_allowed", "test_auth_edge_cases.py", "asyncio", "marge_only", "api", "tests", "marge", ""], "setup": {"duration": 0.0002053380012512207, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/api/test_auth_edge_cases.py', 26, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00012614531442523003, "outcome": "passed"}}, {"nodeid": "tests/api/test_auth_edge_cases.py::test_open_mode_empty_header_allowed", "lineno": 35, "outcome": "skipped", "keywords": ["test_open_mode_empty_header_allowed", "test_auth_edge_cases.py", "asyncio", "marge_only", "api", "tests", "marge", ""], "setup": {"duration": 0.00019269390031695366, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/api/test_auth_edge_cases.py', 36, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00012664124369621277, "outcome": "passed"}}, {"nodeid": "tests/api/test_auth_edge_cases.py::test_open_mode_config_accessible", "lineno": 45, "outcome": "skipped", "keywords": ["test_open_mode_config_accessible", "test_auth_edge_cases.py", "asyncio", "marge_only", "api", "tests", "marge", ""], "setup": {"duration": 0.00019180122762918472, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/api/test_auth_edge_cases.py', 46, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.0001273597590625286, "outcome": "passed"}}, {"nodeid": "tests/api/test_auth_edge_cases.py::test_open_mode_services_accessible", "lineno": 54, "outcome": "skipped", "keywords": ["test_open_mode_services_accessible", "test_auth_edge_cases.py", "asyncio", "marge_only", "api", "tests", "marge", ""], "setup": {"duration": 0.0003253519535064697, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/api/test_auth_edge_cases.py', 55, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00012612296268343925, "outcome": "passed"}}, {"nodeid": "tests/api/test_auth_edge_cases.py::test_health_endpoint_always_accessible", "lineno": 71, "outcome": "skipped", "keywords": ["test_health_endpoint_always_accessible", "test_auth_edge_cases.py", "asyncio", "marge_only", "api", "tests", "marge", ""], "setup": {"duration": 0.00019112275913357735, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/api/test_auth_edge_cases.py', 72, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.0001256270334124565, "outcome": "passed"}}, {"nodeid": "tests/api/test_auth_edge_cases.py::test_create_token", "lineno": 80, "outcome": "skipped", "keywords": ["test_create_token", "test_auth_edge_cases.py", "asyncio", "marge_only", "api", "tests", "marge", ""], "setup": {"duration": 0.0001977812498807907, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/api/test_auth_edge_cases.py', 81, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.0001283399760723114, "outcome": "passed"}}, {"nodeid": "tests/api/test_auth_edge_cases.py::test_create_token_missing_name", "lineno": 97, "outcome": "skipped", "keywords": ["test_create_token_missing_name", "test_auth_edge_cases.py", "asyncio", "marge_only", "api", "tests", "marge", ""], "setup": {"duration": 0.00022923899814486504, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/api/test_auth_edge_cases.py', 98, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00013342220336198807, "outcome": "passed"}}, {"nodeid": "tests/api/test_auth_edge_cases.py::test_list_tokens", "lineno": 107, "outcome": "skipped", "keywords": ["test_list_tokens", "test_auth_edge_cases.py", "asyncio", "marge_only", "api", "tests", "marge", ""], "setup": {"duration": 0.0002023777924478054, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/api/test_auth_edge_cases.py', 108, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.0001260358840227127, "outcome": "passed"}}, {"nodeid": "tests/api/test_auth_edge_cases.py::test_delete_token", "lineno": 136, "outcome": "skipped", "keywords": ["test_delete_token", "test_auth_edge_cases.py", "asyncio", "marge_only", "api", "tests", "marge", ""], "setup": {"duration": 0.0003478717990219593, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/api/test_auth_edge_cases.py', 137, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00012565171346068382, "outcome": "passed"}}, {"nodeid": "tests/api/test_auth_edge_cases.py::test_delete_nonexistent_token", "lineno": 163, "outcome": "skipped", "keywords": ["test_delete_nonexistent_token", "test_auth_edge_cases.py", "asyncio", "marge_only", "api", "tests", "marge", ""], "setup": {"duration": 0.000195987056940794, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/api/test_auth_edge_cases.py', 164, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00012598512694239616, "outcome": "passed"}}, {"nodeid": "tests/api/test_auth_edge_cases.py::test_created_token_has_correct_format", "lineno": 172, "outcome": "skipped", "keywords": ["test_created_token_has_correct_format", "test_auth_edge_cases.py", "asyncio", "marge_only", "api", "tests", "marge", ""], "setup": {"duration": 0.0001940508373081684, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/api/test_auth_edge_cases.py', 173, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.0001246822066605091, "outcome": "passed"}}, {"nodeid": "tests/api/test_auth_edge_cases.py::test_token_id_has_correct_format", "lineno": 185, "outcome": "skipped", "keywords": ["test_token_id_has_correct_format", "test_auth_edge_cases.py", "asyncio", "marge_only", "api", "tests", "marge", ""], "setup": {"duration": 0.00019603222608566284, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/api/test_auth_edge_cases.py', 186, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00013415608555078506, "outcome": "passed"}}, {"nodeid": "tests/api/test_auth_token_lifecycle.py::test_create_token", "lineno": 39, "outcome": "skipped", "keywords": ["test_create_token", "test_auth_token_lifecycle.py", "asyncio", "marge_only", "api", "tests", "marge", ""], "setup": {"duration": 0.00020422320812940598, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/api/test_auth_token_lifecycle.py', 40, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00012692296877503395, "outcome": "passed"}}, {"nodeid": "tests/api/test_auth_token_lifecycle.py::test_list_tokens", "lineno": 51, "outcome": "skipped", "keywords": ["test_list_tokens", "test_auth_token_lifecycle.py", "asyncio", "marge_only", "api", "tests", "marge", ""], "setup": {"duration": 0.0003457670100033283, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/api/test_auth_token_lifecycle.py', 52, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00012663006782531738, "outcome": "passed"}}, {"nodeid": "tests/api/test_auth_token_lifecycle.py::test_list_tokens_hides_value", "lineno": 63, "outcome": "skipped", "keywords": ["test_list_tokens_hides_value", "test_auth_token_lifecycle.py", "asyncio", "marge_only", "api", "tests", "marge", ""], "setup": {"duration": 0.0001951148733496666, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/api/test_auth_token_lifecycle.py', 64, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.000125921331346035, "outcome": "passed"}}, {"nodeid": "tests/api/test_auth_token_lifecycle.py::test_delete_token", "lineno": 73, "outcome": "skipped", "keywords": ["test_delete_token", "test_auth_token_lifecycle.py", "asyncio", "marge_only", "api", "tests", "marge", ""], "setup": {"duration": 0.0001954706385731697, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/api/test_auth_token_lifecycle.py', 74, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.0001316429115831852, "outcome": "passed"}}, {"nodeid": "tests/api/test_auth_token_lifecycle.py::test_delete_nonexistent_token_404", "lineno": 89, "outcome": "skipped", "keywords": ["test_delete_nonexistent_token_404", "test_auth_token_lifecycle.py", "asyncio", "marge_only", "api", "tests", "marge", ""], "setup": {"duration": 0.00019496073946356773, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/api/test_auth_token_lifecycle.py', 90, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00012671109288930893, "outcome": "passed"}}, {"nodeid": "tests/api/test_auth_token_lifecycle.py::test_create_token_missing_name_400", "lineno": 95, "outcome": "skipped", "keywords": ["test_create_token_missing_name_400", "test_auth_token_lifecycle.py", "asyncio", "marge_only", "api", "tests", "marge", ""], "setup": {"duration": 0.00019954005256295204, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/api/test_auth_token_lifecycle.py', 96, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.0001308610662817955, "outcome": "passed"}}, {"nodeid": "tests/api/test_auth_token_lifecycle.py::test_token_field_format[id-tok_-10]", "lineno": 105, "outcome": "skipped", "keywords": ["test_token_field_format[id-tok_-10]", "parametrize", "pytestmark", "id-tok_-10", "test_auth_token_lifecycle.py", "asyncio", "marge_only", "api", "tests", "marge", ""], "setup": {"duration": 0.00035685161128640175, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/api/test_auth_token_lifecycle.py', 106, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.0001307888887822628, "outcome": "passed"}}, {"nodeid": "tests/api/test_auth_token_lifecycle.py::test_token_field_format[token-marge_-10]", "lineno": 105, "outcome": "skipped", "keywords": ["test_token_field_format[token-marge_-10]", "parametrize", "pytestmark", "token-marge_-10", "test_auth_token_lifecycle.py", "asyncio", "marge_only", "api", "tests", "marge", ""], "setup": {"duration": 0.0002011507749557495, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/api/test_auth_token_lifecycle.py', 106, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.0001311860978603363, "outcome": "passed"}}, {"nodeid": "tests/api/test_auth_token_lifecycle.py::test_multiple_tokens_unique_ids", "lineno": 117, "outcome": "skipped", "keywords": ["test_multiple_tokens_unique_ids", "test_auth_token_lifecycle.py", "asyncio", "marge_only", "api", "tests", "marge", ""], "setup": {"duration": 0.0002013486810028553, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/api/test_auth_token_lifecycle.py', 118, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.0001309388317167759, "outcome": "passed"}}, {"nodeid": "tests/api/test_auth_token_lifecycle.py::test_token_has_created_at", "lineno": 131, "outcome": "skipped", "keywords": ["test_token_has_created_at", "test_auth_token_lifecycle.py", "asyncio", "marge_only", "api", "tests", "marge", ""], "setup": {"duration": 0.00020477501675486565, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/api/test_auth_token_lifecycle.py', 132, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00012994278222322464, "outcome": "passed"}}, {"nodeid": "tests/api/test_auth_token_lifecycle.py::test_listed_token_has_name", "lineno": 142, "outcome": "skipped", "keywords": ["test_listed_token_has_name", "test_auth_token_lifecycle.py", "asyncio", "marge_only", "api", "tests", "marge", ""], "setup": {"duration": 0.00020453333854675293, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/api/test_auth_token_lifecycle.py', 143, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00012947805225849152, "outcome": "passed"}}, {"nodeid": "tests/api/test_auth_token_lifecycle.py::test_token_full_lifecycle", "lineno": 155, "outcome": "skipped", "keywords": ["test_token_full_lifecycle", "test_auth_token_lifecycle.py", "asyncio", "marge_only", "api", "tests", "marge", ""], "setup": {"duration": 0.000349684152752161, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/api/test_auth_token_lifecycle.py', 156, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.0001262463629245758, "outcome": "passed"}}, {"nodeid": "tests/api/test_auth_token_lifecycle.py::test_listed_tokens_have_all_fields", "lineno": 173, "outcome": "skipped", "keywords": ["test_listed_tokens_have_all_fields", "test_auth_token_lifecycle.py", "asyncio", "marge_only", "api", "tests", "marge", ""], "setup": {"duration": 0.00019466876983642578, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/api/test_auth_token_lifecycle.py', 174, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00012767687439918518, "outcome": "passed"}}, {"nodeid": "tests/api/test_automation_yaml_roundtrip.py::test_get_automation_yaml_not_empty", "lineno": 12, "outcome": "failed", "keywords": ["test_get_automation_yaml_not_empty", "test_automation_yaml_roundtrip.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005242850165814161, "outcome": "passed"}, "call": {"duration": 0.002629184164106846, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_automation_yaml_roundtrip.py", "lineno": 19, "message": "assert 404 == 200\n +  where 404 = <Response [404 Not Found]>.status_code"}, "traceback": [{"path": "tests/api/test_automation_yaml_roundtrip.py", "lineno": 19, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b1d28b20>\n\n    async def test_get_automation_yaml_not_empty(rest):\n        \"\"\"GET automation YAML returns non-empty content.\"\"\"\n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/config/automation/yaml\",\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 404 == 200\nE        +  where 404 = <Response [404 Not Found]>.status_code\n\ntests/api/test_automation_yaml_roundtrip.py:19: AssertionError"}, "teardown": {"duration": 0.0004680030979216099, "outcome": "passed"}}, {"nodeid": "tests/api/test_automation_yaml_roundtrip.py::test_automation_yaml_contains_alias", "lineno": 22, "outcome": "failed", "keywords": ["test_automation_yaml_contains_alias", "test_automation_yaml_roundtrip.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005006963852792978, "outcome": "passed"}, "call": {"duration": 0.0026930859312415123, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_automation_yaml_roundtrip.py", "lineno": 29, "message": "AssertionError: assert 'alias' in '404: Not Found'\n +  where '404: Not Found' = <Response [404 Not Found]>.text"}, "traceback": [{"path": "tests/api/test_automation_yaml_roundtrip.py", "lineno": 29, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0a66880>\n\n    async def test_automation_yaml_contains_alias(rest):\n        \"\"\"Automation YAML contains alias fields.\"\"\"\n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/config/automation/yaml\",\n            headers=rest._headers(),\n        )\n>       assert \"alias\" in resp.text\nE       AssertionError: assert 'alias' in '404: Not Found'\nE        +  where '404: Not Found' = <Response [404 Not Found]>.text\n\ntests/api/test_automation_yaml_roundtrip.py:29: AssertionError"}, "teardown": {"duration": 0.0005263891071081161, "outcome": "passed"}}, {"nodeid": "tests/api/test_automation_yaml_roundtrip.py::test_automation_yaml_contains_trigger", "lineno": 31, "outcome": "failed", "keywords": ["test_automation_yaml_contains_trigger", "test_automation_yaml_roundtrip.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005295326001942158, "outcome": "passed"}, "call": {"duration": 0.002896086312830448, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_automation_yaml_roundtrip.py", "lineno": 38, "message": "AssertionError: assert 'trigger' in '404: Not Found'\n +  where '404: Not Found' = <Response [404 Not Found]>.text"}, "traceback": [{"path": "tests/api/test_automation_yaml_roundtrip.py", "lineno": 38, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0a7c0a0>\n\n    async def test_automation_yaml_contains_trigger(rest):\n        \"\"\"Automation YAML contains trigger definitions.\"\"\"\n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/config/automation/yaml\",\n            headers=rest._headers(),\n        )\n>       assert \"trigger\" in resp.text\nE       AssertionError: assert 'trigger' in '404: Not Found'\nE        +  where '404: Not Found' = <Response [404 Not Found]>.text\n\ntests/api/test_automation_yaml_roundtrip.py:38: AssertionError"}, "teardown": {"duration": 0.0005390620790421963, "outcome": "passed"}}, {"nodeid": "tests/api/test_automation_yaml_roundtrip.py::test_automation_yaml_contains_action", "lineno": 40, "outcome": "failed", "keywords": ["test_automation_yaml_contains_action", "test_automation_yaml_roundtrip.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005212627816945314, "outcome": "passed"}, "call": {"duration": 0.002743158023804426, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_automation_yaml_roundtrip.py", "lineno": 47, "message": "AssertionError: assert 'action' in '404: Not Found'\n +  where '404: Not Found' = <Response [404 Not Found]>.text"}, "traceback": [{"path": "tests/api/test_automation_yaml_roundtrip.py", "lineno": 47, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0ac2eb0>\n\n    async def test_automation_yaml_contains_action(rest):\n        \"\"\"Automation YAML contains action definitions.\"\"\"\n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/config/automation/yaml\",\n            headers=rest._headers(),\n        )\n>       assert \"action\" in resp.text\nE       AssertionError: assert 'action' in '404: Not Found'\nE        +  where '404: Not Found' = <Response [404 Not Found]>.text\n\ntests/api/test_automation_yaml_roundtrip.py:47: AssertionError"}, "teardown": {"duration": 0.000528654083609581, "outcome": "passed"}}, {"nodeid": "tests/api/test_automation_yaml_roundtrip.py::test_scene_yaml_contains_name", "lineno": 49, "outcome": "failed", "keywords": ["test_scene_yaml_contains_name", "test_automation_yaml_roundtrip.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005539347883313894, "outcome": "passed"}, "call": {"duration": 0.0030005956068634987, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_automation_yaml_roundtrip.py", "lineno": 56, "message": "assert 404 == 200\n +  where 404 = <Response [404 Not Found]>.status_code"}, "traceback": [{"path": "tests/api/test_automation_yaml_roundtrip.py", "lineno": 56, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0ac2130>\n\n    async def test_scene_yaml_contains_name(rest):\n        \"\"\"Scene YAML contains name fields.\"\"\"\n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/config/scene/yaml\",\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 404 == 200\nE        +  where 404 = <Response [404 Not Found]>.status_code\n\ntests/api/test_automation_yaml_roundtrip.py:56: AssertionError"}, "teardown": {"duration": 0.0006277821958065033, "outcome": "passed"}}, {"nodeid": "tests/api/test_automation_yaml_roundtrip.py::test_scene_yaml_contains_entities", "lineno": 59, "outcome": "failed", "keywords": ["test_scene_yaml_contains_entities", "test_automation_yaml_roundtrip.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005019450094550848, "outcome": "passed"}, "call": {"duration": 0.002667883411049843, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_automation_yaml_roundtrip.py", "lineno": 66, "message": "AssertionError: assert 'entities' in '404: Not Found'\n +  where '404: Not Found' = <Response [404 Not Found]>.text"}, "traceback": [{"path": "tests/api/test_automation_yaml_roundtrip.py", "lineno": 66, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0a8f5b0>\n\n    async def test_scene_yaml_contains_entities(rest):\n        \"\"\"Scene YAML contains entity definitions.\"\"\"\n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/config/scene/yaml\",\n            headers=rest._headers(),\n        )\n>       assert \"entities\" in resp.text\nE       AssertionError: assert 'entities' in '404: Not Found'\nE        +  where '404: Not Found' = <Response [404 Not Found]>.text\n\ntests/api/test_automation_yaml_roundtrip.py:66: AssertionError"}, "teardown": {"duration": 0.000498421024531126, "outcome": "passed"}}, {"nodeid": "tests/api/test_automation_yaml_roundtrip.py::test_reload_then_list_consistent", "lineno": 68, "outcome": "failed", "keywords": ["test_reload_then_list_consistent", "test_automation_yaml_roundtrip.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.004912198055535555, "outcome": "passed"}, "call": {"duration": 0.0023039840161800385, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)"}, "traceback": [{"path": "tests/api/test_automation_yaml_roundtrip.py", "lineno": 75, "message": ""}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 832, "message": "in json"}, {"path": "../../anaconda3/lib/python3.9/json/__init__.py", "lineno": 346, "message": "in loads"}, {"path": "../../anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "JSONDecodeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0a8f5e0>\n\n    async def test_reload_then_list_consistent(rest):\n        \"\"\"Automation list is consistent before and after reload.\"\"\"\n        resp1 = await rest.client.get(\n            f\"{rest.base_url}/api/config/automation/config\",\n            headers=rest._headers(),\n        )\n>       before = resp1.json()\n\ntests/api/test_automation_yaml_roundtrip.py:75: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:832: in json\n    return jsonlib.loads(self.content, **kwargs)\n../../anaconda3/lib/python3.9/json/__init__.py:346: in loads\n    return _default_decoder.decode(s)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <json.decoder.JSONDecoder object at 0x7f47b2e5fe50>, s = '404: Not Found'\n_w = <built-in method match of re.Pattern object at 0x7f47b3015cf0>\n\n    def decode(self, s, _w=WHITESPACE.match):\n        \"\"\"Return the Python representation of ``s`` (a ``str`` instance\n        containing a JSON document).\n    \n        \"\"\"\n        obj, end = self.raw_decode(s, idx=_w(s, 0).end())\n        end = _w(s, end).end()\n        if end != len(s):\n>           raise JSONDecodeError(\"Extra data\", s, end)\nE           json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)\n\n../../anaconda3/lib/python3.9/json/decoder.py:340: JSONDecodeError"}, "teardown": {"duration": 0.0006495239213109016, "outcome": "passed"}}, {"nodeid": "tests/api/test_automation_yaml_roundtrip.py::test_reload_count_matches_automations", "lineno": 93, "outcome": "failed", "keywords": ["test_reload_count_matches_automations", "test_automation_yaml_roundtrip.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005467079114168882, "outcome": "passed"}, "call": {"duration": 0.002805716823786497, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)"}, "traceback": [{"path": "tests/api/test_automation_yaml_roundtrip.py", "lineno": 101, "message": ""}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 832, "message": "in json"}, {"path": "../../anaconda3/lib/python3.9/json/__init__.py", "lineno": 346, "message": "in loads"}, {"path": "../../anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "JSONDecodeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b09113d0>\n\n    async def test_reload_count_matches_automations(rest):\n        \"\"\"Reload returns count matching number of automations.\"\"\"\n        resp = await rest.client.post(\n            f\"{rest.base_url}/api/config/core/reload\",\n            json={},\n            headers=rest._headers(),\n        )\n>       data = resp.json()\n\ntests/api/test_automation_yaml_roundtrip.py:101: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:832: in json\n    return jsonlib.loads(self.content, **kwargs)\n../../anaconda3/lib/python3.9/json/__init__.py:346: in loads\n    return _default_decoder.decode(s)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <json.decoder.JSONDecoder object at 0x7f47b2e5fe50>, s = '404: Not Found'\n_w = <built-in method match of re.Pattern object at 0x7f47b3015cf0>\n\n    def decode(self, s, _w=WHITESPACE.match):\n        \"\"\"Return the Python representation of ``s`` (a ``str`` instance\n        containing a JSON document).\n    \n        \"\"\"\n        obj, end = self.raw_decode(s, idx=_w(s, 0).end())\n        end = _w(s, end).end()\n        if end != len(s):\n>           raise JSONDecodeError(\"Extra data\", s, end)\nE           json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)\n\n../../anaconda3/lib/python3.9/json/decoder.py:340: JSONDecodeError"}, "teardown": {"duration": 0.0006258077919483185, "outcome": "passed"}}, {"nodeid": "tests/api/test_automation_yaml_roundtrip.py::test_check_config_returns_valid", "lineno": 111, "outcome": "passed", "keywords": ["test_check_config_returns_valid", "test_automation_yaml_roundtrip.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005107961129397154, "outcome": "passed"}, "call": {"duration": 0.009308699052780867, "outcome": "passed"}, "teardown": {"duration": 0.000556205864995718, "outcome": "passed"}}, {"nodeid": "tests/api/test_backup_error_log.py::test_backup_returns_200", "lineno": 18, "outcome": "skipped", "keywords": ["test_backup_returns_200", "test_backup_error_log.py", "asyncio", "marge_only", "api", "tests", "marge", ""], "setup": {"duration": 0.0002450798638164997, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/api/test_backup_error_log.py', 19, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00012632133439183235, "outcome": "passed"}}, {"nodeid": "tests/api/test_backup_error_log.py::test_backup_returns_gzip", "lineno": 27, "outcome": "skipped", "keywords": ["test_backup_returns_gzip", "test_backup_error_log.py", "asyncio", "marge_only", "api", "tests", "marge", ""], "setup": {"duration": 0.00020339619368314743, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/api/test_backup_error_log.py', 28, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.0001258612610399723, "outcome": "passed"}}, {"nodeid": "tests/api/test_backup_error_log.py::test_backup_has_content_disposition", "lineno": 38, "outcome": "skipped", "keywords": ["test_backup_has_content_disposition", "test_backup_error_log.py", "asyncio", "marge_only", "api", "tests", "marge", ""], "setup": {"duration": 0.00019677123054862022, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/api/test_backup_error_log.py', 39, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.0001241280697286129, "outcome": "passed"}}, {"nodeid": "tests/api/test_backup_error_log.py::test_backup_is_valid_targz", "lineno": 51, "outcome": "skipped", "keywords": ["test_backup_is_valid_targz", "test_backup_error_log.py", "asyncio", "marge_only", "api", "tests", "marge", ""], "setup": {"duration": 0.0001960410736501217, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/api/test_backup_error_log.py', 52, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00027307774871587753, "outcome": "passed"}}, {"nodeid": "tests/api/test_backup_error_log.py::test_backup_contains_file[marge.db]", "lineno": 67, "outcome": "skipped", "keywords": ["test_backup_contains_file[marge.db]", "parametrize", "pytestmark", "marge.db", "test_backup_error_log.py", "asyncio", "marge_only", "api", "tests", "marge", ""], "setup": {"duration": 0.00024088798090815544, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/api/test_backup_error_log.py', 68, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00012886710464954376, "outcome": "passed"}}, {"nodeid": "tests/api/test_backup_error_log.py::test_backup_contains_file[automations.yaml]", "lineno": 67, "outcome": "skipped", "keywords": ["test_backup_contains_file[automations.yaml]", "parametrize", "pytestmark", "automations.yaml", "test_backup_error_log.py", "asyncio", "marge_only", "api", "tests", "marge", ""], "setup": {"duration": 0.00019244197756052017, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/api/test_backup_error_log.py', 68, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00012133410200476646, "outcome": "passed"}}, {"nodeid": "tests/api/test_backup_error_log.py::test_backup_contains_file[scenes.yaml]", "lineno": 67, "outcome": "skipped", "keywords": ["test_backup_contains_file[scenes.yaml]", "parametrize", "pytestmark", "scenes.yaml", "test_backup_error_log.py", "asyncio", "marge_only", "api", "tests", "marge", ""], "setup": {"duration": 0.00020565884187817574, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/api/test_backup_error_log.py', 68, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.0001244829036295414, "outcome": "passed"}}, {"nodeid": "tests/api/test_backup_error_log.py::test_backup_nonzero_size", "lineno": 84, "outcome": "skipped", "keywords": ["test_backup_nonzero_size", "test_backup_error_log.py", "asyncio", "marge_only", "api", "tests", "marge", ""], "setup": {"duration": 0.000192347913980484, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/api/test_backup_error_log.py', 85, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00013915682211518288, "outcome": "passed"}}, {"nodeid": "tests/api/test_backup_error_log.py::test_error_log_returns_200", "lineno": 97, "outcome": "skipped", "keywords": ["test_error_log_returns_200", "test_backup_error_log.py", "asyncio", "marge_only", "api", "tests", "marge", ""], "setup": {"duration": 0.00021136365830898285, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/api/test_backup_error_log.py', 98, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00016114627942442894, "outcome": "passed"}}, {"nodeid": "tests/api/test_backup_error_log.py::test_error_log_returns_string", "lineno": 106, "outcome": "skipped", "keywords": ["test_error_log_returns_string", "test_backup_error_log.py", "asyncio", "marge_only", "api", "tests", "marge", ""], "setup": {"duration": 0.00019099609926342964, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/api/test_backup_error_log.py', 107, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00012513203546404839, "outcome": "passed"}}, {"nodeid": "tests/api/test_backup_statistics_endpoints.py::test_backup_returns_200", "lineno": 16, "outcome": "skipped", "keywords": ["test_backup_returns_200", "test_backup_statistics_endpoints.py", "asyncio", "marge_only", "api", "tests", "marge", ""], "setup": {"duration": 0.00020343298092484474, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/api/test_backup_statistics_endpoints.py', 17, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00012486660853028297, "outcome": "passed"}}, {"nodeid": "tests/api/test_backup_statistics_endpoints.py::test_backup_content_type_gzip", "lineno": 25, "outcome": "skipped", "keywords": ["test_backup_content_type_gzip", "test_backup_statistics_endpoints.py", "asyncio", "marge_only", "api", "tests", "marge", ""], "setup": {"duration": 0.00019246991723775864, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/api/test_backup_statistics_endpoints.py', 26, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00012578489258885384, "outcome": "passed"}}, {"nodeid": "tests/api/test_backup_statistics_endpoints.py::test_backup_has_content_disposition", "lineno": 35, "outcome": "skipped", "keywords": ["test_backup_has_content_disposition", "test_backup_statistics_endpoints.py", "asyncio", "marge_only", "api", "tests", "marge", ""], "setup": {"duration": 0.00019454071298241615, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/api/test_backup_statistics_endpoints.py', 36, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00017494428902864456, "outcome": "passed"}}, {"nodeid": "tests/api/test_backup_statistics_endpoints.py::test_backup_body_non_empty", "lineno": 46, "outcome": "skipped", "keywords": ["test_backup_body_non_empty", "test_backup_statistics_endpoints.py", "asyncio", "marge_only", "api", "tests", "marge", ""], "setup": {"duration": 0.0001966855488717556, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/api/test_backup_statistics_endpoints.py', 47, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.0002691708505153656, "outcome": "passed"}}, {"nodeid": "tests/api/test_backup_statistics_endpoints.py::test_backup_is_valid_gzip", "lineno": 55, "outcome": "skipped", "keywords": ["test_backup_is_valid_gzip", "test_backup_statistics_endpoints.py", "asyncio", "marge_only", "api", "tests", "marge", ""], "setup": {"duration": 0.0002447073347866535, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/api/test_backup_statistics_endpoints.py', 56, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00013493187725543976, "outcome": "passed"}}, {"nodeid": "tests/api/test_backup_statistics_endpoints.py::test_statistics_returns_200", "lineno": 69, "outcome": "skipped", "keywords": ["test_statistics_returns_200", "test_backup_statistics_endpoints.py", "asyncio", "marge_only", "api", "tests", "marge", ""], "setup": {"duration": 0.00021510710939764977, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/api/test_backup_statistics_endpoints.py', 70, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00013801082968711853, "outcome": "passed"}}, {"nodeid": "tests/api/test_backup_statistics_endpoints.py::test_statistics_returns_list", "lineno": 84, "outcome": "skipped", "keywords": ["test_statistics_returns_list", "test_backup_statistics_endpoints.py", "asyncio", "marge_only", "api", "tests", "marge", ""], "setup": {"duration": 0.00021035410463809967, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/api/test_backup_statistics_endpoints.py', 85, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00012869900092482567, "outcome": "passed"}}, {"nodeid": "tests/api/test_backup_statistics_endpoints.py::test_statistics_has_bucket_fields", "lineno": 99, "outcome": "skipped", "keywords": ["test_statistics_has_bucket_fields", "test_backup_statistics_endpoints.py", "asyncio", "marge_only", "api", "tests", "marge", ""], "setup": {"duration": 0.0003058020956814289, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/api/test_backup_statistics_endpoints.py', 100, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00012689782306551933, "outcome": "passed"}}, {"nodeid": "tests/api/test_backup_statistics_endpoints.py::test_statistics_min_max_correct", "lineno": 123, "outcome": "skipped", "keywords": ["test_statistics_min_max_correct", "test_backup_statistics_endpoints.py", "asyncio", "marge_only", "api", "tests", "marge", ""], "setup": {"duration": 0.00019390834495425224, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/api/test_backup_statistics_endpoints.py', 124, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00012650201097130775, "outcome": "passed"}}, {"nodeid": "tests/api/test_backup_statistics_endpoints.py::test_statistics_empty_for_new_entity", "lineno": 143, "outcome": "skipped", "keywords": ["test_statistics_empty_for_new_entity", "test_backup_statistics_endpoints.py", "asyncio", "marge_only", "api", "tests", "marge", ""], "setup": {"duration": 0.00020074006170034409, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/api/test_backup_statistics_endpoints.py', 144, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00012700911611318588, "outcome": "passed"}}, {"nodeid": "tests/api/test_backup_statistics_endpoints.py::test_statistics_non_numeric_entity", "lineno": 157, "outcome": "skipped", "keywords": ["test_statistics_non_numeric_entity", "test_backup_statistics_endpoints.py", "asyncio", "marge_only", "api", "tests", "marge", ""], "setup": {"duration": 0.00019514095038175583, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/api/test_backup_statistics_endpoints.py', 158, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.0001265415921807289, "outcome": "passed"}}, {"nodeid": "tests/api/test_backup_statistics_endpoints.py::test_error_log_returns_200", "lineno": 175, "outcome": "skipped", "keywords": ["test_error_log_returns_200", "test_backup_statistics_endpoints.py", "asyncio", "marge_only", "api", "tests", "marge", ""], "setup": {"duration": 0.0001989719457924366, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/api/test_backup_statistics_endpoints.py', 176, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00024728989228606224, "outcome": "passed"}}, {"nodeid": "tests/api/test_backup_statistics_endpoints.py::test_error_log_returns_text", "lineno": 184, "outcome": "skipped", "keywords": ["test_error_log_returns_text", "test_backup_statistics_endpoints.py", "asyncio", "marge_only", "api", "tests", "marge", ""], "setup": {"duration": 0.0001942967064678669, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/api/test_backup_statistics_endpoints.py', 185, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00012831995263695717, "outcome": "passed"}}, {"nodeid": "tests/api/test_check_config_endpoint.py::test_check_config_returns_200", "lineno": 13, "outcome": "passed", "keywords": ["test_check_config_returns_200", "test_check_config_endpoint.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005239030346274376, "outcome": "passed"}, "call": {"duration": 0.009976258035749197, "outcome": "passed"}, "teardown": {"duration": 0.0005052448250353336, "outcome": "passed"}}, {"nodeid": "tests/api/test_check_config_endpoint.py::test_check_config_has_result_field", "lineno": 22, "outcome": "passed", "keywords": ["test_check_config_has_result_field", "test_check_config_endpoint.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005270736292004585, "outcome": "passed"}, "call": {"duration": 0.010555098298937082, "outcome": "passed"}, "teardown": {"duration": 0.0005839462392032146, "outcome": "passed"}}, {"nodeid": "tests/api/test_check_config_endpoint.py::test_check_config_valid_result", "lineno": 32, "outcome": "passed", "keywords": ["test_check_config_valid_result", "test_check_config_endpoint.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005331728607416153, "outcome": "passed"}, "call": {"duration": 0.009273363277316093, "outcome": "passed"}, "teardown": {"duration": 0.0006514713168144226, "outcome": "passed"}}, {"nodeid": "tests/api/test_check_config_endpoint.py::test_check_config_has_errors_field", "lineno": 42, "outcome": "passed", "keywords": ["test_check_config_has_errors_field", "test_check_config_endpoint.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005295654758810997, "outcome": "passed"}, "call": {"duration": 0.009998073801398277, "outcome": "passed"}, "teardown": {"duration": 0.0005219876766204834, "outcome": "passed"}}, {"nodeid": "tests/api/test_check_config_endpoint.py::test_check_config_errors_null_when_valid", "lineno": 52, "outcome": "passed", "keywords": ["test_check_config_errors_null_when_valid", "test_check_config_endpoint.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005046997684985399, "outcome": "passed"}, "call": {"duration": 0.01172071322798729, "outcome": "passed"}, "teardown": {"duration": 0.0005446518771350384, "outcome": "passed"}}, {"nodeid": "tests/api/test_check_config_endpoint.py::test_check_config_response_is_json", "lineno": 62, "outcome": "passed", "keywords": ["test_check_config_response_is_json", "test_check_config_endpoint.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.0052117700688540936, "outcome": "passed"}, "call": {"duration": 0.009453740902245045, "outcome": "passed"}, "teardown": {"duration": 0.0005622520111501217, "outcome": "passed"}}, {"nodeid": "tests/api/test_check_config_endpoint.py::test_check_config_idempotent", "lineno": 71, "outcome": "passed", "keywords": ["test_check_config_idempotent", "test_check_config_endpoint.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005096706096082926, "outcome": "passed"}, "call": {"duration": 0.024767651222646236, "outcome": "passed"}, "teardown": {"duration": 0.0005659903399646282, "outcome": "passed"}}, {"nodeid": "tests/api/test_check_config_endpoint.py::test_check_config_after_reload", "lineno": 83, "outcome": "passed", "keywords": ["test_check_config_after_reload", "test_check_config_endpoint.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005415096879005432, "outcome": "passed"}, "call": {"duration": 0.3164440649561584, "outcome": "passed"}, "teardown": {"duration": 0.0008499259129166603, "outcome": "passed"}}, {"nodeid": "tests/api/test_concurrent_operations.py::test_concurrent_writes_same_entity", "lineno": 21, "outcome": "passed", "keywords": ["test_concurrent_writes_same_entity", "test_concurrent_operations.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.0006929729133844376, "outcome": "passed"}, "call": {"duration": 0.03154836595058441, "outcome": "passed"}, "teardown": {"duration": 0.000509939156472683, "outcome": "passed"}}, {"nodeid": "tests/api/test_concurrent_operations.py::test_concurrent_writes_different_entities", "lineno": 36, "outcome": "passed", "keywords": ["test_concurrent_writes_different_entities", "test_concurrent_operations.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.0005208686925470829, "outcome": "passed"}, "call": {"duration": 0.08503419626504183, "outcome": "passed"}, "teardown": {"duration": 0.0005572158843278885, "outcome": "passed"}}, {"nodeid": "tests/api/test_concurrent_operations.py::test_concurrent_read_write", "lineno": 51, "outcome": "passed", "keywords": ["test_concurrent_read_write", "test_concurrent_operations.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.00047182291746139526, "outcome": "passed"}, "call": {"duration": 0.03833305183798075, "outcome": "passed"}, "teardown": {"duration": 0.00037117814645171165, "outcome": "passed"}}, {"nodeid": "tests/api/test_concurrent_operations.py::test_concurrent_service_calls", "lineno": 79, "outcome": "passed", "keywords": ["test_concurrent_service_calls", "test_concurrent_operations.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.0004024491645395756, "outcome": "passed"}, "call": {"duration": 0.05731699988245964, "outcome": "passed"}, "teardown": {"duration": 0.000368557870388031, "outcome": "passed"}}, {"nodeid": "tests/api/test_concurrent_operations.py::test_concurrent_toggle_same_entity", "lineno": 102, "outcome": "passed", "keywords": ["test_concurrent_toggle_same_entity", "test_concurrent_operations.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.00041835568845272064, "outcome": "passed"}, "call": {"duration": 0.02659207209944725, "outcome": "passed"}, "teardown": {"duration": 0.0003515058197081089, "outcome": "passed"}}, {"nodeid": "tests/api/test_concurrent_operations.py::test_concurrent_template_renders", "lineno": 125, "outcome": "passed", "keywords": ["test_concurrent_template_renders", "test_concurrent_operations.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.0003935149870812893, "outcome": "passed"}, "call": {"duration": 0.037272625137120485, "outcome": "passed"}, "teardown": {"duration": 0.00040528783574700356, "outcome": "passed"}}, {"nodeid": "tests/api/test_concurrent_operations.py::test_concurrent_search_queries", "lineno": 144, "outcome": "passed", "keywords": ["test_concurrent_search_queries", "test_concurrent_operations.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.0005264580249786377, "outcome": "passed"}, "call": {"duration": 0.03576566418632865, "outcome": "passed"}, "teardown": {"duration": 0.00041964370757341385, "outcome": "passed"}}, {"nodeid": "tests/api/test_concurrent_operations.py::test_mixed_operations_concurrent", "lineno": 160, "outcome": "passed", "keywords": ["test_mixed_operations_concurrent", "test_concurrent_operations.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.00039177900180220604, "outcome": "passed"}, "call": {"duration": 0.021164848003536463, "outcome": "passed"}, "teardown": {"duration": 0.0003916011191904545, "outcome": "passed"}}, {"nodeid": "tests/api/test_concurrent_operations.py::test_burst_100_state_sets", "lineno": 185, "outcome": "passed", "keywords": ["test_burst_100_state_sets", "test_concurrent_operations.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.0004086550325155258, "outcome": "passed"}, "call": {"duration": 0.18535968195647, "outcome": "passed"}, "teardown": {"duration": 0.0005532517097890377, "outcome": "passed"}}, {"nodeid": "tests/api/test_concurrent_operations.py::test_delete_while_reading", "lineno": 205, "outcome": "passed", "keywords": ["test_delete_while_reading", "test_concurrent_operations.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.0005510500632226467, "outcome": "passed"}, "call": {"duration": 0.01608768291771412, "outcome": "passed"}, "teardown": {"duration": 0.00034418562427163124, "outcome": "passed"}}, {"nodeid": "tests/api/test_concurrent_operations.py::test_concurrent_health_checks", "lineno": 232, "outcome": "passed", "keywords": ["test_concurrent_health_checks", "test_concurrent_operations.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.00039841094985604286, "outcome": "passed"}, "call": {"duration": 0.07276470400393009, "outcome": "passed"}, "teardown": {"duration": 0.0005075889639556408, "outcome": "passed"}}, {"nodeid": "tests/api/test_config_endpoints.py::test_config_has_state", "lineno": 15, "outcome": "passed", "keywords": ["test_config_has_state", "test_config_endpoints.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005537769291549921, "outcome": "passed"}, "call": {"duration": 0.0026032798923552036, "outcome": "passed"}, "teardown": {"duration": 0.0004875878803431988, "outcome": "passed"}}, {"nodeid": "tests/api/test_config_endpoints.py::test_config_has_location", "lineno": 22, "outcome": "passed", "keywords": ["test_config_has_location", "test_config_endpoints.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005190491210669279, "outcome": "passed"}, "call": {"duration": 0.0026567326858639717, "outcome": "passed"}, "teardown": {"duration": 0.0004963669925928116, "outcome": "passed"}}, {"nodeid": "tests/api/test_config_endpoints.py::test_config_has_unit_system", "lineno": 30, "outcome": "passed", "keywords": ["test_config_has_unit_system", "test_config_endpoints.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005027253646403551, "outcome": "passed"}, "call": {"duration": 0.0024495800025761127, "outcome": "passed"}, "teardown": {"duration": 0.00046200724318623543, "outcome": "passed"}}, {"nodeid": "tests/api/test_config_endpoints.py::test_config_has_version", "lineno": 36, "outcome": "passed", "keywords": ["test_config_has_version", "test_config_endpoints.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005063122138381004, "outcome": "passed"}, "call": {"duration": 0.005153449717909098, "outcome": "passed"}, "teardown": {"duration": 0.00047586020082235336, "outcome": "passed"}}, {"nodeid": "tests/api/test_config_endpoints.py::test_error_log_endpoint", "lineno": 45, "outcome": "passed", "keywords": ["test_error_log_endpoint", "test_config_endpoints.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.0053525520488619804, "outcome": "passed"}, "call": {"duration": 0.004037567880004644, "outcome": "passed"}, "teardown": {"duration": 0.0004986240528523922, "outcome": "passed"}}, {"nodeid": "tests/api/test_config_endpoints.py::test_check_config", "lineno": 56, "outcome": "passed", "keywords": ["test_check_config", "test_config_endpoints.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.0051317899487912655, "outcome": "passed"}, "call": {"duration": 0.009274648036807775, "outcome": "passed"}, "teardown": {"duration": 0.0005570435896515846, "outcome": "passed"}}, {"nodeid": "tests/api/test_config_endpoints.py::test_health_has_status", "lineno": 69, "outcome": "failed", "keywords": ["test_health_has_status", "test_config_endpoints.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005094552878290415, "outcome": "passed"}, "call": {"duration": 0.005065856967121363, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '404 Not Found' for url 'http://localhost:8123/api/health'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/404"}, "traceback": [{"path": "tests/api/test_config_endpoints.py", "lineno": 72, "message": ""}, {"path": "tests/conftest.py", "lineno": 122, "message": "in get_health"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b054a760>\n\n    async def test_health_has_status(rest):\n        \"\"\"GET /api/health includes status field.\"\"\"\n>       health = await rest.get_health()\n\ntests/api/test_config_endpoints.py:72: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:122: in get_health\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [404 Not Found]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '404 Not Found' for url 'http://localhost:8123/api/health'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/404\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0006968509405851364, "outcome": "passed"}}, {"nodeid": "tests/api/test_config_endpoints.py::test_health_has_entity_count", "lineno": 76, "outcome": "failed", "keywords": ["test_health_has_entity_count", "test_config_endpoints.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005458808969706297, "outcome": "passed"}, "call": {"duration": 0.002634708769619465, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '404 Not Found' for url 'http://localhost:8123/api/health'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/404"}, "traceback": [{"path": "tests/api/test_config_endpoints.py", "lineno": 79, "message": ""}, {"path": "tests/conftest.py", "lineno": 122, "message": "in get_health"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b07ee790>\n\n    async def test_health_has_entity_count(rest):\n        \"\"\"GET /api/health includes entity_count.\"\"\"\n>       health = await rest.get_health()\n\ntests/api/test_config_endpoints.py:79: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:122: in get_health\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [404 Not Found]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '404 Not Found' for url 'http://localhost:8123/api/health'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/404\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0007289708591997623, "outcome": "passed"}}, {"nodeid": "tests/api/test_config_endpoints.py::test_health_has_uptime", "lineno": 84, "outcome": "failed", "keywords": ["test_health_has_uptime", "test_config_endpoints.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005469791125506163, "outcome": "passed"}, "call": {"duration": 0.002642843872308731, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '404 Not Found' for url 'http://localhost:8123/api/health'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/404"}, "traceback": [{"path": "tests/api/test_config_endpoints.py", "lineno": 87, "message": ""}, {"path": "tests/conftest.py", "lineno": 122, "message": "in get_health"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b07dd850>\n\n    async def test_health_has_uptime(rest):\n        \"\"\"GET /api/health includes uptime_seconds.\"\"\"\n>       health = await rest.get_health()\n\ntests/api/test_config_endpoints.py:87: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:122: in get_health\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [404 Not Found]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '404 Not Found' for url 'http://localhost:8123/api/health'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/404\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0007720757275819778, "outcome": "passed"}}, {"nodeid": "tests/api/test_config_endpoints.py::test_health_has_memory", "lineno": 91, "outcome": "failed", "keywords": ["test_health_has_memory", "test_config_endpoints.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005241234786808491, "outcome": "passed"}, "call": {"duration": 0.002610748168081045, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '404 Not Found' for url 'http://localhost:8123/api/health'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/404"}, "traceback": [{"path": "tests/api/test_config_endpoints.py", "lineno": 94, "message": ""}, {"path": "tests/conftest.py", "lineno": 122, "message": "in get_health"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b05aa970>\n\n    async def test_health_has_memory(rest):\n        \"\"\"GET /api/health includes memory_rss_kb.\"\"\"\n>       health = await rest.get_health()\n\ntests/api/test_config_endpoints.py:94: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:122: in get_health\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [404 Not Found]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '404 Not Found' for url 'http://localhost:8123/api/health'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/404\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0006833220832049847, "outcome": "passed"}}, {"nodeid": "tests/api/test_config_endpoints.py::test_automation_reload_endpoint", "lineno": 100, "outcome": "failed", "keywords": ["test_automation_reload_endpoint", "test_config_endpoints.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005120040848851204, "outcome": "passed"}, "call": {"duration": 0.0026585240848362446, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_config_endpoints.py", "lineno": 107, "message": "assert 404 == 200\n +  where 404 = <Response [404 Not Found]>.status_code"}, "traceback": [{"path": "tests/api/test_config_endpoints.py", "lineno": 107, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b061d190>\n\n    async def test_automation_reload_endpoint(rest):\n        \"\"\"POST /api/config/automation/reload returns success.\"\"\"\n        resp = await rest.client.post(\n            f\"{rest.base_url}/api/config/automation/reload\",\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 404 == 200\nE        +  where 404 = <Response [404 Not Found]>.status_code\n\ntests/api/test_config_endpoints.py:107: AssertionError"}, "teardown": {"duration": 0.0006143320351839066, "outcome": "passed"}}, {"nodeid": "tests/api/test_config_endpoints.py::test_prometheus_metrics_endpoint", "lineno": 111, "outcome": "failed", "keywords": ["test_prometheus_metrics_endpoint", "test_config_endpoints.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005039875861257315, "outcome": "passed"}, "call": {"duration": 0.002445091027766466, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_config_endpoints.py", "lineno": 115, "message": "assert 404 == 200\n +  where 404 = <Response [404 Not Found]>.status_code"}, "traceback": [{"path": "tests/api/test_config_endpoints.py", "lineno": 115, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b061dd30>\n\n    async def test_prometheus_metrics_endpoint(rest):\n        \"\"\"GET /metrics returns Prometheus-format text.\"\"\"\n        resp = await rest.client.get(f\"{rest.base_url}/metrics\")\n>       assert resp.status_code == 200\nE       assert 404 == 200\nE        +  where 404 = <Response [404 Not Found]>.status_code\n\ntests/api/test_config_endpoints.py:115: AssertionError"}, "teardown": {"duration": 0.0005334783345460892, "outcome": "passed"}}, {"nodeid": "tests/api/test_config_endpoints.py::test_devices_list", "lineno": 122, "outcome": "failed", "keywords": ["test_devices_list", "test_config_endpoints.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005107703618705273, "outcome": "passed"}, "call": {"duration": 0.002642679028213024, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_config_endpoints.py", "lineno": 129, "message": "assert 404 == 200\n +  where 404 = <Response [404 Not Found]>.status_code"}, "traceback": [{"path": "tests/api/test_config_endpoints.py", "lineno": 129, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0854190>\n\n    async def test_devices_list(rest):\n        \"\"\"GET /api/devices returns a list.\"\"\"\n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/devices\",\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 404 == 200\nE        +  where 404 = <Response [404 Not Found]>.status_code\n\ntests/api/test_config_endpoints.py:129: AssertionError"}, "teardown": {"duration": 0.0006319140084087849, "outcome": "passed"}}, {"nodeid": "tests/api/test_config_endpoints.py::test_device_create", "lineno": 132, "outcome": "failed", "keywords": ["test_device_create", "test_config_endpoints.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005106243770569563, "outcome": "passed"}, "call": {"duration": 0.0030339332297444344, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_config_endpoints.py", "lineno": 145, "message": "assert 404 == 200\n +  where 404 = <Response [404 Not Found]>.status_code"}, "traceback": [{"path": "tests/api/test_config_endpoints.py", "lineno": 145, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b08544c0>\n\n    async def test_device_create(rest):\n        \"\"\"POST /api/devices creates a new device.\"\"\"\n        resp = await rest.client.post(\n            f\"{rest.base_url}/api/devices\",\n            json={\n                \"device_id\": \"cts_test_device\",\n                \"name\": \"CTS Device\",\n                \"manufacturer\": \"Test Co\",\n                \"model\": \"T-1000\",\n            },\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 404 == 200\nE        +  where 404 = <Response [404 Not Found]>.status_code\n\ntests/api/test_config_endpoints.py:145: AssertionError"}, "teardown": {"duration": 0.0006994600407779217, "outcome": "passed"}}, {"nodeid": "tests/api/test_config_endpoints.py::test_device_delete", "lineno": 162, "outcome": "failed", "keywords": ["test_device_delete", "test_config_endpoints.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005021027289330959, "outcome": "passed"}, "call": {"duration": 0.005134785082191229, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_config_endpoints.py", "lineno": 179, "message": "assert 404 == 200\n +  where 404 = <Response [404 Not Found]>.status_code"}, "traceback": [{"path": "tests/api/test_config_endpoints.py", "lineno": 179, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0731b80>\n\n    async def test_device_delete(rest):\n        \"\"\"DELETE /api/devices/{id} removes a device.\"\"\"\n        await rest.client.post(\n            f\"{rest.base_url}/api/devices\",\n            json={\n                \"device_id\": \"cts_del_device\",\n                \"name\": \"Delete Device\",\n            },\n            headers=rest._headers(),\n        )\n    \n        resp = await rest.client.request(\n            \"DELETE\",\n            f\"{rest.base_url}/api/devices/cts_del_device\",\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 404 == 200\nE        +  where 404 = <Response [404 Not Found]>.status_code\n\ntests/api/test_config_endpoints.py:179: AssertionError"}, "teardown": {"duration": 0.0006764009594917297, "outcome": "passed"}}, {"nodeid": "tests/api/test_config_endpoints.py::test_device_entity_assignment", "lineno": 189, "outcome": "failed", "keywords": ["test_device_entity_assignment", "test_config_endpoints.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005118939094245434, "outcome": "passed"}, "call": {"duration": 0.005309925880283117, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_config_endpoints.py", "lineno": 208, "message": "assert 404 == 200\n +  where 404 = <Response [404 Not Found]>.status_code"}, "traceback": [{"path": "tests/api/test_config_endpoints.py", "lineno": 208, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b07cd790>\n\n    async def test_device_entity_assignment(rest):\n        \"\"\"POST /api/devices/{id}/entities/{eid} assigns entity to device.\"\"\"\n        # Create device and entity\n        await rest.client.post(\n            f\"{rest.base_url}/api/devices\",\n            json={\n                \"device_id\": \"cts_assign_device\",\n                \"name\": \"Assign Device\",\n            },\n            headers=rest._headers(),\n        )\n        await rest.set_state(\"sensor.device_assign_test\", \"42\")\n    \n        # Assign\n        resp = await rest.client.post(\n            f\"{rest.base_url}/api/devices/cts_assign_device/entities/sensor.device_assign_test\",\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 404 == 200\nE        +  where 404 = <Response [404 Not Found]>.status_code\n\ntests/api/test_config_endpoints.py:208: AssertionError"}, "teardown": {"duration": 0.0005560247227549553, "outcome": "passed"}}, {"nodeid": "tests/api/test_config_endpoints.py::test_api_root_status", "lineno": 219, "outcome": "passed", "keywords": ["test_api_root_status", "test_config_endpoints.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.00505286967381835, "outcome": "passed"}, "call": {"duration": 0.0024088737554848194, "outcome": "passed"}, "teardown": {"duration": 0.0004341909661889076, "outcome": "passed"}}, {"nodeid": "tests/api/test_config_endpoints.py::test_config_has_location_name", "lineno": 233, "outcome": "passed", "keywords": ["test_config_has_location_name", "test_config_endpoints.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005139537621289492, "outcome": "passed"}, "call": {"duration": 0.0026296651922166348, "outcome": "passed"}, "teardown": {"duration": 0.00048325303941965103, "outcome": "passed"}}, {"nodeid": "tests/api/test_config_endpoints.py::test_config_has_coordinates_in_range", "lineno": 244, "outcome": "passed", "keywords": ["test_config_has_coordinates_in_range", "test_config_endpoints.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.0050136432982981205, "outcome": "passed"}, "call": {"duration": 0.0058908830396831036, "outcome": "passed"}, "teardown": {"duration": 0.0005203266628086567, "outcome": "passed"}}, {"nodeid": "tests/api/test_config_endpoints.py::test_config_has_elevation", "lineno": 255, "outcome": "passed", "keywords": ["test_config_has_elevation", "test_config_endpoints.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005424852017313242, "outcome": "passed"}, "call": {"duration": 0.0031193550676107407, "outcome": "passed"}, "teardown": {"duration": 0.0005215290002524853, "outcome": "passed"}}, {"nodeid": "tests/api/test_config_endpoints.py::test_config_has_unit_system_fields", "lineno": 266, "outcome": "passed", "keywords": ["test_config_has_unit_system_fields", "test_config_endpoints.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.00531903887167573, "outcome": "passed"}, "call": {"duration": 0.0026666121557354927, "outcome": "passed"}, "teardown": {"duration": 0.000486613716930151, "outcome": "passed"}}, {"nodeid": "tests/api/test_config_endpoints.py::test_config_has_timezone", "lineno": 280, "outcome": "passed", "keywords": ["test_config_has_timezone", "test_config_endpoints.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005395959597080946, "outcome": "passed"}, "call": {"duration": 0.002565628383308649, "outcome": "passed"}, "teardown": {"duration": 0.0004896484315395355, "outcome": "passed"}}, {"nodeid": "tests/api/test_config_endpoints.py::test_health_has_version", "lineno": 293, "outcome": "failed", "keywords": ["test_health_has_version", "test_config_endpoints.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.00524749793112278, "outcome": "passed"}, "call": {"duration": 0.006826419848948717, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)"}, "traceback": [{"path": "tests/api/test_config_endpoints.py", "lineno": 300, "message": ""}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 832, "message": "in json"}, {"path": "../../anaconda3/lib/python3.9/json/__init__.py", "lineno": 346, "message": "in loads"}, {"path": "../../anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "JSONDecodeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b09788b0>\n\n    async def test_health_has_version(rest):\n        \"\"\"Health endpoint has version field.\"\"\"\n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/health\",\n            headers=rest._headers(),\n        )\n>       data = resp.json()\n\ntests/api/test_config_endpoints.py:300: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:832: in json\n    return jsonlib.loads(self.content, **kwargs)\n../../anaconda3/lib/python3.9/json/__init__.py:346: in loads\n    return _default_decoder.decode(s)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <json.decoder.JSONDecoder object at 0x7f47b2e5fe50>, s = '404: Not Found'\n_w = <built-in method match of re.Pattern object at 0x7f47b3015cf0>\n\n    def decode(self, s, _w=WHITESPACE.match):\n        \"\"\"Return the Python representation of ``s`` (a ``str`` instance\n        containing a JSON document).\n    \n        \"\"\"\n        obj, end = self.raw_decode(s, idx=_w(s, 0).end())\n        end = _w(s, end).end()\n        if end != len(s):\n>           raise JSONDecodeError(\"Extra data\", s, end)\nE           json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)\n\n../../anaconda3/lib/python3.9/json/decoder.py:340: JSONDecodeError"}, "teardown": {"duration": 0.0006826231256127357, "outcome": "passed"}}, {"nodeid": "tests/api/test_config_endpoints.py::test_health_has_memory_fields", "lineno": 303, "outcome": "failed", "keywords": ["test_health_has_memory_fields", "test_config_endpoints.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005422201938927174, "outcome": "passed"}, "call": {"duration": 0.002796140033751726, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)"}, "traceback": [{"path": "tests/api/test_config_endpoints.py", "lineno": 310, "message": ""}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 832, "message": "in json"}, {"path": "../../anaconda3/lib/python3.9/json/__init__.py", "lineno": 346, "message": "in loads"}, {"path": "../../anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "JSONDecodeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b05796d0>\n\n    async def test_health_has_memory_fields(rest):\n        \"\"\"Health endpoint has memory_rss_kb and memory_rss_mb.\"\"\"\n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/health\",\n            headers=rest._headers(),\n        )\n>       data = resp.json()\n\ntests/api/test_config_endpoints.py:310: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:832: in json\n    return jsonlib.loads(self.content, **kwargs)\n../../anaconda3/lib/python3.9/json/__init__.py:346: in loads\n    return _default_decoder.decode(s)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <json.decoder.JSONDecoder object at 0x7f47b2e5fe50>, s = '404: Not Found'\n_w = <built-in method match of re.Pattern object at 0x7f47b3015cf0>\n\n    def decode(self, s, _w=WHITESPACE.match):\n        \"\"\"Return the Python representation of ``s`` (a ``str`` instance\n        containing a JSON document).\n    \n        \"\"\"\n        obj, end = self.raw_decode(s, idx=_w(s, 0).end())\n        end = _w(s, end).end()\n        if end != len(s):\n>           raise JSONDecodeError(\"Extra data\", s, end)\nE           json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)\n\n../../anaconda3/lib/python3.9/json/decoder.py:340: JSONDecodeError"}, "teardown": {"duration": 0.00065578892827034, "outcome": "passed"}}, {"nodeid": "tests/api/test_config_endpoints.py::test_health_has_latency_fields", "lineno": 315, "outcome": "failed", "keywords": ["test_health_has_latency_fields", "test_config_endpoints.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005220357794314623, "outcome": "passed"}, "call": {"duration": 0.002665251027792692, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)"}, "traceback": [{"path": "tests/api/test_config_endpoints.py", "lineno": 322, "message": ""}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 832, "message": "in json"}, {"path": "../../anaconda3/lib/python3.9/json/__init__.py", "lineno": 346, "message": "in loads"}, {"path": "../../anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "JSONDecodeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b09e6c40>\n\n    async def test_health_has_latency_fields(rest):\n        \"\"\"Health endpoint has latency_avg_us and latency_max_us.\"\"\"\n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/health\",\n            headers=rest._headers(),\n        )\n>       data = resp.json()\n\ntests/api/test_config_endpoints.py:322: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:832: in json\n    return jsonlib.loads(self.content, **kwargs)\n../../anaconda3/lib/python3.9/json/__init__.py:346: in loads\n    return _default_decoder.decode(s)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <json.decoder.JSONDecoder object at 0x7f47b2e5fe50>, s = '404: Not Found'\n_w = <built-in method match of re.Pattern object at 0x7f47b3015cf0>\n\n    def decode(self, s, _w=WHITESPACE.match):\n        \"\"\"Return the Python representation of ``s`` (a ``str`` instance\n        containing a JSON document).\n    \n        \"\"\"\n        obj, end = self.raw_decode(s, idx=_w(s, 0).end())\n        end = _w(s, end).end()\n        if end != len(s):\n>           raise JSONDecodeError(\"Extra data\", s, end)\nE           json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)\n\n../../anaconda3/lib/python3.9/json/decoder.py:340: JSONDecodeError"}, "teardown": {"duration": 0.0006825500167906284, "outcome": "passed"}}, {"nodeid": "tests/api/test_config_endpoints.py::test_health_has_startup_time", "lineno": 326, "outcome": "failed", "keywords": ["test_health_has_startup_time", "test_config_endpoints.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005213238764554262, "outcome": "passed"}, "call": {"duration": 0.002843203954398632, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)"}, "traceback": [{"path": "tests/api/test_config_endpoints.py", "lineno": 333, "message": ""}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 832, "message": "in json"}, {"path": "../../anaconda3/lib/python3.9/json/__init__.py", "lineno": 346, "message": "in loads"}, {"path": "../../anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "JSONDecodeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b129c6a0>\n\n    async def test_health_has_startup_time(rest):\n        \"\"\"Health endpoint has startup_us and startup_ms.\"\"\"\n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/health\",\n            headers=rest._headers(),\n        )\n>       data = resp.json()\n\ntests/api/test_config_endpoints.py:333: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:832: in json\n    return jsonlib.loads(self.content, **kwargs)\n../../anaconda3/lib/python3.9/json/__init__.py:346: in loads\n    return _default_decoder.decode(s)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <json.decoder.JSONDecoder object at 0x7f47b2e5fe50>, s = '404: Not Found'\n_w = <built-in method match of re.Pattern object at 0x7f47b3015cf0>\n\n    def decode(self, s, _w=WHITESPACE.match):\n        \"\"\"Return the Python representation of ``s`` (a ``str`` instance\n        containing a JSON document).\n    \n        \"\"\"\n        obj, end = self.raw_decode(s, idx=_w(s, 0).end())\n        end = _w(s, end).end()\n        if end != len(s):\n>           raise JSONDecodeError(\"Extra data\", s, end)\nE           json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)\n\n../../anaconda3/lib/python3.9/json/decoder.py:340: JSONDecodeError"}, "teardown": {"duration": 0.0006654411554336548, "outcome": "passed"}}, {"nodeid": "tests/api/test_config_endpoints.py::test_health_has_counters", "lineno": 338, "outcome": "failed", "keywords": ["test_health_has_counters", "test_config_endpoints.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005265640094876289, "outcome": "passed"}, "call": {"duration": 0.0028303959406912327, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)"}, "traceback": [{"path": "tests/api/test_config_endpoints.py", "lineno": 345, "message": ""}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 832, "message": "in json"}, {"path": "../../anaconda3/lib/python3.9/json/__init__.py", "lineno": 346, "message": "in loads"}, {"path": "../../anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "JSONDecodeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b061dd00>\n\n    async def test_health_has_counters(rest):\n        \"\"\"Health endpoint has state_changes and events_fired.\"\"\"\n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/health\",\n            headers=rest._headers(),\n        )\n>       data = resp.json()\n\ntests/api/test_config_endpoints.py:345: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:832: in json\n    return jsonlib.loads(self.content, **kwargs)\n../../anaconda3/lib/python3.9/json/__init__.py:346: in loads\n    return _default_decoder.decode(s)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <json.decoder.JSONDecoder object at 0x7f47b2e5fe50>, s = '404: Not Found'\n_w = <built-in method match of re.Pattern object at 0x7f47b3015cf0>\n\n    def decode(self, s, _w=WHITESPACE.match):\n        \"\"\"Return the Python representation of ``s`` (a ``str`` instance\n        containing a JSON document).\n    \n        \"\"\"\n        obj, end = self.raw_decode(s, idx=_w(s, 0).end())\n        end = _w(s, end).end()\n        if end != len(s):\n>           raise JSONDecodeError(\"Extra data\", s, end)\nE           json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)\n\n../../anaconda3/lib/python3.9/json/decoder.py:340: JSONDecodeError"}, "teardown": {"duration": 0.000725853256881237, "outcome": "passed"}}, {"nodeid": "tests/api/test_config_endpoints.py::test_health_has_sim_fields", "lineno": 349, "outcome": "failed", "keywords": ["test_health_has_sim_fields", "test_config_endpoints.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.0052033900283277035, "outcome": "passed"}, "call": {"duration": 0.003668692894279957, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)"}, "traceback": [{"path": "tests/api/test_config_endpoints.py", "lineno": 363, "message": ""}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 832, "message": "in json"}, {"path": "../../anaconda3/lib/python3.9/json/__init__.py", "lineno": 346, "message": "in loads"}, {"path": "../../anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "JSONDecodeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b061deb0>\n\n    async def test_health_has_sim_fields(rest):\n        \"\"\"Health endpoint has sim_time/sim_chapter/sim_speed after sim/time call.\"\"\"\n        # Set sim time first\n        await rest.client.post(\n            f\"{rest.base_url}/api/sim/time\",\n            json={\"time\": \"12:00:00\", \"chapter\": \"noon\", \"speed\": 5},\n            headers=rest._headers(),\n        )\n    \n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/health\",\n            headers=rest._headers(),\n        )\n>       data = resp.json()\n\ntests/api/test_config_endpoints.py:363: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:832: in json\n    return jsonlib.loads(self.content, **kwargs)\n../../anaconda3/lib/python3.9/json/__init__.py:346: in loads\n    return _default_decoder.decode(s)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <json.decoder.JSONDecoder object at 0x7f47b2e5fe50>, s = '404: Not Found'\n_w = <built-in method match of re.Pattern object at 0x7f47b3015cf0>\n\n    def decode(self, s, _w=WHITESPACE.match):\n        \"\"\"Return the Python representation of ``s`` (a ``str`` instance\n        containing a JSON document).\n    \n        \"\"\"\n        obj, end = self.raw_decode(s, idx=_w(s, 0).end())\n        end = _w(s, end).end()\n        if end != len(s):\n>           raise JSONDecodeError(\"Extra data\", s, end)\nE           json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)\n\n../../anaconda3/lib/python3.9/json/decoder.py:340: JSONDecodeError"}, "teardown": {"duration": 0.0006474079564213753, "outcome": "passed"}}, {"nodeid": "tests/api/test_config_endpoints.py::test_ws_config_matches_rest", "lineno": 368, "outcome": "passed", "keywords": ["test_ws_config_matches_rest", "test_config_endpoints.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.0169851528480649, "outcome": "passed"}, "call": {"duration": 0.00296461908146739, "outcome": "passed"}, "teardown": {"duration": 0.0008653788827359676, "outcome": "passed"}}, {"nodeid": "tests/api/test_config_endpoints.py::test_health_startup_under_5ms", "lineno": 386, "outcome": "failed", "keywords": ["test_health_startup_under_5ms", "test_config_endpoints.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005580462049692869, "outcome": "passed"}, "call": {"duration": 0.003057279158383608, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)"}, "traceback": [{"path": "tests/api/test_config_endpoints.py", "lineno": 393, "message": ""}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 832, "message": "in json"}, {"path": "../../anaconda3/lib/python3.9/json/__init__.py", "lineno": 346, "message": "in loads"}, {"path": "../../anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "JSONDecodeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b099d4f0>\n\n    async def test_health_startup_under_5ms(rest):\n        \"\"\"Marge starts up in under 5ms.\"\"\"\n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/health\",\n            headers=rest._headers(),\n        )\n>       data = resp.json()\n\ntests/api/test_config_endpoints.py:393: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:832: in json\n    return jsonlib.loads(self.content, **kwargs)\n../../anaconda3/lib/python3.9/json/__init__.py:346: in loads\n    return _default_decoder.decode(s)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <json.decoder.JSONDecoder object at 0x7f47b2e5fe50>, s = '404: Not Found'\n_w = <built-in method match of re.Pattern object at 0x7f47b3015cf0>\n\n    def decode(self, s, _w=WHITESPACE.match):\n        \"\"\"Return the Python representation of ``s`` (a ``str`` instance\n        containing a JSON document).\n    \n        \"\"\"\n        obj, end = self.raw_decode(s, idx=_w(s, 0).end())\n        end = _w(s, end).end()\n        if end != len(s):\n>           raise JSONDecodeError(\"Extra data\", s, end)\nE           json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)\n\n../../anaconda3/lib/python3.9/json/decoder.py:340: JSONDecodeError"}, "teardown": {"duration": 0.0007248502224683762, "outcome": "passed"}}, {"nodeid": "tests/api/test_config_yaml.py::test_list_automations_returns_list", "lineno": 16, "outcome": "failed", "keywords": ["test_list_automations_returns_list", "test_config_yaml.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.00562324607744813, "outcome": "passed"}, "call": {"duration": 0.0033917739056050777, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_config_yaml.py", "lineno": 23, "message": "assert 404 == 200\n +  where 404 = <Response [404 Not Found]>.status_code"}, "traceback": [{"path": "tests/api/test_config_yaml.py", "lineno": 23, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b08c4490>\n\n    async def test_list_automations_returns_list(rest):\n        \"\"\"GET /api/config/automation/config returns a list.\"\"\"\n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/config/automation/config\",\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 404 == 200\nE        +  where 404 = <Response [404 Not Found]>.status_code\n\ntests/api/test_config_yaml.py:23: AssertionError"}, "teardown": {"duration": 0.0007082209922373295, "outcome": "passed"}}, {"nodeid": "tests/api/test_config_yaml.py::test_list_automations_has_id", "lineno": 28, "outcome": "failed", "keywords": ["test_list_automations_has_id", "test_config_yaml.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.0057656122371554375, "outcome": "passed"}, "call": {"duration": 0.002716776914894581, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)"}, "traceback": [{"path": "tests/api/test_config_yaml.py", "lineno": 35, "message": ""}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 832, "message": "in json"}, {"path": "../../anaconda3/lib/python3.9/json/__init__.py", "lineno": 346, "message": "in loads"}, {"path": "../../anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "JSONDecodeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0684130>\n\n    async def test_list_automations_has_id(rest):\n        \"\"\"Each automation entry has an id field.\"\"\"\n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/config/automation/config\",\n            headers=rest._headers(),\n        )\n>       data = resp.json()\n\ntests/api/test_config_yaml.py:35: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:832: in json\n    return jsonlib.loads(self.content, **kwargs)\n../../anaconda3/lib/python3.9/json/__init__.py:346: in loads\n    return _default_decoder.decode(s)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <json.decoder.JSONDecoder object at 0x7f47b2e5fe50>, s = '404: Not Found'\n_w = <built-in method match of re.Pattern object at 0x7f47b3015cf0>\n\n    def decode(self, s, _w=WHITESPACE.match):\n        \"\"\"Return the Python representation of ``s`` (a ``str`` instance\n        containing a JSON document).\n    \n        \"\"\"\n        obj, end = self.raw_decode(s, idx=_w(s, 0).end())\n        end = _w(s, end).end()\n        if end != len(s):\n>           raise JSONDecodeError(\"Extra data\", s, end)\nE           json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)\n\n../../anaconda3/lib/python3.9/json/decoder.py:340: JSONDecodeError"}, "teardown": {"duration": 0.0006185867823660374, "outcome": "passed"}}, {"nodeid": "tests/api/test_config_yaml.py::test_list_automations_has_alias", "lineno": 39, "outcome": "failed", "keywords": ["test_list_automations_has_alias", "test_config_yaml.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005752672906965017, "outcome": "passed"}, "call": {"duration": 0.002947908826172352, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)"}, "traceback": [{"path": "tests/api/test_config_yaml.py", "lineno": 46, "message": ""}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 832, "message": "in json"}, {"path": "../../anaconda3/lib/python3.9/json/__init__.py", "lineno": 346, "message": "in loads"}, {"path": "../../anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "JSONDecodeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b096eee0>\n\n    async def test_list_automations_has_alias(rest):\n        \"\"\"Each automation entry has an alias field.\"\"\"\n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/config/automation/config\",\n            headers=rest._headers(),\n        )\n>       data = resp.json()\n\ntests/api/test_config_yaml.py:46: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:832: in json\n    return jsonlib.loads(self.content, **kwargs)\n../../anaconda3/lib/python3.9/json/__init__.py:346: in loads\n    return _default_decoder.decode(s)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <json.decoder.JSONDecoder object at 0x7f47b2e5fe50>, s = '404: Not Found'\n_w = <built-in method match of re.Pattern object at 0x7f47b3015cf0>\n\n    def decode(self, s, _w=WHITESPACE.match):\n        \"\"\"Return the Python representation of ``s`` (a ``str`` instance\n        containing a JSON document).\n    \n        \"\"\"\n        obj, end = self.raw_decode(s, idx=_w(s, 0).end())\n        end = _w(s, end).end()\n        if end != len(s):\n>           raise JSONDecodeError(\"Extra data\", s, end)\nE           json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)\n\n../../anaconda3/lib/python3.9/json/decoder.py:340: JSONDecodeError"}, "teardown": {"duration": 0.0006523663178086281, "outcome": "passed"}}, {"nodeid": "tests/api/test_config_yaml.py::test_list_automations_has_counts", "lineno": 50, "outcome": "failed", "keywords": ["test_list_automations_has_counts", "test_config_yaml.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.00523106474429369, "outcome": "passed"}, "call": {"duration": 0.0032895617187023163, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)"}, "traceback": [{"path": "tests/api/test_config_yaml.py", "lineno": 57, "message": ""}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 832, "message": "in json"}, {"path": "../../anaconda3/lib/python3.9/json/__init__.py", "lineno": 346, "message": "in loads"}, {"path": "../../anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "JSONDecodeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b096ebb0>\n\n    async def test_list_automations_has_counts(rest):\n        \"\"\"Each automation entry has trigger/condition/action counts.\"\"\"\n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/config/automation/config\",\n            headers=rest._headers(),\n        )\n>       data = resp.json()\n\ntests/api/test_config_yaml.py:57: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:832: in json\n    return jsonlib.loads(self.content, **kwargs)\n../../anaconda3/lib/python3.9/json/__init__.py:346: in loads\n    return _default_decoder.decode(s)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <json.decoder.JSONDecoder object at 0x7f47b2e5fe50>, s = '404: Not Found'\n_w = <built-in method match of re.Pattern object at 0x7f47b3015cf0>\n\n    def decode(self, s, _w=WHITESPACE.match):\n        \"\"\"Return the Python representation of ``s`` (a ``str`` instance\n        containing a JSON document).\n    \n        \"\"\"\n        obj, end = self.raw_decode(s, idx=_w(s, 0).end())\n        end = _w(s, end).end()\n        if end != len(s):\n>           raise JSONDecodeError(\"Extra data\", s, end)\nE           json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)\n\n../../anaconda3/lib/python3.9/json/decoder.py:340: JSONDecodeError"}, "teardown": {"duration": 0.0008723842911422253, "outcome": "passed"}}, {"nodeid": "tests/api/test_config_yaml.py::test_reload_automations", "lineno": 66, "outcome": "failed", "keywords": ["test_reload_automations", "test_config_yaml.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.00577773479744792, "outcome": "passed"}, "call": {"duration": 0.004206956829875708, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_config_yaml.py", "lineno": 74, "message": "assert 404 == 200\n +  where 404 = <Response [404 Not Found]>.status_code"}, "traceback": [{"path": "tests/api/test_config_yaml.py", "lineno": 74, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b096e940>\n\n    async def test_reload_automations(rest):\n        \"\"\"POST /api/config/core/reload reloads automations.\"\"\"\n        resp = await rest.client.post(\n            f\"{rest.base_url}/api/config/core/reload\",\n            json={},\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 404 == 200\nE        +  where 404 = <Response [404 Not Found]>.status_code\n\ntests/api/test_config_yaml.py:74: AssertionError"}, "teardown": {"duration": 0.0007663429714739323, "outcome": "passed"}}, {"nodeid": "tests/api/test_config_yaml.py::test_reload_preserves_entities", "lineno": 79, "outcome": "failed", "keywords": ["test_reload_preserves_entities", "test_config_yaml.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005148438736796379, "outcome": "passed"}, "call": {"duration": 0.004497651942074299, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_config_yaml.py", "lineno": 91, "message": "assert 404 == 200\n +  where 404 = <Response [404 Not Found]>.status_code"}, "traceback": [{"path": "tests/api/test_config_yaml.py", "lineno": 91, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0625a30>\n\n    async def test_reload_preserves_entities(rest):\n        \"\"\"Reload does not remove automation entities.\"\"\"\n        # Get automations before\n        states_before = await rest.get_states()\n        auto_before = [s for s in states_before if s[\"entity_id\"].startswith(\"automation.\")]\n    \n        resp = await rest.client.post(\n            f\"{rest.base_url}/api/config/core/reload\",\n            json={},\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 404 == 200\nE        +  where 404 = <Response [404 Not Found]>.status_code\n\ntests/api/test_config_yaml.py:91: AssertionError"}, "teardown": {"duration": 0.0008752867579460144, "outcome": "passed"}}, {"nodeid": "tests/api/test_config_yaml.py::test_check_config_valid", "lineno": 101, "outcome": "passed", "keywords": ["test_check_config_valid", "test_config_yaml.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005221394822001457, "outcome": "passed"}, "call": {"duration": 0.009021813049912453, "outcome": "passed"}, "teardown": {"duration": 0.0005969610065221786, "outcome": "passed"}}, {"nodeid": "tests/api/test_config_yaml.py::test_error_log_endpoint", "lineno": 116, "outcome": "passed", "keywords": ["test_error_log_endpoint", "test_config_yaml.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005227574147284031, "outcome": "passed"}, "call": {"duration": 0.004241465125232935, "outcome": "passed"}, "teardown": {"duration": 0.00048525910824537277, "outcome": "passed"}}, {"nodeid": "tests/api/test_config_yaml.py::test_config_has_version", "lineno": 128, "outcome": "passed", "keywords": ["test_config_has_version", "test_config_yaml.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005347738973796368, "outcome": "passed"}, "call": {"duration": 0.005258780904114246, "outcome": "passed"}, "teardown": {"duration": 0.0005708481185138226, "outcome": "passed"}}, {"nodeid": "tests/api/test_config_yaml.py::test_config_has_location_name", "lineno": 135, "outcome": "passed", "keywords": ["test_config_has_location_name", "test_config_yaml.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005073512904345989, "outcome": "passed"}, "call": {"duration": 0.002370636910200119, "outcome": "passed"}, "teardown": {"duration": 0.000452553853392601, "outcome": "passed"}}, {"nodeid": "tests/api/test_config_yaml.py::test_config_has_elevation", "lineno": 142, "outcome": "passed", "keywords": ["test_config_has_elevation", "test_config_yaml.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005628103855997324, "outcome": "passed"}, "call": {"duration": 0.0032156440429389477, "outcome": "passed"}, "teardown": {"duration": 0.00047885486856102943, "outcome": "passed"}}, {"nodeid": "tests/api/test_config_yaml.py::test_automation_config_returns_list", "lineno": 151, "outcome": "failed", "keywords": ["test_automation_config_returns_list", "test_config_yaml.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.0049346922896802425, "outcome": "passed"}, "call": {"duration": 0.004978837911039591, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_config_yaml.py", "lineno": 158, "message": "assert 404 == 200\n +  where 404 = <Response [404 Not Found]>.status_code"}, "traceback": [{"path": "tests/api/test_config_yaml.py", "lineno": 158, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b07eea90>\n\n    async def test_automation_config_returns_list(rest):\n        \"\"\"GET /api/config/automation/config returns a list of automations.\"\"\"\n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/config/automation/config\",\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 404 == 200\nE        +  where 404 = <Response [404 Not Found]>.status_code\n\ntests/api/test_config_yaml.py:158: AssertionError"}, "teardown": {"duration": 0.0005622981116175652, "outcome": "passed"}}, {"nodeid": "tests/api/test_config_yaml.py::test_automation_config_has_metadata", "lineno": 172, "outcome": "failed", "keywords": ["test_automation_config_has_metadata", "test_config_yaml.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.00507214292883873, "outcome": "passed"}, "call": {"duration": 0.0023744283244013786, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)"}, "traceback": [{"path": "tests/api/test_config_yaml.py", "lineno": 179, "message": ""}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 832, "message": "in json"}, {"path": "../../anaconda3/lib/python3.9/json/__init__.py", "lineno": 346, "message": "in loads"}, {"path": "../../anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "JSONDecodeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b08693a0>\n\n    async def test_automation_config_has_metadata(rest):\n        \"\"\"Automation config includes runtime metadata fields.\"\"\"\n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/config/automation/config\",\n            headers=rest._headers(),\n        )\n>       data = resp.json()\n\ntests/api/test_config_yaml.py:179: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:832: in json\n    return jsonlib.loads(self.content, **kwargs)\n../../anaconda3/lib/python3.9/json/__init__.py:346: in loads\n    return _default_decoder.decode(s)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <json.decoder.JSONDecoder object at 0x7f47b2e5fe50>, s = '404: Not Found'\n_w = <built-in method match of re.Pattern object at 0x7f47b3015cf0>\n\n    def decode(self, s, _w=WHITESPACE.match):\n        \"\"\"Return the Python representation of ``s`` (a ``str`` instance\n        containing a JSON document).\n    \n        \"\"\"\n        obj, end = self.raw_decode(s, idx=_w(s, 0).end())\n        end = _w(s, end).end()\n        if end != len(s):\n>           raise JSONDecodeError(\"Extra data\", s, end)\nE           json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)\n\n../../anaconda3/lib/python3.9/json/decoder.py:340: JSONDecodeError"}, "teardown": {"duration": 0.0006844340823590755, "outcome": "passed"}}, {"nodeid": "tests/api/test_config_yaml.py::test_automation_entity_has_friendly_name", "lineno": 188, "outcome": "failed", "keywords": ["test_automation_entity_has_friendly_name", "test_config_yaml.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005271452944725752, "outcome": "passed"}, "call": {"duration": 0.0026190453208982944, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)"}, "traceback": [{"path": "tests/api/test_config_yaml.py", "lineno": 195, "message": ""}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 832, "message": "in json"}, {"path": "../../anaconda3/lib/python3.9/json/__init__.py", "lineno": 346, "message": "in loads"}, {"path": "../../anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "JSONDecodeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0869b50>\n\n    async def test_automation_entity_has_friendly_name(rest):\n        \"\"\"Automation entities have friendly_name attribute set from alias.\"\"\"\n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/config/automation/config\",\n            headers=rest._headers(),\n        )\n>       automations = resp.json()\n\ntests/api/test_config_yaml.py:195: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:832: in json\n    return jsonlib.loads(self.content, **kwargs)\n../../anaconda3/lib/python3.9/json/__init__.py:346: in loads\n    return _default_decoder.decode(s)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <json.decoder.JSONDecoder object at 0x7f47b2e5fe50>, s = '404: Not Found'\n_w = <built-in method match of re.Pattern object at 0x7f47b3015cf0>\n\n    def decode(self, s, _w=WHITESPACE.match):\n        \"\"\"Return the Python representation of ``s`` (a ``str`` instance\n        containing a JSON document).\n    \n        \"\"\"\n        obj, end = self.raw_decode(s, idx=_w(s, 0).end())\n        end = _w(s, end).end()\n        if end != len(s):\n>           raise JSONDecodeError(\"Extra data\", s, end)\nE           json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)\n\n../../anaconda3/lib/python3.9/json/decoder.py:340: JSONDecodeError"}, "teardown": {"duration": 0.0006940430030226707, "outcome": "passed"}}, {"nodeid": "tests/api/test_config_yaml.py::test_automation_trigger_updates_metadata", "lineno": 207, "outcome": "failed", "keywords": ["test_automation_trigger_updates_metadata", "test_config_yaml.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005246520973742008, "outcome": "passed"}, "call": {"duration": 0.0026477398350834846, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)"}, "traceback": [{"path": "tests/api/test_config_yaml.py", "lineno": 214, "message": ""}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 832, "message": "in json"}, {"path": "../../anaconda3/lib/python3.9/json/__init__.py", "lineno": 346, "message": "in loads"}, {"path": "../../anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "JSONDecodeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b08694f0>\n\n    async def test_automation_trigger_updates_metadata(rest):\n        \"\"\"Triggering an automation updates last_triggered and current count.\"\"\"\n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/config/automation/config\",\n            headers=rest._headers(),\n        )\n>       automations = resp.json()\n\ntests/api/test_config_yaml.py:214: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:832: in json\n    return jsonlib.loads(self.content, **kwargs)\n../../anaconda3/lib/python3.9/json/__init__.py:346: in loads\n    return _default_decoder.decode(s)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <json.decoder.JSONDecoder object at 0x7f47b2e5fe50>, s = '404: Not Found'\n_w = <built-in method match of re.Pattern object at 0x7f47b3015cf0>\n\n    def decode(self, s, _w=WHITESPACE.match):\n        \"\"\"Return the Python representation of ``s`` (a ``str`` instance\n        containing a JSON document).\n    \n        \"\"\"\n        obj, end = self.raw_decode(s, idx=_w(s, 0).end())\n        end = _w(s, end).end()\n        if end != len(s):\n>           raise JSONDecodeError(\"Extra data\", s, end)\nE           json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)\n\n../../anaconda3/lib/python3.9/json/decoder.py:340: JSONDecodeError"}, "teardown": {"duration": 0.0007483982481062412, "outcome": "passed"}}, {"nodeid": "tests/api/test_config_yaml.py::test_automation_trigger_via_service", "lineno": 235, "outcome": "failed", "keywords": ["test_automation_trigger_via_service", "test_config_yaml.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005192445125430822, "outcome": "passed"}, "call": {"duration": 0.002611725125461817, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)"}, "traceback": [{"path": "tests/api/test_config_yaml.py", "lineno": 243, "message": ""}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 832, "message": "in json"}, {"path": "../../anaconda3/lib/python3.9/json/__init__.py", "lineno": 346, "message": "in loads"}, {"path": "../../anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "JSONDecodeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b06b4c70>\n\n    async def test_automation_trigger_via_service(rest):\n        \"\"\"POST /api/services/automation/trigger fires an automation.\"\"\"\n        # Get first automation ID\n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/config/automation/config\",\n            headers=rest._headers(),\n        )\n>       autos = resp.json()\n\ntests/api/test_config_yaml.py:243: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:832: in json\n    return jsonlib.loads(self.content, **kwargs)\n../../anaconda3/lib/python3.9/json/__init__.py:346: in loads\n    return _default_decoder.decode(s)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <json.decoder.JSONDecoder object at 0x7f47b2e5fe50>, s = '404: Not Found'\n_w = <built-in method match of re.Pattern object at 0x7f47b3015cf0>\n\n    def decode(self, s, _w=WHITESPACE.match):\n        \"\"\"Return the Python representation of ``s`` (a ``str`` instance\n        containing a JSON document).\n    \n        \"\"\"\n        obj, end = self.raw_decode(s, idx=_w(s, 0).end())\n        end = _w(s, end).end()\n        if end != len(s):\n>           raise JSONDecodeError(\"Extra data\", s, end)\nE           json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)\n\n../../anaconda3/lib/python3.9/json/decoder.py:340: JSONDecodeError"}, "teardown": {"duration": 0.0006534098647534847, "outcome": "passed"}}, {"nodeid": "tests/api/test_device_registry_rest.py::test_create_device", "lineno": 13, "outcome": "failed", "keywords": ["test_create_device", "test_device_registry_rest.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.00512232119217515, "outcome": "passed"}, "call": {"duration": 0.0026509789749979973, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_device_registry_rest.py", "lineno": 27, "message": "assert 404 == 200\n +  where 404 = <Response [404 Not Found]>.status_code"}, "traceback": [{"path": "tests/api/test_device_registry_rest.py", "lineno": 27, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b09e6f70>\n\n    async def test_create_device(rest):\n        \"\"\"POST /api/devices creates a device.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        resp = await rest.client.post(\n            f\"{rest.base_url}/api/devices\",\n            json={\n                \"device_id\": f\"dev_{tag}\",\n                \"name\": f\"Test Device {tag}\",\n                \"manufacturer\": \"Acme\",\n                \"model\": \"Widget-1000\",\n            },\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 404 == 200\nE        +  where 404 = <Response [404 Not Found]>.status_code\n\ntests/api/test_device_registry_rest.py:27: AssertionError"}, "teardown": {"duration": 0.0005676243454217911, "outcome": "passed"}}, {"nodeid": "tests/api/test_device_registry_rest.py::test_list_devices", "lineno": 30, "outcome": "failed", "keywords": ["test_list_devices", "test_device_registry_rest.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.00510886125266552, "outcome": "passed"}, "call": {"duration": 0.004907533992081881, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_device_registry_rest.py", "lineno": 44, "message": "assert 404 == 200\n +  where 404 = <Response [404 Not Found]>.status_code"}, "traceback": [{"path": "tests/api/test_device_registry_rest.py", "lineno": 44, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b09e6910>\n\n    async def test_list_devices(rest):\n        \"\"\"GET /api/devices returns device list.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        await rest.client.post(\n            f\"{rest.base_url}/api/devices\",\n            json={\"device_id\": f\"dev_list_{tag}\", \"name\": f\"List Device {tag}\"},\n            headers=rest._headers(),\n        )\n    \n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/devices\",\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 404 == 200\nE        +  where 404 = <Response [404 Not Found]>.status_code\n\ntests/api/test_device_registry_rest.py:44: AssertionError"}, "teardown": {"duration": 0.0007105870172381401, "outcome": "passed"}}, {"nodeid": "tests/api/test_device_registry_rest.py::test_device_has_fields", "lineno": 50, "outcome": "failed", "keywords": ["test_device_has_fields", "test_device_registry_rest.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005270808935165405, "outcome": "passed"}, "call": {"duration": 0.0037326430901885033, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)"}, "traceback": [{"path": "tests/api/test_device_registry_rest.py", "lineno": 70, "message": ""}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 832, "message": "in json"}, {"path": "../../anaconda3/lib/python3.9/json/__init__.py", "lineno": 346, "message": "in loads"}, {"path": "../../anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "JSONDecodeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0720ac0>\n\n    async def test_device_has_fields(rest):\n        \"\"\"Device entries have expected fields.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        await rest.client.post(\n            f\"{rest.base_url}/api/devices\",\n            json={\n                \"device_id\": f\"dev_fields_{tag}\",\n                \"name\": \"Fields Device\",\n                \"manufacturer\": \"TestCo\",\n                \"model\": \"Model-X\",\n                \"area_id\": \"\",\n            },\n            headers=rest._headers(),\n        )\n    \n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/devices\",\n            headers=rest._headers(),\n        )\n>       devices = resp.json()\n\ntests/api/test_device_registry_rest.py:70: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:832: in json\n    return jsonlib.loads(self.content, **kwargs)\n../../anaconda3/lib/python3.9/json/__init__.py:346: in loads\n    return _default_decoder.decode(s)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <json.decoder.JSONDecoder object at 0x7f47b2e5fe50>, s = '404: Not Found'\n_w = <built-in method match of re.Pattern object at 0x7f47b3015cf0>\n\n    def decode(self, s, _w=WHITESPACE.match):\n        \"\"\"Return the Python representation of ``s`` (a ``str`` instance\n        containing a JSON document).\n    \n        \"\"\"\n        obj, end = self.raw_decode(s, idx=_w(s, 0).end())\n        end = _w(s, end).end()\n        if end != len(s):\n>           raise JSONDecodeError(\"Extra data\", s, end)\nE           json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)\n\n../../anaconda3/lib/python3.9/json/decoder.py:340: JSONDecodeError"}, "teardown": {"duration": 0.0006791478954255581, "outcome": "passed"}}, {"nodeid": "tests/api/test_device_registry_rest.py::test_delete_device", "lineno": 80, "outcome": "failed", "keywords": ["test_delete_device", "test_device_registry_rest.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005043136887252331, "outcome": "passed"}, "call": {"duration": 0.0039199902676045895, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_device_registry_rest.py", "lineno": 95, "message": "assert 404 == 200\n +  where 404 = <Response [404 Not Found]>.status_code"}, "traceback": [{"path": "tests/api/test_device_registry_rest.py", "lineno": 95, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b097d0a0>\n\n    async def test_delete_device(rest):\n        \"\"\"DELETE /api/devices/{id} removes a device.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        did = f\"dev_del_{tag}\"\n        await rest.client.post(\n            f\"{rest.base_url}/api/devices\",\n            json={\"device_id\": did, \"name\": \"Delete Me\"},\n            headers=rest._headers(),\n        )\n    \n        resp = await rest.client.delete(\n            f\"{rest.base_url}/api/devices/{did}\",\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 404 == 200\nE        +  where 404 = <Response [404 Not Found]>.status_code\n\ntests/api/test_device_registry_rest.py:95: AssertionError"}, "teardown": {"duration": 0.0005902131088078022, "outcome": "passed"}}, {"nodeid": "tests/api/test_device_registry_rest.py::test_assign_entity_to_device", "lineno": 104, "outcome": "failed", "keywords": ["test_assign_entity_to_device", "test_device_registry_rest.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005037310998886824, "outcome": "passed"}, "call": {"duration": 0.005250779911875725, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_device_registry_rest.py", "lineno": 123, "message": "assert 404 == 200\n +  where 404 = <Response [404 Not Found]>.status_code"}, "traceback": [{"path": "tests/api/test_device_registry_rest.py", "lineno": 123, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b080c820>\n\n    async def test_assign_entity_to_device(rest):\n        \"\"\"POST /api/devices/{did}/entities/{eid} assigns entity.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        did = f\"dev_assign_{tag}\"\n        eid = f\"sensor.dev_ent_{tag}\"\n    \n        await rest.client.post(\n            f\"{rest.base_url}/api/devices\",\n            json={\"device_id\": did, \"name\": \"Assign Device\"},\n            headers=rest._headers(),\n        )\n        await rest.set_state(eid, \"on\")\n    \n        resp = await rest.client.post(\n            f\"{rest.base_url}/api/devices/{did}/entities/{eid}\",\n            json={},\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 404 == 200\nE        +  where 404 = <Response [404 Not Found]>.status_code\n\ntests/api/test_device_registry_rest.py:123: AssertionError"}, "teardown": {"duration": 0.0006097881123423576, "outcome": "passed"}}, {"nodeid": "tests/api/test_device_registry_rest.py::test_device_upsert_updates_fields", "lineno": 136, "outcome": "failed", "keywords": ["test_device_upsert_updates_fields", "test_device_registry_rest.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.00524500198662281, "outcome": "passed"}, "call": {"duration": 0.005680511239916086, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)"}, "traceback": [{"path": "tests/api/test_device_registry_rest.py", "lineno": 158, "message": ""}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 832, "message": "in json"}, {"path": "../../anaconda3/lib/python3.9/json/__init__.py", "lineno": 346, "message": "in loads"}, {"path": "../../anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "JSONDecodeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b1329940>\n\n    async def test_device_upsert_updates_fields(rest):\n        \"\"\"POST /api/devices with same ID updates fields.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        did = f\"dev_upsert_{tag}\"\n    \n        await rest.client.post(\n            f\"{rest.base_url}/api/devices\",\n            json={\"device_id\": did, \"name\": \"Original\"},\n            headers=rest._headers(),\n        )\n    \n        await rest.client.post(\n            f\"{rest.base_url}/api/devices\",\n            json={\"device_id\": did, \"name\": \"Updated\", \"manufacturer\": \"NewCo\"},\n            headers=rest._headers(),\n        )\n    \n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/devices\",\n            headers=rest._headers(),\n        )\n>       found = [d for d in resp.json() if d[\"device_id\"] == did]\n\ntests/api/test_device_registry_rest.py:158: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:832: in json\n    return jsonlib.loads(self.content, **kwargs)\n../../anaconda3/lib/python3.9/json/__init__.py:346: in loads\n    return _default_decoder.decode(s)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <json.decoder.JSONDecoder object at 0x7f47b2e5fe50>, s = '404: Not Found'\n_w = <built-in method match of re.Pattern object at 0x7f47b3015cf0>\n\n    def decode(self, s, _w=WHITESPACE.match):\n        \"\"\"Return the Python representation of ``s`` (a ``str`` instance\n        containing a JSON document).\n    \n        \"\"\"\n        obj, end = self.raw_decode(s, idx=_w(s, 0).end())\n        end = _w(s, end).end()\n        if end != len(s):\n>           raise JSONDecodeError(\"Extra data\", s, end)\nE           json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)\n\n../../anaconda3/lib/python3.9/json/decoder.py:340: JSONDecodeError"}, "teardown": {"duration": 0.0006812559440732002, "outcome": "passed"}}, {"nodeid": "tests/api/test_device_registry_rest.py::test_device_missing_name_400", "lineno": 162, "outcome": "failed", "keywords": ["test_device_missing_name_400", "test_device_registry_rest.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005502657033503056, "outcome": "passed"}, "call": {"duration": 0.002927939873188734, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_device_registry_rest.py", "lineno": 171, "message": "assert 404 == 400\n +  where 404 = <Response [404 Not Found]>.status_code"}, "traceback": [{"path": "tests/api/test_device_registry_rest.py", "lineno": 171, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0a8a970>\n\n    async def test_device_missing_name_400(rest):\n        \"\"\"POST /api/devices without name returns 400.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        resp = await rest.client.post(\n            f\"{rest.base_url}/api/devices\",\n            json={\"device_id\": f\"dev_noname_{tag}\"},\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 400\nE       assert 404 == 400\nE        +  where 404 = <Response [404 Not Found]>.status_code\n\ntests/api/test_device_registry_rest.py:171: AssertionError"}, "teardown": {"duration": 0.0007773307152092457, "outcome": "passed"}}, {"nodeid": "tests/api/test_device_registry_rest.py::test_device_missing_id_400", "lineno": 173, "outcome": "failed", "keywords": ["test_device_missing_id_400", "test_device_registry_rest.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.0051666442304849625, "outcome": "passed"}, "call": {"duration": 0.002818852197378874, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_device_registry_rest.py", "lineno": 181, "message": "assert 404 == 400\n +  where 404 = <Response [404 Not Found]>.status_code"}, "traceback": [{"path": "tests/api/test_device_registry_rest.py", "lineno": 181, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b07caf70>\n\n    async def test_device_missing_id_400(rest):\n        \"\"\"POST /api/devices without device_id returns 400.\"\"\"\n        resp = await rest.client.post(\n            f\"{rest.base_url}/api/devices\",\n            json={\"name\": \"No ID Device\"},\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 400\nE       assert 404 == 400\nE        +  where 404 = <Response [404 Not Found]>.status_code\n\ntests/api/test_device_registry_rest.py:181: AssertionError"}, "teardown": {"duration": 0.0006924718618392944, "outcome": "passed"}}, {"nodeid": "tests/api/test_device_registry_rest.py::test_device_with_area", "lineno": 183, "outcome": "failed", "keywords": ["test_device_with_area", "test_device_registry_rest.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005115261301398277, "outcome": "passed"}, "call": {"duration": 0.0048918044194579124, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)"}, "traceback": [{"path": "tests/api/test_device_registry_rest.py", "lineno": 206, "message": ""}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 832, "message": "in json"}, {"path": "../../anaconda3/lib/python3.9/json/__init__.py", "lineno": 346, "message": "in loads"}, {"path": "../../anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "JSONDecodeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b07ca9a0>\n\n    async def test_device_with_area(rest):\n        \"\"\"Device can be created with area_id.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        did = f\"dev_area_{tag}\"\n    \n        # Create area first\n        await rest.client.post(\n            f\"{rest.base_url}/api/areas\",\n            json={\"area_id\": f\"area_{tag}\", \"name\": f\"Room {tag}\"},\n            headers=rest._headers(),\n        )\n    \n        await rest.client.post(\n            f\"{rest.base_url}/api/devices\",\n            json={\"device_id\": did, \"name\": \"Area Device\", \"area_id\": f\"area_{tag}\"},\n            headers=rest._headers(),\n        )\n    \n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/devices\",\n            headers=rest._headers(),\n        )\n>       found = [d for d in resp.json() if d[\"device_id\"] == did]\n\ntests/api/test_device_registry_rest.py:206: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:832: in json\n    return jsonlib.loads(self.content, **kwargs)\n../../anaconda3/lib/python3.9/json/__init__.py:346: in loads\n    return _default_decoder.decode(s)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <json.decoder.JSONDecoder object at 0x7f47b2e5fe50>, s = '404: Not Found'\n_w = <built-in method match of re.Pattern object at 0x7f47b3015cf0>\n\n    def decode(self, s, _w=WHITESPACE.match):\n        \"\"\"Return the Python representation of ``s`` (a ``str`` instance\n        containing a JSON document).\n    \n        \"\"\"\n        obj, end = self.raw_decode(s, idx=_w(s, 0).end())\n        end = _w(s, end).end()\n        if end != len(s):\n>           raise JSONDecodeError(\"Extra data\", s, end)\nE           json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)\n\n../../anaconda3/lib/python3.9/json/decoder.py:340: JSONDecodeError"}, "teardown": {"duration": 0.000681878998875618, "outcome": "passed"}}, {"nodeid": "tests/api/test_discovery_advanced.py::test_discovery_duplicate_payload", "lineno": 43, "outcome": "passed", "keywords": ["test_discovery_duplicate_payload", "asyncio", "pytestmark", "test_discovery_advanced.py", "api", "tests", "marge", ""], "setup": {"duration": 0.0003960062749683857, "outcome": "passed"}, "call": {"duration": 3.013535221107304, "outcome": "passed"}, "teardown": {"duration": 0.0003796839155256748, "outcome": "passed"}}, {"nodeid": "tests/api/test_discovery_advanced.py::test_discovery_state_tracks_topic", "lineno": 62, "outcome": "passed", "keywords": ["test_discovery_state_tracks_topic", "asyncio", "pytestmark", "test_discovery_advanced.py", "api", "tests", "marge", ""], "setup": {"duration": 0.0005468851886689663, "outcome": "passed"}, "call": {"duration": 3.014759956859052, "outcome": "passed"}, "teardown": {"duration": 0.0003708736039698124, "outcome": "passed"}}, {"nodeid": "tests/api/test_discovery_advanced.py::test_discovery_state_multiple_updates", "lineno": 80, "outcome": "passed", "keywords": ["test_discovery_state_multiple_updates", "asyncio", "pytestmark", "test_discovery_advanced.py", "api", "tests", "marge", ""], "setup": {"duration": 0.0004122327081859112, "outcome": "passed"}, "call": {"duration": 5.444966399110854, "outcome": "passed"}, "teardown": {"duration": 0.000526264775544405, "outcome": "passed"}}, {"nodeid": "tests/api/test_discovery_advanced.py::test_discovery_json_state_payload", "lineno": 101, "outcome": "passed", "keywords": ["test_discovery_json_state_payload", "asyncio", "pytestmark", "test_discovery_advanced.py", "api", "tests", "marge", ""], "setup": {"duration": 0.0005779871717095375, "outcome": "passed"}, "call": {"duration": 3.0314311180263758, "outcome": "passed"}, "teardown": {"duration": 0.0004752012901008129, "outcome": "passed"}}, {"nodeid": "tests/api/test_discovery_advanced.py::test_discovery_multi_entity_device", "lineno": 126, "outcome": "passed", "keywords": ["test_discovery_multi_entity_device", "asyncio", "pytestmark", "test_discovery_advanced.py", "api", "tests", "marge", ""], "setup": {"duration": 0.0005469629541039467, "outcome": "passed"}, "call": {"duration": 3.8402080186642706, "outcome": "passed"}, "teardown": {"duration": 0.0006534750573337078, "outcome": "passed"}}, {"nodeid": "tests/api/test_discovery_advanced.py::test_discovery_number", "lineno": 159, "outcome": "passed", "keywords": ["test_discovery_number", "asyncio", "pytestmark", "test_discovery_advanced.py", "api", "tests", "marge", ""], "setup": {"duration": 0.000639607198536396, "outcome": "passed"}, "call": {"duration": 1.5157225742004812, "outcome": "passed"}, "teardown": {"duration": 0.0004710140638053417, "outcome": "passed"}}, {"nodeid": "tests/api/test_discovery_advanced.py::test_discovery_select", "lineno": 177, "outcome": "passed", "keywords": ["test_discovery_select", "asyncio", "pytestmark", "test_discovery_advanced.py", "api", "tests", "marge", ""], "setup": {"duration": 0.0005966797471046448, "outcome": "passed"}, "call": {"duration": 1.5191083359532058, "outcome": "passed"}, "teardown": {"duration": 0.0006414116360247135, "outcome": "passed"}}, {"nodeid": "tests/api/test_discovery_advanced.py::test_discovery_button", "lineno": 194, "outcome": "passed", "keywords": ["test_discovery_button", "asyncio", "pytestmark", "test_discovery_advanced.py", "api", "tests", "marge", ""], "setup": {"duration": 0.0007977881468832493, "outcome": "passed"}, "call": {"duration": 1.510426095686853, "outcome": "passed"}, "teardown": {"duration": 0.00035016704350709915, "outcome": "passed"}}, {"nodeid": "tests/api/test_discovery_advanced.py::test_discovery_fan", "lineno": 209, "outcome": "passed", "keywords": ["test_discovery_fan", "asyncio", "pytestmark", "test_discovery_advanced.py", "api", "tests", "marge", ""], "setup": {"duration": 0.0003805961459875107, "outcome": "passed"}, "call": {"duration": 1.5548952310346067, "outcome": "passed"}, "teardown": {"duration": 0.00047018006443977356, "outcome": "passed"}}, {"nodeid": "tests/api/test_discovery_advanced.py::test_discovery_siren", "lineno": 228, "outcome": "passed", "keywords": ["test_discovery_siren", "asyncio", "pytestmark", "test_discovery_advanced.py", "api", "tests", "marge", ""], "setup": {"duration": 0.0005364068783819675, "outcome": "passed"}, "call": {"duration": 1.5096995532512665, "outcome": "passed"}, "teardown": {"duration": 0.00037173787131905556, "outcome": "passed"}}, {"nodeid": "tests/api/test_discovery_advanced.py::test_discovery_valve", "lineno": 245, "outcome": "passed", "keywords": ["test_discovery_valve", "asyncio", "pytestmark", "test_discovery_advanced.py", "api", "tests", "marge", ""], "setup": {"duration": 0.0003888416104018688, "outcome": "passed"}, "call": {"duration": 1.5291119059547782, "outcome": "passed"}, "teardown": {"duration": 0.000487001147121191, "outcome": "passed"}}, {"nodeid": "tests/api/test_discovery_advanced.py::test_discovery_unit_of_measurement", "lineno": 264, "outcome": "passed", "keywords": ["test_discovery_unit_of_measurement", "asyncio", "pytestmark", "test_discovery_advanced.py", "api", "tests", "marge", ""], "setup": {"duration": 0.0006235879845917225, "outcome": "passed"}, "call": {"duration": 1.5105819017626345, "outcome": "passed"}, "teardown": {"duration": 0.0003469684161245823, "outcome": "passed"}}, {"nodeid": "tests/api/test_discovery_advanced.py::test_discovery_friendly_name_from_name", "lineno": 282, "outcome": "passed", "keywords": ["test_discovery_friendly_name_from_name", "asyncio", "pytestmark", "test_discovery_advanced.py", "api", "tests", "marge", ""], "setup": {"duration": 0.00043369922786951065, "outcome": "passed"}, "call": {"duration": 1.5263922661542892, "outcome": "passed"}, "teardown": {"duration": 0.0004718238487839699, "outcome": "passed"}}, {"nodeid": "tests/api/test_discovery_advanced.py::test_discovery_create_then_remove", "lineno": 300, "outcome": "passed", "keywords": ["test_discovery_create_then_remove", "asyncio", "pytestmark", "test_discovery_advanced.py", "api", "tests", "marge", ""], "setup": {"duration": 0.0005824449472129345, "outcome": "passed"}, "call": {"duration": 3.0292567368596792, "outcome": "passed"}, "teardown": {"duration": 0.00037670601159334183, "outcome": "passed"}}, {"nodeid": "tests/api/test_discovery_advanced.py::test_discovery_removal_idempotent", "lineno": 326, "outcome": "passed", "keywords": ["test_discovery_removal_idempotent", "asyncio", "pytestmark", "test_discovery_advanced.py", "api", "tests", "marge", ""], "setup": {"duration": 0.0004782639443874359, "outcome": "passed"}, "call": {"duration": 4.137173149269074, "outcome": "passed"}, "teardown": {"duration": 0.0004991418682038784, "outcome": "passed"}}, {"nodeid": "tests/api/test_discovery_advanced.py::test_discovery_recreate_after_removal", "lineno": 349, "outcome": "passed", "keywords": ["test_discovery_recreate_after_removal", "asyncio", "pytestmark", "test_discovery_advanced.py", "api", "tests", "marge", ""], "setup": {"duration": 0.0005719899199903011, "outcome": "passed"}, "call": {"duration": 4.535035667009652, "outcome": "passed"}, "teardown": {"duration": 0.0004145139828324318, "outcome": "passed"}}, {"nodeid": "tests/api/test_discovery_advanced.py::test_discovery_availability_status[online-False]", "lineno": 379, "outcome": "passed", "keywords": ["test_discovery_availability_status[online-False]", "parametrize", "asyncio", "pytestmark", "online-False", "test_discovery_advanced.py", "api", "tests", "marge", ""], "setup": {"duration": 0.0004988140426576138, "outcome": "passed"}, "call": {"duration": 4.119736067019403, "outcome": "passed"}, "teardown": {"duration": 0.00042750313878059387, "outcome": "passed"}}, {"nodeid": "tests/api/test_discovery_advanced.py::test_discovery_availability_status[offline-True]", "lineno": 379, "outcome": "passed", "keywords": ["test_discovery_availability_status[offline-True]", "parametrize", "asyncio", "pytestmark", "offline-True", "test_discovery_advanced.py", "api", "tests", "marge", ""], "setup": {"duration": 0.0005911267362535, "outcome": "passed"}, "call": {"duration": 4.121640930883586, "outcome": "passed"}, "teardown": {"duration": 0.0004784069024026394, "outcome": "passed"}}, {"nodeid": "tests/api/test_discovery_advanced.py::test_discovery_climate_multiple_topics", "lineno": 412, "outcome": "passed", "keywords": ["test_discovery_climate_multiple_topics", "asyncio", "pytestmark", "test_discovery_advanced.py", "api", "tests", "marge", ""], "setup": {"duration": 0.0005621509626507759, "outcome": "passed"}, "call": {"duration": 1.5144485509954393, "outcome": "passed"}, "teardown": {"duration": 0.00048277387395501137, "outcome": "passed"}}, {"nodeid": "tests/api/test_discovery_advanced.py::test_discovery_cover_position_topic", "lineno": 434, "outcome": "passed", "keywords": ["test_discovery_cover_position_topic", "asyncio", "pytestmark", "test_discovery_advanced.py", "api", "tests", "marge", ""], "setup": {"duration": 0.0005603497847914696, "outcome": "passed"}, "call": {"duration": 1.5197576526552439, "outcome": "passed"}, "teardown": {"duration": 0.00046901311725378036, "outcome": "passed"}}, {"nodeid": "tests/api/test_discovery_advanced.py::test_discovery_fan_speed_range", "lineno": 456, "outcome": "passed", "keywords": ["test_discovery_fan_speed_range", "asyncio", "pytestmark", "test_discovery_advanced.py", "api", "tests", "marge", ""], "setup": {"duration": 0.00055707897990942, "outcome": "passed"}, "call": {"duration": 1.5100792390294373, "outcome": "passed"}, "teardown": {"duration": 0.00032715825363993645, "outcome": "passed"}}, {"nodeid": "tests/api/test_discovery_advanced.py::test_discovery_lock_payloads", "lineno": 478, "outcome": "passed", "keywords": ["test_discovery_lock_payloads", "asyncio", "pytestmark", "test_discovery_advanced.py", "api", "tests", "marge", ""], "setup": {"duration": 0.0004068906418979168, "outcome": "passed"}, "call": {"duration": 1.513047267217189, "outcome": "passed"}, "teardown": {"duration": 0.0004865434020757675, "outcome": "passed"}}, {"nodeid": "tests/api/test_discovery_advanced.py::test_discovery_light_color_modes", "lineno": 498, "outcome": "passed", "keywords": ["test_discovery_light_color_modes", "asyncio", "pytestmark", "test_discovery_advanced.py", "api", "tests", "marge", ""], "setup": {"duration": 0.0005359398201107979, "outcome": "passed"}, "call": {"duration": 1.5105393431149423, "outcome": "passed"}, "teardown": {"duration": 0.000462518073618412, "outcome": "passed"}}, {"nodeid": "tests/api/test_discovery_advanced.py::test_discovery_number_attributes", "lineno": 519, "outcome": "passed", "keywords": ["test_discovery_number_attributes", "asyncio", "pytestmark", "test_discovery_advanced.py", "api", "tests", "marge", ""], "setup": {"duration": 0.0004340400919318199, "outcome": "passed"}, "call": {"duration": 1.5363936987705529, "outcome": "passed"}, "teardown": {"duration": 0.000617865938693285, "outcome": "passed"}}, {"nodeid": "tests/api/test_discovery_advanced.py::test_discovery_select_options", "lineno": 544, "outcome": "passed", "keywords": ["test_discovery_select_options", "asyncio", "pytestmark", "test_discovery_advanced.py", "api", "tests", "marge", ""], "setup": {"duration": 0.00062962481752038, "outcome": "passed"}, "call": {"duration": 1.5102919721975923, "outcome": "passed"}, "teardown": {"duration": 0.0004046708345413208, "outcome": "passed"}}, {"nodeid": "tests/api/test_discovery_advanced.py::test_discovery_node_id_topic", "lineno": 563, "outcome": "passed", "keywords": ["test_discovery_node_id_topic", "asyncio", "pytestmark", "test_discovery_advanced.py", "api", "tests", "marge", ""], "setup": {"duration": 0.0005129771307110786, "outcome": "passed"}, "call": {"duration": 1.5156298209913075, "outcome": "passed"}, "teardown": {"duration": 0.000435566995292902, "outcome": "passed"}}, {"nodeid": "tests/api/test_history_logbook.py::test_history_records_state_changes", "lineno": 16, "outcome": "failed", "keywords": ["test_history_records_state_changes", "test_history_logbook.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.00897648511454463, "outcome": "passed"}, "call": {"duration": 0.4180687442421913, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_history_logbook.py", "lineno": 31, "message": "assert 404 == 200\n +  where 404 = <Response [404 Not Found]>.status_code"}, "traceback": [{"path": "tests/api/test_history_logbook.py", "lineno": 31, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b13a0b50>\n\n    async def test_history_records_state_changes(rest):\n        \"\"\"State changes appear in history for the entity.\"\"\"\n        entity_id = \"sensor.history_record_test\"\n        await rest.set_state(entity_id, \"10\")\n        await asyncio.sleep(0.1)\n        await rest.set_state(entity_id, \"20\")\n        await asyncio.sleep(0.1)\n        await rest.set_state(entity_id, \"30\")\n        await asyncio.sleep(0.2)\n    \n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/history/period/{entity_id}\",\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 404 == 200\nE        +  where 404 = <Response [404 Not Found]>.status_code\n\ntests/api/test_history_logbook.py:31: AssertionError"}, "teardown": {"duration": 0.0008645080961287022, "outcome": "passed"}}, {"nodeid": "tests/api/test_history_logbook.py::test_history_includes_entity_id", "lineno": 38, "outcome": "failed", "keywords": ["test_history_includes_entity_id", "test_history_logbook.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.009153841063380241, "outcome": "passed"}, "call": {"duration": 0.20623590983450413, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)"}, "traceback": [{"path": "tests/api/test_history_logbook.py", "lineno": 49, "message": ""}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 832, "message": "in json"}, {"path": "../../anaconda3/lib/python3.9/json/__init__.py", "lineno": 346, "message": "in loads"}, {"path": "../../anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "JSONDecodeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0a88130>\n\n    async def test_history_includes_entity_id(rest):\n        \"\"\"History entries include the entity_id field.\"\"\"\n        entity_id = \"sensor.history_eid_test\"\n        await rest.set_state(entity_id, \"42\")\n        await asyncio.sleep(0.2)\n    \n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/history/period/{entity_id}\",\n            headers=rest._headers(),\n        )\n>       entries = resp.json()\n\ntests/api/test_history_logbook.py:49: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:832: in json\n    return jsonlib.loads(self.content, **kwargs)\n../../anaconda3/lib/python3.9/json/__init__.py:346: in loads\n    return _default_decoder.decode(s)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <json.decoder.JSONDecoder object at 0x7f47b2e5fe50>, s = '404: Not Found'\n_w = <built-in method match of re.Pattern object at 0x7f47b3015cf0>\n\n    def decode(self, s, _w=WHITESPACE.match):\n        \"\"\"Return the Python representation of ``s`` (a ``str`` instance\n        containing a JSON document).\n    \n        \"\"\"\n        obj, end = self.raw_decode(s, idx=_w(s, 0).end())\n        end = _w(s, end).end()\n        if end != len(s):\n>           raise JSONDecodeError(\"Extra data\", s, end)\nE           json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)\n\n../../anaconda3/lib/python3.9/json/decoder.py:340: JSONDecodeError"}, "teardown": {"duration": 0.0009091468527913094, "outcome": "passed"}}, {"nodeid": "tests/api/test_history_logbook.py::test_history_includes_timestamps", "lineno": 53, "outcome": "failed", "keywords": ["test_history_includes_timestamps", "test_history_logbook.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.006839858368039131, "outcome": "passed"}, "call": {"duration": 0.20597475115209818, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)"}, "traceback": [{"path": "tests/api/test_history_logbook.py", "lineno": 64, "message": ""}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 832, "message": "in json"}, {"path": "../../anaconda3/lib/python3.9/json/__init__.py", "lineno": 346, "message": "in loads"}, {"path": "../../anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "JSONDecodeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b09358e0>\n\n    async def test_history_includes_timestamps(rest):\n        \"\"\"History entries include last_changed and last_updated.\"\"\"\n        entity_id = \"sensor.history_ts_test\"\n        await rest.set_state(entity_id, \"1\")\n        await asyncio.sleep(0.2)\n    \n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/history/period/{entity_id}\",\n            headers=rest._headers(),\n        )\n>       entries = resp.json()\n\ntests/api/test_history_logbook.py:64: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:832: in json\n    return jsonlib.loads(self.content, **kwargs)\n../../anaconda3/lib/python3.9/json/__init__.py:346: in loads\n    return _default_decoder.decode(s)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <json.decoder.JSONDecoder object at 0x7f47b2e5fe50>, s = '404: Not Found'\n_w = <built-in method match of re.Pattern object at 0x7f47b3015cf0>\n\n    def decode(self, s, _w=WHITESPACE.match):\n        \"\"\"Return the Python representation of ``s`` (a ``str`` instance\n        containing a JSON document).\n    \n        \"\"\"\n        obj, end = self.raw_decode(s, idx=_w(s, 0).end())\n        end = _w(s, end).end()\n        if end != len(s):\n>           raise JSONDecodeError(\"Extra data\", s, end)\nE           json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)\n\n../../anaconda3/lib/python3.9/json/decoder.py:340: JSONDecodeError"}, "teardown": {"duration": 0.0009527248330414295, "outcome": "passed"}}, {"nodeid": "tests/api/test_history_logbook.py::test_history_includes_attributes", "lineno": 70, "outcome": "failed", "keywords": ["test_history_includes_attributes", "test_history_logbook.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.007884670980274677, "outcome": "passed"}, "call": {"duration": 0.2074020761065185, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)"}, "traceback": [{"path": "tests/api/test_history_logbook.py", "lineno": 81, "message": ""}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 832, "message": "in json"}, {"path": "../../anaconda3/lib/python3.9/json/__init__.py", "lineno": 346, "message": "in loads"}, {"path": "../../anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "JSONDecodeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b07cdb80>\n\n    async def test_history_includes_attributes(rest):\n        \"\"\"History entries preserve attributes.\"\"\"\n        entity_id = \"sensor.history_attrs_test\"\n        await rest.set_state(entity_id, \"72\", {\"unit_of_measurement\": \"F\"})\n        await asyncio.sleep(0.2)\n    \n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/history/period/{entity_id}\",\n            headers=rest._headers(),\n        )\n>       entries = resp.json()\n\ntests/api/test_history_logbook.py:81: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:832: in json\n    return jsonlib.loads(self.content, **kwargs)\n../../anaconda3/lib/python3.9/json/__init__.py:346: in loads\n    return _default_decoder.decode(s)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <json.decoder.JSONDecoder object at 0x7f47b2e5fe50>, s = '404: Not Found'\n_w = <built-in method match of re.Pattern object at 0x7f47b3015cf0>\n\n    def decode(self, s, _w=WHITESPACE.match):\n        \"\"\"Return the Python representation of ``s`` (a ``str`` instance\n        containing a JSON document).\n    \n        \"\"\"\n        obj, end = self.raw_decode(s, idx=_w(s, 0).end())\n        end = _w(s, end).end()\n        if end != len(s):\n>           raise JSONDecodeError(\"Extra data\", s, end)\nE           json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)\n\n../../anaconda3/lib/python3.9/json/decoder.py:340: JSONDecodeError"}, "teardown": {"duration": 0.0010175490751862526, "outcome": "passed"}}, {"nodeid": "tests/api/test_history_logbook.py::test_history_empty_for_unknown_entity", "lineno": 86, "outcome": "failed", "keywords": ["test_history_empty_for_unknown_entity", "test_history_logbook.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.007996785920113325, "outcome": "passed"}, "call": {"duration": 0.004482606891542673, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_history_logbook.py", "lineno": 93, "message": "assert 404 == 200\n +  where 404 = <Response [404 Not Found]>.status_code"}, "traceback": [{"path": "tests/api/test_history_logbook.py", "lineno": 93, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b071cac0>\n\n    async def test_history_empty_for_unknown_entity(rest):\n        \"\"\"History returns empty list for unknown entity.\"\"\"\n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/history/period/sensor.definitely_no_history_xyz\",\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 404 == 200\nE        +  where 404 = <Response [404 Not Found]>.status_code\n\ntests/api/test_history_logbook.py:93: AssertionError"}, "teardown": {"duration": 0.0008707991801202297, "outcome": "passed"}}, {"nodeid": "tests/api/test_history_logbook.py::test_logbook_entity_returns_changes", "lineno": 98, "outcome": "failed", "keywords": ["test_logbook_entity_returns_changes", "test_history_logbook.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.007960879243910313, "outcome": "passed"}, "call": {"duration": 0.3122725640423596, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_history_logbook.py", "lineno": 113, "message": "assert 404 == 200\n +  where 404 = <Response [404 Not Found]>.status_code"}, "traceback": [{"path": "tests/api/test_history_logbook.py", "lineno": 113, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b05411f0>\n\n    async def test_logbook_entity_returns_changes(rest):\n        \"\"\"Logbook for an entity returns state change entries.\"\"\"\n        entity_id = \"sensor.logbook_changes_test\"\n        await rest.set_state(entity_id, \"a\")\n        await asyncio.sleep(0.05)\n        await rest.set_state(entity_id, \"b\")\n        await asyncio.sleep(0.05)\n        await rest.set_state(entity_id, \"c\")\n        await asyncio.sleep(0.2)\n    \n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/logbook/{entity_id}\",\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 404 == 200\nE        +  where 404 = <Response [404 Not Found]>.status_code\n\ntests/api/test_history_logbook.py:113: AssertionError"}, "teardown": {"duration": 0.0007546329870820045, "outcome": "passed"}}, {"nodeid": "tests/api/test_history_logbook.py::test_logbook_deduplicates_same_state", "lineno": 117, "outcome": "failed", "keywords": ["test_logbook_deduplicates_same_state", "test_history_logbook.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005260959267616272, "outcome": "passed"}, "call": {"duration": 0.3100575329735875, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)"}, "traceback": [{"path": "tests/api/test_history_logbook.py", "lineno": 132, "message": ""}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 832, "message": "in json"}, {"path": "../../anaconda3/lib/python3.9/json/__init__.py", "lineno": 346, "message": "in loads"}, {"path": "../../anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "JSONDecodeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b061df40>\n\n    async def test_logbook_deduplicates_same_state(rest):\n        \"\"\"Logbook filters out consecutive identical states.\"\"\"\n        entity_id = \"sensor.logbook_dedup_test\"\n        await rest.set_state(entity_id, \"same\")\n        await asyncio.sleep(0.05)\n        await rest.set_state(entity_id, \"same\")\n        await asyncio.sleep(0.05)\n        await rest.set_state(entity_id, \"different\")\n        await asyncio.sleep(0.2)\n    \n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/logbook/{entity_id}\",\n            headers=rest._headers(),\n        )\n>       entries = resp.json()\n\ntests/api/test_history_logbook.py:132: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:832: in json\n    return jsonlib.loads(self.content, **kwargs)\n../../anaconda3/lib/python3.9/json/__init__.py:346: in loads\n    return _default_decoder.decode(s)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <json.decoder.JSONDecoder object at 0x7f47b2e5fe50>, s = '404: Not Found'\n_w = <built-in method match of re.Pattern object at 0x7f47b3015cf0>\n\n    def decode(self, s, _w=WHITESPACE.match):\n        \"\"\"Return the Python representation of ``s`` (a ``str`` instance\n        containing a JSON document).\n    \n        \"\"\"\n        obj, end = self.raw_decode(s, idx=_w(s, 0).end())\n        end = _w(s, end).end()\n        if end != len(s):\n>           raise JSONDecodeError(\"Extra data\", s, end)\nE           json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)\n\n../../anaconda3/lib/python3.9/json/decoder.py:340: JSONDecodeError"}, "teardown": {"duration": 0.0010288450866937637, "outcome": "passed"}}, {"nodeid": "tests/api/test_history_logbook.py::test_logbook_global_returns_entries", "lineno": 139, "outcome": "failed", "keywords": ["test_logbook_global_returns_entries", "test_history_logbook.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.008205346297472715, "outcome": "passed"}, "call": {"duration": 0.2081748698838055, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_history_logbook.py", "lineno": 150, "message": "assert 404 == 200\n +  where 404 = <Response [404 Not Found]>.status_code"}, "traceback": [{"path": "tests/api/test_history_logbook.py", "lineno": 150, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0aa39d0>\n\n    async def test_logbook_global_returns_entries(rest):\n        \"\"\"Global logbook returns recent entries across all entities.\"\"\"\n        await rest.set_state(\"sensor.logbook_global_a\", \"1\")\n        await rest.set_state(\"sensor.logbook_global_b\", \"2\")\n        await asyncio.sleep(0.2)\n    \n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/logbook\",\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 404 == 200\nE        +  where 404 = <Response [404 Not Found]>.status_code\n\ntests/api/test_history_logbook.py:150: AssertionError"}, "teardown": {"duration": 0.0007483521476387978, "outcome": "passed"}}, {"nodeid": "tests/api/test_history_logbook.py::test_logbook_entries_have_when_field", "lineno": 157, "outcome": "failed", "keywords": ["test_logbook_entries_have_when_field", "test_history_logbook.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.007439629640430212, "outcome": "passed"}, "call": {"duration": 0.20659642573446035, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)"}, "traceback": [{"path": "tests/api/test_history_logbook.py", "lineno": 168, "message": ""}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 832, "message": "in json"}, {"path": "../../anaconda3/lib/python3.9/json/__init__.py", "lineno": 346, "message": "in loads"}, {"path": "../../anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "JSONDecodeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b08daee0>\n\n    async def test_logbook_entries_have_when_field(rest):\n        \"\"\"Logbook entries include a 'when' timestamp.\"\"\"\n        entity_id = \"sensor.logbook_when_test\"\n        await rest.set_state(entity_id, \"x\")\n        await asyncio.sleep(0.2)\n    \n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/logbook/{entity_id}\",\n            headers=rest._headers(),\n        )\n>       entries = resp.json()\n\ntests/api/test_history_logbook.py:168: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:832: in json\n    return jsonlib.loads(self.content, **kwargs)\n../../anaconda3/lib/python3.9/json/__init__.py:346: in loads\n    return _default_decoder.decode(s)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <json.decoder.JSONDecoder object at 0x7f47b2e5fe50>, s = '404: Not Found'\n_w = <built-in method match of re.Pattern object at 0x7f47b3015cf0>\n\n    def decode(self, s, _w=WHITESPACE.match):\n        \"\"\"Return the Python representation of ``s`` (a ``str`` instance\n        containing a JSON document).\n    \n        \"\"\"\n        obj, end = self.raw_decode(s, idx=_w(s, 0).end())\n        end = _w(s, end).end()\n        if end != len(s):\n>           raise JSONDecodeError(\"Extra data\", s, end)\nE           json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)\n\n../../anaconda3/lib/python3.9/json/decoder.py:340: JSONDecodeError"}, "teardown": {"duration": 0.0007578358054161072, "outcome": "passed"}}, {"nodeid": "tests/api/test_history_logbook.py::test_history_returns_list", "lineno": 174, "outcome": "failed", "keywords": ["test_history_returns_list", "test_history_logbook.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005595412105321884, "outcome": "passed"}, "call": {"duration": 0.2050764188170433, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_history_logbook.py", "lineno": 186, "message": "assert 404 == 200\n +  where 404 = <Response [404 Not Found]>.status_code"}, "traceback": [{"path": "tests/api/test_history_logbook.py", "lineno": 186, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b075f880>\n\n    async def test_history_returns_list(rest):\n        \"\"\"GET /api/history/period/{eid} returns a list.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"sensor.hist_{tag}\"\n        await rest.set_state(eid, \"val1\")\n        await asyncio.sleep(0.2)\n    \n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/history/period/{eid}\",\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 404 == 200\nE        +  where 404 = <Response [404 Not Found]>.status_code\n\ntests/api/test_history_logbook.py:186: AssertionError"}, "teardown": {"duration": 0.0007558581419289112, "outcome": "passed"}}, {"nodeid": "tests/api/test_history_logbook.py::test_history_entry_has_fields", "lineno": 190, "outcome": "failed", "keywords": ["test_history_entry_has_fields", "test_history_logbook.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.0051640477031469345, "outcome": "passed"}, "call": {"duration": 0.4115145578980446, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)"}, "traceback": [{"path": "tests/api/test_history_logbook.py", "lineno": 204, "message": ""}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 832, "message": "in json"}, {"path": "../../anaconda3/lib/python3.9/json/__init__.py", "lineno": 346, "message": "in loads"}, {"path": "../../anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "JSONDecodeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b05fb2e0>\n\n    async def test_history_entry_has_fields(rest):\n        \"\"\"History entries have state, last_changed, recorded_at.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"sensor.hist_fld_{tag}\"\n        await rest.set_state(eid, \"a\")\n        await asyncio.sleep(0.2)\n        await rest.set_state(eid, \"b\")\n        await asyncio.sleep(0.2)\n    \n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/history/period/{eid}\",\n            headers=rest._headers(),\n        )\n>       data = resp.json()\n\ntests/api/test_history_logbook.py:204: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:832: in json\n    return jsonlib.loads(self.content, **kwargs)\n../../anaconda3/lib/python3.9/json/__init__.py:346: in loads\n    return _default_decoder.decode(s)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <json.decoder.JSONDecoder object at 0x7f47b2e5fe50>, s = '404: Not Found'\n_w = <built-in method match of re.Pattern object at 0x7f47b3015cf0>\n\n    def decode(self, s, _w=WHITESPACE.match):\n        \"\"\"Return the Python representation of ``s`` (a ``str`` instance\n        containing a JSON document).\n    \n        \"\"\"\n        obj, end = self.raw_decode(s, idx=_w(s, 0).end())\n        end = _w(s, end).end()\n        if end != len(s):\n>           raise JSONDecodeError(\"Extra data\", s, end)\nE           json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)\n\n../../anaconda3/lib/python3.9/json/decoder.py:340: JSONDecodeError"}, "teardown": {"duration": 0.0010653119534254074, "outcome": "passed"}}, {"nodeid": "tests/api/test_history_logbook.py::test_history_multiple_states", "lineno": 210, "outcome": "failed", "keywords": ["test_history_multiple_states", "test_history_logbook.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.008389963302761316, "outcome": "passed"}, "call": {"duration": 0.6128111113794148, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)"}, "traceback": [{"path": "tests/api/test_history_logbook.py", "lineno": 223, "message": ""}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 832, "message": "in json"}, {"path": "../../anaconda3/lib/python3.9/json/__init__.py", "lineno": 346, "message": "in loads"}, {"path": "../../anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "JSONDecodeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0734460>\n\n    async def test_history_multiple_states(rest):\n        \"\"\"Multiple state changes appear in history.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"sensor.hist_multi_{tag}\"\n        for val in [\"x\", \"y\", \"z\"]:\n            await rest.set_state(eid, val)\n            await asyncio.sleep(0.2)\n    \n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/history/period/{eid}\",\n            headers=rest._headers(),\n        )\n>       data = resp.json()\n\ntests/api/test_history_logbook.py:223: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:832: in json\n    return jsonlib.loads(self.content, **kwargs)\n../../anaconda3/lib/python3.9/json/__init__.py:346: in loads\n    return _default_decoder.decode(s)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <json.decoder.JSONDecoder object at 0x7f47b2e5fe50>, s = '404: Not Found'\n_w = <built-in method match of re.Pattern object at 0x7f47b3015cf0>\n\n    def decode(self, s, _w=WHITESPACE.match):\n        \"\"\"Return the Python representation of ``s`` (a ``str`` instance\n        containing a JSON document).\n    \n        \"\"\"\n        obj, end = self.raw_decode(s, idx=_w(s, 0).end())\n        end = _w(s, end).end()\n        if end != len(s):\n>           raise JSONDecodeError(\"Extra data\", s, end)\nE           json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)\n\n../../anaconda3/lib/python3.9/json/decoder.py:340: JSONDecodeError"}, "teardown": {"duration": 0.0006806650198996067, "outcome": "passed"}}, {"nodeid": "tests/api/test_history_logbook.py::test_history_with_time_range", "lineno": 226, "outcome": "failed", "keywords": ["test_history_with_time_range", "test_history_logbook.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005193930119276047, "outcome": "passed"}, "call": {"duration": 0.20765223214402795, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_history_logbook.py", "lineno": 239, "message": "assert 404 == 200\n +  where 404 = <Response [404 Not Found]>.status_code"}, "traceback": [{"path": "tests/api/test_history_logbook.py", "lineno": 239, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0545310>\n\n    async def test_history_with_time_range(rest):\n        \"\"\"History accepts start/end query parameters.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"sensor.hist_range_{tag}\"\n        await rest.set_state(eid, \"ranged\")\n        await asyncio.sleep(0.2)\n    \n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/history/period/{eid}\",\n            params={\"start\": \"2020-01-01T00:00:00Z\", \"end\": \"2030-01-01T00:00:00Z\"},\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 404 == 200\nE        +  where 404 = <Response [404 Not Found]>.status_code\n\ntests/api/test_history_logbook.py:239: AssertionError"}, "teardown": {"duration": 0.0009146463125944138, "outcome": "passed"}}, {"nodeid": "tests/api/test_history_logbook.py::test_history_chronological_order", "lineno": 241, "outcome": "failed", "keywords": ["test_history_chronological_order", "test_history_logbook.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.007670543156564236, "outcome": "passed"}, "call": {"duration": 0.46221178490668535, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)"}, "traceback": [{"path": "tests/api/test_history_logbook.py", "lineno": 254, "message": ""}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 832, "message": "in json"}, {"path": "../../anaconda3/lib/python3.9/json/__init__.py", "lineno": 346, "message": "in loads"}, {"path": "../../anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "JSONDecodeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0547970>\n\n    async def test_history_chronological_order(rest):\n        \"\"\"History entries are in chronological order.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"sensor.hist_order_{tag}\"\n        for val in [\"first\", \"second\", \"third\"]:\n            await rest.set_state(eid, val)\n            await asyncio.sleep(0.15)\n    \n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/history/period/{eid}\",\n            headers=rest._headers(),\n        )\n>       data = resp.json()\n\ntests/api/test_history_logbook.py:254: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:832: in json\n    return jsonlib.loads(self.content, **kwargs)\n../../anaconda3/lib/python3.9/json/__init__.py:346: in loads\n    return _default_decoder.decode(s)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <json.decoder.JSONDecoder object at 0x7f47b2e5fe50>, s = '404: Not Found'\n_w = <built-in method match of re.Pattern object at 0x7f47b3015cf0>\n\n    def decode(self, s, _w=WHITESPACE.match):\n        \"\"\"Return the Python representation of ``s`` (a ``str`` instance\n        containing a JSON document).\n    \n        \"\"\"\n        obj, end = self.raw_decode(s, idx=_w(s, 0).end())\n        end = _w(s, end).end()\n        if end != len(s):\n>           raise JSONDecodeError(\"Extra data\", s, end)\nE           json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)\n\n../../anaconda3/lib/python3.9/json/decoder.py:340: JSONDecodeError"}, "teardown": {"duration": 0.000759270042181015, "outcome": "passed"}}, {"nodeid": "tests/api/test_history_logbook.py::test_history_preserves_attributes", "lineno": 259, "outcome": "failed", "keywords": ["test_history_preserves_attributes", "test_history_logbook.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.0052817389369010925, "outcome": "passed"}, "call": {"duration": 0.20523977791890502, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)"}, "traceback": [{"path": "tests/api/test_history_logbook.py", "lineno": 271, "message": ""}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 832, "message": "in json"}, {"path": "../../anaconda3/lib/python3.9/json/__init__.py", "lineno": 346, "message": "in loads"}, {"path": "../../anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "JSONDecodeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b099d4f0>\n\n    async def test_history_preserves_attributes(rest):\n        \"\"\"History entries include attributes.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"sensor.hist_attr_{tag}\"\n        await rest.set_state(eid, \"42\", {\"unit\": \"celsius\"})\n        await asyncio.sleep(0.2)\n    \n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/history/period/{eid}\",\n            headers=rest._headers(),\n        )\n>       data = resp.json()\n\ntests/api/test_history_logbook.py:271: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:832: in json\n    return jsonlib.loads(self.content, **kwargs)\n../../anaconda3/lib/python3.9/json/__init__.py:346: in loads\n    return _default_decoder.decode(s)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <json.decoder.JSONDecoder object at 0x7f47b2e5fe50>, s = '404: Not Found'\n_w = <built-in method match of re.Pattern object at 0x7f47b3015cf0>\n\n    def decode(self, s, _w=WHITESPACE.match):\n        \"\"\"Return the Python representation of ``s`` (a ``str`` instance\n        containing a JSON document).\n    \n        \"\"\"\n        obj, end = self.raw_decode(s, idx=_w(s, 0).end())\n        end = _w(s, end).end()\n        if end != len(s):\n>           raise JSONDecodeError(\"Extra data\", s, end)\nE           json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)\n\n../../anaconda3/lib/python3.9/json/decoder.py:340: JSONDecodeError"}, "teardown": {"duration": 0.0007361262105405331, "outcome": "passed"}}, {"nodeid": "tests/api/test_history_logbook.py::test_logbook_returns_list", "lineno": 277, "outcome": "failed", "keywords": ["test_logbook_returns_list", "test_history_logbook.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005217148922383785, "outcome": "passed"}, "call": {"duration": 0.0029284129850566387, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_history_logbook.py", "lineno": 284, "message": "assert 404 == 200\n +  where 404 = <Response [404 Not Found]>.status_code"}, "traceback": [{"path": "tests/api/test_history_logbook.py", "lineno": 284, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b09e6f70>\n\n    async def test_logbook_returns_list(rest):\n        \"\"\"GET /api/logbook returns a list.\"\"\"\n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/logbook\",\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 404 == 200\nE        +  where 404 = <Response [404 Not Found]>.status_code\n\ntests/api/test_history_logbook.py:284: AssertionError"}, "teardown": {"duration": 0.000722233671694994, "outcome": "passed"}}, {"nodeid": "tests/api/test_history_logbook.py::test_logbook_entry_has_fields", "lineno": 288, "outcome": "failed", "keywords": ["test_logbook_entry_has_fields", "test_history_logbook.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005315540358424187, "outcome": "passed"}, "call": {"duration": 0.20556950429454446, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)"}, "traceback": [{"path": "tests/api/test_history_logbook.py", "lineno": 300, "message": ""}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 832, "message": "in json"}, {"path": "../../anaconda3/lib/python3.9/json/__init__.py", "lineno": 346, "message": "in loads"}, {"path": "../../anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "JSONDecodeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b05e2760>\n\n    async def test_logbook_entry_has_fields(rest):\n        \"\"\"Logbook entries have entity_id, state, when.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"sensor.log_fld_{tag}\"\n        await rest.set_state(eid, \"logged\")\n        await asyncio.sleep(0.2)\n    \n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/logbook\",\n            headers=rest._headers(),\n        )\n>       data = resp.json()\n\ntests/api/test_history_logbook.py:300: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:832: in json\n    return jsonlib.loads(self.content, **kwargs)\n../../anaconda3/lib/python3.9/json/__init__.py:346: in loads\n    return _default_decoder.decode(s)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <json.decoder.JSONDecoder object at 0x7f47b2e5fe50>, s = '404: Not Found'\n_w = <built-in method match of re.Pattern object at 0x7f47b3015cf0>\n\n    def decode(self, s, _w=WHITESPACE.match):\n        \"\"\"Return the Python representation of ``s`` (a ``str`` instance\n        containing a JSON document).\n    \n        \"\"\"\n        obj, end = self.raw_decode(s, idx=_w(s, 0).end())\n        end = _w(s, end).end()\n        if end != len(s):\n>           raise JSONDecodeError(\"Extra data\", s, end)\nE           json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)\n\n../../anaconda3/lib/python3.9/json/decoder.py:340: JSONDecodeError"}, "teardown": {"duration": 0.0008982028812170029, "outcome": "passed"}}, {"nodeid": "tests/api/test_history_logbook.py::test_logbook_entity_specific", "lineno": 307, "outcome": "failed", "keywords": ["test_logbook_entity_specific", "test_history_logbook.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.00683498615399003, "outcome": "passed"}, "call": {"duration": 0.3115033311769366, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_history_logbook.py", "lineno": 321, "message": "assert 404 == 200\n +  where 404 = <Response [404 Not Found]>.status_code"}, "traceback": [{"path": "tests/api/test_history_logbook.py", "lineno": 321, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0612e20>\n\n    async def test_logbook_entity_specific(rest):\n        \"\"\"GET /api/logbook/{entity_id} returns filtered logbook.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"sensor.log_spec_{tag}\"\n        await rest.set_state(eid, \"first\")\n        await asyncio.sleep(0.1)\n        await rest.set_state(eid, \"second\")\n        await asyncio.sleep(0.2)\n    \n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/logbook/{eid}\",\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 404 == 200\nE        +  where 404 = <Response [404 Not Found]>.status_code\n\ntests/api/test_history_logbook.py:321: AssertionError"}, "teardown": {"duration": 0.0019678669050335884, "outcome": "passed"}}, {"nodeid": "tests/api/test_history_logbook.py::test_logbook_with_time_range", "lineno": 328, "outcome": "failed", "keywords": ["test_logbook_with_time_range", "test_history_logbook.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.0170384026132524, "outcome": "passed"}, "call": {"duration": 0.00598251074552536, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_history_logbook.py", "lineno": 336, "message": "assert 404 == 200\n +  where 404 = <Response [404 Not Found]>.status_code"}, "traceback": [{"path": "tests/api/test_history_logbook.py", "lineno": 336, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0734760>\n\n    async def test_logbook_with_time_range(rest):\n        \"\"\"Logbook accepts start/end query parameters.\"\"\"\n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/logbook\",\n            params={\"start\": \"2020-01-01T00:00:00Z\", \"end\": \"2030-01-01T00:00:00Z\"},\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 404 == 200\nE        +  where 404 = <Response [404 Not Found]>.status_code\n\ntests/api/test_history_logbook.py:336: AssertionError"}, "teardown": {"duration": 0.0009599789045751095, "outcome": "passed"}}, {"nodeid": "tests/api/test_history_logbook.py::test_history_future_range_empty", "lineno": 341, "outcome": "failed", "keywords": ["test_history_future_range_empty", "test_history_logbook.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.007723068818449974, "outcome": "passed"}, "call": {"duration": 0.005801387131214142, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_history_logbook.py", "lineno": 353, "message": "assert 404 == 200\n +  where 404 = <Response [404 Not Found]>.status_code"}, "traceback": [{"path": "tests/api/test_history_logbook.py", "lineno": 353, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0a02a90>\n\n    async def test_history_future_range_empty(rest):\n        \"\"\"History with future time range returns empty.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"sensor.histfuture_{tag}\"\n        await rest.set_state(eid, \"v\")\n    \n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/history/period/{eid}\",\n            params={\"start\": \"2099-01-01T00:00:00Z\", \"end\": \"2099-12-31T00:00:00Z\"},\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 404 == 200\nE        +  where 404 = <Response [404 Not Found]>.status_code\n\ntests/api/test_history_logbook.py:353: AssertionError"}, "teardown": {"duration": 0.0008920701220631599, "outcome": "passed"}}, {"nodeid": "tests/api/test_logbook_global.py::test_global_logbook_returns_list", "lineno": 15, "outcome": "failed", "keywords": ["test_global_logbook_returns_list", "test_logbook_global.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.007675679866224527, "outcome": "passed"}, "call": {"duration": 0.0036105699837207794, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_logbook_global.py", "lineno": 22, "message": "assert 404 == 200\n +  where 404 = <Response [404 Not Found]>.status_code"}, "traceback": [{"path": "tests/api/test_logbook_global.py", "lineno": 22, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b067abe0>\n\n    async def test_global_logbook_returns_list(rest):\n        \"\"\"GET /api/logbook returns list of entries.\"\"\"\n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/logbook\",\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 404 == 200\nE        +  where 404 = <Response [404 Not Found]>.status_code\n\ntests/api/test_logbook_global.py:22: AssertionError"}, "teardown": {"duration": 0.0006791749037802219, "outcome": "passed"}}, {"nodeid": "tests/api/test_logbook_global.py::test_logbook_after_state_change", "lineno": 26, "outcome": "failed", "keywords": ["test_logbook_after_state_change", "test_logbook_global.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.006496659014374018, "outcome": "passed"}, "call": {"duration": 0.006048146169632673, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_logbook_global.py", "lineno": 38, "message": "assert 404 == 200\n +  where 404 = <Response [404 Not Found]>.status_code"}, "traceback": [{"path": "tests/api/test_logbook_global.py", "lineno": 38, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b067af70>\n\n    async def test_logbook_after_state_change(rest):\n        \"\"\"Logbook records state changes.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"sensor.log_sc_{tag}\"\n        await rest.set_state(eid, \"100\")\n        await rest.set_state(eid, \"200\")\n    \n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/logbook/{eid}\",\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 404 == 200\nE        +  where 404 = <Response [404 Not Found]>.status_code\n\ntests/api/test_logbook_global.py:38: AssertionError"}, "teardown": {"duration": 0.0005867099389433861, "outcome": "passed"}}, {"nodeid": "tests/api/test_logbook_global.py::test_logbook_entry_has_fields", "lineno": 42, "outcome": "failed", "keywords": ["test_logbook_entry_has_fields", "test_logbook_global.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.0054667177610099316, "outcome": "passed"}, "call": {"duration": 0.5059084361419082, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)"}, "traceback": [{"path": "tests/api/test_logbook_global.py", "lineno": 54, "message": ""}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 832, "message": "in json"}, {"path": "../../anaconda3/lib/python3.9/json/__init__.py", "lineno": 346, "message": "in loads"}, {"path": "../../anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "JSONDecodeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b06a27f0>\n\n    async def test_logbook_entry_has_fields(rest):\n        \"\"\"Logbook entries have expected fields.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"sensor.log_fields_{tag}\"\n        await rest.set_state(eid, \"abc\")\n        await asyncio.sleep(0.5)\n    \n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/logbook/{eid}\",\n            headers=rest._headers(),\n        )\n>       data = resp.json()\n\ntests/api/test_logbook_global.py:54: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:832: in json\n    return jsonlib.loads(self.content, **kwargs)\n../../anaconda3/lib/python3.9/json/__init__.py:346: in loads\n    return _default_decoder.decode(s)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <json.decoder.JSONDecoder object at 0x7f47b2e5fe50>, s = '404: Not Found'\n_w = <built-in method match of re.Pattern object at 0x7f47b3015cf0>\n\n    def decode(self, s, _w=WHITESPACE.match):\n        \"\"\"Return the Python representation of ``s`` (a ``str`` instance\n        containing a JSON document).\n    \n        \"\"\"\n        obj, end = self.raw_decode(s, idx=_w(s, 0).end())\n        end = _w(s, end).end()\n        if end != len(s):\n>           raise JSONDecodeError(\"Extra data\", s, end)\nE           json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)\n\n../../anaconda3/lib/python3.9/json/decoder.py:340: JSONDecodeError"}, "teardown": {"duration": 0.0011731158010661602, "outcome": "passed"}}, {"nodeid": "tests/api/test_logbook_global.py::test_logbook_unknown_entity", "lineno": 60, "outcome": "failed", "keywords": ["test_logbook_unknown_entity", "test_logbook_global.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.00791932363063097, "outcome": "passed"}, "call": {"duration": 0.0038294768892228603, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_logbook_global.py", "lineno": 67, "message": "assert 404 == 200\n +  where 404 = <Response [404 Not Found]>.status_code"}, "traceback": [{"path": "tests/api/test_logbook_global.py", "lineno": 67, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b06e9250>\n\n    async def test_logbook_unknown_entity(rest):\n        \"\"\"Logbook for unknown entity returns empty list.\"\"\"\n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/logbook/sensor.logbook_nonexistent_xyz\",\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 404 == 200\nE        +  where 404 = <Response [404 Not Found]>.status_code\n\ntests/api/test_logbook_global.py:67: AssertionError"}, "teardown": {"duration": 0.0009163073264062405, "outcome": "passed"}}, {"nodeid": "tests/api/test_logbook_global.py::test_events_list_has_state_changed", "lineno": 72, "outcome": "passed", "keywords": ["test_events_list_has_state_changed", "test_logbook_global.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.011308907065540552, "outcome": "passed"}, "call": {"duration": 0.004411470144987106, "outcome": "passed"}, "teardown": {"duration": 0.0007985900156199932, "outcome": "passed"}}, {"nodeid": "tests/api/test_logbook_global.py::test_events_after_fire", "lineno": 85, "outcome": "passed", "keywords": ["test_events_after_fire", "test_logbook_global.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.007497153244912624, "outcome": "passed"}, "call": {"duration": 0.00577965285629034, "outcome": "passed"}, "teardown": {"duration": 0.0006604217924177647, "outcome": "passed"}}, {"nodeid": "tests/api/test_logbook_global.py::test_history_multiple_changes", "lineno": 101, "outcome": "failed", "keywords": ["test_history_multiple_changes", "test_logbook_global.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.006884318310767412, "outcome": "passed"}, "call": {"duration": 1.0181873496621847, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_logbook_global.py", "lineno": 114, "message": "assert 404 == 200\n +  where 404 = <Response [404 Not Found]>.status_code"}, "traceback": [{"path": "tests/api/test_logbook_global.py", "lineno": 114, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b071c0a0>\n\n    async def test_history_multiple_changes(rest):\n        \"\"\"History records multiple state changes.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"sensor.hist_multi_{tag}\"\n        for i in range(5):\n            await rest.set_state(eid, str(i * 10))\n            await asyncio.sleep(0.2)\n    \n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/history/period/{eid}\",\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 404 == 200\nE        +  where 404 = <Response [404 Not Found]>.status_code\n\ntests/api/test_logbook_global.py:114: AssertionError"}, "teardown": {"duration": 0.000984041951596737, "outcome": "passed"}}, {"nodeid": "tests/api/test_logbook_global.py::test_history_has_state_and_timestamp", "lineno": 118, "outcome": "failed", "keywords": ["test_history_has_state_and_timestamp", "test_logbook_global.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.007446215022355318, "outcome": "passed"}, "call": {"duration": 0.4086573258973658, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)"}, "traceback": [{"path": "tests/api/test_logbook_global.py", "lineno": 132, "message": ""}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 832, "message": "in json"}, {"path": "../../anaconda3/lib/python3.9/json/__init__.py", "lineno": 346, "message": "in loads"}, {"path": "../../anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "JSONDecodeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b096ee20>\n\n    async def test_history_has_state_and_timestamp(rest):\n        \"\"\"History entries have state and timestamp fields.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"sensor.hist_fields_{tag}\"\n        await rest.set_state(eid, \"42\")\n        await asyncio.sleep(0.2)\n        await rest.set_state(eid, \"43\")\n        await asyncio.sleep(0.2)\n    \n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/history/period/{eid}\",\n            headers=rest._headers(),\n        )\n>       data = resp.json()\n\ntests/api/test_logbook_global.py:132: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:832: in json\n    return jsonlib.loads(self.content, **kwargs)\n../../anaconda3/lib/python3.9/json/__init__.py:346: in loads\n    return _default_decoder.decode(s)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <json.decoder.JSONDecoder object at 0x7f47b2e5fe50>, s = '404: Not Found'\n_w = <built-in method match of re.Pattern object at 0x7f47b3015cf0>\n\n    def decode(self, s, _w=WHITESPACE.match):\n        \"\"\"Return the Python representation of ``s`` (a ``str`` instance\n        containing a JSON document).\n    \n        \"\"\"\n        obj, end = self.raw_decode(s, idx=_w(s, 0).end())\n        end = _w(s, end).end()\n        if end != len(s):\n>           raise JSONDecodeError(\"Extra data\", s, end)\nE           json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)\n\n../../anaconda3/lib/python3.9/json/decoder.py:340: JSONDecodeError"}, "teardown": {"duration": 0.0007388959638774395, "outcome": "passed"}}, {"nodeid": "tests/api/test_logbook_global.py::test_logbook_time_range[2020-01-01T00:00:00Z-2030-01-01T00:00:00Z-False]", "lineno": 141, "outcome": "failed", "keywords": ["test_logbook_time_range[2020-01-01T00:00:00Z-2030-01-01T00:00:00Z-False]", "parametrize", "pytestmark", "2020-01-01T00:00:00Z-2030-01-01T00:00:00Z-False", "test_logbook_global.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005327118095010519, "outcome": "passed"}, "call": {"duration": 0.0029039583168923855, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_logbook_global.py", "lineno": 153, "message": "assert 404 == 200\n +  where 404 = <Response [404 Not Found]>.status_code"}, "traceback": [{"path": "tests/api/test_logbook_global.py", "lineno": 153, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b06197f0>\nstart = '2020-01-01T00:00:00Z', end = '2030-01-01T00:00:00Z'\nexpect_empty = False\n\n    @pytest.mark.parametrize(\"start,end,expect_empty\", [\n        (\"2020-01-01T00:00:00Z\", \"2030-01-01T00:00:00Z\", False),\n        (\"2020-01-01T00:00:00Z\", \"2020-01-01T00:00:01Z\", True),\n    ])\n    async def test_logbook_time_range(rest, start, end, expect_empty):\n        \"\"\"GET /api/logbook with time range returns expected results.\"\"\"\n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/logbook\",\n            params={\"start\": start, \"end\": end},\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 404 == 200\nE        +  where 404 = <Response [404 Not Found]>.status_code\n\ntests/api/test_logbook_global.py:153: AssertionError"}, "teardown": {"duration": 0.0007911212742328644, "outcome": "passed"}}, {"nodeid": "tests/api/test_logbook_global.py::test_logbook_time_range[2020-01-01T00:00:00Z-2020-01-01T00:00:01Z-True]", "lineno": 141, "outcome": "failed", "keywords": ["test_logbook_time_range[2020-01-01T00:00:00Z-2020-01-01T00:00:01Z-True]", "parametrize", "pytestmark", "2020-01-01T00:00:00Z-2020-01-01T00:00:01Z-True", "test_logbook_global.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.00524362875148654, "outcome": "passed"}, "call": {"duration": 0.002959595061838627, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_logbook_global.py", "lineno": 153, "message": "assert 404 == 200\n +  where 404 = <Response [404 Not Found]>.status_code"}, "traceback": [{"path": "tests/api/test_logbook_global.py", "lineno": 153, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0619e20>\nstart = '2020-01-01T00:00:00Z', end = '2020-01-01T00:00:01Z'\nexpect_empty = True\n\n    @pytest.mark.parametrize(\"start,end,expect_empty\", [\n        (\"2020-01-01T00:00:00Z\", \"2030-01-01T00:00:00Z\", False),\n        (\"2020-01-01T00:00:00Z\", \"2020-01-01T00:00:01Z\", True),\n    ])\n    async def test_logbook_time_range(rest, start, end, expect_empty):\n        \"\"\"GET /api/logbook with time range returns expected results.\"\"\"\n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/logbook\",\n            params={\"start\": start, \"end\": end},\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 404 == 200\nE        +  where 404 = <Response [404 Not Found]>.status_code\n\ntests/api/test_logbook_global.py:153: AssertionError"}, "teardown": {"duration": 0.0006421562284231186, "outcome": "passed"}}, {"nodeid": "tests/api/test_logbook_global.py::test_logbook_entity_captures_changes", "lineno": 162, "outcome": "failed", "keywords": ["test_logbook_entity_captures_changes", "test_logbook_global.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.0052530281245708466, "outcome": "passed"}, "call": {"duration": 0.5085520460270345, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)"}, "traceback": [{"path": "tests/api/test_logbook_global.py", "lineno": 178, "message": ""}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 832, "message": "in json"}, {"path": "../../anaconda3/lib/python3.9/json/__init__.py", "lineno": 346, "message": "in loads"}, {"path": "../../anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "JSONDecodeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b06191f0>\n\n    async def test_logbook_entity_captures_changes(rest):\n        \"\"\"Logbook entries exist after state changes (with recorder flush).\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"sensor.logbc_{tag}\"\n        await rest.set_state(eid, \"first\")\n        await rest.set_state(eid, \"second\")\n        await rest.set_state(eid, \"third\")\n    \n        # Wait for async recorder to flush\n        await asyncio.sleep(0.5)\n    \n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/logbook/{eid}\",\n            headers=rest._headers(),\n        )\n>       data = resp.json()\n\ntests/api/test_logbook_global.py:178: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:832: in json\n    return jsonlib.loads(self.content, **kwargs)\n../../anaconda3/lib/python3.9/json/__init__.py:346: in loads\n    return _default_decoder.decode(s)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <json.decoder.JSONDecoder object at 0x7f47b2e5fe50>, s = '404: Not Found'\n_w = <built-in method match of re.Pattern object at 0x7f47b3015cf0>\n\n    def decode(self, s, _w=WHITESPACE.match):\n        \"\"\"Return the Python representation of ``s`` (a ``str`` instance\n        containing a JSON document).\n    \n        \"\"\"\n        obj, end = self.raw_decode(s, idx=_w(s, 0).end())\n        end = _w(s, end).end()\n        if end != len(s):\n>           raise JSONDecodeError(\"Extra data\", s, end)\nE           json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)\n\n../../anaconda3/lib/python3.9/json/decoder.py:340: JSONDecodeError"}, "teardown": {"duration": 0.0006739553064107895, "outcome": "passed"}}, {"nodeid": "tests/api/test_logbook_global.py::test_logbook_per_entity_filtered", "lineno": 186, "outcome": "failed", "keywords": ["test_logbook_per_entity_filtered", "test_logbook_global.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005497129168361425, "outcome": "passed"}, "call": {"duration": 0.40772510971874, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_logbook_global.py", "lineno": 200, "message": "assert 404 == 200\n +  where 404 = <Response [404 Not Found]>.status_code"}, "traceback": [{"path": "tests/api/test_logbook_global.py", "lineno": 200, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b07611c0>\n\n    async def test_logbook_per_entity_filtered(rest):\n        \"\"\"GET /api/logbook/:entity_id returns entries only for that entity.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"sensor.lb_per_{tag}\"\n        await rest.set_state(eid, \"alpha\")\n        await asyncio.sleep(0.2)\n        await rest.set_state(eid, \"beta\")\n        await asyncio.sleep(0.2)\n    \n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/logbook/{eid}\",\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 404 == 200\nE        +  where 404 = <Response [404 Not Found]>.status_code\n\ntests/api/test_logbook_global.py:200: AssertionError"}, "teardown": {"duration": 0.0007191728800535202, "outcome": "passed"}}, {"nodeid": "tests/api/test_logbook_global.py::test_statistics_numeric_entity", "lineno": 206, "outcome": "failed", "keywords": ["test_statistics_numeric_entity", "test_logbook_global.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005489174742251635, "outcome": "passed"}, "call": {"duration": 0.7788675711490214, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_logbook_global.py", "lineno": 217, "message": "assert 404 == 200\n +  where 404 = <Response [404 Not Found]>.status_code"}, "traceback": [{"path": "tests/api/test_logbook_global.py", "lineno": 217, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0aa33a0>\n\n    async def test_statistics_numeric_entity(rest):\n        \"\"\"Statistics for numeric entity returns aggregates.\"\"\"\n        for val in [\"10\", \"20\", \"30\", \"40\", \"50\"]:\n            await rest.set_state(\"sensor.stat_numeric\", val)\n            await asyncio.sleep(0.15)\n    \n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/statistics/sensor.stat_numeric\",\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 404 == 200\nE        +  where 404 = <Response [404 Not Found]>.status_code\n\ntests/api/test_logbook_global.py:217: AssertionError"}, "teardown": {"duration": 0.001824905164539814, "outcome": "passed"}}, {"nodeid": "tests/api/test_logbook_global.py::test_history_with_start_param", "lineno": 227, "outcome": "failed", "keywords": ["test_history_with_start_param", "test_logbook_global.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.007612193003296852, "outcome": "passed"}, "call": {"duration": 0.15595838567242026, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_logbook_global.py", "lineno": 242, "message": "assert 404 == 200\n +  where 404 = <Response [404 Not Found]>.status_code"}, "traceback": [{"path": "tests/api/test_logbook_global.py", "lineno": 242, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0aa3520>\n\n    async def test_history_with_start_param(rest):\n        \"\"\"History with start= returns entries after that time.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        entity = f\"sensor.hist_param_start_{tag}\"\n        await rest.set_state(entity, \"v1\")\n        await asyncio.sleep(0.15)\n    \n        now = datetime.now(timezone.utc)\n        start = (now - timedelta(hours=1)).isoformat()\n    \n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/history/period/{entity}?start={start}\",\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 404 == 200\nE        +  where 404 = <Response [404 Not Found]>.status_code\n\ntests/api/test_logbook_global.py:242: AssertionError"}, "teardown": {"duration": 0.0007199086248874664, "outcome": "passed"}}, {"nodeid": "tests/api/test_logbook_global.py::test_history_with_start_and_end", "lineno": 246, "outcome": "failed", "keywords": ["test_history_with_start_and_end", "test_logbook_global.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005167866125702858, "outcome": "passed"}, "call": {"duration": 0.15520191099494696, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_logbook_global.py", "lineno": 262, "message": "assert 404 == 200\n +  where 404 = <Response [404 Not Found]>.status_code"}, "traceback": [{"path": "tests/api/test_logbook_global.py", "lineno": 262, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b05334f0>\n\n    async def test_history_with_start_and_end(rest):\n        \"\"\"History with start= and end= returns bounded entries.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        entity = f\"sensor.hist_param_range_{tag}\"\n        await rest.set_state(entity, \"r1\")\n        await asyncio.sleep(0.15)\n    \n        now = datetime.now(timezone.utc)\n        start = (now - timedelta(hours=1)).isoformat()\n        end = (now + timedelta(hours=1)).isoformat()\n    \n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/history/period/{entity}?start={start}&end={end}\",\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 404 == 200\nE        +  where 404 = <Response [404 Not Found]>.status_code\n\ntests/api/test_logbook_global.py:262: AssertionError"}, "teardown": {"duration": 0.0006704637780785561, "outcome": "passed"}}, {"nodeid": "tests/api/test_logbook_global.py::test_history_narrow_window_empty", "lineno": 266, "outcome": "failed", "keywords": ["test_history_narrow_window_empty", "test_logbook_global.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005083022173494101, "outcome": "passed"}, "call": {"duration": 0.15582518000155687, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_logbook_global.py", "lineno": 282, "message": "assert 404 == 200\n +  where 404 = <Response [404 Not Found]>.status_code"}, "traceback": [{"path": "tests/api/test_logbook_global.py", "lineno": 282, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0851490>\n\n    async def test_history_narrow_window_empty(rest):\n        \"\"\"History with very narrow old window returns no entries.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        entity = f\"sensor.hist_param_narrow_{tag}\"\n        await rest.set_state(entity, \"n1\")\n        await asyncio.sleep(0.15)\n    \n        now = datetime.now(timezone.utc)\n        start = (now - timedelta(days=30)).isoformat()\n        end = (now - timedelta(days=29)).isoformat()\n    \n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/history/period/{entity}?start={start}&end={end}\",\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 404 == 200\nE        +  where 404 = <Response [404 Not Found]>.status_code\n\ntests/api/test_logbook_global.py:282: AssertionError"}, "teardown": {"duration": 0.00077035091817379, "outcome": "passed"}}, {"nodeid": "tests/api/test_logbook_global.py::test_history_entity_has_all_fields", "lineno": 286, "outcome": "failed", "keywords": ["test_history_entity_has_all_fields", "test_logbook_global.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005897240713238716, "outcome": "passed"}, "call": {"duration": 0.155702686868608, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)"}, "traceback": [{"path": "tests/api/test_logbook_global.py", "lineno": 298, "message": ""}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 832, "message": "in json"}, {"path": "../../anaconda3/lib/python3.9/json/__init__.py", "lineno": 346, "message": "in loads"}, {"path": "../../anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "JSONDecodeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0ac2e20>\n\n    async def test_history_entity_has_all_fields(rest):\n        \"\"\"History entries include entity_id, state, attributes, last_changed.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        entity = f\"sensor.hist_param_fields_{tag}\"\n        await rest.set_state(entity, \"42\", {\"unit\": \"C\"})\n        await asyncio.sleep(0.15)\n    \n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/history/period/{entity}\",\n            headers=rest._headers(),\n        )\n>       data = resp.json()\n\ntests/api/test_logbook_global.py:298: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:832: in json\n    return jsonlib.loads(self.content, **kwargs)\n../../anaconda3/lib/python3.9/json/__init__.py:346: in loads\n    return _default_decoder.decode(s)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <json.decoder.JSONDecoder object at 0x7f47b2e5fe50>, s = '404: Not Found'\n_w = <built-in method match of re.Pattern object at 0x7f47b3015cf0>\n\n    def decode(self, s, _w=WHITESPACE.match):\n        \"\"\"Return the Python representation of ``s`` (a ``str`` instance\n        containing a JSON document).\n    \n        \"\"\"\n        obj, end = self.raw_decode(s, idx=_w(s, 0).end())\n        end = _w(s, end).end()\n        if end != len(s):\n>           raise JSONDecodeError(\"Extra data\", s, end)\nE           json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)\n\n../../anaconda3/lib/python3.9/json/decoder.py:340: JSONDecodeError"}, "teardown": {"duration": 0.0009000720456242561, "outcome": "passed"}}, {"nodeid": "tests/api/test_logbook_global.py::test_history_nonexistent_entity_empty", "lineno": 306, "outcome": "failed", "keywords": ["test_history_nonexistent_entity_empty", "test_logbook_global.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.007381905801594257, "outcome": "passed"}, "call": {"duration": 0.003636930137872696, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_logbook_global.py", "lineno": 313, "message": "assert 404 == 200\n +  where 404 = <Response [404 Not Found]>.status_code"}, "traceback": [{"path": "tests/api/test_logbook_global.py", "lineno": 313, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b073a3d0>\n\n    async def test_history_nonexistent_entity_empty(rest):\n        \"\"\"History for nonexistent entity returns empty list.\"\"\"\n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/history/period/sensor.nonexistent_hist_xyz\",\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 404 == 200\nE        +  where 404 = <Response [404 Not Found]>.status_code\n\ntests/api/test_logbook_global.py:313: AssertionError"}, "teardown": {"duration": 0.0007702461443841457, "outcome": "passed"}}, {"nodeid": "tests/api/test_mqtt_bridge_topics.py::test_mqtt_sensor_state_update", "lineno": 47, "outcome": "passed", "keywords": ["test_mqtt_sensor_state_update", "test_mqtt_bridge_topics.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.0005318117327988148, "outcome": "passed"}, "call": {"duration": 1.321654120925814, "outcome": "passed"}, "teardown": {"duration": 0.0005838330835103989, "outcome": "passed"}}, {"nodeid": "tests/api/test_mqtt_bridge_topics.py::test_mqtt_binary_sensor_state", "lineno": 58, "outcome": "passed", "keywords": ["test_mqtt_binary_sensor_state", "test_mqtt_bridge_topics.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.0005713319405913353, "outcome": "passed"}, "call": {"duration": 1.3102274197153747, "outcome": "passed"}, "teardown": {"duration": 0.0003590220585465431, "outcome": "passed"}}, {"nodeid": "tests/api/test_mqtt_bridge_topics.py::test_mqtt_switch_on_off", "lineno": 69, "outcome": "passed", "keywords": ["test_mqtt_switch_on_off", "test_mqtt_bridge_topics.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.0003821812570095062, "outcome": "passed"}, "call": {"duration": 2.661028218921274, "outcome": "passed"}, "teardown": {"duration": 0.0008564149029552937, "outcome": "passed"}}, {"nodeid": "tests/api/test_mqtt_bridge_topics.py::test_mqtt_preserves_attributes", "lineno": 85, "outcome": "passed", "keywords": ["test_mqtt_preserves_attributes", "test_mqtt_bridge_topics.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.000730627216398716, "outcome": "passed"}, "call": {"duration": 1.322248661890626, "outcome": "passed"}, "teardown": {"duration": 0.000398796983063221, "outcome": "passed"}}, {"nodeid": "tests/api/test_mqtt_bridge_topics.py::test_mqtt_non_matching_topic_ignored", "lineno": 101, "outcome": "passed", "keywords": ["test_mqtt_non_matching_topic_ignored", "test_mqtt_bridge_topics.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.00043229665607213974, "outcome": "passed"}, "call": {"duration": 1.3190237390808761, "outcome": "passed"}, "teardown": {"duration": 0.0005085160955786705, "outcome": "passed"}}, {"nodeid": "tests/api/test_mqtt_bridge_topics.py::test_mqtt_light_domain", "lineno": 111, "outcome": "passed", "keywords": ["test_mqtt_light_domain", "test_mqtt_bridge_topics.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.00058358209207654, "outcome": "passed"}, "call": {"duration": 1.3359075766056776, "outcome": "passed"}, "teardown": {"duration": 0.00047093024477362633, "outcome": "passed"}}, {"nodeid": "tests/api/test_mqtt_bridge_topics.py::test_mqtt_multiple_domains", "lineno": 122, "outcome": "passed", "keywords": ["test_mqtt_multiple_domains", "test_mqtt_bridge_topics.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.0008135149255394936, "outcome": "passed"}, "call": {"duration": 6.088980759959668, "outcome": "passed"}, "teardown": {"duration": 0.0006202398799359798, "outcome": "passed"}}, {"nodeid": "tests/api/test_mqtt_discovery.py::test_discovery_sensor", "lineno": 43, "outcome": "passed", "keywords": ["test_discovery_sensor", "asyncio", "pytestmark", "test_mqtt_discovery.py", "api", "tests", "marge", ""], "setup": {"duration": 0.0007284712046384811, "outcome": "passed"}, "call": {"duration": 1.5163719565607607, "outcome": "passed"}, "teardown": {"duration": 0.0005668937228620052, "outcome": "passed"}}, {"nodeid": "tests/api/test_mqtt_discovery.py::test_discovery_sensor_state_update", "lineno": 63, "outcome": "passed", "keywords": ["test_discovery_sensor_state_update", "asyncio", "pytestmark", "test_mqtt_discovery.py", "api", "tests", "marge", ""], "setup": {"duration": 0.0005860798992216587, "outcome": "passed"}, "call": {"duration": 3.026595081668347, "outcome": "passed"}, "teardown": {"duration": 0.0005187038332223892, "outcome": "passed"}}, {"nodeid": "tests/api/test_mqtt_discovery.py::test_discovery_binary_sensor", "lineno": 86, "outcome": "passed", "keywords": ["test_discovery_binary_sensor", "asyncio", "pytestmark", "test_mqtt_discovery.py", "api", "tests", "marge", ""], "setup": {"duration": 0.000559614971280098, "outcome": "passed"}, "call": {"duration": 1.51459635887295, "outcome": "passed"}, "teardown": {"duration": 0.00047175725921988487, "outcome": "passed"}}, {"nodeid": "tests/api/test_mqtt_discovery.py::test_discovery_light", "lineno": 107, "outcome": "passed", "keywords": ["test_discovery_light", "asyncio", "pytestmark", "test_mqtt_discovery.py", "api", "tests", "marge", ""], "setup": {"duration": 0.0005631353706121445, "outcome": "passed"}, "call": {"duration": 1.516305907163769, "outcome": "passed"}, "teardown": {"duration": 0.0003597610630095005, "outcome": "passed"}}, {"nodeid": "tests/api/test_mqtt_discovery.py::test_discovery_switch", "lineno": 126, "outcome": "passed", "keywords": ["test_discovery_switch", "asyncio", "pytestmark", "test_mqtt_discovery.py", "api", "tests", "marge", ""], "setup": {"duration": 0.00039211707189679146, "outcome": "passed"}, "call": {"duration": 1.5113431639038026, "outcome": "passed"}, "teardown": {"duration": 0.00036126794293522835, "outcome": "passed"}}, {"nodeid": "tests/api/test_mqtt_discovery.py::test_discovery_climate", "lineno": 145, "outcome": "passed", "keywords": ["test_discovery_climate", "asyncio", "pytestmark", "test_mqtt_discovery.py", "api", "tests", "marge", ""], "setup": {"duration": 0.00042828498408198357, "outcome": "passed"}, "call": {"duration": 1.5201879423111677, "outcome": "passed"}, "teardown": {"duration": 0.00043774861842393875, "outcome": "passed"}}, {"nodeid": "tests/api/test_mqtt_discovery.py::test_discovery_cover", "lineno": 167, "outcome": "passed", "keywords": ["test_discovery_cover", "asyncio", "pytestmark", "test_mqtt_discovery.py", "api", "tests", "marge", ""], "setup": {"duration": 0.0005356511101126671, "outcome": "passed"}, "call": {"duration": 1.5104405893944204, "outcome": "passed"}, "teardown": {"duration": 0.00036404840648174286, "outcome": "passed"}}, {"nodeid": "tests/api/test_mqtt_discovery.py::test_discovery_lock", "lineno": 186, "outcome": "passed", "keywords": ["test_discovery_lock", "asyncio", "pytestmark", "test_mqtt_discovery.py", "api", "tests", "marge", ""], "setup": {"duration": 0.000385957770049572, "outcome": "passed"}, "call": {"duration": 1.5221709427423775, "outcome": "passed"}, "teardown": {"duration": 0.0005077668465673923, "outcome": "passed"}}, {"nodeid": "tests/api/test_mqtt_discovery.py::test_discovery_with_device_info", "lineno": 207, "outcome": "passed", "keywords": ["test_discovery_with_device_info", "asyncio", "pytestmark", "test_mqtt_discovery.py", "api", "tests", "marge", ""], "setup": {"duration": 0.0005741962231695652, "outcome": "passed"}, "call": {"duration": 1.5109523287974298, "outcome": "passed"}, "teardown": {"duration": 0.00034590112045407295, "outcome": "passed"}}, {"nodeid": "tests/api/test_mqtt_discovery.py::test_discovery_5_part_topic", "lineno": 231, "outcome": "passed", "keywords": ["test_discovery_5_part_topic", "asyncio", "pytestmark", "test_mqtt_discovery.py", "api", "tests", "marge", ""], "setup": {"duration": 0.0004173438064754009, "outcome": "passed"}, "call": {"duration": 1.5190291688777506, "outcome": "passed"}, "teardown": {"duration": 0.0005370150320231915, "outcome": "passed"}}, {"nodeid": "tests/api/test_mqtt_discovery.py::test_discovery_empty_payload_removes_entity", "lineno": 249, "outcome": "passed", "keywords": ["test_discovery_empty_payload_removes_entity", "asyncio", "pytestmark", "test_mqtt_discovery.py", "api", "tests", "marge", ""], "setup": {"duration": 0.0006300751119852066, "outcome": "passed"}, "call": {"duration": 3.0333255641162395, "outcome": "passed"}, "teardown": {"duration": 0.0006580785848200321, "outcome": "passed"}}, {"nodeid": "tests/api/test_mqtt_discovery.py::test_discovery_value_template", "lineno": 276, "outcome": "passed", "keywords": ["test_discovery_value_template", "asyncio", "pytestmark", "test_mqtt_discovery.py", "api", "tests", "marge", ""], "setup": {"duration": 0.0006620273925364017, "outcome": "passed"}, "call": {"duration": 3.0281918682157993, "outcome": "passed"}, "teardown": {"duration": 0.0005044238641858101, "outcome": "passed"}}, {"nodeid": "tests/api/test_mqtt_entity_command_bridge.py::test_mqtt_state_topic_creates_entity", "lineno": 34, "outcome": "failed", "keywords": ["test_mqtt_state_topic_creates_entity", "test_mqtt_entity_command_bridge.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.007715824991464615, "outcome": "passed"}, "call": {"duration": 1.005996264051646, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_mqtt_entity_command_bridge.py", "lineno": 41, "message": "assert None is not None"}, "traceback": [{"path": "tests/api/test_mqtt_entity_command_bridge.py", "lineno": 41, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b085b820>\n\n    async def test_mqtt_state_topic_creates_entity(rest):\n        \"\"\"Publishing to home/{domain}/{id}/state creates entity.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        _publish_and_wait(f\"home/sensor/mqtt_test_{tag}/state\", \"42\")\n    \n        state = await rest.get_state(f\"sensor.mqtt_test_{tag}\")\n>       assert state is not None\nE       assert None is not None\n\ntests/api/test_mqtt_entity_command_bridge.py:41: AssertionError"}, "teardown": {"duration": 0.0008990447968244553, "outcome": "passed"}}, {"nodeid": "tests/api/test_mqtt_entity_command_bridge.py::test_mqtt_binary_sensor_state", "lineno": 44, "outcome": "failed", "keywords": ["test_mqtt_binary_sensor_state", "test_mqtt_entity_command_bridge.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.007812554016709328, "outcome": "passed"}, "call": {"duration": 1.0062809432856739, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_mqtt_entity_command_bridge.py", "lineno": 51, "message": "assert None is not None"}, "traceback": [{"path": "tests/api/test_mqtt_entity_command_bridge.py", "lineno": 51, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b096e670>\n\n    async def test_mqtt_binary_sensor_state(rest):\n        \"\"\"Publishing to home/binary_sensor/x/state creates binary_sensor.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        _publish_and_wait(f\"home/binary_sensor/mqtt_bs_{tag}/state\", \"on\")\n    \n        state = await rest.get_state(f\"binary_sensor.mqtt_bs_{tag}\")\n>       assert state is not None\nE       assert None is not None\n\ntests/api/test_mqtt_entity_command_bridge.py:51: AssertionError"}, "teardown": {"duration": 0.0010896283201873302, "outcome": "passed"}}, {"nodeid": "tests/api/test_mqtt_entity_command_bridge.py::test_mqtt_switch_state", "lineno": 54, "outcome": "failed", "keywords": ["test_mqtt_switch_state", "test_mqtt_entity_command_bridge.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.007654386106878519, "outcome": "passed"}, "call": {"duration": 1.007543422281742, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_mqtt_entity_command_bridge.py", "lineno": 61, "message": "assert None is not None"}, "traceback": [{"path": "tests/api/test_mqtt_entity_command_bridge.py", "lineno": 61, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b08fbdf0>\n\n    async def test_mqtt_switch_state(rest):\n        \"\"\"Publishing to home/switch/x/state creates switch entity.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        _publish_and_wait(f\"home/switch/mqtt_sw_{tag}/state\", \"off\")\n    \n        state = await rest.get_state(f\"switch.mqtt_sw_{tag}\")\n>       assert state is not None\nE       assert None is not None\n\ntests/api/test_mqtt_entity_command_bridge.py:61: AssertionError"}, "teardown": {"duration": 0.0010869796387851238, "outcome": "passed"}}, {"nodeid": "tests/api/test_mqtt_entity_command_bridge.py::test_mqtt_state_update_preserves_attributes", "lineno": 64, "outcome": "failed", "keywords": ["test_mqtt_state_update_preserves_attributes", "test_mqtt_entity_command_bridge.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.008024090901017189, "outcome": "passed"}, "call": {"duration": 1.0080403960309923, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_mqtt_entity_command_bridge.py", "lineno": 76, "message": "AssertionError: assert 'initial' == 'updated'\n  \n  - updated\n  + initial"}, "traceback": [{"path": "tests/api/test_mqtt_entity_command_bridge.py", "lineno": 76, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0a88070>\n\n    async def test_mqtt_state_update_preserves_attributes(rest):\n        \"\"\"MQTT state update preserves existing attributes.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"sensor.mqtt_attr_{tag}\"\n        # Set entity with attributes via REST\n        await rest.set_state(eid, \"initial\", {\"unit\": \"C\", \"friendly_name\": \"MQTT Test\"})\n    \n        # Update via MQTT\n        _publish_and_wait(f\"home/sensor/mqtt_attr_{tag}/state\", \"updated\")\n    \n        state = await rest.get_state(eid)\n>       assert state[\"state\"] == \"updated\"\nE       AssertionError: assert 'initial' == 'updated'\nE         \nE         - updated\nE         + initial\n\ntests/api/test_mqtt_entity_command_bridge.py:76: AssertionError"}, "teardown": {"duration": 0.0007634828798472881, "outcome": "passed"}}, {"nodeid": "tests/api/test_mqtt_entity_command_bridge.py::test_mqtt_sequential_updates", "lineno": 80, "outcome": "failed", "keywords": ["test_mqtt_sequential_updates", "test_mqtt_entity_command_bridge.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.012147139757871628, "outcome": "passed"}, "call": {"duration": 5.015824037138373, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_mqtt_entity_command_bridge.py", "lineno": 89, "message": "TypeError: 'NoneType' object is not subscriptable"}, "traceback": [{"path": "tests/api/test_mqtt_entity_command_bridge.py", "lineno": 89, "message": "TypeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0a006d0>\n\n    async def test_mqtt_sequential_updates(rest):\n        \"\"\"Multiple MQTT updates result in last value.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"sensor.mqtt_seq_{tag}\"\n        for i in range(5):\n            _publish_and_wait(f\"home/sensor/mqtt_seq_{tag}/state\", str(i), wait=0.2)\n    \n        state = await rest.get_state(eid)\n>       assert state[\"state\"] == \"4\"\nE       TypeError: 'NoneType' object is not subscriptable\n\ntests/api/test_mqtt_entity_command_bridge.py:89: TypeError"}, "teardown": {"duration": 0.0007450506091117859, "outcome": "passed"}}, {"nodeid": "tests/api/test_mqtt_entity_command_bridge.py::test_mqtt_non_state_topic_ignored", "lineno": 91, "outcome": "passed", "keywords": ["test_mqtt_non_state_topic_ignored", "test_mqtt_entity_command_bridge.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.007430573925375938, "outcome": "passed"}, "call": {"duration": 1.006659016944468, "outcome": "passed"}, "teardown": {"duration": 0.0008203857578337193, "outcome": "passed"}}, {"nodeid": "tests/api/test_mqtt_entity_command_bridge.py::test_mqtt_light_domain", "lineno": 101, "outcome": "failed", "keywords": ["test_mqtt_light_domain", "test_mqtt_entity_command_bridge.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.007552933879196644, "outcome": "passed"}, "call": {"duration": 1.0091453832574189, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_mqtt_entity_command_bridge.py", "lineno": 108, "message": "assert None is not None"}, "traceback": [{"path": "tests/api/test_mqtt_entity_command_bridge.py", "lineno": 108, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0ac23d0>\n\n    async def test_mqtt_light_domain(rest):\n        \"\"\"Publishing to home/light/x/state creates light entity.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        _publish_and_wait(f\"home/light/mqtt_lt_{tag}/state\", \"on\")\n    \n        state = await rest.get_state(f\"light.mqtt_lt_{tag}\")\n>       assert state is not None\nE       assert None is not None\n\ntests/api/test_mqtt_entity_command_bridge.py:108: AssertionError"}, "teardown": {"duration": 0.0007657380774617195, "outcome": "passed"}}, {"nodeid": "tests/api/test_mqtt_entity_command_bridge.py::test_mqtt_numeric_state", "lineno": 111, "outcome": "failed", "keywords": ["test_mqtt_numeric_state", "test_mqtt_entity_command_bridge.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.00759153300896287, "outcome": "passed"}, "call": {"duration": 1.0063636270351708, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_mqtt_entity_command_bridge.py", "lineno": 118, "message": "TypeError: 'NoneType' object is not subscriptable"}, "traceback": [{"path": "tests/api/test_mqtt_entity_command_bridge.py", "lineno": 118, "message": "TypeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b062f670>\n\n    async def test_mqtt_numeric_state(rest):\n        \"\"\"MQTT numeric state stored as string.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        _publish_and_wait(f\"home/sensor/mqtt_num_{tag}/state\", \"98.6\")\n    \n        state = await rest.get_state(f\"sensor.mqtt_num_{tag}\")\n>       assert state[\"state\"] == \"98.6\"\nE       TypeError: 'NoneType' object is not subscriptable\n\ntests/api/test_mqtt_entity_command_bridge.py:118: TypeError"}, "teardown": {"duration": 0.0007420321926474571, "outcome": "passed"}}, {"nodeid": "tests/api/test_mqtt_entity_command_bridge.py::test_mqtt_state_triggers_automation", "lineno": 120, "outcome": "failed", "keywords": ["test_mqtt_state_triggers_automation", "test_mqtt_entity_command_bridge.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.007564867381006479, "outcome": "passed"}, "call": {"duration": 2.1192771680653095, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_mqtt_entity_command_bridge.py", "lineno": 137, "message": "AssertionError: assert 'locked' == 'unlocked'\n  \n  - unlocked\n  ? --\n  + locked"}, "traceback": [{"path": "tests/api/test_mqtt_entity_command_bridge.py", "lineno": 137, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b1be34c0>\n\n    async def test_mqtt_state_triggers_automation(rest):\n        \"\"\"MQTT state update can trigger state-based automations.\"\"\"\n        # Set up: ensure smoke_co_emergency is enabled, door locked\n        await rest.set_state(\"binary_sensor.smoke_detector\", \"off\")\n        await rest.set_state(\"lock.front_door\", \"locked\")\n        await rest.call_service(\"automation\", \"turn_on\", {\n            \"entity_id\": \"automation.smoke_co_emergency\"\n        })\n        await asyncio.sleep(0.1)\n    \n        # Trigger via MQTT\n        _publish_and_wait(\n            \"home/binary_sensor/smoke_detector/state\", \"on\", wait=1.0\n        )\n    \n        state = await rest.get_state(\"lock.front_door\")\n>       assert state[\"state\"] == \"unlocked\"\nE       AssertionError: assert 'locked' == 'unlocked'\nE         \nE         - unlocked\nE         ? --\nE         + locked\n\ntests/api/test_mqtt_entity_command_bridge.py:137: AssertionError"}, "teardown": {"duration": 0.0013905568048357964, "outcome": "passed"}}, {"nodeid": "tests/api/test_notification_lifecycle.py::test_notification_create_via_service", "lineno": 17, "outcome": "failed", "keywords": ["test_notification_create_via_service", "test_notification_lifecycle.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.00856019090861082, "outcome": "passed"}, "call": {"duration": 0.20694736018776894, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_notification_lifecycle.py", "lineno": 31, "message": "assert 404 == 200\n +  where 404 = <Response [404 Not Found]>.status_code"}, "traceback": [{"path": "tests/api/test_notification_lifecycle.py", "lineno": 31, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b088b730>\n\n    async def test_notification_create_via_service(rest):\n        \"\"\"Create notification via service call.\"\"\"\n        await rest.call_service(\"persistent_notification\", \"create\", {\n            \"notification_id\": \"notif_lc_1\",\n            \"title\": \"Test Alert\",\n            \"message\": \"Something happened\",\n        })\n        await asyncio.sleep(0.2)\n    \n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/notifications\",\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 404 == 200\nE        +  where 404 = <Response [404 Not Found]>.status_code\n\ntests/api/test_notification_lifecycle.py:31: AssertionError"}, "teardown": {"duration": 0.0008181161247193813, "outcome": "passed"}}, {"nodeid": "tests/api/test_notification_lifecycle.py::test_notification_has_fields", "lineno": 36, "outcome": "failed", "keywords": ["test_notification_has_fields", "test_notification_lifecycle.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.009236501064151525, "outcome": "passed"}, "call": {"duration": 0.20613239333033562, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)"}, "traceback": [{"path": "tests/api/test_notification_lifecycle.py", "lineno": 50, "message": ""}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 832, "message": "in json"}, {"path": "../../anaconda3/lib/python3.9/json/__init__.py", "lineno": 346, "message": "in loads"}, {"path": "../../anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "JSONDecodeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0734dc0>\n\n    async def test_notification_has_fields(rest):\n        \"\"\"Notification includes title and message fields.\"\"\"\n        await rest.call_service(\"persistent_notification\", \"create\", {\n            \"notification_id\": \"notif_lc_fields\",\n            \"title\": \"Field Test\",\n            \"message\": \"Body text here\",\n        })\n        await asyncio.sleep(0.2)\n    \n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/notifications\",\n            headers=rest._headers(),\n        )\n>       notifs = resp.json()\n\ntests/api/test_notification_lifecycle.py:50: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:832: in json\n    return jsonlib.loads(self.content, **kwargs)\n../../anaconda3/lib/python3.9/json/__init__.py:346: in loads\n    return _default_decoder.decode(s)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <json.decoder.JSONDecoder object at 0x7f47b2e5fe50>, s = '404: Not Found'\n_w = <built-in method match of re.Pattern object at 0x7f47b3015cf0>\n\n    def decode(self, s, _w=WHITESPACE.match):\n        \"\"\"Return the Python representation of ``s`` (a ``str`` instance\n        containing a JSON document).\n    \n        \"\"\"\n        obj, end = self.raw_decode(s, idx=_w(s, 0).end())\n        end = _w(s, end).end()\n        if end != len(s):\n>           raise JSONDecodeError(\"Extra data\", s, end)\nE           json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)\n\n../../anaconda3/lib/python3.9/json/decoder.py:340: JSONDecodeError"}, "teardown": {"duration": 0.0007165768183767796, "outcome": "passed"}}, {"nodeid": "tests/api/test_notification_lifecycle.py::test_notification_dismiss_by_id", "lineno": 56, "outcome": "failed", "keywords": ["test_notification_dismiss_by_id", "test_notification_lifecycle.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005259646102786064, "outcome": "passed"}, "call": {"duration": 0.2058247309178114, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_notification_lifecycle.py", "lineno": 71, "message": "assert 404 == 200\n +  where 404 = <Response [404 Not Found]>.status_code"}, "traceback": [{"path": "tests/api/test_notification_lifecycle.py", "lineno": 71, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b08fbd90>\n\n    async def test_notification_dismiss_by_id(rest):\n        \"\"\"Dismiss specific notification by ID.\"\"\"\n        await rest.call_service(\"persistent_notification\", \"create\", {\n            \"notification_id\": \"notif_lc_dismiss\",\n            \"title\": \"Dismiss Me\",\n            \"message\": \"Will be dismissed\",\n        })\n        await asyncio.sleep(0.2)\n    \n        resp = await rest.client.post(\n            f\"{rest.base_url}/api/notifications/notif_lc_dismiss/dismiss\",\n            json={},\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 404 == 200\nE        +  where 404 = <Response [404 Not Found]>.status_code\n\ntests/api/test_notification_lifecycle.py:71: AssertionError"}, "teardown": {"duration": 0.0009045517072081566, "outcome": "passed"}}, {"nodeid": "tests/api/test_notification_lifecycle.py::test_notification_dismiss_all", "lineno": 82, "outcome": "failed", "keywords": ["test_notification_dismiss_all", "test_notification_lifecycle.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.007152768317610025, "outcome": "passed"}, "call": {"duration": 0.21233514696359634, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_notification_lifecycle.py", "lineno": 99, "message": "assert 404 == 200\n +  where 404 = <Response [404 Not Found]>.status_code"}, "traceback": [{"path": "tests/api/test_notification_lifecycle.py", "lineno": 99, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b07317f0>\n\n    async def test_notification_dismiss_all(rest):\n        \"\"\"Dismiss all notifications.\"\"\"\n        # Create a few\n        for i in range(3):\n            await rest.call_service(\"persistent_notification\", \"create\", {\n                \"notification_id\": f\"notif_lc_all_{i}\",\n                \"title\": f\"Alert {i}\",\n                \"message\": f\"Message {i}\",\n            })\n        await asyncio.sleep(0.2)\n    \n        resp = await rest.client.post(\n            f\"{rest.base_url}/api/notifications/dismiss_all\",\n            json={},\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 404 == 200\nE        +  where 404 = <Response [404 Not Found]>.status_code\n\ntests/api/test_notification_lifecycle.py:99: AssertionError"}, "teardown": {"duration": 0.0013073370791971684, "outcome": "passed"}}, {"nodeid": "tests/api/test_notification_lifecycle.py::test_notification_overwrite", "lineno": 109, "outcome": "failed", "keywords": ["test_notification_overwrite", "test_notification_lifecycle.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.0074183582328259945, "outcome": "passed"}, "call": {"duration": 0.4107718747109175, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)"}, "traceback": [{"path": "tests/api/test_notification_lifecycle.py", "lineno": 130, "message": ""}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 832, "message": "in json"}, {"path": "../../anaconda3/lib/python3.9/json/__init__.py", "lineno": 346, "message": "in loads"}, {"path": "../../anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "JSONDecodeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b06e98b0>\n\n    async def test_notification_overwrite(rest):\n        \"\"\"Creating notification with same ID overwrites it.\"\"\"\n        await rest.call_service(\"persistent_notification\", \"create\", {\n            \"notification_id\": \"notif_lc_overwrite\",\n            \"title\": \"Original\",\n            \"message\": \"First message\",\n        })\n        await asyncio.sleep(0.2)\n    \n        await rest.call_service(\"persistent_notification\", \"create\", {\n            \"notification_id\": \"notif_lc_overwrite\",\n            \"title\": \"Updated\",\n            \"message\": \"Second message\",\n        })\n        await asyncio.sleep(0.2)\n    \n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/notifications\",\n            headers=rest._headers(),\n        )\n>       notifs = resp.json()\n\ntests/api/test_notification_lifecycle.py:130: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:832: in json\n    return jsonlib.loads(self.content, **kwargs)\n../../anaconda3/lib/python3.9/json/__init__.py:346: in loads\n    return _default_decoder.decode(s)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <json.decoder.JSONDecoder object at 0x7f47b2e5fe50>, s = '404: Not Found'\n_w = <built-in method match of re.Pattern object at 0x7f47b3015cf0>\n\n    def decode(self, s, _w=WHITESPACE.match):\n        \"\"\"Return the Python representation of ``s`` (a ``str`` instance\n        containing a JSON document).\n    \n        \"\"\"\n        obj, end = self.raw_decode(s, idx=_w(s, 0).end())\n        end = _w(s, end).end()\n        if end != len(s):\n>           raise JSONDecodeError(\"Extra data\", s, end)\nE           json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)\n\n../../anaconda3/lib/python3.9/json/decoder.py:340: JSONDecodeError"}, "teardown": {"duration": 0.0006918800063431263, "outcome": "passed"}}, {"nodeid": "tests/api/test_notification_lifecycle.py::test_ws_notification_roundtrip", "lineno": 137, "outcome": "failed", "keywords": ["test_ws_notification_roundtrip", "test_notification_lifecycle.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.0029749530367553234, "outcome": "passed"}, "call": {"duration": 0.40383754298090935, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_notification_lifecycle.py", "lineno": 164, "message": "assert False is True"}, "traceback": [{"path": "tests/api/test_notification_lifecycle.py", "lineno": 164, "message": "AssertionError"}], "longrepr": "ws = <conftest.WSClient object at 0x7f47b0a8f820>\n\n    async def test_ws_notification_roundtrip(ws):\n        \"\"\"Create notification via WS, list via WS, dismiss via WS.\"\"\"\n        # Clear all first\n        await ws.send_command(\n            \"call_service\",\n            domain=\"persistent_notification\",\n            service=\"dismiss_all\",\n            service_data={},\n        )\n        await asyncio.sleep(0.2)\n    \n        # Create\n        await ws.send_command(\n            \"call_service\",\n            domain=\"persistent_notification\",\n            service=\"create\",\n            service_data={\n                \"notification_id\": \"ws_notif_rt\",\n                \"title\": \"WS Test\",\n                \"message\": \"Created via WS\",\n            },\n        )\n        await asyncio.sleep(0.2)\n    \n        # List\n        result = await ws.send_command(\"get_notifications\")\n>       assert result[\"success\"] is True\nE       assert False is True\n\ntests/api/test_notification_lifecycle.py:164: AssertionError"}, "teardown": {"duration": 0.0020234319381415844, "outcome": "passed"}}, {"nodeid": "tests/api/test_notification_lifecycle.py::test_notification_has_created_at", "lineno": 184, "outcome": "failed", "keywords": ["test_notification_has_created_at", "test_notification_lifecycle.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.011528294999152422, "outcome": "passed"}, "call": {"duration": 0.006387975066900253, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)"}, "traceback": [{"path": "tests/api/test_notification_lifecycle.py", "lineno": 204, "message": ""}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 832, "message": "in json"}, {"path": "../../anaconda3/lib/python3.9/json/__init__.py", "lineno": 346, "message": "in loads"}, {"path": "../../anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "JSONDecodeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b1294670>\n\n    async def test_notification_has_created_at(rest):\n        \"\"\"Notification entry has created_at timestamp.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        nid = f\"ts_{tag}\"\n    \n        await rest.client.post(\n            f\"{rest.base_url}/api/services/persistent_notification/create\",\n            json={\n                \"notification_id\": nid,\n                \"title\": \"Timestamp\",\n                \"message\": \"Has timestamp\",\n            },\n            headers=rest._headers(),\n        )\n    \n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/notifications\",\n            headers=rest._headers(),\n        )\n>       found = [n for n in resp.json()\n                 if n.get(\"notification_id\", n.get(\"id\", \"\")) == nid]\n\ntests/api/test_notification_lifecycle.py:204: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:832: in json\n    return jsonlib.loads(self.content, **kwargs)\n../../anaconda3/lib/python3.9/json/__init__.py:346: in loads\n    return _default_decoder.decode(s)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <json.decoder.JSONDecoder object at 0x7f47b2e5fe50>, s = '404: Not Found'\n_w = <built-in method match of re.Pattern object at 0x7f47b3015cf0>\n\n    def decode(self, s, _w=WHITESPACE.match):\n        \"\"\"Return the Python representation of ``s`` (a ``str`` instance\n        containing a JSON document).\n    \n        \"\"\"\n        obj, end = self.raw_decode(s, idx=_w(s, 0).end())\n        end = _w(s, end).end()\n        if end != len(s):\n>           raise JSONDecodeError(\"Extra data\", s, end)\nE           json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)\n\n../../anaconda3/lib/python3.9/json/decoder.py:340: JSONDecodeError"}, "teardown": {"duration": 0.0008744969964027405, "outcome": "passed"}}, {"nodeid": "tests/api/test_notification_lifecycle.py::test_ws_create_notification", "lineno": 210, "outcome": "failed", "keywords": ["test_ws_create_notification", "test_notification_lifecycle.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.01056416891515255, "outcome": "passed"}, "call": {"duration": 0.004296531900763512, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)"}, "traceback": [{"path": "tests/api/test_notification_lifecycle.py", "lineno": 232, "message": ""}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 832, "message": "in json"}, {"path": "../../anaconda3/lib/python3.9/json/__init__.py", "lineno": 346, "message": "in loads"}, {"path": "../../anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "JSONDecodeError"}], "longrepr": "ws = <conftest.WSClient object at 0x7f47b06a9190>\nrest = <conftest.RESTClient object at 0x7f47b06a92b0>\n\n    async def test_ws_create_notification(ws, rest):\n        \"\"\"WS persistent_notification/create creates notification.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        nid = f\"ws_create_{tag}\"\n    \n        resp = await ws.send_command(\n            \"call_service\",\n            domain=\"persistent_notification\",\n            service=\"create\",\n            service_data={\n                \"notification_id\": nid,\n                \"title\": \"WS Created\",\n                \"message\": \"Via WebSocket\",\n            },\n        )\n        assert resp.get(\"success\", False) is True\n    \n        list_resp = await rest.client.get(\n            f\"{rest.base_url}/api/notifications\",\n            headers=rest._headers(),\n        )\n>       ids = [n.get(\"notification_id\", n.get(\"id\", \"\")) for n in list_resp.json()]\n\ntests/api/test_notification_lifecycle.py:232: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:832: in json\n    return jsonlib.loads(self.content, **kwargs)\n../../anaconda3/lib/python3.9/json/__init__.py:346: in loads\n    return _default_decoder.decode(s)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <json.decoder.JSONDecoder object at 0x7f47b2e5fe50>, s = '404: Not Found'\n_w = <built-in method match of re.Pattern object at 0x7f47b3015cf0>\n\n    def decode(self, s, _w=WHITESPACE.match):\n        \"\"\"Return the Python representation of ``s`` (a ``str`` instance\n        containing a JSON document).\n    \n        \"\"\"\n        obj, end = self.raw_decode(s, idx=_w(s, 0).end())\n        end = _w(s, end).end()\n        if end != len(s):\n>           raise JSONDecodeError(\"Extra data\", s, end)\nE           json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)\n\n../../anaconda3/lib/python3.9/json/decoder.py:340: JSONDecodeError"}, "teardown": {"duration": 0.0016115820035338402, "outcome": "passed"}}, {"nodeid": "tests/api/test_notification_lifecycle.py::test_notification_count_changes", "lineno": 235, "outcome": "failed", "keywords": ["test_notification_count_changes", "test_notification_lifecycle.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.006204772274941206, "outcome": "passed"}, "call": {"duration": 0.002950984053313732, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)"}, "traceback": [{"path": "tests/api/test_notification_lifecycle.py", "lineno": 243, "message": ""}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 832, "message": "in json"}, {"path": "../../anaconda3/lib/python3.9/json/__init__.py", "lineno": 346, "message": "in loads"}, {"path": "../../anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "JSONDecodeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b073af70>\n\n    async def test_notification_count_changes(rest):\n        \"\"\"Notification count increases after create, decreases after dismiss.\"\"\"\n        # Get initial count\n        resp1 = await rest.client.get(\n            f\"{rest.base_url}/api/notifications\",\n            headers=rest._headers(),\n        )\n>       count1 = len(resp1.json())\n\ntests/api/test_notification_lifecycle.py:243: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:832: in json\n    return jsonlib.loads(self.content, **kwargs)\n../../anaconda3/lib/python3.9/json/__init__.py:346: in loads\n    return _default_decoder.decode(s)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <json.decoder.JSONDecoder object at 0x7f47b2e5fe50>, s = '404: Not Found'\n_w = <built-in method match of re.Pattern object at 0x7f47b3015cf0>\n\n    def decode(self, s, _w=WHITESPACE.match):\n        \"\"\"Return the Python representation of ``s`` (a ``str`` instance\n        containing a JSON document).\n    \n        \"\"\"\n        obj, end = self.raw_decode(s, idx=_w(s, 0).end())\n        end = _w(s, end).end()\n        if end != len(s):\n>           raise JSONDecodeError(\"Extra data\", s, end)\nE           json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)\n\n../../anaconda3/lib/python3.9/json/decoder.py:340: JSONDecodeError"}, "teardown": {"duration": 0.0007384773343801498, "outcome": "passed"}}, {"nodeid": "tests/api/test_notifications_rest.py::test_create_notification_via_service", "lineno": 12, "outcome": "failed", "keywords": ["test_create_notification_via_service", "test_notifications_rest.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.0052605560049414635, "outcome": "passed"}, "call": {"duration": 0.004824962932616472, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_notifications_rest.py", "lineno": 25, "message": "assert 404 == 200\n +  where 404 = <Response [404 Not Found]>.status_code"}, "traceback": [{"path": "tests/api/test_notifications_rest.py", "lineno": 25, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b1be3400>\n\n    async def test_create_notification_via_service(rest):\n        \"\"\"POST persistent_notification.create adds a notification.\"\"\"\n        await rest.call_service(\"persistent_notification\", \"create\", {\n            \"notification_id\": \"rest_test_1\",\n            \"title\": \"Test Title\",\n            \"message\": \"Test message body\",\n        })\n    \n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/notifications\",\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 404 == 200\nE        +  where 404 = <Response [404 Not Found]>.status_code\n\ntests/api/test_notifications_rest.py:25: AssertionError"}, "teardown": {"duration": 0.0006408989429473877, "outcome": "passed"}}, {"nodeid": "tests/api/test_notifications_rest.py::test_dismiss_nonexistent_returns_404", "lineno": 30, "outcome": "passed", "keywords": ["test_dismiss_nonexistent_returns_404", "test_notifications_rest.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005254536867141724, "outcome": "passed"}, "call": {"duration": 0.0024871299974620342, "outcome": "passed"}, "teardown": {"duration": 0.00045179668813943863, "outcome": "passed"}}, {"nodeid": "tests/api/test_notifications_rest.py::test_dismiss_via_service", "lineno": 39, "outcome": "failed", "keywords": ["test_dismiss_via_service", "test_notifications_rest.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005338967312127352, "outcome": "passed"}, "call": {"duration": 0.007821819745004177, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)"}, "traceback": [{"path": "tests/api/test_notifications_rest.py", "lineno": 56, "message": ""}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 832, "message": "in json"}, {"path": "../../anaconda3/lib/python3.9/json/__init__.py", "lineno": 346, "message": "in loads"}, {"path": "../../anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "JSONDecodeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b132b5e0>\n\n    async def test_dismiss_via_service(rest):\n        \"\"\"persistent_notification.dismiss service removes by notification_id.\"\"\"\n        await rest.call_service(\"persistent_notification\", \"create\", {\n            \"notification_id\": \"rest_test_svc_dismiss\",\n            \"title\": \"Svc Dismiss\",\n            \"message\": \"Via service call\",\n        })\n    \n        await rest.call_service(\"persistent_notification\", \"dismiss\", {\n            \"notification_id\": \"rest_test_svc_dismiss\",\n        })\n    \n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/notifications\",\n            headers=rest._headers(),\n        )\n>       ids = [n[\"notification_id\"] for n in resp.json()]\n\ntests/api/test_notifications_rest.py:56: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:832: in json\n    return jsonlib.loads(self.content, **kwargs)\n../../anaconda3/lib/python3.9/json/__init__.py:346: in loads\n    return _default_decoder.decode(s)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <json.decoder.JSONDecoder object at 0x7f47b2e5fe50>, s = '404: Not Found'\n_w = <built-in method match of re.Pattern object at 0x7f47b3015cf0>\n\n    def decode(self, s, _w=WHITESPACE.match):\n        \"\"\"Return the Python representation of ``s`` (a ``str`` instance\n        containing a JSON document).\n    \n        \"\"\"\n        obj, end = self.raw_decode(s, idx=_w(s, 0).end())\n        end = _w(s, end).end()\n        if end != len(s):\n>           raise JSONDecodeError(\"Extra data\", s, end)\nE           json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)\n\n../../anaconda3/lib/python3.9/json/decoder.py:340: JSONDecodeError"}, "teardown": {"duration": 0.0007833410054445267, "outcome": "passed"}}, {"nodeid": "tests/api/test_notifications_rest.py::test_dismiss_all_via_service", "lineno": 59, "outcome": "failed", "keywords": ["test_dismiss_all_via_service", "test_notifications_rest.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005560749676078558, "outcome": "passed"}, "call": {"duration": 0.005379565991461277, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)"}, "traceback": [{"path": "tests/api/test_notifications_rest.py", "lineno": 74, "message": ""}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 832, "message": "in json"}, {"path": "../../anaconda3/lib/python3.9/json/__init__.py", "lineno": 346, "message": "in loads"}, {"path": "../../anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "JSONDecodeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b088bb80>\n\n    async def test_dismiss_all_via_service(rest):\n        \"\"\"persistent_notification.dismiss_all service clears notifications.\"\"\"\n        await rest.call_service(\"persistent_notification\", \"create\", {\n            \"notification_id\": \"rest_test_svc_all\",\n            \"title\": \"Clear Me\",\n            \"message\": \"Via dismiss_all service\",\n        })\n    \n        await rest.call_service(\"persistent_notification\", \"dismiss_all\", {})\n    \n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/notifications\",\n            headers=rest._headers(),\n        )\n>       ids = [n[\"notification_id\"] for n in resp.json()]\n\ntests/api/test_notifications_rest.py:74: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:832: in json\n    return jsonlib.loads(self.content, **kwargs)\n../../anaconda3/lib/python3.9/json/__init__.py:346: in loads\n    return _default_decoder.decode(s)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <json.decoder.JSONDecoder object at 0x7f47b2e5fe50>, s = '404: Not Found'\n_w = <built-in method match of re.Pattern object at 0x7f47b3015cf0>\n\n    def decode(self, s, _w=WHITESPACE.match):\n        \"\"\"Return the Python representation of ``s`` (a ``str`` instance\n        containing a JSON document).\n    \n        \"\"\"\n        obj, end = self.raw_decode(s, idx=_w(s, 0).end())\n        end = _w(s, end).end()\n        if end != len(s):\n>           raise JSONDecodeError(\"Extra data\", s, end)\nE           json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)\n\n../../anaconda3/lib/python3.9/json/decoder.py:340: JSONDecodeError"}, "teardown": {"duration": 0.0007246993482112885, "outcome": "passed"}}, {"nodeid": "tests/api/test_prometheus_metrics.py::test_metrics_returns_200", "lineno": 12, "outcome": "skipped", "keywords": ["test_metrics_returns_200", "test_prometheus_metrics.py", "asyncio", "marge_only", "api", "tests", "marge", ""], "setup": {"duration": 0.00027647893875837326, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/api/test_prometheus_metrics.py', 13, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00012617185711860657, "outcome": "passed"}}, {"nodeid": "tests/api/test_prometheus_metrics.py::test_metrics_content_type", "lineno": 21, "outcome": "skipped", "keywords": ["test_metrics_content_type", "test_prometheus_metrics.py", "asyncio", "marge_only", "api", "tests", "marge", ""], "setup": {"duration": 0.00019545387476682663, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/api/test_prometheus_metrics.py', 22, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00012639211490750313, "outcome": "passed"}}, {"nodeid": "tests/api/test_prometheus_metrics.py::test_metrics_has_info", "lineno": 31, "outcome": "skipped", "keywords": ["test_metrics_has_info", "test_prometheus_metrics.py", "asyncio", "marge_only", "api", "tests", "marge", ""], "setup": {"duration": 0.00019202707335352898, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/api/test_prometheus_metrics.py', 32, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00012615695595741272, "outcome": "passed"}}, {"nodeid": "tests/api/test_prometheus_metrics.py::test_metrics_has_uptime", "lineno": 39, "outcome": "skipped", "keywords": ["test_metrics_has_uptime", "test_prometheus_metrics.py", "asyncio", "marge_only", "api", "tests", "marge", ""], "setup": {"duration": 0.00019369786605238914, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/api/test_prometheus_metrics.py', 40, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00012679724022746086, "outcome": "passed"}}, {"nodeid": "tests/api/test_prometheus_metrics.py::test_metrics_has_startup", "lineno": 47, "outcome": "skipped", "keywords": ["test_metrics_has_startup", "test_prometheus_metrics.py", "asyncio", "marge_only", "api", "tests", "marge", ""], "setup": {"duration": 0.00036679115146398544, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/api/test_prometheus_metrics.py', 48, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00012534484267234802, "outcome": "passed"}}, {"nodeid": "tests/api/test_prometheus_metrics.py::test_metrics_has_entity_count", "lineno": 54, "outcome": "skipped", "keywords": ["test_metrics_has_entity_count", "test_prometheus_metrics.py", "asyncio", "marge_only", "api", "tests", "marge", ""], "setup": {"duration": 0.0002384302206337452, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/api/test_prometheus_metrics.py', 55, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00012592319399118423, "outcome": "passed"}}, {"nodeid": "tests/api/test_prometheus_metrics.py::test_metrics_has_state_changes", "lineno": 62, "outcome": "skipped", "keywords": ["test_metrics_has_state_changes", "test_prometheus_metrics.py", "asyncio", "marge_only", "api", "tests", "marge", ""], "setup": {"duration": 0.0001914212480187416, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/api/test_prometheus_metrics.py', 63, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00012424588203430176, "outcome": "passed"}}, {"nodeid": "tests/api/test_prometheus_metrics.py::test_metrics_has_events_fired", "lineno": 70, "outcome": "skipped", "keywords": ["test_metrics_has_events_fired", "test_prometheus_metrics.py", "asyncio", "marge_only", "api", "tests", "marge", ""], "setup": {"duration": 0.00019183335825800896, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/api/test_prometheus_metrics.py', 71, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00012412481009960175, "outcome": "passed"}}, {"nodeid": "tests/api/test_prometheus_metrics.py::test_metrics_has_latency", "lineno": 77, "outcome": "skipped", "keywords": ["test_metrics_has_latency", "test_prometheus_metrics.py", "asyncio", "marge_only", "api", "tests", "marge", ""], "setup": {"duration": 0.00019183801487088203, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/api/test_prometheus_metrics.py', 78, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00019987719133496284, "outcome": "passed"}}, {"nodeid": "tests/api/test_prometheus_metrics.py::test_metrics_has_memory", "lineno": 85, "outcome": "skipped", "keywords": ["test_metrics_has_memory", "test_prometheus_metrics.py", "asyncio", "marge_only", "api", "tests", "marge", ""], "setup": {"duration": 0.0003388691693544388, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/api/test_prometheus_metrics.py', 86, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00012913579121232033, "outcome": "passed"}}, {"nodeid": "tests/api/test_prometheus_metrics.py::test_metrics_has_ws_connections", "lineno": 93, "outcome": "skipped", "keywords": ["test_metrics_has_ws_connections", "test_prometheus_metrics.py", "asyncio", "marge_only", "api", "tests", "marge", ""], "setup": {"duration": 0.00020645512267947197, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/api/test_prometheus_metrics.py', 94, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00012866733595728874, "outcome": "passed"}}, {"nodeid": "tests/api/test_prometheus_metrics.py::test_metrics_has_automation_triggers", "lineno": 100, "outcome": "skipped", "keywords": ["test_metrics_has_automation_triggers", "test_prometheus_metrics.py", "asyncio", "marge_only", "api", "tests", "marge", ""], "setup": {"duration": 0.0001979428343474865, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/api/test_prometheus_metrics.py', 101, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.0001269318163394928, "outcome": "passed"}}, {"nodeid": "tests/api/test_prometheus_metrics.py::test_metrics_valid_prometheus_format", "lineno": 107, "outcome": "skipped", "keywords": ["test_metrics_valid_prometheus_format", "test_prometheus_metrics.py", "asyncio", "marge_only", "api", "tests", "marge", ""], "setup": {"duration": 0.00019759079441428185, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/api/test_prometheus_metrics.py', 108, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.0001299711875617504, "outcome": "passed"}}, {"nodeid": "tests/api/test_prometheus_metrics.py::test_metrics_entity_count_positive", "lineno": 121, "outcome": "skipped", "keywords": ["test_metrics_entity_count_positive", "test_prometheus_metrics.py", "asyncio", "marge_only", "api", "tests", "marge", ""], "setup": {"duration": 0.00019740872085094452, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/api/test_prometheus_metrics.py', 122, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00013156281784176826, "outcome": "passed"}}, {"nodeid": "tests/api/test_recorder_history.py::test_history_records_state_changes", "lineno": 15, "outcome": "failed", "keywords": ["test_history_records_state_changes", "test_recorder_history.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005494919139891863, "outcome": "passed"}, "call": {"duration": 0.4075467302463949, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_recorder_history.py", "lineno": 28, "message": "assert 404 == 200\n +  where 404 = <Response [404 Not Found]>.status_code"}, "traceback": [{"path": "tests/api/test_recorder_history.py", "lineno": 28, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0541250>\n\n    async def test_history_records_state_changes(rest):\n        \"\"\"State changes appear in history API.\"\"\"\n        entity = \"sensor.rec_hist_1\"\n        await rest.set_state(entity, \"alpha\")\n        await asyncio.sleep(0.2)\n        await rest.set_state(entity, \"beta\")\n        await asyncio.sleep(0.2)\n    \n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/history/period/{entity}\",\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 404 == 200\nE        +  where 404 = <Response [404 Not Found]>.status_code\n\ntests/api/test_recorder_history.py:28: AssertionError"}, "teardown": {"duration": 0.0005879071541130543, "outcome": "passed"}}, {"nodeid": "tests/api/test_recorder_history.py::test_history_has_state_values", "lineno": 32, "outcome": "failed", "keywords": ["test_history_has_state_values", "test_recorder_history.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005106579978018999, "outcome": "passed"}, "call": {"duration": 0.6188596845604479, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)"}, "traceback": [{"path": "tests/api/test_recorder_history.py", "lineno": 44, "message": ""}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 832, "message": "in json"}, {"path": "../../anaconda3/lib/python3.9/json/__init__.py", "lineno": 346, "message": "in loads"}, {"path": "../../anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "JSONDecodeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b05414c0>\n\n    async def test_history_has_state_values(rest):\n        \"\"\"History entries contain state values.\"\"\"\n        entity = \"sensor.rec_hist_vals\"\n        for v in [\"10\", \"20\", \"30\"]:\n            await rest.set_state(entity, v)\n            await asyncio.sleep(0.2)\n    \n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/history/period/{entity}\",\n            headers=rest._headers(),\n        )\n>       data = resp.json()\n\ntests/api/test_recorder_history.py:44: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:832: in json\n    return jsonlib.loads(self.content, **kwargs)\n../../anaconda3/lib/python3.9/json/__init__.py:346: in loads\n    return _default_decoder.decode(s)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <json.decoder.JSONDecoder object at 0x7f47b2e5fe50>, s = '404: Not Found'\n_w = <built-in method match of re.Pattern object at 0x7f47b3015cf0>\n\n    def decode(self, s, _w=WHITESPACE.match):\n        \"\"\"Return the Python representation of ``s`` (a ``str`` instance\n        containing a JSON document).\n    \n        \"\"\"\n        obj, end = self.raw_decode(s, idx=_w(s, 0).end())\n        end = _w(s, end).end()\n        if end != len(s):\n>           raise JSONDecodeError(\"Extra data\", s, end)\nE           json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)\n\n../../anaconda3/lib/python3.9/json/decoder.py:340: JSONDecodeError"}, "teardown": {"duration": 0.0008337930776178837, "outcome": "passed"}}, {"nodeid": "tests/api/test_recorder_history.py::test_history_empty_for_unknown_entity", "lineno": 52, "outcome": "failed", "keywords": ["test_history_empty_for_unknown_entity", "test_recorder_history.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.006494420580565929, "outcome": "passed"}, "call": {"duration": 0.0031950687989592552, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_recorder_history.py", "lineno": 59, "message": "assert 404 == 200\n +  where 404 = <Response [404 Not Found]>.status_code"}, "traceback": [{"path": "tests/api/test_recorder_history.py", "lineno": 59, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b07ddf10>\n\n    async def test_history_empty_for_unknown_entity(rest):\n        \"\"\"History for unknown entity returns empty.\"\"\"\n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/history/period/sensor.nonexistent_rec_xyz\",\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 404 == 200\nE        +  where 404 = <Response [404 Not Found]>.status_code\n\ntests/api/test_recorder_history.py:59: AssertionError"}, "teardown": {"duration": 0.0007058489136397839, "outcome": "passed"}}, {"nodeid": "tests/api/test_recorder_history.py::test_area_create_and_list", "lineno": 66, "outcome": "failed", "keywords": ["test_area_create_and_list", "test_recorder_history.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005686389282345772, "outcome": "passed"}, "call": {"duration": 0.0028730472549796104, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_recorder_history.py", "lineno": 74, "message": "assert 404 == 200\n +  where 404 = <Response [404 Not Found]>.status_code"}, "traceback": [{"path": "tests/api/test_recorder_history.py", "lineno": 74, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b07dda30>\n\n    async def test_area_create_and_list(rest):\n        \"\"\"Create area and verify it appears in list.\"\"\"\n        resp = await rest.client.post(\n            f\"{rest.base_url}/api/areas\",\n            json={\"area_id\": \"rec_test_room\", \"name\": \"Recorder Test Room\"},\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 404 == 200\nE        +  where 404 = <Response [404 Not Found]>.status_code\n\ntests/api/test_recorder_history.py:74: AssertionError"}, "teardown": {"duration": 0.0005636229179799557, "outcome": "passed"}}, {"nodeid": "tests/api/test_recorder_history.py::test_area_entity_assignment", "lineno": 85, "outcome": "failed", "keywords": ["test_area_entity_assignment", "test_recorder_history.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005347999278455973, "outcome": "passed"}, "call": {"duration": 0.0027832710184156895, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_recorder_history.py", "lineno": 95, "message": "assert 404 == 200\n +  where 404 = <Response [404 Not Found]>.status_code"}, "traceback": [{"path": "tests/api/test_recorder_history.py", "lineno": 95, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b06a2f70>\n\n    async def test_area_entity_assignment(rest):\n        \"\"\"Assign entity to area and verify.\"\"\"\n        area_id = \"assign_test_room\"\n        # Create area\n        resp = await rest.client.post(\n            f\"{rest.base_url}/api/areas\",\n            json={\"area_id\": area_id, \"name\": \"Assignment Test Room\"},\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 404 == 200\nE        +  where 404 = <Response [404 Not Found]>.status_code\n\ntests/api/test_recorder_history.py:95: AssertionError"}, "teardown": {"duration": 0.0005709221586585045, "outcome": "passed"}}, {"nodeid": "tests/api/test_recorder_history.py::test_device_registry_via_ws", "lineno": 120, "outcome": "passed", "keywords": ["test_device_registry_via_ws", "test_recorder_history.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.0025795241817831993, "outcome": "passed"}, "call": {"duration": 0.0005385060794651508, "outcome": "passed"}, "teardown": {"duration": 0.0007199500687420368, "outcome": "passed"}}, {"nodeid": "tests/api/test_recorder_history.py::test_label_list_via_ws", "lineno": 129, "outcome": "passed", "keywords": ["test_label_list_via_ws", "test_recorder_history.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.002499735914170742, "outcome": "passed"}, "call": {"duration": 0.0006089229136705399, "outcome": "passed"}, "teardown": {"duration": 0.0007704156450927258, "outcome": "passed"}}, {"nodeid": "tests/api/test_recorder_history.py::test_logbook_records_events", "lineno": 138, "outcome": "failed", "keywords": ["test_logbook_records_events", "test_recorder_history.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005089096259325743, "outcome": "passed"}, "call": {"duration": 0.20784003380686045, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_recorder_history.py", "lineno": 148, "message": "assert 404 == 200\n +  where 404 = <Response [404 Not Found]>.status_code"}, "traceback": [{"path": "tests/api/test_recorder_history.py", "lineno": 148, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0545520>\n\n    async def test_logbook_records_events(rest):\n        \"\"\"Logbook contains entries after state changes.\"\"\"\n        await rest.set_state(\"sensor.rec_logbook\", \"event_a\")\n        await asyncio.sleep(0.2)\n    \n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/logbook\",\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 404 == 200\nE        +  where 404 = <Response [404 Not Found]>.status_code\n\ntests/api/test_recorder_history.py:148: AssertionError"}, "teardown": {"duration": 0.0008263373747467995, "outcome": "passed"}}, {"nodeid": "tests/api/test_recorder_history.py::test_logbook_filtered_by_entity", "lineno": 152, "outcome": "failed", "keywords": ["test_logbook_filtered_by_entity", "test_recorder_history.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005222672130912542, "outcome": "passed"}, "call": {"duration": 0.20612793089821935, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_recorder_history.py", "lineno": 163, "message": "assert 404 == 200\n +  where 404 = <Response [404 Not Found]>.status_code"}, "traceback": [{"path": "tests/api/test_recorder_history.py", "lineno": 163, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b1b94220>\n\n    async def test_logbook_filtered_by_entity(rest):\n        \"\"\"Logbook can filter by entity_id.\"\"\"\n        entity = \"sensor.rec_logbook_filter\"\n        await rest.set_state(entity, \"val1\")\n        await asyncio.sleep(0.2)\n    \n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/logbook/{entity}\",\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 404 == 200\nE        +  where 404 = <Response [404 Not Found]>.status_code\n\ntests/api/test_recorder_history.py:163: AssertionError"}, "teardown": {"duration": 0.000906017143279314, "outcome": "passed"}}, {"nodeid": "tests/api/test_rest_error_handling.py::test_get_nonexistent_state_404", "lineno": 25, "outcome": "passed", "keywords": ["test_get_nonexistent_state_404", "test_rest_error_handling.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.007662614341825247, "outcome": "passed"}, "call": {"duration": 0.003834210801869631, "outcome": "passed"}, "teardown": {"duration": 0.0007057939656078815, "outcome": "passed"}}, {"nodeid": "tests/api/test_rest_error_handling.py::test_delete_nonexistent_state_404", "lineno": 35, "outcome": "passed", "keywords": ["test_delete_nonexistent_state_404", "test_rest_error_handling.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.0073677306063473225, "outcome": "passed"}, "call": {"duration": 0.0034082159399986267, "outcome": "passed"}, "teardown": {"duration": 0.0006629489362239838, "outcome": "passed"}}, {"nodeid": "tests/api/test_rest_error_handling.py::test_dismiss_nonexistent_notification_404", "lineno": 45, "outcome": "passed", "keywords": ["test_dismiss_nonexistent_notification_404", "test_rest_error_handling.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.0074828569777309895, "outcome": "passed"}, "call": {"duration": 0.003665491007268429, "outcome": "passed"}, "teardown": {"duration": 0.0006416379474103451, "outcome": "passed"}}, {"nodeid": "tests/api/test_rest_error_handling.py::test_unknown_api_path_handled", "lineno": 55, "outcome": "passed", "keywords": ["test_unknown_api_path_handled", "test_rest_error_handling.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.007233471143990755, "outcome": "passed"}, "call": {"duration": 0.006835649721324444, "outcome": "passed"}, "teardown": {"duration": 0.0006713597103953362, "outcome": "passed"}}, {"nodeid": "tests/api/test_rest_error_handling.py::test_405_get_on_post_only", "lineno": 65, "outcome": "passed", "keywords": ["test_405_get_on_post_only", "test_rest_error_handling.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.007306806743144989, "outcome": "passed"}, "call": {"duration": 0.003220789134502411, "outcome": "passed"}, "teardown": {"duration": 0.0006340071558952332, "outcome": "passed"}}, {"nodeid": "tests/api/test_rest_error_handling.py::test_get_history_nonexistent_entity", "lineno": 77, "outcome": "failed", "keywords": ["test_get_history_nonexistent_entity", "test_rest_error_handling.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.007088425103574991, "outcome": "passed"}, "call": {"duration": 0.0031521921046078205, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_rest_error_handling.py", "lineno": 84, "message": "assert 404 == 200\n +  where 404 = <Response [404 Not Found]>.status_code"}, "traceback": [{"path": "tests/api/test_rest_error_handling.py", "lineno": 84, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b06a2310>\n\n    async def test_get_history_nonexistent_entity(rest):\n        \"\"\"GET /api/history/period for nonexistent entity returns empty.\"\"\"\n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/history/period/sensor.no_such_entity_xyz_999\",\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 404 == 200\nE        +  where 404 = <Response [404 Not Found]>.status_code\n\ntests/api/test_rest_error_handling.py:84: AssertionError"}, "teardown": {"duration": 0.0007448634132742882, "outcome": "passed"}}, {"nodeid": "tests/api/test_rest_error_handling.py::test_logbook_nonexistent_entity_empty", "lineno": 89, "outcome": "failed", "keywords": ["test_logbook_nonexistent_entity_empty", "test_rest_error_handling.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.0060814060270786285, "outcome": "passed"}, "call": {"duration": 0.0029723453335464, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_rest_error_handling.py", "lineno": 97, "message": "assert 404 == 200\n +  where 404 = <Response [404 Not Found]>.status_code"}, "traceback": [{"path": "tests/api/test_rest_error_handling.py", "lineno": 97, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b07929d0>\n\n    async def test_logbook_nonexistent_entity_empty(rest):\n        \"\"\"GET /api/logbook/<nonexistent> returns empty array.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/logbook/sensor.no_log_{tag}\",\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 404 == 200\nE        +  where 404 = <Response [404 Not Found]>.status_code\n\ntests/api/test_rest_error_handling.py:97: AssertionError"}, "teardown": {"duration": 0.0006782850250601768, "outcome": "passed"}}, {"nodeid": "tests/api/test_rest_error_handling.py::test_logbook_global_returns_list", "lineno": 100, "outcome": "failed", "keywords": ["test_logbook_global_returns_list", "test_rest_error_handling.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005916539113968611, "outcome": "passed"}, "call": {"duration": 0.0034612328745424747, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_rest_error_handling.py", "lineno": 107, "message": "assert 404 == 200\n +  where 404 = <Response [404 Not Found]>.status_code"}, "traceback": [{"path": "tests/api/test_rest_error_handling.py", "lineno": 107, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0792640>\n\n    async def test_logbook_global_returns_list(rest):\n        \"\"\"GET /api/logbook returns a list.\"\"\"\n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/logbook\",\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 404 == 200\nE        +  where 404 = <Response [404 Not Found]>.status_code\n\ntests/api/test_rest_error_handling.py:107: AssertionError"}, "teardown": {"duration": 0.0006165350787341595, "outcome": "passed"}}, {"nodeid": "tests/api/test_rest_error_handling.py::test_statistics_nonexistent_entity", "lineno": 110, "outcome": "failed", "keywords": ["test_statistics_nonexistent_entity", "test_rest_error_handling.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005278897937387228, "outcome": "passed"}, "call": {"duration": 0.002568125259131193, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_rest_error_handling.py", "lineno": 117, "message": "assert 404 == 200\n +  where 404 = <Response [404 Not Found]>.status_code"}, "traceback": [{"path": "tests/api/test_rest_error_handling.py", "lineno": 117, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0a8a250>\n\n    async def test_statistics_nonexistent_entity(rest):\n        \"\"\"Statistics for nonexistent entity returns empty.\"\"\"\n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/statistics/sensor.err_stats_nonexistent\",\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 404 == 200\nE        +  where 404 = <Response [404 Not Found]>.status_code\n\ntests/api/test_rest_error_handling.py:117: AssertionError"}, "teardown": {"duration": 0.00047878921031951904, "outcome": "passed"}}, {"nodeid": "tests/api/test_rest_error_handling.py::test_set_state_no_body_422", "lineno": 124, "outcome": "passed", "keywords": ["test_set_state_no_body_422", "test_rest_error_handling.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.004967262968420982, "outcome": "passed"}, "call": {"duration": 0.0024789911694824696, "outcome": "passed"}, "teardown": {"duration": 0.0004174457862973213, "outcome": "passed"}}, {"nodeid": "tests/api/test_rest_error_handling.py::test_set_state_invalid_json", "lineno": 134, "outcome": "passed", "keywords": ["test_set_state_invalid_json", "test_rest_error_handling.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.004930404014885426, "outcome": "passed"}, "call": {"duration": 0.002211581915616989, "outcome": "passed"}, "teardown": {"duration": 0.00043723033741116524, "outcome": "passed"}}, {"nodeid": "tests/api/test_rest_error_handling.py::test_set_state_missing_state_field", "lineno": 144, "outcome": "passed", "keywords": ["test_set_state_missing_state_field", "test_rest_error_handling.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.004865581635385752, "outcome": "passed"}, "call": {"duration": 0.0043757082894444466, "outcome": "passed"}, "teardown": {"duration": 0.0005306443199515343, "outcome": "passed"}}, {"nodeid": "tests/api/test_rest_error_handling.py::test_service_call_invalid_json", "lineno": 155, "outcome": "passed", "keywords": ["test_service_call_invalid_json", "test_rest_error_handling.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005088642705231905, "outcome": "passed"}, "call": {"duration": 0.002421493176370859, "outcome": "passed"}, "teardown": {"duration": 0.00041453074663877487, "outcome": "passed"}}, {"nodeid": "tests/api/test_rest_error_handling.py::test_template_missing_template_field", "lineno": 165, "outcome": "failed", "keywords": ["test_template_missing_template_field", "test_rest_error_handling.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.004912721924483776, "outcome": "passed"}, "call": {"duration": 0.004491493105888367, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_rest_error_handling.py", "lineno": 173, "message": "assert 500 in (400, 422)\n +  where 500 = <Response [500 Internal Server Error]>.status_code"}, "traceback": [{"path": "tests/api/test_rest_error_handling.py", "lineno": 173, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0720a60>\n\n    async def test_template_missing_template_field(rest):\n        \"\"\"POST /api/template without template field returns 4xx.\"\"\"\n        resp = await rest.client.post(\n            f\"{rest.base_url}/api/template\",\n            json={\"not_template\": \"value\"},\n            headers=rest._headers(),\n        )\n>       assert resp.status_code in (400, 422)\nE       assert 500 in (400, 422)\nE        +  where 500 = <Response [500 Internal Server Error]>.status_code\n\ntests/api/test_rest_error_handling.py:173: AssertionError"}, "teardown": {"duration": 0.0004713060334324837, "outcome": "passed"}}, {"nodeid": "tests/api/test_rest_error_handling.py::test_missing_required_fields_400[area-empty]", "lineno": 175, "outcome": "failed", "keywords": ["test_missing_required_fields_400[area-empty]", "parametrize", "pytestmark", "area-empty", "test_rest_error_handling.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005474126897752285, "outcome": "passed"}, "call": {"duration": 0.0031944639049470425, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_rest_error_handling.py", "lineno": 188, "message": "assert 404 == 400\n +  where 404 = <Response [404 Not Found]>.status_code"}, "traceback": [{"path": "tests/api/test_rest_error_handling.py", "lineno": 188, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b129cdc0>, endpoint = '/api/areas'\nbody = {}\n\n    @pytest.mark.parametrize(\"endpoint,body\", [\n        (\"/api/areas\", {}),\n        (\"/api/labels\", {}),\n        (\"/api/devices\", {\"manufacturer\": \"Acme\"}),\n    ], ids=[\"area-empty\", \"label-empty\", \"device-partial\"])\n    async def test_missing_required_fields_400(rest, endpoint, body):\n        \"\"\"POST to registry endpoints without required fields returns 400.\"\"\"\n        resp = await rest.client.post(\n            f\"{rest.base_url}{endpoint}\",\n            json=body,\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 400\nE       assert 404 == 400\nE        +  where 404 = <Response [404 Not Found]>.status_code\n\ntests/api/test_rest_error_handling.py:188: AssertionError"}, "teardown": {"duration": 0.0006735930219292641, "outcome": "passed"}}, {"nodeid": "tests/api/test_rest_error_handling.py::test_missing_required_fields_400[label-empty]", "lineno": 175, "outcome": "failed", "keywords": ["test_missing_required_fields_400[label-empty]", "parametrize", "pytestmark", "label-empty", "test_rest_error_handling.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005196603015065193, "outcome": "passed"}, "call": {"duration": 0.002605362795293331, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_rest_error_handling.py", "lineno": 188, "message": "assert 404 == 400\n +  where 404 = <Response [404 Not Found]>.status_code"}, "traceback": [{"path": "tests/api/test_rest_error_handling.py", "lineno": 188, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0a8f190>, endpoint = '/api/labels'\nbody = {}\n\n    @pytest.mark.parametrize(\"endpoint,body\", [\n        (\"/api/areas\", {}),\n        (\"/api/labels\", {}),\n        (\"/api/devices\", {\"manufacturer\": \"Acme\"}),\n    ], ids=[\"area-empty\", \"label-empty\", \"device-partial\"])\n    async def test_missing_required_fields_400(rest, endpoint, body):\n        \"\"\"POST to registry endpoints without required fields returns 400.\"\"\"\n        resp = await rest.client.post(\n            f\"{rest.base_url}{endpoint}\",\n            json=body,\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 400\nE       assert 404 == 400\nE        +  where 404 = <Response [404 Not Found]>.status_code\n\ntests/api/test_rest_error_handling.py:188: AssertionError"}, "teardown": {"duration": 0.0005562198348343372, "outcome": "passed"}}, {"nodeid": "tests/api/test_rest_error_handling.py::test_missing_required_fields_400[device-partial]", "lineno": 175, "outcome": "failed", "keywords": ["test_missing_required_fields_400[device-partial]", "parametrize", "pytestmark", "device-partial", "test_rest_error_handling.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005262651015073061, "outcome": "passed"}, "call": {"duration": 0.002702757716178894, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_rest_error_handling.py", "lineno": 188, "message": "assert 404 == 400\n +  where 404 = <Response [404 Not Found]>.status_code"}, "traceback": [{"path": "tests/api/test_rest_error_handling.py", "lineno": 188, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0547190>, endpoint = '/api/devices'\nbody = {'manufacturer': 'Acme'}\n\n    @pytest.mark.parametrize(\"endpoint,body\", [\n        (\"/api/areas\", {}),\n        (\"/api/labels\", {}),\n        (\"/api/devices\", {\"manufacturer\": \"Acme\"}),\n    ], ids=[\"area-empty\", \"label-empty\", \"device-partial\"])\n    async def test_missing_required_fields_400(rest, endpoint, body):\n        \"\"\"POST to registry endpoints without required fields returns 400.\"\"\"\n        resp = await rest.client.post(\n            f\"{rest.base_url}{endpoint}\",\n            json=body,\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 400\nE       assert 404 == 400\nE        +  where 404 = <Response [404 Not Found]>.status_code\n\ntests/api/test_rest_error_handling.py:188: AssertionError"}, "teardown": {"duration": 0.000572660006582737, "outcome": "passed"}}, {"nodeid": "tests/api/test_rest_error_handling.py::test_invalid_yaml_400[automation]", "lineno": 190, "outcome": "failed", "keywords": ["test_invalid_yaml_400[automation]", "parametrize", "pytestmark", "automation", "test_rest_error_handling.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005091880913823843, "outcome": "passed"}, "call": {"duration": 0.00248088501393795, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_rest_error_handling.py", "lineno": 202, "message": "assert 404 == 400\n +  where 404 = <Response [404 Not Found]>.status_code"}, "traceback": [{"path": "tests/api/test_rest_error_handling.py", "lineno": 202, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b1322820>\nendpoint = '/api/config/automation/yaml'\ncontent = 'this is: [not: valid: yaml: ---'\n\n    @pytest.mark.parametrize(\"endpoint,content\", [\n        (\"/api/config/automation/yaml\", \"this is: [not: valid: yaml: ---\"),\n        (\"/api/config/scene/yaml\", \"definitely not: [valid yaml ---\"),\n    ], ids=[\"automation\", \"scene\"])\n    async def test_invalid_yaml_400(rest, endpoint, content):\n        \"\"\"PUT with invalid YAML returns 400.\"\"\"\n        resp = await rest.client.put(\n            f\"{rest.base_url}{endpoint}\",\n            content=content,\n            headers={\"Content-Type\": \"text/yaml\"},\n        )\n>       assert resp.status_code == 400\nE       assert 404 == 400\nE        +  where 404 = <Response [404 Not Found]>.status_code\n\ntests/api/test_rest_error_handling.py:202: AssertionError"}, "teardown": {"duration": 0.0005670599639415741, "outcome": "passed"}}, {"nodeid": "tests/api/test_rest_error_handling.py::test_invalid_yaml_400[scene]", "lineno": 190, "outcome": "failed", "keywords": ["test_invalid_yaml_400[scene]", "parametrize", "pytestmark", "scene", "test_rest_error_handling.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.00516517972573638, "outcome": "passed"}, "call": {"duration": 0.0028322292491793633, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_rest_error_handling.py", "lineno": 202, "message": "assert 404 == 400\n +  where 404 = <Response [404 Not Found]>.status_code"}, "traceback": [{"path": "tests/api/test_rest_error_handling.py", "lineno": 202, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b090c250>\nendpoint = '/api/config/scene/yaml', content = 'definitely not: [valid yaml ---'\n\n    @pytest.mark.parametrize(\"endpoint,content\", [\n        (\"/api/config/automation/yaml\", \"this is: [not: valid: yaml: ---\"),\n        (\"/api/config/scene/yaml\", \"definitely not: [valid yaml ---\"),\n    ], ids=[\"automation\", \"scene\"])\n    async def test_invalid_yaml_400(rest, endpoint, content):\n        \"\"\"PUT with invalid YAML returns 400.\"\"\"\n        resp = await rest.client.put(\n            f\"{rest.base_url}{endpoint}\",\n            content=content,\n            headers={\"Content-Type\": \"text/yaml\"},\n        )\n>       assert resp.status_code == 400\nE       assert 404 == 400\nE        +  where 404 = <Response [404 Not Found]>.status_code\n\ntests/api/test_rest_error_handling.py:202: AssertionError"}, "teardown": {"duration": 0.0006731799803674221, "outcome": "passed"}}, {"nodeid": "tests/api/test_rest_error_handling.py::test_template_syntax_error_400[undefined-filter]", "lineno": 207, "outcome": "passed", "keywords": ["test_template_syntax_error_400[undefined-filter]", "parametrize", "pytestmark", "undefined-filter", "test_rest_error_handling.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005024278070777655, "outcome": "passed"}, "call": {"duration": 0.0033650570549070835, "outcome": "passed"}, "teardown": {"duration": 0.0005499660037457943, "outcome": "passed"}}, {"nodeid": "tests/api/test_rest_error_handling.py::test_template_syntax_error_400[unclosed-tag]", "lineno": 207, "outcome": "passed", "keywords": ["test_template_syntax_error_400[unclosed-tag]", "parametrize", "pytestmark", "unclosed-tag", "test_rest_error_handling.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005185288842767477, "outcome": "passed"}, "call": {"duration": 0.003030878957360983, "outcome": "passed"}, "teardown": {"duration": 0.0005930140614509583, "outcome": "passed"}}, {"nodeid": "tests/api/test_rest_error_handling.py::test_template_syntax_error_400[nonexistent-filter]", "lineno": 207, "outcome": "passed", "keywords": ["test_template_syntax_error_400[nonexistent-filter]", "parametrize", "pytestmark", "nonexistent-filter", "test_rest_error_handling.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005175082944333553, "outcome": "passed"}, "call": {"duration": 0.005334367044270039, "outcome": "passed"}, "teardown": {"duration": 0.0005391277372837067, "outcome": "passed"}}, {"nodeid": "tests/api/test_rest_error_handling.py::test_template_syntax_error_400[bad-syntax]", "lineno": 207, "outcome": "passed", "keywords": ["test_template_syntax_error_400[bad-syntax]", "parametrize", "pytestmark", "bad-syntax", "test_rest_error_handling.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005042759235948324, "outcome": "passed"}, "call": {"duration": 0.002471424173563719, "outcome": "passed"}, "teardown": {"duration": 0.0004675537347793579, "outcome": "passed"}}, {"nodeid": "tests/api/test_rest_error_handling.py::test_template_empty_string", "lineno": 228, "outcome": "passed", "keywords": ["test_template_empty_string", "test_rest_error_handling.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005262964870780706, "outcome": "passed"}, "call": {"duration": 0.002502596937119961, "outcome": "passed"}, "teardown": {"duration": 0.00047274166718125343, "outcome": "passed"}}, {"nodeid": "tests/api/test_rest_error_handling.py::test_template_deeply_nested", "lineno": 239, "outcome": "passed", "keywords": ["test_template_deeply_nested", "test_rest_error_handling.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005170735064893961, "outcome": "passed"}, "call": {"duration": 0.006925900932401419, "outcome": "passed"}, "teardown": {"duration": 0.0007505388930439949, "outcome": "passed"}}, {"nodeid": "tests/api/test_rest_error_handling.py::test_template_string_concatenation", "lineno": 250, "outcome": "passed", "keywords": ["test_template_string_concatenation", "test_rest_error_handling.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005019340198487043, "outcome": "passed"}, "call": {"duration": 0.00321283470839262, "outcome": "passed"}, "teardown": {"duration": 0.0006249700672924519, "outcome": "passed"}}, {"nodeid": "tests/api/test_rest_error_handling.py::test_template_comparison", "lineno": 261, "outcome": "passed", "keywords": ["test_template_comparison", "test_rest_error_handling.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.00528223579749465, "outcome": "passed"}, "call": {"duration": 0.003229832276701927, "outcome": "passed"}, "teardown": {"duration": 0.0005051558837294579, "outcome": "passed"}}, {"nodeid": "tests/api/test_rest_error_handling.py::test_call_service_unknown_domain", "lineno": 275, "outcome": "failed", "keywords": ["test_call_service_unknown_domain", "test_rest_error_handling.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.0052895681001245975, "outcome": "passed"}, "call": {"duration": 0.007004492916166782, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_rest_error_handling.py", "lineno": 287, "message": "assert 400 == 200\n +  where 400 = <Response [400 Bad Request]>.status_code"}, "traceback": [{"path": "tests/api/test_rest_error_handling.py", "lineno": 287, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0965490>\n\n    async def test_call_service_unknown_domain(rest):\n        \"\"\"POST /api/services/unknown_domain/turn_on returns 200 (no-op).\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"unknown_domain.err_{tag}\"\n        await rest.set_state(eid, \"off\")\n        resp = await rest.client.post(\n            f\"{rest.base_url}/api/services/unknown_domain/turn_on\",\n            json={\"entity_id\": eid},\n            headers=rest._headers(),\n        )\n        # Should not crash -- generic fallback handles it\n>       assert resp.status_code == 200\nE       assert 400 == 200\nE        +  where 400 = <Response [400 Bad Request]>.status_code\n\ntests/api/test_rest_error_handling.py:287: AssertionError"}, "teardown": {"duration": 0.0005636168643832207, "outcome": "passed"}}, {"nodeid": "tests/api/test_rest_error_handling.py::test_nonexistent_service", "lineno": 289, "outcome": "failed", "keywords": ["test_nonexistent_service", "test_rest_error_handling.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005588605999946594, "outcome": "passed"}, "call": {"duration": 0.0031485860235989094, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_rest_error_handling.py", "lineno": 297, "message": "assert 400 == 200\n +  where 400 = <Response [400 Bad Request]>.status_code"}, "traceback": [{"path": "tests/api/test_rest_error_handling.py", "lineno": 297, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b07242e0>\n\n    async def test_nonexistent_service(rest):\n        \"\"\"Calling nonexistent service returns 200 (no-op).\"\"\"\n        resp = await rest.client.post(\n            f\"{rest.base_url}/api/services/light/nonexistent_service\",\n            json={\"entity_id\": \"light.test\"},\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 400 == 200\nE        +  where 400 = <Response [400 Bad Request]>.status_code\n\ntests/api/test_rest_error_handling.py:297: AssertionError"}, "teardown": {"duration": 0.0006521642208099365, "outcome": "passed"}}, {"nodeid": "tests/api/test_rest_error_handling.py::test_service_call_empty_body", "lineno": 299, "outcome": "failed", "keywords": ["test_service_call_empty_body", "test_rest_error_handling.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005343696102499962, "outcome": "passed"}, "call": {"duration": 0.0031376536935567856, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_rest_error_handling.py", "lineno": 307, "message": "assert 400 == 200\n +  where 400 = <Response [400 Bad Request]>.status_code"}, "traceback": [{"path": "tests/api/test_rest_error_handling.py", "lineno": 307, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b090c280>\n\n    async def test_service_call_empty_body(rest):\n        \"\"\"POST /api/services/light/turn_on with empty body.\"\"\"\n        resp = await rest.client.post(\n            f\"{rest.base_url}/api/services/light/turn_on\",\n            json={},\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 400 == 200\nE        +  where 400 = <Response [400 Bad Request]>.status_code\n\ntests/api/test_rest_error_handling.py:307: AssertionError"}, "teardown": {"duration": 0.0006166021339595318, "outcome": "passed"}}, {"nodeid": "tests/api/test_rest_error_handling.py::test_service_call_nonexistent_entity", "lineno": 309, "outcome": "failed", "keywords": ["test_service_call_nonexistent_entity", "test_rest_error_handling.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005098556634038687, "outcome": "passed"}, "call": {"duration": 0.0028640953823924065, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_rest_error_handling.py", "lineno": 317, "message": "assert 400 in [200, 404]\n +  where 400 = <Response [400 Bad Request]>.status_code"}, "traceback": [{"path": "tests/api/test_rest_error_handling.py", "lineno": 317, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0635a60>\n\n    async def test_service_call_nonexistent_entity(rest):\n        \"\"\"Service call on nonexistent entity handles gracefully.\"\"\"\n        resp = await rest.client.post(\n            f\"{rest.base_url}/api/services/light/turn_on\",\n            json={\"entity_id\": \"light.does_not_exist_xyz\"},\n            headers=rest._headers(),\n        )\n>       assert resp.status_code in [200, 404]\nE       assert 400 in [200, 404]\nE        +  where 400 = <Response [400 Bad Request]>.status_code\n\ntests/api/test_rest_error_handling.py:317: AssertionError"}, "teardown": {"duration": 0.0006962181068956852, "outcome": "passed"}}, {"nodeid": "tests/api/test_rest_error_handling.py::test_service_empty_entity_id_array", "lineno": 319, "outcome": "failed", "keywords": ["test_service_empty_entity_id_array", "test_rest_error_handling.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005579490214586258, "outcome": "passed"}, "call": {"duration": 0.003028800245374441, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_rest_error_handling.py", "lineno": 327, "message": "assert 400 == 200\n +  where 400 = <Response [400 Bad Request]>.status_code"}, "traceback": [{"path": "tests/api/test_rest_error_handling.py", "lineno": 327, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b09b66d0>\n\n    async def test_service_empty_entity_id_array(rest):\n        \"\"\"Calling a service with empty entity_id array is a no-op.\"\"\"\n        resp = await rest.client.post(\n            f\"{rest.base_url}/api/services/light/turn_on\",\n            json={\"entity_id\": []},\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 400 == 200\nE        +  where 400 = <Response [400 Bad Request]>.status_code\n\ntests/api/test_rest_error_handling.py:327: AssertionError"}, "teardown": {"duration": 0.0006254767067730427, "outcome": "passed"}}, {"nodeid": "tests/api/test_rest_error_handling.py::test_service_call_returns_200", "lineno": 329, "outcome": "failed", "keywords": ["test_service_call_returns_200", "test_rest_error_handling.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005259728990495205, "outcome": "passed"}, "call": {"duration": 0.0044447737745940685, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_rest_error_handling.py", "lineno": 340, "message": "assert 400 == 200\n +  where 400 = <Response [400 Bad Request]>.status_code"}, "traceback": [{"path": "tests/api/test_rest_error_handling.py", "lineno": 340, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b08fb160>\n\n    async def test_service_call_returns_200(rest):\n        \"\"\"POST /api/services/<domain>/<service> returns 200.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"switch.err_svc_{tag}\"\n        await rest.set_state(eid, \"off\")\n        resp = await rest.client.post(\n            f\"{rest.base_url}/api/services/switch/turn_on\",\n            headers=rest._headers(),\n            json={\"entity_id\": eid},\n        )\n>       assert resp.status_code == 200\nE       assert 400 == 200\nE        +  where 400 = <Response [400 Bad Request]>.status_code\n\ntests/api/test_rest_error_handling.py:340: AssertionError"}, "teardown": {"duration": 0.0006523630581796169, "outcome": "passed"}}, {"nodeid": "tests/api/test_rest_error_handling.py::test_service_call_returns_changed_states", "lineno": 342, "outcome": "failed", "keywords": ["test_service_call_returns_changed_states", "test_rest_error_handling.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005228980910032988, "outcome": "passed"}, "call": {"duration": 0.005220549181103706, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)"}, "traceback": [{"path": "tests/api/test_rest_error_handling.py", "lineno": 353, "message": ""}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 832, "message": "in json"}, {"path": "../../anaconda3/lib/python3.9/json/__init__.py", "lineno": 346, "message": "in loads"}, {"path": "../../anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "JSONDecodeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b05d7b20>\n\n    async def test_service_call_returns_changed_states(rest):\n        \"\"\"Service call response is a flat list of changed entity states.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"switch.err_chg_{tag}\"\n        await rest.set_state(eid, \"off\")\n        resp = await rest.client.post(\n            f\"{rest.base_url}/api/services/switch/turn_on\",\n            headers=rest._headers(),\n            json={\"entity_id\": eid},\n        )\n>       data = resp.json()\n\ntests/api/test_rest_error_handling.py:353: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:832: in json\n    return jsonlib.loads(self.content, **kwargs)\n../../anaconda3/lib/python3.9/json/__init__.py:346: in loads\n    return _default_decoder.decode(s)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <json.decoder.JSONDecoder object at 0x7f47b2e5fe50>\ns = '400: Bad Request'\n_w = <built-in method match of re.Pattern object at 0x7f47b3015cf0>\n\n    def decode(self, s, _w=WHITESPACE.match):\n        \"\"\"Return the Python representation of ``s`` (a ``str`` instance\n        containing a JSON document).\n    \n        \"\"\"\n        obj, end = self.raw_decode(s, idx=_w(s, 0).end())\n        end = _w(s, end).end()\n        if end != len(s):\n>           raise JSONDecodeError(\"Extra data\", s, end)\nE           json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)\n\n../../anaconda3/lib/python3.9/json/decoder.py:340: JSONDecodeError"}, "teardown": {"duration": 0.000649687834084034, "outcome": "passed"}}, {"nodeid": "tests/api/test_rest_error_handling.py::test_service_call_returns_json", "lineno": 358, "outcome": "failed", "keywords": ["test_service_call_returns_json", "test_rest_error_handling.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005393809173256159, "outcome": "passed"}, "call": {"duration": 0.004235038999468088, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_rest_error_handling.py", "lineno": 369, "message": "assert 400 == 200\n +  where 400 = <Response [400 Bad Request]>.status_code"}, "traceback": [{"path": "tests/api/test_rest_error_handling.py", "lineno": 369, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b090ca00>\n\n    async def test_service_call_returns_json(rest):\n        \"\"\"POST /api/services returns JSON response (dict or list).\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"light.resp_{tag}\"\n        await rest.set_state(eid, \"off\")\n        resp = await rest.client.post(\n            f\"{rest.base_url}/api/services/light/turn_on\",\n            json={\"entity_id\": eid},\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 400 == 200\nE        +  where 400 = <Response [400 Bad Request]>.status_code\n\ntests/api/test_rest_error_handling.py:369: AssertionError"}, "teardown": {"duration": 0.0006039501167833805, "outcome": "passed"}}, {"nodeid": "tests/api/test_rest_error_handling.py::test_fire_event_empty_type", "lineno": 376, "outcome": "passed", "keywords": ["test_fire_event_empty_type", "test_rest_error_handling.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005337139125913382, "outcome": "passed"}, "call": {"duration": 0.0026973970234394073, "outcome": "passed"}, "teardown": {"duration": 0.0004911972209811211, "outcome": "passed"}}, {"nodeid": "tests/api/test_rest_error_handling.py::test_fire_event_returns_200", "lineno": 387, "outcome": "passed", "keywords": ["test_fire_event_returns_200", "test_rest_error_handling.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.00513065280392766, "outcome": "passed"}, "call": {"duration": 0.0026802178472280502, "outcome": "passed"}, "teardown": {"duration": 0.0004658680409193039, "outcome": "passed"}}, {"nodeid": "tests/api/test_rest_error_handling.py::test_fire_event_empty_body", "lineno": 397, "outcome": "passed", "keywords": ["test_fire_event_empty_body", "test_rest_error_handling.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005225887056440115, "outcome": "passed"}, "call": {"duration": 0.0050573269836604595, "outcome": "passed"}, "teardown": {"duration": 0.00048631010577082634, "outcome": "passed"}}, {"nodeid": "tests/api/test_rest_error_handling.py::test_fire_event_with_special_chars", "lineno": 407, "outcome": "passed", "keywords": ["test_fire_event_with_special_chars", "test_rest_error_handling.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.0052494267001748085, "outcome": "passed"}, "call": {"duration": 0.0028081797063350677, "outcome": "passed"}, "teardown": {"duration": 0.0004848768003284931, "outcome": "passed"}}, {"nodeid": "tests/api/test_rest_error_handling.py::test_set_state_returns_entity_id", "lineno": 420, "outcome": "passed", "keywords": ["test_set_state_returns_entity_id", "test_rest_error_handling.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.00517084589228034, "outcome": "passed"}, "call": {"duration": 0.0026530628092586994, "outcome": "passed"}, "teardown": {"duration": 0.00047652702778577805, "outcome": "passed"}}, {"nodeid": "tests/api/test_rest_error_handling.py::test_set_state_returns_state", "lineno": 434, "outcome": "passed", "keywords": ["test_set_state_returns_state", "test_rest_error_handling.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005187466740608215, "outcome": "passed"}, "call": {"duration": 0.0051034679636359215, "outcome": "passed"}, "teardown": {"duration": 0.0005053458735346794, "outcome": "passed"}}, {"nodeid": "tests/api/test_rest_error_handling.py::test_set_state_returns_attributes", "lineno": 447, "outcome": "passed", "keywords": ["test_set_state_returns_attributes", "test_rest_error_handling.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005192485637962818, "outcome": "passed"}, "call": {"duration": 0.002719561103731394, "outcome": "passed"}, "teardown": {"duration": 0.0004958133213222027, "outcome": "passed"}}, {"nodeid": "tests/api/test_rest_error_handling.py::test_set_state_returns_entity_format", "lineno": 460, "outcome": "failed", "keywords": ["test_set_state_returns_entity_format", "test_rest_error_handling.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005599671974778175, "outcome": "passed"}, "call": {"duration": 0.0029751481488347054, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_rest_error_handling.py", "lineno": 470, "message": "assert 201 == 200\n +  where 201 = <Response [201 Created]>.status_code"}, "traceback": [{"path": "tests/api/test_rest_error_handling.py", "lineno": 470, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b085be50>\n\n    async def test_set_state_returns_entity_format(rest):\n        \"\"\"POST /api/states returns full entity JSON with timestamps and context.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"sensor.fmt_{tag}\"\n        resp = await rest.client.post(\n            f\"{rest.base_url}/api/states/{eid}\",\n            json={\"state\": \"value\", \"attributes\": {\"unit\": \"test\"}},\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 201 == 200\nE        +  where 201 = <Response [201 Created]>.status_code\n\ntests/api/test_rest_error_handling.py:470: AssertionError"}, "teardown": {"duration": 0.0007017571479082108, "outcome": "passed"}}, {"nodeid": "tests/api/test_rest_error_handling.py::test_set_state_preserves_entity_id_case", "lineno": 479, "outcome": "failed", "keywords": ["test_set_state_preserves_entity_id_case", "test_rest_error_handling.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005590163171291351, "outcome": "passed"}, "call": {"duration": 0.004340908024460077, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_rest_error_handling.py", "lineno": 486, "message": "AssertionError: assert 'sensor.camelcase_2500b6db' == 'sensor.CamelCase_2500b6db'\n  \n  - sensor.CamelCase_2500b6db\n  ?        ^    ^\n  + sensor.camelcase_2500b6db\n  ?        ^    ^"}, "traceback": [{"path": "tests/api/test_rest_error_handling.py", "lineno": 486, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0a02070>\n\n    async def test_set_state_preserves_entity_id_case(rest):\n        \"\"\"Entity IDs preserve case exactly as given.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"sensor.CamelCase_{tag}\"\n        await rest.set_state(eid, \"on\")\n        state = await rest.get_state(eid)\n>       assert state[\"entity_id\"] == eid\nE       AssertionError: assert 'sensor.camelcase_2500b6db' == 'sensor.CamelCase_2500b6db'\nE         \nE         - sensor.CamelCase_2500b6db\nE         ?        ^    ^\nE         + sensor.camelcase_2500b6db\nE         ?        ^    ^\n\ntests/api/test_rest_error_handling.py:486: AssertionError"}, "teardown": {"duration": 0.0007115672342479229, "outcome": "passed"}}, {"nodeid": "tests/api/test_rest_error_handling.py::test_health_no_auth_required", "lineno": 491, "outcome": "failed", "keywords": ["test_health_no_auth_required", "test_rest_error_handling.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.00544345797970891, "outcome": "passed"}, "call": {"duration": 0.0029617007821798325, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_rest_error_handling.py", "lineno": 495, "message": "assert 404 == 200\n +  where 404 = <Response [404 Not Found]>.status_code"}, "traceback": [{"path": "tests/api/test_rest_error_handling.py", "lineno": 495, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0a02bb0>\n\n    async def test_health_no_auth_required(rest):\n        \"\"\"Health endpoint works without specific auth and returns status ok.\"\"\"\n        resp = await rest.client.get(f\"{rest.base_url}/api/health\")\n>       assert resp.status_code == 200\nE       assert 404 == 200\nE        +  where 404 = <Response [404 Not Found]>.status_code\n\ntests/api/test_rest_error_handling.py:495: AssertionError"}, "teardown": {"duration": 0.0006592348217964172, "outcome": "passed"}}, {"nodeid": "tests/api/test_rest_error_handling.py::test_health_returns_version", "lineno": 499, "outcome": "failed", "keywords": ["test_health_returns_version", "test_rest_error_handling.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005185683257877827, "outcome": "passed"}, "call": {"duration": 0.0028476021252572536, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '404 Not Found' for url 'http://localhost:8123/api/health'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/404"}, "traceback": [{"path": "tests/api/test_rest_error_handling.py", "lineno": 502, "message": ""}, {"path": "tests/conftest.py", "lineno": 122, "message": "in get_health"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b07d4580>\n\n    async def test_health_returns_version(rest):\n        \"\"\"Health endpoint includes version.\"\"\"\n>       health = await rest.get_health()\n\ntests/api/test_rest_error_handling.py:502: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:122: in get_health\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [404 Not Found]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '404 Not Found' for url 'http://localhost:8123/api/health'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/404\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0006978362798690796, "outcome": "passed"}}, {"nodeid": "tests/api/test_rest_error_handling.py::test_health_returns_ws_connections", "lineno": 506, "outcome": "failed", "keywords": ["test_health_returns_ws_connections", "test_rest_error_handling.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.0053143491968512535, "outcome": "passed"}, "call": {"duration": 0.002593755256384611, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '404 Not Found' for url 'http://localhost:8123/api/health'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/404"}, "traceback": [{"path": "tests/api/test_rest_error_handling.py", "lineno": 509, "message": ""}, {"path": "tests/conftest.py", "lineno": 122, "message": "in get_health"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0720eb0>\n\n    async def test_health_returns_ws_connections(rest):\n        \"\"\"Health endpoint includes ws_connections count.\"\"\"\n>       health = await rest.get_health()\n\ntests/api/test_rest_error_handling.py:509: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:122: in get_health\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [404 Not Found]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '404 Not Found' for url 'http://localhost:8123/api/health'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/404\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0006771027110517025, "outcome": "passed"}}, {"nodeid": "tests/api/test_rest_error_handling.py::test_config_returns_valid_json", "lineno": 515, "outcome": "passed", "keywords": ["test_config_returns_valid_json", "test_rest_error_handling.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005452597979456186, "outcome": "passed"}, "call": {"duration": 0.002632745075970888, "outcome": "passed"}, "teardown": {"duration": 0.00045732874423265457, "outcome": "passed"}}, {"nodeid": "tests/api/test_rest_error_handling.py::test_config_check_returns_result", "lineno": 528, "outcome": "passed", "keywords": ["test_config_check_returns_result", "test_rest_error_handling.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005200991872698069, "outcome": "passed"}, "call": {"duration": 0.008856021333485842, "outcome": "passed"}, "teardown": {"duration": 0.0005684411153197289, "outcome": "passed"}}, {"nodeid": "tests/api/test_rest_error_handling.py::test_get_states_always_returns_list", "lineno": 544, "outcome": "passed", "keywords": ["test_get_states_always_returns_list", "test_rest_error_handling.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005193000193685293, "outcome": "passed"}, "call": {"duration": 0.005080854054540396, "outcome": "passed"}, "teardown": {"duration": 0.0005157091654837132, "outcome": "passed"}}, {"nodeid": "tests/api/test_rest_error_handling.py::test_api_root_returns_message", "lineno": 555, "outcome": "passed", "keywords": ["test_api_root_returns_message", "test_rest_error_handling.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.00548563664779067, "outcome": "passed"}, "call": {"duration": 0.002599540166556835, "outcome": "passed"}, "teardown": {"duration": 0.0004548272117972374, "outcome": "passed"}}, {"nodeid": "tests/api/test_rest_error_handling.py::test_token_create_empty_name", "lineno": 569, "outcome": "failed", "keywords": ["test_token_create_empty_name", "test_rest_error_handling.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005204563029110432, "outcome": "passed"}, "call": {"duration": 0.0025462270714342594, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_rest_error_handling.py", "lineno": 579, "message": "assert 404 in (200, 400)\n +  where 404 = <Response [404 Not Found]>.status_code"}, "traceback": [{"path": "tests/api/test_rest_error_handling.py", "lineno": 579, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b05a8be0>\n\n    async def test_token_create_empty_name(rest):\n        \"\"\"Creating token with empty name returns 400 or succeeds.\"\"\"\n        resp = await rest.client.post(\n            f\"{rest.base_url}/api/auth/tokens\",\n            json={\"name\": \"\"},\n            headers=rest._headers(),\n        )\n        # Empty string is still a valid name in many implementations\n        # Just verify it doesn't crash\n>       assert resp.status_code in (200, 400)\nE       assert 404 in (200, 400)\nE        +  where 404 = <Response [404 Not Found]>.status_code\n\ntests/api/test_rest_error_handling.py:579: AssertionError"}, "teardown": {"duration": 0.0006384360603988171, "outcome": "passed"}}, {"nodeid": "tests/api/test_rest_error_handling.py::test_delete_then_get_returns_none", "lineno": 584, "outcome": "passed", "keywords": ["test_delete_then_get_returns_none", "test_rest_error_handling.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005812676157802343, "outcome": "passed"}, "call": {"duration": 0.0056171962060034275, "outcome": "passed"}, "teardown": {"duration": 0.000548910815268755, "outcome": "passed"}}, {"nodeid": "tests/api/test_rest_error_handling.py::test_create_update_delete_lifecycle", "lineno": 598, "outcome": "passed", "keywords": ["test_create_update_delete_lifecycle", "test_rest_error_handling.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005413257982581854, "outcome": "passed"}, "call": {"duration": 0.01064380444586277, "outcome": "passed"}, "teardown": {"duration": 0.0005728430114686489, "outcome": "passed"}}, {"nodeid": "tests/api/test_rest_error_handling.py::test_concurrent_state_updates", "lineno": 624, "outcome": "passed", "keywords": ["test_concurrent_state_updates", "test_rest_error_handling.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005609322804957628, "outcome": "passed"}, "call": {"duration": 0.03488620324060321, "outcome": "passed"}, "teardown": {"duration": 0.0015809228643774986, "outcome": "passed"}}, {"nodeid": "tests/api/test_rest_error_handling.py::test_ws_unknown_command", "lineno": 640, "outcome": "failed", "keywords": ["test_ws_unknown_command", "test_rest_error_handling.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.0025857901200652122, "outcome": "passed"}, "call": {"duration": 0.0008084718137979507, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_rest_error_handling.py", "lineno": 645, "message": "AssertionError: assert 'Unknown' in ''\n +  where '' = <built-in method get of dict object at 0x7f47b09cd300>('message', '')\n +    where <built-in method get of dict object at 0x7f47b09cd300> = {}.get\n +      where {} = <built-in method get of dict object at 0x7f47b0543340>('result', {})\n +        where <built-in method get of dict object at 0x7f47b0543340> = {'error': {'code': 'unknown_command', 'message': 'Unknown command.'}, 'id': 1, 'success': False, 'type': 'result'}.get"}, "traceback": [{"path": "tests/api/test_rest_error_handling.py", "lineno": 645, "message": "AssertionError"}], "longrepr": "ws = <conftest.WSClient object at 0x7f47b082f7f0>\n\n    async def test_ws_unknown_command(ws):\n        \"\"\"WebSocket unknown command returns error result.\"\"\"\n        resp = await ws.send_command(\"totally_bogus_command\")\n        assert resp[\"success\"] is False\n>       assert \"Unknown\" in resp.get(\"result\", {}).get(\"message\", \"\")\nE       AssertionError: assert 'Unknown' in ''\nE        +  where '' = <built-in method get of dict object at 0x7f47b09cd300>('message', '')\nE        +    where <built-in method get of dict object at 0x7f47b09cd300> = {}.get\nE        +      where {} = <built-in method get of dict object at 0x7f47b0543340>('result', {})\nE        +        where <built-in method get of dict object at 0x7f47b0543340> = {'error': {'code': 'unknown_command', 'message': 'Unknown command.'}, 'id': 1, 'success': False, 'type': 'result'}.get\n\ntests/api/test_rest_error_handling.py:645: AssertionError"}, "teardown": {"duration": 0.0009323987178504467, "outcome": "passed"}}, {"nodeid": "tests/api/test_rest_error_handling.py::test_ws_call_service_missing_domain", "lineno": 647, "outcome": "failed", "keywords": ["test_ws_call_service_missing_domain", "test_rest_error_handling.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.002809467725455761, "outcome": "passed"}, "call": {"duration": 0.000777300912886858, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_rest_error_handling.py", "lineno": 653, "message": "assert False is True"}, "traceback": [{"path": "tests/api/test_rest_error_handling.py", "lineno": 653, "message": "AssertionError"}], "longrepr": "ws = <conftest.WSClient object at 0x7f47b0663160>\n\n    async def test_ws_call_service_missing_domain(ws):\n        \"\"\"WebSocket call_service with empty domain doesn't crash.\"\"\"\n        resp = await ws.send_command(\"call_service\",\n            domain=\"\", service=\"\", service_data={})\n        assert resp[\"type\"] == \"result\"\n>       assert resp[\"success\"] is True\nE       assert False is True\n\ntests/api/test_rest_error_handling.py:653: AssertionError"}, "teardown": {"duration": 0.001057170331478119, "outcome": "passed"}}, {"nodeid": "tests/api/test_rest_notification_endpoints.py::test_list_notifications_returns_200", "lineno": 24, "outcome": "failed", "keywords": ["test_list_notifications_returns_200", "test_rest_notification_endpoints.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005458632949739695, "outcome": "passed"}, "call": {"duration": 0.0027401531115174294, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_rest_notification_endpoints.py", "lineno": 31, "message": "assert 404 == 200\n +  where 404 = <Response [404 Not Found]>.status_code"}, "traceback": [{"path": "tests/api/test_rest_notification_endpoints.py", "lineno": 31, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0731b80>\n\n    async def test_list_notifications_returns_200(rest):\n        \"\"\"GET /api/notifications returns 200.\"\"\"\n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/notifications\",\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 404 == 200\nE        +  where 404 = <Response [404 Not Found]>.status_code\n\ntests/api/test_rest_notification_endpoints.py:31: AssertionError"}, "teardown": {"duration": 0.0005758116021752357, "outcome": "passed"}}, {"nodeid": "tests/api/test_rest_notification_endpoints.py::test_list_notifications_is_array", "lineno": 33, "outcome": "failed", "keywords": ["test_list_notifications_is_array", "test_rest_notification_endpoints.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005232113879173994, "outcome": "passed"}, "call": {"duration": 0.002479757182300091, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)"}, "traceback": [{"path": "tests/api/test_rest_notification_endpoints.py", "lineno": 40, "message": ""}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 832, "message": "in json"}, {"path": "../../anaconda3/lib/python3.9/json/__init__.py", "lineno": 346, "message": "in loads"}, {"path": "../../anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "JSONDecodeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b12908b0>\n\n    async def test_list_notifications_is_array(rest):\n        \"\"\"GET /api/notifications returns JSON array.\"\"\"\n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/notifications\",\n            headers=rest._headers(),\n        )\n>       assert isinstance(resp.json(), list)\n\ntests/api/test_rest_notification_endpoints.py:40: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:832: in json\n    return jsonlib.loads(self.content, **kwargs)\n../../anaconda3/lib/python3.9/json/__init__.py:346: in loads\n    return _default_decoder.decode(s)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <json.decoder.JSONDecoder object at 0x7f47b2e5fe50>, s = '404: Not Found'\n_w = <built-in method match of re.Pattern object at 0x7f47b3015cf0>\n\n    def decode(self, s, _w=WHITESPACE.match):\n        \"\"\"Return the Python representation of ``s`` (a ``str`` instance\n        containing a JSON document).\n    \n        \"\"\"\n        obj, end = self.raw_decode(s, idx=_w(s, 0).end())\n        end = _w(s, end).end()\n        if end != len(s):\n>           raise JSONDecodeError(\"Extra data\", s, end)\nE           json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)\n\n../../anaconda3/lib/python3.9/json/decoder.py:340: JSONDecodeError"}, "teardown": {"duration": 0.000635483767837286, "outcome": "passed"}}, {"nodeid": "tests/api/test_rest_notification_endpoints.py::test_created_notification_appears", "lineno": 42, "outcome": "failed", "keywords": ["test_created_notification_appears", "test_rest_notification_endpoints.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005507843103259802, "outcome": "passed"}, "call": {"duration": 0.20565838692709804, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)"}, "traceback": [{"path": "tests/api/test_rest_notification_endpoints.py", "lineno": 53, "message": ""}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 832, "message": "in json"}, {"path": "../../anaconda3/lib/python3.9/json/__init__.py", "lineno": 346, "message": "in loads"}, {"path": "../../anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "JSONDecodeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b09bd790>\n\n    async def test_created_notification_appears(rest):\n        \"\"\"Created notification appears in listing.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        nid = f\"rest_notif_{tag}\"\n        await create_notification(rest, nid, f\"Title {tag}\", f\"Message {tag}\")\n    \n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/notifications\",\n            headers=rest._headers(),\n        )\n>       ids = [n.get(\"notification_id\") for n in resp.json()]\n\ntests/api/test_rest_notification_endpoints.py:53: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:832: in json\n    return jsonlib.loads(self.content, **kwargs)\n../../anaconda3/lib/python3.9/json/__init__.py:346: in loads\n    return _default_decoder.decode(s)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <json.decoder.JSONDecoder object at 0x7f47b2e5fe50>, s = '404: Not Found'\n_w = <built-in method match of re.Pattern object at 0x7f47b3015cf0>\n\n    def decode(self, s, _w=WHITESPACE.match):\n        \"\"\"Return the Python representation of ``s`` (a ``str`` instance\n        containing a JSON document).\n    \n        \"\"\"\n        obj, end = self.raw_decode(s, idx=_w(s, 0).end())\n        end = _w(s, end).end()\n        if end != len(s):\n>           raise JSONDecodeError(\"Extra data\", s, end)\nE           json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)\n\n../../anaconda3/lib/python3.9/json/decoder.py:340: JSONDecodeError"}, "teardown": {"duration": 0.0007497919723391533, "outcome": "passed"}}, {"nodeid": "tests/api/test_rest_notification_endpoints.py::test_notification_has_title_and_message", "lineno": 56, "outcome": "failed", "keywords": ["test_notification_has_title_and_message", "test_rest_notification_endpoints.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005362764000892639, "outcome": "passed"}, "call": {"duration": 0.20558149181306362, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)"}, "traceback": [{"path": "tests/api/test_rest_notification_endpoints.py", "lineno": 68, "message": ""}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 832, "message": "in json"}, {"path": "../../anaconda3/lib/python3.9/json/__init__.py", "lineno": 346, "message": "in loads"}, {"path": "../../anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "JSONDecodeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0761820>\n\n    async def test_notification_has_title_and_message(rest):\n        \"\"\"Notification entry has title and message fields.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        nid = f\"rest_fields_{tag}\"\n        await create_notification(rest, nid, f\"Title {tag}\", f\"Msg {tag}\")\n    \n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/notifications\",\n            headers=rest._headers(),\n        )\n        entry = next(\n>           (n for n in resp.json() if n.get(\"notification_id\") == nid),\n            None,\n        )\n\ntests/api/test_rest_notification_endpoints.py:68: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:832: in json\n    return jsonlib.loads(self.content, **kwargs)\n../../anaconda3/lib/python3.9/json/__init__.py:346: in loads\n    return _default_decoder.decode(s)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <json.decoder.JSONDecoder object at 0x7f47b2e5fe50>, s = '404: Not Found'\n_w = <built-in method match of re.Pattern object at 0x7f47b3015cf0>\n\n    def decode(self, s, _w=WHITESPACE.match):\n        \"\"\"Return the Python representation of ``s`` (a ``str`` instance\n        containing a JSON document).\n    \n        \"\"\"\n        obj, end = self.raw_decode(s, idx=_w(s, 0).end())\n        end = _w(s, end).end()\n        if end != len(s):\n>           raise JSONDecodeError(\"Extra data\", s, end)\nE           json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)\n\n../../anaconda3/lib/python3.9/json/decoder.py:340: JSONDecodeError"}, "teardown": {"duration": 0.0007130727171897888, "outcome": "passed"}}, {"nodeid": "tests/api/test_rest_notification_endpoints.py::test_dismiss_notification_via_rest", "lineno": 75, "outcome": "failed", "keywords": ["test_dismiss_notification_via_rest", "test_rest_notification_endpoints.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005206551868468523, "outcome": "passed"}, "call": {"duration": 0.20558976009488106, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_rest_notification_endpoints.py", "lineno": 86, "message": "assert 404 == 200\n +  where 404 = <Response [404 Not Found]>.status_code"}, "traceback": [{"path": "tests/api/test_rest_notification_endpoints.py", "lineno": 86, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0690100>\n\n    async def test_dismiss_notification_via_rest(rest):\n        \"\"\"POST /api/notifications/:id/dismiss removes notification.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        nid = f\"rest_dismiss_{tag}\"\n        await create_notification(rest, nid)\n    \n        resp = await rest.client.post(\n            f\"{rest.base_url}/api/notifications/{nid}/dismiss\",\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 404 == 200\nE        +  where 404 = <Response [404 Not Found]>.status_code\n\ntests/api/test_rest_notification_endpoints.py:86: AssertionError"}, "teardown": {"duration": 0.0007892828434705734, "outcome": "passed"}}, {"nodeid": "tests/api/test_rest_notification_endpoints.py::test_dismiss_nonexistent_notification", "lineno": 96, "outcome": "passed", "keywords": ["test_dismiss_nonexistent_notification", "test_rest_notification_endpoints.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005178921855986118, "outcome": "passed"}, "call": {"duration": 0.0029972530901432037, "outcome": "passed"}, "teardown": {"duration": 0.0007179398089647293, "outcome": "passed"}}, {"nodeid": "tests/api/test_rest_notification_endpoints.py::test_dismiss_all_notifications", "lineno": 106, "outcome": "failed", "keywords": ["test_dismiss_all_notifications", "test_rest_notification_endpoints.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.0055211870931088924, "outcome": "passed"}, "call": {"duration": 0.6175600299611688, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_rest_notification_endpoints.py", "lineno": 117, "message": "assert 404 == 200\n +  where 404 = <Response [404 Not Found]>.status_code"}, "traceback": [{"path": "tests/api/test_rest_notification_endpoints.py", "lineno": 117, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b090ed90>\n\n    async def test_dismiss_all_notifications(rest):\n        \"\"\"POST /api/notifications/dismiss_all clears all.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        for i in range(3):\n            await create_notification(rest, f\"rest_all_{tag}_{i}\", f\"Title {i}\")\n    \n        resp = await rest.client.post(\n            f\"{rest.base_url}/api/notifications/dismiss_all\",\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 404 == 200\nE        +  where 404 = <Response [404 Not Found]>.status_code\n\ntests/api/test_rest_notification_endpoints.py:117: AssertionError"}, "teardown": {"duration": 0.002162646036595106, "outcome": "passed"}}, {"nodeid": "tests/api/test_rest_notification_endpoints.py::test_create_overwrite_notification", "lineno": 126, "outcome": "failed", "keywords": ["test_create_overwrite_notification", "test_rest_notification_endpoints.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.023521908093243837, "outcome": "passed"}, "call": {"duration": 0.41043604305014014, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)"}, "traceback": [{"path": "tests/api/test_rest_notification_endpoints.py", "lineno": 139, "message": ""}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 832, "message": "in json"}, {"path": "../../anaconda3/lib/python3.9/json/__init__.py", "lineno": 346, "message": "in loads"}, {"path": "../../anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "JSONDecodeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0549430>\n\n    async def test_create_overwrite_notification(rest):\n        \"\"\"Creating with same ID overwrites title/message.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        nid = f\"rest_over_{tag}\"\n        await create_notification(rest, nid, \"Original\", \"Original body\")\n        await create_notification(rest, nid, \"Updated\", \"Updated body\")\n    \n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/notifications\",\n            headers=rest._headers(),\n        )\n        entry = next(\n>           (n for n in resp.json() if n.get(\"notification_id\") == nid),\n            None,\n        )\n\ntests/api/test_rest_notification_endpoints.py:139: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:832: in json\n    return jsonlib.loads(self.content, **kwargs)\n../../anaconda3/lib/python3.9/json/__init__.py:346: in loads\n    return _default_decoder.decode(s)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <json.decoder.JSONDecoder object at 0x7f47b2e5fe50>, s = '404: Not Found'\n_w = <built-in method match of re.Pattern object at 0x7f47b3015cf0>\n\n    def decode(self, s, _w=WHITESPACE.match):\n        \"\"\"Return the Python representation of ``s`` (a ``str`` instance\n        containing a JSON document).\n    \n        \"\"\"\n        obj, end = self.raw_decode(s, idx=_w(s, 0).end())\n        end = _w(s, end).end()\n        if end != len(s):\n>           raise JSONDecodeError(\"Extra data\", s, end)\nE           json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)\n\n../../anaconda3/lib/python3.9/json/decoder.py:340: JSONDecodeError"}, "teardown": {"duration": 0.000745491124689579, "outcome": "passed"}}, {"nodeid": "tests/api/test_rest_notification_endpoints.py::test_notification_has_created_at", "lineno": 146, "outcome": "failed", "keywords": ["test_notification_has_created_at", "test_rest_notification_endpoints.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005227288696914911, "outcome": "passed"}, "call": {"duration": 0.20563339535146952, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)"}, "traceback": [{"path": "tests/api/test_rest_notification_endpoints.py", "lineno": 158, "message": ""}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 832, "message": "in json"}, {"path": "../../anaconda3/lib/python3.9/json/__init__.py", "lineno": 346, "message": "in loads"}, {"path": "../../anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "JSONDecodeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b05492b0>\n\n    async def test_notification_has_created_at(rest):\n        \"\"\"Notification entry has created_at field.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        nid = f\"rest_ts_{tag}\"\n        await create_notification(rest, nid)\n    \n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/notifications\",\n            headers=rest._headers(),\n        )\n        entry = next(\n>           (n for n in resp.json() if n.get(\"notification_id\") == nid),\n            None,\n        )\n\ntests/api/test_rest_notification_endpoints.py:158: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:832: in json\n    return jsonlib.loads(self.content, **kwargs)\n../../anaconda3/lib/python3.9/json/__init__.py:346: in loads\n    return _default_decoder.decode(s)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <json.decoder.JSONDecoder object at 0x7f47b2e5fe50>, s = '404: Not Found'\n_w = <built-in method match of re.Pattern object at 0x7f47b3015cf0>\n\n    def decode(self, s, _w=WHITESPACE.match):\n        \"\"\"Return the Python representation of ``s`` (a ``str`` instance\n        containing a JSON document).\n    \n        \"\"\"\n        obj, end = self.raw_decode(s, idx=_w(s, 0).end())\n        end = _w(s, end).end()\n        if end != len(s):\n>           raise JSONDecodeError(\"Extra data\", s, end)\nE           json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)\n\n../../anaconda3/lib/python3.9/json/decoder.py:340: JSONDecodeError"}, "teardown": {"duration": 0.0010509700514376163, "outcome": "passed"}}, {"nodeid": "tests/api/test_rest_service_arrays.py::test_entity_id_array_turn_on", "lineno": 12, "outcome": "failed", "keywords": ["test_entity_id_array_turn_on", "test_rest_service_arrays.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.0077609289437532425, "outcome": "passed"}, "call": {"duration": 0.009831225965172052, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_rest_service_arrays.py", "lineno": 23, "message": "assert 400 == 200\n +  where 400 = <Response [400 Bad Request]>.status_code"}, "traceback": [{"path": "tests/api/test_rest_service_arrays.py", "lineno": 23, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0731b80>\n\n    async def test_entity_id_array_turn_on(rest):\n        \"\"\"Service call with entity_id array turns on all.\"\"\"\n        for i in range(3):\n            await rest.set_state(f\"light.arr_on_{i}\", \"off\")\n    \n        resp = await rest.client.post(\n            f\"{rest.base_url}/api/services/light/turn_on\",\n            json={\"entity_id\": [\"light.arr_on_0\", \"light.arr_on_1\", \"light.arr_on_2\"]},\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 400 == 200\nE        +  where 400 = <Response [400 Bad Request]>.status_code\n\ntests/api/test_rest_service_arrays.py:23: AssertionError"}, "teardown": {"duration": 0.000718194991350174, "outcome": "passed"}}, {"nodeid": "tests/api/test_rest_service_arrays.py::test_entity_id_array_turn_off", "lineno": 32, "outcome": "failed", "keywords": ["test_entity_id_array_turn_off", "test_rest_service_arrays.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.007676050066947937, "outcome": "passed"}, "call": {"duration": 0.007854764349758625, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_rest_service_arrays.py", "lineno": 43, "message": "assert 400 == 200\n +  where 400 = <Response [400 Bad Request]>.status_code"}, "traceback": [{"path": "tests/api/test_rest_service_arrays.py", "lineno": 43, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b07dd940>\n\n    async def test_entity_id_array_turn_off(rest):\n        \"\"\"Service call with entity_id array turns off all.\"\"\"\n        for i in range(2):\n            await rest.set_state(f\"switch.arr_off_{i}\", \"on\")\n    \n        resp = await rest.client.post(\n            f\"{rest.base_url}/api/services/switch/turn_off\",\n            json={\"entity_id\": [\"switch.arr_off_0\", \"switch.arr_off_1\"]},\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 400 == 200\nE        +  where 400 = <Response [400 Bad Request]>.status_code\n\ntests/api/test_rest_service_arrays.py:43: AssertionError"}, "teardown": {"duration": 0.0008127549663186073, "outcome": "passed"}}, {"nodeid": "tests/api/test_rest_service_arrays.py::test_target_entity_id_pattern", "lineno": 47, "outcome": "failed", "keywords": ["test_target_entity_id_pattern", "test_rest_service_arrays.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.006824741140007973, "outcome": "passed"}, "call": {"duration": 0.0049947937950491905, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_rest_service_arrays.py", "lineno": 56, "message": "assert 400 == 200\n +  where 400 = <Response [400 Bad Request]>.status_code"}, "traceback": [{"path": "tests/api/test_rest_service_arrays.py", "lineno": 56, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b13a0e50>\n\n    async def test_target_entity_id_pattern(rest):\n        \"\"\"Service call with target.entity_id pattern works.\"\"\"\n        await rest.set_state(\"light.arr_target\", \"off\")\n        resp = await rest.client.post(\n            f\"{rest.base_url}/api/services/light/turn_on\",\n            json={\"target\": {\"entity_id\": \"light.arr_target\"}},\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 400 == 200\nE        +  where 400 = <Response [400 Bad Request]>.status_code\n\ntests/api/test_rest_service_arrays.py:56: AssertionError"}, "teardown": {"duration": 0.0006241379305720329, "outcome": "passed"}}, {"nodeid": "tests/api/test_rest_service_arrays.py::test_target_entity_id_array_pattern", "lineno": 60, "outcome": "failed", "keywords": ["test_target_entity_id_array_pattern", "test_rest_service_arrays.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.006504691205918789, "outcome": "passed"}, "call": {"duration": 0.006209258921444416, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_rest_service_arrays.py", "lineno": 71, "message": "assert 400 == 200\n +  where 400 = <Response [400 Bad Request]>.status_code"}, "traceback": [{"path": "tests/api/test_rest_service_arrays.py", "lineno": 71, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0911b50>\n\n    async def test_target_entity_id_array_pattern(rest):\n        \"\"\"Service call with target.entity_id array pattern works.\"\"\"\n        for i in range(2):\n            await rest.set_state(f\"light.arr_ta_{i}\", \"off\")\n    \n        resp = await rest.client.post(\n            f\"{rest.base_url}/api/services/light/turn_on\",\n            json={\"target\": {\"entity_id\": [\"light.arr_ta_0\", \"light.arr_ta_1\"]}},\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 400 == 200\nE        +  where 400 = <Response [400 Bad Request]>.status_code\n\ntests/api/test_rest_service_arrays.py:71: AssertionError"}, "teardown": {"duration": 0.000589683186262846, "outcome": "passed"}}, {"nodeid": "tests/api/test_rest_service_arrays.py::test_service_with_data_array", "lineno": 77, "outcome": "failed", "keywords": ["test_service_with_data_array", "test_rest_service_arrays.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.006148065440356731, "outcome": "passed"}, "call": {"duration": 0.005396498832851648, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_rest_service_arrays.py", "lineno": 91, "message": "assert 400 == 200\n +  where 400 = <Response [400 Bad Request]>.status_code"}, "traceback": [{"path": "tests/api/test_rest_service_arrays.py", "lineno": 91, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0965a90>\n\n    async def test_service_with_data_array(rest):\n        \"\"\"Service call with entity array passes data to all.\"\"\"\n        for i in range(2):\n            await rest.set_state(f\"light.arr_data_{i}\", \"off\")\n    \n        resp = await rest.client.post(\n            f\"{rest.base_url}/api/services/light/turn_on\",\n            json={\n                \"entity_id\": [\"light.arr_data_0\", \"light.arr_data_1\"],\n                \"brightness\": 200,\n            },\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 400 == 200\nE        +  where 400 = <Response [400 Bad Request]>.status_code\n\ntests/api/test_rest_service_arrays.py:91: AssertionError"}, "teardown": {"duration": 0.0005111186765134335, "outcome": "passed"}}, {"nodeid": "tests/api/test_rest_service_arrays.py::test_service_changed_states_all_fields", "lineno": 98, "outcome": "failed", "keywords": ["test_service_changed_states_all_fields", "test_rest_service_arrays.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.007023267913609743, "outcome": "passed"}, "call": {"duration": 0.006383049767464399, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)"}, "traceback": [{"path": "tests/api/test_rest_service_arrays.py", "lineno": 109, "message": ""}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 832, "message": "in json"}, {"path": "../../anaconda3/lib/python3.9/json/__init__.py", "lineno": 346, "message": "in loads"}, {"path": "../../anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "JSONDecodeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b08f39d0>\n\n    async def test_service_changed_states_all_fields(rest):\n        \"\"\"Changed states from array call have all required fields.\"\"\"\n        await rest.set_state(\"light.arr_fields_1\", \"off\")\n        await rest.set_state(\"light.arr_fields_2\", \"off\")\n    \n        resp = await rest.client.post(\n            f\"{rest.base_url}/api/services/light/turn_on\",\n            json={\"entity_id\": [\"light.arr_fields_1\", \"light.arr_fields_2\"]},\n            headers=rest._headers(),\n        )\n>       data = resp.json()\n\ntests/api/test_rest_service_arrays.py:109: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:832: in json\n    return jsonlib.loads(self.content, **kwargs)\n../../anaconda3/lib/python3.9/json/__init__.py:346: in loads\n    return _default_decoder.decode(s)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <json.decoder.JSONDecoder object at 0x7f47b2e5fe50>\ns = '400: Bad Request'\n_w = <built-in method match of re.Pattern object at 0x7f47b3015cf0>\n\n    def decode(self, s, _w=WHITESPACE.match):\n        \"\"\"Return the Python representation of ``s`` (a ``str`` instance\n        containing a JSON document).\n    \n        \"\"\"\n        obj, end = self.raw_decode(s, idx=_w(s, 0).end())\n        end = _w(s, end).end()\n        if end != len(s):\n>           raise JSONDecodeError(\"Extra data\", s, end)\nE           json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)\n\n../../anaconda3/lib/python3.9/json/decoder.py:340: JSONDecodeError"}, "teardown": {"duration": 0.0006915493868291378, "outcome": "passed"}}, {"nodeid": "tests/api/test_rest_service_arrays.py::test_homeassistant_turn_on_array", "lineno": 118, "outcome": "failed", "keywords": ["test_homeassistant_turn_on_array", "test_rest_service_arrays.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005450851283967495, "outcome": "passed"}, "call": {"duration": 0.008088157046586275, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_rest_service_arrays.py", "lineno": 133, "message": "AssertionError: assert 'off' == 'on'\n  \n  - on\n  + off"}, "traceback": [{"path": "tests/api/test_rest_service_arrays.py", "lineno": 133, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b085bd00>\n\n    async def test_homeassistant_turn_on_array(rest):\n        \"\"\"homeassistant.turn_on with entity array.\"\"\"\n        await rest.set_state(\"light.arr_ha_1\", \"off\")\n        await rest.set_state(\"switch.arr_ha_2\", \"off\")\n    \n        resp = await rest.client.post(\n            f\"{rest.base_url}/api/services/homeassistant/turn_on\",\n            json={\"entity_id\": [\"light.arr_ha_1\", \"switch.arr_ha_2\"]},\n            headers=rest._headers(),\n        )\n        assert resp.status_code == 200\n    \n        s1 = await rest.get_state(\"light.arr_ha_1\")\n        s2 = await rest.get_state(\"switch.arr_ha_2\")\n>       assert s1[\"state\"] == \"on\"\nE       AssertionError: assert 'off' == 'on'\nE         \nE         - on\nE         + off\n\ntests/api/test_rest_service_arrays.py:133: AssertionError"}, "teardown": {"duration": 0.0004921108484268188, "outcome": "passed"}}, {"nodeid": "tests/api/test_rest_service_arrays.py::test_toggle_array", "lineno": 136, "outcome": "failed", "keywords": ["test_toggle_array", "test_rest_service_arrays.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005141128320246935, "outcome": "passed"}, "call": {"duration": 0.005259015131741762, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_rest_service_arrays.py", "lineno": 147, "message": "assert 400 == 200\n +  where 400 = <Response [400 Bad Request]>.status_code"}, "traceback": [{"path": "tests/api/test_rest_service_arrays.py", "lineno": 147, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b05aa2e0>\n\n    async def test_toggle_array(rest):\n        \"\"\"Toggle with entity array flips all states.\"\"\"\n        await rest.set_state(\"switch.arr_tog_1\", \"on\")\n        await rest.set_state(\"switch.arr_tog_2\", \"off\")\n    \n        resp = await rest.client.post(\n            f\"{rest.base_url}/api/services/switch/toggle\",\n            json={\"entity_id\": [\"switch.arr_tog_1\", \"switch.arr_tog_2\"]},\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 400 == 200\nE        +  where 400 = <Response [400 Bad Request]>.status_code\n\ntests/api/test_rest_service_arrays.py:147: AssertionError"}, "teardown": {"duration": 0.0006927931681275368, "outcome": "passed"}}, {"nodeid": "tests/api/test_rest_service_dispatch_patterns.py::test_service_array_entity_id", "lineno": 17, "outcome": "failed", "keywords": ["test_service_array_entity_id", "test_rest_service_dispatch_patterns.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.00607051607221365, "outcome": "passed"}, "call": {"duration": 0.006491680163890123, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_rest_service_dispatch_patterns.py", "lineno": 30, "message": "assert 400 == 200\n +  where 400 = <Response [400 Bad Request]>.status_code"}, "traceback": [{"path": "tests/api/test_rest_service_dispatch_patterns.py", "lineno": 30, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b09e64c0>\n\n    async def test_service_array_entity_id(rest):\n        \"\"\"Service call with array entity_id affects all entities.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eids = [f\"switch.arr_{tag}_{i}\" for i in range(3)]\n        for eid in eids:\n            await rest.set_state(eid, \"off\")\n    \n        resp = await rest.client.post(\n            f\"{rest.base_url}/api/services/switch/turn_on\",\n            json={\"entity_id\": eids},\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 400 == 200\nE        +  where 400 = <Response [400 Bad Request]>.status_code\n\ntests/api/test_rest_service_dispatch_patterns.py:30: AssertionError"}, "teardown": {"duration": 0.0006185299716889858, "outcome": "passed"}}, {"nodeid": "tests/api/test_rest_service_dispatch_patterns.py::test_service_single_entity_id_string", "lineno": 36, "outcome": "failed", "keywords": ["test_service_single_entity_id_string", "test_rest_service_dispatch_patterns.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005198406986892223, "outcome": "passed"}, "call": {"duration": 0.0039962297305464745, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/light/turn_on'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/api/test_rest_service_dispatch_patterns.py", "lineno": 43, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b09e2400>\n\n    async def test_service_single_entity_id_string(rest):\n        \"\"\"Service call with string entity_id works.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"light.single_{tag}\"\n        await rest.set_state(eid, \"off\")\n    \n>       await rest.call_service(\"light\", \"turn_on\", {\"entity_id\": eid})\n\ntests/api/test_rest_service_dispatch_patterns.py:43: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/light/turn_on'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0006907959468662739, "outcome": "passed"}}, {"nodeid": "tests/api/test_rest_service_dispatch_patterns.py::test_service_target_entity_id", "lineno": 50, "outcome": "failed", "keywords": ["test_service_target_entity_id", "test_rest_service_dispatch_patterns.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005189590621739626, "outcome": "passed"}, "call": {"duration": 0.004154912196099758, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_rest_service_dispatch_patterns.py", "lineno": 62, "message": "assert 400 == 200\n +  where 400 = <Response [400 Bad Request]>.status_code"}, "traceback": [{"path": "tests/api/test_rest_service_dispatch_patterns.py", "lineno": 62, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0761790>\n\n    async def test_service_target_entity_id(rest):\n        \"\"\"Service call with target.entity_id dispatches correctly.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"switch.target_{tag}\"\n        await rest.set_state(eid, \"off\")\n    \n        resp = await rest.client.post(\n            f\"{rest.base_url}/api/services/switch/turn_on\",\n            json={\"target\": {\"entity_id\": eid}},\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 400 == 200\nE        +  where 400 = <Response [400 Bad Request]>.status_code\n\ntests/api/test_rest_service_dispatch_patterns.py:62: AssertionError"}, "teardown": {"duration": 0.0006667822599411011, "outcome": "passed"}}, {"nodeid": "tests/api/test_rest_service_dispatch_patterns.py::test_service_target_array_entity_id", "lineno": 67, "outcome": "failed", "keywords": ["test_service_target_array_entity_id", "test_rest_service_dispatch_patterns.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.0050916471518576145, "outcome": "passed"}, "call": {"duration": 0.005515575874596834, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_rest_service_dispatch_patterns.py", "lineno": 80, "message": "assert 400 == 200\n +  where 400 = <Response [400 Bad Request]>.status_code"}, "traceback": [{"path": "tests/api/test_rest_service_dispatch_patterns.py", "lineno": 80, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0541b80>\n\n    async def test_service_target_array_entity_id(rest):\n        \"\"\"Service call with target.entity_id as array.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eids = [f\"light.tarr_{tag}_{i}\" for i in range(2)]\n        for eid in eids:\n            await rest.set_state(eid, \"off\")\n    \n        resp = await rest.client.post(\n            f\"{rest.base_url}/api/services/light/turn_on\",\n            json={\"target\": {\"entity_id\": eids}},\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 400 == 200\nE        +  where 400 = <Response [400 Bad Request]>.status_code\n\ntests/api/test_rest_service_dispatch_patterns.py:80: AssertionError"}, "teardown": {"duration": 0.0006407704204320908, "outcome": "passed"}}, {"nodeid": "tests/api/test_rest_service_dispatch_patterns.py::test_automation_trigger_service", "lineno": 88, "outcome": "passed", "keywords": ["test_automation_trigger_service", "test_rest_service_dispatch_patterns.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.006896051112562418, "outcome": "passed"}, "call": {"duration": 0.0032563302665948868, "outcome": "passed"}, "teardown": {"duration": 0.0007539200596511364, "outcome": "passed"}}, {"nodeid": "tests/api/test_rest_service_dispatch_patterns.py::test_automation_turn_off_service", "lineno": 99, "outcome": "failed", "keywords": ["test_automation_turn_off_service", "test_rest_service_dispatch_patterns.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005326422397047281, "outcome": "passed"}, "call": {"duration": 0.002691942732781172, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)"}, "traceback": [{"path": "tests/api/test_rest_service_dispatch_patterns.py", "lineno": 107, "message": ""}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 832, "message": "in json"}, {"path": "../../anaconda3/lib/python3.9/json/__init__.py", "lineno": 346, "message": "in loads"}, {"path": "../../anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "JSONDecodeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b12729d0>\n\n    async def test_automation_turn_off_service(rest):\n        \"\"\"automation.turn_off disables an automation (sets state to off).\"\"\"\n        # The loaded automations should have some real IDs\n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/config/automation/config\",\n            headers=rest._headers(),\n        )\n>       autos = resp.json()\n\ntests/api/test_rest_service_dispatch_patterns.py:107: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:832: in json\n    return jsonlib.loads(self.content, **kwargs)\n../../anaconda3/lib/python3.9/json/__init__.py:346: in loads\n    return _default_decoder.decode(s)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <json.decoder.JSONDecoder object at 0x7f47b2e5fe50>, s = '404: Not Found'\n_w = <built-in method match of re.Pattern object at 0x7f47b3015cf0>\n\n    def decode(self, s, _w=WHITESPACE.match):\n        \"\"\"Return the Python representation of ``s`` (a ``str`` instance\n        containing a JSON document).\n    \n        \"\"\"\n        obj, end = self.raw_decode(s, idx=_w(s, 0).end())\n        end = _w(s, end).end()\n        if end != len(s):\n>           raise JSONDecodeError(\"Extra data\", s, end)\nE           json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)\n\n../../anaconda3/lib/python3.9/json/decoder.py:340: JSONDecodeError"}, "teardown": {"duration": 0.0006659841164946556, "outcome": "passed"}}, {"nodeid": "tests/api/test_rest_service_dispatch_patterns.py::test_automation_toggle_service", "lineno": 121, "outcome": "failed", "keywords": ["test_automation_toggle_service", "test_rest_service_dispatch_patterns.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.0051608458161354065, "outcome": "passed"}, "call": {"duration": 0.0032791481353342533, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)"}, "traceback": [{"path": "tests/api/test_rest_service_dispatch_patterns.py", "lineno": 128, "message": ""}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 832, "message": "in json"}, {"path": "../../anaconda3/lib/python3.9/json/__init__.py", "lineno": 346, "message": "in loads"}, {"path": "../../anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "JSONDecodeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b085bb50>\n\n    async def test_automation_toggle_service(rest):\n        \"\"\"automation.toggle flips enabled state.\"\"\"\n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/config/automation/config\",\n            headers=rest._headers(),\n        )\n>       autos = resp.json()\n\ntests/api/test_rest_service_dispatch_patterns.py:128: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:832: in json\n    return jsonlib.loads(self.content, **kwargs)\n../../anaconda3/lib/python3.9/json/__init__.py:346: in loads\n    return _default_decoder.decode(s)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <json.decoder.JSONDecoder object at 0x7f47b2e5fe50>, s = '404: Not Found'\n_w = <built-in method match of re.Pattern object at 0x7f47b3015cf0>\n\n    def decode(self, s, _w=WHITESPACE.match):\n        \"\"\"Return the Python representation of ``s`` (a ``str`` instance\n        containing a JSON document).\n    \n        \"\"\"\n        obj, end = self.raw_decode(s, idx=_w(s, 0).end())\n        end = _w(s, end).end()\n        if end != len(s):\n>           raise JSONDecodeError(\"Extra data\", s, end)\nE           json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)\n\n../../anaconda3/lib/python3.9/json/decoder.py:340: JSONDecodeError"}, "teardown": {"duration": 0.0006760773248970509, "outcome": "passed"}}, {"nodeid": "tests/api/test_rest_service_dispatch_patterns.py::test_notification_create_via_service", "lineno": 149, "outcome": "failed", "keywords": ["test_notification_create_via_service", "test_rest_service_dispatch_patterns.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005620318930596113, "outcome": "passed"}, "call": {"duration": 0.3058265778236091, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)"}, "traceback": [{"path": "tests/api/test_rest_service_dispatch_patterns.py", "lineno": 170, "message": ""}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 832, "message": "in json"}, {"path": "../../anaconda3/lib/python3.9/json/__init__.py", "lineno": 346, "message": "in loads"}, {"path": "../../anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "JSONDecodeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b08c4a00>\n\n    async def test_notification_create_via_service(rest):\n        \"\"\"persistent_notification.create via service endpoint.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        resp = await rest.client.post(\n            f\"{rest.base_url}/api/services/persistent_notification/create\",\n            json={\n                \"notification_id\": f\"svc_notif_{tag}\",\n                \"title\": f\"Test {tag}\",\n                \"message\": \"Created via service dispatch\",\n            },\n            headers=rest._headers(),\n        )\n        assert resp.status_code == 200\n    \n        # Verify notification exists\n        await asyncio.sleep(0.3)\n        nr = await rest.client.get(\n            f\"{rest.base_url}/api/notifications\",\n            headers=rest._headers(),\n        )\n>       notifs = nr.json()\n\ntests/api/test_rest_service_dispatch_patterns.py:170: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:832: in json\n    return jsonlib.loads(self.content, **kwargs)\n../../anaconda3/lib/python3.9/json/__init__.py:346: in loads\n    return _default_decoder.decode(s)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <json.decoder.JSONDecoder object at 0x7f47b2e5fe50>, s = '404: Not Found'\n_w = <built-in method match of re.Pattern object at 0x7f47b3015cf0>\n\n    def decode(self, s, _w=WHITESPACE.match):\n        \"\"\"Return the Python representation of ``s`` (a ``str`` instance\n        containing a JSON document).\n    \n        \"\"\"\n        obj, end = self.raw_decode(s, idx=_w(s, 0).end())\n        end = _w(s, end).end()\n        if end != len(s):\n>           raise JSONDecodeError(\"Extra data\", s, end)\nE           json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)\n\n../../anaconda3/lib/python3.9/json/decoder.py:340: JSONDecodeError"}, "teardown": {"duration": 0.0007455060258507729, "outcome": "passed"}}, {"nodeid": "tests/api/test_rest_service_dispatch_patterns.py::test_notification_dismiss_via_service", "lineno": 174, "outcome": "passed", "keywords": ["test_notification_dismiss_via_service", "test_rest_service_dispatch_patterns.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.0052420939318835735, "outcome": "passed"}, "call": {"duration": 0.3059529480524361, "outcome": "passed"}, "teardown": {"duration": 0.0006966330111026764, "outcome": "passed"}}, {"nodeid": "tests/api/test_rest_service_dispatch_patterns.py::test_notification_dismiss_all_via_service", "lineno": 196, "outcome": "passed", "keywords": ["test_notification_dismiss_all_via_service", "test_rest_service_dispatch_patterns.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.010371504817157984, "outcome": "passed"}, "call": {"duration": 0.004386688116937876, "outcome": "passed"}, "teardown": {"duration": 0.0008401083759963512, "outcome": "passed"}}, {"nodeid": "tests/api/test_rest_service_dispatch_patterns.py::test_scene_turn_on_via_rest", "lineno": 208, "outcome": "failed", "keywords": ["test_scene_turn_on_via_rest", "test_rest_service_dispatch_patterns.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.007862963248044252, "outcome": "passed"}, "call": {"duration": 0.008576047141104937, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_rest_service_dispatch_patterns.py", "lineno": 218, "message": "assert 400 == 200\n +  where 400 = <Response [400 Bad Request]>.status_code"}, "traceback": [{"path": "tests/api/test_rest_service_dispatch_patterns.py", "lineno": 218, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b06a9130>\n\n    async def test_scene_turn_on_via_rest(rest):\n        \"\"\"scene.turn_on via REST service endpoint.\"\"\"\n        await rest.set_state(\"light.living_room_main\", \"off\")\n    \n        resp = await rest.client.post(\n            f\"{rest.base_url}/api/services/scene/turn_on\",\n            json={\"entity_id\": \"scene.evening\"},\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 400 == 200\nE        +  where 400 = <Response [400 Bad Request]>.status_code\n\ntests/api/test_rest_service_dispatch_patterns.py:218: AssertionError"}, "teardown": {"duration": 0.0007395441643893719, "outcome": "passed"}}, {"nodeid": "tests/api/test_rest_service_dispatch_patterns.py::test_simple_state_transition[alarm_arm_home]", "lineno": 283, "outcome": "failed", "keywords": ["test_simple_state_transition[alarm_arm_home]", "parametrize", "pytestmark", "alarm_arm_home", "test_rest_service_dispatch_patterns.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.0074790408834815025, "outcome": "passed"}, "call": {"duration": 0.005595345050096512, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/alarm_control_panel/arm_home'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/api/test_rest_service_dispatch_patterns.py", "lineno": 298, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b090ca60>\nentity_id = 'alarm_control_panel.test', initial = 'disarmed', init_attrs = {}\ndomain = 'alarm_control_panel', service = 'arm_home', svc_data = {}\nexpected = 'armed_home'\n\n    @pytest.mark.parametrize(\n        \"entity_id, initial, init_attrs, domain, service, svc_data, expected\",\n        [(c[1], c[2], c[3], c[4], c[5], c[6], c[7]) for c in _SIMPLE_STATE_CASES],\n        ids=[c[0] for c in _SIMPLE_STATE_CASES],\n    )\n    async def test_simple_state_transition(\n        rest, entity_id, initial, init_attrs, domain, service, svc_data, expected,\n    ):\n        \"\"\"Service call transitions entity from initial to expected state.\"\"\"\n        if init_attrs:\n            await rest.set_state(entity_id, initial, attributes=init_attrs)\n        else:\n            await rest.set_state(entity_id, initial)\n        data = {\"entity_id\": entity_id, **svc_data}\n>       await rest.call_service(domain, service, data)\n\ntests/api/test_rest_service_dispatch_patterns.py:298: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/alarm_control_panel/arm_home'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0008373847231268883, "outcome": "passed"}}, {"nodeid": "tests/api/test_rest_service_dispatch_patterns.py::test_simple_state_transition[alarm_disarm]", "lineno": 283, "outcome": "failed", "keywords": ["test_simple_state_transition[alarm_disarm]", "parametrize", "pytestmark", "alarm_disarm", "test_rest_service_dispatch_patterns.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.006103574763983488, "outcome": "passed"}, "call": {"duration": 0.004482713993638754, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/alarm_control_panel/disarm'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/api/test_rest_service_dispatch_patterns.py", "lineno": 298, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0a66790>\nentity_id = 'alarm_control_panel.test2', initial = 'armed_away', init_attrs = {}\ndomain = 'alarm_control_panel', service = 'disarm', svc_data = {}\nexpected = 'disarmed'\n\n    @pytest.mark.parametrize(\n        \"entity_id, initial, init_attrs, domain, service, svc_data, expected\",\n        [(c[1], c[2], c[3], c[4], c[5], c[6], c[7]) for c in _SIMPLE_STATE_CASES],\n        ids=[c[0] for c in _SIMPLE_STATE_CASES],\n    )\n    async def test_simple_state_transition(\n        rest, entity_id, initial, init_attrs, domain, service, svc_data, expected,\n    ):\n        \"\"\"Service call transitions entity from initial to expected state.\"\"\"\n        if init_attrs:\n            await rest.set_state(entity_id, initial, attributes=init_attrs)\n        else:\n            await rest.set_state(entity_id, initial)\n        data = {\"entity_id\": entity_id, **svc_data}\n>       await rest.call_service(domain, service, data)\n\ntests/api/test_rest_service_dispatch_patterns.py:298: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/alarm_control_panel/disarm'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0008132276125252247, "outcome": "passed"}}, {"nodeid": "tests/api/test_rest_service_dispatch_patterns.py::test_simple_state_transition[climate_set_hvac_mode]", "lineno": 283, "outcome": "failed", "keywords": ["test_simple_state_transition[climate_set_hvac_mode]", "parametrize", "pytestmark", "climate_set_hvac_mode", "test_rest_service_dispatch_patterns.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.006421804893761873, "outcome": "passed"}, "call": {"duration": 0.004927458707243204, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/climate/set_hvac_mode'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/api/test_rest_service_dispatch_patterns.py", "lineno": 298, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b09bdee0>\nentity_id = 'climate.mode_cts', initial = 'off', init_attrs = {}\ndomain = 'climate', service = 'set_hvac_mode', svc_data = {'hvac_mode': 'cool'}\nexpected = 'cool'\n\n    @pytest.mark.parametrize(\n        \"entity_id, initial, init_attrs, domain, service, svc_data, expected\",\n        [(c[1], c[2], c[3], c[4], c[5], c[6], c[7]) for c in _SIMPLE_STATE_CASES],\n        ids=[c[0] for c in _SIMPLE_STATE_CASES],\n    )\n    async def test_simple_state_transition(\n        rest, entity_id, initial, init_attrs, domain, service, svc_data, expected,\n    ):\n        \"\"\"Service call transitions entity from initial to expected state.\"\"\"\n        if init_attrs:\n            await rest.set_state(entity_id, initial, attributes=init_attrs)\n        else:\n            await rest.set_state(entity_id, initial)\n        data = {\"entity_id\": entity_id, **svc_data}\n>       await rest.call_service(domain, service, data)\n\ntests/api/test_rest_service_dispatch_patterns.py:298: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/climate/set_hvac_mode'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0006967009976506233, "outcome": "passed"}}, {"nodeid": "tests/api/test_rest_service_dispatch_patterns.py::test_simple_state_transition[vacuum_return_to_base]", "lineno": 283, "outcome": "failed", "keywords": ["test_simple_state_transition[vacuum_return_to_base]", "parametrize", "pytestmark", "vacuum_return_to_base", "test_rest_service_dispatch_patterns.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005591175984591246, "outcome": "passed"}, "call": {"duration": 0.003983363974839449, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/vacuum/return_to_base'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/api/test_rest_service_dispatch_patterns.py", "lineno": 298, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b09bda00>\nentity_id = 'vacuum.dyson', initial = 'cleaning', init_attrs = {}\ndomain = 'vacuum', service = 'return_to_base', svc_data = {}\nexpected = 'returning'\n\n    @pytest.mark.parametrize(\n        \"entity_id, initial, init_attrs, domain, service, svc_data, expected\",\n        [(c[1], c[2], c[3], c[4], c[5], c[6], c[7]) for c in _SIMPLE_STATE_CASES],\n        ids=[c[0] for c in _SIMPLE_STATE_CASES],\n    )\n    async def test_simple_state_transition(\n        rest, entity_id, initial, init_attrs, domain, service, svc_data, expected,\n    ):\n        \"\"\"Service call transitions entity from initial to expected state.\"\"\"\n        if init_attrs:\n            await rest.set_state(entity_id, initial, attributes=init_attrs)\n        else:\n            await rest.set_state(entity_id, initial)\n        data = {\"entity_id\": entity_id, **svc_data}\n>       await rest.call_service(domain, service, data)\n\ntests/api/test_rest_service_dispatch_patterns.py:298: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/vacuum/return_to_base'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0007056179456412792, "outcome": "passed"}}, {"nodeid": "tests/api/test_rest_service_dispatch_patterns.py::test_simple_state_transition[vacuum_pause]", "lineno": 283, "outcome": "failed", "keywords": ["test_simple_state_transition[vacuum_pause]", "parametrize", "pytestmark", "vacuum_pause", "test_rest_service_dispatch_patterns.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005487837828695774, "outcome": "passed"}, "call": {"duration": 0.004990620072931051, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/vacuum/pause'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/api/test_rest_service_dispatch_patterns.py", "lineno": 298, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0a225b0>\nentity_id = 'vacuum.cts_robo', initial = 'cleaning', init_attrs = {}\ndomain = 'vacuum', service = 'pause', svc_data = {}, expected = 'paused'\n\n    @pytest.mark.parametrize(\n        \"entity_id, initial, init_attrs, domain, service, svc_data, expected\",\n        [(c[1], c[2], c[3], c[4], c[5], c[6], c[7]) for c in _SIMPLE_STATE_CASES],\n        ids=[c[0] for c in _SIMPLE_STATE_CASES],\n    )\n    async def test_simple_state_transition(\n        rest, entity_id, initial, init_attrs, domain, service, svc_data, expected,\n    ):\n        \"\"\"Service call transitions entity from initial to expected state.\"\"\"\n        if init_attrs:\n            await rest.set_state(entity_id, initial, attributes=init_attrs)\n        else:\n            await rest.set_state(entity_id, initial)\n        data = {\"entity_id\": entity_id, **svc_data}\n>       await rest.call_service(domain, service, data)\n\ntests/api/test_rest_service_dispatch_patterns.py:298: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/vacuum/pause'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0007503461092710495, "outcome": "passed"}}, {"nodeid": "tests/api/test_rest_service_dispatch_patterns.py::test_simple_state_transition[number_set_value]", "lineno": 283, "outcome": "failed", "keywords": ["test_simple_state_transition[number_set_value]", "parametrize", "pytestmark", "number_set_value", "test_rest_service_dispatch_patterns.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.0055956291034817696, "outcome": "passed"}, "call": {"duration": 0.004509274382144213, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/number/set_value'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/api/test_rest_service_dispatch_patterns.py", "lineno": 298, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b09bd6a0>\nentity_id = 'number.brightness', initial = '50', init_attrs = {}\ndomain = 'number', service = 'set_value', svc_data = {'value': 75}\nexpected = '75'\n\n    @pytest.mark.parametrize(\n        \"entity_id, initial, init_attrs, domain, service, svc_data, expected\",\n        [(c[1], c[2], c[3], c[4], c[5], c[6], c[7]) for c in _SIMPLE_STATE_CASES],\n        ids=[c[0] for c in _SIMPLE_STATE_CASES],\n    )\n    async def test_simple_state_transition(\n        rest, entity_id, initial, init_attrs, domain, service, svc_data, expected,\n    ):\n        \"\"\"Service call transitions entity from initial to expected state.\"\"\"\n        if init_attrs:\n            await rest.set_state(entity_id, initial, attributes=init_attrs)\n        else:\n            await rest.set_state(entity_id, initial)\n        data = {\"entity_id\": entity_id, **svc_data}\n>       await rest.call_service(domain, service, data)\n\ntests/api/test_rest_service_dispatch_patterns.py:298: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/number/set_value'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0008241669274866581, "outcome": "passed"}}, {"nodeid": "tests/api/test_rest_service_dispatch_patterns.py::test_simple_state_transition[select_option]", "lineno": 283, "outcome": "failed", "keywords": ["test_simple_state_transition[select_option]", "parametrize", "pytestmark", "select_option", "test_rest_service_dispatch_patterns.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005576279945671558, "outcome": "passed"}, "call": {"duration": 0.004320040810853243, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/select/select_option'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/api/test_rest_service_dispatch_patterns.py", "lineno": 298, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b1294700>\nentity_id = 'select.color_mode', initial = 'warm', init_attrs = {}\ndomain = 'select', service = 'select_option', svc_data = {'option': 'cool'}\nexpected = 'cool'\n\n    @pytest.mark.parametrize(\n        \"entity_id, initial, init_attrs, domain, service, svc_data, expected\",\n        [(c[1], c[2], c[3], c[4], c[5], c[6], c[7]) for c in _SIMPLE_STATE_CASES],\n        ids=[c[0] for c in _SIMPLE_STATE_CASES],\n    )\n    async def test_simple_state_transition(\n        rest, entity_id, initial, init_attrs, domain, service, svc_data, expected,\n    ):\n        \"\"\"Service call transitions entity from initial to expected state.\"\"\"\n        if init_attrs:\n            await rest.set_state(entity_id, initial, attributes=init_attrs)\n        else:\n            await rest.set_state(entity_id, initial)\n        data = {\"entity_id\": entity_id, **svc_data}\n>       await rest.call_service(domain, service, data)\n\ntests/api/test_rest_service_dispatch_patterns.py:298: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/select/select_option'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0008478490635752678, "outcome": "passed"}}, {"nodeid": "tests/api/test_rest_service_dispatch_patterns.py::test_simple_state_transition[input_number_set_value]", "lineno": 283, "outcome": "failed", "keywords": ["test_simple_state_transition[input_number_set_value]", "parametrize", "pytestmark", "input_number_set_value", "test_rest_service_dispatch_patterns.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005294423084706068, "outcome": "passed"}, "call": {"duration": 0.005650999955832958, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_rest_service_dispatch_patterns.py", "lineno": 300, "message": "AssertionError: assert '50' == '75'\n  \n  - 75\n  + 50"}, "traceback": [{"path": "tests/api/test_rest_service_dispatch_patterns.py", "lineno": 300, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0731d00>\nentity_id = 'input_number.volume', initial = '50'\ninit_attrs = {'max': 100, 'min': 0, 'step': 1}, domain = 'input_number'\nservice = 'set_value', svc_data = {'value': 75}, expected = '75'\n\n    @pytest.mark.parametrize(\n        \"entity_id, initial, init_attrs, domain, service, svc_data, expected\",\n        [(c[1], c[2], c[3], c[4], c[5], c[6], c[7]) for c in _SIMPLE_STATE_CASES],\n        ids=[c[0] for c in _SIMPLE_STATE_CASES],\n    )\n    async def test_simple_state_transition(\n        rest, entity_id, initial, init_attrs, domain, service, svc_data, expected,\n    ):\n        \"\"\"Service call transitions entity from initial to expected state.\"\"\"\n        if init_attrs:\n            await rest.set_state(entity_id, initial, attributes=init_attrs)\n        else:\n            await rest.set_state(entity_id, initial)\n        data = {\"entity_id\": entity_id, **svc_data}\n        await rest.call_service(domain, service, data)\n        state = await rest.get_state(entity_id)\n>       assert state[\"state\"] == expected\nE       AssertionError: assert '50' == '75'\nE         \nE         - 75\nE         + 50\n\ntests/api/test_rest_service_dispatch_patterns.py:300: AssertionError"}, "teardown": {"duration": 0.0006209439598023891, "outcome": "passed"}}, {"nodeid": "tests/api/test_rest_service_dispatch_patterns.py::test_simple_state_transition[input_text_set_value]", "lineno": 283, "outcome": "failed", "keywords": ["test_simple_state_transition[input_text_set_value]", "parametrize", "pytestmark", "input_text_set_value", "test_rest_service_dispatch_patterns.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.00528678297996521, "outcome": "passed"}, "call": {"duration": 0.0055765858851373196, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_rest_service_dispatch_patterns.py", "lineno": 300, "message": "AssertionError: assert 'hello' == 'world'\n  \n  - world\n  + hello"}, "traceback": [{"path": "tests/api/test_rest_service_dispatch_patterns.py", "lineno": 300, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b1294df0>\nentity_id = 'input_text.name', initial = 'hello', init_attrs = {}\ndomain = 'input_text', service = 'set_value', svc_data = {'value': 'world'}\nexpected = 'world'\n\n    @pytest.mark.parametrize(\n        \"entity_id, initial, init_attrs, domain, service, svc_data, expected\",\n        [(c[1], c[2], c[3], c[4], c[5], c[6], c[7]) for c in _SIMPLE_STATE_CASES],\n        ids=[c[0] for c in _SIMPLE_STATE_CASES],\n    )\n    async def test_simple_state_transition(\n        rest, entity_id, initial, init_attrs, domain, service, svc_data, expected,\n    ):\n        \"\"\"Service call transitions entity from initial to expected state.\"\"\"\n        if init_attrs:\n            await rest.set_state(entity_id, initial, attributes=init_attrs)\n        else:\n            await rest.set_state(entity_id, initial)\n        data = {\"entity_id\": entity_id, **svc_data}\n        await rest.call_service(domain, service, data)\n        state = await rest.get_state(entity_id)\n>       assert state[\"state\"] == expected\nE       AssertionError: assert 'hello' == 'world'\nE         \nE         - world\nE         + hello\n\ntests/api/test_rest_service_dispatch_patterns.py:300: AssertionError"}, "teardown": {"duration": 0.0008340328931808472, "outcome": "passed"}}, {"nodeid": "tests/api/test_rest_service_dispatch_patterns.py::test_simple_state_transition[input_text_set_value_service]", "lineno": 283, "outcome": "failed", "keywords": ["test_simple_state_transition[input_text_set_value_service]", "parametrize", "pytestmark", "input_text_set_value_service", "test_rest_service_dispatch_patterns.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005496595054864883, "outcome": "passed"}, "call": {"duration": 0.0057224007323384285, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_rest_service_dispatch_patterns.py", "lineno": 300, "message": "AssertionError: assert 'hello' == 'goodbye'\n  \n  - goodbye\n  + hello"}, "traceback": [{"path": "tests/api/test_rest_service_dispatch_patterns.py", "lineno": 300, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b07314f0>\nentity_id = 'input_text.greeting', initial = 'hello', init_attrs = {}\ndomain = 'input_text', service = 'set_value', svc_data = {'value': 'goodbye'}\nexpected = 'goodbye'\n\n    @pytest.mark.parametrize(\n        \"entity_id, initial, init_attrs, domain, service, svc_data, expected\",\n        [(c[1], c[2], c[3], c[4], c[5], c[6], c[7]) for c in _SIMPLE_STATE_CASES],\n        ids=[c[0] for c in _SIMPLE_STATE_CASES],\n    )\n    async def test_simple_state_transition(\n        rest, entity_id, initial, init_attrs, domain, service, svc_data, expected,\n    ):\n        \"\"\"Service call transitions entity from initial to expected state.\"\"\"\n        if init_attrs:\n            await rest.set_state(entity_id, initial, attributes=init_attrs)\n        else:\n            await rest.set_state(entity_id, initial)\n        data = {\"entity_id\": entity_id, **svc_data}\n        await rest.call_service(domain, service, data)\n        state = await rest.get_state(entity_id)\n>       assert state[\"state\"] == expected\nE       AssertionError: assert 'hello' == 'goodbye'\nE         \nE         - goodbye\nE         + hello\n\ntests/api/test_rest_service_dispatch_patterns.py:300: AssertionError"}, "teardown": {"duration": 0.0007236730307340622, "outcome": "passed"}}, {"nodeid": "tests/api/test_rest_service_dispatch_patterns.py::test_simple_state_transition[input_select_select_option]", "lineno": 283, "outcome": "failed", "keywords": ["test_simple_state_transition[input_select_select_option]", "parametrize", "pytestmark", "input_select_select_option", "test_rest_service_dispatch_patterns.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005453323945403099, "outcome": "passed"}, "call": {"duration": 0.005587236024439335, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_rest_service_dispatch_patterns.py", "lineno": 300, "message": "AssertionError: assert 'auto' == 'cool'\n  \n  - cool\n  + auto"}, "traceback": [{"path": "tests/api/test_rest_service_dispatch_patterns.py", "lineno": 300, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0663bb0>\nentity_id = 'input_select.mode', initial = 'auto'\ninit_attrs = {'options': ['auto', 'heat', 'cool']}, domain = 'input_select'\nservice = 'select_option', svc_data = {'option': 'cool'}, expected = 'cool'\n\n    @pytest.mark.parametrize(\n        \"entity_id, initial, init_attrs, domain, service, svc_data, expected\",\n        [(c[1], c[2], c[3], c[4], c[5], c[6], c[7]) for c in _SIMPLE_STATE_CASES],\n        ids=[c[0] for c in _SIMPLE_STATE_CASES],\n    )\n    async def test_simple_state_transition(\n        rest, entity_id, initial, init_attrs, domain, service, svc_data, expected,\n    ):\n        \"\"\"Service call transitions entity from initial to expected state.\"\"\"\n        if init_attrs:\n            await rest.set_state(entity_id, initial, attributes=init_attrs)\n        else:\n            await rest.set_state(entity_id, initial)\n        data = {\"entity_id\": entity_id, **svc_data}\n        await rest.call_service(domain, service, data)\n        state = await rest.get_state(entity_id)\n>       assert state[\"state\"] == expected\nE       AssertionError: assert 'auto' == 'cool'\nE         \nE         - cool\nE         + auto\n\ntests/api/test_rest_service_dispatch_patterns.py:300: AssertionError"}, "teardown": {"duration": 0.0007641310803592205, "outcome": "passed"}}, {"nodeid": "tests/api/test_rest_service_dispatch_patterns.py::test_simple_state_transition[input_select_select_option_service]", "lineno": 283, "outcome": "failed", "keywords": ["test_simple_state_transition[input_select_select_option_service]", "parametrize", "pytestmark", "input_select_select_option_service", "test_rest_service_dispatch_patterns.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005721199791878462, "outcome": "passed"}, "call": {"duration": 0.0057314252480864525, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_rest_service_dispatch_patterns.py", "lineno": 300, "message": "AssertionError: assert 'auto' == 'manual'\n  \n  - manual\n  + auto"}, "traceback": [{"path": "tests/api/test_rest_service_dispatch_patterns.py", "lineno": 300, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b071a8e0>\nentity_id = 'input_select.mode', initial = 'auto'\ninit_attrs = {'options': ['auto', 'manual', 'off']}, domain = 'input_select'\nservice = 'select_option', svc_data = {'option': 'manual'}, expected = 'manual'\n\n    @pytest.mark.parametrize(\n        \"entity_id, initial, init_attrs, domain, service, svc_data, expected\",\n        [(c[1], c[2], c[3], c[4], c[5], c[6], c[7]) for c in _SIMPLE_STATE_CASES],\n        ids=[c[0] for c in _SIMPLE_STATE_CASES],\n    )\n    async def test_simple_state_transition(\n        rest, entity_id, initial, init_attrs, domain, service, svc_data, expected,\n    ):\n        \"\"\"Service call transitions entity from initial to expected state.\"\"\"\n        if init_attrs:\n            await rest.set_state(entity_id, initial, attributes=init_attrs)\n        else:\n            await rest.set_state(entity_id, initial)\n        data = {\"entity_id\": entity_id, **svc_data}\n        await rest.call_service(domain, service, data)\n        state = await rest.get_state(entity_id)\n>       assert state[\"state\"] == expected\nE       AssertionError: assert 'auto' == 'manual'\nE         \nE         - manual\nE         + auto\n\ntests/api/test_rest_service_dispatch_patterns.py:300: AssertionError"}, "teardown": {"duration": 0.0007116300985217094, "outcome": "passed"}}, {"nodeid": "tests/api/test_rest_service_dispatch_patterns.py::test_attribute_setting_service[climate_set_temperature]", "lineno": 342, "outcome": "failed", "keywords": ["test_attribute_setting_service[climate_set_temperature]", "parametrize", "pytestmark", "climate_set_temperature", "test_rest_service_dispatch_patterns.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005615155212581158, "outcome": "passed"}, "call": {"duration": 0.004044005647301674, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/climate/set_temperature'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/api/test_rest_service_dispatch_patterns.py", "lineno": 360, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0690760>\nentity_id = 'climate.thermostat_cts', initial = 'heat'\ninit_attrs = {'temperature': 20}, domain = 'climate'\nservice = 'set_temperature', svc_data = {'temperature': 22.5}\ncheck_state = False, expected_state = None, attr_key = 'temperature'\nattr_value = 22.5\n\n    @pytest.mark.parametrize(\n        \"entity_id, initial, init_attrs, domain, service, svc_data, \"\n        \"check_state, expected_state, attr_key, attr_value\",\n        [(c[1], c[2], c[3], c[4], c[5], c[6], c[7], c[8], c[9], c[10])\n         for c in _ATTR_SETTING_CASES],\n        ids=[c[0] for c in _ATTR_SETTING_CASES],\n    )\n    async def test_attribute_setting_service(\n        rest, entity_id, initial, init_attrs, domain, service, svc_data,\n        check_state, expected_state, attr_key, attr_value,\n    ):\n        \"\"\"Service call sets entity attribute to expected value.\"\"\"\n        if init_attrs:\n            await rest.set_state(entity_id, initial, attributes=init_attrs)\n        else:\n            await rest.set_state(entity_id, initial)\n        data = {\"entity_id\": entity_id, **svc_data}\n>       await rest.call_service(domain, service, data)\n\ntests/api/test_rest_service_dispatch_patterns.py:360: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/climate/set_temperature'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0007188338786363602, "outcome": "passed"}}, {"nodeid": "tests/api/test_rest_service_dispatch_patterns.py::test_attribute_setting_service[media_player_volume_set]", "lineno": 342, "outcome": "failed", "keywords": ["test_attribute_setting_service[media_player_volume_set]", "parametrize", "pytestmark", "media_player_volume_set", "test_rest_service_dispatch_patterns.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005729894153773785, "outcome": "passed"}, "call": {"duration": 0.004098484758287668, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/media_player/volume_set'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/api/test_rest_service_dispatch_patterns.py", "lineno": 360, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b07241c0>\nentity_id = 'media_player.tv', initial = 'on', init_attrs = {}\ndomain = 'media_player', service = 'volume_set'\nsvc_data = {'volume_level': 0.65}, check_state = False, expected_state = None\nattr_key = 'volume_level', attr_value = 0.65\n\n    @pytest.mark.parametrize(\n        \"entity_id, initial, init_attrs, domain, service, svc_data, \"\n        \"check_state, expected_state, attr_key, attr_value\",\n        [(c[1], c[2], c[3], c[4], c[5], c[6], c[7], c[8], c[9], c[10])\n         for c in _ATTR_SETTING_CASES],\n        ids=[c[0] for c in _ATTR_SETTING_CASES],\n    )\n    async def test_attribute_setting_service(\n        rest, entity_id, initial, init_attrs, domain, service, svc_data,\n        check_state, expected_state, attr_key, attr_value,\n    ):\n        \"\"\"Service call sets entity attribute to expected value.\"\"\"\n        if init_attrs:\n            await rest.set_state(entity_id, initial, attributes=init_attrs)\n        else:\n            await rest.set_state(entity_id, initial)\n        data = {\"entity_id\": entity_id, **svc_data}\n>       await rest.call_service(domain, service, data)\n\ntests/api/test_rest_service_dispatch_patterns.py:360: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/media_player/volume_set'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0007178941741585732, "outcome": "passed"}}, {"nodeid": "tests/api/test_rest_service_dispatch_patterns.py::test_attribute_setting_service[cover_set_position]", "lineno": 342, "outcome": "failed", "keywords": ["test_attribute_setting_service[cover_set_position]", "parametrize", "pytestmark", "cover_set_position", "test_rest_service_dispatch_patterns.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005562023259699345, "outcome": "passed"}, "call": {"duration": 0.004102866165339947, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/cover/set_cover_position'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/api/test_rest_service_dispatch_patterns.py", "lineno": 360, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b08fb520>\nentity_id = 'cover.garage', initial = 'closed', init_attrs = {}\ndomain = 'cover', service = 'set_cover_position', svc_data = {'position': 50}\ncheck_state = True, expected_state = 'open', attr_key = 'current_position'\nattr_value = 50\n\n    @pytest.mark.parametrize(\n        \"entity_id, initial, init_attrs, domain, service, svc_data, \"\n        \"check_state, expected_state, attr_key, attr_value\",\n        [(c[1], c[2], c[3], c[4], c[5], c[6], c[7], c[8], c[9], c[10])\n         for c in _ATTR_SETTING_CASES],\n        ids=[c[0] for c in _ATTR_SETTING_CASES],\n    )\n    async def test_attribute_setting_service(\n        rest, entity_id, initial, init_attrs, domain, service, svc_data,\n        check_state, expected_state, attr_key, attr_value,\n    ):\n        \"\"\"Service call sets entity attribute to expected value.\"\"\"\n        if init_attrs:\n            await rest.set_state(entity_id, initial, attributes=init_attrs)\n        else:\n            await rest.set_state(entity_id, initial)\n        data = {\"entity_id\": entity_id, **svc_data}\n>       await rest.call_service(domain, service, data)\n\ntests/api/test_rest_service_dispatch_patterns.py:360: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/cover/set_cover_position'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0007412522099912167, "outcome": "passed"}}, {"nodeid": "tests/api/test_rest_service_dispatch_patterns.py::test_attribute_setting_service[fan_set_percentage]", "lineno": 342, "outcome": "failed", "keywords": ["test_attribute_setting_service[fan_set_percentage]", "parametrize", "pytestmark", "fan_set_percentage", "test_rest_service_dispatch_patterns.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.0055943988263607025, "outcome": "passed"}, "call": {"duration": 0.004309779033064842, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/fan/set_percentage'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/api/test_rest_service_dispatch_patterns.py", "lineno": 360, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b08fb490>, entity_id = 'fan.ceiling'\ninitial = 'off', init_attrs = {}, domain = 'fan', service = 'set_percentage'\nsvc_data = {'percentage': 75}, check_state = True, expected_state = 'on'\nattr_key = 'percentage', attr_value = 75\n\n    @pytest.mark.parametrize(\n        \"entity_id, initial, init_attrs, domain, service, svc_data, \"\n        \"check_state, expected_state, attr_key, attr_value\",\n        [(c[1], c[2], c[3], c[4], c[5], c[6], c[7], c[8], c[9], c[10])\n         for c in _ATTR_SETTING_CASES],\n        ids=[c[0] for c in _ATTR_SETTING_CASES],\n    )\n    async def test_attribute_setting_service(\n        rest, entity_id, initial, init_attrs, domain, service, svc_data,\n        check_state, expected_state, attr_key, attr_value,\n    ):\n        \"\"\"Service call sets entity attribute to expected value.\"\"\"\n        if init_attrs:\n            await rest.set_state(entity_id, initial, attributes=init_attrs)\n        else:\n            await rest.set_state(entity_id, initial)\n        data = {\"entity_id\": entity_id, **svc_data}\n>       await rest.call_service(domain, service, data)\n\ntests/api/test_rest_service_dispatch_patterns.py:360: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/fan/set_percentage'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0008972748182713985, "outcome": "passed"}}, {"nodeid": "tests/api/test_rest_service_dispatch_patterns.py::test_attribute_setting_service[cover_position_tracking]", "lineno": 342, "outcome": "failed", "keywords": ["test_attribute_setting_service[cover_position_tracking]", "parametrize", "pytestmark", "cover_position_tracking", "test_rest_service_dispatch_patterns.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005632554180920124, "outcome": "passed"}, "call": {"duration": 0.004715231247246265, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/cover/set_cover_position'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/api/test_rest_service_dispatch_patterns.py", "lineno": 360, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0854970>\nentity_id = 'cover.pos_test', initial = 'open'\ninit_attrs = {'current_position': 100}, domain = 'cover'\nservice = 'set_cover_position', svc_data = {'position': 50}, check_state = False\nexpected_state = None, attr_key = 'current_position', attr_value = 50\n\n    @pytest.mark.parametrize(\n        \"entity_id, initial, init_attrs, domain, service, svc_data, \"\n        \"check_state, expected_state, attr_key, attr_value\",\n        [(c[1], c[2], c[3], c[4], c[5], c[6], c[7], c[8], c[9], c[10])\n         for c in _ATTR_SETTING_CASES],\n        ids=[c[0] for c in _ATTR_SETTING_CASES],\n    )\n    async def test_attribute_setting_service(\n        rest, entity_id, initial, init_attrs, domain, service, svc_data,\n        check_state, expected_state, attr_key, attr_value,\n    ):\n        \"\"\"Service call sets entity attribute to expected value.\"\"\"\n        if init_attrs:\n            await rest.set_state(entity_id, initial, attributes=init_attrs)\n        else:\n            await rest.set_state(entity_id, initial)\n        data = {\"entity_id\": entity_id, **svc_data}\n>       await rest.call_service(domain, service, data)\n\ntests/api/test_rest_service_dispatch_patterns.py:360: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/cover/set_cover_position'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0007763323374092579, "outcome": "passed"}}, {"nodeid": "tests/api/test_rest_service_dispatch_patterns.py::test_attribute_setting_service[fan_percentage_tracking]", "lineno": 342, "outcome": "failed", "keywords": ["test_attribute_setting_service[fan_percentage_tracking]", "parametrize", "pytestmark", "fan_percentage_tracking", "test_rest_service_dispatch_patterns.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005669699981808662, "outcome": "passed"}, "call": {"duration": 0.004120178986340761, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/fan/set_percentage'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/api/test_rest_service_dispatch_patterns.py", "lineno": 360, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0978400>\nentity_id = 'fan.pct_test', initial = 'on', init_attrs = {'percentage': 50}\ndomain = 'fan', service = 'set_percentage', svc_data = {'percentage': 75}\ncheck_state = False, expected_state = None, attr_key = 'percentage'\nattr_value = 75\n\n    @pytest.mark.parametrize(\n        \"entity_id, initial, init_attrs, domain, service, svc_data, \"\n        \"check_state, expected_state, attr_key, attr_value\",\n        [(c[1], c[2], c[3], c[4], c[5], c[6], c[7], c[8], c[9], c[10])\n         for c in _ATTR_SETTING_CASES],\n        ids=[c[0] for c in _ATTR_SETTING_CASES],\n    )\n    async def test_attribute_setting_service(\n        rest, entity_id, initial, init_attrs, domain, service, svc_data,\n        check_state, expected_state, attr_key, attr_value,\n    ):\n        \"\"\"Service call sets entity attribute to expected value.\"\"\"\n        if init_attrs:\n            await rest.set_state(entity_id, initial, attributes=init_attrs)\n        else:\n            await rest.set_state(entity_id, initial)\n        data = {\"entity_id\": entity_id, **svc_data}\n>       await rest.call_service(domain, service, data)\n\ntests/api/test_rest_service_dispatch_patterns.py:360: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/fan/set_percentage'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.000776682049036026, "outcome": "passed"}}, {"nodeid": "tests/api/test_rest_service_dispatch_patterns.py::test_attribute_setting_service[media_player_select_source]", "lineno": 342, "outcome": "failed", "keywords": ["test_attribute_setting_service[media_player_select_source]", "parametrize", "pytestmark", "media_player_select_source", "test_rest_service_dispatch_patterns.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005579723045229912, "outcome": "passed"}, "call": {"duration": 0.004101462196558714, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/media_player/select_source'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/api/test_rest_service_dispatch_patterns.py", "lineno": 360, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0978460>\nentity_id = 'media_player.cts_tv', initial = 'on'\ninit_attrs = {'source': 'HDMI1'}, domain = 'media_player'\nservice = 'select_source', svc_data = {'source': 'Spotify'}, check_state = False\nexpected_state = None, attr_key = 'source', attr_value = 'Spotify'\n\n    @pytest.mark.parametrize(\n        \"entity_id, initial, init_attrs, domain, service, svc_data, \"\n        \"check_state, expected_state, attr_key, attr_value\",\n        [(c[1], c[2], c[3], c[4], c[5], c[6], c[7], c[8], c[9], c[10])\n         for c in _ATTR_SETTING_CASES],\n        ids=[c[0] for c in _ATTR_SETTING_CASES],\n    )\n    async def test_attribute_setting_service(\n        rest, entity_id, initial, init_attrs, domain, service, svc_data,\n        check_state, expected_state, attr_key, attr_value,\n    ):\n        \"\"\"Service call sets entity attribute to expected value.\"\"\"\n        if init_attrs:\n            await rest.set_state(entity_id, initial, attributes=init_attrs)\n        else:\n            await rest.set_state(entity_id, initial)\n        data = {\"entity_id\": entity_id, **svc_data}\n>       await rest.call_service(domain, service, data)\n\ntests/api/test_rest_service_dispatch_patterns.py:360: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/media_player/select_source'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0007769879885017872, "outcome": "passed"}}, {"nodeid": "tests/api/test_rest_service_dispatch_patterns.py::test_two_step_cycle[lock_lock_unlock]", "lineno": 401, "outcome": "failed", "keywords": ["test_two_step_cycle[lock_lock_unlock]", "parametrize", "pytestmark", "lock_lock_unlock", "test_rest_service_dispatch_patterns.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005473473109304905, "outcome": "passed"}, "call": {"duration": 0.00412152661010623, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/lock/lock'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/api/test_rest_service_dispatch_patterns.py", "lineno": 417, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0978f40>\nentity_id = 'lock.cts_lock', initial = 'unlocked', init_attrs = {}\ndomain = 'lock', svc_a = 'lock', state_a = 'locked', svc_b = 'unlock'\nstate_b = 'unlocked'\n\n    @pytest.mark.parametrize(\n        \"entity_id, initial, init_attrs, domain, svc_a, state_a, svc_b, state_b\",\n        [(c[1], c[2], c[3], c[4], c[5], c[6], c[7], c[8])\n         for c in _TWO_STEP_CASES],\n        ids=[c[0] for c in _TWO_STEP_CASES],\n    )\n    async def test_two_step_cycle(\n        rest, entity_id, initial, init_attrs, domain,\n        svc_a, state_a, svc_b, state_b,\n    ):\n        \"\"\"Two sequential service calls transition entity through expected states.\"\"\"\n        if init_attrs:\n            await rest.set_state(entity_id, initial, attributes=init_attrs)\n        else:\n            await rest.set_state(entity_id, initial)\n>       await rest.call_service(domain, svc_a, {\"entity_id\": entity_id})\n\ntests/api/test_rest_service_dispatch_patterns.py:417: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/lock/lock'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0007584141567349434, "outcome": "passed"}}, {"nodeid": "tests/api/test_rest_service_dispatch_patterns.py::test_two_step_cycle[media_player_play_pause]", "lineno": 401, "outcome": "failed", "keywords": ["test_two_step_cycle[media_player_play_pause]", "parametrize", "pytestmark", "media_player_play_pause", "test_rest_service_dispatch_patterns.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005510494112968445, "outcome": "passed"}, "call": {"duration": 0.004152353852987289, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/media_player/media_play'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/api/test_rest_service_dispatch_patterns.py", "lineno": 417, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b09e6d00>\nentity_id = 'media_player.speaker', initial = 'paused', init_attrs = {}\ndomain = 'media_player', svc_a = 'media_play', state_a = 'playing'\nsvc_b = 'media_pause', state_b = 'paused'\n\n    @pytest.mark.parametrize(\n        \"entity_id, initial, init_attrs, domain, svc_a, state_a, svc_b, state_b\",\n        [(c[1], c[2], c[3], c[4], c[5], c[6], c[7], c[8])\n         for c in _TWO_STEP_CASES],\n        ids=[c[0] for c in _TWO_STEP_CASES],\n    )\n    async def test_two_step_cycle(\n        rest, entity_id, initial, init_attrs, domain,\n        svc_a, state_a, svc_b, state_b,\n    ):\n        \"\"\"Two sequential service calls transition entity through expected states.\"\"\"\n        if init_attrs:\n            await rest.set_state(entity_id, initial, attributes=init_attrs)\n        else:\n            await rest.set_state(entity_id, initial)\n>       await rest.call_service(domain, svc_a, {\"entity_id\": entity_id})\n\ntests/api/test_rest_service_dispatch_patterns.py:417: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/media_player/media_play'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0009207851253449917, "outcome": "passed"}}, {"nodeid": "tests/api/test_rest_service_dispatch_patterns.py::test_two_step_cycle[media_player_turn_on_off]", "lineno": 401, "outcome": "failed", "keywords": ["test_two_step_cycle[media_player_turn_on_off]", "parametrize", "pytestmark", "media_player_turn_on_off", "test_rest_service_dispatch_patterns.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005752504803240299, "outcome": "passed"}, "call": {"duration": 0.005103341769427061, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/media_player/turn_on'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/api/test_rest_service_dispatch_patterns.py", "lineno": 417, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0700190>\nentity_id = 'media_player.amp', initial = 'off', init_attrs = {}\ndomain = 'media_player', svc_a = 'turn_on', state_a = 'on', svc_b = 'turn_off'\nstate_b = 'off'\n\n    @pytest.mark.parametrize(\n        \"entity_id, initial, init_attrs, domain, svc_a, state_a, svc_b, state_b\",\n        [(c[1], c[2], c[3], c[4], c[5], c[6], c[7], c[8])\n         for c in _TWO_STEP_CASES],\n        ids=[c[0] for c in _TWO_STEP_CASES],\n    )\n    async def test_two_step_cycle(\n        rest, entity_id, initial, init_attrs, domain,\n        svc_a, state_a, svc_b, state_b,\n    ):\n        \"\"\"Two sequential service calls transition entity through expected states.\"\"\"\n        if init_attrs:\n            await rest.set_state(entity_id, initial, attributes=init_attrs)\n        else:\n            await rest.set_state(entity_id, initial)\n>       await rest.call_service(domain, svc_a, {\"entity_id\": entity_id})\n\ntests/api/test_rest_service_dispatch_patterns.py:417: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/media_player/turn_on'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0008809133432805538, "outcome": "passed"}}, {"nodeid": "tests/api/test_rest_service_dispatch_patterns.py::test_two_step_cycle[vacuum_start_stop]", "lineno": 401, "outcome": "failed", "keywords": ["test_two_step_cycle[vacuum_start_stop]", "parametrize", "pytestmark", "vacuum_start_stop", "test_rest_service_dispatch_patterns.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.0056847319938242435, "outcome": "passed"}, "call": {"duration": 0.004628161899745464, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/vacuum/start'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/api/test_rest_service_dispatch_patterns.py", "lineno": 417, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0625d30>\nentity_id = 'vacuum.roborock', initial = 'idle', init_attrs = {}\ndomain = 'vacuum', svc_a = 'start', state_a = 'cleaning', svc_b = 'stop'\nstate_b = 'idle'\n\n    @pytest.mark.parametrize(\n        \"entity_id, initial, init_attrs, domain, svc_a, state_a, svc_b, state_b\",\n        [(c[1], c[2], c[3], c[4], c[5], c[6], c[7], c[8])\n         for c in _TWO_STEP_CASES],\n        ids=[c[0] for c in _TWO_STEP_CASES],\n    )\n    async def test_two_step_cycle(\n        rest, entity_id, initial, init_attrs, domain,\n        svc_a, state_a, svc_b, state_b,\n    ):\n        \"\"\"Two sequential service calls transition entity through expected states.\"\"\"\n        if init_attrs:\n            await rest.set_state(entity_id, initial, attributes=init_attrs)\n        else:\n            await rest.set_state(entity_id, initial)\n>       await rest.call_service(domain, svc_a, {\"entity_id\": entity_id})\n\ntests/api/test_rest_service_dispatch_patterns.py:417: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/vacuum/start'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0007181558758020401, "outcome": "passed"}}, {"nodeid": "tests/api/test_rest_service_dispatch_patterns.py::test_two_step_cycle[siren_on_off]", "lineno": 401, "outcome": "failed", "keywords": ["test_two_step_cycle[siren_on_off]", "parametrize", "pytestmark", "siren_on_off", "test_rest_service_dispatch_patterns.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005838278215378523, "outcome": "passed"}, "call": {"duration": 0.004162922967225313, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/siren/turn_on'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/api/test_rest_service_dispatch_patterns.py", "lineno": 417, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b129c040>, entity_id = 'siren.alarm'\ninitial = 'off', init_attrs = {}, domain = 'siren', svc_a = 'turn_on'\nstate_a = 'on', svc_b = 'turn_off', state_b = 'off'\n\n    @pytest.mark.parametrize(\n        \"entity_id, initial, init_attrs, domain, svc_a, state_a, svc_b, state_b\",\n        [(c[1], c[2], c[3], c[4], c[5], c[6], c[7], c[8])\n         for c in _TWO_STEP_CASES],\n        ids=[c[0] for c in _TWO_STEP_CASES],\n    )\n    async def test_two_step_cycle(\n        rest, entity_id, initial, init_attrs, domain,\n        svc_a, state_a, svc_b, state_b,\n    ):\n        \"\"\"Two sequential service calls transition entity through expected states.\"\"\"\n        if init_attrs:\n            await rest.set_state(entity_id, initial, attributes=init_attrs)\n        else:\n            await rest.set_state(entity_id, initial)\n>       await rest.call_service(domain, svc_a, {\"entity_id\": entity_id})\n\ntests/api/test_rest_service_dispatch_patterns.py:417: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/siren/turn_on'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0007086102850735188, "outcome": "passed"}}, {"nodeid": "tests/api/test_rest_service_dispatch_patterns.py::test_two_step_cycle[valve_open_close]", "lineno": 401, "outcome": "failed", "keywords": ["test_two_step_cycle[valve_open_close]", "parametrize", "pytestmark", "valve_open_close", "test_rest_service_dispatch_patterns.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.00560580613091588, "outcome": "passed"}, "call": {"duration": 0.004063933156430721, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/valve/open_valve'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/api/test_rest_service_dispatch_patterns.py", "lineno": 417, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b129c520>\nentity_id = 'valve.water_main', initial = 'closed', init_attrs = {}\ndomain = 'valve', svc_a = 'open_valve', state_a = 'open', svc_b = 'close_valve'\nstate_b = 'closed'\n\n    @pytest.mark.parametrize(\n        \"entity_id, initial, init_attrs, domain, svc_a, state_a, svc_b, state_b\",\n        [(c[1], c[2], c[3], c[4], c[5], c[6], c[7], c[8])\n         for c in _TWO_STEP_CASES],\n        ids=[c[0] for c in _TWO_STEP_CASES],\n    )\n    async def test_two_step_cycle(\n        rest, entity_id, initial, init_attrs, domain,\n        svc_a, state_a, svc_b, state_b,\n    ):\n        \"\"\"Two sequential service calls transition entity through expected states.\"\"\"\n        if init_attrs:\n            await rest.set_state(entity_id, initial, attributes=init_attrs)\n        else:\n            await rest.set_state(entity_id, initial)\n>       await rest.call_service(domain, svc_a, {\"entity_id\": entity_id})\n\ntests/api/test_rest_service_dispatch_patterns.py:417: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/valve/open_valve'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0008624168112874031, "outcome": "passed"}}, {"nodeid": "tests/api/test_rest_service_dispatch_patterns.py::test_two_step_cycle[cover_open_close_cycle]", "lineno": 401, "outcome": "failed", "keywords": ["test_two_step_cycle[cover_open_close_cycle]", "parametrize", "pytestmark", "cover_open_close_cycle", "test_rest_service_dispatch_patterns.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005615682806819677, "outcome": "passed"}, "call": {"duration": 0.004132559988647699, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/cover/open_cover'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/api/test_rest_service_dispatch_patterns.py", "lineno": 417, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0a81ca0>\nentity_id = 'cover.cts_garage', initial = 'closed', init_attrs = {}\ndomain = 'cover', svc_a = 'open_cover', state_a = 'open', svc_b = 'close_cover'\nstate_b = 'closed'\n\n    @pytest.mark.parametrize(\n        \"entity_id, initial, init_attrs, domain, svc_a, state_a, svc_b, state_b\",\n        [(c[1], c[2], c[3], c[4], c[5], c[6], c[7], c[8])\n         for c in _TWO_STEP_CASES],\n        ids=[c[0] for c in _TWO_STEP_CASES],\n    )\n    async def test_two_step_cycle(\n        rest, entity_id, initial, init_attrs, domain,\n        svc_a, state_a, svc_b, state_b,\n    ):\n        \"\"\"Two sequential service calls transition entity through expected states.\"\"\"\n        if init_attrs:\n            await rest.set_state(entity_id, initial, attributes=init_attrs)\n        else:\n            await rest.set_state(entity_id, initial)\n>       await rest.call_service(domain, svc_a, {\"entity_id\": entity_id})\n\ntests/api/test_rest_service_dispatch_patterns.py:417: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/cover/open_cover'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.000706132035702467, "outcome": "passed"}}, {"nodeid": "tests/api/test_rest_service_dispatch_patterns.py::test_two_step_cycle[input_boolean_toggle_cycle]", "lineno": 401, "outcome": "failed", "keywords": ["test_two_step_cycle[input_boolean_toggle_cycle]", "parametrize", "pytestmark", "input_boolean_toggle_cycle", "test_rest_service_dispatch_patterns.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005893573630601168, "outcome": "passed"}, "call": {"duration": 0.0055910577066242695, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_rest_service_dispatch_patterns.py", "lineno": 419, "message": "AssertionError: assert 'off' == 'on'\n  \n  - on\n  + off"}, "traceback": [{"path": "tests/api/test_rest_service_dispatch_patterns.py", "lineno": 419, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0533a30>\nentity_id = 'input_boolean.cts_toggle', initial = 'off', init_attrs = {}\ndomain = 'input_boolean', svc_a = 'toggle', state_a = 'on', svc_b = 'toggle'\nstate_b = 'off'\n\n    @pytest.mark.parametrize(\n        \"entity_id, initial, init_attrs, domain, svc_a, state_a, svc_b, state_b\",\n        [(c[1], c[2], c[3], c[4], c[5], c[6], c[7], c[8])\n         for c in _TWO_STEP_CASES],\n        ids=[c[0] for c in _TWO_STEP_CASES],\n    )\n    async def test_two_step_cycle(\n        rest, entity_id, initial, init_attrs, domain,\n        svc_a, state_a, svc_b, state_b,\n    ):\n        \"\"\"Two sequential service calls transition entity through expected states.\"\"\"\n        if init_attrs:\n            await rest.set_state(entity_id, initial, attributes=init_attrs)\n        else:\n            await rest.set_state(entity_id, initial)\n        await rest.call_service(domain, svc_a, {\"entity_id\": entity_id})\n        s = await rest.get_state(entity_id)\n>       assert s[\"state\"] == state_a\nE       AssertionError: assert 'off' == 'on'\nE         \nE         - on\nE         + off\n\ntests/api/test_rest_service_dispatch_patterns.py:419: AssertionError"}, "teardown": {"duration": 0.0006819358095526695, "outcome": "passed"}}, {"nodeid": "tests/api/test_rest_service_dispatch_patterns.py::test_toggle_cycle[siren_toggle]", "lineno": 443, "outcome": "failed", "keywords": ["test_toggle_cycle[siren_toggle]", "parametrize", "pytestmark", "siren_toggle", "test_rest_service_dispatch_patterns.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005690694786608219, "outcome": "passed"}, "call": {"duration": 0.00475370604544878, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/siren/toggle'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/api/test_rest_service_dispatch_patterns.py", "lineno": 457, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0700250>\nentity_id = 'siren.cts_alarm', initial = 'off', init_attrs = {}\ndomain = 'siren', state_a = 'on', state_b = 'off'\n\n    @pytest.mark.parametrize(\n        \"entity_id, initial, init_attrs, domain, state_a, state_b\",\n        [(c[1], c[2], c[3], c[4], c[5], c[6]) for c in _TOGGLE_CASES],\n        ids=[c[0] for c in _TOGGLE_CASES],\n    )\n    async def test_toggle_cycle(\n        rest, entity_id, initial, init_attrs, domain, state_a, state_b,\n    ):\n        \"\"\"Domain toggle service flips state back and forth.\"\"\"\n        if init_attrs:\n            await rest.set_state(entity_id, initial, attributes=init_attrs)\n        else:\n            await rest.set_state(entity_id, initial)\n>       await rest.call_service(domain, \"toggle\", {\"entity_id\": entity_id})\n\ntests/api/test_rest_service_dispatch_patterns.py:457: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/siren/toggle'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0006621121428906918, "outcome": "passed"}}, {"nodeid": "tests/api/test_rest_service_dispatch_patterns.py::test_toggle_cycle[valve_toggle]", "lineno": 443, "outcome": "failed", "keywords": ["test_toggle_cycle[valve_toggle]", "parametrize", "pytestmark", "valve_toggle", "test_rest_service_dispatch_patterns.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005458465777337551, "outcome": "passed"}, "call": {"duration": 0.003924982156604528, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/valve/toggle'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/api/test_rest_service_dispatch_patterns.py", "lineno": 457, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b07cad00>\nentity_id = 'valve.cts_main', initial = 'open', init_attrs = {}\ndomain = 'valve', state_a = 'closed', state_b = 'open'\n\n    @pytest.mark.parametrize(\n        \"entity_id, initial, init_attrs, domain, state_a, state_b\",\n        [(c[1], c[2], c[3], c[4], c[5], c[6]) for c in _TOGGLE_CASES],\n        ids=[c[0] for c in _TOGGLE_CASES],\n    )\n    async def test_toggle_cycle(\n        rest, entity_id, initial, init_attrs, domain, state_a, state_b,\n    ):\n        \"\"\"Domain toggle service flips state back and forth.\"\"\"\n        if init_attrs:\n            await rest.set_state(entity_id, initial, attributes=init_attrs)\n        else:\n            await rest.set_state(entity_id, initial)\n>       await rest.call_service(domain, \"toggle\", {\"entity_id\": entity_id})\n\ntests/api/test_rest_service_dispatch_patterns.py:457: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/valve/toggle'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.00069382693618536, "outcome": "passed"}}, {"nodeid": "tests/api/test_rest_service_dispatch_patterns.py::test_toggle_cycle[fan_toggle]", "lineno": 443, "outcome": "failed", "keywords": ["test_toggle_cycle[fan_toggle]", "parametrize", "pytestmark", "fan_toggle", "test_rest_service_dispatch_patterns.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005436488892883062, "outcome": "passed"}, "call": {"duration": 0.004062972962856293, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/fan/toggle'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/api/test_rest_service_dispatch_patterns.py", "lineno": 457, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b06e9850>\nentity_id = 'fan.cts_toggle', initial = 'on', init_attrs = {'percentage': 75}\ndomain = 'fan', state_a = 'off', state_b = 'on'\n\n    @pytest.mark.parametrize(\n        \"entity_id, initial, init_attrs, domain, state_a, state_b\",\n        [(c[1], c[2], c[3], c[4], c[5], c[6]) for c in _TOGGLE_CASES],\n        ids=[c[0] for c in _TOGGLE_CASES],\n    )\n    async def test_toggle_cycle(\n        rest, entity_id, initial, init_attrs, domain, state_a, state_b,\n    ):\n        \"\"\"Domain toggle service flips state back and forth.\"\"\"\n        if init_attrs:\n            await rest.set_state(entity_id, initial, attributes=init_attrs)\n        else:\n            await rest.set_state(entity_id, initial)\n>       await rest.call_service(domain, \"toggle\", {\"entity_id\": entity_id})\n\ntests/api/test_rest_service_dispatch_patterns.py:457: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/fan/toggle'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0007208511233329773, "outcome": "passed"}}, {"nodeid": "tests/api/test_rest_service_dispatch_patterns.py::test_cover_toggle_with_position", "lineno": 467, "outcome": "failed", "keywords": ["test_cover_toggle_with_position", "test_rest_service_dispatch_patterns.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005469626747071743, "outcome": "passed"}, "call": {"duration": 0.004087479319423437, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/cover/toggle'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/api/test_rest_service_dispatch_patterns.py", "lineno": 473, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b06e9a60>\n\n    async def test_cover_toggle_with_position(rest):\n        \"\"\"cover.toggle flips state and updates current_position attribute.\"\"\"\n        await rest.set_state(\n            \"cover.cts_toggle\", \"open\", attributes={\"current_position\": 100},\n        )\n>       await rest.call_service(\"cover\", \"toggle\", {\"entity_id\": \"cover.cts_toggle\"})\n\ntests/api/test_rest_service_dispatch_patterns.py:473: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/cover/toggle'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.000840937253087759, "outcome": "passed"}}, {"nodeid": "tests/api/test_rest_service_dispatch_patterns.py::test_multi_step_cycle[input_boolean_on_off_cycle]", "lineno": 505, "outcome": "failed", "keywords": ["test_multi_step_cycle[input_boolean_on_off_cycle]", "parametrize", "pytestmark", "input_boolean_on_off_cycle", "test_rest_service_dispatch_patterns.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005376506596803665, "outcome": "passed"}, "call": {"duration": 0.00546440901234746, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_rest_service_dispatch_patterns.py", "lineno": 520, "message": "AssertionError: After input_boolean.turn_on: expected 'on', got 'off'\nassert 'off' == 'on'\n  \n  - on\n  + off"}, "traceback": [{"path": "tests/api/test_rest_service_dispatch_patterns.py", "lineno": 520, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b05fb970>\nentity_id = 'input_boolean.cycle_test', initial = 'off', init_attrs = {}\nsteps = [('input_boolean', 'turn_on', 'on'), ('input_boolean', 'turn_off', 'off'), ('input_boolean', 'toggle', 'on')]\n\n    @pytest.mark.parametrize(\n        \"entity_id, initial, init_attrs, steps\",\n        [(c[1], c[2], c[3], c[4]) for c in _MULTI_STEP_CASES],\n        ids=[c[0] for c in _MULTI_STEP_CASES],\n    )\n    async def test_multi_step_cycle(rest, entity_id, initial, init_attrs, steps):\n        \"\"\"Multiple sequential service calls each produce the expected state.\"\"\"\n        if init_attrs:\n            await rest.set_state(entity_id, initial, attributes=init_attrs)\n        else:\n            await rest.set_state(entity_id, initial)\n        for domain, service, expected in steps:\n            await rest.call_service(domain, service, {\"entity_id\": entity_id})\n            s = await rest.get_state(entity_id)\n>           assert s[\"state\"] == expected, (\n                f\"After {domain}.{service}: expected {expected!r}, got {s['state']!r}\"\n            )\nE           AssertionError: After input_boolean.turn_on: expected 'on', got 'off'\nE           assert 'off' == 'on'\nE             \nE             - on\nE             + off\n\ntests/api/test_rest_service_dispatch_patterns.py:520: AssertionError"}, "teardown": {"duration": 0.0006332490593194962, "outcome": "passed"}}, {"nodeid": "tests/api/test_rest_service_dispatch_patterns.py::test_multi_step_cycle[input_boolean_services]", "lineno": 505, "outcome": "failed", "keywords": ["test_multi_step_cycle[input_boolean_services]", "parametrize", "pytestmark", "input_boolean_services", "test_rest_service_dispatch_patterns.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005191608797758818, "outcome": "passed"}, "call": {"duration": 0.0055265119299292564, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_rest_service_dispatch_patterns.py", "lineno": 520, "message": "AssertionError: After input_boolean.turn_on: expected 'on', got 'off'\nassert 'off' == 'on'\n  \n  - on\n  + off"}, "traceback": [{"path": "tests/api/test_rest_service_dispatch_patterns.py", "lineno": 520, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b095df10>\nentity_id = 'input_boolean.cts_guest_mode', initial = 'off', init_attrs = {}\nsteps = [('input_boolean', 'turn_on', 'on'), ('input_boolean', 'toggle', 'off'), ('input_boolean', 'turn_off', 'off')]\n\n    @pytest.mark.parametrize(\n        \"entity_id, initial, init_attrs, steps\",\n        [(c[1], c[2], c[3], c[4]) for c in _MULTI_STEP_CASES],\n        ids=[c[0] for c in _MULTI_STEP_CASES],\n    )\n    async def test_multi_step_cycle(rest, entity_id, initial, init_attrs, steps):\n        \"\"\"Multiple sequential service calls each produce the expected state.\"\"\"\n        if init_attrs:\n            await rest.set_state(entity_id, initial, attributes=init_attrs)\n        else:\n            await rest.set_state(entity_id, initial)\n        for domain, service, expected in steps:\n            await rest.call_service(domain, service, {\"entity_id\": entity_id})\n            s = await rest.get_state(entity_id)\n>           assert s[\"state\"] == expected, (\n                f\"After {domain}.{service}: expected {expected!r}, got {s['state']!r}\"\n            )\nE           AssertionError: After input_boolean.turn_on: expected 'on', got 'off'\nE           assert 'off' == 'on'\nE             \nE             - on\nE             + off\n\ntests/api/test_rest_service_dispatch_patterns.py:520: AssertionError"}, "teardown": {"duration": 0.0007002097554504871, "outcome": "passed"}}, {"nodeid": "tests/api/test_rest_service_dispatch_patterns.py::test_cover_stop_preserves_state", "lineno": 526, "outcome": "failed", "keywords": ["test_cover_stop_preserves_state", "test_rest_service_dispatch_patterns.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.004964379593729973, "outcome": "passed"}, "call": {"duration": 0.003987032920122147, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/cover/stop_cover'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/api/test_rest_service_dispatch_patterns.py", "lineno": 532, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0a221f0>\n\n    async def test_cover_stop_preserves_state(rest):\n        \"\"\"cover.stop_cover keeps cover in current position and state.\"\"\"\n        await rest.set_state(\n            \"cover.cts_garage\", \"opening\", attributes={\"current_position\": 50},\n        )\n>       await rest.call_service(\"cover\", \"stop_cover\", {\"entity_id\": \"cover.cts_garage\"})\n\ntests/api/test_rest_service_dispatch_patterns.py:532: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/cover/stop_cover'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0007148357108235359, "outcome": "passed"}}, {"nodeid": "tests/api/test_rest_service_dispatch_patterns.py::test_media_player_next_previous_preserves_playing", "lineno": 537, "outcome": "failed", "keywords": ["test_media_player_next_previous_preserves_playing", "test_rest_service_dispatch_patterns.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005106505937874317, "outcome": "passed"}, "call": {"duration": 0.004104183986783028, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/media_player/media_next_track'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/api/test_rest_service_dispatch_patterns.py", "lineno": 544, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b06196d0>\n\n    async def test_media_player_next_previous_preserves_playing(rest):\n        \"\"\"media_player next/previous track preserve playing state.\"\"\"\n        await rest.set_state(\n            \"media_player.cts_speaker\", \"playing\",\n            attributes={\"media_title\": \"Track 1\"},\n        )\n>       await rest.call_service(\n            \"media_player\", \"media_next_track\",\n            {\"entity_id\": \"media_player.cts_speaker\"},\n        )\n\ntests/api/test_rest_service_dispatch_patterns.py:544: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/media_player/media_next_track'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0009012469090521336, "outcome": "passed"}}, {"nodeid": "tests/api/test_rest_states_bulk_ops.py::test_get_all_states_returns_list", "lineno": 16, "outcome": "passed", "keywords": ["test_get_all_states_returns_list", "test_rest_states_bulk_ops.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.006057413294911385, "outcome": "passed"}, "call": {"duration": 0.003836104180663824, "outcome": "passed"}, "teardown": {"duration": 0.0008570998907089233, "outcome": "passed"}}, {"nodeid": "tests/api/test_rest_states_bulk_ops.py::test_get_all_states_nonempty", "lineno": 22, "outcome": "passed", "keywords": ["test_get_all_states_nonempty", "test_rest_states_bulk_ops.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.006577290128916502, "outcome": "passed"}, "call": {"duration": 0.003677689004689455, "outcome": "passed"}, "teardown": {"duration": 0.0006089182570576668, "outcome": "passed"}}, {"nodeid": "tests/api/test_rest_states_bulk_ops.py::test_state_entry_has_entity_id", "lineno": 28, "outcome": "passed", "keywords": ["test_state_entry_has_entity_id", "test_rest_states_bulk_ops.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005369073711335659, "outcome": "passed"}, "call": {"duration": 0.006163156125694513, "outcome": "passed"}, "teardown": {"duration": 0.0005799052305519581, "outcome": "passed"}}, {"nodeid": "tests/api/test_rest_states_bulk_ops.py::test_state_entry_has_state", "lineno": 36, "outcome": "passed", "keywords": ["test_state_entry_has_state", "test_rest_states_bulk_ops.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005127981770783663, "outcome": "passed"}, "call": {"duration": 0.0039014089852571487, "outcome": "passed"}, "teardown": {"duration": 0.000706586055457592, "outcome": "passed"}}, {"nodeid": "tests/api/test_rest_states_bulk_ops.py::test_state_entry_has_attributes", "lineno": 44, "outcome": "passed", "keywords": ["test_state_entry_has_attributes", "test_rest_states_bulk_ops.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.0059188781306147575, "outcome": "passed"}, "call": {"duration": 0.003629871644079685, "outcome": "passed"}, "teardown": {"duration": 0.0004715011455118656, "outcome": "passed"}}, {"nodeid": "tests/api/test_rest_states_bulk_ops.py::test_state_entry_has_timestamps", "lineno": 52, "outcome": "passed", "keywords": ["test_state_entry_has_timestamps", "test_rest_states_bulk_ops.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005356868728995323, "outcome": "passed"}, "call": {"duration": 0.003789291251450777, "outcome": "passed"}, "teardown": {"duration": 0.0007153102196753025, "outcome": "passed"}}, {"nodeid": "tests/api/test_rest_states_bulk_ops.py::test_state_entry_has_context", "lineno": 60, "outcome": "passed", "keywords": ["test_state_entry_has_context", "test_rest_states_bulk_ops.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005256391130387783, "outcome": "passed"}, "call": {"duration": 0.003695930354297161, "outcome": "passed"}, "teardown": {"duration": 0.000530109740793705, "outcome": "passed"}}, {"nodeid": "tests/api/test_rest_states_bulk_ops.py::test_created_entity_in_get_all", "lineno": 68, "outcome": "passed", "keywords": ["test_created_entity_in_get_all", "test_rest_states_bulk_ops.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005444426089525223, "outcome": "passed"}, "call": {"duration": 0.005361608695238829, "outcome": "passed"}, "teardown": {"duration": 0.0004948950372636318, "outcome": "passed"}}, {"nodeid": "tests/api/test_rest_states_bulk_ops.py::test_delete_entity_returns_200", "lineno": 81, "outcome": "passed", "keywords": ["test_delete_entity_returns_200", "test_rest_states_bulk_ops.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.0051568299531936646, "outcome": "passed"}, "call": {"duration": 0.00422469200566411, "outcome": "passed"}, "teardown": {"duration": 0.000555903185158968, "outcome": "passed"}}, {"nodeid": "tests/api/test_rest_states_bulk_ops.py::test_delete_entity_removes_from_states", "lineno": 94, "outcome": "passed", "keywords": ["test_delete_entity_removes_from_states", "test_rest_states_bulk_ops.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.00578547827899456, "outcome": "passed"}, "call": {"duration": 0.006189261097460985, "outcome": "passed"}, "teardown": {"duration": 0.0006098570302128792, "outcome": "passed"}}, {"nodeid": "tests/api/test_rest_states_bulk_ops.py::test_delete_entity_then_recreate", "lineno": 109, "outcome": "passed", "keywords": ["test_delete_entity_then_recreate", "test_rest_states_bulk_ops.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.0059388261288404465, "outcome": "passed"}, "call": {"duration": 0.006156072951853275, "outcome": "passed"}, "teardown": {"duration": 0.0004987260326743126, "outcome": "passed"}}, {"nodeid": "tests/api/test_rest_states_bulk_ops.py::test_delete_nonexistent_entity", "lineno": 126, "outcome": "passed", "keywords": ["test_delete_nonexistent_entity", "test_rest_states_bulk_ops.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005293167196214199, "outcome": "passed"}, "call": {"duration": 0.0033529195934534073, "outcome": "passed"}, "teardown": {"duration": 0.0005187690258026123, "outcome": "passed"}}, {"nodeid": "tests/api/test_rest_states_bulk_ops.py::test_set_and_get_consistency", "lineno": 138, "outcome": "passed", "keywords": ["test_set_and_get_consistency", "test_rest_states_bulk_ops.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.0051109641790390015, "outcome": "passed"}, "call": {"duration": 0.005936287809163332, "outcome": "passed"}, "teardown": {"duration": 0.0004858383908867836, "outcome": "passed"}}, {"nodeid": "tests/api/test_rest_states_bulk_ops.py::test_multiple_entities_unique", "lineno": 149, "outcome": "passed", "keywords": ["test_multiple_entities_unique", "test_rest_states_bulk_ops.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005771988071501255, "outcome": "passed"}, "call": {"duration": 0.01577667100355029, "outcome": "passed"}, "teardown": {"duration": 0.0005265460349619389, "outcome": "passed"}}, {"nodeid": "tests/api/test_rest_states_patterns.py::test_get_states_returns_list", "lineno": 15, "outcome": "passed", "keywords": ["test_get_states_returns_list", "test_rest_states_patterns.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005212577059864998, "outcome": "passed"}, "call": {"duration": 0.0035094041377305984, "outcome": "passed"}, "teardown": {"duration": 0.00047646230086684227, "outcome": "passed"}}, {"nodeid": "tests/api/test_rest_states_patterns.py::test_set_state_creates_entity", "lineno": 26, "outcome": "failed", "keywords": ["test_set_state_creates_entity", "test_rest_states_patterns.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005772273056209087, "outcome": "passed"}, "call": {"duration": 0.0028648879379034042, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_rest_states_patterns.py", "lineno": 37, "message": "assert 201 == 200\n +  where 201 = <Response [201 Created]>.status_code"}, "traceback": [{"path": "tests/api/test_rest_states_patterns.py", "lineno": 37, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b05b1460>\n\n    async def test_set_state_creates_entity(rest):\n        \"\"\"POST /api/states/{eid} creates a new entity.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"sensor.new_{tag}\"\n    \n        resp = await rest.client.post(\n            f\"{rest.base_url}/api/states/{eid}\",\n            json={\"state\": \"hello\", \"attributes\": {\"friendly_name\": \"New Entity\"}},\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 201 == 200\nE        +  where 201 = <Response [201 Created]>.status_code\n\ntests/api/test_rest_states_patterns.py:37: AssertionError"}, "teardown": {"duration": 0.0005290298722684383, "outcome": "passed"}}, {"nodeid": "tests/api/test_rest_states_patterns.py::test_set_state_updates_existing", "lineno": 43, "outcome": "passed", "keywords": ["test_set_state_updates_existing", "test_rest_states_patterns.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005097285378724337, "outcome": "passed"}, "call": {"duration": 0.00555923767387867, "outcome": "passed"}, "teardown": {"duration": 0.0005095819942653179, "outcome": "passed"}}, {"nodeid": "tests/api/test_rest_states_patterns.py::test_delete_state_removes_entity", "lineno": 54, "outcome": "passed", "keywords": ["test_delete_state_removes_entity", "test_rest_states_patterns.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.00508967274799943, "outcome": "passed"}, "call": {"duration": 0.012404206208884716, "outcome": "passed"}, "teardown": {"duration": 0.00055716373026371, "outcome": "passed"}}, {"nodeid": "tests/api/test_rest_states_patterns.py::test_delete_nonexistent_returns_404", "lineno": 73, "outcome": "passed", "keywords": ["test_delete_nonexistent_returns_404", "test_rest_states_patterns.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005372354760766029, "outcome": "passed"}, "call": {"duration": 0.0024974457919597626, "outcome": "passed"}, "teardown": {"duration": 0.0005074846558272839, "outcome": "passed"}}, {"nodeid": "tests/api/test_rest_states_patterns.py::test_get_nonexistent_returns_404", "lineno": 82, "outcome": "passed", "keywords": ["test_get_nonexistent_returns_404", "test_rest_states_patterns.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.0057000028900802135, "outcome": "passed"}, "call": {"duration": 0.0025366758927702904, "outcome": "passed"}, "teardown": {"duration": 0.0004598572850227356, "outcome": "passed"}}, {"nodeid": "tests/api/test_rest_states_patterns.py::test_set_state_with_numeric_string", "lineno": 91, "outcome": "passed", "keywords": ["test_set_state_with_numeric_string", "test_rest_states_patterns.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005196882411837578, "outcome": "passed"}, "call": {"duration": 0.006594258826225996, "outcome": "passed"}, "teardown": {"duration": 0.0005242130719125271, "outcome": "passed"}}, {"nodeid": "tests/api/test_rest_states_patterns.py::test_set_state_with_boolean_attributes", "lineno": 101, "outcome": "passed", "keywords": ["test_set_state_with_boolean_attributes", "test_rest_states_patterns.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005375135224312544, "outcome": "passed"}, "call": {"duration": 0.003855234943330288, "outcome": "passed"}, "teardown": {"duration": 0.0004822881892323494, "outcome": "passed"}}, {"nodeid": "tests/api/test_rest_states_patterns.py::test_set_state_with_nested_attributes", "lineno": 112, "outcome": "passed", "keywords": ["test_set_state_with_nested_attributes", "test_rest_states_patterns.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005931511987000704, "outcome": "passed"}, "call": {"duration": 0.0038904831744730473, "outcome": "passed"}, "teardown": {"duration": 0.0004979562945663929, "outcome": "passed"}}, {"nodeid": "tests/api/test_rest_states_patterns.py::test_set_state_empty_string", "lineno": 126, "outcome": "passed", "keywords": ["test_set_state_empty_string", "test_rest_states_patterns.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005341051146388054, "outcome": "passed"}, "call": {"duration": 0.006822769995778799, "outcome": "passed"}, "teardown": {"duration": 0.0005235029384493828, "outcome": "passed"}}, {"nodeid": "tests/api/test_rest_states_patterns.py::test_set_state_long_value", "lineno": 136, "outcome": "failed", "keywords": ["test_set_state_long_value", "test_rest_states_patterns.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005543521139770746, "outcome": "passed"}, "call": {"duration": 0.0028694169595837593, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/states/sensor.long_5fb2d4db'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/api/test_rest_states_patterns.py", "lineno": 142, "message": ""}, {"path": "tests/conftest.py", "lineno": 94, "message": "in set_state"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b132bfa0>\n\n    async def test_set_state_long_value(rest):\n        \"\"\"Long state value (1000 chars) works.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"sensor.long_{tag}\"\n        long_val = \"x\" * 1000\n>       await rest.set_state(eid, long_val)\n\ntests/api/test_rest_states_patterns.py:142: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:94: in set_state\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/states/sensor.long_5fb2d4db'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.000670229084789753, "outcome": "passed"}}, {"nodeid": "tests/api/test_rest_states_patterns.py::test_entity_id_with_underscores", "lineno": 147, "outcome": "passed", "keywords": ["test_entity_id_with_underscores", "test_rest_states_patterns.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005301163997501135, "outcome": "passed"}, "call": {"duration": 0.004344779998064041, "outcome": "passed"}, "teardown": {"duration": 0.0005179960280656815, "outcome": "passed"}}, {"nodeid": "tests/api/test_rest_states_patterns.py::test_set_state_response_has_entity_fields", "lineno": 157, "outcome": "passed", "keywords": ["test_set_state_response_has_entity_fields", "test_rest_states_patterns.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005817655008286238, "outcome": "passed"}, "call": {"duration": 0.002754448913037777, "outcome": "passed"}, "teardown": {"duration": 0.0004694228991866112, "outcome": "passed"}}, {"nodeid": "tests/api/test_rest_template_endpoint.py::test_template_simple_expression", "lineno": 17, "outcome": "passed", "keywords": ["test_template_simple_expression", "test_rest_template_endpoint.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005404924973845482, "outcome": "passed"}, "call": {"duration": 0.005176813807338476, "outcome": "passed"}, "teardown": {"duration": 0.000515286810696125, "outcome": "passed"}}, {"nodeid": "tests/api/test_rest_template_endpoint.py::test_template_string_literal", "lineno": 28, "outcome": "passed", "keywords": ["test_template_string_literal", "test_rest_template_endpoint.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005319835152477026, "outcome": "passed"}, "call": {"duration": 0.002912952098995447, "outcome": "passed"}, "teardown": {"duration": 0.00047295307740569115, "outcome": "passed"}}, {"nodeid": "tests/api/test_rest_template_endpoint.py::test_template_is_state_function", "lineno": 39, "outcome": "passed", "keywords": ["test_template_is_state_function", "test_rest_template_endpoint.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005846492014825344, "outcome": "passed"}, "call": {"duration": 0.004629988688975573, "outcome": "passed"}, "teardown": {"duration": 0.0004809643141925335, "outcome": "passed"}}, {"nodeid": "tests/api/test_rest_template_endpoint.py::test_template_invalid_syntax_returns_400", "lineno": 54, "outcome": "passed", "keywords": ["test_template_invalid_syntax_returns_400", "test_rest_template_endpoint.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005146265961229801, "outcome": "passed"}, "call": {"duration": 0.00543170003220439, "outcome": "passed"}, "teardown": {"duration": 0.000518465880304575, "outcome": "passed"}}, {"nodeid": "tests/api/test_rest_template_endpoint.py::test_template_plain_text", "lineno": 64, "outcome": "passed", "keywords": ["test_template_plain_text", "test_rest_template_endpoint.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.0052903746254742146, "outcome": "passed"}, "call": {"duration": 0.002418870572000742, "outcome": "passed"}, "teardown": {"duration": 0.0004493109881877899, "outcome": "passed"}}, {"nodeid": "tests/api/test_rest_template_endpoint.py::test_template_state_attr_function", "lineno": 75, "outcome": "passed", "keywords": ["test_template_state_attr_function", "test_rest_template_endpoint.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005174233578145504, "outcome": "passed"}, "call": {"duration": 0.005984026938676834, "outcome": "passed"}, "teardown": {"duration": 0.0004991120658814907, "outcome": "passed"}}, {"nodeid": "tests/api/test_rest_template_endpoint.py::test_template_multiple_expressions", "lineno": 90, "outcome": "passed", "keywords": ["test_template_multiple_expressions", "test_rest_template_endpoint.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005150350742042065, "outcome": "passed"}, "call": {"duration": 0.005584260914474726, "outcome": "passed"}, "teardown": {"duration": 0.0005335188470780849, "outcome": "passed"}}, {"nodeid": "tests/api/test_scene_config_api.py::test_list_scenes_returns_list", "lineno": 14, "outcome": "failed", "keywords": ["test_list_scenes_returns_list", "test_scene_config_api.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.00534834386780858, "outcome": "passed"}, "call": {"duration": 0.0025847512297332287, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_scene_config_api.py", "lineno": 21, "message": "assert 404 == 200\n +  where 404 = <Response [404 Not Found]>.status_code"}, "traceback": [{"path": "tests/api/test_scene_config_api.py", "lineno": 21, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b08d9b50>\n\n    async def test_list_scenes_returns_list(rest):\n        \"\"\"GET /api/config/scene/config returns a list.\"\"\"\n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/config/scene/config\",\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 404 == 200\nE        +  where 404 = <Response [404 Not Found]>.status_code\n\ntests/api/test_scene_config_api.py:21: AssertionError"}, "teardown": {"duration": 0.0005281730554997921, "outcome": "passed"}}, {"nodeid": "tests/api/test_scene_config_api.py::test_list_scenes_has_id", "lineno": 26, "outcome": "failed", "keywords": ["test_list_scenes_has_id", "test_scene_config_api.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005818898323923349, "outcome": "passed"}, "call": {"duration": 0.0026532472111284733, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)"}, "traceback": [{"path": "tests/api/test_scene_config_api.py", "lineno": 33, "message": ""}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 832, "message": "in json"}, {"path": "../../anaconda3/lib/python3.9/json/__init__.py", "lineno": 346, "message": "in loads"}, {"path": "../../anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "JSONDecodeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b062f310>\n\n    async def test_list_scenes_has_id(rest):\n        \"\"\"Each scene entry has an id field.\"\"\"\n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/config/scene/config\",\n            headers=rest._headers(),\n        )\n>       data = resp.json()\n\ntests/api/test_scene_config_api.py:33: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:832: in json\n    return jsonlib.loads(self.content, **kwargs)\n../../anaconda3/lib/python3.9/json/__init__.py:346: in loads\n    return _default_decoder.decode(s)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <json.decoder.JSONDecoder object at 0x7f47b2e5fe50>, s = '404: Not Found'\n_w = <built-in method match of re.Pattern object at 0x7f47b3015cf0>\n\n    def decode(self, s, _w=WHITESPACE.match):\n        \"\"\"Return the Python representation of ``s`` (a ``str`` instance\n        containing a JSON document).\n    \n        \"\"\"\n        obj, end = self.raw_decode(s, idx=_w(s, 0).end())\n        end = _w(s, end).end()\n        if end != len(s):\n>           raise JSONDecodeError(\"Extra data\", s, end)\nE           json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)\n\n../../anaconda3/lib/python3.9/json/decoder.py:340: JSONDecodeError"}, "teardown": {"duration": 0.0006571318954229355, "outcome": "passed"}}, {"nodeid": "tests/api/test_scene_config_api.py::test_list_scenes_has_name", "lineno": 37, "outcome": "failed", "keywords": ["test_list_scenes_has_name", "test_scene_config_api.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005363778211176395, "outcome": "passed"}, "call": {"duration": 0.0029980791732668877, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)"}, "traceback": [{"path": "tests/api/test_scene_config_api.py", "lineno": 44, "message": ""}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 832, "message": "in json"}, {"path": "../../anaconda3/lib/python3.9/json/__init__.py", "lineno": 346, "message": "in loads"}, {"path": "../../anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "JSONDecodeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0978910>\n\n    async def test_list_scenes_has_name(rest):\n        \"\"\"Each scene entry has a name field.\"\"\"\n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/config/scene/config\",\n            headers=rest._headers(),\n        )\n>       data = resp.json()\n\ntests/api/test_scene_config_api.py:44: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:832: in json\n    return jsonlib.loads(self.content, **kwargs)\n../../anaconda3/lib/python3.9/json/__init__.py:346: in loads\n    return _default_decoder.decode(s)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <json.decoder.JSONDecoder object at 0x7f47b2e5fe50>, s = '404: Not Found'\n_w = <built-in method match of re.Pattern object at 0x7f47b3015cf0>\n\n    def decode(self, s, _w=WHITESPACE.match):\n        \"\"\"Return the Python representation of ``s`` (a ``str`` instance\n        containing a JSON document).\n    \n        \"\"\"\n        obj, end = self.raw_decode(s, idx=_w(s, 0).end())\n        end = _w(s, end).end()\n        if end != len(s):\n>           raise JSONDecodeError(\"Extra data\", s, end)\nE           json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)\n\n../../anaconda3/lib/python3.9/json/decoder.py:340: JSONDecodeError"}, "teardown": {"duration": 0.0006816228851675987, "outcome": "passed"}}, {"nodeid": "tests/api/test_scene_config_api.py::test_list_scenes_has_entity_count", "lineno": 48, "outcome": "failed", "keywords": ["test_list_scenes_has_entity_count", "test_scene_config_api.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005434324964880943, "outcome": "passed"}, "call": {"duration": 0.002772136125713587, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)"}, "traceback": [{"path": "tests/api/test_scene_config_api.py", "lineno": 55, "message": ""}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 832, "message": "in json"}, {"path": "../../anaconda3/lib/python3.9/json/__init__.py", "lineno": 346, "message": "in loads"}, {"path": "../../anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "JSONDecodeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0978640>\n\n    async def test_list_scenes_has_entity_count(rest):\n        \"\"\"Each scene entry has entity_count.\"\"\"\n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/config/scene/config\",\n            headers=rest._headers(),\n        )\n>       data = resp.json()\n\ntests/api/test_scene_config_api.py:55: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:832: in json\n    return jsonlib.loads(self.content, **kwargs)\n../../anaconda3/lib/python3.9/json/__init__.py:346: in loads\n    return _default_decoder.decode(s)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <json.decoder.JSONDecoder object at 0x7f47b2e5fe50>, s = '404: Not Found'\n_w = <built-in method match of re.Pattern object at 0x7f47b3015cf0>\n\n    def decode(self, s, _w=WHITESPACE.match):\n        \"\"\"Return the Python representation of ``s`` (a ``str`` instance\n        containing a JSON document).\n    \n        \"\"\"\n        obj, end = self.raw_decode(s, idx=_w(s, 0).end())\n        end = _w(s, end).end()\n        if end != len(s):\n>           raise JSONDecodeError(\"Extra data\", s, end)\nE           json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)\n\n../../anaconda3/lib/python3.9/json/decoder.py:340: JSONDecodeError"}, "teardown": {"duration": 0.0006757788360118866, "outcome": "passed"}}, {"nodeid": "tests/api/test_scene_config_api.py::test_get_scene_yaml", "lineno": 60, "outcome": "failed", "keywords": ["test_get_scene_yaml", "test_scene_config_api.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005150137934833765, "outcome": "passed"}, "call": {"duration": 0.0029341387562453747, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_scene_config_api.py", "lineno": 67, "message": "assert 404 == 200\n +  where 404 = <Response [404 Not Found]>.status_code"}, "traceback": [{"path": "tests/api/test_scene_config_api.py", "lineno": 67, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b05e2940>\n\n    async def test_get_scene_yaml(rest):\n        \"\"\"GET /api/config/scene/yaml returns YAML text.\"\"\"\n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/config/scene/yaml\",\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 404 == 200\nE        +  where 404 = <Response [404 Not Found]>.status_code\n\ntests/api/test_scene_config_api.py:67: AssertionError"}, "teardown": {"duration": 0.0006620790809392929, "outcome": "passed"}}, {"nodeid": "tests/api/test_scene_config_api.py::test_scene_evening_in_list", "lineno": 70, "outcome": "failed", "keywords": ["test_scene_evening_in_list", "test_scene_config_api.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005538349971175194, "outcome": "passed"}, "call": {"duration": 0.0031286231242120266, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)"}, "traceback": [{"path": "tests/api/test_scene_config_api.py", "lineno": 77, "message": ""}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 832, "message": "in json"}, {"path": "../../anaconda3/lib/python3.9/json/__init__.py", "lineno": 346, "message": "in loads"}, {"path": "../../anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "JSONDecodeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b09a7d90>\n\n    async def test_scene_evening_in_list(rest):\n        \"\"\"Evening scene appears in the scene list.\"\"\"\n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/config/scene/config\",\n            headers=rest._headers(),\n        )\n>       data = resp.json()\n\ntests/api/test_scene_config_api.py:77: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:832: in json\n    return jsonlib.loads(self.content, **kwargs)\n../../anaconda3/lib/python3.9/json/__init__.py:346: in loads\n    return _default_decoder.decode(s)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <json.decoder.JSONDecoder object at 0x7f47b2e5fe50>, s = '404: Not Found'\n_w = <built-in method match of re.Pattern object at 0x7f47b3015cf0>\n\n    def decode(self, s, _w=WHITESPACE.match):\n        \"\"\"Return the Python representation of ``s`` (a ``str`` instance\n        containing a JSON document).\n    \n        \"\"\"\n        obj, end = self.raw_decode(s, idx=_w(s, 0).end())\n        end = _w(s, end).end()\n        if end != len(s):\n>           raise JSONDecodeError(\"Extra data\", s, end)\nE           json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)\n\n../../anaconda3/lib/python3.9/json/decoder.py:340: JSONDecodeError"}, "teardown": {"duration": 0.0006388458423316479, "outcome": "passed"}}, {"nodeid": "tests/api/test_scene_config_api.py::test_scene_goodnight_in_list", "lineno": 81, "outcome": "failed", "keywords": ["test_scene_goodnight_in_list", "test_scene_config_api.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.006079734303057194, "outcome": "passed"}, "call": {"duration": 0.002634438220411539, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)"}, "traceback": [{"path": "tests/api/test_scene_config_api.py", "lineno": 88, "message": ""}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 832, "message": "in json"}, {"path": "../../anaconda3/lib/python3.9/json/__init__.py", "lineno": 346, "message": "in loads"}, {"path": "../../anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "JSONDecodeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b11d31f0>\n\n    async def test_scene_goodnight_in_list(rest):\n        \"\"\"Goodnight scene appears in the scene list.\"\"\"\n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/config/scene/config\",\n            headers=rest._headers(),\n        )\n>       data = resp.json()\n\ntests/api/test_scene_config_api.py:88: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:832: in json\n    return jsonlib.loads(self.content, **kwargs)\n../../anaconda3/lib/python3.9/json/__init__.py:346: in loads\n    return _default_decoder.decode(s)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <json.decoder.JSONDecoder object at 0x7f47b2e5fe50>, s = '404: Not Found'\n_w = <built-in method match of re.Pattern object at 0x7f47b3015cf0>\n\n    def decode(self, s, _w=WHITESPACE.match):\n        \"\"\"Return the Python representation of ``s`` (a ``str`` instance\n        containing a JSON document).\n    \n        \"\"\"\n        obj, end = self.raw_decode(s, idx=_w(s, 0).end())\n        end = _w(s, end).end()\n        if end != len(s):\n>           raise JSONDecodeError(\"Extra data\", s, end)\nE           json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)\n\n../../anaconda3/lib/python3.9/json/decoder.py:340: JSONDecodeError"}, "teardown": {"duration": 0.0008386699482798576, "outcome": "passed"}}, {"nodeid": "tests/api/test_scene_config_api.py::test_scene_config_returns_list", "lineno": 94, "outcome": "failed", "keywords": ["test_scene_config_returns_list", "test_scene_config_api.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005963399074971676, "outcome": "passed"}, "call": {"duration": 0.002678169868886471, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_scene_config_api.py", "lineno": 101, "message": "assert 404 == 200\n +  where 404 = <Response [404 Not Found]>.status_code"}, "traceback": [{"path": "tests/api/test_scene_config_api.py", "lineno": 101, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0541e80>\n\n    async def test_scene_config_returns_list(rest):\n        \"\"\"GET /api/config/scene/config returns a list of scenes.\"\"\"\n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/config/scene/config\",\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 404 == 200\nE        +  where 404 = <Response [404 Not Found]>.status_code\n\ntests/api/test_scene_config_api.py:101: AssertionError"}, "teardown": {"duration": 0.000476030632853508, "outcome": "passed"}}, {"nodeid": "tests/api/test_scene_config_api.py::test_scene_entity_has_friendly_name", "lineno": 113, "outcome": "failed", "keywords": ["test_scene_entity_has_friendly_name", "test_scene_config_api.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005374094005674124, "outcome": "passed"}, "call": {"duration": 0.0028252778574824333, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)"}, "traceback": [{"path": "tests/api/test_scene_config_api.py", "lineno": 120, "message": ""}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 832, "message": "in json"}, {"path": "../../anaconda3/lib/python3.9/json/__init__.py", "lineno": 346, "message": "in loads"}, {"path": "../../anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "JSONDecodeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b08c4cd0>\n\n    async def test_scene_entity_has_friendly_name(rest):\n        \"\"\"Scene entities have friendly_name attribute set from scene name.\"\"\"\n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/config/scene/config\",\n            headers=rest._headers(),\n        )\n>       scenes = resp.json()\n\ntests/api/test_scene_config_api.py:120: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:832: in json\n    return jsonlib.loads(self.content, **kwargs)\n../../anaconda3/lib/python3.9/json/__init__.py:346: in loads\n    return _default_decoder.decode(s)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <json.decoder.JSONDecoder object at 0x7f47b2e5fe50>, s = '404: Not Found'\n_w = <built-in method match of re.Pattern object at 0x7f47b3015cf0>\n\n    def decode(self, s, _w=WHITESPACE.match):\n        \"\"\"Return the Python representation of ``s`` (a ``str`` instance\n        containing a JSON document).\n    \n        \"\"\"\n        obj, end = self.raw_decode(s, idx=_w(s, 0).end())\n        end = _w(s, end).end()\n        if end != len(s):\n>           raise JSONDecodeError(\"Extra data\", s, end)\nE           json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)\n\n../../anaconda3/lib/python3.9/json/decoder.py:340: JSONDecodeError"}, "teardown": {"duration": 0.0007070768624544144, "outcome": "passed"}}, {"nodeid": "tests/api/test_scene_config_api.py::test_scene_activation_sets_entity_states", "lineno": 132, "outcome": "failed", "keywords": ["test_scene_activation_sets_entity_states", "test_scene_config_api.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005262752063572407, "outcome": "passed"}, "call": {"duration": 0.002537551335990429, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)"}, "traceback": [{"path": "tests/api/test_scene_config_api.py", "lineno": 139, "message": ""}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 832, "message": "in json"}, {"path": "../../anaconda3/lib/python3.9/json/__init__.py", "lineno": 346, "message": "in loads"}, {"path": "../../anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "JSONDecodeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b08c4550>\n\n    async def test_scene_activation_sets_entity_states(rest):\n        \"\"\"Activating a scene sets the target entity states.\"\"\"\n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/config/scene/config\",\n            headers=rest._headers(),\n        )\n>       scenes = resp.json()\n\ntests/api/test_scene_config_api.py:139: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:832: in json\n    return jsonlib.loads(self.content, **kwargs)\n../../anaconda3/lib/python3.9/json/__init__.py:346: in loads\n    return _default_decoder.decode(s)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <json.decoder.JSONDecoder object at 0x7f47b2e5fe50>, s = '404: Not Found'\n_w = <built-in method match of re.Pattern object at 0x7f47b3015cf0>\n\n    def decode(self, s, _w=WHITESPACE.match):\n        \"\"\"Return the Python representation of ``s`` (a ``str`` instance\n        containing a JSON document).\n    \n        \"\"\"\n        obj, end = self.raw_decode(s, idx=_w(s, 0).end())\n        end = _w(s, end).end()\n        if end != len(s):\n>           raise JSONDecodeError(\"Extra data\", s, end)\nE           json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)\n\n../../anaconda3/lib/python3.9/json/decoder.py:340: JSONDecodeError"}, "teardown": {"duration": 0.0007872399874031544, "outcome": "passed"}}, {"nodeid": "tests/api/test_scene_yaml_endpoints.py::test_get_scene_yaml_returns_200", "lineno": 13, "outcome": "failed", "keywords": ["test_get_scene_yaml_returns_200", "test_scene_yaml_endpoints.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005682304035872221, "outcome": "passed"}, "call": {"duration": 0.0030220751650631428, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_scene_yaml_endpoints.py", "lineno": 20, "message": "assert 404 == 200\n +  where 404 = <Response [404 Not Found]>.status_code"}, "traceback": [{"path": "tests/api/test_scene_yaml_endpoints.py", "lineno": 20, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b08c4e20>\n\n    async def test_get_scene_yaml_returns_200(rest):\n        \"\"\"GET /api/config/scene/yaml returns 200.\"\"\"\n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/config/scene/yaml\",\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 404 == 200\nE        +  where 404 = <Response [404 Not Found]>.status_code\n\ntests/api/test_scene_yaml_endpoints.py:20: AssertionError"}, "teardown": {"duration": 0.0007378337904810905, "outcome": "passed"}}, {"nodeid": "tests/api/test_scene_yaml_endpoints.py::test_get_scene_yaml_content_type", "lineno": 22, "outcome": "failed", "keywords": ["test_get_scene_yaml_content_type", "test_scene_yaml_endpoints.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005518332589417696, "outcome": "passed"}, "call": {"duration": 0.002992618829011917, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_scene_yaml_endpoints.py", "lineno": 29, "message": "AssertionError: assert 'text/yaml' in 'text/plain; charset=utf-8'\n +  where 'text/plain; charset=utf-8' = get('content-type', '')\n +    where get = Headers({'content-type': 'text/plain; charset=utf-8', 'referrer-policy': 'no-referrer', 'x-content-type-options': 'nosniff', 'server': '', 'x-frame-options': 'SAMEORIGIN', 'content-length': '14', 'date': 'Fri, 20 Feb 2026 23:11:13 GMT'}).get\n +      where Headers({'content-type': 'text/plain; charset=utf-8', 'referrer-policy': 'no-referrer', 'x-content-type-options': 'nosniff', 'server': '', 'x-frame-options': 'SAMEORIGIN', 'content-length': '14', 'date': 'Fri, 20 Feb 2026 23:11:13 GMT'}) = <Response [404 Not Found]>.headers"}, "traceback": [{"path": "tests/api/test_scene_yaml_endpoints.py", "lineno": 29, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b08dab20>\n\n    async def test_get_scene_yaml_content_type(rest):\n        \"\"\"GET /api/config/scene/yaml returns text/yaml content type.\"\"\"\n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/config/scene/yaml\",\n            headers=rest._headers(),\n        )\n>       assert \"text/yaml\" in resp.headers.get(\"content-type\", \"\")\nE       AssertionError: assert 'text/yaml' in 'text/plain; charset=utf-8'\nE        +  where 'text/plain; charset=utf-8' = get('content-type', '')\nE        +    where get = Headers({'content-type': 'text/plain; charset=utf-8', 'referrer-policy': 'no-referrer', 'x-content-type-options': 'nosniff', 'server': '', 'x-frame-options': 'SAMEORIGIN', 'content-length': '14', 'date': 'Fri, 20 Feb 2026 23:11:13 GMT'}).get\nE        +      where Headers({'content-type': 'text/plain; charset=utf-8', 'referrer-policy': 'no-referrer', 'x-content-type-options': 'nosniff', 'server': '', 'x-frame-options': 'SAMEORIGIN', 'content-length': '14', 'date': 'Fri, 20 Feb 2026 23:11:13 GMT'}) = <Response [404 Not Found]>.headers\n\ntests/api/test_scene_yaml_endpoints.py:29: AssertionError"}, "teardown": {"duration": 0.00047821179032325745, "outcome": "passed"}}, {"nodeid": "tests/api/test_scene_yaml_endpoints.py::test_get_scene_yaml_contains_scenes", "lineno": 31, "outcome": "failed", "keywords": ["test_get_scene_yaml_contains_scenes", "test_scene_yaml_endpoints.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005140119232237339, "outcome": "passed"}, "call": {"duration": 0.0030112620443105698, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_scene_yaml_endpoints.py", "lineno": 39, "message": "AssertionError: assert ('id:' in '404: Not Found' or 'name:' in '404: Not Found')"}, "traceback": [{"path": "tests/api/test_scene_yaml_endpoints.py", "lineno": 39, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b132bb50>\n\n    async def test_get_scene_yaml_contains_scenes(rest):\n        \"\"\"Scene YAML contains scene definitions.\"\"\"\n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/config/scene/yaml\",\n            headers=rest._headers(),\n        )\n        yaml_text = resp.text\n>       assert \"id:\" in yaml_text or \"name:\" in yaml_text\nE       AssertionError: assert ('id:' in '404: Not Found' or 'name:' in '404: Not Found')\n\ntests/api/test_scene_yaml_endpoints.py:39: AssertionError"}, "teardown": {"duration": 0.00051872618496418, "outcome": "passed"}}, {"nodeid": "tests/api/test_scene_yaml_endpoints.py::test_get_scene_yaml_has_evening", "lineno": 41, "outcome": "failed", "keywords": ["test_get_scene_yaml_has_evening", "test_scene_yaml_endpoints.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.004936890210956335, "outcome": "passed"}, "call": {"duration": 0.002397129312157631, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_scene_yaml_endpoints.py", "lineno": 48, "message": "AssertionError: assert 'evening' in '404: not found'\n +  where '404: not found' = <built-in method lower of str object at 0x7f47b126d7f0>()\n +    where <built-in method lower of str object at 0x7f47b126d7f0> = '404: Not Found'.lower\n +      where '404: Not Found' = <Response [404 Not Found]>.text"}, "traceback": [{"path": "tests/api/test_scene_yaml_endpoints.py", "lineno": 48, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b06b4bb0>\n\n    async def test_get_scene_yaml_has_evening(rest):\n        \"\"\"Scene YAML references 'evening' scene.\"\"\"\n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/config/scene/yaml\",\n            headers=rest._headers(),\n        )\n>       assert \"evening\" in resp.text.lower()\nE       AssertionError: assert 'evening' in '404: not found'\nE        +  where '404: not found' = <built-in method lower of str object at 0x7f47b126d7f0>()\nE        +    where <built-in method lower of str object at 0x7f47b126d7f0> = '404: Not Found'.lower\nE        +      where '404: Not Found' = <Response [404 Not Found]>.text\n\ntests/api/test_scene_yaml_endpoints.py:48: AssertionError"}, "teardown": {"duration": 0.0005723382346332073, "outcome": "passed"}}, {"nodeid": "tests/api/test_scene_yaml_endpoints.py::test_get_scene_yaml_has_goodnight", "lineno": 50, "outcome": "failed", "keywords": ["test_get_scene_yaml_has_goodnight", "test_scene_yaml_endpoints.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005316918715834618, "outcome": "passed"}, "call": {"duration": 0.003060133196413517, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_scene_yaml_endpoints.py", "lineno": 57, "message": "AssertionError: assert 'goodnight' in '404: not found'\n +  where '404: not found' = <built-in method lower of str object at 0x7f47b09d7bb0>()\n +    where <built-in method lower of str object at 0x7f47b09d7bb0> = '404: Not Found'.lower\n +      where '404: Not Found' = <Response [404 Not Found]>.text"}, "traceback": [{"path": "tests/api/test_scene_yaml_endpoints.py", "lineno": 57, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b09a7ac0>\n\n    async def test_get_scene_yaml_has_goodnight(rest):\n        \"\"\"Scene YAML references 'goodnight' scene.\"\"\"\n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/config/scene/yaml\",\n            headers=rest._headers(),\n        )\n>       assert \"goodnight\" in resp.text.lower()\nE       AssertionError: assert 'goodnight' in '404: not found'\nE        +  where '404: not found' = <built-in method lower of str object at 0x7f47b09d7bb0>()\nE        +    where <built-in method lower of str object at 0x7f47b09d7bb0> = '404: Not Found'.lower\nE        +      where '404: Not Found' = <Response [404 Not Found]>.text\n\ntests/api/test_scene_yaml_endpoints.py:57: AssertionError"}, "teardown": {"duration": 0.0004891837015748024, "outcome": "passed"}}, {"nodeid": "tests/api/test_scene_yaml_endpoints.py::test_put_scene_yaml_invalid_returns_400", "lineno": 59, "outcome": "failed", "keywords": ["test_put_scene_yaml_invalid_returns_400", "test_scene_yaml_endpoints.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.0052386680617928505, "outcome": "passed"}, "call": {"duration": 0.0028233048506081104, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_scene_yaml_endpoints.py", "lineno": 67, "message": "assert 404 == 400\n +  where 404 = <Response [404 Not Found]>.status_code"}, "traceback": [{"path": "tests/api/test_scene_yaml_endpoints.py", "lineno": 67, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b09a72e0>\n\n    async def test_put_scene_yaml_invalid_returns_400(rest):\n        \"\"\"PUT /api/config/scene/yaml with invalid YAML returns 400.\"\"\"\n        resp = await rest.client.put(\n            f\"{rest.base_url}/api/config/scene/yaml\",\n            content=\"not: valid: yaml: [[[\",\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 400\nE       assert 404 == 400\nE        +  where 404 = <Response [404 Not Found]>.status_code\n\ntests/api/test_scene_yaml_endpoints.py:67: AssertionError"}, "teardown": {"duration": 0.0006025750190019608, "outcome": "passed"}}, {"nodeid": "tests/api/test_scene_yaml_endpoints.py::test_put_scene_yaml_valid_roundtrip", "lineno": 69, "outcome": "failed", "keywords": ["test_put_scene_yaml_valid_roundtrip", "test_scene_yaml_endpoints.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005182494875043631, "outcome": "passed"}, "call": {"duration": 0.004499166738241911, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_scene_yaml_endpoints.py", "lineno": 83, "message": "assert 404 == 200\n +  where 404 = <Response [404 Not Found]>.status_code"}, "traceback": [{"path": "tests/api/test_scene_yaml_endpoints.py", "lineno": 83, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b08f34c0>\n\n    async def test_put_scene_yaml_valid_roundtrip(rest):\n        \"\"\"GET scene YAML then PUT it back succeeds.\"\"\"\n        get_resp = await rest.client.get(\n            f\"{rest.base_url}/api/config/scene/yaml\",\n            headers=rest._headers(),\n        )\n        original = get_resp.text\n    \n        put_resp = await rest.client.put(\n            f\"{rest.base_url}/api/config/scene/yaml\",\n            content=original,\n            headers=rest._headers(),\n        )\n>       assert put_resp.status_code == 200\nE       assert 404 == 200\nE        +  where 404 = <Response [404 Not Found]>.status_code\n\ntests/api/test_scene_yaml_endpoints.py:83: AssertionError"}, "teardown": {"duration": 0.0008675460703670979, "outcome": "passed"}}, {"nodeid": "tests/api/test_scene_yaml_endpoints.py::test_scene_config_list_returns_200", "lineno": 87, "outcome": "failed", "keywords": ["test_scene_config_list_returns_200", "test_scene_yaml_endpoints.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.00584429781883955, "outcome": "passed"}, "call": {"duration": 0.003170797135680914, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_scene_yaml_endpoints.py", "lineno": 94, "message": "assert 404 == 200\n +  where 404 = <Response [404 Not Found]>.status_code"}, "traceback": [{"path": "tests/api/test_scene_yaml_endpoints.py", "lineno": 94, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b06e9520>\n\n    async def test_scene_config_list_returns_200(rest):\n        \"\"\"GET /api/config/scene/config returns 200.\"\"\"\n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/config/scene/config\",\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 404 == 200\nE        +  where 404 = <Response [404 Not Found]>.status_code\n\ntests/api/test_scene_yaml_endpoints.py:94: AssertionError"}, "teardown": {"duration": 0.000595862977206707, "outcome": "passed"}}, {"nodeid": "tests/api/test_scene_yaml_endpoints.py::test_scene_config_list_is_array", "lineno": 96, "outcome": "failed", "keywords": ["test_scene_config_list_is_array", "test_scene_yaml_endpoints.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005402824841439724, "outcome": "passed"}, "call": {"duration": 0.00287734717130661, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)"}, "traceback": [{"path": "tests/api/test_scene_yaml_endpoints.py", "lineno": 103, "message": ""}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 832, "message": "in json"}, {"path": "../../anaconda3/lib/python3.9/json/__init__.py", "lineno": 346, "message": "in loads"}, {"path": "../../anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "JSONDecodeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b06e97c0>\n\n    async def test_scene_config_list_is_array(rest):\n        \"\"\"Scene config returns a JSON array.\"\"\"\n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/config/scene/config\",\n            headers=rest._headers(),\n        )\n>       data = resp.json()\n\ntests/api/test_scene_yaml_endpoints.py:103: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:832: in json\n    return jsonlib.loads(self.content, **kwargs)\n../../anaconda3/lib/python3.9/json/__init__.py:346: in loads\n    return _default_decoder.decode(s)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <json.decoder.JSONDecoder object at 0x7f47b2e5fe50>, s = '404: Not Found'\n_w = <built-in method match of re.Pattern object at 0x7f47b3015cf0>\n\n    def decode(self, s, _w=WHITESPACE.match):\n        \"\"\"Return the Python representation of ``s`` (a ``str`` instance\n        containing a JSON document).\n    \n        \"\"\"\n        obj, end = self.raw_decode(s, idx=_w(s, 0).end())\n        end = _w(s, end).end()\n        if end != len(s):\n>           raise JSONDecodeError(\"Extra data\", s, end)\nE           json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)\n\n../../anaconda3/lib/python3.9/json/decoder.py:340: JSONDecodeError"}, "teardown": {"duration": 0.0006643719971179962, "outcome": "passed"}}, {"nodeid": "tests/api/test_scene_yaml_endpoints.py::test_scene_config_has_at_least_two", "lineno": 106, "outcome": "failed", "keywords": ["test_scene_config_has_at_least_two", "test_scene_yaml_endpoints.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005183239933103323, "outcome": "passed"}, "call": {"duration": 0.002512534148991108, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)"}, "traceback": [{"path": "tests/api/test_scene_yaml_endpoints.py", "lineno": 113, "message": ""}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 832, "message": "in json"}, {"path": "../../anaconda3/lib/python3.9/json/__init__.py", "lineno": 346, "message": "in loads"}, {"path": "../../anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "JSONDecodeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b082ff70>\n\n    async def test_scene_config_has_at_least_two(rest):\n        \"\"\"At least 2 scenes (evening, goodnight) are configured.\"\"\"\n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/config/scene/config\",\n            headers=rest._headers(),\n        )\n>       data = resp.json()\n\ntests/api/test_scene_yaml_endpoints.py:113: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:832: in json\n    return jsonlib.loads(self.content, **kwargs)\n../../anaconda3/lib/python3.9/json/__init__.py:346: in loads\n    return _default_decoder.decode(s)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <json.decoder.JSONDecoder object at 0x7f47b2e5fe50>, s = '404: Not Found'\n_w = <built-in method match of re.Pattern object at 0x7f47b3015cf0>\n\n    def decode(self, s, _w=WHITESPACE.match):\n        \"\"\"Return the Python representation of ``s`` (a ``str`` instance\n        containing a JSON document).\n    \n        \"\"\"\n        obj, end = self.raw_decode(s, idx=_w(s, 0).end())\n        end = _w(s, end).end()\n        if end != len(s):\n>           raise JSONDecodeError(\"Extra data\", s, end)\nE           json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)\n\n../../anaconda3/lib/python3.9/json/decoder.py:340: JSONDecodeError"}, "teardown": {"duration": 0.0007221871055662632, "outcome": "passed"}}, {"nodeid": "tests/api/test_scene_yaml_endpoints.py::test_scene_config_entry_has_fields", "lineno": 116, "outcome": "failed", "keywords": ["test_scene_config_entry_has_fields", "test_scene_yaml_endpoints.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005155117716640234, "outcome": "passed"}, "call": {"duration": 0.0025969557464122772, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)"}, "traceback": [{"path": "tests/api/test_scene_yaml_endpoints.py", "lineno": 123, "message": ""}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 832, "message": "in json"}, {"path": "../../anaconda3/lib/python3.9/json/__init__.py", "lineno": 346, "message": "in loads"}, {"path": "../../anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "JSONDecodeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b067a0d0>\n\n    async def test_scene_config_entry_has_fields(rest):\n        \"\"\"Scene config entries have id, name, entity_count.\"\"\"\n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/config/scene/config\",\n            headers=rest._headers(),\n        )\n>       data = resp.json()\n\ntests/api/test_scene_yaml_endpoints.py:123: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:832: in json\n    return jsonlib.loads(self.content, **kwargs)\n../../anaconda3/lib/python3.9/json/__init__.py:346: in loads\n    return _default_decoder.decode(s)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <json.decoder.JSONDecoder object at 0x7f47b2e5fe50>, s = '404: Not Found'\n_w = <built-in method match of re.Pattern object at 0x7f47b3015cf0>\n\n    def decode(self, s, _w=WHITESPACE.match):\n        \"\"\"Return the Python representation of ``s`` (a ``str`` instance\n        containing a JSON document).\n    \n        \"\"\"\n        obj, end = self.raw_decode(s, idx=_w(s, 0).end())\n        end = _w(s, end).end()\n        if end != len(s):\n>           raise JSONDecodeError(\"Extra data\", s, end)\nE           json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)\n\n../../anaconda3/lib/python3.9/json/decoder.py:340: JSONDecodeError"}, "teardown": {"duration": 0.0007896260358393192, "outcome": "passed"}}, {"nodeid": "tests/api/test_search_and_registry.py::test_search_by_domain", "lineno": 14, "outcome": "skipped", "keywords": ["test_search_by_domain", "test_search_and_registry.py", "asyncio", "marge_only", "api", "tests", "marge", ""], "setup": {"duration": 0.000279995147138834, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/api/test_search_and_registry.py', 15, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00014757085591554642, "outcome": "passed"}}, {"nodeid": "tests/api/test_search_and_registry.py::test_search_by_state", "lineno": 24, "outcome": "skipped", "keywords": ["test_search_by_state", "test_search_and_registry.py", "asyncio", "marge_only", "api", "tests", "marge", ""], "setup": {"duration": 0.0002468489110469818, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/api/test_search_and_registry.py', 25, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00013109063729643822, "outcome": "passed"}}, {"nodeid": "tests/api/test_search_and_registry.py::test_search_by_text", "lineno": 34, "outcome": "skipped", "keywords": ["test_search_by_text", "test_search_and_registry.py", "asyncio", "marge_only", "api", "tests", "marge", ""], "setup": {"duration": 0.00020653381943702698, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/api/test_search_and_registry.py', 35, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00012920890003442764, "outcome": "passed"}}, {"nodeid": "tests/api/test_search_and_registry.py::test_search_combined_filters", "lineno": 44, "outcome": "skipped", "keywords": ["test_search_combined_filters", "test_search_and_registry.py", "asyncio", "marge_only", "api", "tests", "marge", ""], "setup": {"duration": 0.0001988448202610016, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/api/test_search_and_registry.py', 45, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00026460830122232437, "outcome": "passed"}}, {"nodeid": "tests/api/test_search_and_registry.py::test_search_returns_sorted", "lineno": 55, "outcome": "skipped", "keywords": ["test_search_returns_sorted", "test_search_and_registry.py", "asyncio", "marge_only", "api", "tests", "marge", ""], "setup": {"duration": 0.00019851792603731155, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/api/test_search_and_registry.py', 56, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00012892205268144608, "outcome": "passed"}}, {"nodeid": "tests/api/test_search_and_registry.py::test_area_crud_lifecycle", "lineno": 68, "outcome": "skipped", "keywords": ["test_area_crud_lifecycle", "test_search_and_registry.py", "asyncio", "marge_only", "api", "tests", "marge", ""], "setup": {"duration": 0.00019957078620791435, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/api/test_search_and_registry.py', 69, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00012803729623556137, "outcome": "passed"}}, {"nodeid": "tests/api/test_search_and_registry.py::test_device_crud_lifecycle", "lineno": 114, "outcome": "skipped", "keywords": ["test_device_crud_lifecycle", "test_search_and_registry.py", "asyncio", "marge_only", "api", "tests", "marge", ""], "setup": {"duration": 0.00019683782011270523, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/api/test_search_and_registry.py', 115, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00013047177344560623, "outcome": "passed"}}, {"nodeid": "tests/api/test_search_and_registry.py::test_label_crud_lifecycle", "lineno": 146, "outcome": "skipped", "keywords": ["test_label_crud_lifecycle", "test_search_and_registry.py", "asyncio", "marge_only", "api", "tests", "marge", ""], "setup": {"duration": 0.00021774601191282272, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/api/test_search_and_registry.py', 147, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00013441406190395355, "outcome": "passed"}}, {"nodeid": "tests/api/test_search_and_registry.py::test_backup_download", "lineno": 184, "outcome": "skipped", "keywords": ["test_backup_download", "test_search_and_registry.py", "asyncio", "marge_only", "api", "tests", "marge", ""], "setup": {"duration": 0.00020558293908834457, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/api/test_search_and_registry.py', 185, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.0001309518702328205, "outcome": "passed"}}, {"nodeid": "tests/api/test_search_and_registry.py::test_logbook_entity", "lineno": 195, "outcome": "skipped", "keywords": ["test_logbook_entity", "test_search_and_registry.py", "asyncio", "marge_only", "api", "tests", "marge", ""], "setup": {"duration": 0.00019544316455721855, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/api/test_search_and_registry.py', 196, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00013136398047208786, "outcome": "passed"}}, {"nodeid": "tests/api/test_search_and_registry.py::test_statistics_endpoint", "lineno": 208, "outcome": "skipped", "keywords": ["test_statistics_endpoint", "test_search_and_registry.py", "asyncio", "marge_only", "api", "tests", "marge", ""], "setup": {"duration": 0.00019925087690353394, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/api/test_search_and_registry.py', 209, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00012842798605561256, "outcome": "passed"}}, {"nodeid": "tests/api/test_search_and_registry.py::test_events_list", "lineno": 219, "outcome": "skipped", "keywords": ["test_events_list", "test_search_and_registry.py", "asyncio", "marge_only", "api", "tests", "marge", ""], "setup": {"duration": 0.00019981013610959053, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/api/test_search_and_registry.py', 220, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00012779980897903442, "outcome": "passed"}}, {"nodeid": "tests/api/test_search_and_registry.py::test_services_list_all_domains", "lineno": 231, "outcome": "skipped", "keywords": ["test_services_list_all_domains", "test_search_and_registry.py", "asyncio", "marge_only", "api", "tests", "marge", ""], "setup": {"duration": 0.00020004389807581902, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/api/test_search_and_registry.py', 232, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00013284292072057724, "outcome": "passed"}}, {"nodeid": "tests/api/test_search_and_registry.py::test_config_check_valid", "lineno": 244, "outcome": "skipped", "keywords": ["test_config_check_valid", "test_search_and_registry.py", "asyncio", "marge_only", "api", "tests", "marge", ""], "setup": {"duration": 0.0002042609266936779, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/api/test_search_and_registry.py', 245, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.0001307227648794651, "outcome": "passed"}}, {"nodeid": "tests/api/test_search_and_registry.py::test_webhook_set_state", "lineno": 254, "outcome": "skipped", "keywords": ["test_webhook_set_state", "test_search_and_registry.py", "asyncio", "marge_only", "api", "tests", "marge", ""], "setup": {"duration": 0.00019681593403220177, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/api/test_search_and_registry.py', 255, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00013219425454735756, "outcome": "passed"}}, {"nodeid": "tests/api/test_search_and_registry.py::test_webhook_fire_event", "lineno": 265, "outcome": "skipped", "keywords": ["test_webhook_fire_event", "test_search_and_registry.py", "asyncio", "marge_only", "api", "tests", "marge", ""], "setup": {"duration": 0.00019779615104198456, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/api/test_search_and_registry.py', 266, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00012893695384263992, "outcome": "passed"}}, {"nodeid": "tests/api/test_search_and_registry.py::test_webhook_default_event", "lineno": 275, "outcome": "skipped", "keywords": ["test_webhook_default_event", "test_search_and_registry.py", "asyncio", "marge_only", "api", "tests", "marge", ""], "setup": {"duration": 0.00020493101328611374, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/api/test_search_and_registry.py', 276, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00013321125879883766, "outcome": "passed"}}, {"nodeid": "tests/api/test_search_and_registry.py::test_prometheus_metrics", "lineno": 287, "outcome": "skipped", "keywords": ["test_prometheus_metrics", "test_search_and_registry.py", "asyncio", "marge_only", "api", "tests", "marge", ""], "setup": {"duration": 0.00020731892436742783, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/api/test_search_and_registry.py', 288, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00014697108417749405, "outcome": "passed"}}, {"nodeid": "tests/api/test_search_and_registry.py::test_automation_yaml_roundtrip", "lineno": 299, "outcome": "skipped", "keywords": ["test_automation_yaml_roundtrip", "test_search_and_registry.py", "asyncio", "marge_only", "api", "tests", "marge", ""], "setup": {"duration": 0.00023452797904610634, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/api/test_search_and_registry.py', 300, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00014027999714016914, "outcome": "passed"}}, {"nodeid": "tests/api/test_search_and_registry.py::test_scene_yaml_roundtrip", "lineno": 319, "outcome": "skipped", "keywords": ["test_scene_yaml_roundtrip", "test_search_and_registry.py", "asyncio", "marge_only", "api", "tests", "marge", ""], "setup": {"duration": 0.00021631363779306412, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/api/test_search_and_registry.py', 320, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.0001402529887855053, "outcome": "passed"}}, {"nodeid": "tests/api/test_search_and_registry.py::test_token_create_and_revoke", "lineno": 338, "outcome": "skipped", "keywords": ["test_token_create_and_revoke", "test_search_and_registry.py", "asyncio", "marge_only", "api", "tests", "marge", ""], "setup": {"duration": 0.00022897403687238693, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/api/test_search_and_registry.py', 339, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00014243368059396744, "outcome": "passed"}}, {"nodeid": "tests/api/test_search_combined_filters.py::test_search_domain_only", "lineno": 23, "outcome": "skipped", "keywords": ["test_search_domain_only", "test_search_combined_filters.py", "asyncio", "marge_only", "api", "tests", "marge", ""], "setup": {"duration": 0.000222689937800169, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/api/test_search_combined_filters.py', 24, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.0001339893788099289, "outcome": "passed"}}, {"nodeid": "tests/api/test_search_combined_filters.py::test_search_state_only", "lineno": 38, "outcome": "skipped", "keywords": ["test_search_state_only", "test_search_combined_filters.py", "asyncio", "marge_only", "api", "tests", "marge", ""], "setup": {"duration": 0.00021099811419844627, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/api/test_search_combined_filters.py', 39, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.0001350068487226963, "outcome": "passed"}}, {"nodeid": "tests/api/test_search_combined_filters.py::test_search_domain_and_state", "lineno": 52, "outcome": "skipped", "keywords": ["test_search_domain_and_state", "test_search_combined_filters.py", "asyncio", "marge_only", "api", "tests", "marge", ""], "setup": {"duration": 0.00020445138216018677, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/api/test_search_combined_filters.py', 53, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00013282615691423416, "outcome": "passed"}}, {"nodeid": "tests/api/test_search_combined_filters.py::test_search_domain_and_q", "lineno": 68, "outcome": "skipped", "keywords": ["test_search_domain_and_q", "test_search_combined_filters.py", "asyncio", "marge_only", "api", "tests", "marge", ""], "setup": {"duration": 0.00019856635481119156, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/api/test_search_combined_filters.py', 69, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00013033300638198853, "outcome": "passed"}}, {"nodeid": "tests/api/test_search_combined_filters.py::test_search_q_matches_friendly_name", "lineno": 84, "outcome": "skipped", "keywords": ["test_search_q_matches_friendly_name", "test_search_combined_filters.py", "asyncio", "marge_only", "api", "tests", "marge", ""], "setup": {"duration": 0.00019737333059310913, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/api/test_search_combined_filters.py', 85, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00013031018897891045, "outcome": "passed"}}, {"nodeid": "tests/api/test_search_combined_filters.py::test_search_q_case_insensitive", "lineno": 98, "outcome": "skipped", "keywords": ["test_search_q_case_insensitive", "test_search_combined_filters.py", "asyncio", "marge_only", "api", "tests", "marge", ""], "setup": {"duration": 0.00019895890727639198, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/api/test_search_combined_filters.py', 99, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00013267481699585915, "outcome": "passed"}}, {"nodeid": "tests/api/test_search_combined_filters.py::test_search_no_filters_returns_all", "lineno": 112, "outcome": "skipped", "keywords": ["test_search_no_filters_returns_all", "test_search_combined_filters.py", "asyncio", "marge_only", "api", "tests", "marge", ""], "setup": {"duration": 0.0001995367929339409, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/api/test_search_combined_filters.py', 113, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.0001367810182273388, "outcome": "passed"}}, {"nodeid": "tests/api/test_search_combined_filters.py::test_search_no_match_returns_empty", "lineno": 122, "outcome": "skipped", "keywords": ["test_search_no_match_returns_empty", "test_search_combined_filters.py", "asyncio", "marge_only", "api", "tests", "marge", ""], "setup": {"duration": 0.00020268606022000313, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/api/test_search_combined_filters.py', 123, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00013502966612577438, "outcome": "passed"}}, {"nodeid": "tests/api/test_search_combined_filters.py::test_search_results_sorted_by_entity_id", "lineno": 133, "outcome": "skipped", "keywords": ["test_search_results_sorted_by_entity_id", "test_search_combined_filters.py", "asyncio", "marge_only", "api", "tests", "marge", ""], "setup": {"duration": 0.00020759506151080132, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/api/test_search_combined_filters.py', 134, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00013186782598495483, "outcome": "passed"}}, {"nodeid": "tests/api/test_search_combined_filters.py::test_search_state_and_q", "lineno": 145, "outcome": "skipped", "keywords": ["test_search_state_and_q", "test_search_combined_filters.py", "asyncio", "marge_only", "api", "tests", "marge", ""], "setup": {"duration": 0.00020472612231969833, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/api/test_search_combined_filters.py', 146, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.0001315115951001644, "outcome": "passed"}}, {"nodeid": "tests/api/test_search_combined_filters.py::test_search_all_three_filters", "lineno": 161, "outcome": "skipped", "keywords": ["test_search_all_three_filters", "test_search_combined_filters.py", "asyncio", "marge_only", "api", "tests", "marge", ""], "setup": {"duration": 0.0002065049484372139, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/api/test_search_combined_filters.py', 162, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00013175280764698982, "outcome": "passed"}}, {"nodeid": "tests/api/test_search_combined_filters.py::test_search_by_area", "lineno": 179, "outcome": "skipped", "keywords": ["test_search_by_area", "test_search_combined_filters.py", "asyncio", "marge_only", "api", "tests", "marge", ""], "setup": {"duration": 0.00020517408847808838, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/api/test_search_combined_filters.py', 180, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00013505294919013977, "outcome": "passed"}}, {"nodeid": "tests/api/test_search_edge_cases.py::test_search_by_domain", "lineno": 16, "outcome": "skipped", "keywords": ["test_search_by_domain", "test_search_edge_cases.py", "asyncio", "marge_only", "api", "tests", "marge", ""], "setup": {"duration": 0.0002141641452908516, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/api/test_search_edge_cases.py', 17, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.0001341099850833416, "outcome": "passed"}}, {"nodeid": "tests/api/test_search_edge_cases.py::test_search_by_state_value", "lineno": 30, "outcome": "skipped", "keywords": ["test_search_by_state_value", "test_search_edge_cases.py", "asyncio", "marge_only", "api", "tests", "marge", ""], "setup": {"duration": 0.00020114006474614143, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/api/test_search_edge_cases.py', 31, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00013270461931824684, "outcome": "passed"}}, {"nodeid": "tests/api/test_search_edge_cases.py::test_search_by_text_query", "lineno": 44, "outcome": "skipped", "keywords": ["test_search_by_text_query", "test_search_edge_cases.py", "asyncio", "marge_only", "api", "tests", "marge", ""], "setup": {"duration": 0.0002065710723400116, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/api/test_search_edge_cases.py', 45, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00013549299910664558, "outcome": "passed"}}, {"nodeid": "tests/api/test_search_edge_cases.py::test_search_case_insensitive", "lineno": 58, "outcome": "skipped", "keywords": ["test_search_case_insensitive", "test_search_edge_cases.py", "asyncio", "marge_only", "api", "tests", "marge", ""], "setup": {"duration": 0.0002380390651524067, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/api/test_search_edge_cases.py', 59, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00016677891835570335, "outcome": "passed"}}, {"nodeid": "tests/api/test_search_edge_cases.py::test_search_domain_and_state_combined", "lineno": 70, "outcome": "skipped", "keywords": ["test_search_domain_and_state_combined", "test_search_edge_cases.py", "asyncio", "marge_only", "api", "tests", "marge", ""], "setup": {"duration": 0.0003000148572027683, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/api/test_search_edge_cases.py', 71, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00015502236783504486, "outcome": "passed"}}, {"nodeid": "tests/api/test_search_edge_cases.py::test_search_no_match", "lineno": 86, "outcome": "skipped", "keywords": ["test_search_no_match", "test_search_edge_cases.py", "asyncio", "marge_only", "api", "tests", "marge", ""], "setup": {"duration": 0.0002551628276705742, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/api/test_search_edge_cases.py', 87, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00015540560707449913, "outcome": "passed"}}, {"nodeid": "tests/api/test_search_edge_cases.py::test_search_by_friendly_name", "lineno": 96, "outcome": "skipped", "keywords": ["test_search_by_friendly_name", "test_search_edge_cases.py", "asyncio", "marge_only", "api", "tests", "marge", ""], "setup": {"duration": 0.00024355808272957802, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/api/test_search_edge_cases.py', 97, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00013312511146068573, "outcome": "passed"}}, {"nodeid": "tests/api/test_search_edge_cases.py::test_search_sorted_by_entity_id", "lineno": 108, "outcome": "skipped", "keywords": ["test_search_sorted_by_entity_id", "test_search_edge_cases.py", "asyncio", "marge_only", "api", "tests", "marge", ""], "setup": {"duration": 0.0002023898996412754, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/api/test_search_edge_cases.py', 109, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00013020401820540428, "outcome": "passed"}}, {"nodeid": "tests/api/test_search_edge_cases.py::test_webhook_set_state", "lineno": 124, "outcome": "skipped", "keywords": ["test_webhook_set_state", "test_search_edge_cases.py", "asyncio", "marge_only", "api", "tests", "marge", ""], "setup": {"duration": 0.0002001388929784298, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/api/test_search_edge_cases.py', 125, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.0001327507197856903, "outcome": "passed"}}, {"nodeid": "tests/api/test_search_edge_cases.py::test_webhook_set_state_with_attributes", "lineno": 138, "outcome": "skipped", "keywords": ["test_webhook_set_state_with_attributes", "test_search_edge_cases.py", "asyncio", "marge_only", "api", "tests", "marge", ""], "setup": {"duration": 0.00020080897957086563, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/api/test_search_edge_cases.py', 139, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00013012206181883812, "outcome": "passed"}}, {"nodeid": "tests/api/test_search_edge_cases.py::test_webhook_fire_event", "lineno": 154, "outcome": "skipped", "keywords": ["test_webhook_fire_event", "test_search_edge_cases.py", "asyncio", "marge_only", "api", "tests", "marge", ""], "setup": {"duration": 0.00020197825506329536, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/api/test_search_edge_cases.py', 155, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.0001319432631134987, "outcome": "passed"}}, {"nodeid": "tests/api/test_search_edge_cases.py::test_webhook_default_event", "lineno": 165, "outcome": "skipped", "keywords": ["test_webhook_default_event", "test_search_edge_cases.py", "asyncio", "marge_only", "api", "tests", "marge", ""], "setup": {"duration": 0.00019932817667722702, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/api/test_search_edge_cases.py', 166, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00012947805225849152, "outcome": "passed"}}, {"nodeid": "tests/api/test_search_edge_cases.py::test_webhook_no_body", "lineno": 175, "outcome": "skipped", "keywords": ["test_webhook_no_body", "test_search_edge_cases.py", "asyncio", "marge_only", "api", "tests", "marge", ""], "setup": {"duration": 0.0001993929035961628, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/api/test_search_edge_cases.py', 176, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.0001295921392738819, "outcome": "passed"}}, {"nodeid": "tests/api/test_search_edge_cases.py::test_fire_event_returns_message", "lineno": 185, "outcome": "skipped", "keywords": ["test_fire_event_returns_message", "test_search_edge_cases.py", "asyncio", "marge_only", "api", "tests", "marge", ""], "setup": {"duration": 0.00019919034093618393, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/api/test_search_edge_cases.py', 186, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00013310881331562996, "outcome": "passed"}}, {"nodeid": "tests/api/test_search_edge_cases.py::test_fire_event_triggers_automation", "lineno": 197, "outcome": "skipped", "keywords": ["test_fire_event_triggers_automation", "test_search_edge_cases.py", "asyncio", "marge_only", "api", "tests", "marge", ""], "setup": {"duration": 0.00019960617646574974, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/api/test_search_edge_cases.py', 198, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00013086898252367973, "outcome": "passed"}}, {"nodeid": "tests/api/test_search_edge_cases.py::test_sim_time_set_and_read", "lineno": 212, "outcome": "skipped", "keywords": ["test_sim_time_set_and_read", "test_search_edge_cases.py", "asyncio", "marge_only", "api", "tests", "marge", ""], "setup": {"duration": 0.0002045067958533764, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/api/test_search_edge_cases.py', 213, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00013250019401311874, "outcome": "passed"}}, {"nodeid": "tests/api/test_search_edge_cases.py::test_sim_time_partial_update", "lineno": 228, "outcome": "skipped", "keywords": ["test_sim_time_partial_update", "test_search_edge_cases.py", "asyncio", "marge_only", "api", "tests", "marge", ""], "setup": {"duration": 0.00019971514120697975, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/api/test_search_edge_cases.py', 229, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00012997863814234734, "outcome": "passed"}}, {"nodeid": "tests/api/test_search_edge_cases.py::test_backup_returns_tar_gz", "lineno": 249, "outcome": "skipped", "keywords": ["test_backup_returns_tar_gz", "test_search_edge_cases.py", "asyncio", "marge_only", "api", "tests", "marge", ""], "setup": {"duration": 0.00020046206191182137, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/api/test_search_edge_cases.py', 250, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00012969831004738808, "outcome": "passed"}}, {"nodeid": "tests/api/test_search_edge_cases.py::test_prometheus_metrics_format", "lineno": 265, "outcome": "skipped", "keywords": ["test_prometheus_metrics_format", "test_search_edge_cases.py", "asyncio", "marge_only", "api", "tests", "marge", ""], "setup": {"duration": 0.00020157406106591225, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/api/test_search_edge_cases.py', 266, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.0001324620097875595, "outcome": "passed"}}, {"nodeid": "tests/api/test_search_edge_cases.py::test_prometheus_has_core_metrics", "lineno": 275, "outcome": "skipped", "keywords": ["test_prometheus_has_core_metrics", "test_search_edge_cases.py", "asyncio", "marge_only", "api", "tests", "marge", ""], "setup": {"duration": 0.00022712117061018944, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/api/test_search_edge_cases.py', 276, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00013488996773958206, "outcome": "passed"}}, {"nodeid": "tests/api/test_search_edge_cases.py::test_prometheus_has_automation_metrics", "lineno": 294, "outcome": "skipped", "keywords": ["test_prometheus_has_automation_metrics", "test_search_edge_cases.py", "asyncio", "marge_only", "api", "tests", "marge", ""], "setup": {"duration": 0.00020979810506105423, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/api/test_search_edge_cases.py', 295, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.0001316675916314125, "outcome": "passed"}}, {"nodeid": "tests/api/test_search_edge_cases.py::test_prometheus_content_type", "lineno": 301, "outcome": "skipped", "keywords": ["test_prometheus_content_type", "test_search_edge_cases.py", "asyncio", "marge_only", "api", "tests", "marge", ""], "setup": {"duration": 0.00020205602049827576, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/api/test_search_edge_cases.py', 302, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00013131462037563324, "outcome": "passed"}}, {"nodeid": "tests/api/test_service_listing_format.py::test_services_returns_list", "lineno": 52, "outcome": "passed", "keywords": ["test_services_returns_list", "test_service_listing_format.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.00567532517015934, "outcome": "passed"}, "call": {"duration": 0.0033314889296889305, "outcome": "passed"}, "teardown": {"duration": 0.0005278619937598705, "outcome": "passed"}}, {"nodeid": "tests/api/test_service_listing_format.py::test_services_entry_format", "lineno": 63, "outcome": "passed", "keywords": ["test_services_entry_format", "test_service_listing_format.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005504691042006016, "outcome": "passed"}, "call": {"duration": 0.003459358122199774, "outcome": "passed"}, "teardown": {"duration": 0.0005701929330825806, "outcome": "passed"}}, {"nodeid": "tests/api/test_service_listing_format.py::test_services_light_has_expected_services", "lineno": 76, "outcome": "failed", "keywords": ["test_services_light_has_expected_services", "test_service_listing_format.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005426951218396425, "outcome": "passed"}, "call": {"duration": 0.003281682264059782, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/asyncio/base_events.py", "lineno": 647, "message": "RuntimeError: coroutine raised StopIteration"}, "traceback": [{"path": "../../anaconda3/lib/python3.9/site-packages/pytest_asyncio/plugin.py", "lineno": 440, "message": ""}, {"path": "../../anaconda3/lib/python3.9/site-packages/pytest_asyncio/plugin.py", "lineno": 906, "message": "in inner"}, {"path": "../../anaconda3/lib/python3.9/asyncio/base_events.py", "lineno": 647, "message": "RuntimeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b05b1a60>\n\n    async def test_services_light_has_expected_services(rest):\n        \"\"\"Light domain has turn_on, turn_off, toggle.\"\"\"\n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/services\",\n            headers=rest._headers(),\n        )\n        data = resp.json()\n>       light = next(e for e in data if e[\"domain\"] == \"light\")\nE       StopIteration\n\ntests/api/test_service_listing_format.py:84: StopIteration\n\nThe above exception was the direct cause of the following exception:\n\nself = <Coroutine test_services_light_has_expected_services>\n\n    def runtest(self) -> None:\n        self.obj = wrap_in_sync(\n            # https://github.com/pytest-dev/pytest-asyncio/issues/596\n            self.obj,  # type: ignore[has-type]\n        )\n>       super().runtest()\n\n../../anaconda3/lib/python3.9/site-packages/pytest_asyncio/plugin.py:440: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/pytest_asyncio/plugin.py:906: in inner\n    _loop.run_until_complete(task)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <_UnixSelectorEventLoop running=False closed=False debug=False>\nfuture = <Task finished name='Task-2149' coro=<test_services_light_has_expected_services() done, defined at /home/jcrigby/fun/marge/tests/api/test_service_listing_format.py:77> exception=RuntimeError('coroutine raised StopIteration')>\n\n    def run_until_complete(self, future):\n        \"\"\"Run until the Future is done.\n    \n        If the argument is a coroutine, it is wrapped in a Task.\n    \n        WARNING: It would be disastrous to call run_until_complete()\n        with the same coroutine twice -- it would wrap it in two\n        different Tasks and that can't be good.\n    \n        Return the Future's result, or raise its exception.\n        \"\"\"\n        self._check_closed()\n        self._check_running()\n    \n        new_task = not futures.isfuture(future)\n        future = tasks.ensure_future(future, loop=self)\n        if new_task:\n            # An exception is raised if the future didn't complete, so there\n            # is no need to log the \"destroy pending task\" message\n            future._log_destroy_pending = False\n    \n        future.add_done_callback(_run_until_complete_cb)\n        try:\n            self.run_forever()\n        except:\n            if new_task and future.done() and not future.cancelled():\n                # The coroutine raised a BaseException. Consume the exception\n                # to not log a warning, the caller doesn't have access to the\n                # local task.\n                future.exception()\n            raise\n        finally:\n            future.remove_done_callback(_run_until_complete_cb)\n        if not future.done():\n            raise RuntimeError('Event loop stopped before Future completed.')\n    \n>       return future.result()\nE       RuntimeError: coroutine raised StopIteration\n\n../../anaconda3/lib/python3.9/asyncio/base_events.py:647: RuntimeError"}, "teardown": {"duration": 0.0007056728936731815, "outcome": "passed"}}, {"nodeid": "tests/api/test_service_listing_format.py::test_services_climate_has_expected_services", "lineno": 90, "outcome": "failed", "keywords": ["test_services_climate_has_expected_services", "test_service_listing_format.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005446619354188442, "outcome": "passed"}, "call": {"duration": 0.003172548022121191, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/asyncio/base_events.py", "lineno": 647, "message": "RuntimeError: coroutine raised StopIteration"}, "traceback": [{"path": "../../anaconda3/lib/python3.9/site-packages/pytest_asyncio/plugin.py", "lineno": 440, "message": ""}, {"path": "../../anaconda3/lib/python3.9/site-packages/pytest_asyncio/plugin.py", "lineno": 906, "message": "in inner"}, {"path": "../../anaconda3/lib/python3.9/asyncio/base_events.py", "lineno": 647, "message": "RuntimeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b05497f0>\n\n    async def test_services_climate_has_expected_services(rest):\n        \"\"\"Climate domain has set_temperature, set_hvac_mode, turn_on, turn_off.\"\"\"\n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/services\",\n            headers=rest._headers(),\n        )\n        data = resp.json()\n>       climate = next(e for e in data if e[\"domain\"] == \"climate\")\nE       StopIteration\n\ntests/api/test_service_listing_format.py:98: StopIteration\n\nThe above exception was the direct cause of the following exception:\n\nself = <Coroutine test_services_climate_has_expected_services>\n\n    def runtest(self) -> None:\n        self.obj = wrap_in_sync(\n            # https://github.com/pytest-dev/pytest-asyncio/issues/596\n            self.obj,  # type: ignore[has-type]\n        )\n>       super().runtest()\n\n../../anaconda3/lib/python3.9/site-packages/pytest_asyncio/plugin.py:440: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/pytest_asyncio/plugin.py:906: in inner\n    _loop.run_until_complete(task)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <_UnixSelectorEventLoop running=False closed=False debug=False>\nfuture = <Task finished name='Task-2153' coro=<test_services_climate_has_expected_services() done, defined at /home/jcrigby/fun/marge/tests/api/test_service_listing_format.py:91> exception=RuntimeError('coroutine raised StopIteration')>\n\n    def run_until_complete(self, future):\n        \"\"\"Run until the Future is done.\n    \n        If the argument is a coroutine, it is wrapped in a Task.\n    \n        WARNING: It would be disastrous to call run_until_complete()\n        with the same coroutine twice -- it would wrap it in two\n        different Tasks and that can't be good.\n    \n        Return the Future's result, or raise its exception.\n        \"\"\"\n        self._check_closed()\n        self._check_running()\n    \n        new_task = not futures.isfuture(future)\n        future = tasks.ensure_future(future, loop=self)\n        if new_task:\n            # An exception is raised if the future didn't complete, so there\n            # is no need to log the \"destroy pending task\" message\n            future._log_destroy_pending = False\n    \n        future.add_done_callback(_run_until_complete_cb)\n        try:\n            self.run_forever()\n        except:\n            if new_task and future.done() and not future.cancelled():\n                # The coroutine raised a BaseException. Consume the exception\n                # to not log a warning, the caller doesn't have access to the\n                # local task.\n                future.exception()\n            raise\n        finally:\n            future.remove_done_callback(_run_until_complete_cb)\n        if not future.done():\n            raise RuntimeError('Event loop stopped before Future completed.')\n    \n>       return future.result()\nE       RuntimeError: coroutine raised StopIteration\n\n../../anaconda3/lib/python3.9/asyncio/base_events.py:647: RuntimeError"}, "teardown": {"duration": 0.0006920136511325836, "outcome": "passed"}}, {"nodeid": "tests/api/test_service_listing_format.py::test_services_cover_has_expected_services", "lineno": 105, "outcome": "failed", "keywords": ["test_services_cover_has_expected_services", "test_service_listing_format.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005684906151145697, "outcome": "passed"}, "call": {"duration": 0.003839460201561451, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/asyncio/base_events.py", "lineno": 647, "message": "RuntimeError: coroutine raised StopIteration"}, "traceback": [{"path": "../../anaconda3/lib/python3.9/site-packages/pytest_asyncio/plugin.py", "lineno": 440, "message": ""}, {"path": "../../anaconda3/lib/python3.9/site-packages/pytest_asyncio/plugin.py", "lineno": 906, "message": "in inner"}, {"path": "../../anaconda3/lib/python3.9/asyncio/base_events.py", "lineno": 647, "message": "RuntimeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b06a23d0>\n\n    async def test_services_cover_has_expected_services(rest):\n        \"\"\"Cover domain has open_cover, close_cover, stop_cover, set_cover_position.\"\"\"\n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/services\",\n            headers=rest._headers(),\n        )\n        data = resp.json()\n>       cover = next(e for e in data if e[\"domain\"] == \"cover\")\nE       StopIteration\n\ntests/api/test_service_listing_format.py:113: StopIteration\n\nThe above exception was the direct cause of the following exception:\n\nself = <Coroutine test_services_cover_has_expected_services>\n\n    def runtest(self) -> None:\n        self.obj = wrap_in_sync(\n            # https://github.com/pytest-dev/pytest-asyncio/issues/596\n            self.obj,  # type: ignore[has-type]\n        )\n>       super().runtest()\n\n../../anaconda3/lib/python3.9/site-packages/pytest_asyncio/plugin.py:440: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/pytest_asyncio/plugin.py:906: in inner\n    _loop.run_until_complete(task)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <_UnixSelectorEventLoop running=False closed=False debug=False>\nfuture = <Task finished name='Task-2157' coro=<test_services_cover_has_expected_services() done, defined at /home/jcrigby/fun/marge/tests/api/test_service_listing_format.py:106> exception=RuntimeError('coroutine raised StopIteration')>\n\n    def run_until_complete(self, future):\n        \"\"\"Run until the Future is done.\n    \n        If the argument is a coroutine, it is wrapped in a Task.\n    \n        WARNING: It would be disastrous to call run_until_complete()\n        with the same coroutine twice -- it would wrap it in two\n        different Tasks and that can't be good.\n    \n        Return the Future's result, or raise its exception.\n        \"\"\"\n        self._check_closed()\n        self._check_running()\n    \n        new_task = not futures.isfuture(future)\n        future = tasks.ensure_future(future, loop=self)\n        if new_task:\n            # An exception is raised if the future didn't complete, so there\n            # is no need to log the \"destroy pending task\" message\n            future._log_destroy_pending = False\n    \n        future.add_done_callback(_run_until_complete_cb)\n        try:\n            self.run_forever()\n        except:\n            if new_task and future.done() and not future.cancelled():\n                # The coroutine raised a BaseException. Consume the exception\n                # to not log a warning, the caller doesn't have access to the\n                # local task.\n                future.exception()\n            raise\n        finally:\n            future.remove_done_callback(_run_until_complete_cb)\n        if not future.done():\n            raise RuntimeError('Event loop stopped before Future completed.')\n    \n>       return future.result()\nE       RuntimeError: coroutine raised StopIteration\n\n../../anaconda3/lib/python3.9/asyncio/base_events.py:647: RuntimeError"}, "teardown": {"duration": 0.0006647049449384212, "outcome": "passed"}}, {"nodeid": "tests/api/test_service_listing_format.py::test_services_counter_has_expected_services", "lineno": 120, "outcome": "passed", "keywords": ["test_services_counter_has_expected_services", "test_service_listing_format.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005407601594924927, "outcome": "passed"}, "call": {"duration": 0.003316920716315508, "outcome": "passed"}, "teardown": {"duration": 0.0005021393299102783, "outcome": "passed"}}, {"nodeid": "tests/api/test_service_listing_format.py::test_services_fan_has_expected_services", "lineno": 134, "outcome": "failed", "keywords": ["test_services_fan_has_expected_services", "test_service_listing_format.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005308378022164106, "outcome": "passed"}, "call": {"duration": 0.0033804820850491524, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/asyncio/base_events.py", "lineno": 647, "message": "RuntimeError: coroutine raised StopIteration"}, "traceback": [{"path": "../../anaconda3/lib/python3.9/site-packages/pytest_asyncio/plugin.py", "lineno": 440, "message": ""}, {"path": "../../anaconda3/lib/python3.9/site-packages/pytest_asyncio/plugin.py", "lineno": 906, "message": "in inner"}, {"path": "../../anaconda3/lib/python3.9/asyncio/base_events.py", "lineno": 647, "message": "RuntimeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0a8ff70>\n\n    async def test_services_fan_has_expected_services(rest):\n        \"\"\"Fan domain has turn_on, turn_off, set_percentage, set_direction.\"\"\"\n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/services\",\n            headers=rest._headers(),\n        )\n        data = resp.json()\n>       fan = next(e for e in data if e[\"domain\"] == \"fan\")\nE       StopIteration\n\ntests/api/test_service_listing_format.py:142: StopIteration\n\nThe above exception was the direct cause of the following exception:\n\nself = <Coroutine test_services_fan_has_expected_services>\n\n    def runtest(self) -> None:\n        self.obj = wrap_in_sync(\n            # https://github.com/pytest-dev/pytest-asyncio/issues/596\n            self.obj,  # type: ignore[has-type]\n        )\n>       super().runtest()\n\n../../anaconda3/lib/python3.9/site-packages/pytest_asyncio/plugin.py:440: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/pytest_asyncio/plugin.py:906: in inner\n    _loop.run_until_complete(task)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <_UnixSelectorEventLoop running=False closed=False debug=False>\nfuture = <Task finished name='Task-2165' coro=<test_services_fan_has_expected_services() done, defined at /home/jcrigby/fun/marge/tests/api/test_service_listing_format.py:135> exception=RuntimeError('coroutine raised StopIteration')>\n\n    def run_until_complete(self, future):\n        \"\"\"Run until the Future is done.\n    \n        If the argument is a coroutine, it is wrapped in a Task.\n    \n        WARNING: It would be disastrous to call run_until_complete()\n        with the same coroutine twice -- it would wrap it in two\n        different Tasks and that can't be good.\n    \n        Return the Future's result, or raise its exception.\n        \"\"\"\n        self._check_closed()\n        self._check_running()\n    \n        new_task = not futures.isfuture(future)\n        future = tasks.ensure_future(future, loop=self)\n        if new_task:\n            # An exception is raised if the future didn't complete, so there\n            # is no need to log the \"destroy pending task\" message\n            future._log_destroy_pending = False\n    \n        future.add_done_callback(_run_until_complete_cb)\n        try:\n            self.run_forever()\n        except:\n            if new_task and future.done() and not future.cancelled():\n                # The coroutine raised a BaseException. Consume the exception\n                # to not log a warning, the caller doesn't have access to the\n                # local task.\n                future.exception()\n            raise\n        finally:\n            future.remove_done_callback(_run_until_complete_cb)\n        if not future.done():\n            raise RuntimeError('Event loop stopped before Future completed.')\n    \n>       return future.result()\nE       RuntimeError: coroutine raised StopIteration\n\n../../anaconda3/lib/python3.9/asyncio/base_events.py:647: RuntimeError"}, "teardown": {"duration": 0.0007341969758272171, "outcome": "passed"}}, {"nodeid": "tests/api/test_service_listing_format.py::test_services_vacuum_has_expected_services", "lineno": 148, "outcome": "failed", "keywords": ["test_services_vacuum_has_expected_services", "test_service_listing_format.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005351817235350609, "outcome": "passed"}, "call": {"duration": 0.0034840330481529236, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/asyncio/base_events.py", "lineno": 647, "message": "RuntimeError: coroutine raised StopIteration"}, "traceback": [{"path": "../../anaconda3/lib/python3.9/site-packages/pytest_asyncio/plugin.py", "lineno": 440, "message": ""}, {"path": "../../anaconda3/lib/python3.9/site-packages/pytest_asyncio/plugin.py", "lineno": 906, "message": "in inner"}, {"path": "../../anaconda3/lib/python3.9/asyncio/base_events.py", "lineno": 647, "message": "RuntimeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b08d9ca0>\n\n    async def test_services_vacuum_has_expected_services(rest):\n        \"\"\"Vacuum domain has start, stop, return_to_base, locate.\"\"\"\n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/services\",\n            headers=rest._headers(),\n        )\n        data = resp.json()\n>       vacuum = next(e for e in data if e[\"domain\"] == \"vacuum\")\nE       StopIteration\n\ntests/api/test_service_listing_format.py:156: StopIteration\n\nThe above exception was the direct cause of the following exception:\n\nself = <Coroutine test_services_vacuum_has_expected_services>\n\n    def runtest(self) -> None:\n        self.obj = wrap_in_sync(\n            # https://github.com/pytest-dev/pytest-asyncio/issues/596\n            self.obj,  # type: ignore[has-type]\n        )\n>       super().runtest()\n\n../../anaconda3/lib/python3.9/site-packages/pytest_asyncio/plugin.py:440: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/pytest_asyncio/plugin.py:906: in inner\n    _loop.run_until_complete(task)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <_UnixSelectorEventLoop running=False closed=False debug=False>\nfuture = <Task finished name='Task-2169' coro=<test_services_vacuum_has_expected_services() done, defined at /home/jcrigby/fun/marge/tests/api/test_service_listing_format.py:149> exception=RuntimeError('coroutine raised StopIteration')>\n\n    def run_until_complete(self, future):\n        \"\"\"Run until the Future is done.\n    \n        If the argument is a coroutine, it is wrapped in a Task.\n    \n        WARNING: It would be disastrous to call run_until_complete()\n        with the same coroutine twice -- it would wrap it in two\n        different Tasks and that can't be good.\n    \n        Return the Future's result, or raise its exception.\n        \"\"\"\n        self._check_closed()\n        self._check_running()\n    \n        new_task = not futures.isfuture(future)\n        future = tasks.ensure_future(future, loop=self)\n        if new_task:\n            # An exception is raised if the future didn't complete, so there\n            # is no need to log the \"destroy pending task\" message\n            future._log_destroy_pending = False\n    \n        future.add_done_callback(_run_until_complete_cb)\n        try:\n            self.run_forever()\n        except:\n            if new_task and future.done() and not future.cancelled():\n                # The coroutine raised a BaseException. Consume the exception\n                # to not log a warning, the caller doesn't have access to the\n                # local task.\n                future.exception()\n            raise\n        finally:\n            future.remove_done_callback(_run_until_complete_cb)\n        if not future.done():\n            raise RuntimeError('Event loop stopped before Future completed.')\n    \n>       return future.result()\nE       RuntimeError: coroutine raised StopIteration\n\n../../anaconda3/lib/python3.9/asyncio/base_events.py:647: RuntimeError"}, "teardown": {"duration": 0.0007475819438695908, "outcome": "passed"}}, {"nodeid": "tests/api/test_service_listing_format.py::test_services_timer_has_expected_services", "lineno": 162, "outcome": "passed", "keywords": ["test_services_timer_has_expected_services", "test_service_listing_format.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005238482728600502, "outcome": "passed"}, "call": {"duration": 0.0033132340759038925, "outcome": "passed"}, "teardown": {"duration": 0.0005251462571322918, "outcome": "passed"}}, {"nodeid": "tests/api/test_service_listing_format.py::test_services_humidifier_has_expected_services", "lineno": 177, "outcome": "failed", "keywords": ["test_services_humidifier_has_expected_services", "test_service_listing_format.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005291433073580265, "outcome": "passed"}, "call": {"duration": 0.0033004540018737316, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/asyncio/base_events.py", "lineno": 647, "message": "RuntimeError: coroutine raised StopIteration"}, "traceback": [{"path": "../../anaconda3/lib/python3.9/site-packages/pytest_asyncio/plugin.py", "lineno": 440, "message": ""}, {"path": "../../anaconda3/lib/python3.9/site-packages/pytest_asyncio/plugin.py", "lineno": 906, "message": "in inner"}, {"path": "../../anaconda3/lib/python3.9/asyncio/base_events.py", "lineno": 647, "message": "RuntimeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b088b970>\n\n    async def test_services_humidifier_has_expected_services(rest):\n        \"\"\"Humidifier domain has turn_on, turn_off, toggle, set_humidity, set_mode.\"\"\"\n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/services\",\n            headers=rest._headers(),\n        )\n        data = resp.json()\n>       humidifier = next(e for e in data if e[\"domain\"] == \"humidifier\")\nE       StopIteration\n\ntests/api/test_service_listing_format.py:185: StopIteration\n\nThe above exception was the direct cause of the following exception:\n\nself = <Coroutine test_services_humidifier_has_expected_services>\n\n    def runtest(self) -> None:\n        self.obj = wrap_in_sync(\n            # https://github.com/pytest-dev/pytest-asyncio/issues/596\n            self.obj,  # type: ignore[has-type]\n        )\n>       super().runtest()\n\n../../anaconda3/lib/python3.9/site-packages/pytest_asyncio/plugin.py:440: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/pytest_asyncio/plugin.py:906: in inner\n    _loop.run_until_complete(task)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <_UnixSelectorEventLoop running=False closed=False debug=False>\nfuture = <Task finished name='Task-2177' coro=<test_services_humidifier_has_expected_services() done, defined at /home/jcrigby/fun/marge/tests/api/test_service_listing_format.py:178> exception=RuntimeError('coroutine raised StopIteration')>\n\n    def run_until_complete(self, future):\n        \"\"\"Run until the Future is done.\n    \n        If the argument is a coroutine, it is wrapped in a Task.\n    \n        WARNING: It would be disastrous to call run_until_complete()\n        with the same coroutine twice -- it would wrap it in two\n        different Tasks and that can't be good.\n    \n        Return the Future's result, or raise its exception.\n        \"\"\"\n        self._check_closed()\n        self._check_running()\n    \n        new_task = not futures.isfuture(future)\n        future = tasks.ensure_future(future, loop=self)\n        if new_task:\n            # An exception is raised if the future didn't complete, so there\n            # is no need to log the \"destroy pending task\" message\n            future._log_destroy_pending = False\n    \n        future.add_done_callback(_run_until_complete_cb)\n        try:\n            self.run_forever()\n        except:\n            if new_task and future.done() and not future.cancelled():\n                # The coroutine raised a BaseException. Consume the exception\n                # to not log a warning, the caller doesn't have access to the\n                # local task.\n                future.exception()\n            raise\n        finally:\n            future.remove_done_callback(_run_until_complete_cb)\n        if not future.done():\n            raise RuntimeError('Event loop stopped before Future completed.')\n    \n>       return future.result()\nE       RuntimeError: coroutine raised StopIteration\n\n../../anaconda3/lib/python3.9/asyncio/base_events.py:647: RuntimeError"}, "teardown": {"duration": 0.0008547501638531685, "outcome": "passed"}}, {"nodeid": "tests/api/test_service_listing_format.py::test_services_all_expected_domains_present", "lineno": 193, "outcome": "failed", "keywords": ["test_services_all_expected_domains_present", "test_service_listing_format.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.00558109488338232, "outcome": "passed"}, "call": {"duration": 0.0036372472532093525, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_service_listing_format.py", "lineno": 203, "message": "AssertionError: Missing domain: alarm_control_panel\nassert 'alarm_control_panel' in ['homeassistant', 'persistent_notification', 'logger', 'system_log', 'person', 'frontend', ...]"}, "traceback": [{"path": "tests/api/test_service_listing_format.py", "lineno": 203, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0625790>\n\n    async def test_services_all_expected_domains_present(rest):\n        \"\"\"All expected domains appear in service listing.\"\"\"\n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/services\",\n            headers=rest._headers(),\n        )\n        data = resp.json()\n        listed_domains = [e[\"domain\"] for e in data]\n        for domain in EXPECTED_DOMAINS:\n>           assert domain in listed_domains, f\"Missing domain: {domain}\"\nE           AssertionError: Missing domain: alarm_control_panel\nE           assert 'alarm_control_panel' in ['homeassistant', 'persistent_notification', 'logger', 'system_log', 'person', 'frontend', ...]\n\ntests/api/test_service_listing_format.py:203: AssertionError"}, "teardown": {"duration": 0.0006041582673788071, "outcome": "passed"}}, {"nodeid": "tests/api/test_service_listing_format.py::test_services_domains_sorted", "lineno": 205, "outcome": "failed", "keywords": ["test_services_domains_sorted", "test_service_listing_format.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005454245954751968, "outcome": "passed"}, "call": {"duration": 0.003728638868778944, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_service_listing_format.py", "lineno": 214, "message": "AssertionError: assert ['homeassista...rontend', ...] == ['automation'...rontend', ...]\n  \n  At index 0 diff: 'homeassistant' != 'automation'\n  Use -v to get more diff"}, "traceback": [{"path": "tests/api/test_service_listing_format.py", "lineno": 214, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b088ba60>\n\n    async def test_services_domains_sorted(rest):\n        \"\"\"Domains in service listing are sorted alphabetically.\"\"\"\n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/services\",\n            headers=rest._headers(),\n        )\n        data = resp.json()\n        domains = [e[\"domain\"] for e in data]\n>       assert domains == sorted(domains)\nE       AssertionError: assert ['homeassista...rontend', ...] == ['automation'...rontend', ...]\nE         \nE         At index 0 diff: 'homeassistant' != 'automation'\nE         Use -v to get more diff\n\ntests/api/test_service_listing_format.py:214: AssertionError"}, "teardown": {"duration": 0.0006681471131742001, "outcome": "passed"}}, {"nodeid": "tests/api/test_service_listing_format.py::test_services_service_description_present", "lineno": 216, "outcome": "passed", "keywords": ["test_services_service_description_present", "test_service_listing_format.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005705871153622866, "outcome": "passed"}, "call": {"duration": 0.0036882562562823296, "outcome": "passed"}, "teardown": {"duration": 0.0005432860925793648, "outcome": "passed"}}, {"nodeid": "tests/api/test_service_listing_format.py::test_events_returns_list", "lineno": 233, "outcome": "passed", "keywords": ["test_events_returns_list", "test_service_listing_format.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005037061404436827, "outcome": "passed"}, "call": {"duration": 0.002574106678366661, "outcome": "passed"}, "teardown": {"duration": 0.00046985503286123276, "outcome": "passed"}}, {"nodeid": "tests/api/test_service_listing_format.py::test_events_has_standard_types", "lineno": 245, "outcome": "failed", "keywords": ["test_events_has_standard_types", "test_service_listing_format.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005170932039618492, "outcome": "passed"}, "call": {"duration": 0.0027055679820477962, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_service_listing_format.py", "lineno": 255, "message": "AssertionError: assert 'call_service' in ['*', 'logging_changed', 'entity_registry_updated', 'core_config_updated', 'homeassistant_start', 'homeassistant_stop', ...]"}, "traceback": [{"path": "tests/api/test_service_listing_format.py", "lineno": 255, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b088bee0>\n\n    async def test_events_has_standard_types(rest):\n        \"\"\"Event list includes standard HA event types.\"\"\"\n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/events\",\n            headers=rest._headers(),\n        )\n        data = resp.json()\n        event_types = [e[\"event\"] for e in data]\n        assert \"state_changed\" in event_types\n>       assert \"call_service\" in event_types\nE       AssertionError: assert 'call_service' in ['*', 'logging_changed', 'entity_registry_updated', 'core_config_updated', 'homeassistant_start', 'homeassistant_stop', ...]\n\ntests/api/test_service_listing_format.py:255: AssertionError"}, "teardown": {"duration": 0.0006006080657243729, "outcome": "passed"}}, {"nodeid": "tests/api/test_service_listing_format.py::test_events_has_listener_count", "lineno": 258, "outcome": "passed", "keywords": ["test_events_has_listener_count", "test_service_listing_format.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005254839081317186, "outcome": "passed"}, "call": {"duration": 0.0026932042092084885, "outcome": "passed"}, "teardown": {"duration": 0.0005304329097270966, "outcome": "passed"}}, {"nodeid": "tests/api/test_service_listing_format.py::test_services_automation_domain", "lineno": 270, "outcome": "passed", "keywords": ["test_services_automation_domain", "test_service_listing_format.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005114232189953327, "outcome": "passed"}, "call": {"duration": 0.0038936776109039783, "outcome": "passed"}, "teardown": {"duration": 0.00047709420323371887, "outcome": "passed"}}, {"nodeid": "tests/api/test_service_listing_format.py::test_services_description_format", "lineno": 285, "outcome": "failed", "keywords": ["test_services_description_format", "test_service_listing_format.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005227101966738701, "outcome": "passed"}, "call": {"duration": 0.004221135284751654, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_service_listing_format.py", "lineno": 296, "message": "AssertionError: assert 'Saves the pe...ing interval.' == 'homeassistan...istent_states'\n  \n  - homeassistant.save_persistent_states\n  + Saves the persistent states immediately. Maintains the normal periodic saving interval."}, "traceback": [{"path": "tests/api/test_service_listing_format.py", "lineno": 296, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0aa4af0>\n\n    async def test_services_description_format(rest):\n        \"\"\"Service descriptions follow domain.service format.\"\"\"\n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/services\",\n            headers=rest._headers(),\n        )\n        data = resp.json()\n        for domain_entry in data[:5]:\n            domain = domain_entry[\"domain\"]\n            for svc_name, svc_info in domain_entry[\"services\"].items():\n>               assert svc_info[\"description\"] == f\"{domain}.{svc_name}\"\nE               AssertionError: assert 'Saves the pe...ing interval.' == 'homeassistan...istent_states'\nE                 \nE                 - homeassistant.save_persistent_states\nE                 + Saves the persistent states immediately. Maintains the normal periodic saving interval.\n\ntests/api/test_service_listing_format.py:296: AssertionError"}, "teardown": {"duration": 0.0005823089741170406, "outcome": "passed"}}, {"nodeid": "tests/api/test_service_listing_format.py::test_services_total_domains", "lineno": 298, "outcome": "failed", "keywords": ["test_services_total_domains", "test_service_listing_format.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005306614097207785, "outcome": "passed"}, "call": {"duration": 0.0345343891531229, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_service_listing_format.py", "lineno": 306, "message": "AssertionError: Expected 40+ domains, got 28\nassert 28 >= 40\n +  where 28 = len([{'domain': 'homeassistant', 'services': {'check_config': {'description': 'Checks the Home Assistant YAML-configuratio... of a theme.', 'example': 'default', 'name': 'Theme', 'required': True, ...}}, 'name': 'Set the default theme'}}}, ...])"}, "traceback": [{"path": "tests/api/test_service_listing_format.py", "lineno": 306, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b075f3a0>\n\n    async def test_services_total_domains(rest):\n        \"\"\"Services list has 40+ domains.\"\"\"\n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/services\",\n            headers=rest._headers(),\n        )\n        data = resp.json()\n>       assert len(data) >= 40, f\"Expected 40+ domains, got {len(data)}\"\nE       AssertionError: Expected 40+ domains, got 28\nE       assert 28 >= 40\nE        +  where 28 = len([{'domain': 'homeassistant', 'services': {'check_config': {'description': 'Checks the Home Assistant YAML-configuratio... of a theme.', 'example': 'default', 'name': 'Theme', 'required': True, ...}}, 'name': 'Set the default theme'}}}, ...])\n\ntests/api/test_service_listing_format.py:306: AssertionError"}, "teardown": {"duration": 0.0006732256151735783, "outcome": "passed"}}, {"nodeid": "tests/api/test_service_listing_format.py::test_services_total_service_count", "lineno": 308, "outcome": "failed", "keywords": ["test_services_total_service_count", "test_service_listing_format.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005500243045389652, "outcome": "passed"}, "call": {"duration": 0.0032069948501884937, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_service_listing_format.py", "lineno": 317, "message": "AssertionError: Expected 100+ services, got 94\nassert 94 >= 100"}, "traceback": [{"path": "tests/api/test_service_listing_format.py", "lineno": 317, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b09113d0>\n\n    async def test_services_total_service_count(rest):\n        \"\"\"Total service count across all domains is 100+.\"\"\"\n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/services\",\n            headers=rest._headers(),\n        )\n        data = resp.json()\n        total = sum(len(d[\"services\"]) for d in data)\n>       assert total >= 100, f\"Expected 100+ services, got {total}\"\nE       AssertionError: Expected 100+ services, got 94\nE       assert 94 >= 100\n\ntests/api/test_service_listing_format.py:317: AssertionError"}, "teardown": {"duration": 0.0006966488435864449, "outcome": "passed"}}, {"nodeid": "tests/api/test_sim_reload_config.py::test_sim_time_reflected_in_health", "lineno": 14, "outcome": "failed", "keywords": ["test_sim_time_reflected_in_health", "test_sim_reload_config.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005560216959565878, "outcome": "passed"}, "call": {"duration": 0.003948110155761242, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)"}, "traceback": [{"path": "tests/api/test_sim_reload_config.py", "lineno": 27, "message": ""}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 832, "message": "in json"}, {"path": "../../anaconda3/lib/python3.9/json/__init__.py", "lineno": 346, "message": "in loads"}, {"path": "../../anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "JSONDecodeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b1327910>\n\n    async def test_sim_time_reflected_in_health(rest):\n        \"\"\"sim/time values appear in health endpoint.\"\"\"\n        await rest.client.post(\n            f\"{rest.base_url}/api/sim/time\",\n            json={\"time\": \"08:00:00\", \"chapter\": \"morning\", \"speed\": 5},\n            headers=rest._headers(),\n        )\n    \n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/health\",\n            headers=rest._headers(),\n        )\n>       data = resp.json()\n\ntests/api/test_sim_reload_config.py:27: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:832: in json\n    return jsonlib.loads(self.content, **kwargs)\n../../anaconda3/lib/python3.9/json/__init__.py:346: in loads\n    return _default_decoder.decode(s)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <json.decoder.JSONDecoder object at 0x7f47b2e5fe50>, s = '404: Not Found'\n_w = <built-in method match of re.Pattern object at 0x7f47b3015cf0>\n\n    def decode(self, s, _w=WHITESPACE.match):\n        \"\"\"Return the Python representation of ``s`` (a ``str`` instance\n        containing a JSON document).\n    \n        \"\"\"\n        obj, end = self.raw_decode(s, idx=_w(s, 0).end())\n        end = _w(s, end).end()\n        if end != len(s):\n>           raise JSONDecodeError(\"Extra data\", s, end)\nE           json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)\n\n../../anaconda3/lib/python3.9/json/decoder.py:340: JSONDecodeError"}, "teardown": {"duration": 0.0007297899574041367, "outcome": "passed"}}, {"nodeid": "tests/api/test_sim_reload_config.py::test_reload_automations_alt_path", "lineno": 32, "outcome": "failed", "keywords": ["test_reload_automations_alt_path", "test_sim_reload_config.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005784754175692797, "outcome": "passed"}, "call": {"duration": 0.002963635139167309, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_sim_reload_config.py", "lineno": 40, "message": "assert 404 == 200\n +  where 404 = <Response [404 Not Found]>.status_code"}, "traceback": [{"path": "tests/api/test_sim_reload_config.py", "lineno": 40, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0579970>\n\n    async def test_reload_automations_alt_path(rest):\n        \"\"\"POST /api/config/automation/reload returns success.\"\"\"\n        resp = await rest.client.post(\n            f\"{rest.base_url}/api/config/automation/reload\",\n            json={},\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 404 == 200\nE        +  where 404 = <Response [404 Not Found]>.status_code\n\ntests/api/test_sim_reload_config.py:40: AssertionError"}, "teardown": {"duration": 0.0006671403534710407, "outcome": "passed"}}, {"nodeid": "tests/api/test_sim_reload_config.py::test_scene_config_list", "lineno": 42, "outcome": "failed", "keywords": ["test_scene_config_list", "test_sim_reload_config.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005220309365540743, "outcome": "passed"}, "call": {"duration": 0.00270710326731205, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_sim_reload_config.py", "lineno": 49, "message": "assert 404 == 200\n +  where 404 = <Response [404 Not Found]>.status_code"}, "traceback": [{"path": "tests/api/test_sim_reload_config.py", "lineno": 49, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0579e50>\n\n    async def test_scene_config_list(rest):\n        \"\"\"GET /api/config/scene/config returns scene list.\"\"\"\n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/config/scene/config\",\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 404 == 200\nE        +  where 404 = <Response [404 Not Found]>.status_code\n\ntests/api/test_sim_reload_config.py:49: AssertionError"}, "teardown": {"duration": 0.0006336397491395473, "outcome": "passed"}}, {"nodeid": "tests/api/test_sim_reload_config.py::test_scene_yaml_get", "lineno": 54, "outcome": "failed", "keywords": ["test_scene_yaml_get", "test_sim_reload_config.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005316159222275019, "outcome": "passed"}, "call": {"duration": 0.0028713843785226345, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_sim_reload_config.py", "lineno": 61, "message": "assert 404 == 200\n +  where 404 = <Response [404 Not Found]>.status_code"}, "traceback": [{"path": "tests/api/test_sim_reload_config.py", "lineno": 61, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b071cb50>\n\n    async def test_scene_yaml_get(rest):\n        \"\"\"GET /api/config/scene/yaml returns YAML string.\"\"\"\n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/config/scene/yaml\",\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 404 == 200\nE        +  where 404 = <Response [404 Not Found]>.status_code\n\ntests/api/test_sim_reload_config.py:61: AssertionError"}, "teardown": {"duration": 0.0005988199263811111, "outcome": "passed"}}, {"nodeid": "tests/api/test_sim_reload_config.py::test_automation_config_list", "lineno": 65, "outcome": "failed", "keywords": ["test_automation_config_list", "test_sim_reload_config.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005793516989797354, "outcome": "passed"}, "call": {"duration": 0.0029262714087963104, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_sim_reload_config.py", "lineno": 72, "message": "assert 404 == 200\n +  where 404 = <Response [404 Not Found]>.status_code"}, "traceback": [{"path": "tests/api/test_sim_reload_config.py", "lineno": 72, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b071c310>\n\n    async def test_automation_config_list(rest):\n        \"\"\"GET /api/config/automation/config returns automation list.\"\"\"\n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/config/automation/config\",\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 404 == 200\nE        +  where 404 = <Response [404 Not Found]>.status_code\n\ntests/api/test_sim_reload_config.py:72: AssertionError"}, "teardown": {"duration": 0.0005444367416203022, "outcome": "passed"}}, {"nodeid": "tests/api/test_sim_reload_config.py::test_automation_yaml_get", "lineno": 77, "outcome": "failed", "keywords": ["test_automation_yaml_get", "test_sim_reload_config.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005253521725535393, "outcome": "passed"}, "call": {"duration": 0.0027505792677402496, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_sim_reload_config.py", "lineno": 84, "message": "assert 404 == 200\n +  where 404 = <Response [404 Not Found]>.status_code"}, "traceback": [{"path": "tests/api/test_sim_reload_config.py", "lineno": 84, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b071c4c0>\n\n    async def test_automation_yaml_get(rest):\n        \"\"\"GET /api/config/automation/yaml returns YAML string.\"\"\"\n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/config/automation/yaml\",\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 404 == 200\nE        +  where 404 = <Response [404 Not Found]>.status_code\n\ntests/api/test_sim_reload_config.py:84: AssertionError"}, "teardown": {"duration": 0.000487001147121191, "outcome": "passed"}}, {"nodeid": "tests/api/test_sim_time_backup.py::test_sim_time_set", "lineno": 13, "outcome": "skipped", "keywords": ["test_sim_time_set", "test_sim_time_backup.py", "asyncio", "marge_only", "api", "tests", "marge", ""], "setup": {"duration": 0.00023683207109570503, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/api/test_sim_time_backup.py', 14, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00013065198436379433, "outcome": "passed"}}, {"nodeid": "tests/api/test_sim_time_backup.py::test_sim_time_read_via_health", "lineno": 23, "outcome": "skipped", "keywords": ["test_sim_time_read_via_health", "test_sim_time_backup.py", "asyncio", "marge_only", "api", "tests", "marge", ""], "setup": {"duration": 0.00019938917830586433, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/api/test_sim_time_backup.py', 24, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00012792972847819328, "outcome": "passed"}}, {"nodeid": "tests/api/test_sim_time_backup.py::test_sim_time_set_chapter", "lineno": 35, "outcome": "skipped", "keywords": ["test_sim_time_set_chapter", "test_sim_time_backup.py", "asyncio", "marge_only", "api", "tests", "marge", ""], "setup": {"duration": 0.00020649004727602005, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/api/test_sim_time_backup.py', 36, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00014253286644816399, "outcome": "passed"}}, {"nodeid": "tests/api/test_sim_time_backup.py::test_sim_time_set_speed", "lineno": 45, "outcome": "skipped", "keywords": ["test_sim_time_set_speed", "test_sim_time_backup.py", "asyncio", "marge_only", "api", "tests", "marge", ""], "setup": {"duration": 0.00020121317356824875, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/api/test_sim_time_backup.py', 46, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.0036234199069440365, "outcome": "passed"}}, {"nodeid": "tests/api/test_sim_time_backup.py::test_sim_time_partial_update", "lineno": 55, "outcome": "skipped", "keywords": ["test_sim_time_partial_update", "test_sim_time_backup.py", "asyncio", "marge_only", "api", "tests", "marge", ""], "setup": {"duration": 0.00022628111764788628, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/api/test_sim_time_backup.py', 56, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00016778428107500076, "outcome": "passed"}}, {"nodeid": "tests/api/test_sim_time_backup.py::test_backup_returns_tarball", "lineno": 67, "outcome": "skipped", "keywords": ["test_backup_returns_tarball", "test_sim_time_backup.py", "asyncio", "marge_only", "api", "tests", "marge", ""], "setup": {"duration": 0.0002098558470606804, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/api/test_sim_time_backup.py', 68, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.000130494125187397, "outcome": "passed"}}, {"nodeid": "tests/api/test_sim_time_backup.py::test_backup_has_content_type", "lineno": 78, "outcome": "skipped", "keywords": ["test_backup_has_content_type", "test_sim_time_backup.py", "asyncio", "marge_only", "api", "tests", "marge", ""], "setup": {"duration": 0.0002016969956457615, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/api/test_sim_time_backup.py', 79, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00012896768748760223, "outcome": "passed"}}, {"nodeid": "tests/api/test_sim_time_backup.py::test_backup_not_empty", "lineno": 89, "outcome": "skipped", "keywords": ["test_backup_not_empty", "test_sim_time_backup.py", "asyncio", "marge_only", "api", "tests", "marge", ""], "setup": {"duration": 0.00020155077800154686, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/api/test_sim_time_backup.py', 90, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.0001277630217373371, "outcome": "passed"}}, {"nodeid": "tests/api/test_sim_time_backup.py::test_prometheus_metrics_endpoint", "lineno": 100, "outcome": "skipped", "keywords": ["test_prometheus_metrics_endpoint", "test_sim_time_backup.py", "asyncio", "marge_only", "api", "tests", "marge", ""], "setup": {"duration": 0.00023354263976216316, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/api/test_sim_time_backup.py', 101, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00013380823656916618, "outcome": "passed"}}, {"nodeid": "tests/api/test_sim_time_backup.py::test_prometheus_metrics_has_latency", "lineno": 109, "outcome": "skipped", "keywords": ["test_prometheus_metrics_has_latency", "test_sim_time_backup.py", "asyncio", "marge_only", "api", "tests", "marge", ""], "setup": {"duration": 0.00019919080659747124, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/api/test_sim_time_backup.py', 110, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00013076188042759895, "outcome": "passed"}}, {"nodeid": "tests/api/test_sim_time_backup.py::test_prometheus_metrics_content_type", "lineno": 116, "outcome": "skipped", "keywords": ["test_prometheus_metrics_content_type", "test_sim_time_backup.py", "asyncio", "marge_only", "api", "tests", "marge", ""], "setup": {"duration": 0.00019724015146493912, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/api/test_sim_time_backup.py', 117, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00013321498408913612, "outcome": "passed"}}, {"nodeid": "tests/api/test_state_search_extended.py::test_search_by_q_text", "lineno": 13, "outcome": "failed", "keywords": ["test_search_by_q_text", "test_state_search_extended.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.00566898612305522, "outcome": "passed"}, "call": {"duration": 0.004297326784580946, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_state_search_extended.py", "lineno": 27, "message": "TypeError: string indices must be integers"}, "traceback": [{"path": "tests/api/test_state_search_extended.py", "lineno": 27, "message": ""}, {"path": "tests/api/test_state_search_extended.py", "lineno": 27, "message": "TypeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0690ca0>\n\n    async def test_search_by_q_text(rest):\n        \"\"\"Search by q parameter matches entity_id substring.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"sensor.searchable_{tag}\"\n        await rest.set_state(eid, \"data\")\n    \n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/states/search\",\n            params={\"q\": f\"searchable_{tag}\"},\n            headers=rest._headers(),\n        )\n        data = resp.json()\n        assert len(data) >= 1\n>       entity_ids = [e[\"entity_id\"] for e in data]\n\ntests/api/test_state_search_extended.py:27: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\n.0 = <dict_keyiterator object at 0x7f47b11fb180>\n\n>   entity_ids = [e[\"entity_id\"] for e in data]\nE   TypeError: string indices must be integers\n\ntests/api/test_state_search_extended.py:27: TypeError"}, "teardown": {"duration": 0.000677984207868576, "outcome": "passed"}}, {"nodeid": "tests/api/test_state_search_extended.py::test_search_combined_domain_and_state", "lineno": 30, "outcome": "failed", "keywords": ["test_search_combined_domain_and_state", "test_state_search_extended.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005441764835268259, "outcome": "passed"}, "call": {"duration": 0.00654800608754158, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_state_search_extended.py", "lineno": 45, "message": "TypeError: string indices must be integers"}, "traceback": [{"path": "tests/api/test_state_search_extended.py", "lineno": 45, "message": "TypeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0627be0>\n\n    async def test_search_combined_domain_and_state(rest):\n        \"\"\"Combined domain + state filter.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        await rest.set_state(f\"light.combo_{tag}\", \"on\")\n        await rest.set_state(f\"switch.combo_{tag}\", \"on\")\n        await rest.set_state(f\"light.combo2_{tag}\", \"off\")\n    \n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/states/search\",\n            params={\"domain\": \"light\", \"state\": \"on\"},\n            headers=rest._headers(),\n        )\n        data = resp.json()\n        for e in data:\n>           assert e[\"entity_id\"].startswith(\"light.\")\nE           TypeError: string indices must be integers\n\ntests/api/test_state_search_extended.py:45: TypeError"}, "teardown": {"duration": 0.0005548079498112202, "outcome": "passed"}}, {"nodeid": "tests/api/test_state_search_extended.py::test_search_no_results", "lineno": 48, "outcome": "failed", "keywords": ["test_search_no_results", "test_state_search_extended.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.00525919534265995, "outcome": "passed"}, "call": {"duration": 0.0024868990294635296, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_state_search_extended.py", "lineno": 57, "message": "AssertionError: assert False\n +  where False = isinstance({'message': 'Entity not found.'}, list)"}, "traceback": [{"path": "tests/api/test_state_search_extended.py", "lineno": 57, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b1294790>\n\n    async def test_search_no_results(rest):\n        \"\"\"Search with no matching entities returns empty list.\"\"\"\n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/states/search\",\n            params={\"q\": \"absolutely_nonexistent_entity_xyz_999\"},\n            headers=rest._headers(),\n        )\n        data = resp.json()\n>       assert isinstance(data, list)\nE       AssertionError: assert False\nE        +  where False = isinstance({'message': 'Entity not found.'}, list)\n\ntests/api/test_state_search_extended.py:57: AssertionError"}, "teardown": {"duration": 0.0004950622096657753, "outcome": "passed"}}, {"nodeid": "tests/api/test_state_search_extended.py::test_search_domain_case_sensitive", "lineno": 60, "outcome": "failed", "keywords": ["test_search_domain_case_sensitive", "test_state_search_extended.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005506813060492277, "outcome": "passed"}, "call": {"duration": 0.004107202868908644, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_state_search_extended.py", "lineno": 73, "message": "TypeError: string indices must be integers"}, "traceback": [{"path": "tests/api/test_state_search_extended.py", "lineno": 73, "message": ""}, {"path": "tests/api/test_state_search_extended.py", "lineno": 73, "message": "TypeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b1294640>\n\n    async def test_search_domain_case_sensitive(rest):\n        \"\"\"Domain filter matches exact case.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        await rest.set_state(f\"sensor.case_{tag}\", \"val\")\n    \n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/states/search\",\n            params={\"domain\": \"SENSOR\"},\n            headers=rest._headers(),\n        )\n        data = resp.json()\n        # Domains are lowercase; uppercase search should return empty\n>       sensor_entities = [e for e in data if e[\"entity_id\"].startswith(\"sensor.\")]\n\ntests/api/test_state_search_extended.py:73: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\n.0 = <dict_keyiterator object at 0x7f47b10bd130>\n\n>   sensor_entities = [e for e in data if e[\"entity_id\"].startswith(\"sensor.\")]\nE   TypeError: string indices must be integers\n\ntests/api/test_state_search_extended.py:73: TypeError"}, "teardown": {"duration": 0.000569579191505909, "outcome": "passed"}}, {"nodeid": "tests/api/test_state_search_extended.py::test_search_results_are_sorted", "lineno": 78, "outcome": "failed", "keywords": ["test_search_results_are_sorted", "test_state_search_extended.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005238987039774656, "outcome": "passed"}, "call": {"duration": 0.0027486570179462433, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_state_search_extended.py", "lineno": 87, "message": "TypeError: string indices must be integers"}, "traceback": [{"path": "tests/api/test_state_search_extended.py", "lineno": 87, "message": ""}, {"path": "tests/api/test_state_search_extended.py", "lineno": 87, "message": "TypeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0a00d30>\n\n    async def test_search_results_are_sorted(rest):\n        \"\"\"Search results are sorted by entity_id.\"\"\"\n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/states/search\",\n            params={\"domain\": \"sensor\"},\n            headers=rest._headers(),\n        )\n        data = resp.json()\n>       entity_ids = [e[\"entity_id\"] for e in data]\n\ntests/api/test_state_search_extended.py:87: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\n.0 = <dict_keyiterator object at 0x7f47b124ce00>\n\n>   entity_ids = [e[\"entity_id\"] for e in data]\nE   TypeError: string indices must be integers\n\ntests/api/test_state_search_extended.py:87: TypeError"}, "teardown": {"duration": 0.0005145398899912834, "outcome": "passed"}}, {"nodeid": "tests/api/test_template_engine.py::test_template_arithmetic[{{ 1 + 2 }}-3]", "lineno": 28, "outcome": "passed", "keywords": ["test_template_arithmetic[{{ 1 + 2 }}-3]", "parametrize", "pytestmark", "{{ 1 + 2 }}-3", "test_template_engine.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005137632135301828, "outcome": "passed"}, "call": {"duration": 0.002512363251298666, "outcome": "passed"}, "teardown": {"duration": 0.0005871723406016827, "outcome": "passed"}}, {"nodeid": "tests/api/test_template_engine.py::test_template_arithmetic[{{ 5 + 3 }}-8]", "lineno": 28, "outcome": "passed", "keywords": ["test_template_arithmetic[{{ 5 + 3 }}-8]", "parametrize", "pytestmark", "{{ 5 + 3 }}-8", "test_template_engine.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005223636049777269, "outcome": "passed"}, "call": {"duration": 0.003282498102635145, "outcome": "passed"}, "teardown": {"duration": 0.000539903063327074, "outcome": "passed"}}, {"nodeid": "tests/api/test_template_engine.py::test_template_arithmetic[{{ 7 * 6 }}-42]", "lineno": 28, "outcome": "passed", "keywords": ["test_template_arithmetic[{{ 7 * 6 }}-42]", "parametrize", "pytestmark", "{{ 7 * 6 }}-42", "test_template_engine.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005093925166875124, "outcome": "passed"}, "call": {"duration": 0.004730507731437683, "outcome": "passed"}, "teardown": {"duration": 0.0005045570433139801, "outcome": "passed"}}, {"nodeid": "tests/api/test_template_engine.py::test_template_arithmetic[{{ 100 / 4 }}-25]", "lineno": 28, "outcome": "passed", "keywords": ["test_template_arithmetic[{{ 100 / 4 }}-25]", "parametrize", "pytestmark", "{{ 100 / 4 }}-25", "test_template_engine.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005427002906799316, "outcome": "passed"}, "call": {"duration": 0.002865508198738098, "outcome": "passed"}, "teardown": {"duration": 0.00045997509732842445, "outcome": "passed"}}, {"nodeid": "tests/api/test_template_engine.py::test_template_arithmetic[{{ 17 % 5 }}-2]", "lineno": 28, "outcome": "passed", "keywords": ["test_template_arithmetic[{{ 17 % 5 }}-2]", "parametrize", "pytestmark", "{{ 17 % 5 }}-2", "test_template_engine.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.006059078965336084, "outcome": "passed"}, "call": {"duration": 0.0034587662667036057, "outcome": "passed"}, "teardown": {"duration": 0.0005528219044208527, "outcome": "passed"}}, {"nodeid": "tests/api/test_template_engine.py::test_template_arithmetic[{{ (10 + 20) * 2 }}-60]", "lineno": 28, "outcome": "passed", "keywords": ["test_template_arithmetic[{{ (10 + 20) * 2 }}-60]", "parametrize", "pytestmark", "{{ (10 + 20) * 2 }}-60", "test_template_engine.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.00568932993337512, "outcome": "passed"}, "call": {"duration": 0.00562063604593277, "outcome": "passed"}, "teardown": {"duration": 0.0005101719871163368, "outcome": "passed"}}, {"nodeid": "tests/api/test_template_engine.py::test_template_arithmetic[{{ (10 + 5) * 2 }}-30]", "lineno": 28, "outcome": "passed", "keywords": ["test_template_arithmetic[{{ (10 + 5) * 2 }}-30]", "parametrize", "pytestmark", "{{ (10 + 5) * 2 }}-30", "test_template_engine.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005270831286907196, "outcome": "passed"}, "call": {"duration": 0.003303111996501684, "outcome": "passed"}, "teardown": {"duration": 0.0005416609346866608, "outcome": "passed"}}, {"nodeid": "tests/api/test_template_engine.py::test_template_float_division", "lineno": 44, "outcome": "passed", "keywords": ["test_template_float_division", "test_template_engine.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005242926999926567, "outcome": "passed"}, "call": {"duration": 0.003166631329804659, "outcome": "passed"}, "teardown": {"duration": 0.0005526179447770119, "outcome": "passed"}}, {"nodeid": "tests/api/test_template_engine.py::test_filter_string_case[{{ 'HELLO' | lower }}-hello]", "lineno": 53, "outcome": "passed", "keywords": ["test_filter_string_case[{{ 'HELLO' | lower }}-hello]", "parametrize", "pytestmark", "{{ 'HELLO' | lower }}-hello", "test_template_engine.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005548802204430103, "outcome": "passed"}, "call": {"duration": 0.005459596868604422, "outcome": "passed"}, "teardown": {"duration": 0.0005411487072706223, "outcome": "passed"}}, {"nodeid": "tests/api/test_template_engine.py::test_filter_string_case[{{ 'WORLD' | lower }}-world]", "lineno": 53, "outcome": "passed", "keywords": ["test_filter_string_case[{{ 'WORLD' | lower }}-world]", "parametrize", "pytestmark", "{{ 'WORLD' | lower }}-world", "test_template_engine.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005235597956925631, "outcome": "passed"}, "call": {"duration": 0.003008904866874218, "outcome": "passed"}, "teardown": {"duration": 0.0005142670124769211, "outcome": "passed"}}, {"nodeid": "tests/api/test_template_engine.py::test_filter_string_case[{{ 'hello' | upper }}-HELLO]", "lineno": 53, "outcome": "passed", "keywords": ["test_filter_string_case[{{ 'hello' | upper }}-HELLO]", "parametrize", "pytestmark", "{{ 'hello' | upper }}-HELLO", "test_template_engine.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005434015300124884, "outcome": "passed"}, "call": {"duration": 0.003083758056163788, "outcome": "passed"}, "teardown": {"duration": 0.000527665950357914, "outcome": "passed"}}, {"nodeid": "tests/api/test_template_engine.py::test_filter_string_case[{{ 'hello world' | title }}-Hello World]", "lineno": 53, "outcome": "passed", "keywords": ["test_filter_string_case[{{ 'hello world' | title }}-Hello World]", "parametrize", "pytestmark", "{{ 'hello world' | title }}-Hello World", "test_template_engine.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005282621365040541, "outcome": "passed"}, "call": {"duration": 0.005670274142175913, "outcome": "passed"}, "teardown": {"duration": 0.0005283239297568798, "outcome": "passed"}}, {"nodeid": "tests/api/test_template_engine.py::test_filter_trim", "lineno": 66, "outcome": "passed", "keywords": ["test_filter_trim", "test_template_engine.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005165670067071915, "outcome": "passed"}, "call": {"duration": 0.0028658132068812847, "outcome": "passed"}, "teardown": {"duration": 0.00052241375669837, "outcome": "passed"}}, {"nodeid": "tests/api/test_template_engine.py::test_filter_replace", "lineno": 73, "outcome": "passed", "keywords": ["test_filter_replace", "test_template_engine.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005046259146183729, "outcome": "passed"}, "call": {"duration": 0.003259918186813593, "outcome": "passed"}, "teardown": {"duration": 0.0005054711364209652, "outcome": "passed"}}, {"nodeid": "tests/api/test_template_engine.py::test_filter_length", "lineno": 80, "outcome": "passed", "keywords": ["test_filter_length", "test_template_engine.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.0050514377653598785, "outcome": "passed"}, "call": {"duration": 0.012186135165393353, "outcome": "passed"}, "teardown": {"duration": 0.0006294567137956619, "outcome": "passed"}}, {"nodeid": "tests/api/test_template_engine.py::test_filter_numeric_conversion[{{ '42' | int }}-42]", "lineno": 89, "outcome": "passed", "keywords": ["test_filter_numeric_conversion[{{ '42' | int }}-42]", "parametrize", "pytestmark", "{{ '42' | int }}-42", "test_template_engine.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005448102951049805, "outcome": "passed"}, "call": {"duration": 0.003188038244843483, "outcome": "passed"}, "teardown": {"duration": 0.0005317809991538525, "outcome": "passed"}}, {"nodeid": "tests/api/test_template_engine.py::test_filter_numeric_conversion[{{ '3.14' | float }}-3.14]", "lineno": 89, "outcome": "passed", "keywords": ["test_filter_numeric_conversion[{{ '3.14' | float }}-3.14]", "parametrize", "pytestmark", "{{ '3.14' | float }}-3.14", "test_template_engine.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005475427024066448, "outcome": "passed"}, "call": {"duration": 0.002964518964290619, "outcome": "passed"}, "teardown": {"duration": 0.0005763550288975239, "outcome": "passed"}}, {"nodeid": "tests/api/test_template_engine.py::test_filter_numeric_conversion[{{ -42 | abs }}-42]", "lineno": 89, "outcome": "passed", "keywords": ["test_filter_numeric_conversion[{{ -42 | abs }}-42]", "parametrize", "pytestmark", "{{ -42 | abs }}-42", "test_template_engine.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.007545251864939928, "outcome": "passed"}, "call": {"duration": 0.00524799432605505, "outcome": "passed"}, "teardown": {"duration": 0.0005067018792033195, "outcome": "passed"}}, {"nodeid": "tests/api/test_template_engine.py::test_filter_int_from_float_string", "lineno": 101, "outcome": "failed", "keywords": ["test_filter_int_from_float_string", "test_template_engine.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005184025038033724, "outcome": "passed"}, "call": {"duration": 0.0029019988141953945, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_template_engine.py", "lineno": 106, "message": "AssertionError: assert '0' in '3'\n +  where '3' = <Response [200 OK]>.text"}, "traceback": [{"path": "tests/api/test_template_engine.py", "lineno": 106, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0545b80>\n\n    async def test_filter_int_from_float_string(rest):\n        \"\"\"int filter on non-integer string returns 0 (parse failure).\"\"\"\n        r = await _render(rest, \"{{ '3.7' | int }}\")\n        assert r.status_code == 200\n>       assert \"0\" in r.text\nE       AssertionError: assert '0' in '3'\nE        +  where '3' = <Response [200 OK]>.text\n\ntests/api/test_template_engine.py:106: AssertionError"}, "teardown": {"duration": 0.000572380144149065, "outcome": "passed"}}, {"nodeid": "tests/api/test_template_engine.py::test_filter_round[{{ 3.7 | round }}-4]", "lineno": 108, "outcome": "passed", "keywords": ["test_filter_round[{{ 3.7 | round }}-4]", "parametrize", "pytestmark", "{{ 3.7 | round }}-4", "test_template_engine.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005306116305291653, "outcome": "passed"}, "call": {"duration": 0.0028637778013944626, "outcome": "passed"}, "teardown": {"duration": 0.00045395316556096077, "outcome": "passed"}}, {"nodeid": "tests/api/test_template_engine.py::test_filter_round[{{ 3.14159 | round(2) }}-3.14]", "lineno": 108, "outcome": "passed", "keywords": ["test_filter_round[{{ 3.14159 | round(2) }}-3.14]", "parametrize", "pytestmark", "{{ 3.14159 | round(2) }}-3.14", "test_template_engine.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.0052973320707678795, "outcome": "passed"}, "call": {"duration": 0.003258964978158474, "outcome": "passed"}, "teardown": {"duration": 0.0005003586411476135, "outcome": "passed"}}, {"nodeid": "tests/api/test_template_engine.py::test_filter_round[{{ 3.7 | round(0) }}-expected2]", "lineno": 108, "outcome": "passed", "keywords": ["test_filter_round[{{ 3.7 | round(0) }}-expected2]", "parametrize", "pytestmark", "{{ 3.7 | round(0) }}-expected2", "test_template_engine.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005180977750569582, "outcome": "passed"}, "call": {"duration": 0.0044799987226724625, "outcome": "passed"}, "teardown": {"duration": 0.0005072830244898796, "outcome": "passed"}}, {"nodeid": "tests/api/test_template_engine.py::test_filter_min_max[{{ 3 | max(7) }}-7]", "lineno": 123, "outcome": "failed", "keywords": ["test_filter_min_max[{{ 3 | max(7) }}-7]", "parametrize", "pytestmark", "{{ 3 | max(7) }}-7", "test_template_engine.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005621599033474922, "outcome": "passed"}, "call": {"duration": 0.003382427152246237, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_template_engine.py", "lineno": 133, "message": "assert 400 == 200\n +  where 400 = <Response [400 Bad Request]>.status_code"}, "traceback": [{"path": "tests/api/test_template_engine.py", "lineno": 133, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0a81d30>\ntemplate = '{{ 3 | max(7) }}', expected = '7'\n\n    @pytest.mark.parametrize(\"template,expected\", [\n        (\"{{ 3 | max(7) }}\", \"7\"),\n        (\"{{ 3 | min(7) }}\", \"3\"),\n        (\"{{ 5 | max(10) | int }}\", \"10\"),\n        (\"{{ 5 | min(10) | int }}\", \"5\"),\n    ])\n    async def test_filter_min_max(rest, template, expected):\n        \"\"\"min/max filters return correct extreme.\"\"\"\n        r = await _render(rest, template)\n>       assert r.status_code == 200\nE       assert 400 == 200\nE        +  where 400 = <Response [400 Bad Request]>.status_code\n\ntests/api/test_template_engine.py:133: AssertionError"}, "teardown": {"duration": 0.000701656099408865, "outcome": "passed"}}, {"nodeid": "tests/api/test_template_engine.py::test_filter_min_max[{{ 3 | min(7) }}-3]", "lineno": 123, "outcome": "failed", "keywords": ["test_filter_min_max[{{ 3 | min(7) }}-3]", "parametrize", "pytestmark", "{{ 3 | min(7) }}-3", "test_template_engine.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.006653851829469204, "outcome": "passed"}, "call": {"duration": 0.0034456788562238216, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_template_engine.py", "lineno": 133, "message": "assert 400 == 200\n +  where 400 = <Response [400 Bad Request]>.status_code"}, "traceback": [{"path": "tests/api/test_template_engine.py", "lineno": 133, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b08c4b80>\ntemplate = '{{ 3 | min(7) }}', expected = '3'\n\n    @pytest.mark.parametrize(\"template,expected\", [\n        (\"{{ 3 | max(7) }}\", \"7\"),\n        (\"{{ 3 | min(7) }}\", \"3\"),\n        (\"{{ 5 | max(10) | int }}\", \"10\"),\n        (\"{{ 5 | min(10) | int }}\", \"5\"),\n    ])\n    async def test_filter_min_max(rest, template, expected):\n        \"\"\"min/max filters return correct extreme.\"\"\"\n        r = await _render(rest, template)\n>       assert r.status_code == 200\nE       assert 400 == 200\nE        +  where 400 = <Response [400 Bad Request]>.status_code\n\ntests/api/test_template_engine.py:133: AssertionError"}, "teardown": {"duration": 0.0005283388309180737, "outcome": "passed"}}, {"nodeid": "tests/api/test_template_engine.py::test_filter_min_max[{{ 5 | max(10) | int }}-10]", "lineno": 123, "outcome": "failed", "keywords": ["test_filter_min_max[{{ 5 | max(10) | int }}-10]", "parametrize", "pytestmark", "{{ 5 | max(10) | int }}-10", "test_template_engine.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.0056046112440526485, "outcome": "passed"}, "call": {"duration": 0.0034986301325261593, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_template_engine.py", "lineno": 133, "message": "assert 400 == 200\n +  where 400 = <Response [400 Bad Request]>.status_code"}, "traceback": [{"path": "tests/api/test_template_engine.py", "lineno": 133, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0a8f220>\ntemplate = '{{ 5 | max(10) | int }}', expected = '10'\n\n    @pytest.mark.parametrize(\"template,expected\", [\n        (\"{{ 3 | max(7) }}\", \"7\"),\n        (\"{{ 3 | min(7) }}\", \"3\"),\n        (\"{{ 5 | max(10) | int }}\", \"10\"),\n        (\"{{ 5 | min(10) | int }}\", \"5\"),\n    ])\n    async def test_filter_min_max(rest, template, expected):\n        \"\"\"min/max filters return correct extreme.\"\"\"\n        r = await _render(rest, template)\n>       assert r.status_code == 200\nE       assert 400 == 200\nE        +  where 400 = <Response [400 Bad Request]>.status_code\n\ntests/api/test_template_engine.py:133: AssertionError"}, "teardown": {"duration": 0.0008132569491863251, "outcome": "passed"}}, {"nodeid": "tests/api/test_template_engine.py::test_filter_min_max[{{ 5 | min(10) | int }}-5]", "lineno": 123, "outcome": "failed", "keywords": ["test_filter_min_max[{{ 5 | min(10) | int }}-5]", "parametrize", "pytestmark", "{{ 5 | min(10) | int }}-5", "test_template_engine.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.0065296911634504795, "outcome": "passed"}, "call": {"duration": 0.0035441098734736443, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_template_engine.py", "lineno": 133, "message": "assert 400 == 200\n +  where 400 = <Response [400 Bad Request]>.status_code"}, "traceback": [{"path": "tests/api/test_template_engine.py", "lineno": 133, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b06906a0>\ntemplate = '{{ 5 | min(10) | int }}', expected = '5'\n\n    @pytest.mark.parametrize(\"template,expected\", [\n        (\"{{ 3 | max(7) }}\", \"7\"),\n        (\"{{ 3 | min(7) }}\", \"3\"),\n        (\"{{ 5 | max(10) | int }}\", \"10\"),\n        (\"{{ 5 | min(10) | int }}\", \"5\"),\n    ])\n    async def test_filter_min_max(rest, template, expected):\n        \"\"\"min/max filters return correct extreme.\"\"\"\n        r = await _render(rest, template)\n>       assert r.status_code == 200\nE       assert 400 == 200\nE        +  where 400 = <Response [400 Bad Request]>.status_code\n\ntests/api/test_template_engine.py:133: AssertionError"}, "teardown": {"duration": 0.0006617526523768902, "outcome": "passed"}}, {"nodeid": "tests/api/test_template_engine.py::test_filter_log[{{ 1 | log }}-0]", "lineno": 136, "outcome": "passed", "keywords": ["test_filter_log[{{ 1 | log }}-0]", "parametrize", "pytestmark", "{{ 1 | log }}-0", "test_template_engine.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005598272662609816, "outcome": "passed"}, "call": {"duration": 0.003010306041687727, "outcome": "passed"}, "teardown": {"duration": 0.0004986831918358803, "outcome": "passed"}}, {"nodeid": "tests/api/test_template_engine.py::test_filter_log[{{ 1 | log | round(1) }}-0.0]", "lineno": 136, "outcome": "passed", "keywords": ["test_filter_log[{{ 1 | log | round(1) }}-0.0]", "parametrize", "pytestmark", "{{ 1 | log | round(1) }}-0.0", "test_template_engine.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005192013923078775, "outcome": "passed"}, "call": {"duration": 0.0032748570665717125, "outcome": "passed"}, "teardown": {"duration": 0.0006471402011811733, "outcome": "passed"}}, {"nodeid": "tests/api/test_template_engine.py::test_filter_log[{{ 100 | log(10) | round(1) }}-2.0]", "lineno": 136, "outcome": "passed", "keywords": ["test_filter_log[{{ 100 | log(10) | round(1) }}-2.0]", "parametrize", "pytestmark", "{{ 100 | log(10) | round(1) }}-2.0", "test_template_engine.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005388771183788776, "outcome": "passed"}, "call": {"duration": 0.004978280980139971, "outcome": "passed"}, "teardown": {"duration": 0.0005498751997947693, "outcome": "passed"}}, {"nodeid": "tests/api/test_template_engine.py::test_filter_iif[{{ 1 | iif('yes', 'no') }}-yes]", "lineno": 150, "outcome": "passed", "keywords": ["test_filter_iif[{{ 1 | iif('yes', 'no') }}-yes]", "parametrize", "pytestmark", "{{ 1 | iif('yes', 'no') }}-yes", "test_template_engine.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.0053307670168578625, "outcome": "passed"}, "call": {"duration": 0.0032885679975152016, "outcome": "passed"}, "teardown": {"duration": 0.0005521150305867195, "outcome": "passed"}}, {"nodeid": "tests/api/test_template_engine.py::test_filter_iif[{{ 0 | iif('yes', 'no') }}-no]", "lineno": 150, "outcome": "passed", "keywords": ["test_filter_iif[{{ 0 | iif('yes', 'no') }}-no]", "parametrize", "pytestmark", "{{ 0 | iif('yes', 'no') }}-no", "test_template_engine.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.0070756361819803715, "outcome": "passed"}, "call": {"duration": 0.00450487993657589, "outcome": "passed"}, "teardown": {"duration": 0.0006502717733383179, "outcome": "passed"}}, {"nodeid": "tests/api/test_template_engine.py::test_filter_iif[{{ true | iif('on', 'off') }}-on]", "lineno": 150, "outcome": "passed", "keywords": ["test_filter_iif[{{ true | iif('on', 'off') }}-on]", "parametrize", "pytestmark", "{{ true | iif('on', 'off') }}-on", "test_template_engine.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005548415705561638, "outcome": "passed"}, "call": {"duration": 0.005350405815988779, "outcome": "passed"}, "teardown": {"duration": 0.0006241071969270706, "outcome": "passed"}}, {"nodeid": "tests/api/test_template_engine.py::test_filter_iif[{{ false | iif('on', 'off') }}-off]", "lineno": 150, "outcome": "passed", "keywords": ["test_filter_iif[{{ false | iif('on', 'off') }}-off]", "parametrize", "pytestmark", "{{ false | iif('on', 'off') }}-off", "test_template_engine.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.00553244398906827, "outcome": "passed"}, "call": {"duration": 0.0035347766242921352, "outcome": "passed"}, "teardown": {"duration": 0.0005941716954112053, "outcome": "passed"}}, {"nodeid": "tests/api/test_template_engine.py::test_filter_iif[{{ '' | iif('yes', 'no') }}-no]", "lineno": 150, "outcome": "passed", "keywords": ["test_filter_iif[{{ '' | iif('yes', 'no') }}-no]", "parametrize", "pytestmark", "{{ '' | iif('yes', 'no') }}-no", "test_template_engine.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005566845647990704, "outcome": "passed"}, "call": {"duration": 0.003694914747029543, "outcome": "passed"}, "teardown": {"duration": 0.0006731487810611725, "outcome": "passed"}}, {"nodeid": "tests/api/test_template_engine.py::test_filter_default_undefined", "lineno": 164, "outcome": "passed", "keywords": ["test_filter_default_undefined", "test_template_engine.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005312303081154823, "outcome": "passed"}, "call": {"duration": 0.003612190019339323, "outcome": "passed"}, "teardown": {"duration": 0.0006373608484864235, "outcome": "passed"}}, {"nodeid": "tests/api/test_template_engine.py::test_filter_default_with_value", "lineno": 171, "outcome": "passed", "keywords": ["test_filter_default_with_value", "test_template_engine.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005305530969053507, "outcome": "passed"}, "call": {"duration": 0.005708237644284964, "outcome": "passed"}, "teardown": {"duration": 0.0005170376971364021, "outcome": "passed"}}, {"nodeid": "tests/api/test_template_engine.py::test_filter_is_defined", "lineno": 178, "outcome": "failed", "keywords": ["test_filter_is_defined", "test_template_engine.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.0054547772742807865, "outcome": "passed"}, "call": {"duration": 0.0035419310443103313, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_template_engine.py", "lineno": 183, "message": "AssertionError: assert '42' == 'true'\n  \n  - true\n  + 42"}, "traceback": [{"path": "tests/api/test_template_engine.py", "lineno": 183, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0898b80>\n\n    async def test_filter_is_defined(rest):\n        \"\"\"is_defined returns true for defined values.\"\"\"\n        r = await _render(rest, \"{{ 42 | is_defined }}\")\n        assert r.status_code == 200\n>       assert r.text.strip() == \"true\"\nE       AssertionError: assert '42' == 'true'\nE         \nE         - true\nE         + 42\n\ntests/api/test_template_engine.py:183: AssertionError"}, "teardown": {"duration": 0.0007272902876138687, "outcome": "passed"}}, {"nodeid": "tests/api/test_template_engine.py::test_filter_from_json_attr", "lineno": 187, "outcome": "failed", "keywords": ["test_filter_from_json_attr", "test_template_engine.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005777014885097742, "outcome": "passed"}, "call": {"duration": 0.0038093049079179764, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_template_engine.py", "lineno": 192, "message": "AssertionError: assert '' == '1'\n  \n  - 1"}, "traceback": [{"path": "tests/api/test_template_engine.py", "lineno": 192, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b1a30f70>\n\n    async def test_filter_from_json_attr(rest):\n        \"\"\"from_json parses JSON string and attr accesses fields.\"\"\"\n        r = await _render(rest, '{{ \\'{\"a\":1,\"b\":2}\\' | from_json | attr(\"a\") }}')\n        assert r.status_code == 200\n>       assert r.text.strip() == \"1\"\nE       AssertionError: assert '' == '1'\nE         \nE         - 1\n\ntests/api/test_template_engine.py:192: AssertionError"}, "teardown": {"duration": 0.0006470959633588791, "outcome": "passed"}}, {"nodeid": "tests/api/test_template_engine.py::test_filter_from_json_basic", "lineno": 194, "outcome": "passed", "keywords": ["test_filter_from_json_basic", "test_template_engine.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005285200662910938, "outcome": "passed"}, "call": {"duration": 0.0033256718888878822, "outcome": "passed"}, "teardown": {"duration": 0.0005374629981815815, "outcome": "passed"}}, {"nodeid": "tests/api/test_template_engine.py::test_filter_from_json_with_state", "lineno": 202, "outcome": "failed", "keywords": ["test_filter_from_json_with_state", "test_template_engine.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005474220961332321, "outcome": "passed"}, "call": {"duration": 0.005725075025111437, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_template_engine.py", "lineno": 208, "message": "AssertionError: assert '' == '72'\n  \n  - 72"}, "traceback": [{"path": "tests/api/test_template_engine.py", "lineno": 208, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0563820>\n\n    async def test_filter_from_json_with_state(rest):\n        \"\"\"from_json handles JSON stored in entity state.\"\"\"\n        await rest.set_state(\"sensor.json_test\", '{\"temp\":72,\"unit\":\"F\"}')\n        r = await _render(rest, \"{{ states('sensor.json_test') | from_json | attr('temp') }}\")\n        assert r.status_code == 200\n>       assert r.text.strip() == \"72\"\nE       AssertionError: assert '' == '72'\nE         \nE         - 72\n\ntests/api/test_template_engine.py:208: AssertionError"}, "teardown": {"duration": 0.0006214580498635769, "outcome": "passed"}}, {"nodeid": "tests/api/test_template_engine.py::test_filter_to_json", "lineno": 210, "outcome": "passed", "keywords": ["test_filter_to_json", "test_template_engine.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005717817228287458, "outcome": "passed"}, "call": {"duration": 0.0032386681996285915, "outcome": "passed"}, "teardown": {"duration": 0.0005286536179482937, "outcome": "passed"}}, {"nodeid": "tests/api/test_template_engine.py::test_states_function", "lineno": 219, "outcome": "passed", "keywords": ["test_states_function", "test_template_engine.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005343372002243996, "outcome": "passed"}, "call": {"duration": 0.0046235546469688416, "outcome": "passed"}, "teardown": {"duration": 0.0005027661100029945, "outcome": "passed"}}, {"nodeid": "tests/api/test_template_engine.py::test_states_unknown_entity", "lineno": 230, "outcome": "passed", "keywords": ["test_states_unknown_entity", "test_template_engine.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005246354267001152, "outcome": "passed"}, "call": {"duration": 0.00538342772051692, "outcome": "passed"}, "teardown": {"duration": 0.0004981798119843006, "outcome": "passed"}}, {"nodeid": "tests/api/test_template_engine.py::test_is_state_true", "lineno": 237, "outcome": "passed", "keywords": ["test_is_state_true", "test_template_engine.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005530701018869877, "outcome": "passed"}, "call": {"duration": 0.004940439946949482, "outcome": "passed"}, "teardown": {"duration": 0.0005615539848804474, "outcome": "passed"}}, {"nodeid": "tests/api/test_template_engine.py::test_is_state_false", "lineno": 248, "outcome": "passed", "keywords": ["test_is_state_false", "test_template_engine.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005233022850006819, "outcome": "passed"}, "call": {"duration": 0.0046591078862547874, "outcome": "passed"}, "teardown": {"duration": 0.0005323691293597221, "outcome": "passed"}}, {"nodeid": "tests/api/test_template_engine.py::test_state_attr_function", "lineno": 259, "outcome": "passed", "keywords": ["test_state_attr_function", "test_template_engine.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005182506050914526, "outcome": "passed"}, "call": {"duration": 0.007554085925221443, "outcome": "passed"}, "teardown": {"duration": 0.0005456670187413692, "outcome": "passed"}}, {"nodeid": "tests/api/test_template_engine.py::test_now_function", "lineno": 270, "outcome": "passed", "keywords": ["test_now_function", "test_template_engine.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005612904205918312, "outcome": "passed"}, "call": {"duration": 0.0032965289428830147, "outcome": "passed"}, "teardown": {"duration": 0.0005406858399510384, "outcome": "passed"}}, {"nodeid": "tests/api/test_template_engine.py::test_states_with_float_comparison", "lineno": 278, "outcome": "failed", "keywords": ["test_states_with_float_comparison", "test_template_engine.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.0053063640370965, "outcome": "passed"}, "call": {"duration": 0.0051531377248466015, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_template_engine.py", "lineno": 284, "message": "AssertionError: assert 'True' == 'true'\n  \n  - true\n  ? ^\n  + True\n  ? ^"}, "traceback": [{"path": "tests/api/test_template_engine.py", "lineno": 284, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b111b130>\n\n    async def test_states_with_float_comparison(rest):\n        \"\"\"states() | float > threshold works.\"\"\"\n        await rest.set_state(\"sensor.tmpl_adv_temp\", \"80\")\n        r = await _render(rest, \"{{ states('sensor.tmpl_adv_temp') | float > 75 }}\")\n        assert r.status_code == 200\n>       assert r.text.strip() == \"true\"\nE       AssertionError: assert 'True' == 'true'\nE         \nE         - true\nE         ? ^\nE         + True\nE         ? ^\n\ntests/api/test_template_engine.py:284: AssertionError"}, "teardown": {"duration": 0.0006707999855279922, "outcome": "passed"}}, {"nodeid": "tests/api/test_template_engine.py::test_fn_float_conversion", "lineno": 288, "outcome": "passed", "keywords": ["test_fn_float_conversion", "test_template_engine.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005483484826982021, "outcome": "passed"}, "call": {"duration": 0.00319132162258029, "outcome": "passed"}, "teardown": {"duration": 0.0005159126594662666, "outcome": "passed"}}, {"nodeid": "tests/api/test_template_engine.py::test_fn_float_default", "lineno": 295, "outcome": "passed", "keywords": ["test_fn_float_default", "test_template_engine.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005298303905874491, "outcome": "passed"}, "call": {"duration": 0.003297788091003895, "outcome": "passed"}, "teardown": {"duration": 0.0004930319264531136, "outcome": "passed"}}, {"nodeid": "tests/api/test_template_engine.py::test_fn_int_conversion", "lineno": 302, "outcome": "passed", "keywords": ["test_fn_int_conversion", "test_template_engine.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005132352001965046, "outcome": "passed"}, "call": {"duration": 0.003481045365333557, "outcome": "passed"}, "teardown": {"duration": 0.0005531292408704758, "outcome": "passed"}}, {"nodeid": "tests/api/test_template_engine.py::test_fn_int_from_float_string", "lineno": 309, "outcome": "passed", "keywords": ["test_fn_int_from_float_string", "test_template_engine.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005077451933175325, "outcome": "passed"}, "call": {"duration": 0.006000330206006765, "outcome": "passed"}, "teardown": {"duration": 0.000488723162561655, "outcome": "passed"}}, {"nodeid": "tests/api/test_template_engine.py::test_fn_int_default", "lineno": 316, "outcome": "passed", "keywords": ["test_fn_int_default", "test_template_engine.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005739463958889246, "outcome": "passed"}, "call": {"duration": 0.003213615156710148, "outcome": "passed"}, "teardown": {"duration": 0.0004928940907120705, "outcome": "passed"}}, {"nodeid": "tests/api/test_template_engine.py::test_fn_bool[true-true]", "lineno": 323, "outcome": "passed", "keywords": ["test_fn_bool[true-true]", "parametrize", "pytestmark", "true-true", "test_template_engine.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005309286992996931, "outcome": "passed"}, "call": {"duration": 0.0031413938850164413, "outcome": "passed"}, "teardown": {"duration": 0.0005653193220496178, "outcome": "passed"}}, {"nodeid": "tests/api/test_template_engine.py::test_fn_bool[yes-true]", "lineno": 323, "outcome": "passed", "keywords": ["test_fn_bool[yes-true]", "parametrize", "pytestmark", "yes-true", "test_template_engine.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.00544695183634758, "outcome": "passed"}, "call": {"duration": 0.006506603676825762, "outcome": "passed"}, "teardown": {"duration": 0.0006017531268298626, "outcome": "passed"}}, {"nodeid": "tests/api/test_template_engine.py::test_fn_bool[on-true]", "lineno": 323, "outcome": "passed", "keywords": ["test_fn_bool[on-true]", "parametrize", "pytestmark", "on-true", "test_template_engine.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.00594922062009573, "outcome": "passed"}, "call": {"duration": 0.0032000811770558357, "outcome": "passed"}, "teardown": {"duration": 0.0004936489276587963, "outcome": "passed"}}, {"nodeid": "tests/api/test_template_engine.py::test_fn_bool[1-true]", "lineno": 323, "outcome": "passed", "keywords": ["test_fn_bool[1-true]", "parametrize", "pytestmark", "1-true", "test_template_engine.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005486425943672657, "outcome": "passed"}, "call": {"duration": 0.0031684120185673237, "outcome": "passed"}, "teardown": {"duration": 0.0005663828924298286, "outcome": "passed"}}, {"nodeid": "tests/api/test_template_engine.py::test_fn_bool[false-false]", "lineno": 323, "outcome": "passed", "keywords": ["test_fn_bool[false-false]", "parametrize", "pytestmark", "false-false", "test_template_engine.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.0054502543061971664, "outcome": "passed"}, "call": {"duration": 0.006132060196250677, "outcome": "passed"}, "teardown": {"duration": 0.0007675038650631905, "outcome": "passed"}}, {"nodeid": "tests/api/test_template_engine.py::test_fn_bool[no-false]", "lineno": 323, "outcome": "passed", "keywords": ["test_fn_bool[no-false]", "parametrize", "pytestmark", "no-false", "test_template_engine.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.006148351822048426, "outcome": "passed"}, "call": {"duration": 0.0031467662192881107, "outcome": "passed"}, "teardown": {"duration": 0.0005239509046077728, "outcome": "passed"}}, {"nodeid": "tests/api/test_template_engine.py::test_fn_bool[off-false]", "lineno": 323, "outcome": "passed", "keywords": ["test_fn_bool[off-false]", "parametrize", "pytestmark", "off-false", "test_template_engine.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.0056321588344872, "outcome": "passed"}, "call": {"duration": 0.003195233177393675, "outcome": "passed"}, "teardown": {"duration": 0.0005422309041023254, "outcome": "passed"}}, {"nodeid": "tests/api/test_template_engine.py::test_fn_bool[0-false]", "lineno": 323, "outcome": "passed", "keywords": ["test_fn_bool[0-false]", "parametrize", "pytestmark", "0-false", "test_template_engine.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005282681901007891, "outcome": "passed"}, "call": {"duration": 0.004566889721900225, "outcome": "passed"}, "teardown": {"duration": 0.0005216407589614391, "outcome": "passed"}}, {"nodeid": "tests/api/test_template_engine.py::test_fn_bool_numeric", "lineno": 340, "outcome": "passed", "keywords": ["test_fn_bool_numeric", "test_template_engine.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005519792903214693, "outcome": "passed"}, "call": {"duration": 0.0032774140127003193, "outcome": "passed"}, "teardown": {"duration": 0.0005045789293944836, "outcome": "passed"}}, {"nodeid": "tests/api/test_template_engine.py::test_template_syntax_error", "lineno": 349, "outcome": "passed", "keywords": ["test_template_syntax_error", "test_template_engine.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005242638755589724, "outcome": "passed"}, "call": {"duration": 0.0027233432047069073, "outcome": "passed"}, "teardown": {"duration": 0.0005023251287639141, "outcome": "passed"}}, {"nodeid": "tests/api/test_template_engine.py::test_template_undefined_function", "lineno": 355, "outcome": "passed", "keywords": ["test_template_undefined_function", "test_template_engine.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005336300935596228, "outcome": "passed"}, "call": {"duration": 0.0053085931576788425, "outcome": "passed"}, "teardown": {"duration": 0.0005070716142654419, "outcome": "passed"}}, {"nodeid": "tests/api/test_template_engine.py::test_template_conditional[{{ 'yes' if 2 > 1 else 'no' }}-yes]", "lineno": 363, "outcome": "passed", "keywords": ["test_template_conditional[{{ 'yes' if 2 > 1 else 'no' }}-yes]", "parametrize", "pytestmark", "{{ 'yes' if 2 > 1 else 'no' }}-yes", "test_template_engine.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005467699375003576, "outcome": "passed"}, "call": {"duration": 0.0030861757695674896, "outcome": "passed"}, "teardown": {"duration": 0.0005665440112352371, "outcome": "passed"}}, {"nodeid": "tests/api/test_template_engine.py::test_template_conditional[{{ 'yes' if 1 > 2 else 'no' }}-no]", "lineno": 363, "outcome": "passed", "keywords": ["test_template_conditional[{{ 'yes' if 1 > 2 else 'no' }}-no]", "parametrize", "pytestmark", "{{ 'yes' if 1 > 2 else 'no' }}-no", "test_template_engine.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005370635073632002, "outcome": "passed"}, "call": {"duration": 0.0029736198484897614, "outcome": "passed"}, "teardown": {"duration": 0.00047937920317053795, "outcome": "passed"}}, {"nodeid": "tests/api/test_template_engine.py::test_template_conditional_with_is_state", "lineno": 374, "outcome": "passed", "keywords": ["test_template_conditional_with_is_state", "test_template_engine.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005045420024544001, "outcome": "passed"}, "call": {"duration": 0.00776448380202055, "outcome": "passed"}, "teardown": {"duration": 0.0005035637877881527, "outcome": "passed"}}, {"nodeid": "tests/api/test_template_engine.py::test_template_tilde_concat[{{ 'a' ~ 'b' ~ 'c' }}-abc]", "lineno": 384, "outcome": "passed", "keywords": ["test_template_tilde_concat[{{ 'a' ~ 'b' ~ 'c' }}-abc]", "parametrize", "pytestmark", "{{ 'a' ~ 'b' ~ 'c' }}-abc", "test_template_engine.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.0055925860069692135, "outcome": "passed"}, "call": {"duration": 0.0028812531381845474, "outcome": "passed"}, "teardown": {"duration": 0.0005441717803478241, "outcome": "passed"}}, {"nodeid": "tests/api/test_template_engine.py::test_template_tilde_concat[{{ 'hello' ~ ' ' ~ 'world' }}-hello world]", "lineno": 384, "outcome": "passed", "keywords": ["test_template_tilde_concat[{{ 'hello' ~ ' ' ~ 'world' }}-hello world]", "parametrize", "pytestmark", "{{ 'hello' ~ ' ' ~ 'world' }}-hello world", "test_template_engine.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.0053978897631168365, "outcome": "passed"}, "call": {"duration": 0.0024689510464668274, "outcome": "passed"}, "teardown": {"duration": 0.00045563187450170517, "outcome": "passed"}}, {"nodeid": "tests/api/test_template_engine.py::test_template_iif_with_is_state", "lineno": 397, "outcome": "passed", "keywords": ["test_template_iif_with_is_state", "test_template_engine.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005044572986662388, "outcome": "passed"}, "call": {"duration": 0.007151082158088684, "outcome": "passed"}, "teardown": {"duration": 0.0004926640540361404, "outcome": "passed"}}, {"nodeid": "tests/api/test_template_engine.py::test_template_state_attr_missing", "lineno": 407, "outcome": "failed", "keywords": ["test_template_state_attr_missing", "test_template_engine.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005479125771671534, "outcome": "passed"}, "call": {"duration": 0.004848238080739975, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_template_engine.py", "lineno": 413, "message": "AssertionError: assert 'None' == 'none'\n  \n  - none\n  ? ^\n  + None\n  ? ^"}, "traceback": [{"path": "tests/api/test_template_engine.py", "lineno": 413, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b06274f0>\n\n    async def test_template_state_attr_missing(rest):\n        \"\"\"state_attr for missing attribute returns empty with default.\"\"\"\n        await rest.set_state(\"sensor.attr_miss\", \"42\")\n        r = await _render(rest, \"{{ state_attr('sensor.attr_miss', 'nonexistent') | default('none') }}\")\n        assert r.status_code == 200\n>       assert r.text.strip() == \"none\"\nE       AssertionError: assert 'None' == 'none'\nE         \nE         - none\nE         ? ^\nE         + None\nE         ? ^\n\ntests/api/test_template_engine.py:413: AssertionError"}, "teardown": {"duration": 0.0006666183471679688, "outcome": "passed"}}, {"nodeid": "tests/api/test_template_engine.py::test_template_for_loop", "lineno": 417, "outcome": "passed", "keywords": ["test_template_for_loop", "test_template_engine.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005255777854472399, "outcome": "passed"}, "call": {"duration": 0.0034826681949198246, "outcome": "passed"}, "teardown": {"duration": 0.0005515790544450283, "outcome": "passed"}}, {"nodeid": "tests/api/test_template_engine.py::test_template_multiline", "lineno": 426, "outcome": "passed", "keywords": ["test_template_multiline", "test_template_engine.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005519318860024214, "outcome": "passed"}, "call": {"duration": 0.003215216100215912, "outcome": "passed"}, "teardown": {"duration": 0.0005034417845308781, "outcome": "passed"}}, {"nodeid": "tests/api/test_template_engine.py::test_filter_chain_round_int", "lineno": 438, "outcome": "passed", "keywords": ["test_filter_chain_round_int", "test_template_engine.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005950582679361105, "outcome": "passed"}, "call": {"duration": 0.00400290684774518, "outcome": "passed"}, "teardown": {"duration": 0.00047549884766340256, "outcome": "passed"}}, {"nodeid": "tests/api/test_template_engine.py::test_states_with_float_filter", "lineno": 445, "outcome": "passed", "keywords": ["test_states_with_float_filter", "test_template_engine.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005298806354403496, "outcome": "passed"}, "call": {"duration": 0.0070894439704716206, "outcome": "passed"}, "teardown": {"duration": 0.000557510182261467, "outcome": "passed"}}, {"nodeid": "tests/api/test_template_engine.py::test_filter_chain_trim_float_round_int", "lineno": 458, "outcome": "passed", "keywords": ["test_filter_chain_trim_float_round_int", "test_template_engine.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005659698974341154, "outcome": "passed"}, "call": {"duration": 0.0036703147925436497, "outcome": "passed"}, "teardown": {"duration": 0.0005441838875412941, "outcome": "passed"}}, {"nodeid": "tests/api/test_template_engine.py::test_filter_chain_float_round_precision", "lineno": 465, "outcome": "passed", "keywords": ["test_filter_chain_float_round_precision", "test_template_engine.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005161606706678867, "outcome": "passed"}, "call": {"duration": 0.007414504885673523, "outcome": "passed"}, "teardown": {"duration": 0.0005897693336009979, "outcome": "passed"}}, {"nodeid": "tests/api/test_template_engine.py::test_filter_chain_int_abs", "lineno": 473, "outcome": "passed", "keywords": ["test_filter_chain_int_abs", "test_template_engine.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005514359101653099, "outcome": "passed"}, "call": {"duration": 0.0032264739274978638, "outcome": "passed"}, "teardown": {"duration": 0.0004963851533830166, "outcome": "passed"}}, {"nodeid": "tests/api/test_template_engine.py::test_filter_chain_default_upper", "lineno": 480, "outcome": "passed", "keywords": ["test_filter_chain_default_upper", "test_template_engine.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005262014921754599, "outcome": "passed"}, "call": {"duration": 0.003358046989887953, "outcome": "passed"}, "teardown": {"duration": 0.0004860842600464821, "outcome": "passed"}}, {"nodeid": "tests/api/test_template_engine.py::test_filter_chain_trim_lower_replace", "lineno": 487, "outcome": "passed", "keywords": ["test_filter_chain_trim_lower_replace", "test_template_engine.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005218488164246082, "outcome": "passed"}, "call": {"duration": 0.005458745174109936, "outcome": "passed"}, "teardown": {"duration": 0.0004759482108056545, "outcome": "passed"}}, {"nodeid": "tests/api/test_template_state_functions.py::test_states_function_returns_value", "lineno": 35, "outcome": "passed", "keywords": ["test_states_function_returns_value", "test_template_state_functions.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005359727889299393, "outcome": "passed"}, "call": {"duration": 0.0045391591265797615, "outcome": "passed"}, "teardown": {"duration": 0.000493302009999752, "outcome": "passed"}}, {"nodeid": "tests/api/test_template_state_functions.py::test_states_unknown_entity", "lineno": 43, "outcome": "passed", "keywords": ["test_states_unknown_entity", "test_template_state_functions.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005141088273376226, "outcome": "passed"}, "call": {"duration": 0.0028671235777437687, "outcome": "passed"}, "teardown": {"duration": 0.00046740705147385597, "outcome": "passed"}}, {"nodeid": "tests/api/test_template_state_functions.py::test_is_state_true", "lineno": 52, "outcome": "passed", "keywords": ["test_is_state_true", "test_template_state_functions.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005194022785872221, "outcome": "passed"}, "call": {"duration": 0.0075589981861412525, "outcome": "passed"}, "teardown": {"duration": 0.000536586157977581, "outcome": "passed"}}, {"nodeid": "tests/api/test_template_state_functions.py::test_is_state_false", "lineno": 60, "outcome": "passed", "keywords": ["test_is_state_false", "test_template_state_functions.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005654099863022566, "outcome": "passed"}, "call": {"duration": 0.004930820316076279, "outcome": "passed"}, "teardown": {"duration": 0.0004896661266684532, "outcome": "passed"}}, {"nodeid": "tests/api/test_template_state_functions.py::test_is_state_nonexistent", "lineno": 68, "outcome": "passed", "keywords": ["test_is_state_nonexistent", "test_template_state_functions.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005557604134082794, "outcome": "passed"}, "call": {"duration": 0.0028435918502509594, "outcome": "passed"}, "teardown": {"duration": 0.0004448438994586468, "outcome": "passed"}}, {"nodeid": "tests/api/test_template_state_functions.py::test_state_attr_returns_value", "lineno": 77, "outcome": "passed", "keywords": ["test_state_attr_returns_value", "test_template_state_functions.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005413340870290995, "outcome": "passed"}, "call": {"duration": 0.007354844827204943, "outcome": "passed"}, "teardown": {"duration": 0.0005259718745946884, "outcome": "passed"}}, {"nodeid": "tests/api/test_template_state_functions.py::test_state_attr_numeric", "lineno": 85, "outcome": "passed", "keywords": ["test_state_attr_numeric", "test_template_state_functions.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.006044784095138311, "outcome": "passed"}, "call": {"duration": 0.004658284597098827, "outcome": "passed"}, "teardown": {"duration": 0.0004626852460205555, "outcome": "passed"}}, {"nodeid": "tests/api/test_template_state_functions.py::test_state_attr_missing_attr", "lineno": 93, "outcome": "passed", "keywords": ["test_state_attr_missing_attr", "test_template_state_functions.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.0054130880162119865, "outcome": "passed"}, "call": {"duration": 0.004866429138928652, "outcome": "passed"}, "teardown": {"duration": 0.0006311512552201748, "outcome": "passed"}}, {"nodeid": "tests/api/test_template_state_functions.py::test_now_function", "lineno": 105, "outcome": "passed", "keywords": ["test_now_function", "test_template_state_functions.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.006737847812473774, "outcome": "passed"}, "call": {"duration": 0.005603677127510309, "outcome": "passed"}, "teardown": {"duration": 0.0006392369978129864, "outcome": "passed"}}, {"nodeid": "tests/api/test_template_state_functions.py::test_states_in_conditional", "lineno": 114, "outcome": "passed", "keywords": ["test_states_in_conditional", "test_template_state_functions.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.006197331938892603, "outcome": "passed"}, "call": {"duration": 0.004794636741280556, "outcome": "passed"}, "teardown": {"duration": 0.0005059358663856983, "outcome": "passed"}}, {"nodeid": "tests/api/test_template_state_functions.py::test_states_with_math", "lineno": 122, "outcome": "passed", "keywords": ["test_states_with_math", "test_template_state_functions.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005505732260644436, "outcome": "passed"}, "call": {"duration": 0.004866966977715492, "outcome": "passed"}, "teardown": {"duration": 0.0004912889562547207, "outcome": "passed"}}, {"nodeid": "tests/api/test_template_state_functions.py::test_multiple_state_functions", "lineno": 130, "outcome": "passed", "keywords": ["test_multiple_state_functions", "test_template_state_functions.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005133356899023056, "outcome": "passed"}, "call": {"duration": 0.007959295995533466, "outcome": "passed"}, "teardown": {"duration": 0.000575721263885498, "outcome": "passed"}}, {"nodeid": "tests/api/test_template_state_functions.py::test_is_state_in_template_logic", "lineno": 140, "outcome": "passed", "keywords": ["test_is_state_in_template_logic", "test_template_state_functions.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.0054986258037388325, "outcome": "passed"}, "call": {"duration": 0.004586511757224798, "outcome": "passed"}, "teardown": {"duration": 0.00046363892033696175, "outcome": "passed"}}, {"nodeid": "tests/api/test_template_state_functions.py::test_ws_states_returns_entity_state", "lineno": 150, "outcome": "failed", "keywords": ["test_ws_states_returns_entity_state", "test_template_state_functions.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.007676528301090002, "outcome": "passed"}, "call": {"duration": 0.0036416337825357914, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_template_state_functions.py", "lineno": 31, "message": "TypeError: 'NoneType' object is not subscriptable"}, "traceback": [{"path": "tests/api/test_template_state_functions.py", "lineno": 156, "message": ""}, {"path": "tests/api/test_template_state_functions.py", "lineno": 31, "message": "TypeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0aa43d0>\nws = <conftest.WSClient object at 0x7f47b09e23a0>\n\n    async def test_ws_states_returns_entity_state(rest, ws):\n        \"\"\"states('entity_id') returns the entity's state string via WS.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"sensor.tmpl_st_{tag}\"\n        await rest.set_state(eid, \"42\")\n>       result = await _render_ws(ws, \"{{ states('\" + eid + \"') }}\")\n\ntests/api/test_template_state_functions.py:156: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nws = <conftest.WSClient object at 0x7f47b09e23a0>\ntemplate = \"{{ states('sensor.tmpl_st_900c95e0') }}\"\n\n    async def _render_ws(ws, template: str) -> str:\n        \"\"\"Render template via WS render_template command.\"\"\"\n        resp = await ws.send_command(\"render_template\", template=template)\n        assert resp[\"success\"] is True\n>       return resp[\"result\"][\"result\"]\nE       TypeError: 'NoneType' object is not subscriptable\n\ntests/api/test_template_state_functions.py:31: TypeError"}, "teardown": {"duration": 0.0015432960353791714, "outcome": "passed"}}, {"nodeid": "tests/api/test_template_state_functions.py::test_ws_states_unknown_entity", "lineno": 159, "outcome": "failed", "keywords": ["test_ws_states_unknown_entity", "test_template_state_functions.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.0026178588159382343, "outcome": "passed"}, "call": {"duration": 0.0013844026252627373, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_template_state_functions.py", "lineno": 31, "message": "TypeError: 'NoneType' object is not subscriptable"}, "traceback": [{"path": "tests/api/test_template_state_functions.py", "lineno": 162, "message": ""}, {"path": "tests/api/test_template_state_functions.py", "lineno": 31, "message": "TypeError"}], "longrepr": "ws = <conftest.WSClient object at 0x7f47b08da220>\n\n    async def test_ws_states_unknown_entity(ws):\n        \"\"\"states() returns 'unknown' for non-existent entity via WS.\"\"\"\n>       result = await _render_ws(ws, \"{{ states('sensor.nonexistent_xyz_99') }}\")\n\ntests/api/test_template_state_functions.py:162: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nws = <conftest.WSClient object at 0x7f47b08da220>\ntemplate = \"{{ states('sensor.nonexistent_xyz_99') }}\"\n\n    async def _render_ws(ws, template: str) -> str:\n        \"\"\"Render template via WS render_template command.\"\"\"\n        resp = await ws.send_command(\"render_template\", template=template)\n        assert resp[\"success\"] is True\n>       return resp[\"result\"][\"result\"]\nE       TypeError: 'NoneType' object is not subscriptable\n\ntests/api/test_template_state_functions.py:31: TypeError"}, "teardown": {"duration": 0.0008087176829576492, "outcome": "passed"}}, {"nodeid": "tests/api/test_template_state_functions.py::test_ws_is_state_true", "lineno": 165, "outcome": "failed", "keywords": ["test_ws_is_state_true", "test_template_state_functions.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.007397892884910107, "outcome": "passed"}, "call": {"duration": 0.003568560816347599, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_template_state_functions.py", "lineno": 31, "message": "TypeError: 'NoneType' object is not subscriptable"}, "traceback": [{"path": "tests/api/test_template_state_functions.py", "lineno": 171, "message": ""}, {"path": "tests/api/test_template_state_functions.py", "lineno": 31, "message": "TypeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0552670>\nws = <conftest.WSClient object at 0x7f47b05520a0>\n\n    async def test_ws_is_state_true(rest, ws):\n        \"\"\"is_state() returns true when entity matches expected state via WS.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"light.tmpl_is_{tag}\"\n        await rest.set_state(eid, \"on\")\n>       result = await _render_ws(ws, \"{{ is_state('\" + eid + \"', 'on') }}\")\n\ntests/api/test_template_state_functions.py:171: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nws = <conftest.WSClient object at 0x7f47b05520a0>\ntemplate = \"{{ is_state('light.tmpl_is_fd735b5a', 'on') }}\"\n\n    async def _render_ws(ws, template: str) -> str:\n        \"\"\"Render template via WS render_template command.\"\"\"\n        resp = await ws.send_command(\"render_template\", template=template)\n        assert resp[\"success\"] is True\n>       return resp[\"result\"][\"result\"]\nE       TypeError: 'NoneType' object is not subscriptable\n\ntests/api/test_template_state_functions.py:31: TypeError"}, "teardown": {"duration": 0.0010162116959691048, "outcome": "passed"}}, {"nodeid": "tests/api/test_template_state_functions.py::test_ws_is_state_false", "lineno": 174, "outcome": "failed", "keywords": ["test_ws_is_state_false", "test_template_state_functions.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.007409094367176294, "outcome": "passed"}, "call": {"duration": 0.0038201799616217613, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_template_state_functions.py", "lineno": 31, "message": "TypeError: 'NoneType' object is not subscriptable"}, "traceback": [{"path": "tests/api/test_template_state_functions.py", "lineno": 180, "message": ""}, {"path": "tests/api/test_template_state_functions.py", "lineno": 31, "message": "TypeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b075f6d0>\nws = <conftest.WSClient object at 0x7f47b061d250>\n\n    async def test_ws_is_state_false(rest, ws):\n        \"\"\"is_state() returns false when entity doesn't match via WS.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"light.tmpl_isf_{tag}\"\n        await rest.set_state(eid, \"off\")\n>       result = await _render_ws(ws, \"{{ is_state('\" + eid + \"', 'on') }}\")\n\ntests/api/test_template_state_functions.py:180: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nws = <conftest.WSClient object at 0x7f47b061d250>\ntemplate = \"{{ is_state('light.tmpl_isf_0cd7957a', 'on') }}\"\n\n    async def _render_ws(ws, template: str) -> str:\n        \"\"\"Render template via WS render_template command.\"\"\"\n        resp = await ws.send_command(\"render_template\", template=template)\n        assert resp[\"success\"] is True\n>       return resp[\"result\"][\"result\"]\nE       TypeError: 'NoneType' object is not subscriptable\n\ntests/api/test_template_state_functions.py:31: TypeError"}, "teardown": {"duration": 0.0010903896763920784, "outcome": "passed"}}, {"nodeid": "tests/api/test_template_state_functions.py::test_ws_is_state_nonexistent", "lineno": 183, "outcome": "failed", "keywords": ["test_ws_is_state_nonexistent", "test_template_state_functions.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.0023661749437451363, "outcome": "passed"}, "call": {"duration": 0.0013477550819516182, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_template_state_functions.py", "lineno": 31, "message": "TypeError: 'NoneType' object is not subscriptable"}, "traceback": [{"path": "tests/api/test_template_state_functions.py", "lineno": 186, "message": ""}, {"path": "tests/api/test_template_state_functions.py", "lineno": 31, "message": "TypeError"}], "longrepr": "ws = <conftest.WSClient object at 0x7f47b0619400>\n\n    async def test_ws_is_state_nonexistent(ws):\n        \"\"\"is_state() returns false for non-existent entity via WS.\"\"\"\n>       result = await _render_ws(ws, \"{{ is_state('sensor.nope_xyz_99', 'on') }}\")\n\ntests/api/test_template_state_functions.py:186: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nws = <conftest.WSClient object at 0x7f47b0619400>\ntemplate = \"{{ is_state('sensor.nope_xyz_99', 'on') }}\"\n\n    async def _render_ws(ws, template: str) -> str:\n        \"\"\"Render template via WS render_template command.\"\"\"\n        resp = await ws.send_command(\"render_template\", template=template)\n        assert resp[\"success\"] is True\n>       return resp[\"result\"][\"result\"]\nE       TypeError: 'NoneType' object is not subscriptable\n\ntests/api/test_template_state_functions.py:31: TypeError"}, "teardown": {"duration": 0.0007830061949789524, "outcome": "passed"}}, {"nodeid": "tests/api/test_template_state_functions.py::test_ws_state_attr_returns_value", "lineno": 189, "outcome": "failed", "keywords": ["test_ws_state_attr_returns_value", "test_template_state_functions.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.007330591790378094, "outcome": "passed"}, "call": {"duration": 0.003831177018582821, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_template_state_functions.py", "lineno": 31, "message": "TypeError: 'NoneType' object is not subscriptable"}, "traceback": [{"path": "tests/api/test_template_state_functions.py", "lineno": 195, "message": ""}, {"path": "tests/api/test_template_state_functions.py", "lineno": 31, "message": "TypeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b06191c0>\nws = <conftest.WSClient object at 0x7f47b06dbbe0>\n\n    async def test_ws_state_attr_returns_value(rest, ws):\n        \"\"\"state_attr() returns the attribute value via WS.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"sensor.tmpl_sa_{tag}\"\n        await rest.set_state(eid, \"42\", {\"unit\": \"W\"})\n>       result = await _render_ws(ws, \"{{ state_attr('\" + eid + \"', 'unit') }}\")\n\ntests/api/test_template_state_functions.py:195: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nws = <conftest.WSClient object at 0x7f47b06dbbe0>\ntemplate = \"{{ state_attr('sensor.tmpl_sa_4db04523', 'unit') }}\"\n\n    async def _render_ws(ws, template: str) -> str:\n        \"\"\"Render template via WS render_template command.\"\"\"\n        resp = await ws.send_command(\"render_template\", template=template)\n        assert resp[\"success\"] is True\n>       return resp[\"result\"][\"result\"]\nE       TypeError: 'NoneType' object is not subscriptable\n\ntests/api/test_template_state_functions.py:31: TypeError"}, "teardown": {"duration": 0.0011626440100371838, "outcome": "passed"}}, {"nodeid": "tests/api/test_template_state_functions.py::test_ws_state_attr_friendly_name", "lineno": 198, "outcome": "failed", "keywords": ["test_ws_state_attr_friendly_name", "test_template_state_functions.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.0071464343927800655, "outcome": "passed"}, "call": {"duration": 0.004460511263459921, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_template_state_functions.py", "lineno": 31, "message": "TypeError: 'NoneType' object is not subscriptable"}, "traceback": [{"path": "tests/api/test_template_state_functions.py", "lineno": 204, "message": ""}, {"path": "tests/api/test_template_state_functions.py", "lineno": 31, "message": "TypeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b05b1640>\nws = <conftest.WSClient object at 0x7f47b0627e80>\n\n    async def test_ws_state_attr_friendly_name(rest, ws):\n        \"\"\"state_attr() can read friendly_name via WS.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"sensor.tmpl_fn_{tag}\"\n        await rest.set_state(eid, \"55\", {\"friendly_name\": f\"Power {tag}\"})\n>       result = await _render_ws(ws, \"{{ state_attr('\" + eid + \"', 'friendly_name') }}\")\n\ntests/api/test_template_state_functions.py:204: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nws = <conftest.WSClient object at 0x7f47b0627e80>\ntemplate = \"{{ state_attr('sensor.tmpl_fn_bffe84a0', 'friendly_name') }}\"\n\n    async def _render_ws(ws, template: str) -> str:\n        \"\"\"Render template via WS render_template command.\"\"\"\n        resp = await ws.send_command(\"render_template\", template=template)\n        assert resp[\"success\"] is True\n>       return resp[\"result\"][\"result\"]\nE       TypeError: 'NoneType' object is not subscriptable\n\ntests/api/test_template_state_functions.py:31: TypeError"}, "teardown": {"duration": 0.0018358929082751274, "outcome": "passed"}}, {"nodeid": "tests/api/test_template_state_functions.py::test_ws_now_returns_timestamp", "lineno": 207, "outcome": "failed", "keywords": ["test_ws_now_returns_timestamp", "test_template_state_functions.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.006433755625039339, "outcome": "passed"}, "call": {"duration": 0.0015049492940306664, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_template_state_functions.py", "lineno": 31, "message": "TypeError: 'NoneType' object is not subscriptable"}, "traceback": [{"path": "tests/api/test_template_state_functions.py", "lineno": 210, "message": ""}, {"path": "tests/api/test_template_state_functions.py", "lineno": 31, "message": "TypeError"}], "longrepr": "ws = <conftest.WSClient object at 0x7f47b0627910>\n\n    async def test_ws_now_returns_timestamp(ws):\n        \"\"\"now() returns a timestamp-like string via WS.\"\"\"\n>       result = await _render_ws(ws, \"{{ now() }}\")\n\ntests/api/test_template_state_functions.py:210: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nws = <conftest.WSClient object at 0x7f47b0627910>, template = '{{ now() }}'\n\n    async def _render_ws(ws, template: str) -> str:\n        \"\"\"Render template via WS render_template command.\"\"\"\n        resp = await ws.send_command(\"render_template\", template=template)\n        assert resp[\"success\"] is True\n>       return resp[\"result\"][\"result\"]\nE       TypeError: 'NoneType' object is not subscriptable\n\ntests/api/test_template_state_functions.py:31: TypeError"}, "teardown": {"duration": 0.0010335869155824184, "outcome": "passed"}}, {"nodeid": "tests/api/test_template_state_functions.py::test_ws_template_conditional", "lineno": 216, "outcome": "failed", "keywords": ["test_ws_template_conditional", "test_template_state_functions.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.007528641261160374, "outcome": "passed"}, "call": {"duration": 0.003909220919013023, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_template_state_functions.py", "lineno": 31, "message": "TypeError: 'NoneType' object is not subscriptable"}, "traceback": [{"path": "tests/api/test_template_state_functions.py", "lineno": 223, "message": ""}, {"path": "tests/api/test_template_state_functions.py", "lineno": 31, "message": "TypeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0a8f220>\nws = <conftest.WSClient object at 0x7f47b1272a60>\n\n    async def test_ws_template_conditional(rest, ws):\n        \"\"\"Template conditional based on entity state via WS.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"light.tmpl_cond_{tag}\"\n        await rest.set_state(eid, \"on\")\n        template = \"{% if is_state('\" + eid + \"', 'on') %}yes{% else %}no{% endif %}\"\n>       result = await _render_ws(ws, template)\n\ntests/api/test_template_state_functions.py:223: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nws = <conftest.WSClient object at 0x7f47b1272a60>\ntemplate = \"{% if is_state('light.tmpl_cond_17d87dec', 'on') %}yes{% else %}no{% endif %}\"\n\n    async def _render_ws(ws, template: str) -> str:\n        \"\"\"Render template via WS render_template command.\"\"\"\n        resp = await ws.send_command(\"render_template\", template=template)\n        assert resp[\"success\"] is True\n>       return resp[\"result\"][\"result\"]\nE       TypeError: 'NoneType' object is not subscriptable\n\ntests/api/test_template_state_functions.py:31: TypeError"}, "teardown": {"duration": 0.0009447243064641953, "outcome": "passed"}}, {"nodeid": "tests/api/test_template_state_functions.py::test_ws_template_arithmetic", "lineno": 226, "outcome": "failed", "keywords": ["test_ws_template_arithmetic", "test_template_state_functions.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.007471621036529541, "outcome": "passed"}, "call": {"duration": 0.005480022635310888, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_template_state_functions.py", "lineno": 31, "message": "TypeError: 'NoneType' object is not subscriptable"}, "traceback": [{"path": "tests/api/test_template_state_functions.py", "lineno": 233, "message": ""}, {"path": "tests/api/test_template_state_functions.py", "lineno": 31, "message": "TypeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b1a30460>\nws = <conftest.WSClient object at 0x7f47b0649340>\n\n    async def test_ws_template_arithmetic(rest, ws):\n        \"\"\"Template with arithmetic on state value via WS.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"sensor.tmpl_math_{tag}\"\n        await rest.set_state(eid, \"100\")\n        template = \"{{ states('\" + eid + \"') | int * 2 }}\"\n>       result = await _render_ws(ws, template)\n\ntests/api/test_template_state_functions.py:233: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nws = <conftest.WSClient object at 0x7f47b0649340>\ntemplate = \"{{ states('sensor.tmpl_math_65a5d4b9') | int * 2 }}\"\n\n    async def _render_ws(ws, template: str) -> str:\n        \"\"\"Render template via WS render_template command.\"\"\"\n        resp = await ws.send_command(\"render_template\", template=template)\n        assert resp[\"success\"] is True\n>       return resp[\"result\"][\"result\"]\nE       TypeError: 'NoneType' object is not subscriptable\n\ntests/api/test_template_state_functions.py:31: TypeError"}, "teardown": {"duration": 0.0010797902941703796, "outcome": "passed"}}, {"nodeid": "tests/api/test_template_state_functions.py::test_ws_template_float_filter", "lineno": 236, "outcome": "failed", "keywords": ["test_ws_template_float_filter", "test_template_state_functions.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.0077110049314796925, "outcome": "passed"}, "call": {"duration": 0.003732594195753336, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_template_state_functions.py", "lineno": 31, "message": "TypeError: 'NoneType' object is not subscriptable"}, "traceback": [{"path": "tests/api/test_template_state_functions.py", "lineno": 243, "message": ""}, {"path": "tests/api/test_template_state_functions.py", "lineno": 31, "message": "TypeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b11c20d0>\nws = <conftest.WSClient object at 0x7f47b11c25b0>\n\n    async def test_ws_template_float_filter(rest, ws):\n        \"\"\"Template float filter converts state to float via WS.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"sensor.tmpl_flt_{tag}\"\n        await rest.set_state(eid, \"3.14\")\n        template = \"{{ states('\" + eid + \"') | float | round(1) }}\"\n>       result = await _render_ws(ws, template)\n\ntests/api/test_template_state_functions.py:243: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nws = <conftest.WSClient object at 0x7f47b11c25b0>\ntemplate = \"{{ states('sensor.tmpl_flt_8ee77bed') | float | round(1) }}\"\n\n    async def _render_ws(ws, template: str) -> str:\n        \"\"\"Render template via WS render_template command.\"\"\"\n        resp = await ws.send_command(\"render_template\", template=template)\n        assert resp[\"success\"] is True\n>       return resp[\"result\"][\"result\"]\nE       TypeError: 'NoneType' object is not subscriptable\n\ntests/api/test_template_state_functions.py:31: TypeError"}, "teardown": {"duration": 0.0010807150974869728, "outcome": "passed"}}, {"nodeid": "tests/api/test_template_state_functions.py::test_ws_template_default_filter", "lineno": 246, "outcome": "failed", "keywords": ["test_ws_template_default_filter", "test_template_state_functions.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.0028961775824427605, "outcome": "passed"}, "call": {"duration": 0.001045329961925745, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_template_state_functions.py", "lineno": 31, "message": "TypeError: 'NoneType' object is not subscriptable"}, "traceback": [{"path": "tests/api/test_template_state_functions.py", "lineno": 249, "message": ""}, {"path": "tests/api/test_template_state_functions.py", "lineno": 31, "message": "TypeError"}], "longrepr": "ws = <conftest.WSClient object at 0x7f47b1250490>\n\n    async def test_ws_template_default_filter(ws):\n        \"\"\"default filter provides fallback for undefined values via WS.\"\"\"\n>       result = await _render_ws(ws, \"{{ undefined_var | default('fallback') }}\")\n\ntests/api/test_template_state_functions.py:249: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nws = <conftest.WSClient object at 0x7f47b1250490>\ntemplate = \"{{ undefined_var | default('fallback') }}\"\n\n    async def _render_ws(ws, template: str) -> str:\n        \"\"\"Render template via WS render_template command.\"\"\"\n        resp = await ws.send_command(\"render_template\", template=template)\n        assert resp[\"success\"] is True\n>       return resp[\"result\"][\"result\"]\nE       TypeError: 'NoneType' object is not subscriptable\n\ntests/api/test_template_state_functions.py:31: TypeError"}, "teardown": {"duration": 0.0011256649158895016, "outcome": "passed"}}, {"nodeid": "tests/api/test_template_state_functions.py::test_ws_template_lower_upper", "lineno": 252, "outcome": "failed", "keywords": ["test_ws_template_lower_upper", "test_template_state_functions.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.002671619411557913, "outcome": "passed"}, "call": {"duration": 0.0013173758052289486, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_template_state_functions.py", "lineno": 31, "message": "TypeError: 'NoneType' object is not subscriptable"}, "traceback": [{"path": "tests/api/test_template_state_functions.py", "lineno": 255, "message": ""}, {"path": "tests/api/test_template_state_functions.py", "lineno": 31, "message": "TypeError"}], "longrepr": "ws = <conftest.WSClient object at 0x7f47b0545490>\n\n    async def test_ws_template_lower_upper(ws):\n        \"\"\"lower and upper filters work via WS.\"\"\"\n>       result = await _render_ws(ws, \"{{ 'Hello' | lower }}\")\n\ntests/api/test_template_state_functions.py:255: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nws = <conftest.WSClient object at 0x7f47b0545490>\ntemplate = \"{{ 'Hello' | lower }}\"\n\n    async def _render_ws(ws, template: str) -> str:\n        \"\"\"Render template via WS render_template command.\"\"\"\n        resp = await ws.send_command(\"render_template\", template=template)\n        assert resp[\"success\"] is True\n>       return resp[\"result\"][\"result\"]\nE       TypeError: 'NoneType' object is not subscriptable\n\ntests/api/test_template_state_functions.py:31: TypeError"}, "teardown": {"duration": 0.0009713480249047279, "outcome": "passed"}}, {"nodeid": "tests/api/test_ws_comprehensive.py::test_ws_get_services_has_service_names", "lineno": 49, "outcome": "failed", "keywords": ["test_ws_get_services_has_service_names", "test_ws_comprehensive.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.0022956673055887222, "outcome": "passed"}, "call": {"duration": 0.001163627952337265, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_ws_comprehensive.py", "lineno": 54, "message": "TypeError: string indices must be integers"}, "traceback": [{"path": "tests/api/test_ws_comprehensive.py", "lineno": 54, "message": ""}, {"path": "tests/api/test_ws_comprehensive.py", "lineno": 54, "message": "TypeError"}], "longrepr": "ws = <conftest.WSClient object at 0x7f47b07ca700>\n\n    async def test_ws_get_services_has_service_names(ws):\n        \"\"\"get_services includes service names per domain.\"\"\"\n        resp = await ws.send_command(\"get_services\")\n        result = resp[\"result\"]\n>       light = next(e for e in result if e[\"domain\"] == \"light\")\n\ntests/api/test_ws_comprehensive.py:54: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\n.0 = <dict_keyiterator object at 0x7f47b11b5db0>\n\n>   light = next(e for e in result if e[\"domain\"] == \"light\")\nE   TypeError: string indices must be integers\n\ntests/api/test_ws_comprehensive.py:54: TypeError"}, "teardown": {"duration": 0.001083865761756897, "outcome": "passed"}}, {"nodeid": "tests/api/test_ws_comprehensive.py::test_ws_get_notifications", "lineno": 59, "outcome": "failed", "keywords": ["test_ws_get_notifications", "test_ws_comprehensive.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.007476462982594967, "outcome": "passed"}, "call": {"duration": 0.0006245076656341553, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_ws_comprehensive.py", "lineno": 63, "message": "assert False is True"}, "traceback": [{"path": "tests/api/test_ws_comprehensive.py", "lineno": 63, "message": "AssertionError"}], "longrepr": "ws = <conftest.WSClient object at 0x7f47b05528b0>\nrest = <conftest.RESTClient object at 0x7f47b11d3940>\n\n    async def test_ws_get_notifications(ws, rest):\n        \"\"\"WS get_notifications returns notification list.\"\"\"\n        resp = await ws.send_command(\"get_notifications\")\n>       assert resp[\"success\"] is True\nE       assert False is True\n\ntests/api/test_ws_comprehensive.py:63: AssertionError"}, "teardown": {"duration": 0.000967096071690321, "outcome": "passed"}}, {"nodeid": "tests/api/test_ws_comprehensive.py::test_ws_subscribe_and_receive", "lineno": 68, "outcome": "passed", "keywords": ["test_ws_subscribe_and_receive", "test_ws_comprehensive.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.007565625943243504, "outcome": "passed"}, "call": {"duration": 0.0036302600055933, "outcome": "passed"}, "teardown": {"duration": 0.0009700939990580082, "outcome": "passed"}}, {"nodeid": "tests/api/test_ws_comprehensive.py::test_ws_unsubscribe", "lineno": 82, "outcome": "passed", "keywords": ["test_ws_unsubscribe", "test_ws_comprehensive.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.008230078965425491, "outcome": "passed"}, "call": {"duration": 0.5049389828927815, "outcome": "passed"}, "teardown": {"duration": 0.0014795768074691296, "outcome": "passed"}}, {"nodeid": "tests/api/test_ws_comprehensive.py::test_ws_call_service_timer", "lineno": 105, "outcome": "failed", "keywords": ["test_ws_call_service_timer", "test_ws_comprehensive.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.010044900234788656, "outcome": "passed"}, "call": {"duration": 0.004903041757643223, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_ws_comprehensive.py", "lineno": 114, "message": "AssertionError: assert 'idle' == 'active'\n  \n  - active\n  + idle"}, "traceback": [{"path": "tests/api/test_ws_comprehensive.py", "lineno": 114, "message": "AssertionError"}], "longrepr": "ws = <conftest.WSClient object at 0x7f47b0978910>\nrest = <conftest.RESTClient object at 0x7f47b06ff670>\n\n    async def test_ws_call_service_timer(ws, rest):\n        \"\"\"WS call_service timer.start works.\"\"\"\n        await rest.set_state(\"timer.ws_call_test\", \"idle\")\n        resp = await ws.send_command(\"call_service\",\n            domain=\"timer\", service=\"start\",\n            service_data={\"entity_id\": \"timer.ws_call_test\"})\n        assert resp[\"success\"] is True\n        state = await rest.get_state(\"timer.ws_call_test\")\n>       assert state[\"state\"] == \"active\"\nE       AssertionError: assert 'idle' == 'active'\nE         \nE         - active\nE         + idle\n\ntests/api/test_ws_comprehensive.py:114: AssertionError"}, "teardown": {"duration": 0.0011350400745868683, "outcome": "passed"}}, {"nodeid": "tests/api/test_ws_comprehensive.py::test_ws_call_service_counter", "lineno": 116, "outcome": "failed", "keywords": ["test_ws_call_service_counter", "test_ws_comprehensive.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.007592487148940563, "outcome": "passed"}, "call": {"duration": 0.005086253397166729, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_ws_comprehensive.py", "lineno": 125, "message": "AssertionError: assert '0' == '1'\n  \n  - 1\n  + 0"}, "traceback": [{"path": "tests/api/test_ws_comprehensive.py", "lineno": 125, "message": "AssertionError"}], "longrepr": "ws = <conftest.WSClient object at 0x7f47b11dc790>\nrest = <conftest.RESTClient object at 0x7f47b11dc0d0>\n\n    async def test_ws_call_service_counter(ws, rest):\n        \"\"\"WS call_service counter.increment works.\"\"\"\n        await rest.set_state(\"counter.ws_call_test\", \"0\")\n        resp = await ws.send_command(\"call_service\",\n            domain=\"counter\", service=\"increment\",\n            service_data={\"entity_id\": \"counter.ws_call_test\"})\n        assert resp[\"success\"] is True\n        state = await rest.get_state(\"counter.ws_call_test\")\n>       assert state[\"state\"] == \"1\"\nE       AssertionError: assert '0' == '1'\nE         \nE         - 1\nE         + 0\n\ntests/api/test_ws_comprehensive.py:125: AssertionError"}, "teardown": {"duration": 0.0012157810851931572, "outcome": "passed"}}, {"nodeid": "tests/api/test_ws_comprehensive.py::test_ws_render_template_states", "lineno": 129, "outcome": "failed", "keywords": ["test_ws_render_template_states", "test_ws_comprehensive.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.0078705670312047, "outcome": "passed"}, "call": {"duration": 0.003967437893152237, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_ws_comprehensive.py", "lineno": 136, "message": "TypeError: 'NoneType' object is not subscriptable"}, "traceback": [{"path": "tests/api/test_ws_comprehensive.py", "lineno": 136, "message": "TypeError"}], "longrepr": "ws = <conftest.WSClient object at 0x7f47b0a81ee0>\nrest = <conftest.RESTClient object at 0x7f47b0a02130>\n\n    async def test_ws_render_template_states(ws, rest):\n        \"\"\"WS render_template with states() function works.\"\"\"\n        await rest.set_state(\"sensor.ws_tmpl_test\", \"99\")\n        resp = await ws.send_command(\"render_template\",\n            template=\"{{ states('sensor.ws_tmpl_test') }}\")\n        assert resp[\"success\"] is True\n>       assert resp[\"result\"][\"result\"] == \"99\"\nE       TypeError: 'NoneType' object is not subscriptable\n\ntests/api/test_ws_comprehensive.py:136: TypeError"}, "teardown": {"duration": 0.0011112866923213005, "outcome": "passed"}}, {"nodeid": "tests/api/test_ws_comprehensive.py::test_ws_notification_lifecycle", "lineno": 140, "outcome": "failed", "keywords": ["test_ws_notification_lifecycle", "test_ws_comprehensive.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.0027279220521450043, "outcome": "passed"}, "call": {"duration": 0.0010063727386295795, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_ws_comprehensive.py", "lineno": 155, "message": "assert False is True"}, "traceback": [{"path": "tests/api/test_ws_comprehensive.py", "lineno": 155, "message": "AssertionError"}], "longrepr": "ws = <conftest.WSClient object at 0x7f47b12a22b0>\n\n    async def test_ws_notification_lifecycle(ws):\n        \"\"\"WS create, list, dismiss notification.\"\"\"\n        # Create\n        resp = await ws.send_command(\"call_service\",\n            domain=\"persistent_notification\", service=\"create\",\n            service_data={\n                \"notification_id\": \"ws_notif_test\",\n                \"title\": \"Test\",\n                \"message\": \"Hello from WS\",\n            })\n        assert resp[\"success\"] is True\n    \n        # List\n        resp = await ws.send_command(\"get_notifications\")\n>       assert resp[\"success\"] is True\nE       assert False is True\n\ntests/api/test_ws_comprehensive.py:155: AssertionError"}, "teardown": {"duration": 0.0010965131223201752, "outcome": "passed"}}, {"nodeid": "tests/api/test_ws_comprehensive.py::test_mqtt_state_appears_in_rest", "lineno": 174, "outcome": "failed", "keywords": ["test_mqtt_state_appears_in_rest", "test_ws_comprehensive.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005482974927872419, "outcome": "passed"}, "call": {"duration": 1.507392164785415, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_ws_comprehensive.py", "lineno": 182, "message": "assert None is not None"}, "traceback": [{"path": "tests/api/test_ws_comprehensive.py", "lineno": 182, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b097daf0>\n\n    async def test_mqtt_state_appears_in_rest(rest):\n        \"\"\"MQTT publish on home/domain/id/state creates entity in REST.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        mqtt_publish(f\"home/sensor/mqtt_rt_{tag}/state\", \"42\")\n        await asyncio.sleep(0.5)\n    \n        state = await rest.get_state(f\"sensor.mqtt_rt_{tag}\")\n>       assert state is not None\nE       assert None is not None\n\ntests/api/test_ws_comprehensive.py:182: AssertionError"}, "teardown": {"duration": 0.0008638328872621059, "outcome": "passed"}}, {"nodeid": "tests/api/test_ws_comprehensive.py::test_mqtt_state_triggers_ws_event", "lineno": 185, "outcome": "failed", "keywords": ["test_mqtt_state_triggers_ws_event", "test_ws_comprehensive.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.011108535807579756, "outcome": "passed"}, "call": {"duration": 3.005952811334282, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_ws_comprehensive.py", "lineno": 209, "message": "AssertionError: Did not receive state_changed for sensor.mqtt_ws_rt_868fcb38\nassert False"}, "traceback": [{"path": "tests/api/test_ws_comprehensive.py", "lineno": 209, "message": "AssertionError"}], "longrepr": "ws = <conftest.WSClient object at 0x7f47b11e1af0>\nrest = <conftest.RESTClient object at 0x7f47b11b1d60>\n\n    async def test_mqtt_state_triggers_ws_event(ws, rest):\n        \"\"\"MQTT state publish triggers state_changed event on WebSocket.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        entity_id = f\"sensor.mqtt_ws_rt_{tag}\"\n    \n        sub = await ws.send_command(\"subscribe_events\", event_type=\"state_changed\")\n        assert sub.get(\"success\") is True\n        sub_id = sub[\"id\"]\n    \n        mqtt_publish(f\"home/sensor/mqtt_ws_rt_{tag}/state\", \"hello\")\n    \n        found = False\n        for _ in range(50):\n            try:\n                msg = await ws.recv_event(timeout=2.0)\n            except asyncio.TimeoutError:\n                break\n            if msg.get(\"type\") == \"event\":\n                data = msg[\"event\"].get(\"data\", {})\n                if data.get(\"entity_id\") == entity_id:\n                    assert data[\"new_state\"][\"state\"] == \"hello\"\n                    found = True\n                    break\n>       assert found, f\"Did not receive state_changed for {entity_id}\"\nE       AssertionError: Did not receive state_changed for sensor.mqtt_ws_rt_868fcb38\nE       assert False\n\ntests/api/test_ws_comprehensive.py:209: AssertionError"}, "teardown": {"duration": 0.0020103901624679565, "outcome": "passed"}}, {"nodeid": "tests/api/test_ws_comprehensive.py::test_mqtt_update_triggers_ws_with_old_state", "lineno": 213, "outcome": "failed", "keywords": ["test_mqtt_update_triggers_ws_with_old_state", "test_ws_comprehensive.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.01622544089332223, "outcome": "passed"}, "call": {"duration": 4.509060132317245, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_ws_comprehensive.py", "lineno": 242, "message": "assert False"}, "traceback": [{"path": "tests/api/test_ws_comprehensive.py", "lineno": 242, "message": "AssertionError"}], "longrepr": "ws = <conftest.WSClient object at 0x7f47b11b1cd0>\nrest = <conftest.RESTClient object at 0x7f47b054afd0>\n\n    async def test_mqtt_update_triggers_ws_with_old_state(ws, rest):\n        \"\"\"Second MQTT publish includes old_state in WS event.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        entity_id = f\"sensor.mqtt_old_{tag}\"\n    \n        # Create initial state\n        mqtt_publish(f\"home/sensor/mqtt_old_{tag}/state\", \"first\")\n        await asyncio.sleep(0.5)\n    \n        sub = await ws.send_command(\"subscribe_events\", event_type=\"state_changed\")\n        sub_id = sub[\"id\"]\n    \n        mqtt_publish(f\"home/sensor/mqtt_old_{tag}/state\", \"second\")\n    \n        found = False\n        for _ in range(50):\n            try:\n                msg = await ws.recv_event(timeout=2.0)\n            except asyncio.TimeoutError:\n                break\n            if msg.get(\"type\") == \"event\":\n                data = msg[\"event\"].get(\"data\", {})\n                if data.get(\"entity_id\") == entity_id:\n                    assert data[\"old_state\"] is not None\n                    assert data[\"old_state\"][\"state\"] == \"first\"\n                    assert data[\"new_state\"][\"state\"] == \"second\"\n                    found = True\n                    break\n>       assert found\nE       assert False\n\ntests/api/test_ws_comprehensive.py:242: AssertionError"}, "teardown": {"duration": 0.0021157818846404552, "outcome": "passed"}}, {"nodeid": "tests/api/test_ws_comprehensive.py::test_mqtt_multiple_domains", "lineno": 246, "outcome": "failed", "keywords": ["test_mqtt_multiple_domains", "test_ws_comprehensive.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.013490590266883373, "outcome": "passed"}, "call": {"duration": 3.5131746008992195, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_ws_comprehensive.py", "lineno": 256, "message": "assert None is not None"}, "traceback": [{"path": "tests/api/test_ws_comprehensive.py", "lineno": 256, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b07d4a60>\n\n    async def test_mqtt_multiple_domains(rest):\n        \"\"\"MQTT bridge handles multiple domains correctly.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        mqtt_publish(f\"home/sensor/md_{tag}/state\", \"25.0\")\n        mqtt_publish(f\"home/binary_sensor/md_{tag}/state\", \"on\")\n        mqtt_publish(f\"home/switch/md_{tag}/state\", \"off\")\n        await asyncio.sleep(0.5)\n    \n        s1 = await rest.get_state(f\"sensor.md_{tag}\")\n>       assert s1 is not None\nE       assert None is not None\n\ntests/api/test_ws_comprehensive.py:256: AssertionError"}, "teardown": {"duration": 0.0007932372391223907, "outcome": "passed"}}, {"nodeid": "tests/api/test_ws_comprehensive.py::test_mqtt_state_update_preserves_attributes", "lineno": 267, "outcome": "failed", "keywords": ["test_mqtt_state_update_preserves_attributes", "test_ws_comprehensive.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.0064016710966825485, "outcome": "passed"}, "call": {"duration": 1.5101658650673926, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_ws_comprehensive.py", "lineno": 281, "message": "AssertionError: assert '10' == '20'\n  \n  - 20\n  + 10"}, "traceback": [{"path": "tests/api/test_ws_comprehensive.py", "lineno": 281, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b07d4790>\n\n    async def test_mqtt_state_update_preserves_attributes(rest):\n        \"\"\"MQTT state update preserves existing entity attributes.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"sensor.mqtt_attr_{tag}\"\n    \n        # Set via REST with attributes first\n        await rest.set_state(eid, \"10\", {\"unit\": \"C\", \"device_class\": \"temperature\"})\n    \n        # Update via MQTT (state only, no attributes in payload)\n        mqtt_publish(f\"home/sensor/mqtt_attr_{tag}/state\", \"20\")\n        await asyncio.sleep(0.5)\n    \n        state = await rest.get_state(eid)\n>       assert state[\"state\"] == \"20\"\nE       AssertionError: assert '10' == '20'\nE         \nE         - 20\nE         + 10\n\ntests/api/test_ws_comprehensive.py:281: AssertionError"}, "teardown": {"duration": 0.002185744233429432, "outcome": "passed"}}, {"nodeid": "tests/api/test_ws_comprehensive.py::test_mqtt_rapid_updates_all_recorded", "lineno": 285, "outcome": "failed", "keywords": ["test_mqtt_rapid_updates_all_recorded", "test_ws_comprehensive.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.014157953206449747, "outcome": "passed"}, "call": {"duration": 6.022026466205716, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_ws_comprehensive.py", "lineno": 296, "message": "assert None is not None"}, "traceback": [{"path": "tests/api/test_ws_comprehensive.py", "lineno": 296, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b07611c0>\n\n    async def test_mqtt_rapid_updates_all_recorded(rest):\n        \"\"\"Rapid MQTT updates are all recorded in state machine.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"sensor.mqtt_rapid_{tag}\"\n    \n        for i in range(5):\n            mqtt_publish(f\"home/sensor/mqtt_rapid_{tag}/state\", str(i))\n        await asyncio.sleep(1.0)\n    \n        state = await rest.get_state(eid)\n>       assert state is not None\nE       assert None is not None\n\ntests/api/test_ws_comprehensive.py:296: AssertionError"}, "teardown": {"duration": 0.0010391110554337502, "outcome": "passed"}}, {"nodeid": "tests/api/test_ws_comprehensive.py::test_mqtt_bad_topic_ignored[wrong_prefix]", "lineno": 300, "outcome": "passed", "keywords": ["test_mqtt_bad_topic_ignored[wrong_prefix]", "parametrize", "pytestmark", "wrong_prefix", "test_ws_comprehensive.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.008016349747776985, "outcome": "passed"}, "call": {"duration": 1.506389418616891, "outcome": "passed"}, "teardown": {"duration": 0.0005830209702253342, "outcome": "passed"}}, {"nodeid": "tests/api/test_ws_comprehensive.py::test_mqtt_bad_topic_ignored[missing_state_segment]", "lineno": 300, "outcome": "passed", "keywords": ["test_mqtt_bad_topic_ignored[missing_state_segment]", "parametrize", "pytestmark", "missing_state_segment", "test_ws_comprehensive.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005316596943885088, "outcome": "passed"}, "call": {"duration": 1.5080040176399052, "outcome": "passed"}, "teardown": {"duration": 0.0009097498841583729, "outcome": "passed"}}, {"nodeid": "tests/api/test_ws_comprehensive.py::test_parallel_state_sets_10", "lineno": 318, "outcome": "passed", "keywords": ["test_parallel_state_sets_10", "test_ws_comprehensive.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.007786961738020182, "outcome": "passed"}, "call": {"duration": 0.04415997909381986, "outcome": "passed"}, "teardown": {"duration": 0.001458353828638792, "outcome": "passed"}}, {"nodeid": "tests/api/test_ws_comprehensive.py::test_parallel_service_calls", "lineno": 333, "outcome": "failed", "keywords": ["test_parallel_service_calls", "test_ws_comprehensive.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.007335487753152847, "outcome": "passed"}, "call": {"duration": 0.032549267169088125, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/light/turn_on'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/api/test_ws_comprehensive.py", "lineno": 345, "message": ""}, {"path": "tests/api/test_ws_comprehensive.py", "lineno": 343, "message": "in turn_on"}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b05a8490>\n\n    async def test_parallel_service_calls(rest):\n        \"\"\"10 parallel service calls all succeed.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        entities = [f\"light.par_svc_{tag}_{i}\" for i in range(10)]\n    \n        for eid in entities:\n            await rest.set_state(eid, \"off\")\n    \n        async def turn_on(eid):\n            await rest.call_service(\"light\", \"turn_on\", {\"entity_id\": eid})\n    \n>       await asyncio.gather(*[turn_on(eid) for eid in entities])\n\ntests/api/test_ws_comprehensive.py:345: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/api/test_ws_comprehensive.py:343: in turn_on\n    await rest.call_service(\"light\", \"turn_on\", {\"entity_id\": eid})\ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/light/turn_on'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0029747080989181995, "outcome": "passed"}}, {"nodeid": "tests/api/test_ws_comprehensive.py::test_concurrent_get_endpoint[get_states]", "lineno": 350, "outcome": "passed", "keywords": ["test_concurrent_get_endpoint[get_states]", "parametrize", "pytestmark", "get_states", "test_ws_comprehensive.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.0005549662746489048, "outcome": "passed"}, "call": {"duration": 0.01555546885356307, "outcome": "passed"}, "teardown": {"duration": 0.0004081558436155319, "outcome": "passed"}}, {"nodeid": "tests/api/test_ws_comprehensive.py::test_concurrent_get_endpoint[health_checks]", "lineno": 350, "outcome": "failed", "keywords": ["test_concurrent_get_endpoint[health_checks]", "parametrize", "pytestmark", "health_checks", "test_ws_comprehensive.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.0005491748452186584, "outcome": "passed"}, "call": {"duration": 0.020563636906445026, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_ws_comprehensive.py", "lineno": 366, "message": "assert 404 == 200\n +  where 404 = <Response [404 Not Found]>.status_code"}, "traceback": [{"path": "tests/api/test_ws_comprehensive.py", "lineno": 366, "message": "AssertionError"}], "longrepr": "path = '/api/health', params = None, count = 10\n\n    @pytest.mark.parametrize(\"path,params,count\", [\n        (\"/api/states\", None, 5),\n        (\"/api/health\", None, 10),\n        (\"/api/states/search\", {\"domain\": \"light\"}, 5),\n    ], ids=[\"get_states\", \"health_checks\", \"search_requests\"])\n    async def test_concurrent_get_endpoint(path, params, count):\n        \"\"\"Concurrent GET requests to the same endpoint all succeed.\"\"\"\n        async with httpx.AsyncClient() as c:\n            tasks = [\n                c.get(f\"{_SUT_URL}{path}\", params=params, headers=_HEADERS)\n                for _ in range(count)\n            ]\n            results = await asyncio.gather(*tasks)\n    \n        for r in results:\n>           assert r.status_code == 200\nE           assert 404 == 200\nE            +  where 404 = <Response [404 Not Found]>.status_code\n\ntests/api/test_ws_comprehensive.py:366: AssertionError"}, "teardown": {"duration": 0.0005812961608171463, "outcome": "passed"}}, {"nodeid": "tests/api/test_ws_comprehensive.py::test_concurrent_get_endpoint[search_requests]", "lineno": 350, "outcome": "failed", "keywords": ["test_concurrent_get_endpoint[search_requests]", "parametrize", "pytestmark", "search_requests", "test_ws_comprehensive.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.0005407966673374176, "outcome": "passed"}, "call": {"duration": 0.013380274176597595, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_ws_comprehensive.py", "lineno": 366, "message": "assert 404 == 200\n +  where 404 = <Response [404 Not Found]>.status_code"}, "traceback": [{"path": "tests/api/test_ws_comprehensive.py", "lineno": 366, "message": "AssertionError"}], "longrepr": "path = '/api/states/search', params = {'domain': 'light'}, count = 5\n\n    @pytest.mark.parametrize(\"path,params,count\", [\n        (\"/api/states\", None, 5),\n        (\"/api/health\", None, 10),\n        (\"/api/states/search\", {\"domain\": \"light\"}, 5),\n    ], ids=[\"get_states\", \"health_checks\", \"search_requests\"])\n    async def test_concurrent_get_endpoint(path, params, count):\n        \"\"\"Concurrent GET requests to the same endpoint all succeed.\"\"\"\n        async with httpx.AsyncClient() as c:\n            tasks = [\n                c.get(f\"{_SUT_URL}{path}\", params=params, headers=_HEADERS)\n                for _ in range(count)\n            ]\n            results = await asyncio.gather(*tasks)\n    \n        for r in results:\n>           assert r.status_code == 200\nE           assert 404 == 200\nE            +  where 404 = <Response [404 Not Found]>.status_code\n\ntests/api/test_ws_comprehensive.py:366: AssertionError"}, "teardown": {"duration": 0.00048776622861623764, "outcome": "passed"}}, {"nodeid": "tests/api/test_ws_comprehensive.py::test_mixed_read_write_concurrent", "lineno": 368, "outcome": "passed", "keywords": ["test_mixed_read_write_concurrent", "test_ws_comprehensive.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005764686968177557, "outcome": "passed"}, "call": {"duration": 0.07210594974458218, "outcome": "passed"}, "teardown": {"duration": 0.0008148378692567348, "outcome": "passed"}}, {"nodeid": "tests/api/test_ws_comprehensive.py::test_concurrent_template_renders", "lineno": 392, "outcome": "passed", "keywords": ["test_concurrent_template_renders", "test_ws_comprehensive.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.0006378479301929474, "outcome": "passed"}, "call": {"duration": 0.018887612037360668, "outcome": "passed"}, "teardown": {"duration": 0.00041039520874619484, "outcome": "passed"}}, {"nodeid": "tests/api/test_ws_registries.py::test_ws_ping_multiple", "lineno": 17, "outcome": "passed", "keywords": ["test_ws_ping_multiple", "test_ws_registries.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.0027319127693772316, "outcome": "passed"}, "call": {"duration": 0.001085866242647171, "outcome": "passed"}, "teardown": {"duration": 0.0007039238698780537, "outcome": "passed"}}, {"nodeid": "tests/api/test_ws_registries.py::test_ws_area_registry_list", "lineno": 25, "outcome": "passed", "keywords": ["test_ws_area_registry_list", "test_ws_registries.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.002386996056884527, "outcome": "passed"}, "call": {"duration": 0.0006555849686264992, "outcome": "passed"}, "teardown": {"duration": 0.0008021509274840355, "outcome": "passed"}}, {"nodeid": "tests/api/test_ws_registries.py::test_ws_area_registry_create", "lineno": 32, "outcome": "failed", "keywords": ["test_ws_area_registry_create", "test_ws_registries.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.0026030046865344048, "outcome": "passed"}, "call": {"duration": 0.0010672686621546745, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_ws_registries.py", "lineno": 40, "message": "assert False is True"}, "traceback": [{"path": "tests/api/test_ws_registries.py", "lineno": 40, "message": "AssertionError"}], "longrepr": "ws = <conftest.WSClient object at 0x7f47b0696310>\n\n    async def test_ws_area_registry_create(ws):\n        \"\"\"config/area_registry/create adds a new area.\"\"\"\n        result = await ws.send_command(\n            \"config/area_registry/create\",\n            area_id=\"ws_test_area\",\n            name=\"WS Test Area\",\n        )\n>       assert result[\"success\"] is True\nE       assert False is True\n\ntests/api/test_ws_registries.py:40: AssertionError"}, "teardown": {"duration": 0.0010511549189686775, "outcome": "passed"}}, {"nodeid": "tests/api/test_ws_registries.py::test_ws_area_registry_update", "lineno": 47, "outcome": "failed", "keywords": ["test_ws_area_registry_update", "test_ws_registries.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.002485813107341528, "outcome": "passed"}, "call": {"duration": 0.0026088571175932884, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_ws_registries.py", "lineno": 63, "message": "assert False is True"}, "traceback": [{"path": "tests/api/test_ws_registries.py", "lineno": 63, "message": "AssertionError"}], "longrepr": "ws = <conftest.WSClient object at 0x7f47b0792f70>\n\n    async def test_ws_area_registry_update(ws):\n        \"\"\"config/area_registry/update renames an area.\"\"\"\n        # Create first\n        await ws.send_command(\n            \"config/area_registry/create\",\n            area_id=\"ws_update_area\",\n            name=\"Before\",\n        )\n    \n        # Update\n        result = await ws.send_command(\n            \"config/area_registry/update\",\n            area_id=\"ws_update_area\",\n            name=\"After\",\n        )\n>       assert result[\"success\"] is True\nE       assert False is True\n\ntests/api/test_ws_registries.py:63: AssertionError"}, "teardown": {"duration": 0.0010956008918583393, "outcome": "passed"}}, {"nodeid": "tests/api/test_ws_registries.py::test_ws_area_registry_delete", "lineno": 70, "outcome": "failed", "keywords": ["test_ws_area_registry_delete", "test_ws_registries.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.0024582399055361748, "outcome": "passed"}, "call": {"duration": 0.0010855146683752537, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_ws_registries.py", "lineno": 83, "message": "assert False is True"}, "traceback": [{"path": "tests/api/test_ws_registries.py", "lineno": 83, "message": "AssertionError"}], "longrepr": "ws = <conftest.WSClient object at 0x7f47b07ee5e0>\n\n    async def test_ws_area_registry_delete(ws):\n        \"\"\"config/area_registry/delete removes an area.\"\"\"\n        await ws.send_command(\n            \"config/area_registry/create\",\n            area_id=\"ws_del_area\",\n            name=\"Delete Me\",\n        )\n    \n        result = await ws.send_command(\n            \"config/area_registry/delete\",\n            area_id=\"ws_del_area\",\n        )\n>       assert result[\"success\"] is True\nE       assert False is True\n\ntests/api/test_ws_registries.py:83: AssertionError"}, "teardown": {"duration": 0.0009002680890262127, "outcome": "passed"}}, {"nodeid": "tests/api/test_ws_registries.py::test_ws_area_create_empty_fails", "lineno": 89, "outcome": "passed", "keywords": ["test_ws_area_create_empty_fails", "test_ws_registries.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.002443085890263319, "outcome": "passed"}, "call": {"duration": 0.0009972075931727886, "outcome": "passed"}, "teardown": {"duration": 0.0008660880848765373, "outcome": "passed"}}, {"nodeid": "tests/api/test_ws_registries.py::test_ws_area_registry_create_missing_fields", "lineno": 99, "outcome": "passed", "keywords": ["test_ws_area_registry_create_missing_fields", "test_ws_registries.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.002522809896618128, "outcome": "passed"}, "call": {"duration": 0.0007738200947642326, "outcome": "passed"}, "teardown": {"duration": 0.000724367331713438, "outcome": "passed"}}, {"nodeid": "tests/api/test_ws_registries.py::test_ws_area_create_missing_id", "lineno": 108, "outcome": "passed", "keywords": ["test_ws_area_create_missing_id", "test_ws_registries.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.0023665092885494232, "outcome": "passed"}, "call": {"duration": 0.0005453256890177727, "outcome": "passed"}, "teardown": {"duration": 0.0006928341463208199, "outcome": "passed"}}, {"nodeid": "tests/api/test_ws_registries.py::test_ws_area_create_list_delete_roundtrip", "lineno": 115, "outcome": "failed", "keywords": ["test_ws_area_create_list_delete_roundtrip", "test_ws_registries.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.0023449361324310303, "outcome": "passed"}, "call": {"duration": 0.0008287378586828709, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_ws_registries.py", "lineno": 127, "message": "assert False is True\n +  where False = <built-in method get of dict object at 0x7f47b0ef1380>('success', False)\n +    where <built-in method get of dict object at 0x7f47b0ef1380> = {'error': {'code': 'invalid_format', 'message': \"extra keys not allowed @ data['area_id']. Got 'wsrt_0cbfdffe'\"}, 'id': 1, 'success': False, 'type': 'result'}.get"}, "traceback": [{"path": "tests/api/test_ws_registries.py", "lineno": 127, "message": "AssertionError"}], "longrepr": "ws = <conftest.WSClient object at 0x7f47b0625790>\n\n    async def test_ws_area_create_list_delete_roundtrip(ws):\n        \"\"\"Full area CRUD roundtrip via WS (uuid-isolated).\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        aid = f\"wsrt_{tag}\"\n    \n        # Create\n        r1 = await ws.send_command(\n            \"config/area_registry/create\",\n            area_id=aid,\n            name=f\"Roundtrip {tag}\",\n        )\n>       assert r1.get(\"success\", False) is True\nE       assert False is True\nE        +  where False = <built-in method get of dict object at 0x7f47b0ef1380>('success', False)\nE        +    where <built-in method get of dict object at 0x7f47b0ef1380> = {'error': {'code': 'invalid_format', 'message': \"extra keys not allowed @ data['area_id']. Got 'wsrt_0cbfdffe'\"}, 'id': 1, 'success': False, 'type': 'result'}.get\n\ntests/api/test_ws_registries.py:127: AssertionError"}, "teardown": {"duration": 0.001032013911753893, "outcome": "passed"}}, {"nodeid": "tests/api/test_ws_registries.py::test_ws_device_registry_list", "lineno": 151, "outcome": "passed", "keywords": ["test_ws_device_registry_list", "test_ws_registries.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.0025237207300961018, "outcome": "passed"}, "call": {"duration": 0.0005652341060340405, "outcome": "passed"}, "teardown": {"duration": 0.0006974181160330772, "outcome": "passed"}}, {"nodeid": "tests/api/test_ws_registries.py::test_ws_device_registry_entry_format", "lineno": 158, "outcome": "passed", "keywords": ["test_ws_device_registry_entry_format", "test_ws_registries.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.0023331469856202602, "outcome": "passed"}, "call": {"duration": 0.0005583758465945721, "outcome": "passed"}, "teardown": {"duration": 0.0007018162868916988, "outcome": "passed"}}, {"nodeid": "tests/api/test_ws_registries.py::test_ws_label_registry_list", "lineno": 170, "outcome": "passed", "keywords": ["test_ws_label_registry_list", "test_ws_registries.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.0022402149625122547, "outcome": "passed"}, "call": {"duration": 0.0005216482095420361, "outcome": "passed"}, "teardown": {"duration": 0.0006857430562376976, "outcome": "passed"}}, {"nodeid": "tests/api/test_ws_registries.py::test_ws_label_registry_create", "lineno": 177, "outcome": "failed", "keywords": ["test_ws_label_registry_create", "test_ws_registries.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.002534504048526287, "outcome": "passed"}, "call": {"duration": 0.0009198789484798908, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_ws_registries.py", "lineno": 186, "message": "assert False is True"}, "traceback": [{"path": "tests/api/test_ws_registries.py", "lineno": 186, "message": "AssertionError"}], "longrepr": "ws = <conftest.WSClient object at 0x7f47b053ffd0>\n\n    async def test_ws_label_registry_create(ws):\n        \"\"\"config/label_registry/create adds a label.\"\"\"\n        result = await ws.send_command(\n            \"config/label_registry/create\",\n            label_id=\"ws_test_label\",\n            name=\"WS Label\",\n            color=\"#ff0000\",\n        )\n>       assert result[\"success\"] is True\nE       assert False is True\n\ntests/api/test_ws_registries.py:186: AssertionError"}, "teardown": {"duration": 0.0008914782665669918, "outcome": "passed"}}, {"nodeid": "tests/api/test_ws_registries.py::test_ws_label_registry_delete", "lineno": 192, "outcome": "failed", "keywords": ["test_ws_label_registry_delete", "test_ws_registries.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.0025293901562690735, "outcome": "passed"}, "call": {"duration": 0.0011695288121700287, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_ws_registries.py", "lineno": 206, "message": "assert False is True"}, "traceback": [{"path": "tests/api/test_ws_registries.py", "lineno": 206, "message": "AssertionError"}], "longrepr": "ws = <conftest.WSClient object at 0x7f47b12b9820>\n\n    async def test_ws_label_registry_delete(ws):\n        \"\"\"config/label_registry/delete removes a label.\"\"\"\n        await ws.send_command(\n            \"config/label_registry/create\",\n            label_id=\"ws_del_label\",\n            name=\"Del Label\",\n            color=\"#000\",\n        )\n    \n        result = await ws.send_command(\n            \"config/label_registry/delete\",\n            label_id=\"ws_del_label\",\n        )\n>       assert result[\"success\"] is True\nE       assert False is True\n\ntests/api/test_ws_registries.py:206: AssertionError"}, "teardown": {"duration": 0.0010197777301073074, "outcome": "passed"}}, {"nodeid": "tests/api/test_ws_registries.py::test_ws_label_create_empty_fails", "lineno": 212, "outcome": "passed", "keywords": ["test_ws_label_create_empty_fails", "test_ws_registries.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.0031336890533566475, "outcome": "passed"}, "call": {"duration": 0.0007782541215419769, "outcome": "passed"}, "teardown": {"duration": 0.0007348218932747841, "outcome": "passed"}}, {"nodeid": "tests/api/test_ws_registries.py::test_ws_label_registry_missing_fields", "lineno": 222, "outcome": "passed", "keywords": ["test_ws_label_registry_missing_fields", "test_ws_registries.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.002173472661525011, "outcome": "passed"}, "call": {"duration": 0.0007193391211330891, "outcome": "passed"}, "teardown": {"duration": 0.0007674410007894039, "outcome": "passed"}}, {"nodeid": "tests/api/test_ws_registries.py::test_ws_label_create_list_delete_roundtrip", "lineno": 231, "outcome": "failed", "keywords": ["test_ws_label_create_list_delete_roundtrip", "test_ws_registries.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.002125263214111328, "outcome": "passed"}, "call": {"duration": 0.0008694329299032688, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_ws_registries.py", "lineno": 244, "message": "assert False is True\n +  where False = <built-in method get of dict object at 0x7f47b0f29e80>('success', False)\n +    where <built-in method get of dict object at 0x7f47b0f29e80> = {'error': {'code': 'invalid_format', 'message': \"extra keys not allowed @ data['label_id']. Got 'wslrt_e78de0fd'\"}, 'id': 1, 'success': False, 'type': 'result'}.get"}, "traceback": [{"path": "tests/api/test_ws_registries.py", "lineno": 244, "message": "AssertionError"}], "longrepr": "ws = <conftest.WSClient object at 0x7f47b05a8df0>\n\n    async def test_ws_label_create_list_delete_roundtrip(ws):\n        \"\"\"Full label CRUD roundtrip via WS (uuid-isolated).\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        lid = f\"wslrt_{tag}\"\n    \n        # Create\n        r1 = await ws.send_command(\n            \"config/label_registry/create\",\n            label_id=lid,\n            name=f\"Label {tag}\",\n            color=\"green\",\n        )\n>       assert r1.get(\"success\", False) is True\nE       assert False is True\nE        +  where False = <built-in method get of dict object at 0x7f47b0f29e80>('success', False)\nE        +    where <built-in method get of dict object at 0x7f47b0f29e80> = {'error': {'code': 'invalid_format', 'message': \"extra keys not allowed @ data['label_id']. Got 'wslrt_e78de0fd'\"}, 'id': 1, 'success': False, 'type': 'result'}.get\n\ntests/api/test_ws_registries.py:244: AssertionError"}, "teardown": {"duration": 0.0009803688153624535, "outcome": "passed"}}, {"nodeid": "tests/api/test_ws_registries.py::test_ws_entity_registry_list", "lineno": 261, "outcome": "passed", "keywords": ["test_ws_entity_registry_list", "test_ws_registries.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.0024273181334137917, "outcome": "passed"}, "call": {"duration": 0.0008045770227909088, "outcome": "passed"}, "teardown": {"duration": 0.0006441278383135796, "outcome": "passed"}}, {"nodeid": "tests/api/test_ws_registries.py::test_ws_entity_registry_entry_fields", "lineno": 271, "outcome": "failed", "keywords": ["test_ws_entity_registry_entry_fields", "test_ws_registries.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.0075423987582325935, "outcome": "passed"}, "call": {"duration": 0.0033236597664654255, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_ws_registries.py", "lineno": 278, "message": "assert None is not None"}, "traceback": [{"path": "tests/api/test_ws_registries.py", "lineno": 278, "message": "AssertionError"}], "longrepr": "ws = <conftest.WSClient object at 0x7f47b0724400>\nrest = <conftest.RESTClient object at 0x7f47b06601c0>\n\n    async def test_ws_entity_registry_entry_fields(ws, rest):\n        \"\"\"Entity registry entries have expected name and platform fields.\"\"\"\n        await rest.set_state(\"sensor.ws_reg_fields\", \"10\", {\"friendly_name\": \"Test Sensor\"})\n        result = await ws.send_command(\"config/entity_registry/list\")\n        assert result[\"success\"] is True\n        entry = next((e for e in result[\"result\"] if e[\"entity_id\"] == \"sensor.ws_reg_fields\"), None)\n>       assert entry is not None\nE       assert None is not None\n\ntests/api/test_ws_registries.py:278: AssertionError"}, "teardown": {"duration": 0.0009484388865530491, "outcome": "passed"}}, {"nodeid": "tests/api/test_ws_registries.py::test_ws_entity_registry_field_value[disabled_by-None]", "lineno": 282, "outcome": "failed", "keywords": ["test_ws_entity_registry_field_value[disabled_by-None]", "parametrize", "pytestmark", "disabled_by-None", "test_ws_registries.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.00788642605766654, "outcome": "passed"}, "call": {"duration": 0.003385500982403755, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_ws_registries.py", "lineno": 296, "message": "assert 0 == 1\n +  where 0 = len([])"}, "traceback": [{"path": "tests/api/test_ws_registries.py", "lineno": 296, "message": "AssertionError"}], "longrepr": "ws = <conftest.WSClient object at 0x7f47b11c2190>\nrest = <conftest.RESTClient object at 0x7f47b11c2a30>, field = 'disabled_by'\nexpected = None\n\n    @pytest.mark.parametrize(\"field,expected\", [\n        (\"disabled_by\", None),\n        (\"platform\", \"mqtt\"),\n    ])\n    async def test_ws_entity_registry_field_value(ws, rest, field, expected):\n        \"\"\"Entity registry entries have correct default field values.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"sensor.wsfld_{tag}\"\n        await rest.set_state(eid, \"val\")\n    \n        resp = await ws.send_command(\"config/entity_registry/list\")\n        entries = resp[\"result\"]\n        found = [e for e in entries if e[\"entity_id\"] == eid]\n>       assert len(found) == 1\nE       assert 0 == 1\nE        +  where 0 = len([])\n\ntests/api/test_ws_registries.py:296: AssertionError"}, "teardown": {"duration": 0.001061942894011736, "outcome": "passed"}}, {"nodeid": "tests/api/test_ws_registries.py::test_ws_entity_registry_field_value[platform-mqtt]", "lineno": 282, "outcome": "failed", "keywords": ["test_ws_entity_registry_field_value[platform-mqtt]", "parametrize", "pytestmark", "platform-mqtt", "test_ws_registries.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.007811947725713253, "outcome": "passed"}, "call": {"duration": 0.003655101638287306, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_ws_registries.py", "lineno": 296, "message": "assert 0 == 1\n +  where 0 = len([])"}, "traceback": [{"path": "tests/api/test_ws_registries.py", "lineno": 296, "message": "AssertionError"}], "longrepr": "ws = <conftest.WSClient object at 0x7f47b08320a0>\nrest = <conftest.RESTClient object at 0x7f47b1085c70>, field = 'platform'\nexpected = 'mqtt'\n\n    @pytest.mark.parametrize(\"field,expected\", [\n        (\"disabled_by\", None),\n        (\"platform\", \"mqtt\"),\n    ])\n    async def test_ws_entity_registry_field_value(ws, rest, field, expected):\n        \"\"\"Entity registry entries have correct default field values.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"sensor.wsfld_{tag}\"\n        await rest.set_state(eid, \"val\")\n    \n        resp = await ws.send_command(\"config/entity_registry/list\")\n        entries = resp[\"result\"]\n        found = [e for e in entries if e[\"entity_id\"] == eid]\n>       assert len(found) == 1\nE       assert 0 == 1\nE        +  where 0 = len([])\n\ntests/api/test_ws_registries.py:296: AssertionError"}, "teardown": {"duration": 0.001223175786435604, "outcome": "passed"}}, {"nodeid": "tests/api/test_ws_registries.py::test_ws_entity_registry_update_name", "lineno": 300, "outcome": "failed", "keywords": ["test_ws_entity_registry_update_name", "test_ws_registries.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.007939621340483427, "outcome": "passed"}, "call": {"duration": 0.0034866249188780785, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_ws_registries.py", "lineno": 310, "message": "assert False is True"}, "traceback": [{"path": "tests/api/test_ws_registries.py", "lineno": 310, "message": "AssertionError"}], "longrepr": "ws = <conftest.WSClient object at 0x7f47b08d9be0>\nrest = <conftest.RESTClient object at 0x7f47b07dd910>\n\n    async def test_ws_entity_registry_update_name(ws, rest):\n        \"\"\"config/entity_registry/update renames an entity.\"\"\"\n        await rest.set_state(\"sensor.ws_rename_test\", \"42\", {\"friendly_name\": \"Old Name\"})\n    \n        result = await ws.send_command(\n            \"config/entity_registry/update\",\n            entity_id=\"sensor.ws_rename_test\",\n            name=\"New Name\",\n        )\n>       assert result[\"success\"] is True\nE       assert False is True\n\ntests/api/test_ws_registries.py:310: AssertionError"}, "teardown": {"duration": 0.0011920942924916744, "outcome": "passed"}}, {"nodeid": "tests/api/test_ws_registries.py::test_ws_entity_registry_update_icon", "lineno": 316, "outcome": "failed", "keywords": ["test_ws_entity_registry_update_icon", "test_ws_registries.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.007627489045262337, "outcome": "passed"}, "call": {"duration": 0.0037401411682367325, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_ws_registries.py", "lineno": 326, "message": "assert False is True"}, "traceback": [{"path": "tests/api/test_ws_registries.py", "lineno": 326, "message": "AssertionError"}], "longrepr": "ws = <conftest.WSClient object at 0x7f47b06195b0>\nrest = <conftest.RESTClient object at 0x7f47b12b97c0>\n\n    async def test_ws_entity_registry_update_icon(ws, rest):\n        \"\"\"config/entity_registry/update sets icon attribute.\"\"\"\n        await rest.set_state(\"sensor.ws_icon_test\", \"50\")\n    \n        result = await ws.send_command(\n            \"config/entity_registry/update\",\n            entity_id=\"sensor.ws_icon_test\",\n            icon=\"mdi:thermometer\",\n        )\n>       assert result[\"success\"] is True\nE       assert False is True\n\ntests/api/test_ws_registries.py:326: AssertionError"}, "teardown": {"duration": 0.0013553677126765251, "outcome": "passed"}}, {"nodeid": "tests/api/test_ws_registries.py::test_ws_entity_update_name_and_icon", "lineno": 331, "outcome": "failed", "keywords": ["test_ws_entity_update_name_and_icon", "test_ws_registries.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.007939429953694344, "outcome": "passed"}, "call": {"duration": 0.0036334930919110775, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_ws_registries.py", "lineno": 344, "message": "AssertionError: assert False is True\n +  where False = <built-in method get of dict object at 0x7f47b1007c40>('success', False)\n +    where <built-in method get of dict object at 0x7f47b1007c40> = {'error': {'code': 'not_found', 'message': 'Entity not found'}, 'id': 1, 'success': False, 'type': 'result'}.get"}, "traceback": [{"path": "tests/api/test_ws_registries.py", "lineno": 344, "message": "AssertionError"}], "longrepr": "ws = <conftest.WSClient object at 0x7f47b09b69d0>\nrest = <conftest.RESTClient object at 0x7f47b09b6a30>\n\n    async def test_ws_entity_update_name_and_icon(ws, rest):\n        \"\"\"Update both name and icon in single WS command.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"sensor.wsupd_{tag}\"\n        await rest.set_state(eid, \"val\")\n    \n        resp = await ws.send_command(\n            \"config/entity_registry/update\",\n            entity_id=eid,\n            name=\"Updated Name\",\n            icon=\"mdi:lightbulb\",\n        )\n>       assert resp.get(\"success\", False) is True\nE       AssertionError: assert False is True\nE        +  where False = <built-in method get of dict object at 0x7f47b1007c40>('success', False)\nE        +    where <built-in method get of dict object at 0x7f47b1007c40> = {'error': {'code': 'not_found', 'message': 'Entity not found'}, 'id': 1, 'success': False, 'type': 'result'}.get\n\ntests/api/test_ws_registries.py:344: AssertionError"}, "teardown": {"duration": 0.0010749828070402145, "outcome": "passed"}}, {"nodeid": "tests/api/test_ws_registries.py::test_ws_entity_update_area_assignment", "lineno": 350, "outcome": "failed", "keywords": ["test_ws_entity_update_area_assignment", "test_ws_registries.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.007707132957875729, "outcome": "passed"}, "call": {"duration": 0.004055390600115061, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_ws_registries.py", "lineno": 372, "message": "AssertionError: assert False is True\n +  where False = <built-in method get of dict object at 0x7f47b1007480>('success', False)\n +    where <built-in method get of dict object at 0x7f47b1007480> = {'error': {'code': 'not_found', 'message': 'Entity not found'}, 'id': 2, 'success': False, 'type': 'result'}.get"}, "traceback": [{"path": "tests/api/test_ws_registries.py", "lineno": 372, "message": "AssertionError"}], "longrepr": "ws = <conftest.WSClient object at 0x7f47b09b6b20>\nrest = <conftest.RESTClient object at 0x7f47b0870c40>\n\n    async def test_ws_entity_update_area_assignment(ws, rest):\n        \"\"\"Entity registry update with area_id assigns entity to area.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"sensor.wsarea_{tag}\"\n        aid = f\"area_ws_{tag}\"\n    \n        await rest.set_state(eid, \"val\")\n    \n        # Create area first\n        await ws.send_command(\n            \"config/area_registry/create\",\n            area_id=aid,\n            name=f\"Room {tag}\",\n        )\n    \n        # Assign entity to area\n        resp = await ws.send_command(\n            \"config/entity_registry/update\",\n            entity_id=eid,\n            area_id=aid,\n        )\n>       assert resp.get(\"success\", False) is True\nE       AssertionError: assert False is True\nE        +  where False = <built-in method get of dict object at 0x7f47b1007480>('success', False)\nE        +    where <built-in method get of dict object at 0x7f47b1007480> = {'error': {'code': 'not_found', 'message': 'Entity not found'}, 'id': 2, 'success': False, 'type': 'result'}.get\n\ntests/api/test_ws_registries.py:372: AssertionError"}, "teardown": {"duration": 0.0011001499369740486, "outcome": "passed"}}, {"nodeid": "tests/api/test_ws_registries.py::test_ws_entity_update_clear_area", "lineno": 374, "outcome": "failed", "keywords": ["test_ws_entity_update_clear_area", "test_ws_registries.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.00784554285928607, "outcome": "passed"}, "call": {"duration": 0.0038951952010393143, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_ws_registries.py", "lineno": 399, "message": "AssertionError: assert False is True\n +  where False = <built-in method get of dict object at 0x7f47b0fedd40>('success', False)\n +    where <built-in method get of dict object at 0x7f47b0fedd40> = {'error': {'code': 'not_found', 'message': 'Entity not found'}, 'id': 3, 'success': False, 'type': 'result'}.get"}, "traceback": [{"path": "tests/api/test_ws_registries.py", "lineno": 399, "message": "AssertionError"}], "longrepr": "ws = <conftest.WSClient object at 0x7f47b0f3b610>\nrest = <conftest.RESTClient object at 0x7f47b11dcbe0>\n\n    async def test_ws_entity_update_clear_area(ws, rest):\n        \"\"\"Clearing area_id unassigns entity from area.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"sensor.wsunarea_{tag}\"\n        aid = f\"area_wsun_{tag}\"\n    \n        await rest.set_state(eid, \"val\")\n        await ws.send_command(\n            \"config/area_registry/create\",\n            area_id=aid,\n            name=f\"Room {tag}\",\n        )\n        await ws.send_command(\n            \"config/entity_registry/update\",\n            entity_id=eid,\n            area_id=aid,\n        )\n    \n        # Clear area\n        resp = await ws.send_command(\n            \"config/entity_registry/update\",\n            entity_id=eid,\n            area_id=\"\",\n        )\n>       assert resp.get(\"success\", False) is True\nE       AssertionError: assert False is True\nE        +  where False = <built-in method get of dict object at 0x7f47b0fedd40>('success', False)\nE        +    where <built-in method get of dict object at 0x7f47b0fedd40> = {'error': {'code': 'not_found', 'message': 'Entity not found'}, 'id': 3, 'success': False, 'type': 'result'}.get\n\ntests/api/test_ws_registries.py:399: AssertionError"}, "teardown": {"duration": 0.000995430164039135, "outcome": "passed"}}, {"nodeid": "tests/api/test_ws_registries.py::test_ws_entity_update_preserves_state", "lineno": 401, "outcome": "failed", "keywords": ["test_ws_entity_update_preserves_state", "test_ws_registries.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.00742019759491086, "outcome": "passed"}, "call": {"duration": 0.0042175911366939545, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_ws_registries.py", "lineno": 417, "message": "KeyError: 'friendly_name'"}, "traceback": [{"path": "tests/api/test_ws_registries.py", "lineno": 417, "message": "KeyError"}], "longrepr": "ws = <conftest.WSClient object at 0x7f47b09b6c70>\nrest = <conftest.RESTClient object at 0x7f47b09b6f40>\n\n    async def test_ws_entity_update_preserves_state(ws, rest):\n        \"\"\"Entity registry update preserves entity state value.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"sensor.wspres_{tag}\"\n        await rest.set_state(eid, \"important_value\", {\"existing_attr\": 42})\n    \n        await ws.send_command(\n            \"config/entity_registry/update\",\n            entity_id=eid,\n            name=\"New Name\",\n        )\n    \n        state = await rest.get_state(eid)\n        assert state[\"state\"] == \"important_value\"\n        assert state[\"attributes\"][\"existing_attr\"] == 42\n>       assert state[\"attributes\"][\"friendly_name\"] == \"New Name\"\nE       KeyError: 'friendly_name'\n\ntests/api/test_ws_registries.py:417: KeyError"}, "teardown": {"duration": 0.001030661165714264, "outcome": "passed"}}, {"nodeid": "tests/api/test_ws_registries.py::test_ws_entity_registry_update_nonexistent", "lineno": 419, "outcome": "passed", "keywords": ["test_ws_entity_registry_update_nonexistent", "test_ws_registries.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.0025801248848438263, "outcome": "passed"}, "call": {"duration": 0.000555957667529583, "outcome": "passed"}, "teardown": {"duration": 0.0006425837054848671, "outcome": "passed"}}, {"nodeid": "tests/api/test_ws_registries.py::test_ws_get_config_fields", "lineno": 431, "outcome": "passed", "keywords": ["test_ws_get_config_fields", "test_ws_registries.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.002192478161305189, "outcome": "passed"}, "call": {"duration": 0.0005497969686985016, "outcome": "passed"}, "teardown": {"duration": 0.0006235060282051563, "outcome": "passed"}}, {"nodeid": "tests/api/test_ws_registries.py::test_ws_lovelace_config", "lineno": 447, "outcome": "failed", "keywords": ["test_ws_lovelace_config", "test_ws_registries.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.0026429882273077965, "outcome": "passed"}, "call": {"duration": 0.0006284140981733799, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_ws_registries.py", "lineno": 451, "message": "assert False is True"}, "traceback": [{"path": "tests/api/test_ws_registries.py", "lineno": 451, "message": "AssertionError"}], "longrepr": "ws = <conftest.WSClient object at 0x7f47b0696580>\n\n    async def test_ws_lovelace_config(ws):\n        \"\"\"lovelace/config returns a dashboard config stub.\"\"\"\n        result = await ws.send_command(\"lovelace/config\")\n>       assert result[\"success\"] is True\nE       assert False is True\n\ntests/api/test_ws_registries.py:451: AssertionError"}, "teardown": {"duration": 0.0008561373688280582, "outcome": "passed"}}, {"nodeid": "tests/api/test_ws_registries.py::test_ws_subscribe_trigger", "lineno": 457, "outcome": "failed", "keywords": ["test_ws_subscribe_trigger", "test_ws_registries.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.002595712896436453, "outcome": "passed"}, "call": {"duration": 0.0007636239752173424, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_ws_registries.py", "lineno": 461, "message": "assert False is True"}, "traceback": [{"path": "tests/api/test_ws_registries.py", "lineno": 461, "message": "AssertionError"}], "longrepr": "ws = <conftest.WSClient object at 0x7f47b07cc220>\n\n    async def test_ws_subscribe_trigger(ws):\n        \"\"\"subscribe_trigger returns success.\"\"\"\n        result = await ws.send_command(\"subscribe_trigger\")\n>       assert result[\"success\"] is True\nE       assert False is True\n\ntests/api/test_ws_registries.py:461: AssertionError"}, "teardown": {"duration": 0.0008084801957011223, "outcome": "passed"}}, {"nodeid": "tests/api/test_ws_registries.py::test_ws_unknown_command_fails", "lineno": 465, "outcome": "passed", "keywords": ["test_ws_unknown_command_fails", "test_ws_registries.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.0024797599762678146, "outcome": "passed"}, "call": {"duration": 0.0005126921460032463, "outcome": "passed"}, "teardown": {"duration": 0.0006449930369853973, "outcome": "passed"}}, {"nodeid": "tests/api/test_ws_service_dispatch.py::test_ws_call_service_with_target", "lineno": 27, "outcome": "failed", "keywords": ["test_ws_call_service_with_target", "test_ws_service_dispatch.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.007497061043977737, "outcome": "passed"}, "call": {"duration": 0.0032718200236558914, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_ws_service_dispatch.py", "lineno": 37, "message": "assert False is True"}, "traceback": [{"path": "tests/api/test_ws_service_dispatch.py", "lineno": 37, "message": "AssertionError"}], "longrepr": "ws = <conftest.WSClient object at 0x7f47b053fd60>\nrest = <conftest.RESTClient object at 0x7f47b1245580>\n\n    async def test_ws_call_service_with_target(ws, rest):\n        \"\"\"WS call_service with target.entity_id works.\"\"\"\n        await rest.set_state(\"light.ws_svc_t1\", \"off\")\n        resp = await ws.send_command(\n            \"call_service\",\n            domain=\"light\",\n            service=\"turn_on\",\n            target={\"entity_id\": \"light.ws_svc_t1\"},\n        )\n>       assert resp[\"success\"] is True\nE       assert False is True\n\ntests/api/test_ws_service_dispatch.py:37: AssertionError"}, "teardown": {"duration": 0.001249000895768404, "outcome": "passed"}}, {"nodeid": "tests/api/test_ws_service_dispatch.py::test_ws_call_service_with_service_data", "lineno": 39, "outcome": "failed", "keywords": ["test_ws_call_service_with_service_data", "test_ws_service_dispatch.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.007179865147918463, "outcome": "passed"}, "call": {"duration": 0.0030604260973632336, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_ws_service_dispatch.py", "lineno": 49, "message": "assert False is True"}, "traceback": [{"path": "tests/api/test_ws_service_dispatch.py", "lineno": 49, "message": "AssertionError"}], "longrepr": "ws = <conftest.WSClient object at 0x7f47b0832490>\nrest = <conftest.RESTClient object at 0x7f47b08daca0>\n\n    async def test_ws_call_service_with_service_data(ws, rest):\n        \"\"\"WS call_service with service_data.entity_id works.\"\"\"\n        await rest.set_state(\"switch.ws_svc_d1\", \"off\")\n        resp = await ws.send_command(\n            \"call_service\",\n            domain=\"switch\",\n            service=\"turn_on\",\n            service_data={\"entity_id\": \"switch.ws_svc_d1\"},\n        )\n>       assert resp[\"success\"] is True\nE       assert False is True\n\ntests/api/test_ws_service_dispatch.py:49: AssertionError"}, "teardown": {"duration": 0.0011333059519529343, "outcome": "passed"}}, {"nodeid": "tests/api/test_ws_service_dispatch.py::test_ws_call_service_entity_array", "lineno": 53, "outcome": "failed", "keywords": ["test_ws_call_service_entity_array", "test_ws_service_dispatch.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.007952871266752481, "outcome": "passed"}, "call": {"duration": 0.005031788256019354, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_ws_service_dispatch.py", "lineno": 67, "message": "assert False is True"}, "traceback": [{"path": "tests/api/test_ws_service_dispatch.py", "lineno": 67, "message": "AssertionError"}], "longrepr": "ws = <conftest.WSClient object at 0x7f47b07dda30>\nrest = <conftest.RESTClient object at 0x7f47b096ed60>\n\n    async def test_ws_call_service_entity_array(ws, rest):\n        \"\"\"WS call_service with array of entity_ids.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid1 = f\"light.ws_arr1_{tag}\"\n        eid2 = f\"light.ws_arr2_{tag}\"\n        await rest.set_state(eid1, \"off\")\n        await rest.set_state(eid2, \"off\")\n        resp = await ws.send_command(\n            \"call_service\",\n            domain=\"light\",\n            service=\"turn_on\",\n            service_data={\"entity_id\": [eid1, eid2]},\n        )\n>       assert resp[\"success\"] is True\nE       assert False is True\n\ntests/api/test_ws_service_dispatch.py:67: AssertionError"}, "teardown": {"duration": 0.00125055480748415, "outcome": "passed"}}, {"nodeid": "tests/api/test_ws_service_dispatch.py::test_ws_call_service_with_data", "lineno": 71, "outcome": "failed", "keywords": ["test_ws_call_service_with_data", "test_ws_service_dispatch.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.0074452306143939495, "outcome": "passed"}, "call": {"duration": 0.0030266609974205494, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_ws_service_dispatch.py", "lineno": 82, "message": "assert False is True"}, "traceback": [{"path": "tests/api/test_ws_service_dispatch.py", "lineno": 82, "message": "AssertionError"}], "longrepr": "ws = <conftest.WSClient object at 0x7f47b0a02460>\nrest = <conftest.RESTClient object at 0x7f47b071a8b0>\n\n    async def test_ws_call_service_with_data(ws, rest):\n        \"\"\"WS call_service passes data to service handler.\"\"\"\n        await rest.set_state(\"light.ws_svc_data\", \"off\")\n        resp = await ws.send_command(\n            \"call_service\",\n            domain=\"light\",\n            service=\"turn_on\",\n            target={\"entity_id\": \"light.ws_svc_data\"},\n            service_data={\"brightness\": 128},\n        )\n>       assert resp[\"success\"] is True\nE       assert False is True\n\ntests/api/test_ws_service_dispatch.py:82: AssertionError"}, "teardown": {"duration": 0.0011929171159863472, "outcome": "passed"}}, {"nodeid": "tests/api/test_ws_service_dispatch.py::test_ws_call_service_toggle", "lineno": 87, "outcome": "failed", "keywords": ["test_ws_call_service_toggle", "test_ws_service_dispatch.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.007597329095005989, "outcome": "passed"}, "call": {"duration": 0.003020879812538624, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_ws_service_dispatch.py", "lineno": 99, "message": "assert False is True"}, "traceback": [{"path": "tests/api/test_ws_service_dispatch.py", "lineno": 99, "message": "AssertionError"}], "longrepr": "ws = <conftest.WSClient object at 0x7f47b06276d0>\nrest = <conftest.RESTClient object at 0x7f47b05450a0>\n\n    async def test_ws_call_service_toggle(ws, rest):\n        \"\"\"WS call_service toggle switches state.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"switch.ws_sw_{tag}\"\n        await rest.set_state(eid, \"on\")\n        resp = await ws.send_command(\n            \"call_service\",\n            domain=\"switch\",\n            service=\"toggle\",\n            service_data={\"entity_id\": eid},\n        )\n>       assert resp[\"success\"] is True\nE       assert False is True\n\ntests/api/test_ws_service_dispatch.py:99: AssertionError"}, "teardown": {"duration": 0.0010162806138396263, "outcome": "passed"}}, {"nodeid": "tests/api/test_ws_service_dispatch.py::test_ws_call_service_climate", "lineno": 103, "outcome": "failed", "keywords": ["test_ws_call_service_climate", "test_ws_service_dispatch.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.008073677774518728, "outcome": "passed"}, "call": {"duration": 0.003561616875231266, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_ws_service_dispatch.py", "lineno": 115, "message": "assert False is True"}, "traceback": [{"path": "tests/api/test_ws_service_dispatch.py", "lineno": 115, "message": "AssertionError"}], "longrepr": "ws = <conftest.WSClient object at 0x7f47b1272df0>\nrest = <conftest.RESTClient object at 0x7f47b0627ee0>\n\n    async def test_ws_call_service_climate(ws, rest):\n        \"\"\"WS call_service for climate domain works.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"climate.ws_clim_{tag}\"\n        await rest.set_state(eid, \"heat\")\n        resp = await ws.send_command(\n            \"call_service\",\n            domain=\"climate\",\n            service=\"set_temperature\",\n            service_data={\"entity_id\": eid, \"temperature\": 72},\n        )\n>       assert resp[\"success\"] is True\nE       assert False is True\n\ntests/api/test_ws_service_dispatch.py:115: AssertionError"}, "teardown": {"duration": 0.0011579548008739948, "outcome": "passed"}}, {"nodeid": "tests/api/test_ws_service_dispatch.py::test_ws_call_service_lock", "lineno": 119, "outcome": "failed", "keywords": ["test_ws_call_service_lock", "test_ws_service_dispatch.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.007396931294351816, "outcome": "passed"}, "call": {"duration": 0.0029577119275927544, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_ws_service_dispatch.py", "lineno": 131, "message": "assert False is True"}, "traceback": [{"path": "tests/api/test_ws_service_dispatch.py", "lineno": 131, "message": "AssertionError"}], "longrepr": "ws = <conftest.WSClient object at 0x7f47b0690ca0>\nrest = <conftest.RESTClient object at 0x7f47b0649e50>\n\n    async def test_ws_call_service_lock(ws, rest):\n        \"\"\"WS call_service for lock domain works.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"lock.ws_lk_{tag}\"\n        await rest.set_state(eid, \"unlocked\")\n        resp = await ws.send_command(\n            \"call_service\",\n            domain=\"lock\",\n            service=\"lock\",\n            service_data={\"entity_id\": eid},\n        )\n>       assert resp[\"success\"] is True\nE       assert False is True\n\ntests/api/test_ws_service_dispatch.py:131: AssertionError"}, "teardown": {"duration": 0.001218182034790516, "outcome": "passed"}}, {"nodeid": "tests/api/test_ws_service_dispatch.py::test_ws_call_service_scene", "lineno": 134, "outcome": "failed", "keywords": ["test_ws_call_service_scene", "test_ws_service_dispatch.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.007174414116889238, "outcome": "passed"}, "call": {"duration": 0.001020579133182764, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_ws_service_dispatch.py", "lineno": 143, "message": "assert False is True"}, "traceback": [{"path": "tests/api/test_ws_service_dispatch.py", "lineno": 143, "message": "AssertionError"}], "longrepr": "ws = <conftest.WSClient object at 0x7f47b05411f0>\nrest = <conftest.RESTClient object at 0x7f47b11dc3d0>\n\n    async def test_ws_call_service_scene(ws, rest):\n        \"\"\"WS call_service activating a scene works.\"\"\"\n        resp = await ws.send_command(\n            \"call_service\",\n            domain=\"scene\",\n            service=\"turn_on\",\n            target={\"entity_id\": \"scene.evening\"},\n        )\n>       assert resp[\"success\"] is True\nE       assert False is True\n\ntests/api/test_ws_service_dispatch.py:143: AssertionError"}, "teardown": {"duration": 0.0010378840379416943, "outcome": "passed"}}, {"nodeid": "tests/api/test_ws_service_dispatch.py::test_ws_call_service_light_with_brightness", "lineno": 145, "outcome": "failed", "keywords": ["test_ws_call_service_light_with_brightness", "test_ws_service_dispatch.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.00718093803152442, "outcome": "passed"}, "call": {"duration": 0.0033789491280913353, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_ws_service_dispatch.py", "lineno": 156, "message": "assert False is True"}, "traceback": [{"path": "tests/api/test_ws_service_dispatch.py", "lineno": 156, "message": "AssertionError"}], "longrepr": "ws = <conftest.WSClient object at 0x7f47b13224c0>\nrest = <conftest.RESTClient object at 0x7f47b0f3b100>\n\n    async def test_ws_call_service_light_with_brightness(ws, rest):\n        \"\"\"WS call_service light.turn_on with brightness sets attribute.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"light.ws_lt_{tag}\"\n        await rest.set_state(eid, \"off\")\n        resp = await ws.send_command(\"call_service\",\n            domain=\"light\",\n            service=\"turn_on\",\n            service_data={\"entity_id\": eid, \"brightness\": 200},\n        )\n>       assert resp[\"success\"] is True\nE       assert False is True\n\ntests/api/test_ws_service_dispatch.py:156: AssertionError"}, "teardown": {"duration": 0.0011568511836230755, "outcome": "passed"}}, {"nodeid": "tests/api/test_ws_service_dispatch.py::test_ws_call_service_target_entity_array", "lineno": 161, "outcome": "failed", "keywords": ["test_ws_call_service_target_entity_array", "test_ws_service_dispatch.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.007378049660474062, "outcome": "passed"}, "call": {"duration": 0.004235635977238417, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_ws_service_dispatch.py", "lineno": 175, "message": "assert False is True"}, "traceback": [{"path": "tests/api/test_ws_service_dispatch.py", "lineno": 175, "message": "AssertionError"}], "longrepr": "ws = <conftest.WSClient object at 0x7f47b080ca90>\nrest = <conftest.RESTClient object at 0x7f47b13224f0>\n\n    async def test_ws_call_service_target_entity_array(ws, rest):\n        \"\"\"WS call_service with target.entity_id as array.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid1 = f\"switch.ws_tga1_{tag}\"\n        eid2 = f\"switch.ws_tga2_{tag}\"\n        await rest.set_state(eid1, \"on\")\n        await rest.set_state(eid2, \"on\")\n        resp = await ws.send_command(\"call_service\",\n            domain=\"switch\",\n            service=\"turn_off\",\n            service_data={},\n            target={\"entity_id\": [eid1, eid2]},\n        )\n>       assert resp[\"success\"] is True\nE       assert False is True\n\ntests/api/test_ws_service_dispatch.py:175: AssertionError"}, "teardown": {"duration": 0.0011333120055496693, "outcome": "passed"}}, {"nodeid": "tests/api/test_ws_service_dispatch.py::test_ws_call_service_attribute_domains[cover-position]", "lineno": 179, "outcome": "failed", "keywords": ["test_ws_call_service_attribute_domains[cover-position]", "parametrize", "pytestmark", "cover-position", "test_ws_service_dispatch.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.00813218392431736, "outcome": "passed"}, "call": {"duration": 0.002989211119711399, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_ws_service_dispatch.py", "lineno": 196, "message": "assert False is True"}, "traceback": [{"path": "tests/api/test_ws_service_dispatch.py", "lineno": 196, "message": "AssertionError"}], "longrepr": "ws = <conftest.WSClient object at 0x7f47b0724af0>\nrest = <conftest.RESTClient object at 0x7f47b10d93d0>, domain = 'cover'\nservice = 'set_cover_position', entity_prefix = 'cover.ws_cvr'\ninitial_state = 'closed', service_data_extra = {'position': 50}\nexpected_attr = 'current_position', expected_attr_val = 50\n\n    @pytest.mark.parametrize(\"domain,service,entity_prefix,initial_state,service_data_extra,expected_attr,expected_attr_val\", [\n        (\"cover\", \"set_cover_position\", \"cover.ws_cvr\", \"closed\", {\"position\": 50}, \"current_position\", 50),\n        (\"fan\", \"set_percentage\", \"fan.ws_fn\", \"on\", {\"percentage\": 75}, \"percentage\", 75),\n        (\"media_player\", \"volume_set\", \"media_player.ws_mp\", \"playing\", {\"volume_level\": 0.6}, \"volume_level\", 0.6),\n    ], ids=[\"cover-position\", \"fan-percentage\", \"media-player-volume\"])\n    async def test_ws_call_service_attribute_domains(ws, rest, domain, service, entity_prefix, initial_state, service_data_extra, expected_attr, expected_attr_val):\n        \"\"\"WS call_service for various domains sets expected attributes.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"{entity_prefix}_{tag}\"\n        await rest.set_state(eid, initial_state)\n        svc_data = {\"entity_id\": eid, **service_data_extra}\n        resp = await ws.send_command(\"call_service\",\n            domain=domain,\n            service=service,\n            service_data=svc_data,\n        )\n>       assert resp[\"success\"] is True\nE       assert False is True\n\ntests/api/test_ws_service_dispatch.py:196: AssertionError"}, "teardown": {"duration": 0.001124609261751175, "outcome": "passed"}}, {"nodeid": "tests/api/test_ws_service_dispatch.py::test_ws_call_service_attribute_domains[fan-percentage]", "lineno": 179, "outcome": "failed", "keywords": ["test_ws_call_service_attribute_domains[fan-percentage]", "parametrize", "pytestmark", "fan-percentage", "test_ws_service_dispatch.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.007272452116012573, "outcome": "passed"}, "call": {"duration": 0.0031070378609001637, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_ws_service_dispatch.py", "lineno": 196, "message": "assert False is True"}, "traceback": [{"path": "tests/api/test_ws_service_dispatch.py", "lineno": 196, "message": "AssertionError"}], "longrepr": "ws = <conftest.WSClient object at 0x7f47b09b6250>\nrest = <conftest.RESTClient object at 0x7f47b10d9190>, domain = 'fan'\nservice = 'set_percentage', entity_prefix = 'fan.ws_fn', initial_state = 'on'\nservice_data_extra = {'percentage': 75}, expected_attr = 'percentage'\nexpected_attr_val = 75\n\n    @pytest.mark.parametrize(\"domain,service,entity_prefix,initial_state,service_data_extra,expected_attr,expected_attr_val\", [\n        (\"cover\", \"set_cover_position\", \"cover.ws_cvr\", \"closed\", {\"position\": 50}, \"current_position\", 50),\n        (\"fan\", \"set_percentage\", \"fan.ws_fn\", \"on\", {\"percentage\": 75}, \"percentage\", 75),\n        (\"media_player\", \"volume_set\", \"media_player.ws_mp\", \"playing\", {\"volume_level\": 0.6}, \"volume_level\", 0.6),\n    ], ids=[\"cover-position\", \"fan-percentage\", \"media-player-volume\"])\n    async def test_ws_call_service_attribute_domains(ws, rest, domain, service, entity_prefix, initial_state, service_data_extra, expected_attr, expected_attr_val):\n        \"\"\"WS call_service for various domains sets expected attributes.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"{entity_prefix}_{tag}\"\n        await rest.set_state(eid, initial_state)\n        svc_data = {\"entity_id\": eid, **service_data_extra}\n        resp = await ws.send_command(\"call_service\",\n            domain=domain,\n            service=service,\n            service_data=svc_data,\n        )\n>       assert resp[\"success\"] is True\nE       assert False is True\n\ntests/api/test_ws_service_dispatch.py:196: AssertionError"}, "teardown": {"duration": 0.0012042871676385403, "outcome": "passed"}}, {"nodeid": "tests/api/test_ws_service_dispatch.py::test_ws_call_service_attribute_domains[media-player-volume]", "lineno": 179, "outcome": "failed", "keywords": ["test_ws_call_service_attribute_domains[media-player-volume]", "parametrize", "pytestmark", "media-player-volume", "test_ws_service_dispatch.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.007431535981595516, "outcome": "passed"}, "call": {"duration": 0.0028688879683613777, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_ws_service_dispatch.py", "lineno": 196, "message": "assert False is True"}, "traceback": [{"path": "tests/api/test_ws_service_dispatch.py", "lineno": 196, "message": "AssertionError"}], "longrepr": "ws = <conftest.WSClient object at 0x7f47b0627ee0>\nrest = <conftest.RESTClient object at 0x7f47b05d7220>, domain = 'media_player'\nservice = 'volume_set', entity_prefix = 'media_player.ws_mp'\ninitial_state = 'playing', service_data_extra = {'volume_level': 0.6}\nexpected_attr = 'volume_level', expected_attr_val = 0.6\n\n    @pytest.mark.parametrize(\"domain,service,entity_prefix,initial_state,service_data_extra,expected_attr,expected_attr_val\", [\n        (\"cover\", \"set_cover_position\", \"cover.ws_cvr\", \"closed\", {\"position\": 50}, \"current_position\", 50),\n        (\"fan\", \"set_percentage\", \"fan.ws_fn\", \"on\", {\"percentage\": 75}, \"percentage\", 75),\n        (\"media_player\", \"volume_set\", \"media_player.ws_mp\", \"playing\", {\"volume_level\": 0.6}, \"volume_level\", 0.6),\n    ], ids=[\"cover-position\", \"fan-percentage\", \"media-player-volume\"])\n    async def test_ws_call_service_attribute_domains(ws, rest, domain, service, entity_prefix, initial_state, service_data_extra, expected_attr, expected_attr_val):\n        \"\"\"WS call_service for various domains sets expected attributes.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"{entity_prefix}_{tag}\"\n        await rest.set_state(eid, initial_state)\n        svc_data = {\"entity_id\": eid, **service_data_extra}\n        resp = await ws.send_command(\"call_service\",\n            domain=domain,\n            service=service,\n            service_data=svc_data,\n        )\n>       assert resp[\"success\"] is True\nE       assert False is True\n\ntests/api/test_ws_service_dispatch.py:196: AssertionError"}, "teardown": {"duration": 0.0011350326240062714, "outcome": "passed"}}, {"nodeid": "tests/api/test_ws_service_dispatch.py::test_ws_call_counter_increment", "lineno": 200, "outcome": "failed", "keywords": ["test_ws_call_counter_increment", "test_ws_service_dispatch.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.007334565278142691, "outcome": "passed"}, "call": {"duration": 0.004431491252034903, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_ws_service_dispatch.py", "lineno": 212, "message": "AssertionError: assert '10' == '11'\n  \n  - 11\n  + 10"}, "traceback": [{"path": "tests/api/test_ws_service_dispatch.py", "lineno": 212, "message": "AssertionError"}], "longrepr": "ws = <conftest.WSClient object at 0x7f47b0f23d60>\nrest = <conftest.RESTClient object at 0x7f47b05d7490>\n\n    async def test_ws_call_counter_increment(ws, rest):\n        \"\"\"WS call_service counter.increment increases value.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"counter.ws_ctr_{tag}\"\n        await rest.set_state(eid, \"10\")\n        resp = await ws.send_command(\"call_service\",\n            domain=\"counter\",\n            service=\"increment\",\n            service_data={\"entity_id\": eid},\n        )\n        assert resp[\"success\"] is True\n>       assert (await rest.get_state(eid))[\"state\"] == \"11\"\nE       AssertionError: assert '10' == '11'\nE         \nE         - 11\nE         + 10\n\ntests/api/test_ws_service_dispatch.py:212: AssertionError"}, "teardown": {"duration": 0.0010857428424060345, "outcome": "passed"}}, {"nodeid": "tests/api/test_ws_service_dispatch.py::test_ws_automation_trigger", "lineno": 217, "outcome": "passed", "keywords": ["test_ws_automation_trigger", "test_ws_service_dispatch.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.007025693077594042, "outcome": "passed"}, "call": {"duration": 0.000797805842012167, "outcome": "passed"}, "teardown": {"duration": 0.0007953359745442867, "outcome": "passed"}}, {"nodeid": "tests/api/test_ws_service_dispatch.py::test_ws_automation_turn_off", "lineno": 228, "outcome": "failed", "keywords": ["test_ws_automation_turn_off", "test_ws_service_dispatch.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.008530166931450367, "outcome": "passed"}, "call": {"duration": 0.0033329338766634464, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_ws_service_dispatch.py", "lineno": 241, "message": "TypeError: 'NoneType' object is not subscriptable"}, "traceback": [{"path": "tests/api/test_ws_service_dispatch.py", "lineno": 241, "message": "TypeError"}], "longrepr": "ws = <conftest.WSClient object at 0x7f47b0a81190>\nrest = <conftest.RESTClient object at 0x7f47b0533250>\n\n    async def test_ws_automation_turn_off(ws, rest):\n        \"\"\"WS call_service automation.turn_off disables automation.\"\"\"\n        eid = \"automation.morning_wakeup\"\n    \n        await ws.send_command(\n            \"call_service\",\n            domain=\"automation\",\n            service=\"turn_off\",\n            service_data={\"entity_id\": eid},\n        )\n    \n        state = await rest.get_state(eid)\n>       assert state[\"state\"] == \"off\"\nE       TypeError: 'NoneType' object is not subscriptable\n\ntests/api/test_ws_service_dispatch.py:241: TypeError"}, "teardown": {"duration": 0.0011715507134795189, "outcome": "passed"}}, {"nodeid": "tests/api/test_ws_service_dispatch.py::test_ws_automation_toggle", "lineno": 251, "outcome": "failed", "keywords": ["test_ws_automation_toggle", "test_ws_service_dispatch.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.007382884155958891, "outcome": "passed"}, "call": {"duration": 0.0028691808693110943, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_ws_service_dispatch.py", "lineno": 256, "message": "TypeError: 'NoneType' object is not subscriptable"}, "traceback": [{"path": "tests/api/test_ws_service_dispatch.py", "lineno": 256, "message": "TypeError"}], "longrepr": "ws = <conftest.WSClient object at 0x7f47b1279c10>\nrest = <conftest.RESTClient object at 0x7f47b1279520>\n\n    async def test_ws_automation_toggle(ws, rest):\n        \"\"\"WS call_service automation.toggle flips enabled state.\"\"\"\n        eid = \"automation.morning_wakeup\"\n        state_before = await rest.get_state(eid)\n>       was_on = state_before[\"state\"] == \"on\"\nE       TypeError: 'NoneType' object is not subscriptable\n\ntests/api/test_ws_service_dispatch.py:256: TypeError"}, "teardown": {"duration": 0.0015526646748185158, "outcome": "passed"}}, {"nodeid": "tests/api/test_ws_service_dispatch.py::test_ws_fire_event", "lineno": 282, "outcome": "passed", "keywords": ["test_ws_fire_event", "test_ws_service_dispatch.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.002470100298523903, "outcome": "passed"}, "call": {"duration": 0.0005599018186330795, "outcome": "passed"}, "teardown": {"duration": 0.0006193281151354313, "outcome": "passed"}}, {"nodeid": "tests/api/test_ws_service_dispatch.py::test_fire_event_edge_cases[no-event-type]", "lineno": 292, "outcome": "failed", "keywords": ["test_fire_event_edge_cases[no-event-type]", "parametrize", "pytestmark", "no-event-type", "test_ws_service_dispatch.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.0022263419814407825, "outcome": "passed"}, "call": {"duration": 0.0008062291890382767, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_ws_service_dispatch.py", "lineno": 303, "message": "assert False is True"}, "traceback": [{"path": "tests/api/test_ws_service_dispatch.py", "lineno": 303, "message": "AssertionError"}], "longrepr": "ws = <conftest.WSClient object at 0x7f47b0832040>, event_type = None\n\n    @pytest.mark.parametrize(\"event_type\", [\n        pytest.param(None, id=\"no-event-type\"),\n        pytest.param(\"\", id=\"empty-event-type\"),\n    ])\n    async def test_fire_event_edge_cases(ws, event_type):\n        \"\"\"fire_event with missing or empty event_type still returns success.\"\"\"\n        kwargs = {}\n        if event_type is not None:\n            kwargs[\"event_type\"] = event_type\n        resp = await ws.send_command(\"fire_event\", **kwargs)\n>       assert resp[\"success\"] is True\nE       assert False is True\n\ntests/api/test_ws_service_dispatch.py:303: AssertionError"}, "teardown": {"duration": 0.0010047699324786663, "outcome": "passed"}}, {"nodeid": "tests/api/test_ws_service_dispatch.py::test_fire_event_edge_cases[empty-event-type]", "lineno": 292, "outcome": "passed", "keywords": ["test_fire_event_edge_cases[empty-event-type]", "parametrize", "pytestmark", "empty-event-type", "test_ws_service_dispatch.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.0024398542009294033, "outcome": "passed"}, "call": {"duration": 0.0005511948838829994, "outcome": "passed"}, "teardown": {"duration": 0.0006370991468429565, "outcome": "passed"}}, {"nodeid": "tests/api/test_ws_service_dispatch.py::test_fire_event_multiple_sequential", "lineno": 305, "outcome": "passed", "keywords": ["test_fire_event_multiple_sequential", "test_ws_service_dispatch.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.0022609522566199303, "outcome": "passed"}, "call": {"duration": 0.001834765076637268, "outcome": "passed"}, "teardown": {"duration": 0.000986292026937008, "outcome": "passed"}}, {"nodeid": "tests/api/test_ws_service_dispatch.py::test_fire_event_custom_type", "lineno": 315, "outcome": "passed", "keywords": ["test_fire_event_custom_type", "test_ws_service_dispatch.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.002768056932836771, "outcome": "passed"}, "call": {"duration": 0.0008162590675055981, "outcome": "passed"}, "teardown": {"duration": 0.0008494970388710499, "outcome": "passed"}}, {"nodeid": "tests/api/test_ws_service_dispatch.py::test_fire_event_no_data", "lineno": 325, "outcome": "passed", "keywords": ["test_fire_event_no_data", "test_ws_service_dispatch.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.002585209906101227, "outcome": "passed"}, "call": {"duration": 0.0005858708173036575, "outcome": "passed"}, "teardown": {"duration": 0.0007603131234645844, "outcome": "passed"}}, {"nodeid": "tests/api/test_ws_service_dispatch.py::test_ws_get_services", "lineno": 337, "outcome": "failed", "keywords": ["test_ws_get_services", "test_ws_service_dispatch.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.0028329240158200264, "outcome": "passed"}, "call": {"duration": 0.00172397680580616, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_ws_service_dispatch.py", "lineno": 344, "message": "AssertionError: assert False\n +  where False = isinstance({'automation': {'reload': {'description': 'Reloads the automation configuration.', 'fields': {}, 'name': 'Reload'}, 't...e', 'required': True, 'selector': {'number': {...}}}}, 'name': 'Set', 'target': {'entity': [{'domain': [...]}]}}}, ...}, list)"}, "traceback": [{"path": "tests/api/test_ws_service_dispatch.py", "lineno": 344, "message": "AssertionError"}], "longrepr": "ws = <conftest.WSClient object at 0x7f47b0a22be0>\n\n    async def test_ws_get_services(ws):\n        \"\"\"WS get_services returns service registry.\"\"\"\n        resp = await ws.send_command(\"get_services\")\n        assert resp[\"success\"] is True\n        assert \"result\" in resp\n        result = resp[\"result\"]\n>       assert isinstance(result, list)\nE       AssertionError: assert False\nE        +  where False = isinstance({'automation': {'reload': {'description': 'Reloads the automation configuration.', 'fields': {}, 'name': 'Reload'}, 't...e', 'required': True, 'selector': {'number': {...}}}}, 'name': 'Set', 'target': {'entity': [{'domain': [...]}]}}}, ...}, list)\n\ntests/api/test_ws_service_dispatch.py:344: AssertionError"}, "teardown": {"duration": 0.0009882692247629166, "outcome": "passed"}}, {"nodeid": "tests/api/test_ws_service_dispatch.py::test_get_services_has_domain[light]", "lineno": 349, "outcome": "failed", "keywords": ["test_get_services_has_domain[light]", "parametrize", "pytestmark", "light", "test_ws_service_dispatch.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.002611474134027958, "outcome": "passed"}, "call": {"duration": 0.0011653727851808071, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_ws_service_dispatch.py", "lineno": 355, "message": "TypeError: string indices must be integers"}, "traceback": [{"path": "tests/api/test_ws_service_dispatch.py", "lineno": 355, "message": ""}, {"path": "tests/api/test_ws_service_dispatch.py", "lineno": 355, "message": "TypeError"}], "longrepr": "ws = <conftest.WSClient object at 0x7f47b06db280>, domain = 'light'\n\n    @pytest.mark.parametrize(\"domain\", [\"light\", \"switch\", \"climate\"],\n                             ids=[\"light\", \"switch\", \"climate\"])\n    async def test_get_services_has_domain(ws, domain):\n        \"\"\"get_services includes expected domains.\"\"\"\n        resp = await ws.send_command(\"get_services\")\n>       domains = [e[\"domain\"] for e in resp[\"result\"]]\n\ntests/api/test_ws_service_dispatch.py:355: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\n.0 = <dict_keyiterator object at 0x7f47b1051b30>\n\n>   domains = [e[\"domain\"] for e in resp[\"result\"]]\nE   TypeError: string indices must be integers\n\ntests/api/test_ws_service_dispatch.py:355: TypeError"}, "teardown": {"duration": 0.0010672160424292088, "outcome": "passed"}}, {"nodeid": "tests/api/test_ws_service_dispatch.py::test_get_services_has_domain[switch]", "lineno": 349, "outcome": "failed", "keywords": ["test_get_services_has_domain[switch]", "parametrize", "pytestmark", "switch", "test_ws_service_dispatch.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.0029235249385237694, "outcome": "passed"}, "call": {"duration": 0.001251816749572754, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_ws_service_dispatch.py", "lineno": 355, "message": "TypeError: string indices must be integers"}, "traceback": [{"path": "tests/api/test_ws_service_dispatch.py", "lineno": 355, "message": ""}, {"path": "tests/api/test_ws_service_dispatch.py", "lineno": 355, "message": "TypeError"}], "longrepr": "ws = <conftest.WSClient object at 0x7f47b0832040>, domain = 'switch'\n\n    @pytest.mark.parametrize(\"domain\", [\"light\", \"switch\", \"climate\"],\n                             ids=[\"light\", \"switch\", \"climate\"])\n    async def test_get_services_has_domain(ws, domain):\n        \"\"\"get_services includes expected domains.\"\"\"\n        resp = await ws.send_command(\"get_services\")\n>       domains = [e[\"domain\"] for e in resp[\"result\"]]\n\ntests/api/test_ws_service_dispatch.py:355: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\n.0 = <dict_keyiterator object at 0x7f47b10a78b0>\n\n>   domains = [e[\"domain\"] for e in resp[\"result\"]]\nE   TypeError: string indices must be integers\n\ntests/api/test_ws_service_dispatch.py:355: TypeError"}, "teardown": {"duration": 0.0010800128802657127, "outcome": "passed"}}, {"nodeid": "tests/api/test_ws_service_dispatch.py::test_get_services_has_domain[climate]", "lineno": 349, "outcome": "failed", "keywords": ["test_get_services_has_domain[climate]", "parametrize", "pytestmark", "climate", "test_ws_service_dispatch.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.0027187312953174114, "outcome": "passed"}, "call": {"duration": 0.0012940377928316593, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_ws_service_dispatch.py", "lineno": 355, "message": "TypeError: string indices must be integers"}, "traceback": [{"path": "tests/api/test_ws_service_dispatch.py", "lineno": 355, "message": ""}, {"path": "tests/api/test_ws_service_dispatch.py", "lineno": 355, "message": "TypeError"}], "longrepr": "ws = <conftest.WSClient object at 0x7f47b07cc610>, domain = 'climate'\n\n    @pytest.mark.parametrize(\"domain\", [\"light\", \"switch\", \"climate\"],\n                             ids=[\"light\", \"switch\", \"climate\"])\n    async def test_get_services_has_domain(ws, domain):\n        \"\"\"get_services includes expected domains.\"\"\"\n        resp = await ws.send_command(\"get_services\")\n>       domains = [e[\"domain\"] for e in resp[\"result\"]]\n\ntests/api/test_ws_service_dispatch.py:355: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\n.0 = <dict_keyiterator object at 0x7f47b0e41e00>\n\n>   domains = [e[\"domain\"] for e in resp[\"result\"]]\nE   TypeError: string indices must be integers\n\ntests/api/test_ws_service_dispatch.py:355: TypeError"}, "teardown": {"duration": 0.001201289240270853, "outcome": "passed"}}, {"nodeid": "tests/api/test_ws_service_dispatch.py::test_get_services_domain_entry_format", "lineno": 358, "outcome": "failed", "keywords": ["test_get_services_domain_entry_format", "test_ws_service_dispatch.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.002957979217171669, "outcome": "passed"}, "call": {"duration": 0.0014135399833321571, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_ws_service_dispatch.py", "lineno": 363, "message": "AssertionError: Missing 'domain' in entry: homeassistant\nassert 'domain' in 'homeassistant'"}, "traceback": [{"path": "tests/api/test_ws_service_dispatch.py", "lineno": 363, "message": "AssertionError"}], "longrepr": "ws = <conftest.WSClient object at 0x7f47b0a00eb0>\n\n    async def test_get_services_domain_entry_format(ws):\n        \"\"\"Each domain entry has 'domain' and 'services' keys.\"\"\"\n        resp = await ws.send_command(\"get_services\")\n        for entry in resp[\"result\"]:\n>           assert \"domain\" in entry, f\"Missing 'domain' in entry: {entry}\"\nE           AssertionError: Missing 'domain' in entry: homeassistant\nE           assert 'domain' in 'homeassistant'\n\ntests/api/test_ws_service_dispatch.py:363: AssertionError"}, "teardown": {"duration": 0.0011207149364054203, "outcome": "passed"}}, {"nodeid": "tests/api/test_ws_service_dispatch.py::test_get_services_light_has_turn_on", "lineno": 367, "outcome": "failed", "keywords": ["test_get_services_light_has_turn_on", "test_ws_service_dispatch.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.002714213915169239, "outcome": "passed"}, "call": {"duration": 0.001281405333429575, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_ws_service_dispatch.py", "lineno": 371, "message": "TypeError: string indices must be integers"}, "traceback": [{"path": "tests/api/test_ws_service_dispatch.py", "lineno": 371, "message": ""}, {"path": "tests/api/test_ws_service_dispatch.py", "lineno": 371, "message": "TypeError"}], "longrepr": "ws = <conftest.WSClient object at 0x7f47b0a02490>\n\n    async def test_get_services_light_has_turn_on(ws):\n        \"\"\"Light domain includes turn_on service.\"\"\"\n        resp = await ws.send_command(\"get_services\")\n>       light = next(e for e in resp[\"result\"] if e[\"domain\"] == \"light\")\n\ntests/api/test_ws_service_dispatch.py:371: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\n.0 = <dict_keyiterator object at 0x7f47b0edd450>\n\n>   light = next(e for e in resp[\"result\"] if e[\"domain\"] == \"light\")\nE   TypeError: string indices must be integers\n\ntests/api/test_ws_service_dispatch.py:371: TypeError"}, "teardown": {"duration": 0.001084167044609785, "outcome": "passed"}}, {"nodeid": "tests/api/test_ws_service_dispatch.py::test_get_services_service_has_description", "lineno": 374, "outcome": "failed", "keywords": ["test_get_services_service_has_description", "test_ws_service_dispatch.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.002795279026031494, "outcome": "passed"}, "call": {"duration": 0.0013740980066359043, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_ws_service_dispatch.py", "lineno": 378, "message": "TypeError: string indices must be integers"}, "traceback": [{"path": "tests/api/test_ws_service_dispatch.py", "lineno": 378, "message": ""}, {"path": "tests/api/test_ws_service_dispatch.py", "lineno": 378, "message": "TypeError"}], "longrepr": "ws = <conftest.WSClient object at 0x7f47b11c2a00>\n\n    async def test_get_services_service_has_description(ws):\n        \"\"\"Service entries have description field.\"\"\"\n        resp = await ws.send_command(\"get_services\")\n>       light = next(e for e in resp[\"result\"] if e[\"domain\"] == \"light\")\n\ntests/api/test_ws_service_dispatch.py:378: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\n.0 = <dict_keyiterator object at 0x7f47b0edd3b0>\n\n>   light = next(e for e in resp[\"result\"] if e[\"domain\"] == \"light\")\nE   TypeError: string indices must be integers\n\ntests/api/test_ws_service_dispatch.py:378: TypeError"}, "teardown": {"duration": 0.0010332479141652584, "outcome": "passed"}}, {"nodeid": "tests/api/test_ws_service_dispatch.py::test_get_services_matches_rest", "lineno": 382, "outcome": "failed", "keywords": ["test_get_services_matches_rest", "test_ws_service_dispatch.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.00772098870947957, "outcome": "passed"}, "call": {"duration": 0.004334678407758474, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_ws_service_dispatch.py", "lineno": 393, "message": "TypeError: string indices must be integers"}, "traceback": [{"path": "tests/api/test_ws_service_dispatch.py", "lineno": 393, "message": ""}, {"path": "tests/api/test_ws_service_dispatch.py", "lineno": 393, "message": "TypeError"}], "longrepr": "ws = <conftest.WSClient object at 0x7f47b0a816d0>\nrest = <conftest.RESTClient object at 0x7f47b0a81d30>\n\n    async def test_get_services_matches_rest(ws, rest):\n        \"\"\"WS get_services matches REST /api/services output.\"\"\"\n        ws_resp = await ws.send_command(\"get_services\")\n        rest_resp = await rest.client.get(\n            f\"{rest.base_url}/api/services\",\n            headers=rest._headers(),\n        )\n        assert rest_resp.status_code == 200\n        rest_services = rest_resp.json()\n    \n>       ws_domains = sorted(e[\"domain\"] for e in ws_resp[\"result\"])\n\ntests/api/test_ws_service_dispatch.py:393: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\n.0 = <dict_keyiterator object at 0x7f47b0df56d0>\n\n>   ws_domains = sorted(e[\"domain\"] for e in ws_resp[\"result\"])\nE   TypeError: string indices must be integers\n\ntests/api/test_ws_service_dispatch.py:393: TypeError"}, "teardown": {"duration": 0.001182342879474163, "outcome": "passed"}}, {"nodeid": "tests/api/test_ws_service_dispatch.py::test_get_services_sorted_by_domain", "lineno": 397, "outcome": "failed", "keywords": ["test_get_services_sorted_by_domain", "test_ws_service_dispatch.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.002410630229860544, "outcome": "passed"}, "call": {"duration": 0.00108640780672431, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_ws_service_dispatch.py", "lineno": 401, "message": "TypeError: string indices must be integers"}, "traceback": [{"path": "tests/api/test_ws_service_dispatch.py", "lineno": 401, "message": ""}, {"path": "tests/api/test_ws_service_dispatch.py", "lineno": 401, "message": "TypeError"}], "longrepr": "ws = <conftest.WSClient object at 0x7f47b0547ee0>\n\n    async def test_get_services_sorted_by_domain(ws):\n        \"\"\"get_services result is sorted alphabetically by domain.\"\"\"\n        resp = await ws.send_command(\"get_services\")\n>       domains = [e[\"domain\"] for e in resp[\"result\"]]\n\ntests/api/test_ws_service_dispatch.py:401: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\n.0 = <dict_keyiterator object at 0x7f47b0e1aa90>\n\n>   domains = [e[\"domain\"] for e in resp[\"result\"]]\nE   TypeError: string indices must be integers\n\ntests/api/test_ws_service_dispatch.py:401: TypeError"}, "teardown": {"duration": 0.0010958081111311913, "outcome": "passed"}}, {"nodeid": "tests/api/test_ws_service_dispatch.py::test_ws_get_config", "lineno": 407, "outcome": "passed", "keywords": ["test_ws_get_config", "test_ws_service_dispatch.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.002542420756071806, "outcome": "passed"}, "call": {"duration": 0.0007994039915502071, "outcome": "passed"}, "teardown": {"duration": 0.0008761170320212841, "outcome": "passed"}}, {"nodeid": "tests/api/test_ws_service_dispatch.py::test_call_service_returns_result", "lineno": 420, "outcome": "failed", "keywords": ["test_call_service_returns_result", "test_ws_service_dispatch.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.0075419289059937, "outcome": "passed"}, "call": {"duration": 0.003388760145753622, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_ws_service_dispatch.py", "lineno": 433, "message": "assert False is True"}, "traceback": [{"path": "tests/api/test_ws_service_dispatch.py", "lineno": 433, "message": "AssertionError"}], "longrepr": "ws = <conftest.WSClient object at 0x7f47b0649a30>\nrest = <conftest.RESTClient object at 0x7f47b0ee6910>\n\n    async def test_call_service_returns_result(ws, rest):\n        \"\"\"WS call_service response has 'result' field.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"light.ws_resp_{tag}\"\n        await rest.set_state(eid, \"off\")\n    \n        resp = await ws.send_command(\n            \"call_service\",\n            domain=\"light\",\n            service=\"turn_on\",\n            service_data={\"entity_id\": eid},\n        )\n>       assert resp[\"success\"] is True\nE       assert False is True\n\ntests/api/test_ws_service_dispatch.py:433: AssertionError"}, "teardown": {"duration": 0.0010114298202097416, "outcome": "passed"}}, {"nodeid": "tests/api/test_ws_service_dispatch.py::test_call_service_result_is_list", "lineno": 436, "outcome": "failed", "keywords": ["test_call_service_result_is_list", "test_ws_service_dispatch.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.007913704961538315, "outcome": "passed"}, "call": {"duration": 0.003244997002184391, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_ws_service_dispatch.py", "lineno": 449, "message": "KeyError: 'result'"}, "traceback": [{"path": "tests/api/test_ws_service_dispatch.py", "lineno": 449, "message": "KeyError"}], "longrepr": "ws = <conftest.WSClient object at 0x7f47b05334f0>\nrest = <conftest.RESTClient object at 0x7f47b09b6c40>\n\n    async def test_call_service_result_is_list(ws, rest):\n        \"\"\"call_service result is a list of changed states.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"light.ws_list_{tag}\"\n        await rest.set_state(eid, \"off\")\n    \n        resp = await ws.send_command(\n            \"call_service\",\n            domain=\"light\",\n            service=\"turn_on\",\n            service_data={\"entity_id\": eid},\n        )\n>       result = resp[\"result\"]\nE       KeyError: 'result'\n\ntests/api/test_ws_service_dispatch.py:449: KeyError"}, "teardown": {"duration": 0.0012412159703671932, "outcome": "passed"}}, {"nodeid": "tests/api/test_ws_service_dispatch.py::test_changed_state_has_entity_id", "lineno": 453, "outcome": "failed", "keywords": ["test_changed_state_has_entity_id", "test_ws_service_dispatch.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.0076404958963394165, "outcome": "passed"}, "call": {"duration": 0.00303659588098526, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_ws_service_dispatch.py", "lineno": 466, "message": "KeyError: 'result'"}, "traceback": [{"path": "tests/api/test_ws_service_dispatch.py", "lineno": 466, "message": "KeyError"}], "longrepr": "ws = <conftest.WSClient object at 0x7f47b129ce80>\nrest = <conftest.RESTClient object at 0x7f47b0533a90>\n\n    async def test_changed_state_has_entity_id(ws, rest):\n        \"\"\"Changed state entries include entity_id.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"switch.ws_eid_{tag}\"\n        await rest.set_state(eid, \"off\")\n    \n        resp = await ws.send_command(\n            \"call_service\",\n            domain=\"switch\",\n            service=\"turn_on\",\n            service_data={\"entity_id\": eid},\n        )\n>       entry = resp[\"result\"][0]\nE       KeyError: 'result'\n\ntests/api/test_ws_service_dispatch.py:466: KeyError"}, "teardown": {"duration": 0.001347613986581564, "outcome": "passed"}}, {"nodeid": "tests/api/test_ws_service_dispatch.py::test_changed_state_has_state_field", "lineno": 469, "outcome": "failed", "keywords": ["test_changed_state_has_state_field", "test_ws_service_dispatch.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.007503065746277571, "outcome": "passed"}, "call": {"duration": 0.0033776722848415375, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_ws_service_dispatch.py", "lineno": 482, "message": "KeyError: 'result'"}, "traceback": [{"path": "tests/api/test_ws_service_dispatch.py", "lineno": 482, "message": "KeyError"}], "longrepr": "ws = <conftest.WSClient object at 0x7f47b0635c10>\nrest = <conftest.RESTClient object at 0x7f47b1272e80>\n\n    async def test_changed_state_has_state_field(ws, rest):\n        \"\"\"Changed state entries include 'state' string.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"switch.ws_state_{tag}\"\n        await rest.set_state(eid, \"off\")\n    \n        resp = await ws.send_command(\n            \"call_service\",\n            domain=\"switch\",\n            service=\"turn_on\",\n            service_data={\"entity_id\": eid},\n        )\n>       entry = resp[\"result\"][0]\nE       KeyError: 'result'\n\ntests/api/test_ws_service_dispatch.py:482: KeyError"}, "teardown": {"duration": 0.001127453986555338, "outcome": "passed"}}, {"nodeid": "tests/api/test_ws_service_dispatch.py::test_changed_state_has_attributes", "lineno": 485, "outcome": "failed", "keywords": ["test_changed_state_has_attributes", "test_ws_service_dispatch.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.007767733186483383, "outcome": "passed"}, "call": {"duration": 0.003241999074816704, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_ws_service_dispatch.py", "lineno": 498, "message": "KeyError: 'result'"}, "traceback": [{"path": "tests/api/test_ws_service_dispatch.py", "lineno": 498, "message": "KeyError"}], "longrepr": "ws = <conftest.WSClient object at 0x7f47b0f98850>\nrest = <conftest.RESTClient object at 0x7f47b0f98340>\n\n    async def test_changed_state_has_attributes(ws, rest):\n        \"\"\"Changed state entries include 'attributes' dict.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"light.ws_attrs_{tag}\"\n        await rest.set_state(eid, \"off\", {\"friendly_name\": f\"WS Test {tag}\"})\n    \n        resp = await ws.send_command(\n            \"call_service\",\n            domain=\"light\",\n            service=\"turn_on\",\n            service_data={\"entity_id\": eid},\n        )\n>       entry = resp[\"result\"][0]\nE       KeyError: 'result'\n\ntests/api/test_ws_service_dispatch.py:498: KeyError"}, "teardown": {"duration": 0.0011869189329445362, "outcome": "passed"}}, {"nodeid": "tests/api/test_ws_service_dispatch.py::test_changed_state_has_timestamps", "lineno": 502, "outcome": "failed", "keywords": ["test_changed_state_has_timestamps", "test_ws_service_dispatch.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.007519987877458334, "outcome": "passed"}, "call": {"duration": 0.0030635083094239235, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_ws_service_dispatch.py", "lineno": 515, "message": "KeyError: 'result'"}, "traceback": [{"path": "tests/api/test_ws_service_dispatch.py", "lineno": 515, "message": "KeyError"}], "longrepr": "ws = <conftest.WSClient object at 0x7f47b1290130>\nrest = <conftest.RESTClient object at 0x7f47b129cd00>\n\n    async def test_changed_state_has_timestamps(ws, rest):\n        \"\"\"Changed state entries include last_changed and last_updated.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"light.ws_time_{tag}\"\n        await rest.set_state(eid, \"off\")\n    \n        resp = await ws.send_command(\n            \"call_service\",\n            domain=\"light\",\n            service=\"turn_on\",\n            service_data={\"entity_id\": eid},\n        )\n>       entry = resp[\"result\"][0]\nE       KeyError: 'result'\n\ntests/api/test_ws_service_dispatch.py:515: KeyError"}, "teardown": {"duration": 0.0011415001936256886, "outcome": "passed"}}, {"nodeid": "tests/api/test_ws_service_dispatch.py::test_changed_state_has_context", "lineno": 519, "outcome": "failed", "keywords": ["test_changed_state_has_context", "test_ws_service_dispatch.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.007933338172733784, "outcome": "passed"}, "call": {"duration": 0.0031142933294177055, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_ws_service_dispatch.py", "lineno": 532, "message": "KeyError: 'result'"}, "traceback": [{"path": "tests/api/test_ws_service_dispatch.py", "lineno": 532, "message": "KeyError"}], "longrepr": "ws = <conftest.WSClient object at 0x7f47b129c100>\nrest = <conftest.RESTClient object at 0x7f47b0545340>\n\n    async def test_changed_state_has_context(ws, rest):\n        \"\"\"Changed state entries include context with id.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"lock.ws_ctx_{tag}\"\n        await rest.set_state(eid, \"locked\")\n    \n        resp = await ws.send_command(\n            \"call_service\",\n            domain=\"lock\",\n            service=\"unlock\",\n            service_data={\"entity_id\": eid},\n        )\n>       entry = resp[\"result\"][0]\nE       KeyError: 'result'\n\ntests/api/test_ws_service_dispatch.py:532: KeyError"}, "teardown": {"duration": 0.0011708061210811138, "outcome": "passed"}}, {"nodeid": "tests/api/test_ws_service_dispatch.py::test_multi_entity_service_response", "lineno": 536, "outcome": "failed", "keywords": ["test_multi_entity_service_response", "test_ws_service_dispatch.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.007544223219156265, "outcome": "passed"}, "call": {"duration": 0.004628445021808147, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_ws_service_dispatch.py", "lineno": 551, "message": "assert False is True"}, "traceback": [{"path": "tests/api/test_ws_service_dispatch.py", "lineno": 551, "message": "AssertionError"}], "longrepr": "ws = <conftest.WSClient object at 0x7f47b07ee5b0>\nrest = <conftest.RESTClient object at 0x7f47b07eea90>\n\n    async def test_multi_entity_service_response(ws, rest):\n        \"\"\"call_service with multiple entities returns all changed states.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid_a = f\"light.ws_multi_a_{tag}\"\n        eid_b = f\"light.ws_multi_b_{tag}\"\n        await rest.set_state(eid_a, \"off\")\n        await rest.set_state(eid_b, \"off\")\n    \n        resp = await ws.send_command(\n            \"call_service\",\n            domain=\"light\",\n            service=\"turn_on\",\n            service_data={\"entity_id\": [eid_a, eid_b]},\n        )\n>       assert resp[\"success\"] is True\nE       assert False is True\n\ntests/api/test_ws_service_dispatch.py:551: AssertionError"}, "teardown": {"duration": 0.0010970430448651314, "outcome": "passed"}}, {"nodeid": "tests/api/test_ws_service_dispatch.py::test_toggle_response_reflects_new_state", "lineno": 558, "outcome": "failed", "keywords": ["test_toggle_response_reflects_new_state", "test_ws_service_dispatch.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.007773854304105043, "outcome": "passed"}, "call": {"duration": 0.003122052177786827, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_ws_service_dispatch.py", "lineno": 571, "message": "KeyError: 'result'"}, "traceback": [{"path": "tests/api/test_ws_service_dispatch.py", "lineno": 571, "message": "KeyError"}], "longrepr": "ws = <conftest.WSClient object at 0x7f47b0965280>\nrest = <conftest.RESTClient object at 0x7f47b0696280>\n\n    async def test_toggle_response_reflects_new_state(ws, rest):\n        \"\"\"Toggle response shows the new (toggled) state.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"switch.ws_toggle_{tag}\"\n        await rest.set_state(eid, \"on\")\n    \n        resp = await ws.send_command(\n            \"call_service\",\n            domain=\"switch\",\n            service=\"toggle\",\n            service_data={\"entity_id\": eid},\n        )\n>       entry = resp[\"result\"][0]\nE       KeyError: 'result'\n\ntests/api/test_ws_service_dispatch.py:571: KeyError"}, "teardown": {"duration": 0.0012271422892808914, "outcome": "passed"}}, {"nodeid": "tests/api/test_ws_service_dispatch.py::test_service_preserves_attributes_in_response", "lineno": 574, "outcome": "failed", "keywords": ["test_service_preserves_attributes_in_response", "test_ws_service_dispatch.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.007192045915871859, "outcome": "passed"}, "call": {"duration": 0.0032105213031172752, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_ws_service_dispatch.py", "lineno": 587, "message": "KeyError: 'result'"}, "traceback": [{"path": "tests/api/test_ws_service_dispatch.py", "lineno": 587, "message": "KeyError"}], "longrepr": "ws = <conftest.WSClient object at 0x7f47b07ee400>\nrest = <conftest.RESTClient object at 0x7f47b10dec10>\n\n    async def test_service_preserves_attributes_in_response(ws, rest):\n        \"\"\"Service call response preserves existing attributes.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"light.ws_pres_{tag}\"\n        await rest.set_state(eid, \"on\", {\"brightness\": 100, \"friendly_name\": f\"Lamp {tag}\"})\n    \n        resp = await ws.send_command(\n            \"call_service\",\n            domain=\"light\",\n            service=\"turn_off\",\n            service_data={\"entity_id\": eid},\n        )\n>       entry = resp[\"result\"][0]\nE       KeyError: 'result'\n\ntests/api/test_ws_service_dispatch.py:587: KeyError"}, "teardown": {"duration": 0.001174206379801035, "outcome": "passed"}}, {"nodeid": "tests/api/test_ws_service_dispatch.py::test_create_notification", "lineno": 595, "outcome": "passed", "keywords": ["test_create_notification", "test_ws_service_dispatch.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.0023927660658955574, "outcome": "passed"}, "call": {"duration": 0.0007518730126321316, "outcome": "passed"}, "teardown": {"duration": 0.000712553970515728, "outcome": "passed"}}, {"nodeid": "tests/api/test_ws_service_dispatch.py::test_get_notifications", "lineno": 611, "outcome": "failed", "keywords": ["test_get_notifications", "test_ws_service_dispatch.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.0021758736111223698, "outcome": "passed"}, "call": {"duration": 0.000675759743899107, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_ws_service_dispatch.py", "lineno": 615, "message": "AssertionError: assert False is True\n +  where False = <built-in method get of dict object at 0x7f47b0d519c0>('success', False)\n +    where <built-in method get of dict object at 0x7f47b0d519c0> = {'error': {'code': 'unknown_command', 'message': 'Unknown command.'}, 'id': 1, 'success': False, 'type': 'result'}.get"}, "traceback": [{"path": "tests/api/test_ws_service_dispatch.py", "lineno": 615, "message": "AssertionError"}], "longrepr": "ws = <conftest.WSClient object at 0x7f47b05aaeb0>\n\n    async def test_get_notifications(ws):\n        \"\"\"WS get_notifications returns list.\"\"\"\n        resp = await ws.send_command(\"get_notifications\")\n>       assert resp.get(\"success\", False) is True\nE       AssertionError: assert False is True\nE        +  where False = <built-in method get of dict object at 0x7f47b0d519c0>('success', False)\nE        +    where <built-in method get of dict object at 0x7f47b0d519c0> = {'error': {'code': 'unknown_command', 'message': 'Unknown command.'}, 'id': 1, 'success': False, 'type': 'result'}.get\n\ntests/api/test_ws_service_dispatch.py:615: AssertionError"}, "teardown": {"duration": 0.0011048880405724049, "outcome": "passed"}}, {"nodeid": "tests/api/test_ws_service_dispatch.py::test_create_and_list_notification", "lineno": 619, "outcome": "failed", "keywords": ["test_create_and_list_notification", "test_ws_service_dispatch.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.0025954358279705048, "outcome": "passed"}, "call": {"duration": 0.0010143117979168892, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_ws_service_dispatch.py", "lineno": 641, "message": "AssertionError: assert 'list_85b002cc' in []"}, "traceback": [{"path": "tests/api/test_ws_service_dispatch.py", "lineno": 641, "message": "AssertionError"}], "longrepr": "ws = <conftest.WSClient object at 0x7f47b10de460>\n\n    async def test_create_and_list_notification(ws):\n        \"\"\"Created notification appears in get_notifications.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        notif_id = f\"list_{tag}\"\n    \n        # Create\n        await ws.send_command(\n            \"call_service\",\n            domain=\"persistent_notification\",\n            service=\"create\",\n            service_data={\n                \"notification_id\": notif_id,\n                \"title\": \"Listed\",\n                \"message\": \"Should appear in list\",\n            },\n        )\n    \n        # List\n        resp = await ws.send_command(\"get_notifications\")\n        result = resp.get(\"result\", [])\n        ids = [n[\"notification_id\"] for n in result]\n>       assert notif_id in ids\nE       AssertionError: assert 'list_85b002cc' in []\n\ntests/api/test_ws_service_dispatch.py:641: AssertionError"}, "teardown": {"duration": 0.0012026061303913593, "outcome": "passed"}}, {"nodeid": "tests/api/test_ws_service_dispatch.py::test_notification_fields", "lineno": 643, "outcome": "failed", "keywords": ["test_notification_fields", "test_ws_service_dispatch.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.0026634251698851585, "outcome": "passed"}, "call": {"duration": 0.0011427043937146664, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_ws_service_dispatch.py", "lineno": 663, "message": "assert 0 == 1\n +  where 0 = len([])"}, "traceback": [{"path": "tests/api/test_ws_service_dispatch.py", "lineno": 663, "message": "AssertionError"}], "longrepr": "ws = <conftest.WSClient object at 0x7f47b053fb80>\n\n    async def test_notification_fields(ws):\n        \"\"\"Created notification has title, message, created_at.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        notif_id = f\"fields_{tag}\"\n    \n        await ws.send_command(\n            \"call_service\",\n            domain=\"persistent_notification\",\n            service=\"create\",\n            service_data={\n                \"notification_id\": notif_id,\n                \"title\": \"My Title\",\n                \"message\": \"My Message\",\n            },\n        )\n    \n        resp = await ws.send_command(\"get_notifications\")\n        result = resp.get(\"result\", [])\n        found = [n for n in result if n[\"notification_id\"] == notif_id]\n>       assert len(found) == 1\nE       assert 0 == 1\nE        +  where 0 = len([])\n\ntests/api/test_ws_service_dispatch.py:663: AssertionError"}, "teardown": {"duration": 0.0012050028890371323, "outcome": "passed"}}, {"nodeid": "tests/api/test_ws_service_dispatch.py::test_dismiss_notification", "lineno": 668, "outcome": "failed", "keywords": ["test_dismiss_notification", "test_ws_service_dispatch.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.0023803748190402985, "outcome": "passed"}, "call": {"duration": 0.0009763292036950588, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_ws_service_dispatch.py", "lineno": 691, "message": "AssertionError: assert False is True\n +  where False = <built-in method get of dict object at 0x7f47b117a7c0>('success', False)\n +    where <built-in method get of dict object at 0x7f47b117a7c0> = {'error': {'code': 'unknown_command', 'message': 'Unknown command.'}, 'id': 2, 'success': False, 'type': 'result'}.get"}, "traceback": [{"path": "tests/api/test_ws_service_dispatch.py", "lineno": 691, "message": "AssertionError"}], "longrepr": "ws = <conftest.WSClient object at 0x7f47b0ee6580>\n\n    async def test_dismiss_notification(ws):\n        \"\"\"WS persistent_notification/dismiss removes notification.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        notif_id = f\"dismiss_{tag}\"\n    \n        # Create\n        await ws.send_command(\n            \"call_service\",\n            domain=\"persistent_notification\",\n            service=\"create\",\n            service_data={\n                \"notification_id\": notif_id,\n                \"title\": \"To Dismiss\",\n                \"message\": \"Going away\",\n            },\n        )\n    \n        # Dismiss\n        resp = await ws.send_command(\n            \"persistent_notification/dismiss\",\n            notification_id=notif_id,\n        )\n>       assert resp.get(\"success\", False) is True\nE       AssertionError: assert False is True\nE        +  where False = <built-in method get of dict object at 0x7f47b117a7c0>('success', False)\nE        +    where <built-in method get of dict object at 0x7f47b117a7c0> = {'error': {'code': 'unknown_command', 'message': 'Unknown command.'}, 'id': 2, 'success': False, 'type': 'result'}.get\n\ntests/api/test_ws_service_dispatch.py:691: AssertionError"}, "teardown": {"duration": 0.0010636011138558388, "outcome": "passed"}}, {"nodeid": "tests/api/test_ws_service_dispatch.py::test_dismiss_all_notifications", "lineno": 698, "outcome": "passed", "keywords": ["test_dismiss_all_notifications", "test_ws_service_dispatch.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.002517187036573887, "outcome": "passed"}, "call": {"duration": 0.0014015119522809982, "outcome": "passed"}, "teardown": {"duration": 0.0006300103850662708, "outcome": "passed"}}, {"nodeid": "tests/api/test_ws_service_dispatch.py::test_overwrite_notification", "lineno": 731, "outcome": "failed", "keywords": ["test_overwrite_notification", "test_ws_service_dispatch.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.002200766932219267, "outcome": "passed"}, "call": {"duration": 0.0012567793019115925, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_ws_service_dispatch.py", "lineno": 761, "message": "assert 0 == 1\n +  where 0 = len([])"}, "traceback": [{"path": "tests/api/test_ws_service_dispatch.py", "lineno": 761, "message": "AssertionError"}], "longrepr": "ws = <conftest.WSClient object at 0x7f47b12b9550>\n\n    async def test_overwrite_notification(ws):\n        \"\"\"Creating notification with same ID overwrites it.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        notif_id = f\"overwrite_{tag}\"\n    \n        await ws.send_command(\n            \"call_service\",\n            domain=\"persistent_notification\",\n            service=\"create\",\n            service_data={\n                \"notification_id\": notif_id,\n                \"title\": \"V1\",\n                \"message\": \"First\",\n            },\n        )\n    \n        await ws.send_command(\n            \"call_service\",\n            domain=\"persistent_notification\",\n            service=\"create\",\n            service_data={\n                \"notification_id\": notif_id,\n                \"title\": \"V2\",\n                \"message\": \"Second\",\n            },\n        )\n    \n        resp = await ws.send_command(\"get_notifications\")\n        found = [n for n in resp.get(\"result\", []) if n[\"notification_id\"] == notif_id]\n>       assert len(found) == 1\nE       assert 0 == 1\nE        +  where 0 = len([])\n\ntests/api/test_ws_service_dispatch.py:761: AssertionError"}, "teardown": {"duration": 0.0010445918887853622, "outcome": "passed"}}, {"nodeid": "tests/api/test_ws_service_dispatch.py::test_ws_notification_dismiss_via_call_service", "lineno": 765, "outcome": "passed", "keywords": ["test_ws_notification_dismiss_via_call_service", "test_ws_service_dispatch.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.0024244762025773525, "outcome": "passed"}, "call": {"duration": 0.0009053070098161697, "outcome": "passed"}, "teardown": {"duration": 0.0006381808780133724, "outcome": "passed"}}, {"nodeid": "tests/api/test_ws_service_dispatch.py::test_ws_unsubscribe_events", "lineno": 793, "outcome": "passed", "keywords": ["test_ws_unsubscribe_events", "test_ws_service_dispatch.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.007194484118372202, "outcome": "passed"}, "call": {"duration": 0.504276626277715, "outcome": "passed"}, "teardown": {"duration": 0.0014383373782038689, "outcome": "passed"}}, {"nodeid": "tests/api/test_ws_subscribe.py::test_ws_connect_and_auth", "lineno": 20, "outcome": "passed", "keywords": ["test_ws_connect_and_auth", "test_ws_subscribe.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.003256239928305149, "outcome": "passed"}, "call": {"duration": 0.00038637779653072357, "outcome": "passed"}, "teardown": {"duration": 0.0009194491431117058, "outcome": "passed"}}, {"nodeid": "tests/api/test_ws_subscribe.py::test_ws_ping", "lineno": 30, "outcome": "passed", "keywords": ["test_ws_ping", "test_ws_subscribe.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.004660644102841616, "outcome": "passed"}, "call": {"duration": 0.0007634880021214485, "outcome": "passed"}, "teardown": {"duration": 0.0010401802137494087, "outcome": "passed"}}, {"nodeid": "tests/api/test_ws_subscribe.py::test_ws_repeated_pings[multiple_pings]", "lineno": 36, "outcome": "passed", "keywords": ["test_ws_repeated_pings[multiple_pings]", "parametrize", "pytestmark", "multiple_pings", "test_ws_subscribe.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.003585078287869692, "outcome": "passed"}, "call": {"duration": 0.0018814471550285816, "outcome": "passed"}, "teardown": {"duration": 0.0008623031899333, "outcome": "passed"}}, {"nodeid": "tests/api/test_ws_subscribe.py::test_ws_repeated_pings[rapid_pings]", "lineno": 36, "outcome": "passed", "keywords": ["test_ws_repeated_pings[rapid_pings]", "parametrize", "pytestmark", "rapid_pings", "test_ws_subscribe.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.0025895261205732822, "outcome": "passed"}, "call": {"duration": 0.0026883487589657307, "outcome": "passed"}, "teardown": {"duration": 0.0008123163133859634, "outcome": "passed"}}, {"nodeid": "tests/api/test_ws_subscribe.py::test_ws_get_states", "lineno": 48, "outcome": "passed", "keywords": ["test_ws_get_states", "test_ws_subscribe.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.002658537123352289, "outcome": "passed"}, "call": {"duration": 0.0022385641932487488, "outcome": "passed"}, "teardown": {"duration": 0.0007856432348489761, "outcome": "passed"}}, {"nodeid": "tests/api/test_ws_subscribe.py::test_ws_subscribe_events", "lineno": 58, "outcome": "passed", "keywords": ["test_ws_subscribe_events", "test_ws_subscribe.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.0071236491203308105, "outcome": "passed"}, "call": {"duration": 0.002877707127481699, "outcome": "passed"}, "teardown": {"duration": 0.0009575630538165569, "outcome": "passed"}}, {"nodeid": "tests/api/test_ws_subscribe.py::test_ws_event_contains_entity_id", "lineno": 72, "outcome": "passed", "keywords": ["test_ws_event_contains_entity_id", "test_ws_subscribe.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.007089411839842796, "outcome": "passed"}, "call": {"duration": 0.004289500880986452, "outcome": "passed"}, "teardown": {"duration": 0.0010768920183181763, "outcome": "passed"}}, {"nodeid": "tests/api/test_ws_subscribe.py::test_ws_event_has_old_and_new_state", "lineno": 82, "outcome": "passed", "keywords": ["test_ws_event_has_old_and_new_state", "test_ws_subscribe.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.008084019646048546, "outcome": "passed"}, "call": {"duration": 0.004782679956406355, "outcome": "passed"}, "teardown": {"duration": 0.00081666000187397, "outcome": "passed"}}, {"nodeid": "tests/api/test_ws_subscribe.py::test_ws_multiple_subscriptions", "lineno": 100, "outcome": "passed", "keywords": ["test_ws_multiple_subscriptions", "test_ws_subscribe.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.007508561015129089, "outcome": "passed"}, "call": {"duration": 0.005506538320332766, "outcome": "passed"}, "teardown": {"duration": 0.000998517032712698, "outcome": "passed"}}, {"nodeid": "tests/api/test_ws_subscribe.py::test_ws_subscribe_unsubscribe", "lineno": 126, "outcome": "passed", "keywords": ["test_ws_subscribe_unsubscribe", "test_ws_subscribe.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.002546139992773533, "outcome": "passed"}, "call": {"duration": 0.0008867797441780567, "outcome": "passed"}, "teardown": {"duration": 0.0006959442980587482, "outcome": "passed"}}, {"nodeid": "tests/api/test_ws_subscribe.py::test_ws_subscribe_then_unsubscribe_no_leak", "lineno": 136, "outcome": "passed", "keywords": ["test_ws_subscribe_then_unsubscribe_no_leak", "test_ws_subscribe.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.007399694062769413, "outcome": "passed"}, "call": {"duration": 1.004769379273057, "outcome": "passed"}, "teardown": {"duration": 0.0015455610118806362, "outcome": "passed"}}, {"nodeid": "tests/api/test_ws_subscribe.py::test_ws_unsubscribe_nonexistent_id", "lineno": 158, "outcome": "passed", "keywords": ["test_ws_unsubscribe_nonexistent_id", "test_ws_subscribe.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.0038454579189419746, "outcome": "passed"}, "call": {"duration": 0.0008571101352572441, "outcome": "passed"}, "teardown": {"duration": 0.001032915897667408, "outcome": "passed"}}, {"nodeid": "tests/api/test_ws_subscribe.py::test_ws_sequential_commands", "lineno": 169, "outcome": "failed", "keywords": ["test_ws_sequential_commands", "test_ws_subscribe.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.003508463967591524, "outcome": "passed"}, "call": {"duration": 0.004784672986716032, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_ws_subscribe.py", "lineno": 185, "message": "AssertionError: assert False is True\n +  where False = <built-in method get of dict object at 0x7f47b127ea00>('success', False)\n +    where <built-in method get of dict object at 0x7f47b127ea00> = {'event': {'listeners': {'all': False, 'domains': [], 'entities': [], 'time': False}, 'result': 2}, 'id': 3, 'type': 'event'}.get"}, "traceback": [{"path": "tests/api/test_ws_subscribe.py", "lineno": 185, "message": "AssertionError"}], "longrepr": "ws = <conftest.WSClient object at 0x7f47b06a9f40>\n\n    async def test_ws_sequential_commands(ws):\n        \"\"\"Multiple sequential WS commands all succeed.\"\"\"\n        # Ping\n        assert await ws.ping() is True\n    \n        # Get config\n        r1 = await ws.send_command(\"get_config\")\n        assert r1.get(\"success\", False) is True\n    \n        # Render template\n        r2 = await ws.send_command(\"render_template\", template=\"{{ 1 + 1 }}\")\n        assert r2.get(\"success\", False) is True\n    \n        # Get services\n        r3 = await ws.send_command(\"get_services\")\n>       assert r3.get(\"success\", False) is True\nE       AssertionError: assert False is True\nE        +  where False = <built-in method get of dict object at 0x7f47b127ea00>('success', False)\nE        +    where <built-in method get of dict object at 0x7f47b127ea00> = {'event': {'listeners': {'all': False, 'domains': [], 'entities': [], 'time': False}, 'result': 2}, 'id': 3, 'type': 'event'}.get\n\ntests/api/test_ws_subscribe.py:185: AssertionError"}, "teardown": {"duration": 0.001182463951408863, "outcome": "passed"}}, {"nodeid": "tests/api/test_ws_subscribe.py::test_ws_response_ids_increment", "lineno": 187, "outcome": "passed", "keywords": ["test_ws_response_ids_increment", "test_ws_subscribe.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.003402368165552616, "outcome": "passed"}, "call": {"duration": 0.0009215269237756729, "outcome": "passed"}, "teardown": {"duration": 0.0007717600092291832, "outcome": "passed"}}, {"nodeid": "tests/api/test_ws_subscribe.py::test_ws_interleaved_commands", "lineno": 197, "outcome": "passed", "keywords": ["test_ws_interleaved_commands", "test_ws_subscribe.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.007408691104501486, "outcome": "passed"}, "call": {"duration": 0.0026758979074656963, "outcome": "passed"}, "teardown": {"duration": 0.0009409012272953987, "outcome": "passed"}}, {"nodeid": "tests/api/test_ws_subscribe.py::test_ws_get_config_field[version]", "lineno": 216, "outcome": "passed", "keywords": ["test_ws_get_config_field[version]", "parametrize", "pytestmark", "version", "test_ws_subscribe.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.0032853735610842705, "outcome": "passed"}, "call": {"duration": 0.000585152767598629, "outcome": "passed"}, "teardown": {"duration": 0.0006868159398436546, "outcome": "passed"}}, {"nodeid": "tests/api/test_ws_subscribe.py::test_ws_get_config_field[location_name]", "lineno": 216, "outcome": "passed", "keywords": ["test_ws_get_config_field[location_name]", "parametrize", "pytestmark", "location_name", "test_ws_subscribe.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.0025395420379936695, "outcome": "passed"}, "call": {"duration": 0.0005619451403617859, "outcome": "passed"}, "teardown": {"duration": 0.0006758030503988266, "outcome": "passed"}}, {"nodeid": "tests/api/test_ws_subscribe.py::test_ws_get_config_field[latitude]", "lineno": 216, "outcome": "passed", "keywords": ["test_ws_get_config_field[latitude]", "parametrize", "pytestmark", "latitude", "test_ws_subscribe.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.002296644728630781, "outcome": "passed"}, "call": {"duration": 0.0005893269553780556, "outcome": "passed"}, "teardown": {"duration": 0.0007574157789349556, "outcome": "passed"}}, {"nodeid": "tests/api/test_ws_subscribe.py::test_ws_get_config_field[longitude]", "lineno": 216, "outcome": "passed", "keywords": ["test_ws_get_config_field[longitude]", "parametrize", "pytestmark", "longitude", "test_ws_subscribe.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.002579675056040287, "outcome": "passed"}, "call": {"duration": 0.0007397620938718319, "outcome": "passed"}, "teardown": {"duration": 0.0008126050233840942, "outcome": "passed"}}, {"nodeid": "tests/api/test_ws_subscribe.py::test_ws_get_services_returns_list", "lineno": 231, "outcome": "failed", "keywords": ["test_ws_get_services_returns_list", "test_ws_subscribe.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.0024686679244041443, "outcome": "passed"}, "call": {"duration": 0.001470751129090786, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_ws_subscribe.py", "lineno": 237, "message": "AssertionError: assert False\n +  where False = isinstance({'automation': {'reload': {'description': 'Reloads the automation configuration.', 'fields': {}, 'name': 'Reload'}, 't...e', 'required': True, 'selector': {'number': {...}}}}, 'name': 'Set', 'target': {'entity': [{'domain': [...]}]}}}, ...}, list)"}, "traceback": [{"path": "tests/api/test_ws_subscribe.py", "lineno": 237, "message": "AssertionError"}], "longrepr": "ws = <conftest.WSClient object at 0x7f47b0761a00>\n\n    async def test_ws_get_services_returns_list(ws):\n        \"\"\"WS get_services returns a list of domain/service entries.\"\"\"\n        resp = await ws.send_command(\"get_services\")\n        assert resp.get(\"success\", False) is True\n        result = resp.get(\"result\", [])\n>       assert isinstance(result, list)\nE       AssertionError: assert False\nE        +  where False = isinstance({'automation': {'reload': {'description': 'Reloads the automation configuration.', 'fields': {}, 'name': 'Reload'}, 't...e', 'required': True, 'selector': {'number': {...}}}}, 'name': 'Set', 'target': {'entity': [{'domain': [...]}]}}}, ...}, list)\n\ntests/api/test_ws_subscribe.py:237: AssertionError"}, "teardown": {"duration": 0.0007259859703481197, "outcome": "passed"}}, {"nodeid": "tests/api/test_ws_subscribe.py::test_ws_call_service_light", "lineno": 248, "outcome": "failed", "keywords": ["test_ws_call_service_light", "test_ws_subscribe.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.007361277937889099, "outcome": "passed"}, "call": {"duration": 0.003195473924279213, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_ws_subscribe.py", "lineno": 261, "message": "AssertionError: assert False is True\n +  where False = <built-in method get of dict object at 0x7f47b0e43a40>('success', False)\n +    where <built-in method get of dict object at 0x7f47b0e43a40> = {'error': {'code': 'not_found', 'message': 'Service light.turn_on not found.', 'translation_domain': 'homeassistant', 'translation_key': 'service_not_found', ...}, 'id': 1, 'success': False, 'type': 'result'}.get"}, "traceback": [{"path": "tests/api/test_ws_subscribe.py", "lineno": 261, "message": "AssertionError"}], "longrepr": "ws = <conftest.WSClient object at 0x7f47b1aa6070>\nrest = <conftest.RESTClient object at 0x7f47b106cfd0>\n\n    async def test_ws_call_service_light(ws, rest):\n        \"\"\"WS call_service for light works.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"light.wsord_{tag}\"\n        await rest.set_state(eid, \"off\")\n    \n        resp = await ws.send_command(\n            \"call_service\",\n            domain=\"light\",\n            service=\"turn_on\",\n            service_data={\"entity_id\": eid},\n        )\n>       assert resp.get(\"success\", False) is True\nE       AssertionError: assert False is True\nE        +  where False = <built-in method get of dict object at 0x7f47b0e43a40>('success', False)\nE        +    where <built-in method get of dict object at 0x7f47b0e43a40> = {'error': {'code': 'not_found', 'message': 'Service light.turn_on not found.', 'translation_domain': 'homeassistant', 'translation_key': 'service_not_found', ...}, 'id': 1, 'success': False, 'type': 'result'}.get\n\ntests/api/test_ws_subscribe.py:261: AssertionError"}, "teardown": {"duration": 0.0011655036360025406, "outcome": "passed"}}, {"nodeid": "tests/api/test_ws_subscribe.py::test_ws_unknown_command", "lineno": 270, "outcome": "passed", "keywords": ["test_ws_unknown_command", "test_ws_subscribe.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.002676287665963173, "outcome": "passed"}, "call": {"duration": 0.0005586878396570683, "outcome": "passed"}, "teardown": {"duration": 0.0006903749890625477, "outcome": "passed"}}, {"nodeid": "tests/api/test_ws_subscribe.py::test_ws_call_service_empty_domain", "lineno": 276, "outcome": "passed", "keywords": ["test_ws_call_service_empty_domain", "test_ws_subscribe.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.0024364697746932507, "outcome": "passed"}, "call": {"duration": 0.000568140298128128, "outcome": "passed"}, "teardown": {"duration": 0.0006308043375611305, "outcome": "passed"}}, {"nodeid": "tests/api/test_ws_subscribe.py::test_ws_render_template_valid", "lineno": 292, "outcome": "failed", "keywords": ["test_ws_render_template_valid", "test_ws_subscribe.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.002299246843904257, "outcome": "passed"}, "call": {"duration": 0.0008624549955129623, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_ws_subscribe.py", "lineno": 300, "message": "AssertionError: assert '2' in 'None'\n +  where 'None' = str(None)\n +    where None = <built-in method get of dict object at 0x7f47b1099d00>('result', '')\n +      where <built-in method get of dict object at 0x7f47b1099d00> = {'id': 1, 'result': None, 'success': True, 'type': 'result'}.get"}, "traceback": [{"path": "tests/api/test_ws_subscribe.py", "lineno": 300, "message": "AssertionError"}], "longrepr": "ws = <conftest.WSClient object at 0x7f47b0627820>\n\n    async def test_ws_render_template_valid(ws):\n        \"\"\"render_template with valid template returns result.\"\"\"\n        resp = await ws.send_command(\n            \"render_template\",\n            template=\"{{ 1 + 1 }}\",\n        )\n        assert resp.get(\"success\", False) is True\n>       assert \"2\" in str(resp.get(\"result\", \"\"))\nE       AssertionError: assert '2' in 'None'\nE        +  where 'None' = str(None)\nE        +    where None = <built-in method get of dict object at 0x7f47b1099d00>('result', '')\nE        +      where <built-in method get of dict object at 0x7f47b1099d00> = {'id': 1, 'result': None, 'success': True, 'type': 'result'}.get\n\ntests/api/test_ws_subscribe.py:300: AssertionError"}, "teardown": {"duration": 0.0009008198976516724, "outcome": "passed"}}, {"nodeid": "tests/api/test_ws_subscribe.py::test_ws_render_template_error", "lineno": 302, "outcome": "failed", "keywords": ["test_ws_render_template_error", "test_ws_subscribe.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.0026771887205541134, "outcome": "passed"}, "call": {"duration": 0.0037559522315859795, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_ws_subscribe.py", "lineno": 310, "message": "assert (True is False or 'error' in \"{'id': 1, 'type': 'result', 'success': true, 'result': none}\")\n +  where True = <built-in method get of dict object at 0x7f47b0d9cc00>('success', True)\n +    where <built-in method get of dict object at 0x7f47b0d9cc00> = {'id': 1, 'result': None, 'success': True, 'type': 'result'}.get\n +  and   \"{'id': 1, 'type': 'result', 'success': true, 'result': none}\" = <built-in method lower of str object at 0x7f47b0f9e830>()\n +    where <built-in method lower of str object at 0x7f47b0f9e830> = \"{'id': 1, 'type': 'result', 'success': True, 'result': None}\".lower\n +      where \"{'id': 1, 'type': 'result', 'success': True, 'result': None}\" = str({'id': 1, 'result': None, 'success': True, 'type': 'result'})"}, "traceback": [{"path": "tests/api/test_ws_subscribe.py", "lineno": 310, "message": "AssertionError"}], "longrepr": "ws = <conftest.WSClient object at 0x7f47b07cc7c0>\n\n    async def test_ws_render_template_error(ws):\n        \"\"\"render_template with bad filter returns error.\"\"\"\n        resp = await ws.send_command(\n            \"render_template\",\n            template=\"{{ x | nonexistent_filter }}\",\n        )\n        # Should return error, not crash\n>       assert resp.get(\"success\", True) is False or \"error\" in str(resp).lower()\nE       assert (True is False or 'error' in \"{'id': 1, 'type': 'result', 'success': true, 'result': none}\")\nE        +  where True = <built-in method get of dict object at 0x7f47b0d9cc00>('success', True)\nE        +    where <built-in method get of dict object at 0x7f47b0d9cc00> = {'id': 1, 'result': None, 'success': True, 'type': 'result'}.get\nE        +  and   \"{'id': 1, 'type': 'result', 'success': true, 'result': none}\" = <built-in method lower of str object at 0x7f47b0f9e830>()\nE        +    where <built-in method lower of str object at 0x7f47b0f9e830> = \"{'id': 1, 'type': 'result', 'success': True, 'result': None}\".lower\nE        +      where \"{'id': 1, 'type': 'result', 'success': True, 'result': None}\" = str({'id': 1, 'result': None, 'success': True, 'type': 'result'})\n\ntests/api/test_ws_subscribe.py:310: AssertionError"}, "teardown": {"duration": 0.0009251758456230164, "outcome": "passed"}}, {"nodeid": "tests/api/test_ws_subscription_delivery.py::test_ws_event_has_event_type", "lineno": 18, "outcome": "passed", "keywords": ["test_ws_event_has_event_type", "test_ws_subscription_delivery.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.007802824955433607, "outcome": "passed"}, "call": {"duration": 0.004621373955160379, "outcome": "passed"}, "teardown": {"duration": 0.0009678369387984276, "outcome": "passed"}}, {"nodeid": "tests/api/test_ws_subscription_delivery.py::test_ws_event_has_timestamp", "lineno": 27, "outcome": "passed", "keywords": ["test_ws_event_has_timestamp", "test_ws_subscription_delivery.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.007377326022833586, "outcome": "passed"}, "call": {"duration": 0.005922622047364712, "outcome": "passed"}, "teardown": {"duration": 0.0009340429678559303, "outcome": "passed"}}, {"nodeid": "tests/api/test_ws_subscription_delivery.py::test_ws_event_entity_id_matches", "lineno": 36, "outcome": "passed", "keywords": ["test_ws_event_entity_id_matches", "test_ws_subscription_delivery.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.007553329691290855, "outcome": "passed"}, "call": {"duration": 0.004737955052405596, "outcome": "passed"}, "teardown": {"duration": 0.0009589190594851971, "outcome": "passed"}}, {"nodeid": "tests/api/test_ws_subscription_delivery.py::test_ws_event_new_state_has_attributes", "lineno": 46, "outcome": "passed", "keywords": ["test_ws_event_new_state_has_attributes", "test_ws_subscription_delivery.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.007708376739174128, "outcome": "passed"}, "call": {"duration": 0.006752118933945894, "outcome": "passed"}, "teardown": {"duration": 0.0009631291031837463, "outcome": "passed"}}, {"nodeid": "tests/api/test_ws_subscription_delivery.py::test_ws_event_old_state_preserved", "lineno": 57, "outcome": "passed", "keywords": ["test_ws_event_old_state_preserved", "test_ws_subscription_delivery.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.007481981068849564, "outcome": "passed"}, "call": {"duration": 0.004520244896411896, "outcome": "passed"}, "teardown": {"duration": 0.0009378283284604549, "outcome": "passed"}}, {"nodeid": "tests/api/test_ws_subscription_delivery.py::test_ws_subscribe_receives_state_change", "lineno": 68, "outcome": "passed", "keywords": ["test_ws_subscribe_receives_state_change", "test_ws_subscription_delivery.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.00756159657612443, "outcome": "passed"}, "call": {"duration": 0.005290345288813114, "outcome": "passed"}, "teardown": {"duration": 0.0009087962098419666, "outcome": "passed"}}, {"nodeid": "tests/api/test_ws_subscription_delivery.py::test_ws_event_has_new_state", "lineno": 86, "outcome": "passed", "keywords": ["test_ws_event_has_new_state", "test_ws_subscription_delivery.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.007671288680285215, "outcome": "passed"}, "call": {"duration": 0.0033599897287786007, "outcome": "passed"}, "teardown": {"duration": 0.0008475678041577339, "outcome": "passed"}}, {"nodeid": "tests/api/test_ws_subscription_delivery.py::test_ws_state_changed_event_format", "lineno": 106, "outcome": "passed", "keywords": ["test_ws_state_changed_event_format", "test_ws_subscription_delivery.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.0073653897270560265, "outcome": "passed"}, "call": {"duration": 0.0069967349991202354, "outcome": "passed"}, "teardown": {"duration": 0.0009108367376029491, "outcome": "passed"}}, {"nodeid": "tests/api/test_ws_subscription_delivery.py::test_ws_event_includes_context", "lineno": 120, "outcome": "passed", "keywords": ["test_ws_event_includes_context", "test_ws_subscription_delivery.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.007537385914474726, "outcome": "passed"}, "call": {"duration": 0.0034671779721975327, "outcome": "passed"}, "teardown": {"duration": 0.0008606393821537495, "outcome": "passed"}}, {"nodeid": "tests/api/test_ws_subscription_delivery.py::test_ws_event_new_state_has_timestamp_field[last_changed]", "lineno": 138, "outcome": "passed", "keywords": ["test_ws_event_new_state_has_timestamp_field[last_changed]", "parametrize", "pytestmark", "last_changed", "test_ws_subscription_delivery.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.007413684390485287, "outcome": "passed"}, "call": {"duration": 0.003223543055355549, "outcome": "passed"}, "teardown": {"duration": 0.0010419413447380066, "outcome": "passed"}}, {"nodeid": "tests/api/test_ws_subscription_delivery.py::test_ws_event_new_state_has_timestamp_field[last_updated]", "lineno": 138, "outcome": "failed", "keywords": ["test_ws_event_new_state_has_timestamp_field[last_updated]", "parametrize", "pytestmark", "last_updated", "test_ws_subscription_delivery.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.011339807882905006, "outcome": "passed"}, "call": {"duration": 5.008498151786625, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/asyncio/tasks.py", "lineno": 492, "message": "asyncio.exceptions.TimeoutError"}, "traceback": [{"path": "tests/api/test_ws_subscription_delivery.py", "lineno": 144, "message": ""}, {"path": "tests/conftest.py", "lineno": 185, "message": "in recv_event"}, {"path": "../../anaconda3/lib/python3.9/asyncio/tasks.py", "lineno": 492, "message": "TimeoutError"}], "longrepr": "self = <websockets.asyncio.client.ClientConnection object at 0x7f47b0563e50>\ndecode = None\n\n    async def recv(self, decode: bool | None = None) -> Data:\n        \"\"\"\n        Receive the next message.\n    \n        When the connection is closed, :meth:`recv` raises\n        :exc:`~websockets.exceptions.ConnectionClosed`. Specifically, it raises\n        :exc:`~websockets.exceptions.ConnectionClosedOK` after a normal closure\n        and :exc:`~websockets.exceptions.ConnectionClosedError` after a protocol\n        error or a network failure. This is how you detect the end of the\n        message stream.\n    \n        Canceling :meth:`recv` is safe. There's no risk of losing data. The next\n        invocation of :meth:`recv` will return the next message.\n    \n        This makes it possible to enforce a timeout by wrapping :meth:`recv` in\n        :func:`~asyncio.timeout` or :func:`~asyncio.wait_for`.\n    \n        When the message is fragmented, :meth:`recv` waits until all fragments\n        are received, reassembles them, and returns the whole message.\n    \n        Args:\n            decode: Set this flag to override the default behavior of returning\n                :class:`str` or :class:`bytes`. See below for details.\n    \n        Returns:\n            A string (:class:`str`) for a Text_ frame or a bytestring\n            (:class:`bytes`) for a Binary_ frame.\n    \n            .. _Text: https://datatracker.ietf.org/doc/html/rfc6455#section-5.6\n            .. _Binary: https://datatracker.ietf.org/doc/html/rfc6455#section-5.6\n    \n            You may override this behavior with the ``decode`` argument:\n    \n            * Set ``decode=False`` to disable UTF-8 decoding of Text_ frames and\n              return a bytestring (:class:`bytes`). This improves performance\n              when decoding isn't needed, for example if the message contains\n              JSON and you're using a JSON library that expects a bytestring.\n            * Set ``decode=True`` to force UTF-8 decoding of Binary_ frames\n              and return a string (:class:`str`). This may be useful for\n              servers that send binary frames instead of text frames.\n    \n        Raises:\n            ConnectionClosed: When the connection is closed.\n            ConcurrencyError: If two coroutines call :meth:`recv` or\n                :meth:`recv_streaming` concurrently.\n    \n        \"\"\"\n        try:\n>           return await self.recv_messages.get(decode)\n\n../../anaconda3/lib/python3.9/site-packages/websockets/asyncio/connection.py:303: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/websockets/asyncio/messages.py:159: in get\n    frame = await self.frames.get(not self.closed)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <websockets.asyncio.messages.SimpleQueue object at 0x7f47b09a7d60>\nblock = True\n\n    async def get(self, block: bool = True) -> T:\n        \"\"\"Remove and return an item from the queue, waiting if necessary.\"\"\"\n        if not self.queue:\n            if not block:\n                raise EOFError(\"stream of frames ended\")\n            assert self.get_waiter is None, \"cannot call get() concurrently\"\n            self.get_waiter = self.loop.create_future()\n            try:\n>               await self.get_waiter\nE               asyncio.exceptions.CancelledError\n\n../../anaconda3/lib/python3.9/site-packages/websockets/asyncio/messages.py:51: CancelledError\n\nDuring handling of the above exception, another exception occurred:\n\nfut = <Task cancelled name='Task-3565' coro=<Connection.recv() done, defined at /home/jcrigby/anaconda3/lib/python3.9/site-packages/websockets/asyncio/connection.py:255>>\ntimeout = 5.0\n\n    async def wait_for(fut, timeout, *, loop=None):\n        \"\"\"Wait for the single Future or coroutine to complete, with timeout.\n    \n        Coroutine will be wrapped in Task.\n    \n        Returns result of the Future or coroutine.  When a timeout occurs,\n        it cancels the task and raises TimeoutError.  To avoid the task\n        cancellation, wrap it in shield().\n    \n        If the wait is cancelled, the task is also cancelled.\n    \n        This function is a coroutine.\n        \"\"\"\n        if loop is None:\n            loop = events.get_running_loop()\n        else:\n            warnings.warn(\"The loop argument is deprecated since Python 3.8, \"\n                          \"and scheduled for removal in Python 3.10.\",\n                          DeprecationWarning, stacklevel=2)\n    \n        if timeout is None:\n            return await fut\n    \n        if timeout <= 0:\n            fut = ensure_future(fut, loop=loop)\n    \n            if fut.done():\n                return fut.result()\n    \n            await _cancel_and_wait(fut, loop=loop)\n            try:\n                return fut.result()\n            except exceptions.CancelledError as exc:\n                raise exceptions.TimeoutError() from exc\n    \n        waiter = loop.create_future()\n        timeout_handle = loop.call_later(timeout, _release_waiter, waiter)\n        cb = functools.partial(_release_waiter, waiter)\n    \n        fut = ensure_future(fut, loop=loop)\n        fut.add_done_callback(cb)\n    \n        try:\n            # wait until the future completes or the timeout\n            try:\n                await waiter\n            except exceptions.CancelledError:\n                if fut.done():\n                    return fut.result()\n                else:\n                    fut.remove_done_callback(cb)\n                    # We must ensure that the task is not running\n                    # after wait_for() returns.\n                    # See https://bugs.python.org/issue32751\n                    await _cancel_and_wait(fut, loop=loop)\n                    raise\n    \n            if fut.done():\n                return fut.result()\n            else:\n                fut.remove_done_callback(cb)\n                # We must ensure that the task is not running\n                # after wait_for() returns.\n                # See https://bugs.python.org/issue32751\n                await _cancel_and_wait(fut, loop=loop)\n                # In case task cancellation failed with some\n                # exception, we should re-raise it\n                # See https://bugs.python.org/issue40607\n                try:\n>                   return fut.result()\nE                   asyncio.exceptions.CancelledError\n\n../../anaconda3/lib/python3.9/asyncio/tasks.py:490: CancelledError\n\nThe above exception was the direct cause of the following exception:\n\nws = <conftest.WSClient object at 0x7f47b11dc850>\nrest = <conftest.RESTClient object at 0x7f47b09a7bb0>, field = 'last_updated'\n\n    @pytest.mark.parametrize(\"field\", [\"last_changed\", \"last_updated\"])\n    async def test_ws_event_new_state_has_timestamp_field(ws, rest, field):\n        \"\"\"new_state includes last_changed and last_updated timestamps.\"\"\"\n        sub_id = await ws.subscribe_events()\n        await rest.set_state(\"sensor.ws_evt_ts_field\", \"timed\")\n>       event = await ws.recv_event(timeout=5.0)\n\ntests/api/test_ws_subscription_delivery.py:144: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:185: in recv_event\n    return json.loads(await asyncio.wait_for(self.ws.recv(), timeout))\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nfut = <Task cancelled name='Task-3565' coro=<Connection.recv() done, defined at /home/jcrigby/anaconda3/lib/python3.9/site-packages/websockets/asyncio/connection.py:255>>\ntimeout = 5.0\n\n    async def wait_for(fut, timeout, *, loop=None):\n        \"\"\"Wait for the single Future or coroutine to complete, with timeout.\n    \n        Coroutine will be wrapped in Task.\n    \n        Returns result of the Future or coroutine.  When a timeout occurs,\n        it cancels the task and raises TimeoutError.  To avoid the task\n        cancellation, wrap it in shield().\n    \n        If the wait is cancelled, the task is also cancelled.\n    \n        This function is a coroutine.\n        \"\"\"\n        if loop is None:\n            loop = events.get_running_loop()\n        else:\n            warnings.warn(\"The loop argument is deprecated since Python 3.8, \"\n                          \"and scheduled for removal in Python 3.10.\",\n                          DeprecationWarning, stacklevel=2)\n    \n        if timeout is None:\n            return await fut\n    \n        if timeout <= 0:\n            fut = ensure_future(fut, loop=loop)\n    \n            if fut.done():\n                return fut.result()\n    \n            await _cancel_and_wait(fut, loop=loop)\n            try:\n                return fut.result()\n            except exceptions.CancelledError as exc:\n                raise exceptions.TimeoutError() from exc\n    \n        waiter = loop.create_future()\n        timeout_handle = loop.call_later(timeout, _release_waiter, waiter)\n        cb = functools.partial(_release_waiter, waiter)\n    \n        fut = ensure_future(fut, loop=loop)\n        fut.add_done_callback(cb)\n    \n        try:\n            # wait until the future completes or the timeout\n            try:\n                await waiter\n            except exceptions.CancelledError:\n                if fut.done():\n                    return fut.result()\n                else:\n                    fut.remove_done_callback(cb)\n                    # We must ensure that the task is not running\n                    # after wait_for() returns.\n                    # See https://bugs.python.org/issue32751\n                    await _cancel_and_wait(fut, loop=loop)\n                    raise\n    \n            if fut.done():\n                return fut.result()\n            else:\n                fut.remove_done_callback(cb)\n                # We must ensure that the task is not running\n                # after wait_for() returns.\n                # See https://bugs.python.org/issue32751\n                await _cancel_and_wait(fut, loop=loop)\n                # In case task cancellation failed with some\n                # exception, we should re-raise it\n                # See https://bugs.python.org/issue40607\n                try:\n                    return fut.result()\n                except exceptions.CancelledError as exc:\n>                   raise exceptions.TimeoutError() from exc\nE                   asyncio.exceptions.TimeoutError\n\n../../anaconda3/lib/python3.9/asyncio/tasks.py:492: TimeoutError"}, "teardown": {"duration": 0.001313663087785244, "outcome": "passed"}}, {"nodeid": "tests/api/test_ws_subscription_delivery.py::test_ws_event_subscription_id_matches", "lineno": 148, "outcome": "passed", "keywords": ["test_ws_event_subscription_id_matches", "test_ws_subscription_delivery.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.007564167026430368, "outcome": "passed"}, "call": {"duration": 0.003384067676961422, "outcome": "passed"}, "teardown": {"duration": 0.001063323114067316, "outcome": "passed"}}, {"nodeid": "tests/api/test_ws_subscription_delivery.py::test_ws_service_call_triggers_event", "lineno": 158, "outcome": "failed", "keywords": ["test_ws_service_call_triggers_event", "test_ws_subscription_delivery.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.009458361659199, "outcome": "passed"}, "call": {"duration": 0.00481439521536231, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/light/turn_on'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/api/test_ws_subscription_delivery.py", "lineno": 163, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "ws = <conftest.WSClient object at 0x7f47b0e180a0>\nrest = <conftest.RESTClient object at 0x7f47b0e18d60>\n\n    async def test_ws_service_call_triggers_event(ws, rest):\n        \"\"\"Service call that changes state triggers state_changed event.\"\"\"\n        await rest.set_state(\"light.ws_svc_evt\", \"off\")\n        sub_id = await ws.subscribe_events(\"state_changed\")\n>       await rest.call_service(\"light\", \"turn_on\", {\n            \"entity_id\": \"light.ws_svc_evt\",\n        })\n\ntests/api/test_ws_subscription_delivery.py:163: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/light/turn_on'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0011683502234518528, "outcome": "passed"}}, {"nodeid": "tests/api/test_ws_subscription_delivery.py::test_ws_rapid_state_changes", "lineno": 172, "outcome": "passed", "keywords": ["test_ws_rapid_state_changes", "test_ws_subscription_delivery.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.00781297218054533, "outcome": "passed"}, "call": {"duration": 0.012623254209756851, "outcome": "passed"}, "teardown": {"duration": 0.001027504913508892, "outcome": "passed"}}, {"nodeid": "tests/api/test_ws_subscription_delivery.py::test_ws_multiple_events_in_order", "lineno": 195, "outcome": "passed", "keywords": ["test_ws_multiple_events_in_order", "test_ws_subscription_delivery.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.013962095603346825, "outcome": "passed"}, "call": {"duration": 0.15821793442592025, "outcome": "passed"}, "teardown": {"duration": 0.0013761338777840137, "outcome": "passed"}}, {"nodeid": "tests/api/test_ws_subscription_delivery.py::test_ws_new_entity_triggers_event", "lineno": 211, "outcome": "passed", "keywords": ["test_ws_new_entity_triggers_event", "test_ws_subscription_delivery.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.008161981124430895, "outcome": "passed"}, "call": {"duration": 0.0029552821069955826, "outcome": "passed"}, "teardown": {"duration": 0.0009347107261419296, "outcome": "passed"}}, {"nodeid": "tests/api/test_ws_subscription_delivery.py::test_ws_unsubscribe_stops_events", "lineno": 229, "outcome": "passed", "keywords": ["test_ws_unsubscribe_stops_events", "test_ws_subscription_delivery.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.008129998110234737, "outcome": "passed"}, "call": {"duration": 1.0061920690350235, "outcome": "passed"}, "teardown": {"duration": 0.0014084330759942532, "outcome": "passed"}}, {"nodeid": "tests/api/test_ws_subscription_delivery.py::test_ws_event_ids_increment", "lineno": 251, "outcome": "passed", "keywords": ["test_ws_event_ids_increment", "test_ws_subscription_delivery.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.008826060220599174, "outcome": "passed"}, "call": {"duration": 0.001107378862798214, "outcome": "passed"}, "teardown": {"duration": 0.0009514759294688702, "outcome": "passed"}}, {"nodeid": "tests/api/test_ws_subscription_delivery.py::test_ws_get_states_returns_list", "lineno": 261, "outcome": "passed", "keywords": ["test_ws_get_states_returns_list", "test_ws_subscription_delivery.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.009617446921765804, "outcome": "passed"}, "call": {"duration": 0.007958503905683756, "outcome": "passed"}, "teardown": {"duration": 0.0013469108380377293, "outcome": "passed"}}, {"nodeid": "tests/api/test_ws_subscription_delivery.py::test_ws_get_states_entity_format", "lineno": 271, "outcome": "passed", "keywords": ["test_ws_get_states_entity_format", "test_ws_subscription_delivery.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.010482416953891516, "outcome": "passed"}, "call": {"duration": 0.005865889135748148, "outcome": "passed"}, "teardown": {"duration": 0.001184980385005474, "outcome": "passed"}}, {"nodeid": "tests/api/test_ws_subscription_delivery.py::test_ws_call_service", "lineno": 281, "outcome": "failed", "keywords": ["test_ws_call_service", "test_ws_subscription_delivery.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.01051571685820818, "outcome": "passed"}, "call": {"duration": 0.004173667170107365, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_ws_subscription_delivery.py", "lineno": 292, "message": "assert False is True"}, "traceback": [{"path": "tests/api/test_ws_subscription_delivery.py", "lineno": 292, "message": "AssertionError"}], "longrepr": "ws = <conftest.WSClient object at 0x7f47b0696310>\nrest = <conftest.RESTClient object at 0x7f47b054a700>\n\n    async def test_ws_call_service(ws, rest):\n        \"\"\"call_service via WS changes entity state.\"\"\"\n        await rest.set_state(\"light.ws_svc_test\", \"off\")\n    \n        result = await ws.send_command(\n            \"call_service\",\n            domain=\"light\",\n            service=\"turn_on\",\n            service_data={\"entity_id\": \"light.ws_svc_test\"},\n        )\n>       assert result[\"success\"] is True\nE       assert False is True\n\ntests/api/test_ws_subscription_delivery.py:292: AssertionError"}, "teardown": {"duration": 0.0013488088734447956, "outcome": "passed"}}, {"nodeid": "tests/api/test_ws_template_render.py::test_ws_render_simple_template", "lineno": 14, "outcome": "passed", "keywords": ["test_ws_render_simple_template", "test_ws_template_render.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.003258340060710907, "outcome": "passed"}, "call": {"duration": 0.001066070981323719, "outcome": "passed"}, "teardown": {"duration": 0.0009559132158756256, "outcome": "passed"}}, {"nodeid": "tests/api/test_ws_template_render.py::test_ws_render_string_template", "lineno": 24, "outcome": "passed", "keywords": ["test_ws_render_string_template", "test_ws_template_render.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.003198389895260334, "outcome": "passed"}, "call": {"duration": 0.0017723999917507172, "outcome": "passed"}, "teardown": {"duration": 0.0009159371256828308, "outcome": "passed"}}, {"nodeid": "tests/api/test_ws_template_render.py::test_ws_render_math_template", "lineno": 39, "outcome": "passed", "keywords": ["test_ws_render_math_template", "test_ws_template_render.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.0031728018075227737, "outcome": "passed"}, "call": {"duration": 0.0017400523647665977, "outcome": "passed"}, "teardown": {"duration": 0.0011635157279670238, "outcome": "passed"}}, {"nodeid": "tests/api/test_ws_template_render.py::test_ws_render_state_template", "lineno": 48, "outcome": "passed", "keywords": ["test_ws_render_state_template", "test_ws_template_render.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.011027281172573566, "outcome": "passed"}, "call": {"duration": 0.00585406506434083, "outcome": "passed"}, "teardown": {"duration": 0.0012951511889696121, "outcome": "passed"}}, {"nodeid": "tests/api/test_ws_template_render.py::test_ws_render_is_state_template", "lineno": 58, "outcome": "passed", "keywords": ["test_ws_render_is_state_template", "test_ws_template_render.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.009786245878785849, "outcome": "passed"}, "call": {"duration": 0.005073872860521078, "outcome": "passed"}, "teardown": {"duration": 0.001531415618956089, "outcome": "passed"}}, {"nodeid": "tests/api/test_ws_template_render.py::test_ws_render_state_attr_template", "lineno": 68, "outcome": "passed", "keywords": ["test_ws_render_state_attr_template", "test_ws_template_render.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.00932947313413024, "outcome": "passed"}, "call": {"duration": 0.0044471509754657745, "outcome": "passed"}, "teardown": {"duration": 0.00117571372538805, "outcome": "passed"}}, {"nodeid": "tests/api/test_ws_template_render.py::test_ws_render_filter_chain", "lineno": 78, "outcome": "passed", "keywords": ["test_ws_render_filter_chain", "test_ws_template_render.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.0027591302059590816, "outcome": "passed"}, "call": {"duration": 0.002175746951252222, "outcome": "passed"}, "teardown": {"duration": 0.0009307130239903927, "outcome": "passed"}}, {"nodeid": "tests/api/test_ws_template_render.py::test_ws_render_conditional", "lineno": 87, "outcome": "passed", "keywords": ["test_ws_render_conditional", "test_ws_template_render.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.0055964021012187, "outcome": "passed"}, "call": {"duration": 0.0014613601379096508, "outcome": "passed"}, "teardown": {"duration": 0.0009219846688210964, "outcome": "passed"}}, {"nodeid": "tests/api/test_ws_template_render.py::test_ws_render_now_function", "lineno": 96, "outcome": "passed", "keywords": ["test_ws_render_now_function", "test_ws_template_render.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.0027816290967166424, "outcome": "passed"}, "call": {"duration": 0.0010990151204168797, "outcome": "passed"}, "teardown": {"duration": 0.000921398401260376, "outcome": "passed"}}, {"nodeid": "tests/api/test_ws_template_render.py::test_ws_render_iif_filter", "lineno": 105, "outcome": "passed", "keywords": ["test_ws_render_iif_filter", "test_ws_template_render.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.002860845997929573, "outcome": "passed"}, "call": {"duration": 0.0009494787082076073, "outcome": "passed"}, "teardown": {"duration": 0.0008406452834606171, "outcome": "passed"}}, {"nodeid": "tests/api/test_yaml_roundtrip.py::test_automation_yaml_content_type", "lineno": 14, "outcome": "failed", "keywords": ["test_automation_yaml_content_type", "test_yaml_roundtrip.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.006058841943740845, "outcome": "passed"}, "call": {"duration": 0.0029457909986376762, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_yaml_roundtrip.py", "lineno": 21, "message": "assert 404 == 200\n +  where 404 = <Response [404 Not Found]>.status_code"}, "traceback": [{"path": "tests/api/test_yaml_roundtrip.py", "lineno": 21, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0696250>\n\n    async def test_automation_yaml_content_type(rest):\n        \"\"\"GET /api/config/automation/yaml returns text/yaml content type.\"\"\"\n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/config/automation/yaml\",\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 404 == 200\nE        +  where 404 = <Response [404 Not Found]>.status_code\n\ntests/api/test_yaml_roundtrip.py:21: AssertionError"}, "teardown": {"duration": 0.0005630804225802422, "outcome": "passed"}}, {"nodeid": "tests/api/test_yaml_roundtrip.py::test_automation_yaml_has_entries", "lineno": 25, "outcome": "failed", "keywords": ["test_automation_yaml_has_entries", "test_yaml_roundtrip.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005631007719784975, "outcome": "passed"}, "call": {"duration": 0.0027358378283679485, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_yaml_roundtrip.py", "lineno": 35, "message": "AssertionError: Expected 6+ automations, found 0\nassert 0 >= 6"}, "traceback": [{"path": "tests/api/test_yaml_roundtrip.py", "lineno": 35, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b06496d0>\n\n    async def test_automation_yaml_has_entries(rest):\n        \"\"\"Automation YAML contains at least 6 automation entries.\"\"\"\n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/config/automation/yaml\",\n            headers=rest._headers(),\n        )\n        text = resp.text\n        # Count automation entries by counting \"- id:\" patterns\n        count = text.count(\"- id:\")\n>       assert count >= 6, f\"Expected 6+ automations, found {count}\"\nE       AssertionError: Expected 6+ automations, found 0\nE       assert 0 >= 6\n\ntests/api/test_yaml_roundtrip.py:35: AssertionError"}, "teardown": {"duration": 0.0005396059714257717, "outcome": "passed"}}, {"nodeid": "tests/api/test_yaml_roundtrip.py::test_automation_yaml_roundtrip", "lineno": 37, "outcome": "failed", "keywords": ["test_automation_yaml_roundtrip", "test_yaml_roundtrip.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.00594294210895896, "outcome": "passed"}, "call": {"duration": 0.004443938843905926, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_yaml_roundtrip.py", "lineno": 52, "message": "assert 404 == 200\n +  where 404 = <Response [404 Not Found]>.status_code"}, "traceback": [{"path": "tests/api/test_yaml_roundtrip.py", "lineno": 52, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0fe7670>\n\n    async def test_automation_yaml_roundtrip(rest):\n        \"\"\"Read YAML, write it back, read again \u2014 content matches.\"\"\"\n        resp1 = await rest.client.get(\n            f\"{rest.base_url}/api/config/automation/yaml\",\n            headers=rest._headers(),\n        )\n        original = resp1.text\n    \n        # Write it back\n        resp2 = await rest.client.put(\n            f\"{rest.base_url}/api/config/automation/yaml\",\n            content=original,\n            headers={**rest._headers(), \"content-type\": \"text/yaml\"},\n        )\n>       assert resp2.status_code == 200\nE       assert 404 == 200\nE        +  where 404 = <Response [404 Not Found]>.status_code\n\ntests/api/test_yaml_roundtrip.py:52: AssertionError"}, "teardown": {"duration": 0.0005592829547822475, "outcome": "passed"}}, {"nodeid": "tests/api/test_yaml_roundtrip.py::test_automation_yaml_invalid_rejected", "lineno": 61, "outcome": "failed", "keywords": ["test_automation_yaml_invalid_rejected", "test_yaml_roundtrip.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005118391010910273, "outcome": "passed"}, "call": {"duration": 0.0034310766495764256, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_yaml_roundtrip.py", "lineno": 69, "message": "assert 404 == 400\n +  where 404 = <Response [404 Not Found]>.status_code"}, "traceback": [{"path": "tests/api/test_yaml_roundtrip.py", "lineno": 69, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0d5a5e0>\n\n    async def test_automation_yaml_invalid_rejected(rest):\n        \"\"\"PUT with invalid YAML returns 400.\"\"\"\n        resp = await rest.client.put(\n            f\"{rest.base_url}/api/config/automation/yaml\",\n            content=\"not: valid: automation: yaml: [[[\",\n            headers={**rest._headers(), \"content-type\": \"text/yaml\"},\n        )\n>       assert resp.status_code == 400\nE       assert 404 == 400\nE        +  where 404 = <Response [404 Not Found]>.status_code\n\ntests/api/test_yaml_roundtrip.py:69: AssertionError"}, "teardown": {"duration": 0.0006462768651545048, "outcome": "passed"}}, {"nodeid": "tests/api/test_yaml_roundtrip.py::test_scene_yaml_content_type", "lineno": 73, "outcome": "failed", "keywords": ["test_scene_yaml_content_type", "test_yaml_roundtrip.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005235213320702314, "outcome": "passed"}, "call": {"duration": 0.0029454659670591354, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_yaml_roundtrip.py", "lineno": 80, "message": "assert 404 == 200\n +  where 404 = <Response [404 Not Found]>.status_code"}, "traceback": [{"path": "tests/api/test_yaml_roundtrip.py", "lineno": 80, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b08d9e50>\n\n    async def test_scene_yaml_content_type(rest):\n        \"\"\"GET /api/config/scene/yaml returns text/yaml content type.\"\"\"\n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/config/scene/yaml\",\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 404 == 200\nE        +  where 404 = <Response [404 Not Found]>.status_code\n\ntests/api/test_yaml_roundtrip.py:80: AssertionError"}, "teardown": {"duration": 0.0005594333633780479, "outcome": "passed"}}, {"nodeid": "tests/api/test_yaml_roundtrip.py::test_scene_yaml_has_entries", "lineno": 84, "outcome": "failed", "keywords": ["test_scene_yaml_has_entries", "test_yaml_roundtrip.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.0051460000686347485, "outcome": "passed"}, "call": {"duration": 0.002812551334500313, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_yaml_roundtrip.py", "lineno": 93, "message": "AssertionError: Expected 2+ scenes, found 0\nassert 0 >= 2"}, "traceback": [{"path": "tests/api/test_yaml_roundtrip.py", "lineno": 93, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b08d95b0>\n\n    async def test_scene_yaml_has_entries(rest):\n        \"\"\"Scene YAML contains at least 2 scene entries.\"\"\"\n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/config/scene/yaml\",\n            headers=rest._headers(),\n        )\n        text = resp.text\n        count = text.count(\"- id:\")\n>       assert count >= 2, f\"Expected 2+ scenes, found {count}\"\nE       AssertionError: Expected 2+ scenes, found 0\nE       assert 0 >= 2\n\ntests/api/test_yaml_roundtrip.py:93: AssertionError"}, "teardown": {"duration": 0.0005462691187858582, "outcome": "passed"}}, {"nodeid": "tests/api/test_yaml_roundtrip.py::test_scene_yaml_roundtrip", "lineno": 95, "outcome": "failed", "keywords": ["test_scene_yaml_roundtrip", "test_yaml_roundtrip.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.0050226361490786076, "outcome": "passed"}, "call": {"duration": 0.0038878857158124447, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_yaml_roundtrip.py", "lineno": 109, "message": "assert 404 == 200\n +  where 404 = <Response [404 Not Found]>.status_code"}, "traceback": [{"path": "tests/api/test_yaml_roundtrip.py", "lineno": 109, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b10d9f70>\n\n    async def test_scene_yaml_roundtrip(rest):\n        \"\"\"Read scene YAML, write it back, read again \u2014 content matches.\"\"\"\n        resp1 = await rest.client.get(\n            f\"{rest.base_url}/api/config/scene/yaml\",\n            headers=rest._headers(),\n        )\n        original = resp1.text\n    \n        resp2 = await rest.client.put(\n            f\"{rest.base_url}/api/config/scene/yaml\",\n            content=original,\n            headers={**rest._headers(), \"content-type\": \"text/yaml\"},\n        )\n>       assert resp2.status_code == 200\nE       assert 404 == 200\nE        +  where 404 = <Response [404 Not Found]>.status_code\n\ntests/api/test_yaml_roundtrip.py:109: AssertionError"}, "teardown": {"duration": 0.0006017959676682949, "outcome": "passed"}}, {"nodeid": "tests/api/test_yaml_roundtrip.py::test_scene_yaml_invalid_rejected", "lineno": 117, "outcome": "failed", "keywords": ["test_scene_yaml_invalid_rejected", "test_yaml_roundtrip.py", "asyncio", "api", "tests", "marge", ""], "setup": {"duration": 0.005198357161134481, "outcome": "passed"}, "call": {"duration": 0.0032097287476062775, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/api/test_yaml_roundtrip.py", "lineno": 125, "message": "assert 404 == 400\n +  where 404 = <Response [404 Not Found]>.status_code"}, "traceback": [{"path": "tests/api/test_yaml_roundtrip.py", "lineno": 125, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b1124280>\n\n    async def test_scene_yaml_invalid_rejected(rest):\n        \"\"\"PUT with invalid scene YAML returns 400.\"\"\"\n        resp = await rest.client.put(\n            f\"{rest.base_url}/api/config/scene/yaml\",\n            content=\"this is not valid scene yaml [[[\",\n            headers={**rest._headers(), \"content-type\": \"text/yaml\"},\n        )\n>       assert resp.status_code == 400\nE       assert 404 == 400\nE        +  where 404 = <Response [404 Not Found]>.status_code\n\ntests/api/test_yaml_roundtrip.py:125: AssertionError"}, "teardown": {"duration": 0.0006966879591345787, "outcome": "passed"}}, {"nodeid": "tests/automation/test_automation_api.py::test_automation_list_returns_list", "lineno": 15, "outcome": "failed", "keywords": ["test_automation_list_returns_list", "test_automation_api.py", "asyncio", "automation", "tests", "marge", ""], "setup": {"duration": 0.005391053855419159, "outcome": "passed"}, "call": {"duration": 0.0027777431532740593, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/automation/test_automation_api.py", "lineno": 22, "message": "assert 404 == 200\n +  where 404 = <Response [404 Not Found]>.status_code"}, "traceback": [{"path": "tests/automation/test_automation_api.py", "lineno": 22, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b06dbcd0>\n\n    async def test_automation_list_returns_list(rest):\n        \"\"\"GET /api/automations returns a list.\"\"\"\n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/config/automation/config\",\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 404 == 200\nE        +  where 404 = <Response [404 Not Found]>.status_code\n\ntests/automation/test_automation_api.py:22: AssertionError"}, "teardown": {"duration": 0.0007219021208584309, "outcome": "passed"}}, {"nodeid": "tests/automation/test_automation_api.py::test_automation_list_has_field[id]", "lineno": 27, "outcome": "failed", "keywords": ["test_automation_list_has_field[id]", "parametrize", "pytestmark", "id", "test_automation_api.py", "asyncio", "automation", "tests", "marge", ""], "setup": {"duration": 0.0055581070482730865, "outcome": "passed"}, "call": {"duration": 0.0028389557264745235, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)"}, "traceback": [{"path": "tests/automation/test_automation_api.py", "lineno": 39, "message": ""}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 832, "message": "in json"}, {"path": "../../anaconda3/lib/python3.9/json/__init__.py", "lineno": 346, "message": "in loads"}, {"path": "../../anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "JSONDecodeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0f8a100>, field = 'id'\n\n    @pytest.mark.parametrize(\"field\", [\n        \"id\", \"alias\", \"enabled\", \"mode\",\n        \"trigger_count\", \"condition_count\", \"action_count\",\n        \"description\",\n    ])\n    async def test_automation_list_has_field(rest, field):\n        \"\"\"Automation config entries include expected field.\"\"\"\n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/config/automation/config\",\n            headers=rest._headers(),\n        )\n>       data = resp.json()\n\ntests/automation/test_automation_api.py:39: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:832: in json\n    return jsonlib.loads(self.content, **kwargs)\n../../anaconda3/lib/python3.9/json/__init__.py:346: in loads\n    return _default_decoder.decode(s)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <json.decoder.JSONDecoder object at 0x7f47b2e5fe50>, s = '404: Not Found'\n_w = <built-in method match of re.Pattern object at 0x7f47b3015cf0>\n\n    def decode(self, s, _w=WHITESPACE.match):\n        \"\"\"Return the Python representation of ``s`` (a ``str`` instance\n        containing a JSON document).\n    \n        \"\"\"\n        obj, end = self.raw_decode(s, idx=_w(s, 0).end())\n        end = _w(s, end).end()\n        if end != len(s):\n>           raise JSONDecodeError(\"Extra data\", s, end)\nE           json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)\n\n../../anaconda3/lib/python3.9/json/decoder.py:340: JSONDecodeError"}, "teardown": {"duration": 0.0007127397693693638, "outcome": "passed"}}, {"nodeid": "tests/automation/test_automation_api.py::test_automation_list_has_field[alias]", "lineno": 27, "outcome": "failed", "keywords": ["test_automation_list_has_field[alias]", "parametrize", "pytestmark", "alias", "test_automation_api.py", "asyncio", "automation", "tests", "marge", ""], "setup": {"duration": 0.005607266910374165, "outcome": "passed"}, "call": {"duration": 0.002950218040496111, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)"}, "traceback": [{"path": "tests/automation/test_automation_api.py", "lineno": 39, "message": ""}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 832, "message": "in json"}, {"path": "../../anaconda3/lib/python3.9/json/__init__.py", "lineno": 346, "message": "in loads"}, {"path": "../../anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "JSONDecodeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b054a550>, field = 'alias'\n\n    @pytest.mark.parametrize(\"field\", [\n        \"id\", \"alias\", \"enabled\", \"mode\",\n        \"trigger_count\", \"condition_count\", \"action_count\",\n        \"description\",\n    ])\n    async def test_automation_list_has_field(rest, field):\n        \"\"\"Automation config entries include expected field.\"\"\"\n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/config/automation/config\",\n            headers=rest._headers(),\n        )\n>       data = resp.json()\n\ntests/automation/test_automation_api.py:39: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:832: in json\n    return jsonlib.loads(self.content, **kwargs)\n../../anaconda3/lib/python3.9/json/__init__.py:346: in loads\n    return _default_decoder.decode(s)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <json.decoder.JSONDecoder object at 0x7f47b2e5fe50>, s = '404: Not Found'\n_w = <built-in method match of re.Pattern object at 0x7f47b3015cf0>\n\n    def decode(self, s, _w=WHITESPACE.match):\n        \"\"\"Return the Python representation of ``s`` (a ``str`` instance\n        containing a JSON document).\n    \n        \"\"\"\n        obj, end = self.raw_decode(s, idx=_w(s, 0).end())\n        end = _w(s, end).end()\n        if end != len(s):\n>           raise JSONDecodeError(\"Extra data\", s, end)\nE           json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)\n\n../../anaconda3/lib/python3.9/json/decoder.py:340: JSONDecodeError"}, "teardown": {"duration": 0.000771770253777504, "outcome": "passed"}}, {"nodeid": "tests/automation/test_automation_api.py::test_automation_list_has_field[enabled]", "lineno": 27, "outcome": "failed", "keywords": ["test_automation_list_has_field[enabled]", "parametrize", "pytestmark", "enabled", "test_automation_api.py", "asyncio", "automation", "tests", "marge", ""], "setup": {"duration": 0.006165849976241589, "outcome": "passed"}, "call": {"duration": 0.003079243004322052, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)"}, "traceback": [{"path": "tests/automation/test_automation_api.py", "lineno": 39, "message": ""}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 832, "message": "in json"}, {"path": "../../anaconda3/lib/python3.9/json/__init__.py", "lineno": 346, "message": "in loads"}, {"path": "../../anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "JSONDecodeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0870760>, field = 'enabled'\n\n    @pytest.mark.parametrize(\"field\", [\n        \"id\", \"alias\", \"enabled\", \"mode\",\n        \"trigger_count\", \"condition_count\", \"action_count\",\n        \"description\",\n    ])\n    async def test_automation_list_has_field(rest, field):\n        \"\"\"Automation config entries include expected field.\"\"\"\n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/config/automation/config\",\n            headers=rest._headers(),\n        )\n>       data = resp.json()\n\ntests/automation/test_automation_api.py:39: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:832: in json\n    return jsonlib.loads(self.content, **kwargs)\n../../anaconda3/lib/python3.9/json/__init__.py:346: in loads\n    return _default_decoder.decode(s)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <json.decoder.JSONDecoder object at 0x7f47b2e5fe50>, s = '404: Not Found'\n_w = <built-in method match of re.Pattern object at 0x7f47b3015cf0>\n\n    def decode(self, s, _w=WHITESPACE.match):\n        \"\"\"Return the Python representation of ``s`` (a ``str`` instance\n        containing a JSON document).\n    \n        \"\"\"\n        obj, end = self.raw_decode(s, idx=_w(s, 0).end())\n        end = _w(s, end).end()\n        if end != len(s):\n>           raise JSONDecodeError(\"Extra data\", s, end)\nE           json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)\n\n../../anaconda3/lib/python3.9/json/decoder.py:340: JSONDecodeError"}, "teardown": {"duration": 0.0007871850393712521, "outcome": "passed"}}, {"nodeid": "tests/automation/test_automation_api.py::test_automation_list_has_field[mode]", "lineno": 27, "outcome": "failed", "keywords": ["test_automation_list_has_field[mode]", "parametrize", "pytestmark", "mode", "test_automation_api.py", "asyncio", "automation", "tests", "marge", ""], "setup": {"duration": 0.005818513222038746, "outcome": "passed"}, "call": {"duration": 0.0031048948876559734, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)"}, "traceback": [{"path": "tests/automation/test_automation_api.py", "lineno": 39, "message": ""}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 832, "message": "in json"}, {"path": "../../anaconda3/lib/python3.9/json/__init__.py", "lineno": 346, "message": "in loads"}, {"path": "../../anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "JSONDecodeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b06496d0>, field = 'mode'\n\n    @pytest.mark.parametrize(\"field\", [\n        \"id\", \"alias\", \"enabled\", \"mode\",\n        \"trigger_count\", \"condition_count\", \"action_count\",\n        \"description\",\n    ])\n    async def test_automation_list_has_field(rest, field):\n        \"\"\"Automation config entries include expected field.\"\"\"\n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/config/automation/config\",\n            headers=rest._headers(),\n        )\n>       data = resp.json()\n\ntests/automation/test_automation_api.py:39: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:832: in json\n    return jsonlib.loads(self.content, **kwargs)\n../../anaconda3/lib/python3.9/json/__init__.py:346: in loads\n    return _default_decoder.decode(s)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <json.decoder.JSONDecoder object at 0x7f47b2e5fe50>, s = '404: Not Found'\n_w = <built-in method match of re.Pattern object at 0x7f47b3015cf0>\n\n    def decode(self, s, _w=WHITESPACE.match):\n        \"\"\"Return the Python representation of ``s`` (a ``str`` instance\n        containing a JSON document).\n    \n        \"\"\"\n        obj, end = self.raw_decode(s, idx=_w(s, 0).end())\n        end = _w(s, end).end()\n        if end != len(s):\n>           raise JSONDecodeError(\"Extra data\", s, end)\nE           json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)\n\n../../anaconda3/lib/python3.9/json/decoder.py:340: JSONDecodeError"}, "teardown": {"duration": 0.0007337760180234909, "outcome": "passed"}}, {"nodeid": "tests/automation/test_automation_api.py::test_automation_list_has_field[trigger_count]", "lineno": 27, "outcome": "failed", "keywords": ["test_automation_list_has_field[trigger_count]", "parametrize", "pytestmark", "trigger_count", "test_automation_api.py", "asyncio", "automation", "tests", "marge", ""], "setup": {"duration": 0.005533962044864893, "outcome": "passed"}, "call": {"duration": 0.002928605768829584, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)"}, "traceback": [{"path": "tests/automation/test_automation_api.py", "lineno": 39, "message": ""}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 832, "message": "in json"}, {"path": "../../anaconda3/lib/python3.9/json/__init__.py", "lineno": 346, "message": "in loads"}, {"path": "../../anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "JSONDecodeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0649760>, field = 'trigger_count'\n\n    @pytest.mark.parametrize(\"field\", [\n        \"id\", \"alias\", \"enabled\", \"mode\",\n        \"trigger_count\", \"condition_count\", \"action_count\",\n        \"description\",\n    ])\n    async def test_automation_list_has_field(rest, field):\n        \"\"\"Automation config entries include expected field.\"\"\"\n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/config/automation/config\",\n            headers=rest._headers(),\n        )\n>       data = resp.json()\n\ntests/automation/test_automation_api.py:39: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:832: in json\n    return jsonlib.loads(self.content, **kwargs)\n../../anaconda3/lib/python3.9/json/__init__.py:346: in loads\n    return _default_decoder.decode(s)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <json.decoder.JSONDecoder object at 0x7f47b2e5fe50>, s = '404: Not Found'\n_w = <built-in method match of re.Pattern object at 0x7f47b3015cf0>\n\n    def decode(self, s, _w=WHITESPACE.match):\n        \"\"\"Return the Python representation of ``s`` (a ``str`` instance\n        containing a JSON document).\n    \n        \"\"\"\n        obj, end = self.raw_decode(s, idx=_w(s, 0).end())\n        end = _w(s, end).end()\n        if end != len(s):\n>           raise JSONDecodeError(\"Extra data\", s, end)\nE           json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)\n\n../../anaconda3/lib/python3.9/json/decoder.py:340: JSONDecodeError"}, "teardown": {"duration": 0.0007267971523106098, "outcome": "passed"}}, {"nodeid": "tests/automation/test_automation_api.py::test_automation_list_has_field[condition_count]", "lineno": 27, "outcome": "failed", "keywords": ["test_automation_list_has_field[condition_count]", "parametrize", "pytestmark", "condition_count", "test_automation_api.py", "asyncio", "automation", "tests", "marge", ""], "setup": {"duration": 0.005225823260843754, "outcome": "passed"}, "call": {"duration": 0.002630671951919794, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)"}, "traceback": [{"path": "tests/automation/test_automation_api.py", "lineno": 39, "message": ""}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 832, "message": "in json"}, {"path": "../../anaconda3/lib/python3.9/json/__init__.py", "lineno": 346, "message": "in loads"}, {"path": "../../anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "JSONDecodeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b06491c0>, field = 'condition_count'\n\n    @pytest.mark.parametrize(\"field\", [\n        \"id\", \"alias\", \"enabled\", \"mode\",\n        \"trigger_count\", \"condition_count\", \"action_count\",\n        \"description\",\n    ])\n    async def test_automation_list_has_field(rest, field):\n        \"\"\"Automation config entries include expected field.\"\"\"\n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/config/automation/config\",\n            headers=rest._headers(),\n        )\n>       data = resp.json()\n\ntests/automation/test_automation_api.py:39: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:832: in json\n    return jsonlib.loads(self.content, **kwargs)\n../../anaconda3/lib/python3.9/json/__init__.py:346: in loads\n    return _default_decoder.decode(s)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <json.decoder.JSONDecoder object at 0x7f47b2e5fe50>, s = '404: Not Found'\n_w = <built-in method match of re.Pattern object at 0x7f47b3015cf0>\n\n    def decode(self, s, _w=WHITESPACE.match):\n        \"\"\"Return the Python representation of ``s`` (a ``str`` instance\n        containing a JSON document).\n    \n        \"\"\"\n        obj, end = self.raw_decode(s, idx=_w(s, 0).end())\n        end = _w(s, end).end()\n        if end != len(s):\n>           raise JSONDecodeError(\"Extra data\", s, end)\nE           json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)\n\n../../anaconda3/lib/python3.9/json/decoder.py:340: JSONDecodeError"}, "teardown": {"duration": 0.0007592281326651573, "outcome": "passed"}}, {"nodeid": "tests/automation/test_automation_api.py::test_automation_list_has_field[action_count]", "lineno": 27, "outcome": "failed", "keywords": ["test_automation_list_has_field[action_count]", "parametrize", "pytestmark", "action_count", "test_automation_api.py", "asyncio", "automation", "tests", "marge", ""], "setup": {"duration": 0.005252602975815535, "outcome": "passed"}, "call": {"duration": 0.002704992424696684, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)"}, "traceback": [{"path": "tests/automation/test_automation_api.py", "lineno": 39, "message": ""}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 832, "message": "in json"}, {"path": "../../anaconda3/lib/python3.9/json/__init__.py", "lineno": 346, "message": "in loads"}, {"path": "../../anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "JSONDecodeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0d2e7f0>, field = 'action_count'\n\n    @pytest.mark.parametrize(\"field\", [\n        \"id\", \"alias\", \"enabled\", \"mode\",\n        \"trigger_count\", \"condition_count\", \"action_count\",\n        \"description\",\n    ])\n    async def test_automation_list_has_field(rest, field):\n        \"\"\"Automation config entries include expected field.\"\"\"\n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/config/automation/config\",\n            headers=rest._headers(),\n        )\n>       data = resp.json()\n\ntests/automation/test_automation_api.py:39: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:832: in json\n    return jsonlib.loads(self.content, **kwargs)\n../../anaconda3/lib/python3.9/json/__init__.py:346: in loads\n    return _default_decoder.decode(s)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <json.decoder.JSONDecoder object at 0x7f47b2e5fe50>, s = '404: Not Found'\n_w = <built-in method match of re.Pattern object at 0x7f47b3015cf0>\n\n    def decode(self, s, _w=WHITESPACE.match):\n        \"\"\"Return the Python representation of ``s`` (a ``str`` instance\n        containing a JSON document).\n    \n        \"\"\"\n        obj, end = self.raw_decode(s, idx=_w(s, 0).end())\n        end = _w(s, end).end()\n        if end != len(s):\n>           raise JSONDecodeError(\"Extra data\", s, end)\nE           json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)\n\n../../anaconda3/lib/python3.9/json/decoder.py:340: JSONDecodeError"}, "teardown": {"duration": 0.0007566581480205059, "outcome": "passed"}}, {"nodeid": "tests/automation/test_automation_api.py::test_automation_list_has_field[description]", "lineno": 27, "outcome": "failed", "keywords": ["test_automation_list_has_field[description]", "parametrize", "pytestmark", "description", "test_automation_api.py", "asyncio", "automation", "tests", "marge", ""], "setup": {"duration": 0.005361922085285187, "outcome": "passed"}, "call": {"duration": 0.0028798491694033146, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)"}, "traceback": [{"path": "tests/automation/test_automation_api.py", "lineno": 39, "message": ""}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 832, "message": "in json"}, {"path": "../../anaconda3/lib/python3.9/json/__init__.py", "lineno": 346, "message": "in loads"}, {"path": "../../anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "JSONDecodeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0fb8820>, field = 'description'\n\n    @pytest.mark.parametrize(\"field\", [\n        \"id\", \"alias\", \"enabled\", \"mode\",\n        \"trigger_count\", \"condition_count\", \"action_count\",\n        \"description\",\n    ])\n    async def test_automation_list_has_field(rest, field):\n        \"\"\"Automation config entries include expected field.\"\"\"\n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/config/automation/config\",\n            headers=rest._headers(),\n        )\n>       data = resp.json()\n\ntests/automation/test_automation_api.py:39: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:832: in json\n    return jsonlib.loads(self.content, **kwargs)\n../../anaconda3/lib/python3.9/json/__init__.py:346: in loads\n    return _default_decoder.decode(s)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <json.decoder.JSONDecoder object at 0x7f47b2e5fe50>, s = '404: Not Found'\n_w = <built-in method match of re.Pattern object at 0x7f47b3015cf0>\n\n    def decode(self, s, _w=WHITESPACE.match):\n        \"\"\"Return the Python representation of ``s`` (a ``str`` instance\n        containing a JSON document).\n    \n        \"\"\"\n        obj, end = self.raw_decode(s, idx=_w(s, 0).end())\n        end = _w(s, end).end()\n        if end != len(s):\n>           raise JSONDecodeError(\"Extra data\", s, end)\nE           json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)\n\n../../anaconda3/lib/python3.9/json/decoder.py:340: JSONDecodeError"}, "teardown": {"duration": 0.0007852497510612011, "outcome": "passed"}}, {"nodeid": "tests/automation/test_automation_api.py::test_automation_list_has_id_and_alias", "lineno": 43, "outcome": "failed", "keywords": ["test_automation_list_has_id_and_alias", "test_automation_api.py", "asyncio", "automation", "tests", "marge", ""], "setup": {"duration": 0.005583249032497406, "outcome": "passed"}, "call": {"duration": 0.0028979890048503876, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)"}, "traceback": [{"path": "tests/automation/test_automation_api.py", "lineno": 50, "message": ""}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 832, "message": "in json"}, {"path": "../../anaconda3/lib/python3.9/json/__init__.py", "lineno": 346, "message": "in loads"}, {"path": "../../anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "JSONDecodeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0870a30>\n\n    async def test_automation_list_has_id_and_alias(rest):\n        \"\"\"Automation entries have non-empty alias.\"\"\"\n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/config/automation/config\",\n            headers=rest._headers(),\n        )\n>       data = resp.json()\n\ntests/automation/test_automation_api.py:50: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:832: in json\n    return jsonlib.loads(self.content, **kwargs)\n../../anaconda3/lib/python3.9/json/__init__.py:346: in loads\n    return _default_decoder.decode(s)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <json.decoder.JSONDecoder object at 0x7f47b2e5fe50>, s = '404: Not Found'\n_w = <built-in method match of re.Pattern object at 0x7f47b3015cf0>\n\n    def decode(self, s, _w=WHITESPACE.match):\n        \"\"\"Return the Python representation of ``s`` (a ``str`` instance\n        containing a JSON document).\n    \n        \"\"\"\n        obj, end = self.raw_decode(s, idx=_w(s, 0).end())\n        end = _w(s, end).end()\n        if end != len(s):\n>           raise JSONDecodeError(\"Extra data\", s, end)\nE           json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)\n\n../../anaconda3/lib/python3.9/json/decoder.py:340: JSONDecodeError"}, "teardown": {"duration": 0.0007786410860717297, "outcome": "passed"}}, {"nodeid": "tests/automation/test_automation_api.py::test_automation_list_has_counts", "lineno": 56, "outcome": "failed", "keywords": ["test_automation_list_has_counts", "test_automation_api.py", "asyncio", "automation", "tests", "marge", ""], "setup": {"duration": 0.00540747819468379, "outcome": "passed"}, "call": {"duration": 0.0029535298235714436, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)"}, "traceback": [{"path": "tests/automation/test_automation_api.py", "lineno": 63, "message": ""}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 832, "message": "in json"}, {"path": "../../anaconda3/lib/python3.9/json/__init__.py", "lineno": 346, "message": "in loads"}, {"path": "../../anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "JSONDecodeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b106cc70>\n\n    async def test_automation_list_has_counts(rest):\n        \"\"\"Automation entries include trigger/condition/action counts.\"\"\"\n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/config/automation/config\",\n            headers=rest._headers(),\n        )\n>       data = resp.json()\n\ntests/automation/test_automation_api.py:63: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:832: in json\n    return jsonlib.loads(self.content, **kwargs)\n../../anaconda3/lib/python3.9/json/__init__.py:346: in loads\n    return _default_decoder.decode(s)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <json.decoder.JSONDecoder object at 0x7f47b2e5fe50>, s = '404: Not Found'\n_w = <built-in method match of re.Pattern object at 0x7f47b3015cf0>\n\n    def decode(self, s, _w=WHITESPACE.match):\n        \"\"\"Return the Python representation of ``s`` (a ``str`` instance\n        containing a JSON document).\n    \n        \"\"\"\n        obj, end = self.raw_decode(s, idx=_w(s, 0).end())\n        end = _w(s, end).end()\n        if end != len(s):\n>           raise JSONDecodeError(\"Extra data\", s, end)\nE           json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)\n\n../../anaconda3/lib/python3.9/json/decoder.py:340: JSONDecodeError"}, "teardown": {"duration": 0.0007805363275110722, "outcome": "passed"}}, {"nodeid": "tests/automation/test_automation_api.py::test_automation_list_has_mode", "lineno": 68, "outcome": "failed", "keywords": ["test_automation_list_has_mode", "test_automation_api.py", "asyncio", "automation", "tests", "marge", ""], "setup": {"duration": 0.005213908851146698, "outcome": "passed"}, "call": {"duration": 0.0028716856613755226, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)"}, "traceback": [{"path": "tests/automation/test_automation_api.py", "lineno": 75, "message": ""}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 832, "message": "in json"}, {"path": "../../anaconda3/lib/python3.9/json/__init__.py", "lineno": 346, "message": "in loads"}, {"path": "../../anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "JSONDecodeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0a02820>\n\n    async def test_automation_list_has_mode(rest):\n        \"\"\"Automation entries include mode field with valid value.\"\"\"\n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/config/automation/config\",\n            headers=rest._headers(),\n        )\n>       data = resp.json()\n\ntests/automation/test_automation_api.py:75: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:832: in json\n    return jsonlib.loads(self.content, **kwargs)\n../../anaconda3/lib/python3.9/json/__init__.py:346: in loads\n    return _default_decoder.decode(s)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <json.decoder.JSONDecoder object at 0x7f47b2e5fe50>, s = '404: Not Found'\n_w = <built-in method match of re.Pattern object at 0x7f47b3015cf0>\n\n    def decode(self, s, _w=WHITESPACE.match):\n        \"\"\"Return the Python representation of ``s`` (a ``str`` instance\n        containing a JSON document).\n    \n        \"\"\"\n        obj, end = self.raw_decode(s, idx=_w(s, 0).end())\n        end = _w(s, end).end()\n        if end != len(s):\n>           raise JSONDecodeError(\"Extra data\", s, end)\nE           json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)\n\n../../anaconda3/lib/python3.9/json/decoder.py:340: JSONDecodeError"}, "teardown": {"duration": 0.0007813707925379276, "outcome": "passed"}}, {"nodeid": "tests/automation/test_automation_api.py::test_automation_yaml_read", "lineno": 81, "outcome": "failed", "keywords": ["test_automation_yaml_read", "test_automation_api.py", "asyncio", "automation", "tests", "marge", ""], "setup": {"duration": 0.00527452165260911, "outcome": "passed"}, "call": {"duration": 0.0030755652114748955, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/automation/test_automation_api.py", "lineno": 88, "message": "assert 404 == 200\n +  where 404 = <Response [404 Not Found]>.status_code"}, "traceback": [{"path": "tests/automation/test_automation_api.py", "lineno": 88, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0832ca0>\n\n    async def test_automation_yaml_read(rest):\n        \"\"\"GET /api/config/automation/yaml returns YAML text.\"\"\"\n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/config/automation/yaml\",\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 404 == 200\nE        +  where 404 = <Response [404 Not Found]>.status_code\n\ntests/automation/test_automation_api.py:88: AssertionError"}, "teardown": {"duration": 0.0007354258559644222, "outcome": "passed"}}, {"nodeid": "tests/automation/test_automation_api.py::test_scene_yaml_read", "lineno": 95, "outcome": "failed", "keywords": ["test_scene_yaml_read", "test_automation_api.py", "asyncio", "automation", "tests", "marge", ""], "setup": {"duration": 0.0053529320284724236, "outcome": "passed"}, "call": {"duration": 0.002798135858029127, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/automation/test_automation_api.py", "lineno": 102, "message": "assert 404 == 200\n +  where 404 = <Response [404 Not Found]>.status_code"}, "traceback": [{"path": "tests/automation/test_automation_api.py", "lineno": 102, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0f23dc0>\n\n    async def test_scene_yaml_read(rest):\n        \"\"\"GET /api/config/scene/yaml returns YAML text.\"\"\"\n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/config/scene/yaml\",\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 404 == 200\nE        +  where 404 = <Response [404 Not Found]>.status_code\n\ntests/automation/test_automation_api.py:102: AssertionError"}, "teardown": {"duration": 0.0006363219581544399, "outcome": "passed"}}, {"nodeid": "tests/automation/test_automation_api.py::test_trigger_nonexistent_automation", "lineno": 108, "outcome": "passed", "keywords": ["test_trigger_nonexistent_automation", "test_automation_api.py", "asyncio", "automation", "tests", "marge", ""], "setup": {"duration": 0.005390582140535116, "outcome": "passed"}, "call": {"duration": 0.004881781991571188, "outcome": "passed"}, "teardown": {"duration": 0.0005922699347138405, "outcome": "passed"}}, {"nodeid": "tests/automation/test_automation_api.py::test_trigger_automation_rest", "lineno": 120, "outcome": "passed", "keywords": ["test_trigger_automation_rest", "test_automation_api.py", "asyncio", "automation", "tests", "marge", ""], "setup": {"duration": 0.005392510909587145, "outcome": "passed"}, "call": {"duration": 0.003958744928240776, "outcome": "passed"}, "teardown": {"duration": 0.000561094842851162, "outcome": "passed"}}, {"nodeid": "tests/automation/test_automation_api.py::test_trigger_increments_count", "lineno": 130, "outcome": "failed", "keywords": ["test_trigger_increments_count", "test_automation_api.py", "asyncio", "automation", "tests", "marge", ""], "setup": {"duration": 0.005332245957106352, "outcome": "passed"}, "call": {"duration": 0.004121961072087288, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/automation/test_automation_api.py", "lineno": 134, "message": "TypeError: 'NoneType' object is not subscriptable"}, "traceback": [{"path": "tests/automation/test_automation_api.py", "lineno": 134, "message": "TypeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b08da550>\n\n    async def test_trigger_increments_count(rest):\n        \"\"\"Triggering automation increments current count.\"\"\"\n        state1 = await rest.get_state(\"automation.smoke_co_emergency\")\n>       count1 = int(state1[\"attributes\"].get(\"current\", 0))\nE       TypeError: 'NoneType' object is not subscriptable\n\ntests/automation/test_automation_api.py:134: TypeError"}, "teardown": {"duration": 0.0006933868862688541, "outcome": "passed"}}, {"nodeid": "tests/automation/test_automation_api.py::test_automation_has_last_triggered", "lineno": 146, "outcome": "failed", "keywords": ["test_automation_has_last_triggered", "test_automation_api.py", "asyncio", "automation", "tests", "marge", ""], "setup": {"duration": 0.0057022240944206715, "outcome": "passed"}, "call": {"duration": 0.00453631766140461, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/automation/test_automation_api.py", "lineno": 156, "message": "TypeError: 'NoneType' object is not subscriptable"}, "traceback": [{"path": "tests/automation/test_automation_api.py", "lineno": 156, "message": "TypeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0e69340>\n\n    async def test_automation_has_last_triggered(rest):\n        \"\"\"Triggered automation has last_triggered attribute.\"\"\"\n        await rest.client.post(\n            f\"{rest.base_url}/api/services/automation/trigger\",\n            json={\"entity_id\": \"automation.smoke_co_emergency\"},\n            headers=rest._headers(),\n        )\n    \n        state = await rest.get_state(\"automation.smoke_co_emergency\")\n>       lt = state[\"attributes\"].get(\"last_triggered\", \"\")\nE       TypeError: 'NoneType' object is not subscriptable\n\ntests/automation/test_automation_api.py:156: TypeError"}, "teardown": {"duration": 0.000639019999653101, "outcome": "passed"}}, {"nodeid": "tests/automation/test_automation_api.py::test_trigger_ws", "lineno": 162, "outcome": "passed", "keywords": ["test_trigger_ws", "test_automation_api.py", "asyncio", "automation", "tests", "marge", ""], "setup": {"duration": 0.0027034818194806576, "outcome": "passed"}, "call": {"duration": 0.0011522178538143635, "outcome": "passed"}, "teardown": {"duration": 0.0007630409672856331, "outcome": "passed"}}, {"nodeid": "tests/automation/test_automation_api.py::test_automation_turn_off_on_cycle", "lineno": 175, "outcome": "failed", "keywords": ["test_automation_turn_off_on_cycle", "test_automation_api.py", "asyncio", "automation", "tests", "marge", ""], "setup": {"duration": 0.0053171319887042046, "outcome": "passed"}, "call": {"duration": 0.004458584822714329, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/automation/test_automation_api.py", "lineno": 186, "message": "TypeError: 'NoneType' object is not subscriptable"}, "traceback": [{"path": "tests/automation/test_automation_api.py", "lineno": 186, "message": "TypeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0cc1910>\n\n    async def test_automation_turn_off_on_cycle(rest):\n        \"\"\"Automation can be turned off and back on.\"\"\"\n        eid = \"automation.smoke_co_emergency\"\n    \n        await rest.client.post(\n            f\"{rest.base_url}/api/services/automation/turn_off\",\n            json={\"entity_id\": eid},\n            headers=rest._headers(),\n        )\n        state_off = await rest.get_state(eid)\n>       assert state_off[\"state\"] == \"off\"\nE       TypeError: 'NoneType' object is not subscriptable\n\ntests/automation/test_automation_api.py:186: TypeError"}, "teardown": {"duration": 0.0007573380134999752, "outcome": "passed"}}, {"nodeid": "tests/automation/test_automation_api.py::test_force_trigger_bypasses_disabled", "lineno": 196, "outcome": "failed", "keywords": ["test_force_trigger_bypasses_disabled", "test_automation_api.py", "asyncio", "automation", "tests", "marge", ""], "setup": {"duration": 0.0052511668764054775, "outcome": "passed"}, "call": {"duration": 0.004136109724640846, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/automation/test_automation_api.py", "lineno": 208, "message": "TypeError: 'NoneType' object is not subscriptable"}, "traceback": [{"path": "tests/automation/test_automation_api.py", "lineno": 208, "message": "TypeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0de6f40>\n\n    async def test_force_trigger_bypasses_disabled(rest):\n        \"\"\"Force trigger fires even when automation is off.\"\"\"\n        eid = \"automation.smoke_co_emergency\"\n    \n        await rest.client.post(\n            f\"{rest.base_url}/api/services/automation/turn_on\",\n            json={\"entity_id\": eid},\n            headers=rest._headers(),\n        )\n    \n        state1 = await rest.get_state(eid)\n>       count1 = int(state1[\"attributes\"].get(\"current\", 0))\nE       TypeError: 'NoneType' object is not subscriptable\n\ntests/automation/test_automation_api.py:208: TypeError"}, "teardown": {"duration": 0.0005335058085620403, "outcome": "passed"}}, {"nodeid": "tests/automation/test_automation_api.py::test_automation_ids_unique", "lineno": 234, "outcome": "failed", "keywords": ["test_automation_ids_unique", "test_automation_api.py", "asyncio", "automation", "tests", "marge", ""], "setup": {"duration": 0.0054405201226472855, "outcome": "passed"}, "call": {"duration": 0.0026672640815377235, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)"}, "traceback": [{"path": "tests/automation/test_automation_api.py", "lineno": 241, "message": ""}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 832, "message": "in json"}, {"path": "../../anaconda3/lib/python3.9/json/__init__.py", "lineno": 346, "message": "in loads"}, {"path": "../../anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "JSONDecodeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0552130>\n\n    async def test_automation_ids_unique(rest):\n        \"\"\"All automation IDs are unique.\"\"\"\n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/config/automation/config\",\n            headers=rest._headers(),\n        )\n>       data = resp.json()\n\ntests/automation/test_automation_api.py:241: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:832: in json\n    return jsonlib.loads(self.content, **kwargs)\n../../anaconda3/lib/python3.9/json/__init__.py:346: in loads\n    return _default_decoder.decode(s)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <json.decoder.JSONDecoder object at 0x7f47b2e5fe50>, s = '404: Not Found'\n_w = <built-in method match of re.Pattern object at 0x7f47b3015cf0>\n\n    def decode(self, s, _w=WHITESPACE.match):\n        \"\"\"Return the Python representation of ``s`` (a ``str`` instance\n        containing a JSON document).\n    \n        \"\"\"\n        obj, end = self.raw_decode(s, idx=_w(s, 0).end())\n        end = _w(s, end).end()\n        if end != len(s):\n>           raise JSONDecodeError(\"Extra data\", s, end)\nE           json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)\n\n../../anaconda3/lib/python3.9/json/decoder.py:340: JSONDecodeError"}, "teardown": {"duration": 0.0006792629137635231, "outcome": "passed"}}, {"nodeid": "tests/automation/test_automation_api.py::test_trigger_without_prefix", "lineno": 245, "outcome": "failed", "keywords": ["test_trigger_without_prefix", "test_automation_api.py", "asyncio", "automation", "tests", "marge", ""], "setup": {"duration": 0.005599732045084238, "outcome": "passed"}, "call": {"duration": 0.0030169920064508915, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/automation/test_automation_api.py", "lineno": 253, "message": "assert 400 == 200\n +  where 400 = <Response [400 Bad Request]>.status_code"}, "traceback": [{"path": "tests/automation/test_automation_api.py", "lineno": 253, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0f988e0>\n\n    async def test_trigger_without_prefix(rest):\n        \"\"\"Trigger without 'automation.' prefix also works.\"\"\"\n        resp = await rest.client.post(\n            f\"{rest.base_url}/api/services/automation/trigger\",\n            json={\"entity_id\": \"morning_wakeup\"},\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 400 == 200\nE        +  where 400 = <Response [400 Bad Request]>.status_code\n\ntests/automation/test_automation_api.py:253: AssertionError"}, "teardown": {"duration": 0.000508167315274477, "outcome": "passed"}}, {"nodeid": "tests/automation/test_automation_api.py::test_trigger_empty_entity_id", "lineno": 255, "outcome": "failed", "keywords": ["test_trigger_empty_entity_id", "test_automation_api.py", "asyncio", "automation", "tests", "marge", ""], "setup": {"duration": 0.005167105700820684, "outcome": "passed"}, "call": {"duration": 0.003089791163802147, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/automation/test_automation_api.py", "lineno": 263, "message": "assert 400 == 200\n +  where 400 = <Response [400 Bad Request]>.status_code"}, "traceback": [{"path": "tests/automation/test_automation_api.py", "lineno": 263, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0e18280>\n\n    async def test_trigger_empty_entity_id(rest):\n        \"\"\"Trigger with empty entity_id returns 200 (no-op).\"\"\"\n        resp = await rest.client.post(\n            f\"{rest.base_url}/api/services/automation/trigger\",\n            json={\"entity_id\": \"\"},\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 400 == 200\nE        +  where 400 = <Response [400 Bad Request]>.status_code\n\ntests/automation/test_automation_api.py:263: AssertionError"}, "teardown": {"duration": 0.0006036660633981228, "outcome": "passed"}}, {"nodeid": "tests/automation/test_automation_conditions.py::test_automation_turn_off", "lineno": 17, "outcome": "failed", "keywords": ["test_automation_turn_off", "test_automation_conditions.py", "asyncio", "automation", "tests", "marge", ""], "setup": {"duration": 0.005210130009800196, "outcome": "passed"}, "call": {"duration": 0.00404456676915288, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/automation/test_automation_conditions.py", "lineno": 24, "message": "TypeError: 'NoneType' object is not subscriptable"}, "traceback": [{"path": "tests/automation/test_automation_conditions.py", "lineno": 24, "message": "TypeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0d2e0d0>\n\n    async def test_automation_turn_off(rest):\n        \"\"\"automation.turn_off disables an automation.\"\"\"\n        await rest.call_service(\"automation\", \"turn_off\", {\n            \"entity_id\": \"automation.morning_wakeup\",\n        })\n        state = await rest.get_state(\"automation.morning_wakeup\")\n>       assert state[\"state\"] == \"off\"\nE       TypeError: 'NoneType' object is not subscriptable\n\ntests/automation/test_automation_conditions.py:24: TypeError"}, "teardown": {"duration": 0.0006125951185822487, "outcome": "passed"}}, {"nodeid": "tests/automation/test_automation_conditions.py::test_automation_turn_on", "lineno": 30, "outcome": "failed", "keywords": ["test_automation_turn_on", "test_automation_conditions.py", "asyncio", "automation", "tests", "marge", ""], "setup": {"duration": 0.0051282234489917755, "outcome": "passed"}, "call": {"duration": 0.0055511873215436935, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/automation/test_automation_conditions.py", "lineno": 40, "message": "TypeError: 'NoneType' object is not subscriptable"}, "traceback": [{"path": "tests/automation/test_automation_conditions.py", "lineno": 40, "message": "TypeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0e41fd0>\n\n    async def test_automation_turn_on(rest):\n        \"\"\"automation.turn_on enables an automation.\"\"\"\n        await rest.call_service(\"automation\", \"turn_off\", {\n            \"entity_id\": \"automation.morning_wakeup\",\n        })\n        await rest.call_service(\"automation\", \"turn_on\", {\n            \"entity_id\": \"automation.morning_wakeup\",\n        })\n        state = await rest.get_state(\"automation.morning_wakeup\")\n>       assert state[\"state\"] == \"on\"\nE       TypeError: 'NoneType' object is not subscriptable\n\ntests/automation/test_automation_conditions.py:40: TypeError"}, "teardown": {"duration": 0.0007409420795738697, "outcome": "passed"}}, {"nodeid": "tests/automation/test_automation_conditions.py::test_disabled_automation_not_triggered", "lineno": 42, "outcome": "passed", "keywords": ["test_disabled_automation_not_triggered", "test_automation_conditions.py", "asyncio", "automation", "tests", "marge", ""], "setup": {"duration": 0.005290800239890814, "outcome": "passed"}, "call": {"duration": 0.10916205774992704, "outcome": "passed"}, "teardown": {"duration": 0.0008195373229682446, "outcome": "passed"}}, {"nodeid": "tests/automation/test_automation_conditions.py::test_trigger_existing_automation", "lineno": 63, "outcome": "passed", "keywords": ["test_trigger_existing_automation", "test_automation_conditions.py", "asyncio", "automation", "tests", "marge", ""], "setup": {"duration": 0.007454825099557638, "outcome": "passed"}, "call": {"duration": 0.004361563827842474, "outcome": "passed"}, "teardown": {"duration": 0.000750283244997263, "outcome": "passed"}}, {"nodeid": "tests/automation/test_automation_conditions.py::test_automation_config_has_description", "lineno": 75, "outcome": "failed", "keywords": ["test_automation_config_has_description", "test_automation_conditions.py", "asyncio", "automation", "tests", "marge", ""], "setup": {"duration": 0.006902248132973909, "outcome": "passed"}, "call": {"duration": 0.0029429057613015175, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)"}, "traceback": [{"path": "tests/automation/test_automation_conditions.py", "lineno": 82, "message": ""}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 832, "message": "in json"}, {"path": "../../anaconda3/lib/python3.9/json/__init__.py", "lineno": 346, "message": "in loads"}, {"path": "../../anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "JSONDecodeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b08980a0>\n\n    async def test_automation_config_has_description(rest):\n        \"\"\"Automation config entries include description field.\"\"\"\n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/config/automation/config\",\n            headers=rest._headers(),\n        )\n>       data = resp.json()\n\ntests/automation/test_automation_conditions.py:82: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:832: in json\n    return jsonlib.loads(self.content, **kwargs)\n../../anaconda3/lib/python3.9/json/__init__.py:346: in loads\n    return _default_decoder.decode(s)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <json.decoder.JSONDecoder object at 0x7f47b2e5fe50>, s = '404: Not Found'\n_w = <built-in method match of re.Pattern object at 0x7f47b3015cf0>\n\n    def decode(self, s, _w=WHITESPACE.match):\n        \"\"\"Return the Python representation of ``s`` (a ``str`` instance\n        containing a JSON document).\n    \n        \"\"\"\n        obj, end = self.raw_decode(s, idx=_w(s, 0).end())\n        end = _w(s, end).end()\n        if end != len(s):\n>           raise JSONDecodeError(\"Extra data\", s, end)\nE           json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)\n\n../../anaconda3/lib/python3.9/json/decoder.py:340: JSONDecodeError"}, "teardown": {"duration": 0.0007500178180634975, "outcome": "passed"}}, {"nodeid": "tests/automation/test_automation_conditions.py::test_automation_config_has_last_triggered", "lineno": 86, "outcome": "failed", "keywords": ["test_automation_config_has_last_triggered", "test_automation_conditions.py", "asyncio", "automation", "tests", "marge", ""], "setup": {"duration": 0.0057587092742323875, "outcome": "passed"}, "call": {"duration": 0.002631724812090397, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)"}, "traceback": [{"path": "tests/automation/test_automation_conditions.py", "lineno": 93, "message": ""}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 832, "message": "in json"}, {"path": "../../anaconda3/lib/python3.9/json/__init__.py", "lineno": 346, "message": "in loads"}, {"path": "../../anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "JSONDecodeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0ce9130>\n\n    async def test_automation_config_has_last_triggered(rest):\n        \"\"\"Automation config entries include last_triggered field.\"\"\"\n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/config/automation/config\",\n            headers=rest._headers(),\n        )\n>       data = resp.json()\n\ntests/automation/test_automation_conditions.py:93: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:832: in json\n    return jsonlib.loads(self.content, **kwargs)\n../../anaconda3/lib/python3.9/json/__init__.py:346: in loads\n    return _default_decoder.decode(s)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <json.decoder.JSONDecoder object at 0x7f47b2e5fe50>, s = '404: Not Found'\n_w = <built-in method match of re.Pattern object at 0x7f47b3015cf0>\n\n    def decode(self, s, _w=WHITESPACE.match):\n        \"\"\"Return the Python representation of ``s`` (a ``str`` instance\n        containing a JSON document).\n    \n        \"\"\"\n        obj, end = self.raw_decode(s, idx=_w(s, 0).end())\n        end = _w(s, end).end()\n        if end != len(s):\n>           raise JSONDecodeError(\"Extra data\", s, end)\nE           json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)\n\n../../anaconda3/lib/python3.9/json/decoder.py:340: JSONDecodeError"}, "teardown": {"duration": 0.0006236610934138298, "outcome": "passed"}}, {"nodeid": "tests/automation/test_automation_conditions.py::test_automation_config_has_total_triggers", "lineno": 97, "outcome": "failed", "keywords": ["test_automation_config_has_total_triggers", "test_automation_conditions.py", "asyncio", "automation", "tests", "marge", ""], "setup": {"duration": 0.005411178804934025, "outcome": "passed"}, "call": {"duration": 0.0030784020200371742, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)"}, "traceback": [{"path": "tests/automation/test_automation_conditions.py", "lineno": 104, "message": ""}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 832, "message": "in json"}, {"path": "../../anaconda3/lib/python3.9/json/__init__.py", "lineno": 346, "message": "in loads"}, {"path": "../../anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "JSONDecodeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0d40910>\n\n    async def test_automation_config_has_total_triggers(rest):\n        \"\"\"Automation config entries include total_triggers field.\"\"\"\n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/config/automation/config\",\n            headers=rest._headers(),\n        )\n>       data = resp.json()\n\ntests/automation/test_automation_conditions.py:104: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:832: in json\n    return jsonlib.loads(self.content, **kwargs)\n../../anaconda3/lib/python3.9/json/__init__.py:346: in loads\n    return _default_decoder.decode(s)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <json.decoder.JSONDecoder object at 0x7f47b2e5fe50>, s = '404: Not Found'\n_w = <built-in method match of re.Pattern object at 0x7f47b3015cf0>\n\n    def decode(self, s, _w=WHITESPACE.match):\n        \"\"\"Return the Python representation of ``s`` (a ``str`` instance\n        containing a JSON document).\n    \n        \"\"\"\n        obj, end = self.raw_decode(s, idx=_w(s, 0).end())\n        end = _w(s, end).end()\n        if end != len(s):\n>           raise JSONDecodeError(\"Extra data\", s, end)\nE           json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)\n\n../../anaconda3/lib/python3.9/json/decoder.py:340: JSONDecodeError"}, "teardown": {"duration": 0.0008764881640672684, "outcome": "passed"}}, {"nodeid": "tests/automation/test_automation_conditions.py::test_automation_reload", "lineno": 111, "outcome": "failed", "keywords": ["test_automation_reload", "test_automation_conditions.py", "asyncio", "automation", "tests", "marge", ""], "setup": {"duration": 0.005344589240849018, "outcome": "passed"}, "call": {"duration": 0.003645847551524639, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/automation/test_automation_conditions.py", "lineno": 119, "message": "assert 404 == 200\n +  where 404 = <Response [404 Not Found]>.status_code"}, "traceback": [{"path": "tests/automation/test_automation_conditions.py", "lineno": 119, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0738490>\n\n    async def test_automation_reload(rest):\n        \"\"\"POST /api/config/core/reload reloads automations.\"\"\"\n        resp = await rest.client.post(\n            f\"{rest.base_url}/api/config/core/reload\",\n            json={},\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 404 == 200\nE        +  where 404 = <Response [404 Not Found]>.status_code\n\ntests/automation/test_automation_conditions.py:119: AssertionError"}, "teardown": {"duration": 0.0006273589096963406, "outcome": "passed"}}, {"nodeid": "tests/automation/test_automation_conditions.py::test_automation_reload_via_automation_endpoint", "lineno": 123, "outcome": "failed", "keywords": ["test_automation_reload_via_automation_endpoint", "test_automation_conditions.py", "asyncio", "automation", "tests", "marge", ""], "setup": {"duration": 0.005179478786885738, "outcome": "passed"}, "call": {"duration": 0.0025366912595927715, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/automation/test_automation_conditions.py", "lineno": 131, "message": "assert 404 == 200\n +  where 404 = <Response [404 Not Found]>.status_code"}, "traceback": [{"path": "tests/automation/test_automation_conditions.py", "lineno": 131, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b07dd910>\n\n    async def test_automation_reload_via_automation_endpoint(rest):\n        \"\"\"POST /api/config/automation/reload reloads automations.\"\"\"\n        resp = await rest.client.post(\n            f\"{rest.base_url}/api/config/automation/reload\",\n            json={},\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 404 == 200\nE        +  where 404 = <Response [404 Not Found]>.status_code\n\ntests/automation/test_automation_conditions.py:131: AssertionError"}, "teardown": {"duration": 0.0005308850668370724, "outcome": "passed"}}, {"nodeid": "tests/automation/test_automation_conditions.py::test_scene_config_list", "lineno": 137, "outcome": "failed", "keywords": ["test_scene_config_list", "test_automation_conditions.py", "asyncio", "automation", "tests", "marge", ""], "setup": {"duration": 0.005465109832584858, "outcome": "passed"}, "call": {"duration": 0.002553999423980713, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/automation/test_automation_conditions.py", "lineno": 144, "message": "assert 404 == 200\n +  where 404 = <Response [404 Not Found]>.status_code"}, "traceback": [{"path": "tests/automation/test_automation_conditions.py", "lineno": 144, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0cf1e80>\n\n    async def test_scene_config_list(rest):\n        \"\"\"GET /api/config/scene/config returns scene list.\"\"\"\n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/config/scene/config\",\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 404 == 200\nE        +  where 404 = <Response [404 Not Found]>.status_code\n\ntests/automation/test_automation_conditions.py:144: AssertionError"}, "teardown": {"duration": 0.0005115102976560593, "outcome": "passed"}}, {"nodeid": "tests/automation/test_automation_conditions.py::test_scene_config_has_name", "lineno": 149, "outcome": "failed", "keywords": ["test_scene_config_has_name", "test_automation_conditions.py", "asyncio", "automation", "tests", "marge", ""], "setup": {"duration": 0.005006441846489906, "outcome": "passed"}, "call": {"duration": 0.0022127609699964523, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)"}, "traceback": [{"path": "tests/automation/test_automation_conditions.py", "lineno": 156, "message": ""}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 832, "message": "in json"}, {"path": "../../anaconda3/lib/python3.9/json/__init__.py", "lineno": 346, "message": "in loads"}, {"path": "../../anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "JSONDecodeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0cf1910>\n\n    async def test_scene_config_has_name(rest):\n        \"\"\"Scene config entries have name field.\"\"\"\n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/config/scene/config\",\n            headers=rest._headers(),\n        )\n>       data = resp.json()\n\ntests/automation/test_automation_conditions.py:156: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:832: in json\n    return jsonlib.loads(self.content, **kwargs)\n../../anaconda3/lib/python3.9/json/__init__.py:346: in loads\n    return _default_decoder.decode(s)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <json.decoder.JSONDecoder object at 0x7f47b2e5fe50>, s = '404: Not Found'\n_w = <built-in method match of re.Pattern object at 0x7f47b3015cf0>\n\n    def decode(self, s, _w=WHITESPACE.match):\n        \"\"\"Return the Python representation of ``s`` (a ``str`` instance\n        containing a JSON document).\n    \n        \"\"\"\n        obj, end = self.raw_decode(s, idx=_w(s, 0).end())\n        end = _w(s, end).end()\n        if end != len(s):\n>           raise JSONDecodeError(\"Extra data\", s, end)\nE           json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)\n\n../../anaconda3/lib/python3.9/json/decoder.py:340: JSONDecodeError"}, "teardown": {"duration": 0.0007436778396368027, "outcome": "passed"}}, {"nodeid": "tests/automation/test_automation_conditions.py::test_scene_config_has_entities", "lineno": 161, "outcome": "failed", "keywords": ["test_scene_config_has_entities", "test_automation_conditions.py", "asyncio", "automation", "tests", "marge", ""], "setup": {"duration": 0.0051723807118833065, "outcome": "passed"}, "call": {"duration": 0.002501097973436117, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)"}, "traceback": [{"path": "tests/automation/test_automation_conditions.py", "lineno": 168, "message": ""}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 832, "message": "in json"}, {"path": "../../anaconda3/lib/python3.9/json/__init__.py", "lineno": 346, "message": "in loads"}, {"path": "../../anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "JSONDecodeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0d3b6a0>\n\n    async def test_scene_config_has_entities(rest):\n        \"\"\"Scene config entries have entity_count.\"\"\"\n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/config/scene/config\",\n            headers=rest._headers(),\n        )\n>       data = resp.json()\n\ntests/automation/test_automation_conditions.py:168: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:832: in json\n    return jsonlib.loads(self.content, **kwargs)\n../../anaconda3/lib/python3.9/json/__init__.py:346: in loads\n    return _default_decoder.decode(s)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <json.decoder.JSONDecoder object at 0x7f47b2e5fe50>, s = '404: Not Found'\n_w = <built-in method match of re.Pattern object at 0x7f47b3015cf0>\n\n    def decode(self, s, _w=WHITESPACE.match):\n        \"\"\"Return the Python representation of ``s`` (a ``str`` instance\n        containing a JSON document).\n    \n        \"\"\"\n        obj, end = self.raw_decode(s, idx=_w(s, 0).end())\n        end = _w(s, end).end()\n        if end != len(s):\n>           raise JSONDecodeError(\"Extra data\", s, end)\nE           json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)\n\n../../anaconda3/lib/python3.9/json/decoder.py:340: JSONDecodeError"}, "teardown": {"duration": 0.000817934051156044, "outcome": "passed"}}, {"nodeid": "tests/automation/test_automation_entity_state.py::test_automation_entities_exist", "lineno": 14, "outcome": "passed", "keywords": ["test_automation_entities_exist", "test_automation_entity_state.py", "asyncio", "automation", "tests", "marge", ""], "setup": {"duration": 0.0052341981790959835, "outcome": "passed"}, "call": {"duration": 0.004132600035518408, "outcome": "passed"}, "teardown": {"duration": 0.00045638810843229294, "outcome": "passed"}}, {"nodeid": "tests/automation/test_automation_entity_state.py::test_automation_entity_has_friendly_name", "lineno": 21, "outcome": "passed", "keywords": ["test_automation_entity_has_friendly_name", "test_automation_entity_state.py", "asyncio", "automation", "tests", "marge", ""], "setup": {"duration": 0.006072962190955877, "outcome": "passed"}, "call": {"duration": 0.00432179681956768, "outcome": "passed"}, "teardown": {"duration": 0.0004943730309605598, "outcome": "passed"}}, {"nodeid": "tests/automation/test_automation_entity_state.py::test_automation_entity_state_on", "lineno": 31, "outcome": "failed", "keywords": ["test_automation_entity_state_on", "test_automation_entity_state.py", "asyncio", "automation", "tests", "marge", ""], "setup": {"duration": 0.00512378104031086, "outcome": "passed"}, "call": {"duration": 0.0030628680251538754, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)"}, "traceback": [{"path": "tests/automation/test_automation_entity_state.py", "lineno": 38, "message": ""}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 832, "message": "in json"}, {"path": "../../anaconda3/lib/python3.9/json/__init__.py", "lineno": 346, "message": "in loads"}, {"path": "../../anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "JSONDecodeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b09b6e20>\n\n    async def test_automation_entity_state_on(rest):\n        \"\"\"Enabled automations have state 'on'.\"\"\"\n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/config/automation/config\",\n            headers=rest._headers(),\n        )\n>       autos = resp.json()\n\ntests/automation/test_automation_entity_state.py:38: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:832: in json\n    return jsonlib.loads(self.content, **kwargs)\n../../anaconda3/lib/python3.9/json/__init__.py:346: in loads\n    return _default_decoder.decode(s)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <json.decoder.JSONDecoder object at 0x7f47b2e5fe50>, s = '404: Not Found'\n_w = <built-in method match of re.Pattern object at 0x7f47b3015cf0>\n\n    def decode(self, s, _w=WHITESPACE.match):\n        \"\"\"Return the Python representation of ``s`` (a ``str`` instance\n        containing a JSON document).\n    \n        \"\"\"\n        obj, end = self.raw_decode(s, idx=_w(s, 0).end())\n        end = _w(s, end).end()\n        if end != len(s):\n>           raise JSONDecodeError(\"Extra data\", s, end)\nE           json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)\n\n../../anaconda3/lib/python3.9/json/decoder.py:340: JSONDecodeError"}, "teardown": {"duration": 0.000871692318469286, "outcome": "passed"}}, {"nodeid": "tests/automation/test_automation_entity_state.py::test_automation_config_has_fields", "lineno": 46, "outcome": "failed", "keywords": ["test_automation_config_has_fields", "test_automation_entity_state.py", "asyncio", "automation", "tests", "marge", ""], "setup": {"duration": 0.005589032080024481, "outcome": "passed"}, "call": {"duration": 0.002845221199095249, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/automation/test_automation_entity_state.py", "lineno": 53, "message": "assert 404 == 200\n +  where 404 = <Response [404 Not Found]>.status_code"}, "traceback": [{"path": "tests/automation/test_automation_entity_state.py", "lineno": 53, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b1290280>\n\n    async def test_automation_config_has_fields(rest):\n        \"\"\"GET /api/config/automation/config returns expected fields.\"\"\"\n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/config/automation/config\",\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 404 == 200\nE        +  where 404 = <Response [404 Not Found]>.status_code\n\ntests/automation/test_automation_entity_state.py:53: AssertionError"}, "teardown": {"duration": 0.0007691187784075737, "outcome": "passed"}}, {"nodeid": "tests/automation/test_automation_entity_state.py::test_automation_config_trigger_count", "lineno": 66, "outcome": "failed", "keywords": ["test_automation_config_trigger_count", "test_automation_entity_state.py", "asyncio", "automation", "tests", "marge", ""], "setup": {"duration": 0.006106801796704531, "outcome": "passed"}, "call": {"duration": 0.002625608816742897, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)"}, "traceback": [{"path": "tests/automation/test_automation_entity_state.py", "lineno": 73, "message": ""}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 832, "message": "in json"}, {"path": "../../anaconda3/lib/python3.9/json/__init__.py", "lineno": 346, "message": "in loads"}, {"path": "../../anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "JSONDecodeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b1290d90>\n\n    async def test_automation_config_trigger_count(rest):\n        \"\"\"Automation config shows correct trigger count.\"\"\"\n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/config/automation/config\",\n            headers=rest._headers(),\n        )\n>       autos = resp.json()\n\ntests/automation/test_automation_entity_state.py:73: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:832: in json\n    return jsonlib.loads(self.content, **kwargs)\n../../anaconda3/lib/python3.9/json/__init__.py:346: in loads\n    return _default_decoder.decode(s)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <json.decoder.JSONDecoder object at 0x7f47b2e5fe50>, s = '404: Not Found'\n_w = <built-in method match of re.Pattern object at 0x7f47b3015cf0>\n\n    def decode(self, s, _w=WHITESPACE.match):\n        \"\"\"Return the Python representation of ``s`` (a ``str`` instance\n        containing a JSON document).\n    \n        \"\"\"\n        obj, end = self.raw_decode(s, idx=_w(s, 0).end())\n        end = _w(s, end).end()\n        if end != len(s):\n>           raise JSONDecodeError(\"Extra data\", s, end)\nE           json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)\n\n../../anaconda3/lib/python3.9/json/decoder.py:340: JSONDecodeError"}, "teardown": {"duration": 0.0006550499238073826, "outcome": "passed"}}, {"nodeid": "tests/automation/test_automation_entity_state.py::test_automation_config_mode", "lineno": 78, "outcome": "failed", "keywords": ["test_automation_config_mode", "test_automation_entity_state.py", "asyncio", "automation", "tests", "marge", ""], "setup": {"duration": 0.006082161795347929, "outcome": "passed"}, "call": {"duration": 0.0026457980275154114, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)"}, "traceback": [{"path": "tests/automation/test_automation_entity_state.py", "lineno": 85, "message": ""}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 832, "message": "in json"}, {"path": "../../anaconda3/lib/python3.9/json/__init__.py", "lineno": 346, "message": "in loads"}, {"path": "../../anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "JSONDecodeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0898850>\n\n    async def test_automation_config_mode(rest):\n        \"\"\"Automation mode is a valid string.\"\"\"\n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/config/automation/config\",\n            headers=rest._headers(),\n        )\n>       autos = resp.json()\n\ntests/automation/test_automation_entity_state.py:85: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:832: in json\n    return jsonlib.loads(self.content, **kwargs)\n../../anaconda3/lib/python3.9/json/__init__.py:346: in loads\n    return _default_decoder.decode(s)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <json.decoder.JSONDecoder object at 0x7f47b2e5fe50>, s = '404: Not Found'\n_w = <built-in method match of re.Pattern object at 0x7f47b3015cf0>\n\n    def decode(self, s, _w=WHITESPACE.match):\n        \"\"\"Return the Python representation of ``s`` (a ``str`` instance\n        containing a JSON document).\n    \n        \"\"\"\n        obj, end = self.raw_decode(s, idx=_w(s, 0).end())\n        end = _w(s, end).end()\n        if end != len(s):\n>           raise JSONDecodeError(\"Extra data\", s, end)\nE           json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)\n\n../../anaconda3/lib/python3.9/json/decoder.py:340: JSONDecodeError"}, "teardown": {"duration": 0.0006923060864210129, "outcome": "passed"}}, {"nodeid": "tests/automation/test_automation_entity_state.py::test_automation_disable_changes_state", "lineno": 89, "outcome": "failed", "keywords": ["test_automation_disable_changes_state", "test_automation_entity_state.py", "asyncio", "automation", "tests", "marge", ""], "setup": {"duration": 0.006094793323427439, "outcome": "passed"}, "call": {"duration": 0.002666641026735306, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)"}, "traceback": [{"path": "tests/automation/test_automation_entity_state.py", "lineno": 96, "message": ""}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 832, "message": "in json"}, {"path": "../../anaconda3/lib/python3.9/json/__init__.py", "lineno": 346, "message": "in loads"}, {"path": "../../anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "JSONDecodeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0870550>\n\n    async def test_automation_disable_changes_state(rest):\n        \"\"\"Disabling automation changes entity state to 'off'.\"\"\"\n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/config/automation/config\",\n            headers=rest._headers(),\n        )\n>       autos = resp.json()\n\ntests/automation/test_automation_entity_state.py:96: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:832: in json\n    return jsonlib.loads(self.content, **kwargs)\n../../anaconda3/lib/python3.9/json/__init__.py:346: in loads\n    return _default_decoder.decode(s)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <json.decoder.JSONDecoder object at 0x7f47b2e5fe50>, s = '404: Not Found'\n_w = <built-in method match of re.Pattern object at 0x7f47b3015cf0>\n\n    def decode(self, s, _w=WHITESPACE.match):\n        \"\"\"Return the Python representation of ``s`` (a ``str`` instance\n        containing a JSON document).\n    \n        \"\"\"\n        obj, end = self.raw_decode(s, idx=_w(s, 0).end())\n        end = _w(s, end).end()\n        if end != len(s):\n>           raise JSONDecodeError(\"Extra data\", s, end)\nE           json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)\n\n../../anaconda3/lib/python3.9/json/decoder.py:340: JSONDecodeError"}, "teardown": {"duration": 0.0006776335649192333, "outcome": "passed"}}, {"nodeid": "tests/automation/test_automation_entity_state.py::test_automation_config_enabled_tracks_state", "lineno": 110, "outcome": "failed", "keywords": ["test_automation_config_enabled_tracks_state", "test_automation_entity_state.py", "asyncio", "automation", "tests", "marge", ""], "setup": {"duration": 0.00512643763795495, "outcome": "passed"}, "call": {"duration": 0.0028961701318621635, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)"}, "traceback": [{"path": "tests/automation/test_automation_entity_state.py", "lineno": 117, "message": ""}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 832, "message": "in json"}, {"path": "../../anaconda3/lib/python3.9/json/__init__.py", "lineno": 346, "message": "in loads"}, {"path": "../../anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "JSONDecodeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0f3b2e0>\n\n    async def test_automation_config_enabled_tracks_state(rest):\n        \"\"\"Config API reflects enabled/disabled state.\"\"\"\n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/config/automation/config\",\n            headers=rest._headers(),\n        )\n>       autos = resp.json()\n\ntests/automation/test_automation_entity_state.py:117: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:832: in json\n    return jsonlib.loads(self.content, **kwargs)\n../../anaconda3/lib/python3.9/json/__init__.py:346: in loads\n    return _default_decoder.decode(s)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <json.decoder.JSONDecoder object at 0x7f47b2e5fe50>, s = '404: Not Found'\n_w = <built-in method match of re.Pattern object at 0x7f47b3015cf0>\n\n    def decode(self, s, _w=WHITESPACE.match):\n        \"\"\"Return the Python representation of ``s`` (a ``str`` instance\n        containing a JSON document).\n    \n        \"\"\"\n        obj, end = self.raw_decode(s, idx=_w(s, 0).end())\n        end = _w(s, end).end()\n        if end != len(s):\n>           raise JSONDecodeError(\"Extra data\", s, end)\nE           json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)\n\n../../anaconda3/lib/python3.9/json/decoder.py:340: JSONDecodeError"}, "teardown": {"duration": 0.0008399970829486847, "outcome": "passed"}}, {"nodeid": "tests/automation/test_automation_entity_state.py::test_scene_entities_exist", "lineno": 144, "outcome": "passed", "keywords": ["test_scene_entities_exist", "test_automation_entity_state.py", "asyncio", "automation", "tests", "marge", ""], "setup": {"duration": 0.005125632043927908, "outcome": "passed"}, "call": {"duration": 0.004473936278373003, "outcome": "passed"}, "teardown": {"duration": 0.0007422049529850483, "outcome": "passed"}}, {"nodeid": "tests/automation/test_automation_entity_state.py::test_scene_config_api", "lineno": 151, "outcome": "failed", "keywords": ["test_scene_config_api", "test_automation_entity_state.py", "asyncio", "automation", "tests", "marge", ""], "setup": {"duration": 0.005162862129509449, "outcome": "passed"}, "call": {"duration": 0.0026655825786292553, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/automation/test_automation_entity_state.py", "lineno": 158, "message": "assert 404 == 200\n +  where 404 = <Response [404 Not Found]>.status_code"}, "traceback": [{"path": "tests/automation/test_automation_entity_state.py", "lineno": 158, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0fb81c0>\n\n    async def test_scene_config_api(rest):\n        \"\"\"GET /api/config/scene/config returns scene metadata.\"\"\"\n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/config/scene/config\",\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 404 == 200\nE        +  where 404 = <Response [404 Not Found]>.status_code\n\ntests/automation/test_automation_entity_state.py:158: AssertionError"}, "teardown": {"duration": 0.0007844157516956329, "outcome": "passed"}}, {"nodeid": "tests/automation/test_automation_entity_state.py::test_automation_total_triggers_counter", "lineno": 167, "outcome": "failed", "keywords": ["test_automation_total_triggers_counter", "test_automation_entity_state.py", "asyncio", "automation", "tests", "marge", ""], "setup": {"duration": 0.006004697643220425, "outcome": "passed"}, "call": {"duration": 0.002723327372223139, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)"}, "traceback": [{"path": "tests/automation/test_automation_entity_state.py", "lineno": 174, "message": ""}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 832, "message": "in json"}, {"path": "../../anaconda3/lib/python3.9/json/__init__.py", "lineno": 346, "message": "in loads"}, {"path": "../../anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "JSONDecodeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0e28b80>\n\n    async def test_automation_total_triggers_counter(rest):\n        \"\"\"total_triggers field starts at 0 or positive integer.\"\"\"\n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/config/automation/config\",\n            headers=rest._headers(),\n        )\n>       autos = resp.json()\n\ntests/automation/test_automation_entity_state.py:174: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:832: in json\n    return jsonlib.loads(self.content, **kwargs)\n../../anaconda3/lib/python3.9/json/__init__.py:346: in loads\n    return _default_decoder.decode(s)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <json.decoder.JSONDecoder object at 0x7f47b2e5fe50>, s = '404: Not Found'\n_w = <built-in method match of re.Pattern object at 0x7f47b3015cf0>\n\n    def decode(self, s, _w=WHITESPACE.match):\n        \"\"\"Return the Python representation of ``s`` (a ``str`` instance\n        containing a JSON document).\n    \n        \"\"\"\n        obj, end = self.raw_decode(s, idx=_w(s, 0).end())\n        end = _w(s, end).end()\n        if end != len(s):\n>           raise JSONDecodeError(\"Extra data\", s, end)\nE           json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)\n\n../../anaconda3/lib/python3.9/json/decoder.py:340: JSONDecodeError"}, "teardown": {"duration": 0.0006903731264173985, "outcome": "passed"}}, {"nodeid": "tests/automation/test_automation_entity_state.py::test_automation_entity_default_on", "lineno": 182, "outcome": "passed", "keywords": ["test_automation_entity_default_on", "test_automation_entity_state.py", "asyncio", "automation", "tests", "marge", ""], "setup": {"duration": 0.005792773794382811, "outcome": "passed"}, "call": {"duration": 0.004453742876648903, "outcome": "passed"}, "teardown": {"duration": 0.0005155741237103939, "outcome": "passed"}}, {"nodeid": "tests/automation/test_automation_entity_state.py::test_automation_entity_has_attributes", "lineno": 190, "outcome": "passed", "keywords": ["test_automation_entity_has_attributes", "test_automation_entity_state.py", "asyncio", "automation", "tests", "marge", ""], "setup": {"duration": 0.005122993607074022, "outcome": "passed"}, "call": {"duration": 0.042149059008806944, "outcome": "passed"}, "teardown": {"duration": 0.0006167353130877018, "outcome": "passed"}}, {"nodeid": "tests/automation/test_automation_entity_state.py::test_automation_trigger_succeeds", "lineno": 200, "outcome": "failed", "keywords": ["test_automation_trigger_succeeds", "test_automation_entity_state.py", "asyncio", "automation", "tests", "marge", ""], "setup": {"duration": 0.005273895338177681, "outcome": "passed"}, "call": {"duration": 0.0028297449462115765, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)"}, "traceback": [{"path": "tests/automation/test_automation_entity_state.py", "lineno": 207, "message": ""}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 832, "message": "in json"}, {"path": "../../anaconda3/lib/python3.9/json/__init__.py", "lineno": 346, "message": "in loads"}, {"path": "../../anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "JSONDecodeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0f8cb50>\n\n    async def test_automation_trigger_succeeds(rest):\n        \"\"\"automation.trigger via API returns success.\"\"\"\n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/config/automation/config\",\n            headers=rest._headers(),\n        )\n>       autos = resp.json()\n\ntests/automation/test_automation_entity_state.py:207: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:832: in json\n    return jsonlib.loads(self.content, **kwargs)\n../../anaconda3/lib/python3.9/json/__init__.py:346: in loads\n    return _default_decoder.decode(s)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <json.decoder.JSONDecoder object at 0x7f47b2e5fe50>, s = '404: Not Found'\n_w = <built-in method match of re.Pattern object at 0x7f47b3015cf0>\n\n    def decode(self, s, _w=WHITESPACE.match):\n        \"\"\"Return the Python representation of ``s`` (a ``str`` instance\n        containing a JSON document).\n    \n        \"\"\"\n        obj, end = self.raw_decode(s, idx=_w(s, 0).end())\n        end = _w(s, end).end()\n        if end != len(s):\n>           raise JSONDecodeError(\"Extra data\", s, end)\nE           json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)\n\n../../anaconda3/lib/python3.9/json/decoder.py:340: JSONDecodeError"}, "teardown": {"duration": 0.0008834190666675568, "outcome": "passed"}}, {"nodeid": "tests/automation/test_automation_entity_state.py::test_automation_trigger_increments_count", "lineno": 214, "outcome": "failed", "keywords": ["test_automation_trigger_increments_count", "test_automation_entity_state.py", "asyncio", "automation", "tests", "marge", ""], "setup": {"duration": 0.00540813198313117, "outcome": "passed"}, "call": {"duration": 0.002765331882983446, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)"}, "traceback": [{"path": "tests/automation/test_automation_entity_state.py", "lineno": 221, "message": ""}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 832, "message": "in json"}, {"path": "../../anaconda3/lib/python3.9/json/__init__.py", "lineno": 346, "message": "in loads"}, {"path": "../../anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "JSONDecodeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0f3b6a0>\n\n    async def test_automation_trigger_increments_count(rest):\n        \"\"\"Triggering an automation increments total_triggers.\"\"\"\n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/config/automation/config\",\n            headers=rest._headers(),\n        )\n>       autos = resp.json()\n\ntests/automation/test_automation_entity_state.py:221: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:832: in json\n    return jsonlib.loads(self.content, **kwargs)\n../../anaconda3/lib/python3.9/json/__init__.py:346: in loads\n    return _default_decoder.decode(s)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <json.decoder.JSONDecoder object at 0x7f47b2e5fe50>, s = '404: Not Found'\n_w = <built-in method match of re.Pattern object at 0x7f47b3015cf0>\n\n    def decode(self, s, _w=WHITESPACE.match):\n        \"\"\"Return the Python representation of ``s`` (a ``str`` instance\n        containing a JSON document).\n    \n        \"\"\"\n        obj, end = self.raw_decode(s, idx=_w(s, 0).end())\n        end = _w(s, end).end()\n        if end != len(s):\n>           raise JSONDecodeError(\"Extra data\", s, end)\nE           json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)\n\n../../anaconda3/lib/python3.9/json/decoder.py:340: JSONDecodeError"}, "teardown": {"duration": 0.0006866957992315292, "outcome": "passed"}}, {"nodeid": "tests/automation/test_automation_entity_state.py::test_automation_trigger_sets_last_triggered", "lineno": 238, "outcome": "failed", "keywords": ["test_automation_trigger_sets_last_triggered", "test_automation_entity_state.py", "asyncio", "automation", "tests", "marge", ""], "setup": {"duration": 0.005845379084348679, "outcome": "passed"}, "call": {"duration": 0.0027519348077476025, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)"}, "traceback": [{"path": "tests/automation/test_automation_entity_state.py", "lineno": 245, "message": ""}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 832, "message": "in json"}, {"path": "../../anaconda3/lib/python3.9/json/__init__.py", "lineno": 346, "message": "in loads"}, {"path": "../../anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "JSONDecodeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b11d3130>\n\n    async def test_automation_trigger_sets_last_triggered(rest):\n        \"\"\"Triggering an automation sets last_triggered timestamp.\"\"\"\n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/config/automation/config\",\n            headers=rest._headers(),\n        )\n>       autos = resp.json()\n\ntests/automation/test_automation_entity_state.py:245: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:832: in json\n    return jsonlib.loads(self.content, **kwargs)\n../../anaconda3/lib/python3.9/json/__init__.py:346: in loads\n    return _default_decoder.decode(s)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <json.decoder.JSONDecoder object at 0x7f47b2e5fe50>, s = '404: Not Found'\n_w = <built-in method match of re.Pattern object at 0x7f47b3015cf0>\n\n    def decode(self, s, _w=WHITESPACE.match):\n        \"\"\"Return the Python representation of ``s`` (a ``str`` instance\n        containing a JSON document).\n    \n        \"\"\"\n        obj, end = self.raw_decode(s, idx=_w(s, 0).end())\n        end = _w(s, end).end()\n        if end != len(s):\n>           raise JSONDecodeError(\"Extra data\", s, end)\nE           json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)\n\n../../anaconda3/lib/python3.9/json/decoder.py:340: JSONDecodeError"}, "teardown": {"duration": 0.000821742694824934, "outcome": "passed"}}, {"nodeid": "tests/automation/test_automation_execution.py::test_automation_disable_sets_off", "lineno": 13, "outcome": "failed", "keywords": ["test_automation_disable_sets_off", "test_automation_execution.py", "asyncio", "automation", "tests", "marge", ""], "setup": {"duration": 0.005985022988170385, "outcome": "passed"}, "call": {"duration": 0.004485223907977343, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/automation/test_automation_execution.py", "lineno": 20, "message": "TypeError: 'NoneType' object is not subscriptable"}, "traceback": [{"path": "tests/automation/test_automation_execution.py", "lineno": 20, "message": "TypeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b11d3d30>\n\n    async def test_automation_disable_sets_off(rest):\n        \"\"\"Disabling automation sets entity state to 'off'.\"\"\"\n        await rest.call_service(\"automation\", \"turn_off\", {\n            \"entity_id\": \"automation.smoke_co_emergency\"\n        })\n        state = await rest.get_state(\"automation.smoke_co_emergency\")\n>       assert state[\"state\"] == \"off\"\nE       TypeError: 'NoneType' object is not subscriptable\n\ntests/automation/test_automation_execution.py:20: TypeError"}, "teardown": {"duration": 0.0006487760692834854, "outcome": "passed"}}, {"nodeid": "tests/automation/test_automation_execution.py::test_force_trigger_executes_actions", "lineno": 31, "outcome": "failed", "keywords": ["test_force_trigger_executes_actions", "test_automation_execution.py", "asyncio", "automation", "tests", "marge", ""], "setup": {"duration": 0.005314073991030455, "outcome": "passed"}, "call": {"duration": 0.3079973612911999, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/automation/test_automation_execution.py", "lineno": 42, "message": "assert None is not None"}, "traceback": [{"path": "tests/automation/test_automation_execution.py", "lineno": 42, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0f238b0>\n\n    async def test_force_trigger_executes_actions(rest):\n        \"\"\"automation.trigger bypasses triggers and conditions.\"\"\"\n        # Set up a known starting state for the automation's targets\n        await rest.set_state(\"binary_sensor.smoke_detector\", \"off\")\n        await rest.call_service(\"automation\", \"trigger\", {\n            \"entity_id\": \"automation.smoke_co_emergency\"\n        })\n        await asyncio.sleep(0.3)\n        # The trigger count should increase\n        state = await rest.get_state(\"automation.smoke_co_emergency\")\n>       assert state is not None\nE       assert None is not None\n\ntests/automation/test_automation_execution.py:42: AssertionError"}, "teardown": {"duration": 0.0007326230406761169, "outcome": "passed"}}, {"nodeid": "tests/automation/test_automation_execution.py::test_force_trigger_records_last_triggered", "lineno": 44, "outcome": "failed", "keywords": ["test_force_trigger_records_last_triggered", "test_automation_execution.py", "asyncio", "automation", "tests", "marge", ""], "setup": {"duration": 0.005536799319088459, "outcome": "passed"}, "call": {"duration": 0.2076507699675858, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/automation/test_automation_execution.py", "lineno": 52, "message": "TypeError: 'NoneType' object is not subscriptable"}, "traceback": [{"path": "tests/automation/test_automation_execution.py", "lineno": 52, "message": "TypeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0898460>\n\n    async def test_force_trigger_records_last_triggered(rest):\n        \"\"\"Force trigger updates last_triggered attribute.\"\"\"\n        await rest.call_service(\"automation\", \"trigger\", {\n            \"entity_id\": \"automation.smoke_co_emergency\"\n        })\n        await asyncio.sleep(0.2)\n        state = await rest.get_state(\"automation.smoke_co_emergency\")\n>       assert \"last_triggered\" in state[\"attributes\"]\nE       TypeError: 'NoneType' object is not subscriptable\n\ntests/automation/test_automation_execution.py:52: TypeError"}, "teardown": {"duration": 0.0013403086923062801, "outcome": "passed"}}, {"nodeid": "tests/automation/test_automation_execution.py::test_force_trigger_increments_count", "lineno": 55, "outcome": "failed", "keywords": ["test_force_trigger_increments_count", "test_automation_execution.py", "asyncio", "automation", "tests", "marge", ""], "setup": {"duration": 0.011685212142765522, "outcome": "passed"}, "call": {"duration": 0.005194566678255796, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/automation/test_automation_execution.py", "lineno": 59, "message": "TypeError: 'NoneType' object is not subscriptable"}, "traceback": [{"path": "tests/automation/test_automation_execution.py", "lineno": 59, "message": "TypeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b08984f0>\n\n    async def test_force_trigger_increments_count(rest):\n        \"\"\"Force trigger increments current trigger count.\"\"\"\n        s1 = await rest.get_state(\"automation.smoke_co_emergency\")\n>       count_before = s1[\"attributes\"].get(\"current\", 0)\nE       TypeError: 'NoneType' object is not subscriptable\n\ntests/automation/test_automation_execution.py:59: TypeError"}, "teardown": {"duration": 0.0009870599023997784, "outcome": "passed"}}, {"nodeid": "tests/automation/test_automation_execution.py::test_reload_preserves_trigger_counts", "lineno": 72, "outcome": "failed", "keywords": ["test_reload_preserves_trigger_counts", "test_automation_execution.py", "asyncio", "automation", "tests", "marge", ""], "setup": {"duration": 0.008042940869927406, "outcome": "passed"}, "call": {"duration": 0.0039153737016022205, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/automation/test_automation_execution.py", "lineno": 77, "message": "TypeError: 'NoneType' object is not subscriptable"}, "traceback": [{"path": "tests/automation/test_automation_execution.py", "lineno": 77, "message": "TypeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0d39100>\n\n    async def test_reload_preserves_trigger_counts(rest):\n        \"\"\"Reloading does not reset trigger counts.\"\"\"\n        # Get current count\n        s1 = await rest.get_state(\"automation.smoke_co_emergency\")\n>       count = s1[\"attributes\"].get(\"current\", 0)\nE       TypeError: 'NoneType' object is not subscriptable\n\ntests/automation/test_automation_execution.py:77: TypeError"}, "teardown": {"duration": 0.000781504437327385, "outcome": "passed"}}, {"nodeid": "tests/automation/test_automation_execution.py::test_automations_info_endpoint", "lineno": 92, "outcome": "failed", "keywords": ["test_automations_info_endpoint", "test_automation_execution.py", "asyncio", "automation", "tests", "marge", ""], "setup": {"duration": 0.008285415824502707, "outcome": "passed"}, "call": {"duration": 0.004203253425657749, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/automation/test_automation_execution.py", "lineno": 99, "message": "assert 404 == 200\n +  where 404 = <Response [404 Not Found]>.status_code"}, "traceback": [{"path": "tests/automation/test_automation_execution.py", "lineno": 99, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0541070>\n\n    async def test_automations_info_endpoint(rest):\n        \"\"\"GET /api/config/automation/config returns automation info list.\"\"\"\n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/config/automation/config\",\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 404 == 200\nE        +  where 404 = <Response [404 Not Found]>.status_code\n\ntests/automation/test_automation_execution.py:99: AssertionError"}, "teardown": {"duration": 0.000974737573415041, "outcome": "passed"}}, {"nodeid": "tests/automation/test_automation_execution.py::test_automations_info_has_fields", "lineno": 104, "outcome": "failed", "keywords": ["test_automations_info_has_fields", "test_automation_execution.py", "asyncio", "automation", "tests", "marge", ""], "setup": {"duration": 0.007859908044338226, "outcome": "passed"}, "call": {"duration": 0.003579717129468918, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)"}, "traceback": [{"path": "tests/automation/test_automation_execution.py", "lineno": 111, "message": ""}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 832, "message": "in json"}, {"path": "../../anaconda3/lib/python3.9/json/__init__.py", "lineno": 346, "message": "in loads"}, {"path": "../../anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "JSONDecodeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0d24f40>\n\n    async def test_automations_info_has_fields(rest):\n        \"\"\"Automation info entries have required fields.\"\"\"\n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/config/automation/config\",\n            headers=rest._headers(),\n        )\n>       data = resp.json()\n\ntests/automation/test_automation_execution.py:111: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:832: in json\n    return jsonlib.loads(self.content, **kwargs)\n../../anaconda3/lib/python3.9/json/__init__.py:346: in loads\n    return _default_decoder.decode(s)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <json.decoder.JSONDecoder object at 0x7f47b2e5fe50>, s = '404: Not Found'\n_w = <built-in method match of re.Pattern object at 0x7f47b3015cf0>\n\n    def decode(self, s, _w=WHITESPACE.match):\n        \"\"\"Return the Python representation of ``s`` (a ``str`` instance\n        containing a JSON document).\n    \n        \"\"\"\n        obj, end = self.raw_decode(s, idx=_w(s, 0).end())\n        end = _w(s, end).end()\n        if end != len(s):\n>           raise JSONDecodeError(\"Extra data\", s, end)\nE           json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)\n\n../../anaconda3/lib/python3.9/json/decoder.py:340: JSONDecodeError"}, "teardown": {"duration": 0.0007826909422874451, "outcome": "passed"}}, {"nodeid": "tests/automation/test_automation_execution.py::test_automations_info_trigger_counts", "lineno": 117, "outcome": "failed", "keywords": ["test_automations_info_trigger_counts", "test_automation_execution.py", "asyncio", "automation", "tests", "marge", ""], "setup": {"duration": 0.005945049226284027, "outcome": "passed"}, "call": {"duration": 0.0029497891664505005, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)"}, "traceback": [{"path": "tests/automation/test_automation_execution.py", "lineno": 124, "message": ""}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 832, "message": "in json"}, {"path": "../../anaconda3/lib/python3.9/json/__init__.py", "lineno": 346, "message": "in loads"}, {"path": "../../anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "JSONDecodeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0cd3640>\n\n    async def test_automations_info_trigger_counts(rest):\n        \"\"\"Automation info reports correct trigger/condition/action counts.\"\"\"\n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/config/automation/config\",\n            headers=rest._headers(),\n        )\n>       data = resp.json()\n\ntests/automation/test_automation_execution.py:124: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:832: in json\n    return jsonlib.loads(self.content, **kwargs)\n../../anaconda3/lib/python3.9/json/__init__.py:346: in loads\n    return _default_decoder.decode(s)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <json.decoder.JSONDecoder object at 0x7f47b2e5fe50>, s = '404: Not Found'\n_w = <built-in method match of re.Pattern object at 0x7f47b3015cf0>\n\n    def decode(self, s, _w=WHITESPACE.match):\n        \"\"\"Return the Python representation of ``s`` (a ``str`` instance\n        containing a JSON document).\n    \n        \"\"\"\n        obj, end = self.raw_decode(s, idx=_w(s, 0).end())\n        end = _w(s, end).end()\n        if end != len(s):\n>           raise JSONDecodeError(\"Extra data\", s, end)\nE           json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)\n\n../../anaconda3/lib/python3.9/json/decoder.py:340: JSONDecodeError"}, "teardown": {"duration": 0.0006568138487637043, "outcome": "passed"}}, {"nodeid": "tests/automation/test_automation_execution.py::test_state_trigger_fires_automation", "lineno": 132, "outcome": "failed", "keywords": ["test_state_trigger_fires_automation", "test_automation_execution.py", "asyncio", "automation", "tests", "marge", ""], "setup": {"duration": 0.005344667937606573, "outcome": "passed"}, "call": {"duration": 0.6085852379910648, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/automation/test_automation_execution.py", "lineno": 145, "message": "TypeError: 'NoneType' object is not subscriptable"}, "traceback": [{"path": "tests/automation/test_automation_execution.py", "lineno": 145, "message": "TypeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0cf14c0>\n\n    async def test_state_trigger_fires_automation(rest):\n        \"\"\"State trigger fires when entity matches to value.\"\"\"\n        # smoke_co_emergency triggers on binary_sensor.smoke_detector -> on\n        await rest.set_state(\"binary_sensor.smoke_detector\", \"off\")\n        await asyncio.sleep(0.1)\n    \n        # Trigger the automation by setting state to 'on'\n        await rest.set_state(\"binary_sensor.smoke_detector\", \"on\")\n        await asyncio.sleep(0.5)\n    \n        # Check the automation was triggered (last_triggered updated)\n        state = await rest.get_state(\"automation.smoke_co_emergency\")\n>       assert \"last_triggered\" in state[\"attributes\"]\nE       TypeError: 'NoneType' object is not subscriptable\n\ntests/automation/test_automation_execution.py:145: TypeError"}, "teardown": {"duration": 0.0007459330372512341, "outcome": "passed"}}, {"nodeid": "tests/automation/test_automation_execution.py::test_fire_event_triggers_automation", "lineno": 149, "outcome": "passed", "keywords": ["test_fire_event_triggers_automation", "test_automation_execution.py", "asyncio", "automation", "tests", "marge", ""], "setup": {"duration": 0.006990992929786444, "outcome": "passed"}, "call": {"duration": 0.003322949167340994, "outcome": "passed"}, "teardown": {"duration": 0.0006298352964222431, "outcome": "passed"}}, {"nodeid": "tests/automation/test_automation_multi_entity_trigger.py::test_smoke_co_has_two_triggers", "lineno": 16, "outcome": "failed", "keywords": ["test_smoke_co_has_two_triggers", "test_automation_multi_entity_trigger.py", "asyncio", "automation", "tests", "marge", ""], "setup": {"duration": 0.007770820055156946, "outcome": "passed"}, "call": {"duration": 0.0035420660860836506, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)"}, "traceback": [{"path": "tests/automation/test_automation_multi_entity_trigger.py", "lineno": 23, "message": ""}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 832, "message": "in json"}, {"path": "../../anaconda3/lib/python3.9/json/__init__.py", "lineno": 346, "message": "in loads"}, {"path": "../../anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "JSONDecodeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0def6d0>\n\n    async def test_smoke_co_has_two_triggers(rest):\n        \"\"\"smoke_co_emergency has 2 triggers (smoke + CO detectors).\"\"\"\n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/config/automation/config\",\n            headers=rest._headers(),\n        )\n>       data = resp.json()\n\ntests/automation/test_automation_multi_entity_trigger.py:23: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:832: in json\n    return jsonlib.loads(self.content, **kwargs)\n../../anaconda3/lib/python3.9/json/__init__.py:346: in loads\n    return _default_decoder.decode(s)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <json.decoder.JSONDecoder object at 0x7f47b2e5fe50>, s = '404: Not Found'\n_w = <built-in method match of re.Pattern object at 0x7f47b3015cf0>\n\n    def decode(self, s, _w=WHITESPACE.match):\n        \"\"\"Return the Python representation of ``s`` (a ``str`` instance\n        containing a JSON document).\n    \n        \"\"\"\n        obj, end = self.raw_decode(s, idx=_w(s, 0).end())\n        end = _w(s, end).end()\n        if end != len(s):\n>           raise JSONDecodeError(\"Extra data\", s, end)\nE           json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)\n\n../../anaconda3/lib/python3.9/json/decoder.py:340: JSONDecodeError"}, "teardown": {"duration": 0.0006577190943062305, "outcome": "passed"}}, {"nodeid": "tests/automation/test_automation_multi_entity_trigger.py::test_goodnight_has_event_trigger", "lineno": 27, "outcome": "failed", "keywords": ["test_goodnight_has_event_trigger", "test_automation_multi_entity_trigger.py", "asyncio", "automation", "tests", "marge", ""], "setup": {"duration": 0.0054155741818249226, "outcome": "passed"}, "call": {"duration": 0.0026294980198144913, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)"}, "traceback": [{"path": "tests/automation/test_automation_multi_entity_trigger.py", "lineno": 34, "message": ""}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 832, "message": "in json"}, {"path": "../../anaconda3/lib/python3.9/json/__init__.py", "lineno": 346, "message": "in loads"}, {"path": "../../anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "JSONDecodeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0e18a00>\n\n    async def test_goodnight_has_event_trigger(rest):\n        \"\"\"goodnight_routine has 1 trigger (event type).\"\"\"\n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/config/automation/config\",\n            headers=rest._headers(),\n        )\n>       data = resp.json()\n\ntests/automation/test_automation_multi_entity_trigger.py:34: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:832: in json\n    return jsonlib.loads(self.content, **kwargs)\n../../anaconda3/lib/python3.9/json/__init__.py:346: in loads\n    return _default_decoder.decode(s)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <json.decoder.JSONDecoder object at 0x7f47b2e5fe50>, s = '404: Not Found'\n_w = <built-in method match of re.Pattern object at 0x7f47b3015cf0>\n\n    def decode(self, s, _w=WHITESPACE.match):\n        \"\"\"Return the Python representation of ``s`` (a ``str`` instance\n        containing a JSON document).\n    \n        \"\"\"\n        obj, end = self.raw_decode(s, idx=_w(s, 0).end())\n        end = _w(s, end).end()\n        if end != len(s):\n>           raise JSONDecodeError(\"Extra data\", s, end)\nE           json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)\n\n../../anaconda3/lib/python3.9/json/decoder.py:340: JSONDecodeError"}, "teardown": {"duration": 0.0007133330218493938, "outcome": "passed"}}, {"nodeid": "tests/automation/test_automation_multi_entity_trigger.py::test_lock_verification_has_1_trigger", "lineno": 38, "outcome": "failed", "keywords": ["test_lock_verification_has_1_trigger", "test_automation_multi_entity_trigger.py", "asyncio", "automation", "tests", "marge", ""], "setup": {"duration": 0.005360692273825407, "outcome": "passed"}, "call": {"duration": 0.0024336292408406734, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)"}, "traceback": [{"path": "tests/automation/test_automation_multi_entity_trigger.py", "lineno": 45, "message": ""}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 832, "message": "in json"}, {"path": "../../anaconda3/lib/python3.9/json/__init__.py", "lineno": 346, "message": "in loads"}, {"path": "../../anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "JSONDecodeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b09b6250>\n\n    async def test_lock_verification_has_1_trigger(rest):\n        \"\"\"lock_verification has 1 trigger (alarm state change).\"\"\"\n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/config/automation/config\",\n            headers=rest._headers(),\n        )\n>       data = resp.json()\n\ntests/automation/test_automation_multi_entity_trigger.py:45: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:832: in json\n    return jsonlib.loads(self.content, **kwargs)\n../../anaconda3/lib/python3.9/json/__init__.py:346: in loads\n    return _default_decoder.decode(s)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <json.decoder.JSONDecoder object at 0x7f47b2e5fe50>, s = '404: Not Found'\n_w = <built-in method match of re.Pattern object at 0x7f47b3015cf0>\n\n    def decode(self, s, _w=WHITESPACE.match):\n        \"\"\"Return the Python representation of ``s`` (a ``str`` instance\n        containing a JSON document).\n    \n        \"\"\"\n        obj, end = self.raw_decode(s, idx=_w(s, 0).end())\n        end = _w(s, end).end()\n        if end != len(s):\n>           raise JSONDecodeError(\"Extra data\", s, end)\nE           json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)\n\n../../anaconda3/lib/python3.9/json/decoder.py:340: JSONDecodeError"}, "teardown": {"duration": 0.0006702849641442299, "outcome": "passed"}}, {"nodeid": "tests/automation/test_automation_multi_entity_trigger.py::test_lock_verification_has_or_condition", "lineno": 49, "outcome": "failed", "keywords": ["test_lock_verification_has_or_condition", "test_automation_multi_entity_trigger.py", "asyncio", "automation", "tests", "marge", ""], "setup": {"duration": 0.0054193600080907345, "outcome": "passed"}, "call": {"duration": 0.0030266479589045048, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)"}, "traceback": [{"path": "tests/automation/test_automation_multi_entity_trigger.py", "lineno": 56, "message": ""}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 832, "message": "in json"}, {"path": "../../anaconda3/lib/python3.9/json/__init__.py", "lineno": 346, "message": "in loads"}, {"path": "../../anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "JSONDecodeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b09b6940>\n\n    async def test_lock_verification_has_or_condition(rest):\n        \"\"\"lock_verification has 1 condition (OR with 2 sub-conditions).\"\"\"\n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/config/automation/config\",\n            headers=rest._headers(),\n        )\n>       data = resp.json()\n\ntests/automation/test_automation_multi_entity_trigger.py:56: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:832: in json\n    return jsonlib.loads(self.content, **kwargs)\n../../anaconda3/lib/python3.9/json/__init__.py:346: in loads\n    return _default_decoder.decode(s)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <json.decoder.JSONDecoder object at 0x7f47b2e5fe50>, s = '404: Not Found'\n_w = <built-in method match of re.Pattern object at 0x7f47b3015cf0>\n\n    def decode(self, s, _w=WHITESPACE.match):\n        \"\"\"Return the Python representation of ``s`` (a ``str`` instance\n        containing a JSON document).\n    \n        \"\"\"\n        obj, end = self.raw_decode(s, idx=_w(s, 0).end())\n        end = _w(s, end).end()\n        if end != len(s):\n>           raise JSONDecodeError(\"Extra data\", s, end)\nE           json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)\n\n../../anaconda3/lib/python3.9/json/decoder.py:340: JSONDecodeError"}, "teardown": {"duration": 0.0007394221611320972, "outcome": "passed"}}, {"nodeid": "tests/automation/test_automation_multi_entity_trigger.py::test_security_alert_has_condition", "lineno": 60, "outcome": "failed", "keywords": ["test_security_alert_has_condition", "test_automation_multi_entity_trigger.py", "asyncio", "automation", "tests", "marge", ""], "setup": {"duration": 0.005328716244548559, "outcome": "passed"}, "call": {"duration": 0.00253070006147027, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)"}, "traceback": [{"path": "tests/automation/test_automation_multi_entity_trigger.py", "lineno": 67, "message": ""}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 832, "message": "in json"}, {"path": "../../anaconda3/lib/python3.9/json/__init__.py", "lineno": 346, "message": "in loads"}, {"path": "../../anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "JSONDecodeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0851220>\n\n    async def test_security_alert_has_condition(rest):\n        \"\"\"security_alert has 1 condition (alarm state).\"\"\"\n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/config/automation/config\",\n            headers=rest._headers(),\n        )\n>       data = resp.json()\n\ntests/automation/test_automation_multi_entity_trigger.py:67: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:832: in json\n    return jsonlib.loads(self.content, **kwargs)\n../../anaconda3/lib/python3.9/json/__init__.py:346: in loads\n    return _default_decoder.decode(s)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <json.decoder.JSONDecoder object at 0x7f47b2e5fe50>, s = '404: Not Found'\n_w = <built-in method match of re.Pattern object at 0x7f47b3015cf0>\n\n    def decode(self, s, _w=WHITESPACE.match):\n        \"\"\"Return the Python representation of ``s`` (a ``str`` instance\n        containing a JSON document).\n    \n        \"\"\"\n        obj, end = self.raw_decode(s, idx=_w(s, 0).end())\n        end = _w(s, end).end()\n        if end != len(s):\n>           raise JSONDecodeError(\"Extra data\", s, end)\nE           json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)\n\n../../anaconda3/lib/python3.9/json/decoder.py:340: JSONDecodeError"}, "teardown": {"duration": 0.0007046828977763653, "outcome": "passed"}}, {"nodeid": "tests/automation/test_automation_multi_entity_trigger.py::test_all_six_automations_loaded", "lineno": 73, "outcome": "failed", "keywords": ["test_all_six_automations_loaded", "test_automation_multi_entity_trigger.py", "asyncio", "automation", "tests", "marge", ""], "setup": {"duration": 0.0051713851280510426, "outcome": "passed"}, "call": {"duration": 0.0025851349346339703, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)"}, "traceback": [{"path": "tests/automation/test_automation_multi_entity_trigger.py", "lineno": 80, "message": ""}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 832, "message": "in json"}, {"path": "../../anaconda3/lib/python3.9/json/__init__.py", "lineno": 346, "message": "in loads"}, {"path": "../../anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "JSONDecodeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0851400>\n\n    async def test_all_six_automations_loaded(rest):\n        \"\"\"All 6 demo automations are loaded.\"\"\"\n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/config/automation/config\",\n            headers=rest._headers(),\n        )\n>       data = resp.json()\n\ntests/automation/test_automation_multi_entity_trigger.py:80: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:832: in json\n    return jsonlib.loads(self.content, **kwargs)\n../../anaconda3/lib/python3.9/json/__init__.py:346: in loads\n    return _default_decoder.decode(s)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <json.decoder.JSONDecoder object at 0x7f47b2e5fe50>, s = '404: Not Found'\n_w = <built-in method match of re.Pattern object at 0x7f47b3015cf0>\n\n    def decode(self, s, _w=WHITESPACE.match):\n        \"\"\"Return the Python representation of ``s`` (a ``str`` instance\n        containing a JSON document).\n    \n        \"\"\"\n        obj, end = self.raw_decode(s, idx=_w(s, 0).end())\n        end = _w(s, end).end()\n        if end != len(s):\n>           raise JSONDecodeError(\"Extra data\", s, end)\nE           json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)\n\n../../anaconda3/lib/python3.9/json/decoder.py:340: JSONDecodeError"}, "teardown": {"duration": 0.0006699138320982456, "outcome": "passed"}}, {"nodeid": "tests/automation/test_automation_multi_entity_trigger.py::test_all_automations_have_alias", "lineno": 88, "outcome": "failed", "keywords": ["test_all_automations_have_alias", "test_automation_multi_entity_trigger.py", "asyncio", "automation", "tests", "marge", ""], "setup": {"duration": 0.00549315894022584, "outcome": "passed"}, "call": {"duration": 0.002762744203209877, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)"}, "traceback": [{"path": "tests/automation/test_automation_multi_entity_trigger.py", "lineno": 95, "message": ""}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 832, "message": "in json"}, {"path": "../../anaconda3/lib/python3.9/json/__init__.py", "lineno": 346, "message": "in loads"}, {"path": "../../anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "JSONDecodeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b08514c0>\n\n    async def test_all_automations_have_alias(rest):\n        \"\"\"All automations have a non-empty alias.\"\"\"\n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/config/automation/config\",\n            headers=rest._headers(),\n        )\n>       data = resp.json()\n\ntests/automation/test_automation_multi_entity_trigger.py:95: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:832: in json\n    return jsonlib.loads(self.content, **kwargs)\n../../anaconda3/lib/python3.9/json/__init__.py:346: in loads\n    return _default_decoder.decode(s)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <json.decoder.JSONDecoder object at 0x7f47b2e5fe50>, s = '404: Not Found'\n_w = <built-in method match of re.Pattern object at 0x7f47b3015cf0>\n\n    def decode(self, s, _w=WHITESPACE.match):\n        \"\"\"Return the Python representation of ``s`` (a ``str`` instance\n        containing a JSON document).\n    \n        \"\"\"\n        obj, end = self.raw_decode(s, idx=_w(s, 0).end())\n        end = _w(s, end).end()\n        if end != len(s):\n>           raise JSONDecodeError(\"Extra data\", s, end)\nE           json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)\n\n../../anaconda3/lib/python3.9/json/decoder.py:340: JSONDecodeError"}, "teardown": {"duration": 0.0006712428294122219, "outcome": "passed"}}, {"nodeid": "tests/automation/test_automation_multi_entity_trigger.py::test_all_automations_mode_single", "lineno": 99, "outcome": "failed", "keywords": ["test_all_automations_mode_single", "test_automation_multi_entity_trigger.py", "asyncio", "automation", "tests", "marge", ""], "setup": {"duration": 0.005671778693795204, "outcome": "passed"}, "call": {"duration": 0.003550644963979721, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)"}, "traceback": [{"path": "tests/automation/test_automation_multi_entity_trigger.py", "lineno": 106, "message": ""}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 832, "message": "in json"}, {"path": "../../anaconda3/lib/python3.9/json/__init__.py", "lineno": 346, "message": "in loads"}, {"path": "../../anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "JSONDecodeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0e9d760>\n\n    async def test_all_automations_mode_single(rest):\n        \"\"\"All demo automations have mode 'single'.\"\"\"\n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/config/automation/config\",\n            headers=rest._headers(),\n        )\n>       data = resp.json()\n\ntests/automation/test_automation_multi_entity_trigger.py:106: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:832: in json\n    return jsonlib.loads(self.content, **kwargs)\n../../anaconda3/lib/python3.9/json/__init__.py:346: in loads\n    return _default_decoder.decode(s)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <json.decoder.JSONDecoder object at 0x7f47b2e5fe50>, s = '404: Not Found'\n_w = <built-in method match of re.Pattern object at 0x7f47b3015cf0>\n\n    def decode(self, s, _w=WHITESPACE.match):\n        \"\"\"Return the Python representation of ``s`` (a ``str`` instance\n        containing a JSON document).\n    \n        \"\"\"\n        obj, end = self.raw_decode(s, idx=_w(s, 0).end())\n        end = _w(s, end).end()\n        if end != len(s):\n>           raise JSONDecodeError(\"Extra data\", s, end)\nE           json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)\n\n../../anaconda3/lib/python3.9/json/decoder.py:340: JSONDecodeError"}, "teardown": {"duration": 0.000672600232064724, "outcome": "passed"}}, {"nodeid": "tests/automation/test_automation_multi_entity_trigger.py::test_all_automation_entities_exist", "lineno": 110, "outcome": "failed", "keywords": ["test_all_automation_entities_exist", "test_automation_multi_entity_trigger.py", "asyncio", "automation", "tests", "marge", ""], "setup": {"duration": 0.005384352989494801, "outcome": "passed"}, "call": {"duration": 0.002651480957865715, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/automation/test_automation_multi_entity_trigger.py", "lineno": 118, "message": "AssertionError: automation.morning_wakeup not found\nassert None is not None"}, "traceback": [{"path": "tests/automation/test_automation_multi_entity_trigger.py", "lineno": 118, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b1245460>\n\n    async def test_all_automation_entities_exist(rest):\n        \"\"\"All 6 automations have corresponding automation.* entities.\"\"\"\n        for auto_id in [\n            \"morning_wakeup\", \"security_alert\", \"sunset_lights\",\n            \"goodnight_routine\", \"lock_verification\", \"smoke_co_emergency\",\n        ]:\n            state = await rest.get_state(f\"automation.{auto_id}\")\n>           assert state is not None, f\"automation.{auto_id} not found\"\nE           AssertionError: automation.morning_wakeup not found\nE           assert None is not None\n\ntests/automation/test_automation_multi_entity_trigger.py:118: AssertionError"}, "teardown": {"duration": 0.000589981209486723, "outcome": "passed"}}, {"nodeid": "tests/automation/test_automation_multi_entity_trigger.py::test_all_automation_entities_on", "lineno": 121, "outcome": "failed", "keywords": ["test_all_automation_entities_on", "test_automation_multi_entity_trigger.py", "asyncio", "automation", "tests", "marge", ""], "setup": {"duration": 0.005654805339872837, "outcome": "passed"}, "call": {"duration": 0.11470055812969804, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/automation/test_automation_multi_entity_trigger.py", "lineno": 139, "message": "TypeError: 'NoneType' object is not subscriptable"}, "traceback": [{"path": "tests/automation/test_automation_multi_entity_trigger.py", "lineno": 139, "message": "TypeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b1245670>\n\n    async def test_all_automation_entities_on(rest):\n        \"\"\"All 6 automation entities are initially enabled (on).\"\"\"\n        # Re-enable all first in case prior tests disabled some\n        for auto_id in [\n            \"morning_wakeup\", \"security_alert\", \"sunset_lights\",\n            \"goodnight_routine\", \"lock_verification\", \"smoke_co_emergency\",\n        ]:\n            await rest.call_service(\"automation\", \"turn_on\", {\n                \"entity_id\": f\"automation.{auto_id}\"\n            })\n        await asyncio.sleep(0.1)\n    \n        for auto_id in [\n            \"morning_wakeup\", \"security_alert\", \"sunset_lights\",\n            \"goodnight_routine\", \"lock_verification\", \"smoke_co_emergency\",\n        ]:\n            state = await rest.get_state(f\"automation.{auto_id}\")\n>           assert state[\"state\"] == \"on\", f\"automation.{auto_id} is {state['state']}\"\nE           TypeError: 'NoneType' object is not subscriptable\n\ntests/automation/test_automation_multi_entity_trigger.py:139: TypeError"}, "teardown": {"duration": 0.0007150680758059025, "outcome": "passed"}}, {"nodeid": "tests/automation/test_automation_multi_entity_trigger.py::test_automation_toggle_disables", "lineno": 143, "outcome": "failed", "keywords": ["test_automation_toggle_disables", "test_automation_multi_entity_trigger.py", "asyncio", "automation", "tests", "marge", ""], "setup": {"duration": 0.007396737113595009, "outcome": "passed"}, "call": {"duration": 0.10616366285830736, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/automation/test_automation_multi_entity_trigger.py", "lineno": 150, "message": "TypeError: 'NoneType' object is not subscriptable"}, "traceback": [{"path": "tests/automation/test_automation_multi_entity_trigger.py", "lineno": 150, "message": "TypeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0cb3bb0>\n\n    async def test_automation_toggle_disables(rest):\n        \"\"\"automation.toggle flips from on to off.\"\"\"\n        await rest.call_service(\"automation\", \"turn_on\", {\n            \"entity_id\": \"automation.morning_wakeup\"\n        })\n        await asyncio.sleep(0.1)\n>       assert (await rest.get_state(\"automation.morning_wakeup\"))[\"state\"] == \"on\"\nE       TypeError: 'NoneType' object is not subscriptable\n\ntests/automation/test_automation_multi_entity_trigger.py:150: TypeError"}, "teardown": {"duration": 0.0006569530814886093, "outcome": "passed"}}, {"nodeid": "tests/automation/test_automation_multi_entity_trigger.py::test_automation_toggle_roundtrip", "lineno": 163, "outcome": "failed", "keywords": ["test_automation_toggle_roundtrip", "test_automation_multi_entity_trigger.py", "asyncio", "automation", "tests", "marge", ""], "setup": {"duration": 0.005323485005646944, "outcome": "passed"}, "call": {"duration": 0.20797758596017957, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/automation/test_automation_multi_entity_trigger.py", "lineno": 175, "message": "TypeError: 'NoneType' object is not subscriptable"}, "traceback": [{"path": "tests/automation/test_automation_multi_entity_trigger.py", "lineno": 175, "message": "TypeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0cf1280>\n\n    async def test_automation_toggle_roundtrip(rest):\n        \"\"\"automation.toggle twice returns to original state.\"\"\"\n        await rest.call_service(\"automation\", \"turn_on\", {\n            \"entity_id\": \"automation.sunset_lights\"\n        })\n        await asyncio.sleep(0.1)\n    \n        await rest.call_service(\"automation\", \"toggle\", {\n            \"entity_id\": \"automation.sunset_lights\"\n        })\n        await asyncio.sleep(0.1)\n>       assert (await rest.get_state(\"automation.sunset_lights\"))[\"state\"] == \"off\"\nE       TypeError: 'NoneType' object is not subscriptable\n\ntests/automation/test_automation_multi_entity_trigger.py:175: TypeError"}, "teardown": {"duration": 0.0006179036572575569, "outcome": "passed"}}, {"nodeid": "tests/automation/test_condition_edge_cases.py::test_disabled_automation_no_trigger", "lineno": 16, "outcome": "passed", "keywords": ["test_disabled_automation_no_trigger", "test_condition_edge_cases.py", "asyncio", "automation", "tests", "marge", ""], "setup": {"duration": 0.007995369844138622, "outcome": "passed"}, "call": {"duration": 0.41414487222209573, "outcome": "passed"}, "teardown": {"duration": 0.003972076345235109, "outcome": "passed"}}, {"nodeid": "tests/automation/test_condition_edge_cases.py::test_toggle_automation_twice_re_enables", "lineno": 45, "outcome": "failed", "keywords": ["test_toggle_automation_twice_re_enables", "test_condition_edge_cases.py", "asyncio", "automation", "tests", "marge", ""], "setup": {"duration": 0.014195367228239775, "outcome": "passed"}, "call": {"duration": 0.10941454581916332, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/automation/test_condition_edge_cases.py", "lineno": 56, "message": "TypeError: 'NoneType' object is not subscriptable"}, "traceback": [{"path": "tests/automation/test_condition_edge_cases.py", "lineno": 56, "message": "TypeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0ce6e80>\nws = <conftest.WSClient object at 0x7f47b0ce6e50>\n\n    async def test_toggle_automation_twice_re_enables(rest, ws):\n        \"\"\"Toggling automation twice returns to enabled.\"\"\"\n        await ws.send_command(\n            \"call_service\",\n            domain=\"automation\",\n            service=\"toggle\",\n            service_data={\"entity_id\": \"automation.smoke_co_emergency\"},\n        )\n        await asyncio.sleep(0.1)\n        state = await rest.get_state(\"automation.smoke_co_emergency\")\n>       first_state = state[\"state\"]\nE       TypeError: 'NoneType' object is not subscriptable\n\ntests/automation/test_condition_edge_cases.py:56: TypeError"}, "teardown": {"duration": 0.0016743270680308342, "outcome": "passed"}}, {"nodeid": "tests/automation/test_condition_edge_cases.py::test_ws_force_trigger", "lineno": 71, "outcome": "failed", "keywords": ["test_ws_force_trigger", "test_condition_edge_cases.py", "asyncio", "automation", "tests", "marge", ""], "setup": {"duration": 0.010924648959189653, "outcome": "passed"}, "call": {"duration": 0.3073028093203902, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/automation/test_condition_edge_cases.py", "lineno": 84, "message": "AssertionError: assert 'locked' == 'unlocked'\n  \n  - unlocked\n  ? --\n  + locked"}, "traceback": [{"path": "tests/automation/test_condition_edge_cases.py", "lineno": 84, "message": "AssertionError"}], "longrepr": "ws = <conftest.WSClient object at 0x7f47b0fe7b20>\nrest = <conftest.RESTClient object at 0x7f47b0fe7070>\n\n    async def test_ws_force_trigger(ws, rest):\n        \"\"\"Force triggering via WS call_service works.\"\"\"\n        await rest.set_state(\"lock.front_door\", \"locked\")\n        result = await ws.send_command(\n            \"call_service\",\n            domain=\"automation\",\n            service=\"trigger\",\n            service_data={\"entity_id\": \"automation.smoke_co_emergency\"},\n        )\n        assert result[\"success\"] is True\n        await asyncio.sleep(0.3)\n        state = await rest.get_state(\"lock.front_door\")\n>       assert state[\"state\"] == \"unlocked\"\nE       AssertionError: assert 'locked' == 'unlocked'\nE         \nE         - unlocked\nE         ? --\nE         + locked\n\ntests/automation/test_condition_edge_cases.py:84: AssertionError"}, "teardown": {"duration": 0.0013230089098215103, "outcome": "passed"}}, {"nodeid": "tests/automation/test_condition_edge_cases.py::test_ws_scene_turn_on", "lineno": 88, "outcome": "failed", "keywords": ["test_ws_scene_turn_on", "test_condition_edge_cases.py", "asyncio", "automation", "tests", "marge", ""], "setup": {"duration": 0.0075103240087628365, "outcome": "passed"}, "call": {"duration": 0.0037783049046993256, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/automation/test_condition_edge_cases.py", "lineno": 98, "message": "assert False is True"}, "traceback": [{"path": "tests/automation/test_condition_edge_cases.py", "lineno": 98, "message": "AssertionError"}], "longrepr": "ws = <conftest.WSClient object at 0x7f47b0ccec70>\nrest = <conftest.RESTClient object at 0x7f47b0ccefd0>\n\n    async def test_ws_scene_turn_on(ws, rest):\n        \"\"\"Scene activated via WS call_service.\"\"\"\n        await rest.set_state(\"light.living_room_main\", \"off\")\n        result = await ws.send_command(\n            \"call_service\",\n            domain=\"scene\",\n            service=\"turn_on\",\n            service_data={\"entity_id\": \"scene.evening\"},\n        )\n>       assert result[\"success\"] is True\nE       assert False is True\n\ntests/automation/test_condition_edge_cases.py:98: AssertionError"}, "teardown": {"duration": 0.001333701889961958, "outcome": "passed"}}, {"nodeid": "tests/automation/test_condition_edge_cases.py::test_ws_service_call_standard", "lineno": 105, "outcome": "failed", "keywords": ["test_ws_service_call_standard", "test_condition_edge_cases.py", "asyncio", "automation", "tests", "marge", ""], "setup": {"duration": 0.007590617053210735, "outcome": "passed"}, "call": {"duration": 0.0034416080452501774, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/automation/test_condition_edge_cases.py", "lineno": 115, "message": "assert False is True"}, "traceback": [{"path": "tests/automation/test_condition_edge_cases.py", "lineno": 115, "message": "AssertionError"}], "longrepr": "ws = <conftest.WSClient object at 0x7f47b0cce280>\nrest = <conftest.RESTClient object at 0x7f47b0f77b80>\n\n    async def test_ws_service_call_standard(ws, rest):\n        \"\"\"Standard service call via WS uses registry.\"\"\"\n        await rest.set_state(\"light.ws_cond_test\", \"off\")\n        result = await ws.send_command(\n            \"call_service\",\n            domain=\"light\",\n            service=\"turn_on\",\n            service_data={\"entity_id\": \"light.ws_cond_test\"},\n        )\n>       assert result[\"success\"] is True\nE       assert False is True\n\ntests/automation/test_condition_edge_cases.py:115: AssertionError"}, "teardown": {"duration": 0.0011963900178670883, "outcome": "passed"}}, {"nodeid": "tests/automation/test_condition_edge_cases.py::test_ws_service_call_with_target", "lineno": 119, "outcome": "failed", "keywords": ["test_ws_service_call_with_target", "test_condition_edge_cases.py", "asyncio", "automation", "tests", "marge", ""], "setup": {"duration": 0.007446622010320425, "outcome": "passed"}, "call": {"duration": 0.003387398086488247, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/automation/test_condition_edge_cases.py", "lineno": 130, "message": "assert False is True"}, "traceback": [{"path": "tests/automation/test_condition_edge_cases.py", "lineno": 130, "message": "AssertionError"}], "longrepr": "ws = <conftest.WSClient object at 0x7f47b0de36d0>\nrest = <conftest.RESTClient object at 0x7f47b0d75370>\n\n    async def test_ws_service_call_with_target(ws, rest):\n        \"\"\"WS service call with target.entity_id pattern.\"\"\"\n        await rest.set_state(\"switch.ws_target_test\", \"off\")\n        result = await ws.send_command(\n            \"call_service\",\n            domain=\"switch\",\n            service=\"turn_on\",\n            service_data={},\n            target={\"entity_id\": \"switch.ws_target_test\"},\n        )\n>       assert result[\"success\"] is True\nE       assert False is True\n\ntests/automation/test_condition_edge_cases.py:130: AssertionError"}, "teardown": {"duration": 0.001011029351502657, "outcome": "passed"}}, {"nodeid": "tests/automation/test_condition_edge_cases.py::test_ws_service_call_multiple_entities", "lineno": 134, "outcome": "failed", "keywords": ["test_ws_service_call_multiple_entities", "test_condition_edge_cases.py", "asyncio", "automation", "tests", "marge", ""], "setup": {"duration": 0.007236883044242859, "outcome": "passed"}, "call": {"duration": 0.004461454693228006, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/automation/test_condition_edge_cases.py", "lineno": 145, "message": "assert False is True"}, "traceback": [{"path": "tests/automation/test_condition_edge_cases.py", "lineno": 145, "message": "AssertionError"}], "longrepr": "ws = <conftest.WSClient object at 0x7f47b0dd54c0>\nrest = <conftest.RESTClient object at 0x7f47b0dd5e50>\n\n    async def test_ws_service_call_multiple_entities(ws, rest):\n        \"\"\"WS service call with array of entity_ids.\"\"\"\n        await rest.set_state(\"light.ws_multi_a\", \"off\")\n        await rest.set_state(\"light.ws_multi_b\", \"off\")\n        result = await ws.send_command(\n            \"call_service\",\n            domain=\"light\",\n            service=\"turn_on\",\n            service_data={\"entity_id\": [\"light.ws_multi_a\", \"light.ws_multi_b\"]},\n        )\n>       assert result[\"success\"] is True\nE       assert False is True\n\ntests/automation/test_condition_edge_cases.py:145: AssertionError"}, "teardown": {"duration": 0.0011013052426278591, "outcome": "passed"}}, {"nodeid": "tests/automation/test_condition_edge_cases.py::test_ws_notification_create_and_list", "lineno": 153, "outcome": "failed", "keywords": ["test_ws_notification_create_and_list", "test_condition_edge_cases.py", "asyncio", "automation", "tests", "marge", ""], "setup": {"duration": 0.003560529090464115, "outcome": "passed"}, "call": {"duration": 0.20173040218651295, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/automation/test_condition_edge_cases.py", "lineno": 169, "message": "assert False is True"}, "traceback": [{"path": "tests/automation/test_condition_edge_cases.py", "lineno": 169, "message": "AssertionError"}], "longrepr": "ws = <conftest.WSClient object at 0x7f47b0ce65b0>\n\n    async def test_ws_notification_create_and_list(ws):\n        \"\"\"Create notification via WS, then list it.\"\"\"\n        await ws.send_command(\n            \"call_service\",\n            domain=\"persistent_notification\",\n            service=\"create\",\n            service_data={\n                \"notification_id\": \"ws_cond_test_1\",\n                \"title\": \"Test Title\",\n                \"message\": \"Test message body\",\n            },\n        )\n        await asyncio.sleep(0.2)\n    \n        result = await ws.send_command(\"get_notifications\")\n>       assert result[\"success\"] is True\nE       assert False is True\n\ntests/automation/test_condition_edge_cases.py:169: AssertionError"}, "teardown": {"duration": 0.0009251232258975506, "outcome": "passed"}}, {"nodeid": "tests/automation/test_condition_edge_cases.py::test_ws_notification_dismiss", "lineno": 173, "outcome": "passed", "keywords": ["test_ws_notification_dismiss", "test_condition_edge_cases.py", "asyncio", "automation", "tests", "marge", ""], "setup": {"duration": 0.0024053240194916725, "outcome": "passed"}, "call": {"duration": 0.20189597411081195, "outcome": "passed"}, "teardown": {"duration": 0.0011018207296729088, "outcome": "passed"}}, {"nodeid": "tests/automation/test_condition_edge_cases.py::test_ws_notification_dismiss_all", "lineno": 196, "outcome": "passed", "keywords": ["test_ws_notification_dismiss_all", "test_condition_edge_cases.py", "asyncio", "automation", "tests", "marge", ""], "setup": {"duration": 0.003369749989360571, "outcome": "passed"}, "call": {"duration": 0.0008511482737958431, "outcome": "passed"}, "teardown": {"duration": 0.0009709550067782402, "outcome": "passed"}}, {"nodeid": "tests/automation/test_condition_edge_cases.py::test_automation_info_has_mode", "lineno": 209, "outcome": "failed", "keywords": ["test_automation_info_has_mode", "test_condition_edge_cases.py", "asyncio", "automation", "tests", "marge", ""], "setup": {"duration": 0.00778180779889226, "outcome": "passed"}, "call": {"duration": 0.0037812311202287674, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/automation/test_condition_edge_cases.py", "lineno": 216, "message": "assert 404 == 200\n +  where 404 = <Response [404 Not Found]>.status_code"}, "traceback": [{"path": "tests/automation/test_condition_edge_cases.py", "lineno": 216, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b1085910>\n\n    async def test_automation_info_has_mode(rest):\n        \"\"\"Automation config includes mode field.\"\"\"\n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/config/automation/config\",\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 404 == 200\nE        +  where 404 = <Response [404 Not Found]>.status_code\n\ntests/automation/test_condition_edge_cases.py:216: AssertionError"}, "teardown": {"duration": 0.0006879898719489574, "outcome": "passed"}}, {"nodeid": "tests/automation/test_condition_edge_cases.py::test_automation_info_has_counts", "lineno": 221, "outcome": "failed", "keywords": ["test_automation_info_has_counts", "test_condition_edge_cases.py", "asyncio", "automation", "tests", "marge", ""], "setup": {"duration": 0.007068782113492489, "outcome": "passed"}, "call": {"duration": 0.0032901521772146225, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)"}, "traceback": [{"path": "tests/automation/test_condition_edge_cases.py", "lineno": 228, "message": ""}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 832, "message": "in json"}, {"path": "../../anaconda3/lib/python3.9/json/__init__.py", "lineno": 346, "message": "in loads"}, {"path": "../../anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "JSONDecodeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0cf1130>\n\n    async def test_automation_info_has_counts(rest):\n        \"\"\"Automation config includes trigger/condition/action counts.\"\"\"\n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/config/automation/config\",\n            headers=rest._headers(),\n        )\n>       data = resp.json()\n\ntests/automation/test_condition_edge_cases.py:228: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:832: in json\n    return jsonlib.loads(self.content, **kwargs)\n../../anaconda3/lib/python3.9/json/__init__.py:346: in loads\n    return _default_decoder.decode(s)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <json.decoder.JSONDecoder object at 0x7f47b2e5fe50>, s = '404: Not Found'\n_w = <built-in method match of re.Pattern object at 0x7f47b3015cf0>\n\n    def decode(self, s, _w=WHITESPACE.match):\n        \"\"\"Return the Python representation of ``s`` (a ``str`` instance\n        containing a JSON document).\n    \n        \"\"\"\n        obj, end = self.raw_decode(s, idx=_w(s, 0).end())\n        end = _w(s, end).end()\n        if end != len(s):\n>           raise JSONDecodeError(\"Extra data\", s, end)\nE           json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)\n\n../../anaconda3/lib/python3.9/json/decoder.py:340: JSONDecodeError"}, "teardown": {"duration": 0.0008105081506073475, "outcome": "passed"}}, {"nodeid": "tests/automation/test_demo_automation_morning_sunset.py::test_morning_force_trigger_turns_on_bedroom", "lineno": 27, "outcome": "failed", "keywords": ["test_morning_force_trigger_turns_on_bedroom", "test_demo_automation_morning_sunset.py", "asyncio", "automation", "tests", "marge", ""], "setup": {"duration": 0.006811283063143492, "outcome": "passed"}, "call": {"duration": 0.614219332113862, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/automation/test_demo_automation_morning_sunset.py", "lineno": 36, "message": "AssertionError: assert 'off' == 'on'\n  \n  - on\n  + off"}, "traceback": [{"path": "tests/automation/test_demo_automation_morning_sunset.py", "lineno": 36, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0fe5e20>\n\n    async def test_morning_force_trigger_turns_on_bedroom(rest):\n        \"\"\"Force-trigger morning_wakeup turns on bedroom light.\"\"\"\n        await _setup_morning(rest)\n        await rest.call_service(\"automation\", \"trigger\", {\n            \"entity_id\": \"automation.morning_wakeup\"\n        })\n        await asyncio.sleep(0.5)\n        state = await rest.get_state(\"light.bedroom\")\n>       assert state[\"state\"] == \"on\"\nE       AssertionError: assert 'off' == 'on'\nE         \nE         - on\nE         + off\n\ntests/automation/test_demo_automation_morning_sunset.py:36: AssertionError"}, "teardown": {"duration": 0.0007594707421958447, "outcome": "passed"}}, {"nodeid": "tests/automation/test_demo_automation_morning_sunset.py::test_morning_force_trigger_sets_brightness_51", "lineno": 38, "outcome": "failed", "keywords": ["test_morning_force_trigger_sets_brightness_51", "test_demo_automation_morning_sunset.py", "asyncio", "automation", "tests", "marge", ""], "setup": {"duration": 0.005116199143230915, "outcome": "passed"}, "call": {"duration": 0.6133205820806324, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/automation/test_demo_automation_morning_sunset.py", "lineno": 47, "message": "AssertionError: assert 0 == 51\n +  where 0 = <built-in method get of dict object at 0x7f47b0dda180>('brightness')\n +    where <built-in method get of dict object at 0x7f47b0dda180> = {'brightness': 0}.get"}, "traceback": [{"path": "tests/automation/test_demo_automation_morning_sunset.py", "lineno": 47, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0d3bc70>\n\n    async def test_morning_force_trigger_sets_brightness_51(rest):\n        \"\"\"Force-trigger morning_wakeup sets bedroom brightness to 51.\"\"\"\n        await _setup_morning(rest)\n        await rest.call_service(\"automation\", \"trigger\", {\n            \"entity_id\": \"automation.morning_wakeup\"\n        })\n        await asyncio.sleep(0.5)\n        state = await rest.get_state(\"light.bedroom\")\n>       assert state[\"attributes\"].get(\"brightness\") == 51\nE       AssertionError: assert 0 == 51\nE        +  where 0 = <built-in method get of dict object at 0x7f47b0dda180>('brightness')\nE        +    where <built-in method get of dict object at 0x7f47b0dda180> = {'brightness': 0}.get\n\ntests/automation/test_demo_automation_morning_sunset.py:47: AssertionError"}, "teardown": {"duration": 0.0007829228416085243, "outcome": "passed"}}, {"nodeid": "tests/automation/test_demo_automation_morning_sunset.py::test_morning_force_trigger_sets_color_temp", "lineno": 49, "outcome": "failed", "keywords": ["test_morning_force_trigger_sets_color_temp", "test_demo_automation_morning_sunset.py", "asyncio", "automation", "tests", "marge", ""], "setup": {"duration": 0.007834268733859062, "outcome": "passed"}, "call": {"duration": 0.6154339956119657, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/automation/test_demo_automation_morning_sunset.py", "lineno": 58, "message": "AssertionError: assert None == 400\n +  where None = <built-in method get of dict object at 0x7f47b0cc0c00>('color_temp')\n +    where <built-in method get of dict object at 0x7f47b0cc0c00> = {'brightness': 0}.get"}, "traceback": [{"path": "tests/automation/test_demo_automation_morning_sunset.py", "lineno": 58, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0de32b0>\n\n    async def test_morning_force_trigger_sets_color_temp(rest):\n        \"\"\"Force-trigger morning_wakeup sets bedroom color_temp to 400.\"\"\"\n        await _setup_morning(rest)\n        await rest.call_service(\"automation\", \"trigger\", {\n            \"entity_id\": \"automation.morning_wakeup\"\n        })\n        await asyncio.sleep(0.5)\n        state = await rest.get_state(\"light.bedroom\")\n>       assert state[\"attributes\"].get(\"color_temp\") == 400\nE       AssertionError: assert None == 400\nE        +  where None = <built-in method get of dict object at 0x7f47b0cc0c00>('color_temp')\nE        +    where <built-in method get of dict object at 0x7f47b0cc0c00> = {'brightness': 0}.get\n\ntests/automation/test_demo_automation_morning_sunset.py:58: AssertionError"}, "teardown": {"duration": 0.0017033875919878483, "outcome": "passed"}}, {"nodeid": "tests/automation/test_demo_automation_morning_sunset.py::test_morning_force_trigger_sets_thermostat_70", "lineno": 60, "outcome": "failed", "keywords": ["test_morning_force_trigger_sets_thermostat_70", "test_demo_automation_morning_sunset.py", "asyncio", "automation", "tests", "marge", ""], "setup": {"duration": 0.0077174948528409, "outcome": "passed"}, "call": {"duration": 0.6173664210364223, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/automation/test_demo_automation_morning_sunset.py", "lineno": 69, "message": "AssertionError: assert 66 == 70\n +  where 66 = <built-in method get of dict object at 0x7f47b0bf9f80>('temperature')\n +    where <built-in method get of dict object at 0x7f47b0bf9f80> = {'temperature': 66}.get"}, "traceback": [{"path": "tests/automation/test_demo_automation_morning_sunset.py", "lineno": 69, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0d407f0>\n\n    async def test_morning_force_trigger_sets_thermostat_70(rest):\n        \"\"\"Force-trigger morning_wakeup sets thermostat to 70.\"\"\"\n        await _setup_morning(rest)\n        await rest.call_service(\"automation\", \"trigger\", {\n            \"entity_id\": \"automation.morning_wakeup\"\n        })\n        await asyncio.sleep(0.5)\n        state = await rest.get_state(\"climate.thermostat\")\n>       assert state[\"attributes\"].get(\"temperature\") == 70\nE       AssertionError: assert 66 == 70\nE        +  where 66 = <built-in method get of dict object at 0x7f47b0bf9f80>('temperature')\nE        +    where <built-in method get of dict object at 0x7f47b0bf9f80> = {'temperature': 66}.get\n\ntests/automation/test_demo_automation_morning_sunset.py:69: AssertionError"}, "teardown": {"duration": 0.0008167489431798458, "outcome": "passed"}}, {"nodeid": "tests/automation/test_demo_automation_morning_sunset.py::test_morning_force_trigger_turns_on_coffee", "lineno": 71, "outcome": "failed", "keywords": ["test_morning_force_trigger_turns_on_coffee", "test_demo_automation_morning_sunset.py", "asyncio", "automation", "tests", "marge", ""], "setup": {"duration": 0.005569430999457836, "outcome": "passed"}, "call": {"duration": 0.6174561372026801, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/automation/test_demo_automation_morning_sunset.py", "lineno": 80, "message": "AssertionError: assert 'off' == 'on'\n  \n  - on\n  + off"}, "traceback": [{"path": "tests/automation/test_demo_automation_morning_sunset.py", "lineno": 80, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0fe7a60>\n\n    async def test_morning_force_trigger_turns_on_coffee(rest):\n        \"\"\"Force-trigger morning_wakeup turns on coffee maker.\"\"\"\n        await _setup_morning(rest)\n        await rest.call_service(\"automation\", \"trigger\", {\n            \"entity_id\": \"automation.morning_wakeup\"\n        })\n        await asyncio.sleep(0.5)\n        state = await rest.get_state(\"switch.coffee_maker\")\n>       assert state[\"state\"] == \"on\"\nE       AssertionError: assert 'off' == 'on'\nE         \nE         - on\nE         + off\n\ntests/automation/test_demo_automation_morning_sunset.py:80: AssertionError"}, "teardown": {"duration": 0.001728834118694067, "outcome": "passed"}}, {"nodeid": "tests/automation/test_demo_automation_morning_sunset.py::test_morning_entity_state_on", "lineno": 82, "outcome": "failed", "keywords": ["test_morning_entity_state_on", "test_demo_automation_morning_sunset.py", "asyncio", "automation", "tests", "marge", ""], "setup": {"duration": 0.008122732862830162, "outcome": "passed"}, "call": {"duration": 0.004096765071153641, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/automation/test_demo_automation_morning_sunset.py", "lineno": 86, "message": "assert None is not None"}, "traceback": [{"path": "tests/automation/test_demo_automation_morning_sunset.py", "lineno": 86, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0f771c0>\n\n    async def test_morning_entity_state_on(rest):\n        \"\"\"morning_wakeup automation entity is 'on' when enabled.\"\"\"\n        state = await rest.get_state(\"automation.morning_wakeup\")\n>       assert state is not None\nE       assert None is not None\n\ntests/automation/test_demo_automation_morning_sunset.py:86: AssertionError"}, "teardown": {"duration": 0.0007346230559051037, "outcome": "passed"}}, {"nodeid": "tests/automation/test_demo_automation_morning_sunset.py::test_morning_has_time_trigger", "lineno": 89, "outcome": "failed", "keywords": ["test_morning_has_time_trigger", "test_demo_automation_morning_sunset.py", "asyncio", "automation", "tests", "marge", ""], "setup": {"duration": 0.0077580651268363, "outcome": "passed"}, "call": {"duration": 0.004143747966736555, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)"}, "traceback": [{"path": "tests/automation/test_demo_automation_morning_sunset.py", "lineno": 96, "message": ""}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 832, "message": "in json"}, {"path": "../../anaconda3/lib/python3.9/json/__init__.py", "lineno": 346, "message": "in loads"}, {"path": "../../anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "JSONDecodeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0f8c700>\n\n    async def test_morning_has_time_trigger(rest):\n        \"\"\"morning_wakeup has exactly 1 trigger.\"\"\"\n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/config/automation/config\",\n            headers=rest._headers(),\n        )\n>       data = resp.json()\n\ntests/automation/test_demo_automation_morning_sunset.py:96: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:832: in json\n    return jsonlib.loads(self.content, **kwargs)\n../../anaconda3/lib/python3.9/json/__init__.py:346: in loads\n    return _default_decoder.decode(s)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <json.decoder.JSONDecoder object at 0x7f47b2e5fe50>, s = '404: Not Found'\n_w = <built-in method match of re.Pattern object at 0x7f47b3015cf0>\n\n    def decode(self, s, _w=WHITESPACE.match):\n        \"\"\"Return the Python representation of ``s`` (a ``str`` instance\n        containing a JSON document).\n    \n        \"\"\"\n        obj, end = self.raw_decode(s, idx=_w(s, 0).end())\n        end = _w(s, end).end()\n        if end != len(s):\n>           raise JSONDecodeError(\"Extra data\", s, end)\nE           json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)\n\n../../anaconda3/lib/python3.9/json/decoder.py:340: JSONDecodeError"}, "teardown": {"duration": 0.0008993614464998245, "outcome": "passed"}}, {"nodeid": "tests/automation/test_demo_automation_morning_sunset.py::test_morning_has_3_actions", "lineno": 100, "outcome": "failed", "keywords": ["test_morning_has_3_actions", "test_demo_automation_morning_sunset.py", "asyncio", "automation", "tests", "marge", ""], "setup": {"duration": 0.00588417099788785, "outcome": "passed"}, "call": {"duration": 0.0027705756947398186, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)"}, "traceback": [{"path": "tests/automation/test_demo_automation_morning_sunset.py", "lineno": 107, "message": ""}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 832, "message": "in json"}, {"path": "../../anaconda3/lib/python3.9/json/__init__.py", "lineno": 346, "message": "in loads"}, {"path": "../../anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "JSONDecodeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0cfe6a0>\n\n    async def test_morning_has_3_actions(rest):\n        \"\"\"morning_wakeup has 3 actions (light, climate, switch).\"\"\"\n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/config/automation/config\",\n            headers=rest._headers(),\n        )\n>       data = resp.json()\n\ntests/automation/test_demo_automation_morning_sunset.py:107: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:832: in json\n    return jsonlib.loads(self.content, **kwargs)\n../../anaconda3/lib/python3.9/json/__init__.py:346: in loads\n    return _default_decoder.decode(s)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <json.decoder.JSONDecoder object at 0x7f47b2e5fe50>, s = '404: Not Found'\n_w = <built-in method match of re.Pattern object at 0x7f47b3015cf0>\n\n    def decode(self, s, _w=WHITESPACE.match):\n        \"\"\"Return the Python representation of ``s`` (a ``str`` instance\n        containing a JSON document).\n    \n        \"\"\"\n        obj, end = self.raw_decode(s, idx=_w(s, 0).end())\n        end = _w(s, end).end()\n        if end != len(s):\n>           raise JSONDecodeError(\"Extra data\", s, end)\nE           json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)\n\n../../anaconda3/lib/python3.9/json/decoder.py:340: JSONDecodeError"}, "teardown": {"duration": 0.0007400182075798512, "outcome": "passed"}}, {"nodeid": "tests/automation/test_demo_automation_morning_sunset.py::test_sunset_force_trigger_turns_on_porch", "lineno": 124, "outcome": "failed", "keywords": ["test_sunset_force_trigger_turns_on_porch", "test_demo_automation_morning_sunset.py", "asyncio", "automation", "tests", "marge", ""], "setup": {"duration": 0.005794914904981852, "outcome": "passed"}, "call": {"duration": 0.6140153110027313, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/automation/test_demo_automation_morning_sunset.py", "lineno": 133, "message": "AssertionError: assert 'off' == 'on'\n  \n  - on\n  + off"}, "traceback": [{"path": "tests/automation/test_demo_automation_morning_sunset.py", "lineno": 133, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0cfed60>\n\n    async def test_sunset_force_trigger_turns_on_porch(rest):\n        \"\"\"Force-trigger sunset turns on porch light.\"\"\"\n        await _setup_sunset(rest)\n        await rest.call_service(\"automation\", \"trigger\", {\n            \"entity_id\": \"automation.sunset_lights\"\n        })\n        await asyncio.sleep(0.5)\n        state = await rest.get_state(\"light.porch\")\n>       assert state[\"state\"] == \"on\"\nE       AssertionError: assert 'off' == 'on'\nE         \nE         - on\nE         + off\n\ntests/automation/test_demo_automation_morning_sunset.py:133: AssertionError"}, "teardown": {"duration": 0.0009147170931100845, "outcome": "passed"}}, {"nodeid": "tests/automation/test_demo_automation_morning_sunset.py::test_sunset_force_trigger_turns_on_pathway", "lineno": 135, "outcome": "failed", "keywords": ["test_sunset_force_trigger_turns_on_pathway", "test_demo_automation_morning_sunset.py", "asyncio", "automation", "tests", "marge", ""], "setup": {"duration": 0.007679099217057228, "outcome": "passed"}, "call": {"duration": 0.6200285437516868, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/automation/test_demo_automation_morning_sunset.py", "lineno": 144, "message": "AssertionError: assert 'off' == 'on'\n  \n  - on\n  + off"}, "traceback": [{"path": "tests/automation/test_demo_automation_morning_sunset.py", "lineno": 144, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0d3b5e0>\n\n    async def test_sunset_force_trigger_turns_on_pathway(rest):\n        \"\"\"Force-trigger sunset turns on pathway light.\"\"\"\n        await _setup_sunset(rest)\n        await rest.call_service(\"automation\", \"trigger\", {\n            \"entity_id\": \"automation.sunset_lights\"\n        })\n        await asyncio.sleep(0.5)\n        state = await rest.get_state(\"light.pathway\")\n>       assert state[\"state\"] == \"on\"\nE       AssertionError: assert 'off' == 'on'\nE         \nE         - on\nE         + off\n\ntests/automation/test_demo_automation_morning_sunset.py:144: AssertionError"}, "teardown": {"duration": 0.000835150945931673, "outcome": "passed"}}, {"nodeid": "tests/automation/test_demo_automation_morning_sunset.py::test_sunset_force_trigger_activates_evening_scene", "lineno": 146, "outcome": "failed", "keywords": ["test_sunset_force_trigger_activates_evening_scene", "test_demo_automation_morning_sunset.py", "asyncio", "automation", "tests", "marge", ""], "setup": {"duration": 0.005587941035628319, "outcome": "passed"}, "call": {"duration": 0.6160569079220295, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/automation/test_demo_automation_morning_sunset.py", "lineno": 156, "message": "AssertionError: assert 'off' == 'on'\n  \n  - on\n  + off"}, "traceback": [{"path": "tests/automation/test_demo_automation_morning_sunset.py", "lineno": 156, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0d39550>\n\n    async def test_sunset_force_trigger_activates_evening_scene(rest):\n        \"\"\"Force-trigger sunset activates evening scene (living room on).\"\"\"\n        await _setup_sunset(rest)\n        await rest.call_service(\"automation\", \"trigger\", {\n            \"entity_id\": \"automation.sunset_lights\"\n        })\n        await asyncio.sleep(0.5)\n        # Evening scene turns on living room main\n        state = await rest.get_state(\"light.living_room_main\")\n>       assert state[\"state\"] == \"on\"\nE       AssertionError: assert 'off' == 'on'\nE         \nE         - on\nE         + off\n\ntests/automation/test_demo_automation_morning_sunset.py:156: AssertionError"}, "teardown": {"duration": 0.0026229172945022583, "outcome": "passed"}}, {"nodeid": "tests/automation/test_demo_automation_morning_sunset.py::test_sunset_has_sun_trigger", "lineno": 158, "outcome": "failed", "keywords": ["test_sunset_has_sun_trigger", "test_demo_automation_morning_sunset.py", "asyncio", "automation", "tests", "marge", ""], "setup": {"duration": 0.008564543910324574, "outcome": "passed"}, "call": {"duration": 0.003744887188076973, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)"}, "traceback": [{"path": "tests/automation/test_demo_automation_morning_sunset.py", "lineno": 165, "message": ""}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 832, "message": "in json"}, {"path": "../../anaconda3/lib/python3.9/json/__init__.py", "lineno": 346, "message": "in loads"}, {"path": "../../anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "JSONDecodeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0e28640>\n\n    async def test_sunset_has_sun_trigger(rest):\n        \"\"\"sunset_lights has 1 trigger (sun event).\"\"\"\n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/config/automation/config\",\n            headers=rest._headers(),\n        )\n>       data = resp.json()\n\ntests/automation/test_demo_automation_morning_sunset.py:165: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:832: in json\n    return jsonlib.loads(self.content, **kwargs)\n../../anaconda3/lib/python3.9/json/__init__.py:346: in loads\n    return _default_decoder.decode(s)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <json.decoder.JSONDecoder object at 0x7f47b2e5fe50>, s = '404: Not Found'\n_w = <built-in method match of re.Pattern object at 0x7f47b3015cf0>\n\n    def decode(self, s, _w=WHITESPACE.match):\n        \"\"\"Return the Python representation of ``s`` (a ``str`` instance\n        containing a JSON document).\n    \n        \"\"\"\n        obj, end = self.raw_decode(s, idx=_w(s, 0).end())\n        end = _w(s, end).end()\n        if end != len(s):\n>           raise JSONDecodeError(\"Extra data\", s, end)\nE           json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)\n\n../../anaconda3/lib/python3.9/json/decoder.py:340: JSONDecodeError"}, "teardown": {"duration": 0.0009313207119703293, "outcome": "passed"}}, {"nodeid": "tests/automation/test_demo_automation_morning_sunset.py::test_sunset_has_2_actions", "lineno": 169, "outcome": "failed", "keywords": ["test_sunset_has_2_actions", "test_demo_automation_morning_sunset.py", "asyncio", "automation", "tests", "marge", ""], "setup": {"duration": 0.007921684999018908, "outcome": "passed"}, "call": {"duration": 0.0037543680518865585, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)"}, "traceback": [{"path": "tests/automation/test_demo_automation_morning_sunset.py", "lineno": 176, "message": ""}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 832, "message": "in json"}, {"path": "../../anaconda3/lib/python3.9/json/__init__.py", "lineno": 346, "message": "in loads"}, {"path": "../../anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "JSONDecodeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0f98ca0>\n\n    async def test_sunset_has_2_actions(rest):\n        \"\"\"sunset_lights has 2 actions (lights + scene).\"\"\"\n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/config/automation/config\",\n            headers=rest._headers(),\n        )\n>       data = resp.json()\n\ntests/automation/test_demo_automation_morning_sunset.py:176: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:832: in json\n    return jsonlib.loads(self.content, **kwargs)\n../../anaconda3/lib/python3.9/json/__init__.py:346: in loads\n    return _default_decoder.decode(s)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <json.decoder.JSONDecoder object at 0x7f47b2e5fe50>, s = '404: Not Found'\n_w = <built-in method match of re.Pattern object at 0x7f47b3015cf0>\n\n    def decode(self, s, _w=WHITESPACE.match):\n        \"\"\"Return the Python representation of ``s`` (a ``str`` instance\n        containing a JSON document).\n    \n        \"\"\"\n        obj, end = self.raw_decode(s, idx=_w(s, 0).end())\n        end = _w(s, end).end()\n        if end != len(s):\n>           raise JSONDecodeError(\"Extra data\", s, end)\nE           json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)\n\n../../anaconda3/lib/python3.9/json/decoder.py:340: JSONDecodeError"}, "teardown": {"duration": 0.0007754541002213955, "outcome": "passed"}}, {"nodeid": "tests/automation/test_demo_automation_security.py::test_security_alert_fires_when_armed_away", "lineno": 26, "outcome": "failed", "keywords": ["test_security_alert_fires_when_armed_away", "test_demo_automation_security.py", "asyncio", "automation", "tests", "marge", ""], "setup": {"duration": 0.006403149105608463, "outcome": "passed"}, "call": {"duration": 0.7182911378331482, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/automation/test_demo_automation_security.py", "lineno": 38, "message": "assert None is not None"}, "traceback": [{"path": "tests/automation/test_demo_automation_security.py", "lineno": 38, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0e9d6a0>\n\n    async def test_security_alert_fires_when_armed_away(rest):\n        \"\"\"Motion while armed_away triggers security alert.\"\"\"\n        await _setup_security(rest)\n        await rest.set_state(\"alarm_control_panel.home\", \"armed_away\")\n        await asyncio.sleep(0.1)\n    \n        await rest.set_state(\"binary_sensor.entryway_motion\", \"on\")\n        await asyncio.sleep(0.5)\n    \n        # Automation should have fired (check trigger count)\n        state = await rest.get_state(\"automation.security_alert\")\n>       assert state is not None\nE       assert None is not None\n\ntests/automation/test_demo_automation_security.py:38: AssertionError"}, "teardown": {"duration": 0.0017279158346354961, "outcome": "passed"}}, {"nodeid": "tests/automation/test_demo_automation_security.py::test_security_alert_blocked_when_armed_home", "lineno": 41, "outcome": "failed", "keywords": ["test_security_alert_blocked_when_armed_home", "test_demo_automation_security.py", "asyncio", "automation", "tests", "marge", ""], "setup": {"duration": 0.008371575269848108, "outcome": "passed"}, "call": {"duration": 0.2187885451130569, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/automation/test_demo_automation_security.py", "lineno": 49, "message": "TypeError: 'NoneType' object is not subscriptable"}, "traceback": [{"path": "tests/automation/test_demo_automation_security.py", "lineno": 49, "message": "TypeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0ca3bb0>\n\n    async def test_security_alert_blocked_when_armed_home(rest):\n        \"\"\"Motion while armed_home does NOT trigger alert (condition fails).\"\"\"\n        await _setup_security(rest)\n        await rest.set_state(\"alarm_control_panel.home\", \"armed_home\")\n        await asyncio.sleep(0.1)\n    \n        s1 = await rest.get_state(\"automation.security_alert\")\n>       count_before = s1[\"attributes\"].get(\"current\", 0)\nE       TypeError: 'NoneType' object is not subscriptable\n\ntests/automation/test_demo_automation_security.py:49: TypeError"}, "teardown": {"duration": 0.0023720962926745415, "outcome": "passed"}}, {"nodeid": "tests/automation/test_demo_automation_security.py::test_security_alert_blocked_when_disarmed", "lineno": 57, "outcome": "failed", "keywords": ["test_security_alert_blocked_when_disarmed", "test_demo_automation_security.py", "asyncio", "automation", "tests", "marge", ""], "setup": {"duration": 0.016966186929494143, "outcome": "passed"}, "call": {"duration": 0.21410682471469045, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/automation/test_demo_automation_security.py", "lineno": 65, "message": "TypeError: 'NoneType' object is not subscriptable"}, "traceback": [{"path": "tests/automation/test_demo_automation_security.py", "lineno": 65, "message": "TypeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0ca12b0>\n\n    async def test_security_alert_blocked_when_disarmed(rest):\n        \"\"\"Motion while disarmed does NOT trigger alert.\"\"\"\n        await _setup_security(rest)\n        await rest.set_state(\"alarm_control_panel.home\", \"disarmed\")\n        await asyncio.sleep(0.1)\n    \n        s1 = await rest.get_state(\"automation.security_alert\")\n>       count_before = s1[\"attributes\"].get(\"current\", 0)\nE       TypeError: 'NoneType' object is not subscriptable\n\ntests/automation/test_demo_automation_security.py:65: TypeError"}, "teardown": {"duration": 0.0007119257934391499, "outcome": "passed"}}, {"nodeid": "tests/automation/test_demo_automation_security.py::test_lock_verify_fires_when_door_unlocked", "lineno": 86, "outcome": "failed", "keywords": ["test_lock_verify_fires_when_door_unlocked", "test_demo_automation_security.py", "asyncio", "automation", "tests", "marge", ""], "setup": {"duration": 0.005302764941006899, "outcome": "passed"}, "call": {"duration": 0.2100061997771263, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/automation/test_demo_automation_security.py", "lineno": 97, "message": "TypeError: 'NoneType' object is not subscriptable"}, "traceback": [{"path": "tests/automation/test_demo_automation_security.py", "lineno": 97, "message": "TypeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0fe5460>\n\n    async def test_lock_verify_fires_when_door_unlocked(rest):\n        \"\"\"Alarm \u2192 armed_night with unlocked door triggers notification.\"\"\"\n        await _setup_lock_verification(rest)\n        # Set one door unlocked\n        await rest.set_state(\"lock.front_door\", \"unlocked\")\n        await rest.set_state(\"lock.back_door\", \"locked\")\n        await rest.set_state(\"alarm_control_panel.home\", \"armed_home\")\n        await asyncio.sleep(0.1)\n    \n        s1 = await rest.get_state(\"automation.lock_verification\")\n>       count_before = s1[\"attributes\"].get(\"current\", 0)\nE       TypeError: 'NoneType' object is not subscriptable\n\ntests/automation/test_demo_automation_security.py:97: TypeError"}, "teardown": {"duration": 0.0008635572157800198, "outcome": "passed"}}, {"nodeid": "tests/automation/test_demo_automation_security.py::test_lock_verify_fires_when_back_door_unlocked", "lineno": 106, "outcome": "failed", "keywords": ["test_lock_verify_fires_when_back_door_unlocked", "test_demo_automation_security.py", "asyncio", "automation", "tests", "marge", ""], "setup": {"duration": 0.005762617569416761, "outcome": "passed"}, "call": {"duration": 0.21625035675242543, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/automation/test_demo_automation_security.py", "lineno": 116, "message": "TypeError: 'NoneType' object is not subscriptable"}, "traceback": [{"path": "tests/automation/test_demo_automation_security.py", "lineno": 116, "message": "TypeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0d6dd90>\n\n    async def test_lock_verify_fires_when_back_door_unlocked(rest):\n        \"\"\"OR condition: back door unlocked also triggers.\"\"\"\n        await _setup_lock_verification(rest)\n        await rest.set_state(\"lock.front_door\", \"locked\")\n        await rest.set_state(\"lock.back_door\", \"unlocked\")\n        await rest.set_state(\"alarm_control_panel.home\", \"armed_home\")\n        await asyncio.sleep(0.1)\n    \n        s1 = await rest.get_state(\"automation.lock_verification\")\n>       count_before = s1[\"attributes\"].get(\"current\", 0)\nE       TypeError: 'NoneType' object is not subscriptable\n\ntests/automation/test_demo_automation_security.py:116: TypeError"}, "teardown": {"duration": 0.001689326949417591, "outcome": "passed"}}, {"nodeid": "tests/automation/test_demo_automation_security.py::test_lock_verify_skipped_when_all_locked", "lineno": 124, "outcome": "failed", "keywords": ["test_lock_verify_skipped_when_all_locked", "test_demo_automation_security.py", "asyncio", "automation", "tests", "marge", ""], "setup": {"duration": 0.020145653281360865, "outcome": "passed"}, "call": {"duration": 0.23198417108505964, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/automation/test_demo_automation_security.py", "lineno": 134, "message": "TypeError: 'NoneType' object is not subscriptable"}, "traceback": [{"path": "tests/automation/test_demo_automation_security.py", "lineno": 134, "message": "TypeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0e28430>\n\n    async def test_lock_verify_skipped_when_all_locked(rest):\n        \"\"\"All doors locked: lock_verification does NOT fire.\"\"\"\n        await _setup_lock_verification(rest)\n        await rest.set_state(\"lock.front_door\", \"locked\")\n        await rest.set_state(\"lock.back_door\", \"locked\")\n        await rest.set_state(\"alarm_control_panel.home\", \"armed_home\")\n        await asyncio.sleep(0.1)\n    \n        s1 = await rest.get_state(\"automation.lock_verification\")\n>       count_before = s1[\"attributes\"].get(\"current\", 0)\nE       TypeError: 'NoneType' object is not subscriptable\n\ntests/automation/test_demo_automation_security.py:134: TypeError"}, "teardown": {"duration": 0.001844279933720827, "outcome": "passed"}}, {"nodeid": "tests/automation/test_demo_automation_security.py::test_goodnight_force_trigger_turns_off_lights", "lineno": 166, "outcome": "failed", "keywords": ["test_goodnight_force_trigger_turns_off_lights", "test_demo_automation_security.py", "asyncio", "automation", "tests", "marge", ""], "setup": {"duration": 0.007739885710179806, "outcome": "passed"}, "call": {"duration": 0.6396677219308913, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/automation/test_demo_automation_security.py", "lineno": 177, "message": "AssertionError: light.bedroom should be off\nassert 'on' == 'off'\n  \n  - off\n  + on"}, "traceback": [{"path": "tests/automation/test_demo_automation_security.py", "lineno": 177, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0dd5640>\n\n    async def test_goodnight_force_trigger_turns_off_lights(rest):\n        \"\"\"Force-triggering goodnight turns off all lights.\"\"\"\n        await _setup_goodnight(rest)\n        await rest.call_service(\"automation\", \"trigger\", {\n            \"entity_id\": \"automation.goodnight_routine\"\n        })\n        await asyncio.sleep(0.5)\n    \n        for light in [\"light.bedroom\", \"light.kitchen\", \"light.porch\"]:\n            state = await rest.get_state(light)\n>           assert state[\"state\"] == \"off\", f\"{light} should be off\"\nE           AssertionError: light.bedroom should be off\nE           assert 'on' == 'off'\nE             \nE             - off\nE             + on\n\ntests/automation/test_demo_automation_security.py:177: AssertionError"}, "teardown": {"duration": 0.0008008056320250034, "outcome": "passed"}}, {"nodeid": "tests/automation/test_demo_automation_security.py::test_goodnight_force_trigger_locks_doors", "lineno": 179, "outcome": "failed", "keywords": ["test_goodnight_force_trigger_locks_doors", "test_demo_automation_security.py", "asyncio", "automation", "tests", "marge", ""], "setup": {"duration": 0.007252528797835112, "outcome": "passed"}, "call": {"duration": 0.6409925948828459, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/automation/test_demo_automation_security.py", "lineno": 188, "message": "AssertionError: assert 'unlocked' == 'locked'\n  \n  - locked\n  + unlocked\n  ? ++"}, "traceback": [{"path": "tests/automation/test_demo_automation_security.py", "lineno": 188, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0d888b0>\n\n    async def test_goodnight_force_trigger_locks_doors(rest):\n        \"\"\"Force-triggering goodnight locks both doors.\"\"\"\n        await _setup_goodnight(rest)\n        await rest.call_service(\"automation\", \"trigger\", {\n            \"entity_id\": \"automation.goodnight_routine\"\n        })\n        await asyncio.sleep(0.5)\n    \n>       assert (await rest.get_state(\"lock.front_door\"))[\"state\"] == \"locked\"\nE       AssertionError: assert 'unlocked' == 'locked'\nE         \nE         - locked\nE         + unlocked\nE         ? ++\n\ntests/automation/test_demo_automation_security.py:188: AssertionError"}, "teardown": {"duration": 0.0007302858866751194, "outcome": "passed"}}, {"nodeid": "tests/automation/test_demo_automation_security.py::test_goodnight_force_trigger_arms_night", "lineno": 191, "outcome": "failed", "keywords": ["test_goodnight_force_trigger_arms_night", "test_demo_automation_security.py", "asyncio", "automation", "tests", "marge", ""], "setup": {"duration": 0.005508097354322672, "outcome": "passed"}, "call": {"duration": 0.6321077113971114, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/automation/test_demo_automation_security.py", "lineno": 201, "message": "AssertionError: assert 'disarmed' == 'armed_night'\n  \n  - armed_night\n  + disarmed"}, "traceback": [{"path": "tests/automation/test_demo_automation_security.py", "lineno": 201, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0d67d60>\n\n    async def test_goodnight_force_trigger_arms_night(rest):\n        \"\"\"Force-triggering goodnight arms alarm for night.\"\"\"\n        await _setup_goodnight(rest)\n        await rest.call_service(\"automation\", \"trigger\", {\n            \"entity_id\": \"automation.goodnight_routine\"\n        })\n        await asyncio.sleep(0.5)\n    \n        state = await rest.get_state(\"alarm_control_panel.home\")\n>       assert state[\"state\"] == \"armed_night\"\nE       AssertionError: assert 'disarmed' == 'armed_night'\nE         \nE         - armed_night\nE         + disarmed\n\ntests/automation/test_demo_automation_security.py:201: AssertionError"}, "teardown": {"duration": 0.0020553451031446457, "outcome": "passed"}}, {"nodeid": "tests/automation/test_demo_automation_security.py::test_goodnight_force_trigger_lowers_thermostat", "lineno": 203, "outcome": "failed", "keywords": ["test_goodnight_force_trigger_lowers_thermostat", "test_demo_automation_security.py", "asyncio", "automation", "tests", "marge", ""], "setup": {"duration": 0.01803659601137042, "outcome": "passed"}, "call": {"duration": 0.6455934438854456, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/automation/test_demo_automation_security.py", "lineno": 213, "message": "AssertionError: assert 72 == 66\n +  where 72 = <built-in method get of dict object at 0x7f47b0be5780>('temperature')\n +    where <built-in method get of dict object at 0x7f47b0be5780> = {'temperature': 72}.get"}, "traceback": [{"path": "tests/automation/test_demo_automation_security.py", "lineno": 213, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0e41550>\n\n    async def test_goodnight_force_trigger_lowers_thermostat(rest):\n        \"\"\"Force-triggering goodnight sets thermostat to 66.\"\"\"\n        await _setup_goodnight(rest)\n        await rest.call_service(\"automation\", \"trigger\", {\n            \"entity_id\": \"automation.goodnight_routine\"\n        })\n        await asyncio.sleep(0.5)\n    \n        state = await rest.get_state(\"climate.thermostat\")\n>       assert state[\"attributes\"].get(\"temperature\") == 66\nE       AssertionError: assert 72 == 66\nE        +  where 72 = <built-in method get of dict object at 0x7f47b0be5780>('temperature')\nE        +    where <built-in method get of dict object at 0x7f47b0be5780> = {'temperature': 72}.get\n\ntests/automation/test_demo_automation_security.py:213: AssertionError"}, "teardown": {"duration": 0.0008695661090314388, "outcome": "passed"}}, {"nodeid": "tests/automation/test_demo_automation_security.py::test_goodnight_force_trigger_stops_media", "lineno": 215, "outcome": "failed", "keywords": ["test_goodnight_force_trigger_stops_media", "test_demo_automation_security.py", "asyncio", "automation", "tests", "marge", ""], "setup": {"duration": 0.007498695980757475, "outcome": "passed"}, "call": {"duration": 0.6338581838645041, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/automation/test_demo_automation_security.py", "lineno": 225, "message": "AssertionError: assert 'playing' == 'off'\n  \n  - off\n  + playing"}, "traceback": [{"path": "tests/automation/test_demo_automation_security.py", "lineno": 225, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0d390d0>\n\n    async def test_goodnight_force_trigger_stops_media(rest):\n        \"\"\"Force-triggering goodnight turns off media player.\"\"\"\n        await _setup_goodnight(rest)\n        await rest.call_service(\"automation\", \"trigger\", {\n            \"entity_id\": \"automation.goodnight_routine\"\n        })\n        await asyncio.sleep(0.5)\n    \n        state = await rest.get_state(\"media_player.living_room\")\n>       assert state[\"state\"] == \"off\"\nE       AssertionError: assert 'playing' == 'off'\nE         \nE         - off\nE         + playing\n\ntests/automation/test_demo_automation_security.py:225: AssertionError"}, "teardown": {"duration": 0.000694305170327425, "outcome": "passed"}}, {"nodeid": "tests/automation/test_demo_automation_security.py::test_goodnight_event_trigger_fires", "lineno": 227, "outcome": "failed", "keywords": ["test_goodnight_event_trigger_fires", "test_demo_automation_security.py", "asyncio", "automation", "tests", "marge", ""], "setup": {"duration": 0.005814407952129841, "outcome": "passed"}, "call": {"duration": 0.6356959119439125, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/automation/test_demo_automation_security.py", "lineno": 240, "message": "AssertionError: assert 0 > 0\n +  where 0 = <built-in method get of dict object at 0x7f47b0d2d500>('current', 0)\n +    where <built-in method get of dict object at 0x7f47b0d2d500> = {'current': 0, 'friendly_name': 'Goodnight Routine', 'id': 'goodnight_routine', 'last_triggered': '2026-02-20T23:12:05.096369+00:00', ...}.get"}, "traceback": [{"path": "tests/automation/test_demo_automation_security.py", "lineno": 240, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0cc68e0>\n\n    async def test_goodnight_event_trigger_fires(rest):\n        \"\"\"Firing bedside_button_pressed event triggers goodnight.\"\"\"\n        await _setup_goodnight(rest)\n    \n        s1 = await rest.get_state(\"automation.goodnight_routine\")\n        count_before = s1[\"attributes\"].get(\"current\", 0)\n    \n        result = await rest.fire_event(\"bedside_button_pressed\")\n        assert \"message\" in result\n        await asyncio.sleep(0.5)\n    \n        s2 = await rest.get_state(\"automation.goodnight_routine\")\n>       assert s2[\"attributes\"].get(\"current\", 0) > count_before\nE       AssertionError: assert 0 > 0\nE        +  where 0 = <built-in method get of dict object at 0x7f47b0d2d500>('current', 0)\nE        +    where <built-in method get of dict object at 0x7f47b0d2d500> = {'current': 0, 'friendly_name': 'Goodnight Routine', 'id': 'goodnight_routine', 'last_triggered': '2026-02-20T23:12:05.096369+00:00', ...}.get\n\ntests/automation/test_demo_automation_security.py:240: AssertionError"}, "teardown": {"duration": 0.0008051590994000435, "outcome": "passed"}}, {"nodeid": "tests/automation/test_demo_automation_smoke_co.py::test_smoke_trigger_unlocks_front_door", "lineno": 43, "outcome": "failed", "keywords": ["test_smoke_trigger_unlocks_front_door", "test_demo_automation_smoke_co.py", "asyncio", "automation", "tests", "marge", ""], "setup": {"duration": 0.007890650071203709, "outcome": "passed"}, "call": {"duration": 0.6400063280016184, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/automation/test_demo_automation_smoke_co.py", "lineno": 50, "message": "AssertionError: assert 'locked' == 'unlocked'\n  \n  - unlocked\n  ? --\n  + locked"}, "traceback": [{"path": "tests/automation/test_demo_automation_smoke_co.py", "lineno": 50, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0de6820>\n\n    async def test_smoke_trigger_unlocks_front_door(rest):\n        \"\"\"Smoke detector \u2192 on unlocks front door.\"\"\"\n        await _setup_emergency_entities(rest)\n        await rest.set_state(\"binary_sensor.smoke_detector\", \"on\")\n        await asyncio.sleep(0.5)\n        state = await rest.get_state(\"lock.front_door\")\n>       assert state[\"state\"] == \"unlocked\"\nE       AssertionError: assert 'locked' == 'unlocked'\nE         \nE         - unlocked\nE         ? --\nE         + locked\n\ntests/automation/test_demo_automation_smoke_co.py:50: AssertionError"}, "teardown": {"duration": 0.0007044789381325245, "outcome": "passed"}}, {"nodeid": "tests/automation/test_demo_automation_smoke_co.py::test_smoke_trigger_unlocks_back_door", "lineno": 52, "outcome": "failed", "keywords": ["test_smoke_trigger_unlocks_back_door", "test_demo_automation_smoke_co.py", "asyncio", "automation", "tests", "marge", ""], "setup": {"duration": 0.00608668802306056, "outcome": "passed"}, "call": {"duration": 0.6349634760990739, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/automation/test_demo_automation_smoke_co.py", "lineno": 59, "message": "AssertionError: assert 'locked' == 'unlocked'\n  \n  - unlocked\n  ? --\n  + locked"}, "traceback": [{"path": "tests/automation/test_demo_automation_smoke_co.py", "lineno": 59, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0d88190>\n\n    async def test_smoke_trigger_unlocks_back_door(rest):\n        \"\"\"Smoke detector \u2192 on unlocks back door.\"\"\"\n        await _setup_emergency_entities(rest)\n        await rest.set_state(\"binary_sensor.smoke_detector\", \"on\")\n        await asyncio.sleep(0.5)\n        state = await rest.get_state(\"lock.back_door\")\n>       assert state[\"state\"] == \"unlocked\"\nE       AssertionError: assert 'locked' == 'unlocked'\nE         \nE         - unlocked\nE         ? --\nE         + locked\n\ntests/automation/test_demo_automation_smoke_co.py:59: AssertionError"}, "teardown": {"duration": 0.0006249351426959038, "outcome": "passed"}}, {"nodeid": "tests/automation/test_demo_automation_smoke_co.py::test_smoke_trigger_turns_on_all_lights", "lineno": 61, "outcome": "failed", "keywords": ["test_smoke_trigger_turns_on_all_lights", "test_demo_automation_smoke_co.py", "asyncio", "automation", "tests", "marge", ""], "setup": {"duration": 0.005465373862534761, "outcome": "passed"}, "call": {"duration": 0.6281732968054712, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/automation/test_demo_automation_smoke_co.py", "lineno": 72, "message": "AssertionError: light.bedroom should be on\nassert 'off' == 'on'\n  \n  - on\n  + off"}, "traceback": [{"path": "tests/automation/test_demo_automation_smoke_co.py", "lineno": 72, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0f772e0>\n\n    async def test_smoke_trigger_turns_on_all_lights(rest):\n        \"\"\"Smoke detector \u2192 on turns on all 9 lights.\"\"\"\n        await _setup_emergency_entities(rest)\n        await rest.set_state(\"binary_sensor.smoke_detector\", \"on\")\n        await asyncio.sleep(0.5)\n        for light in [\n            \"light.bedroom\", \"light.bathroom\", \"light.kitchen\",\n            \"light.living_room_main\", \"light.porch\", \"light.pathway\",\n        ]:\n            state = await rest.get_state(light)\n>           assert state[\"state\"] == \"on\", f\"{light} should be on\"\nE           AssertionError: light.bedroom should be on\nE           assert 'off' == 'on'\nE             \nE             - on\nE             + off\n\ntests/automation/test_demo_automation_smoke_co.py:72: AssertionError"}, "teardown": {"duration": 0.001003114040941, "outcome": "passed"}}, {"nodeid": "tests/automation/test_demo_automation_smoke_co.py::test_smoke_trigger_sets_brightness_255", "lineno": 74, "outcome": "failed", "keywords": ["test_smoke_trigger_sets_brightness_255", "test_demo_automation_smoke_co.py", "asyncio", "automation", "tests", "marge", ""], "setup": {"duration": 0.0075386082753539085, "outcome": "passed"}, "call": {"duration": 0.6355243460275233, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/automation/test_demo_automation_smoke_co.py", "lineno": 81, "message": "AssertionError: assert None == 255\n +  where None = <built-in method get of dict object at 0x7f47b0bf3980>('brightness')\n +    where <built-in method get of dict object at 0x7f47b0bf3980> = {}.get"}, "traceback": [{"path": "tests/automation/test_demo_automation_smoke_co.py", "lineno": 81, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0dc5640>\n\n    async def test_smoke_trigger_sets_brightness_255(rest):\n        \"\"\"Smoke detector \u2192 on sets light brightness to 255.\"\"\"\n        await _setup_emergency_entities(rest)\n        await rest.set_state(\"binary_sensor.smoke_detector\", \"on\")\n        await asyncio.sleep(0.5)\n        state = await rest.get_state(\"light.bedroom\")\n>       assert state[\"attributes\"].get(\"brightness\") == 255\nE       AssertionError: assert None == 255\nE        +  where None = <built-in method get of dict object at 0x7f47b0bf3980>('brightness')\nE        +    where <built-in method get of dict object at 0x7f47b0bf3980> = {}.get\n\ntests/automation/test_demo_automation_smoke_co.py:81: AssertionError"}, "teardown": {"duration": 0.0007488341070711613, "outcome": "passed"}}, {"nodeid": "tests/automation/test_demo_automation_smoke_co.py::test_smoke_trigger_disarms_alarm", "lineno": 83, "outcome": "failed", "keywords": ["test_smoke_trigger_disarms_alarm", "test_demo_automation_smoke_co.py", "asyncio", "automation", "tests", "marge", ""], "setup": {"duration": 0.008147106040269136, "outcome": "passed"}, "call": {"duration": 0.6374063161201775, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/automation/test_demo_automation_smoke_co.py", "lineno": 90, "message": "AssertionError: assert 'armed_home' == 'disarmed'\n  \n  - disarmed\n  + armed_home"}, "traceback": [{"path": "tests/automation/test_demo_automation_smoke_co.py", "lineno": 90, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0e41bb0>\n\n    async def test_smoke_trigger_disarms_alarm(rest):\n        \"\"\"Smoke detector \u2192 on disarms alarm.\"\"\"\n        await _setup_emergency_entities(rest)\n        await rest.set_state(\"binary_sensor.smoke_detector\", \"on\")\n        await asyncio.sleep(0.5)\n        state = await rest.get_state(\"alarm_control_panel.home\")\n>       assert state[\"state\"] == \"disarmed\"\nE       AssertionError: assert 'armed_home' == 'disarmed'\nE         \nE         - disarmed\nE         + armed_home\n\ntests/automation/test_demo_automation_smoke_co.py:90: AssertionError"}, "teardown": {"duration": 0.000642052385956049, "outcome": "passed"}}, {"nodeid": "tests/automation/test_demo_automation_smoke_co.py::test_co_trigger_also_fires_emergency", "lineno": 94, "outcome": "failed", "keywords": ["test_co_trigger_also_fires_emergency", "test_demo_automation_smoke_co.py", "asyncio", "automation", "tests", "marge", ""], "setup": {"duration": 0.005540816113352776, "outcome": "passed"}, "call": {"duration": 0.6271699629724026, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/automation/test_demo_automation_smoke_co.py", "lineno": 101, "message": "AssertionError: assert 'locked' == 'unlocked'\n  \n  - unlocked\n  ? --\n  + locked"}, "traceback": [{"path": "tests/automation/test_demo_automation_smoke_co.py", "lineno": 101, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0e28c40>\n\n    async def test_co_trigger_also_fires_emergency(rest):\n        \"\"\"CO detector \u2192 on triggers the same emergency response.\"\"\"\n        await _setup_emergency_entities(rest)\n        await rest.set_state(\"binary_sensor.co_detector\", \"on\")\n        await asyncio.sleep(0.5)\n        state = await rest.get_state(\"lock.front_door\")\n>       assert state[\"state\"] == \"unlocked\"\nE       AssertionError: assert 'locked' == 'unlocked'\nE         \nE         - unlocked\nE         ? --\nE         + locked\n\ntests/automation/test_demo_automation_smoke_co.py:101: AssertionError"}, "teardown": {"duration": 0.0007914463058114052, "outcome": "passed"}}, {"nodeid": "tests/automation/test_demo_automation_smoke_co.py::test_co_trigger_turns_on_lights", "lineno": 103, "outcome": "failed", "keywords": ["test_co_trigger_turns_on_lights", "test_demo_automation_smoke_co.py", "asyncio", "automation", "tests", "marge", ""], "setup": {"duration": 0.00561506999656558, "outcome": "passed"}, "call": {"duration": 0.6275644558481872, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/automation/test_demo_automation_smoke_co.py", "lineno": 110, "message": "AssertionError: assert 'off' == 'on'\n  \n  - on\n  + off"}, "traceback": [{"path": "tests/automation/test_demo_automation_smoke_co.py", "lineno": 110, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b10854c0>\n\n    async def test_co_trigger_turns_on_lights(rest):\n        \"\"\"CO detector \u2192 on turns on lights.\"\"\"\n        await _setup_emergency_entities(rest)\n        await rest.set_state(\"binary_sensor.co_detector\", \"on\")\n        await asyncio.sleep(0.5)\n        state = await rest.get_state(\"light.porch\")\n>       assert state[\"state\"] == \"on\"\nE       AssertionError: assert 'off' == 'on'\nE         \nE         - on\nE         + off\n\ntests/automation/test_demo_automation_smoke_co.py:110: AssertionError"}, "teardown": {"duration": 0.0007092058658599854, "outcome": "passed"}}, {"nodeid": "tests/automation/test_demo_automation_smoke_co.py::test_force_trigger_executes_all_actions", "lineno": 114, "outcome": "failed", "keywords": ["test_force_trigger_executes_all_actions", "test_demo_automation_smoke_co.py", "asyncio", "automation", "tests", "marge", ""], "setup": {"duration": 0.005780517123639584, "outcome": "passed"}, "call": {"duration": 0.6292247190140188, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/automation/test_demo_automation_smoke_co.py", "lineno": 122, "message": "AssertionError: assert 'locked' == 'unlocked'\n  \n  - unlocked\n  ? --\n  + locked"}, "traceback": [{"path": "tests/automation/test_demo_automation_smoke_co.py", "lineno": 122, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0cb3040>\n\n    async def test_force_trigger_executes_all_actions(rest):\n        \"\"\"automation.trigger bypasses triggers, runs all actions.\"\"\"\n        await _setup_emergency_entities(rest)\n        await rest.call_service(\"automation\", \"trigger\", {\n            \"entity_id\": \"automation.smoke_co_emergency\"\n        })\n        await asyncio.sleep(0.5)\n>       assert (await rest.get_state(\"lock.front_door\"))[\"state\"] == \"unlocked\"\nE       AssertionError: assert 'locked' == 'unlocked'\nE         \nE         - unlocked\nE         ? --\nE         + locked\n\ntests/automation/test_demo_automation_smoke_co.py:122: AssertionError"}, "teardown": {"duration": 0.0012302328832447529, "outcome": "passed"}}, {"nodeid": "tests/automation/test_demo_automation_smoke_co.py::test_force_trigger_updates_metadata", "lineno": 126, "outcome": "failed", "keywords": ["test_force_trigger_updates_metadata", "test_demo_automation_smoke_co.py", "asyncio", "automation", "tests", "marge", ""], "setup": {"duration": 0.007978606969118118, "outcome": "passed"}, "call": {"duration": 0.0036920332349836826, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/automation/test_demo_automation_smoke_co.py", "lineno": 130, "message": "TypeError: 'NoneType' object is not subscriptable"}, "traceback": [{"path": "tests/automation/test_demo_automation_smoke_co.py", "lineno": 130, "message": "TypeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0e9dac0>\n\n    async def test_force_trigger_updates_metadata(rest):\n        \"\"\"Force trigger increments trigger count and updates last_triggered.\"\"\"\n        s1 = await rest.get_state(\"automation.smoke_co_emergency\")\n>       count_before = s1[\"attributes\"].get(\"current\", 0)\nE       TypeError: 'NoneType' object is not subscriptable\n\ntests/automation/test_demo_automation_smoke_co.py:130: TypeError"}, "teardown": {"duration": 0.0008975970558822155, "outcome": "passed"}}, {"nodeid": "tests/automation/test_demo_automation_smoke_co.py::test_disabled_emergency_does_not_fire", "lineno": 143, "outcome": "passed", "keywords": ["test_disabled_emergency_does_not_fire", "test_demo_automation_smoke_co.py", "asyncio", "automation", "tests", "marge", ""], "setup": {"duration": 0.007708325982093811, "outcome": "passed"}, "call": {"duration": 0.7409514179453254, "outcome": "passed"}, "teardown": {"duration": 0.00126313092187047, "outcome": "passed"}}, {"nodeid": "tests/automation/test_demo_automation_smoke_co.py::test_re_enabled_emergency_fires_again", "lineno": 163, "outcome": "failed", "keywords": ["test_re_enabled_emergency_fires_again", "test_demo_automation_smoke_co.py", "asyncio", "automation", "tests", "marge", ""], "setup": {"duration": 0.010183633305132389, "outcome": "passed"}, "call": {"duration": 1.255258138757199, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/automation/test_demo_automation_smoke_co.py", "lineno": 185, "message": "AssertionError: assert 'locked' == 'unlocked'\n  \n  - unlocked\n  ? --\n  + locked"}, "traceback": [{"path": "tests/automation/test_demo_automation_smoke_co.py", "lineno": 185, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0dc5af0>\n\n    async def test_re_enabled_emergency_fires_again(rest):\n        \"\"\"Re-enabled automation fires on next trigger.\"\"\"\n        await _setup_emergency_entities(rest)\n        # Disable, trigger (should not fire), re-enable, trigger (should fire)\n        await rest.call_service(\"automation\", \"turn_off\", {\n            \"entity_id\": \"automation.smoke_co_emergency\"\n        })\n        await asyncio.sleep(0.1)\n        await rest.set_state(\"binary_sensor.smoke_detector\", \"on\")\n        await asyncio.sleep(0.3)\n        assert (await rest.get_state(\"lock.front_door\"))[\"state\"] == \"locked\"\n    \n        await rest.call_service(\"automation\", \"turn_on\", {\n            \"entity_id\": \"automation.smoke_co_emergency\"\n        })\n        await asyncio.sleep(0.1)\n        # Reset trigger entity and fire again\n        await rest.set_state(\"binary_sensor.smoke_detector\", \"off\")\n        await asyncio.sleep(0.1)\n        await rest.set_state(\"binary_sensor.smoke_detector\", \"on\")\n        await asyncio.sleep(0.5)\n>       assert (await rest.get_state(\"lock.front_door\"))[\"state\"] == \"unlocked\"\nE       AssertionError: assert 'locked' == 'unlocked'\nE         \nE         - unlocked\nE         ? --\nE         + locked\n\ntests/automation/test_demo_automation_smoke_co.py:185: AssertionError"}, "teardown": {"duration": 0.0006752391345798969, "outcome": "passed"}}, {"nodeid": "tests/automation/test_lifecycle.py::test_list_automations", "lineno": 14, "outcome": "failed", "keywords": ["test_list_automations", "test_lifecycle.py", "asyncio", "automation", "tests", "marge", ""], "setup": {"duration": 0.006416961085051298, "outcome": "passed"}, "call": {"duration": 0.0034247972071170807, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/automation/test_lifecycle.py", "lineno": 21, "message": "assert 404 == 200\n +  where 404 = <Response [404 Not Found]>.status_code"}, "traceback": [{"path": "tests/automation/test_lifecycle.py", "lineno": 21, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0e22bb0>\n\n    async def test_list_automations(rest):\n        \"\"\"GET /api/config/automation/config returns all 6 automations.\"\"\"\n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/config/automation/config\",\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 404 == 200\nE        +  where 404 = <Response [404 Not Found]>.status_code\n\ntests/automation/test_lifecycle.py:21: AssertionError"}, "teardown": {"duration": 0.0006534848362207413, "outcome": "passed"}}, {"nodeid": "tests/automation/test_lifecycle.py::test_automation_info_fields", "lineno": 30, "outcome": "failed", "keywords": ["test_automation_info_fields", "test_lifecycle.py", "asyncio", "automation", "tests", "marge", ""], "setup": {"duration": 0.005667001008987427, "outcome": "passed"}, "call": {"duration": 0.002884868998080492, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)"}, "traceback": [{"path": "tests/automation/test_lifecycle.py", "lineno": 37, "message": ""}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 832, "message": "in json"}, {"path": "../../anaconda3/lib/python3.9/json/__init__.py", "lineno": 346, "message": "in loads"}, {"path": "../../anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "JSONDecodeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0d40a30>\n\n    async def test_automation_info_fields(rest):\n        \"\"\"Automation info includes all expected metadata fields.\"\"\"\n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/config/automation/config\",\n            headers=rest._headers(),\n        )\n>       autos = resp.json()\n\ntests/automation/test_lifecycle.py:37: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:832: in json\n    return jsonlib.loads(self.content, **kwargs)\n../../anaconda3/lib/python3.9/json/__init__.py:346: in loads\n    return _default_decoder.decode(s)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <json.decoder.JSONDecoder object at 0x7f47b2e5fe50>, s = '404: Not Found'\n_w = <built-in method match of re.Pattern object at 0x7f47b3015cf0>\n\n    def decode(self, s, _w=WHITESPACE.match):\n        \"\"\"Return the Python representation of ``s`` (a ``str`` instance\n        containing a JSON document).\n    \n        \"\"\"\n        obj, end = self.raw_decode(s, idx=_w(s, 0).end())\n        end = _w(s, end).end()\n        if end != len(s):\n>           raise JSONDecodeError(\"Extra data\", s, end)\nE           json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)\n\n../../anaconda3/lib/python3.9/json/decoder.py:340: JSONDecodeError"}, "teardown": {"duration": 0.0006646187976002693, "outcome": "passed"}}, {"nodeid": "tests/automation/test_lifecycle.py::test_automation_disable", "lineno": 48, "outcome": "failed", "keywords": ["test_automation_disable", "test_lifecycle.py", "asyncio", "automation", "tests", "marge", ""], "setup": {"duration": 0.005268231965601444, "outcome": "passed"}, "call": {"duration": 0.0045329672284424305, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/automation/test_lifecycle.py", "lineno": 55, "message": "assert None is not None"}, "traceback": [{"path": "tests/automation/test_lifecycle.py", "lineno": 55, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0d407f0>\n\n    async def test_automation_disable(rest):\n        \"\"\"automation.turn_off disables an automation.\"\"\"\n        await rest.call_service(\"automation\", \"turn_off\", {\n            \"entity_id\": \"automation.morning_wakeup\",\n        })\n        state = await rest.get_state(\"automation.morning_wakeup\")\n>       assert state is not None\nE       assert None is not None\n\ntests/automation/test_lifecycle.py:55: AssertionError"}, "teardown": {"duration": 0.0007620253600180149, "outcome": "passed"}}, {"nodeid": "tests/automation/test_lifecycle.py::test_automation_enable", "lineno": 58, "outcome": "failed", "keywords": ["test_automation_enable", "test_lifecycle.py", "asyncio", "automation", "tests", "marge", ""], "setup": {"duration": 0.005131398793309927, "outcome": "passed"}, "call": {"duration": 0.005563968792557716, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/automation/test_lifecycle.py", "lineno": 70, "message": "assert None is not None"}, "traceback": [{"path": "tests/automation/test_lifecycle.py", "lineno": 70, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0d5a910>\n\n    async def test_automation_enable(rest):\n        \"\"\"automation.turn_on re-enables an automation.\"\"\"\n        # Ensure disabled first\n        await rest.call_service(\"automation\", \"turn_off\", {\n            \"entity_id\": \"automation.morning_wakeup\",\n        })\n        # Re-enable\n        await rest.call_service(\"automation\", \"turn_on\", {\n            \"entity_id\": \"automation.morning_wakeup\",\n        })\n        state = await rest.get_state(\"automation.morning_wakeup\")\n>       assert state is not None\nE       assert None is not None\n\ntests/automation/test_lifecycle.py:70: AssertionError"}, "teardown": {"duration": 0.0006263367831707001, "outcome": "passed"}}, {"nodeid": "tests/automation/test_lifecycle.py::test_automation_toggle", "lineno": 73, "outcome": "failed", "keywords": ["test_automation_toggle", "test_lifecycle.py", "asyncio", "automation", "tests", "marge", ""], "setup": {"duration": 0.0053672450594604015, "outcome": "passed"}, "call": {"duration": 0.004008286166936159, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/automation/test_lifecycle.py", "lineno": 81, "message": "TypeError: 'NoneType' object is not subscriptable"}, "traceback": [{"path": "tests/automation/test_lifecycle.py", "lineno": 81, "message": "TypeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0fe7a60>\n\n    async def test_automation_toggle(rest):\n        \"\"\"automation.toggle flips the enabled state.\"\"\"\n        # Start from known on state\n        await rest.call_service(\"automation\", \"turn_on\", {\n            \"entity_id\": \"automation.morning_wakeup\",\n        })\n        state_before = await rest.get_state(\"automation.morning_wakeup\")\n>       assert state_before[\"state\"] == \"on\"\nE       TypeError: 'NoneType' object is not subscriptable\n\ntests/automation/test_lifecycle.py:81: TypeError"}, "teardown": {"duration": 0.0005368320271372795, "outcome": "passed"}}, {"nodeid": "tests/automation/test_lifecycle.py::test_disabled_automation_does_not_fire", "lineno": 99, "outcome": "passed", "keywords": ["test_disabled_automation_does_not_fire", "test_lifecycle.py", "asyncio", "automation", "tests", "marge", ""], "setup": {"duration": 0.005208597984164953, "outcome": "passed"}, "call": {"duration": 0.41260595386847854, "outcome": "passed"}, "teardown": {"duration": 0.0009138258174061775, "outcome": "passed"}}, {"nodeid": "tests/automation/test_lifecycle.py::test_reload_automations", "lineno": 128, "outcome": "failed", "keywords": ["test_reload_automations", "test_lifecycle.py", "asyncio", "automation", "tests", "marge", ""], "setup": {"duration": 0.007597818970680237, "outcome": "passed"}, "call": {"duration": 0.004883119836449623, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/automation/test_lifecycle.py", "lineno": 135, "message": "assert 404 == 200\n +  where 404 = <Response [404 Not Found]>.status_code"}, "traceback": [{"path": "tests/automation/test_lifecycle.py", "lineno": 135, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0e18df0>\n\n    async def test_reload_automations(rest):\n        \"\"\"POST /api/config/core/reload reloads automations from disk.\"\"\"\n        resp = await rest.client.post(\n            f\"{rest.base_url}/api/config/core/reload\",\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 404 == 200\nE        +  where 404 = <Response [404 Not Found]>.status_code\n\ntests/automation/test_lifecycle.py:135: AssertionError"}, "teardown": {"duration": 0.0007362724281847477, "outcome": "passed"}}, {"nodeid": "tests/automation/test_lifecycle.py::test_reload_via_automation_path", "lineno": 140, "outcome": "failed", "keywords": ["test_reload_via_automation_path", "test_lifecycle.py", "asyncio", "automation", "tests", "marge", ""], "setup": {"duration": 0.007743108086287975, "outcome": "passed"}, "call": {"duration": 0.0034514828585088253, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/automation/test_lifecycle.py", "lineno": 147, "message": "assert 404 == 200\n +  where 404 = <Response [404 Not Found]>.status_code"}, "traceback": [{"path": "tests/automation/test_lifecycle.py", "lineno": 147, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0df6640>\n\n    async def test_reload_via_automation_path(rest):\n        \"\"\"POST /api/config/automation/reload also reloads automations.\"\"\"\n        resp = await rest.client.post(\n            f\"{rest.base_url}/api/config/automation/reload\",\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 404 == 200\nE        +  where 404 = <Response [404 Not Found]>.status_code\n\ntests/automation/test_lifecycle.py:147: AssertionError"}, "teardown": {"duration": 0.000822748988866806, "outcome": "passed"}}, {"nodeid": "tests/automation/test_lifecycle.py::test_force_trigger_sets_last_triggered", "lineno": 153, "outcome": "failed", "keywords": ["test_force_trigger_sets_last_triggered", "test_lifecycle.py", "asyncio", "automation", "tests", "marge", ""], "setup": {"duration": 0.00783467385917902, "outcome": "passed"}, "call": {"duration": 0.3155462760478258, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)"}, "traceback": [{"path": "tests/automation/test_lifecycle.py", "lineno": 179, "message": ""}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 832, "message": "in json"}, {"path": "../../anaconda3/lib/python3.9/json/__init__.py", "lineno": 346, "message": "in loads"}, {"path": "../../anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "JSONDecodeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0cf1790>\n\n    async def test_force_trigger_sets_last_triggered(rest):\n        \"\"\"Force-triggering an automation updates its last_triggered.\"\"\"\n        import asyncio\n    \n        # Ensure enabled\n        await rest.call_service(\"automation\", \"turn_on\", {\n            \"entity_id\": \"automation.morning_wakeup\",\n        })\n    \n        # Set preconditions\n        await rest.set_state(\"light.bedroom\", \"off\")\n        await rest.set_state(\"switch.coffee_maker\", \"off\")\n        await asyncio.sleep(0.1)\n    \n        # Force trigger\n        await rest.call_service(\"automation\", \"trigger\", {\n            \"entity_id\": \"automation.morning_wakeup\",\n        })\n        await asyncio.sleep(0.2)\n    \n        # Check automation info for last_triggered\n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/config/automation/config\",\n            headers=rest._headers(),\n        )\n>       autos = resp.json()\n\ntests/automation/test_lifecycle.py:179: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:832: in json\n    return jsonlib.loads(self.content, **kwargs)\n../../anaconda3/lib/python3.9/json/__init__.py:346: in loads\n    return _default_decoder.decode(s)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <json.decoder.JSONDecoder object at 0x7f47b2e5fe50>, s = '404: Not Found'\n_w = <built-in method match of re.Pattern object at 0x7f47b3015cf0>\n\n    def decode(self, s, _w=WHITESPACE.match):\n        \"\"\"Return the Python representation of ``s`` (a ``str`` instance\n        containing a JSON document).\n    \n        \"\"\"\n        obj, end = self.raw_decode(s, idx=_w(s, 0).end())\n        end = _w(s, end).end()\n        if end != len(s):\n>           raise JSONDecodeError(\"Extra data\", s, end)\nE           json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)\n\n../../anaconda3/lib/python3.9/json/decoder.py:340: JSONDecodeError"}, "teardown": {"duration": 0.000964741688221693, "outcome": "passed"}}, {"nodeid": "tests/automation/test_lifecycle.py::test_trigger_count_increments", "lineno": 184, "outcome": "failed", "keywords": ["test_trigger_count_increments", "test_lifecycle.py", "asyncio", "automation", "tests", "marge", ""], "setup": {"duration": 0.008038222324103117, "outcome": "passed"}, "call": {"duration": 0.003981373272836208, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)"}, "traceback": [{"path": "tests/automation/test_lifecycle.py", "lineno": 194, "message": ""}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 832, "message": "in json"}, {"path": "../../anaconda3/lib/python3.9/json/__init__.py", "lineno": 346, "message": "in loads"}, {"path": "../../anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "JSONDecodeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0cced90>\n\n    async def test_trigger_count_increments(rest):\n        \"\"\"Each force-trigger increments total_triggers counter.\"\"\"\n        import asyncio\n    \n        # Get current count\n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/config/automation/config\",\n            headers=rest._headers(),\n        )\n>       autos = resp.json()\n\ntests/automation/test_lifecycle.py:194: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:832: in json\n    return jsonlib.loads(self.content, **kwargs)\n../../anaconda3/lib/python3.9/json/__init__.py:346: in loads\n    return _default_decoder.decode(s)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <json.decoder.JSONDecoder object at 0x7f47b2e5fe50>, s = '404: Not Found'\n_w = <built-in method match of re.Pattern object at 0x7f47b3015cf0>\n\n    def decode(self, s, _w=WHITESPACE.match):\n        \"\"\"Return the Python representation of ``s`` (a ``str`` instance\n        containing a JSON document).\n    \n        \"\"\"\n        obj, end = self.raw_decode(s, idx=_w(s, 0).end())\n        end = _w(s, end).end()\n        if end != len(s):\n>           raise JSONDecodeError(\"Extra data\", s, end)\nE           json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)\n\n../../anaconda3/lib/python3.9/json/decoder.py:340: JSONDecodeError"}, "teardown": {"duration": 0.0010266411118209362, "outcome": "passed"}}, {"nodeid": "tests/automation/test_state_trigger_behavior.py::test_smoke_trigger_unlocks_door", "lineno": 13, "outcome": "failed", "keywords": ["test_smoke_trigger_unlocks_door", "test_state_trigger_behavior.py", "asyncio", "automation", "tests", "marge", ""], "setup": {"duration": 0.007570891175419092, "outcome": "passed"}, "call": {"duration": 0.8110135677270591, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/automation/test_state_trigger_behavior.py", "lineno": 26, "message": "AssertionError: assert 'locked' == 'unlocked'\n  \n  - unlocked\n  ? --\n  + locked"}, "traceback": [{"path": "tests/automation/test_state_trigger_behavior.py", "lineno": 26, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0e695b0>\n\n    async def test_smoke_trigger_unlocks_door(rest):\n        \"\"\"Smoke detector on \u2192 unlocks front door (emergency automation).\"\"\"\n        # Reset\n        await rest.set_state(\"lock.front_door\", \"locked\")\n        await rest.set_state(\"binary_sensor.smoke_detector\", \"off\")\n        await asyncio.sleep(0.3)\n    \n        # Trigger\n        await rest.set_state(\"binary_sensor.smoke_detector\", \"on\")\n        await asyncio.sleep(0.5)\n    \n        state = await rest.get_state(\"lock.front_door\")\n>       assert state[\"state\"] == \"unlocked\"\nE       AssertionError: assert 'locked' == 'unlocked'\nE         \nE         - unlocked\nE         ? --\nE         + locked\n\ntests/automation/test_state_trigger_behavior.py:26: AssertionError"}, "teardown": {"duration": 0.000686506275087595, "outcome": "passed"}}, {"nodeid": "tests/automation/test_state_trigger_behavior.py::test_non_matching_state_no_trigger", "lineno": 28, "outcome": "passed", "keywords": ["test_non_matching_state_no_trigger", "test_state_trigger_behavior.py", "asyncio", "automation", "tests", "marge", ""], "setup": {"duration": 0.00928700901567936, "outcome": "passed"}, "call": {"duration": 0.30814690003171563, "outcome": "passed"}, "teardown": {"duration": 0.0005792109295725822, "outcome": "passed"}}, {"nodeid": "tests/automation/test_state_trigger_behavior.py::test_automation_entity_tracks_state", "lineno": 42, "outcome": "failed", "keywords": ["test_automation_entity_tracks_state", "test_state_trigger_behavior.py", "asyncio", "automation", "tests", "marge", ""], "setup": {"duration": 0.005160772241652012, "outcome": "passed"}, "call": {"duration": 0.003304505255073309, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/automation/test_state_trigger_behavior.py", "lineno": 46, "message": "TypeError: 'NoneType' object is not subscriptable"}, "traceback": [{"path": "tests/automation/test_state_trigger_behavior.py", "lineno": 46, "message": "TypeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0ee69d0>\n\n    async def test_automation_entity_tracks_state(rest):\n        \"\"\"Automation entities reflect on/off state.\"\"\"\n        state = await rest.get_state(\"automation.smoke_co_emergency\")\n>       assert state[\"state\"] in [\"on\", \"off\"]\nE       TypeError: 'NoneType' object is not subscriptable\n\ntests/automation/test_state_trigger_behavior.py:46: TypeError"}, "teardown": {"duration": 0.0006870911456644535, "outcome": "passed"}}, {"nodeid": "tests/automation/test_state_trigger_behavior.py::test_trigger_updates_last_triggered", "lineno": 49, "outcome": "failed", "keywords": ["test_trigger_updates_last_triggered", "test_state_trigger_behavior.py", "asyncio", "automation", "tests", "marge", ""], "setup": {"duration": 0.005051533225923777, "outcome": "passed"}, "call": {"duration": 0.004399775993078947, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/automation/test_state_trigger_behavior.py", "lineno": 61, "message": "TypeError: 'NoneType' object is not subscriptable"}, "traceback": [{"path": "tests/automation/test_state_trigger_behavior.py", "lineno": 61, "message": "TypeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0d2efa0>\n\n    async def test_trigger_updates_last_triggered(rest):\n        \"\"\"Triggering updates last_triggered attribute.\"\"\"\n        eid = \"automation.smoke_co_emergency\"\n    \n        await rest.client.post(\n            f\"{rest.base_url}/api/services/automation/trigger\",\n            json={\"entity_id\": eid},\n            headers=rest._headers(),\n        )\n    \n        state = await rest.get_state(eid)\n>       lt = state[\"attributes\"].get(\"last_triggered\", \"\")\nE       TypeError: 'NoneType' object is not subscriptable\n\ntests/automation/test_state_trigger_behavior.py:61: TypeError"}, "teardown": {"duration": 0.000701243057847023, "outcome": "passed"}}, {"nodeid": "tests/automation/test_state_trigger_behavior.py::test_disabled_automation_state", "lineno": 65, "outcome": "failed", "keywords": ["test_disabled_automation_state", "test_state_trigger_behavior.py", "asyncio", "automation", "tests", "marge", ""], "setup": {"duration": 0.005164947360754013, "outcome": "passed"}, "call": {"duration": 0.004158692434430122, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/automation/test_state_trigger_behavior.py", "lineno": 77, "message": "TypeError: 'NoneType' object is not subscriptable"}, "traceback": [{"path": "tests/automation/test_state_trigger_behavior.py", "lineno": 77, "message": "TypeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0ca15b0>\n\n    async def test_disabled_automation_state(rest):\n        \"\"\"Disabled automation has state 'off'.\"\"\"\n        eid = \"automation.smoke_co_emergency\"\n    \n        await rest.client.post(\n            f\"{rest.base_url}/api/services/automation/turn_off\",\n            json={\"entity_id\": eid},\n            headers=rest._headers(),\n        )\n    \n        state = await rest.get_state(eid)\n>       assert state[\"state\"] == \"off\"\nE       TypeError: 'NoneType' object is not subscriptable\n\ntests/automation/test_state_trigger_behavior.py:77: TypeError"}, "teardown": {"duration": 0.0006359908729791641, "outcome": "passed"}}, {"nodeid": "tests/automation/test_state_trigger_behavior.py::test_multiple_automations_exist", "lineno": 86, "outcome": "passed", "keywords": ["test_multiple_automations_exist", "test_state_trigger_behavior.py", "asyncio", "automation", "tests", "marge", ""], "setup": {"duration": 0.0054144118912518024, "outcome": "passed"}, "call": {"duration": 0.00457281107082963, "outcome": "passed"}, "teardown": {"duration": 0.0005765347741544247, "outcome": "passed"}}, {"nodeid": "tests/automation/test_state_trigger_behavior.py::test_automation_friendly_name", "lineno": 97, "outcome": "failed", "keywords": ["test_automation_friendly_name", "test_state_trigger_behavior.py", "asyncio", "automation", "tests", "marge", ""], "setup": {"duration": 0.00533650116994977, "outcome": "passed"}, "call": {"duration": 0.0029465151019394398, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/automation/test_state_trigger_behavior.py", "lineno": 101, "message": "TypeError: 'NoneType' object is not subscriptable"}, "traceback": [{"path": "tests/automation/test_state_trigger_behavior.py", "lineno": 101, "message": "TypeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0ce8f40>\n\n    async def test_automation_friendly_name(rest):\n        \"\"\"Automation entities have friendly_name from alias.\"\"\"\n        state = await rest.get_state(\"automation.morning_wakeup\")\n>       assert \"friendly_name\" in state[\"attributes\"]\nE       TypeError: 'NoneType' object is not subscriptable\n\ntests/automation/test_state_trigger_behavior.py:101: TypeError"}, "teardown": {"duration": 0.0006327987648546696, "outcome": "passed"}}, {"nodeid": "tests/core/test_concurrent_operations.py::test_concurrent_state_sets", "lineno": 14, "outcome": "passed", "keywords": ["test_concurrent_state_sets", "test_concurrent_operations.py", "asyncio", "core", "tests", "marge", ""], "setup": {"duration": 0.005161762237548828, "outcome": "passed"}, "call": {"duration": 0.06833221996203065, "outcome": "passed"}, "teardown": {"duration": 0.0015193778090178967, "outcome": "passed"}}, {"nodeid": "tests/core/test_concurrent_operations.py::test_concurrent_reads", "lineno": 31, "outcome": "passed", "keywords": ["test_concurrent_reads", "test_concurrent_operations.py", "asyncio", "core", "tests", "marge", ""], "setup": {"duration": 0.005428125150501728, "outcome": "passed"}, "call": {"duration": 0.034330939408391714, "outcome": "passed"}, "teardown": {"duration": 0.0008534840308129787, "outcome": "passed"}}, {"nodeid": "tests/core/test_concurrent_operations.py::test_concurrent_same_entity", "lineno": 45, "outcome": "passed", "keywords": ["test_concurrent_same_entity", "test_concurrent_operations.py", "asyncio", "core", "tests", "marge", ""], "setup": {"duration": 0.0053252060897648335, "outcome": "passed"}, "call": {"duration": 0.03234658110886812, "outcome": "passed"}, "teardown": {"duration": 0.0012490861117839813, "outcome": "passed"}}, {"nodeid": "tests/core/test_concurrent_operations.py::test_concurrent_service_calls", "lineno": 60, "outcome": "failed", "keywords": ["test_concurrent_service_calls", "test_concurrent_operations.py", "asyncio", "core", "tests", "marge", ""], "setup": {"duration": 0.005340849049389362, "outcome": "passed"}, "call": {"duration": 0.03069194220006466, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/core/test_concurrent_operations.py", "lineno": 76, "message": "assert False\n +  where False = all(<generator object test_concurrent_service_calls.<locals>.<genexpr> at 0x7f47b0d7a9e0>)"}, "traceback": [{"path": "tests/core/test_concurrent_operations.py", "lineno": 76, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0f8cd90>\n\n    async def test_concurrent_service_calls(rest):\n        \"\"\"Concurrent service calls all complete.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n    \n        async def call_one(i):\n            eid = f\"light.conc_svc_{tag}_{i}\"\n            await rest.set_state(eid, \"off\")\n            resp = await rest.client.post(\n                f\"{rest.base_url}/api/services/light/turn_on\",\n                json={\"entity_id\": eid},\n                headers=rest._headers(),\n            )\n            return resp.status_code\n    \n        results = await asyncio.gather(*[call_one(i) for i in range(10)])\n>       assert all(r == 200 for r in results)\nE       assert False\nE        +  where False = all(<generator object test_concurrent_service_calls.<locals>.<genexpr> at 0x7f47b0d7a9e0>)\n\ntests/core/test_concurrent_operations.py:76: AssertionError"}, "teardown": {"duration": 0.0012504919432103634, "outcome": "passed"}}, {"nodeid": "tests/core/test_concurrent_operations.py::test_concurrent_mixed_operations", "lineno": 83, "outcome": "passed", "keywords": ["test_concurrent_mixed_operations", "test_concurrent_operations.py", "asyncio", "core", "tests", "marge", ""], "setup": {"duration": 0.0055892588570714, "outcome": "passed"}, "call": {"duration": 0.07234058855101466, "outcome": "passed"}, "teardown": {"duration": 0.000892322976142168, "outcome": "passed"}}, {"nodeid": "tests/core/test_concurrent_operations.py::test_concurrent_get_states", "lineno": 104, "outcome": "passed", "keywords": ["test_concurrent_get_states", "test_concurrent_operations.py", "asyncio", "core", "tests", "marge", ""], "setup": {"duration": 0.005535107105970383, "outcome": "passed"}, "call": {"duration": 0.029710671864449978, "outcome": "passed"}, "teardown": {"duration": 0.0010167770087718964, "outcome": "passed"}}, {"nodeid": "tests/core/test_concurrent_operations.py::test_concurrent_search", "lineno": 119, "outcome": "failed", "keywords": ["test_concurrent_search", "test_concurrent_operations.py", "asyncio", "core", "tests", "marge", ""], "setup": {"duration": 0.00535572087392211, "outcome": "passed"}, "call": {"duration": 0.00871452409774065, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/core/test_concurrent_operations.py", "lineno": 131, "message": "assert 404 == 200\n +  where 404 = <Response [404 Not Found]>.status_code"}, "traceback": [{"path": "tests/core/test_concurrent_operations.py", "lineno": 134, "message": ""}, {"path": "tests/core/test_concurrent_operations.py", "lineno": 131, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b09b6940>\n\n    async def test_concurrent_search(rest):\n        \"\"\"Concurrent search calls all succeed.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        await rest.set_state(f\"sensor.conc_search_{tag}\", \"val\")\n    \n        async def search_one():\n            resp = await rest.client.get(\n                f\"{rest.base_url}/api/states/search\",\n                params={\"q\": f\"conc_search_{tag}\"},\n                headers=rest._headers(),\n            )\n            assert resp.status_code == 200\n            return len(resp.json())\n    \n>       results = await asyncio.gather(*[search_one() for _ in range(10)])\n\ntests/core/test_concurrent_operations.py:134: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\n    async def search_one():\n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/states/search\",\n            params={\"q\": f\"conc_search_{tag}\"},\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 404 == 200\nE        +  where 404 = <Response [404 Not Found]>.status_code\n\ntests/core/test_concurrent_operations.py:131: AssertionError"}, "teardown": {"duration": 0.0012698140926659107, "outcome": "passed"}}, {"nodeid": "tests/core/test_concurrent_operations.py::test_concurrent_template_renders", "lineno": 137, "outcome": "passed", "keywords": ["test_concurrent_template_renders", "test_concurrent_operations.py", "asyncio", "core", "tests", "marge", ""], "setup": {"duration": 0.005228540860116482, "outcome": "passed"}, "call": {"duration": 0.015165131073445082, "outcome": "passed"}, "teardown": {"duration": 0.0008869348093867302, "outcome": "passed"}}, {"nodeid": "tests/core/test_concurrent_state_ops.py::test_concurrent_writes_same_entity", "lineno": 15, "outcome": "passed", "keywords": ["test_concurrent_writes_same_entity", "test_concurrent_state_ops.py", "asyncio", "core", "tests", "marge", ""], "setup": {"duration": 0.006096793804317713, "outcome": "passed"}, "call": {"duration": 0.0182269592769444, "outcome": "passed"}, "teardown": {"duration": 0.0010789791122078896, "outcome": "passed"}}, {"nodeid": "tests/core/test_concurrent_state_ops.py::test_concurrent_writes_different_entities", "lineno": 32, "outcome": "passed", "keywords": ["test_concurrent_writes_different_entities", "test_concurrent_state_ops.py", "asyncio", "core", "tests", "marge", ""], "setup": {"duration": 0.005394108593463898, "outcome": "passed"}, "call": {"duration": 0.06870559928938746, "outcome": "passed"}, "teardown": {"duration": 0.0014148619957268238, "outcome": "passed"}}, {"nodeid": "tests/core/test_concurrent_state_ops.py::test_rapid_state_toggle", "lineno": 50, "outcome": "failed", "keywords": ["test_rapid_state_toggle", "test_concurrent_state_ops.py", "asyncio", "core", "tests", "marge", ""], "setup": {"duration": 0.005638240370899439, "outcome": "passed"}, "call": {"duration": 0.004471045918762684, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/switch/toggle'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/core/test_concurrent_state_ops.py", "lineno": 59, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0caf130>\n\n    async def test_rapid_state_toggle(rest):\n        \"\"\"Rapid on/off toggling produces consistent final state.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"switch.toggle_{tag}\"\n        await rest.set_state(eid, \"off\")\n    \n        # Toggle 20 times sequentially \u2014 final should be \"off\" (even count)\n        for i in range(20):\n>           await rest.call_service(\"switch\", \"toggle\", {\"entity_id\": eid})\n\ntests/core/test_concurrent_state_ops.py:59: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/switch/toggle'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0006668185815215111, "outcome": "passed"}}, {"nodeid": "tests/core/test_concurrent_state_ops.py::test_concurrent_create_delete", "lineno": 64, "outcome": "passed", "keywords": ["test_concurrent_create_delete", "test_concurrent_state_ops.py", "asyncio", "core", "tests", "marge", ""], "setup": {"duration": 0.0057863458059728146, "outcome": "passed"}, "call": {"duration": 0.03789526782929897, "outcome": "passed"}, "teardown": {"duration": 0.0010051201097667217, "outcome": "passed"}}, {"nodeid": "tests/core/test_concurrent_state_ops.py::test_concurrent_attribute_updates", "lineno": 91, "outcome": "passed", "keywords": ["test_concurrent_attribute_updates", "test_concurrent_state_ops.py", "asyncio", "core", "tests", "marge", ""], "setup": {"duration": 0.005235766991972923, "outcome": "passed"}, "call": {"duration": 0.011949540115892887, "outcome": "passed"}, "teardown": {"duration": 0.0006790063343942165, "outcome": "passed"}}, {"nodeid": "tests/core/test_concurrent_state_ops.py::test_many_entities_bulk_create", "lineno": 112, "outcome": "passed", "keywords": ["test_many_entities_bulk_create", "test_concurrent_state_ops.py", "asyncio", "core", "tests", "marge", ""], "setup": {"duration": 0.005374115891754627, "outcome": "passed"}, "call": {"duration": 0.0828375001437962, "outcome": "passed"}, "teardown": {"duration": 0.0013027293607592583, "outcome": "passed"}}, {"nodeid": "tests/core/test_concurrent_state_ops.py::test_concurrent_service_same_entity", "lineno": 128, "outcome": "passed", "keywords": ["test_concurrent_service_same_entity", "test_concurrent_state_ops.py", "asyncio", "core", "tests", "marge", ""], "setup": {"duration": 0.005676839035004377, "outcome": "passed"}, "call": {"duration": 0.01329646771773696, "outcome": "passed"}, "teardown": {"duration": 0.0006955163553357124, "outcome": "passed"}}, {"nodeid": "tests/core/test_mqtt_broker_lifecycle.py::test_broker_accepts_connection", "lineno": 27, "outcome": "passed", "keywords": ["test_broker_accepts_connection", "test_mqtt_broker_lifecycle.py", "asyncio", "core", "tests", "marge", ""], "setup": {"duration": 0.0004024151712656021, "outcome": "passed"}, "call": {"duration": 0.0008275089785456657, "outcome": "passed"}, "teardown": {"duration": 0.00023835711181163788, "outcome": "passed"}}, {"nodeid": "tests/core/test_mqtt_broker_lifecycle.py::test_publish_and_subscribe", "lineno": 35, "outcome": "passed", "keywords": ["test_publish_and_subscribe", "test_mqtt_broker_lifecycle.py", "asyncio", "core", "tests", "marge", ""], "setup": {"duration": 0.00034382427111268044, "outcome": "passed"}, "call": {"duration": 2.305055954027921, "outcome": "passed"}, "teardown": {"duration": 0.0003260951489210129, "outcome": "passed"}}, {"nodeid": "tests/core/test_mqtt_broker_lifecycle.py::test_retained_message_delivery", "lineno": 67, "outcome": "passed", "keywords": ["test_retained_message_delivery", "test_mqtt_broker_lifecycle.py", "asyncio", "core", "tests", "marge", ""], "setup": {"duration": 0.00039096828550100327, "outcome": "passed"}, "call": {"duration": 2.0049134590663016, "outcome": "passed"}, "teardown": {"duration": 0.0003927340731024742, "outcome": "passed"}}, {"nodeid": "tests/core/test_mqtt_broker_lifecycle.py::test_wildcard_subscription", "lineno": 98, "outcome": "passed", "keywords": ["test_wildcard_subscription", "test_mqtt_broker_lifecycle.py", "asyncio", "core", "tests", "marge", ""], "setup": {"duration": 0.0004519438371062279, "outcome": "passed"}, "call": {"duration": 1.345250803977251, "outcome": "passed"}, "teardown": {"duration": 0.00038171326741576195, "outcome": "passed"}}, {"nodeid": "tests/core/test_mqtt_broker_lifecycle.py::test_multiple_clients_concurrent", "lineno": 130, "outcome": "passed", "keywords": ["test_multiple_clients_concurrent", "test_mqtt_broker_lifecycle.py", "asyncio", "core", "tests", "marge", ""], "setup": {"duration": 0.0005169333890080452, "outcome": "passed"}, "call": {"duration": 4.311284150928259, "outcome": "passed"}, "teardown": {"duration": 0.0004654000513255596, "outcome": "passed"}}, {"nodeid": "tests/core/test_mqtt_broker_lifecycle.py::test_home_topic_state_bridge", "lineno": 164, "outcome": "failed", "keywords": ["test_home_topic_state_bridge", "test_mqtt_broker_lifecycle.py", "asyncio", "core", "tests", "marge", ""], "setup": {"duration": 0.008135417010635138, "outcome": "passed"}, "call": {"duration": 1.0065076369792223, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/core/test_mqtt_broker_lifecycle.py", "lineno": 177, "message": "assert None is not None"}, "traceback": [{"path": "tests/core/test_mqtt_broker_lifecycle.py", "lineno": 177, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0b9d070>\n\n    async def test_home_topic_state_bridge(rest):\n        \"\"\"home/domain/id/state topic bridges to entity state.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        c = make_client(\"bridge\")\n        c.connect(MQTT_HOST, MQTT_PORT, keepalive=10)\n        c.loop_start()\n        c.publish(f\"home/sensor/broker_test_{tag}/state\", \"99.5\", retain=True)\n        await asyncio.sleep(0.5)\n        c.loop_stop()\n        c.disconnect()\n    \n        state = await rest.get_state(f\"sensor.broker_test_{tag}\")\n>       assert state is not None\nE       assert None is not None\n\ntests/core/test_mqtt_broker_lifecycle.py:177: AssertionError"}, "teardown": {"duration": 0.0009799632243812084, "outcome": "passed"}}, {"nodeid": "tests/core/test_mqtt_broker_lifecycle.py::test_non_home_topic_no_entity", "lineno": 180, "outcome": "passed", "keywords": ["test_non_home_topic_no_entity", "test_mqtt_broker_lifecycle.py", "asyncio", "core", "tests", "marge", ""], "setup": {"duration": 0.008099433034658432, "outcome": "passed"}, "call": {"duration": 1.006369097623974, "outcome": "passed"}, "teardown": {"duration": 0.0006674230098724365, "outcome": "passed"}}, {"nodeid": "tests/core/test_mqtt_broker_lifecycle.py::test_disconnect_reconnect", "lineno": 195, "outcome": "passed", "keywords": ["test_disconnect_reconnect", "test_mqtt_broker_lifecycle.py", "asyncio", "core", "tests", "marge", ""], "setup": {"duration": 0.0005668820813298225, "outcome": "passed"}, "call": {"duration": 1.2042298531159759, "outcome": "passed"}, "teardown": {"duration": 0.00034139910712838173, "outcome": "passed"}}, {"nodeid": "tests/core/test_mqtt_broker_lifecycle.py::test_json_payload_publish", "lineno": 212, "outcome": "passed", "keywords": ["test_json_payload_publish", "test_mqtt_broker_lifecycle.py", "asyncio", "core", "tests", "marge", ""], "setup": {"duration": 0.0004391283728182316, "outcome": "passed"}, "call": {"duration": 2.305397318210453, "outcome": "passed"}, "teardown": {"duration": 0.00042802002280950546, "outcome": "passed"}}, {"nodeid": "tests/core/test_mqtt_broker_lifecycle.py::test_empty_payload_publish", "lineno": 244, "outcome": "passed", "keywords": ["test_empty_payload_publish", "test_mqtt_broker_lifecycle.py", "asyncio", "core", "tests", "marge", ""], "setup": {"duration": 0.0005242801271378994, "outcome": "passed"}, "call": {"duration": 1.002832586877048, "outcome": "passed"}, "teardown": {"duration": 0.0003756377846002579, "outcome": "passed"}}, {"nodeid": "tests/core/test_multi_entity_service_calls.py::test_service_call_array_entity_ids", "lineno": 14, "outcome": "failed", "keywords": ["test_service_call_array_entity_ids", "test_multi_entity_service_calls.py", "asyncio", "core", "tests", "marge", ""], "setup": {"duration": 0.005130531266331673, "outcome": "passed"}, "call": {"duration": 0.010484916623681784, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/core/test_multi_entity_service_calls.py", "lineno": 27, "message": "assert 400 == 200\n +  where 400 = <Response [400 Bad Request]>.status_code"}, "traceback": [{"path": "tests/core/test_multi_entity_service_calls.py", "lineno": 27, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0c0a610>\n\n    async def test_service_call_array_entity_ids(rest):\n        \"\"\"Service call with entity_id array affects all entities.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eids = [f\"switch.multi_{tag}_{i}\" for i in range(5)]\n        for eid in eids:\n            await rest.set_state(eid, \"off\")\n    \n        resp = await rest.client.post(\n            f\"{rest.base_url}/api/services/switch/turn_on\",\n            json={\"entity_id\": eids},\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 400 == 200\nE        +  where 400 = <Response [400 Bad Request]>.status_code\n\ntests/core/test_multi_entity_service_calls.py:27: AssertionError"}, "teardown": {"duration": 0.0005451198667287827, "outcome": "passed"}}, {"nodeid": "tests/core/test_multi_entity_service_calls.py::test_service_call_single_entity_id_string", "lineno": 33, "outcome": "failed", "keywords": ["test_service_call_single_entity_id_string", "test_multi_entity_service_calls.py", "asyncio", "core", "tests", "marge", ""], "setup": {"duration": 0.005285476800054312, "outcome": "passed"}, "call": {"duration": 0.003879061434417963, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/core/test_multi_entity_service_calls.py", "lineno": 45, "message": "assert 400 == 200\n +  where 400 = <Response [400 Bad Request]>.status_code"}, "traceback": [{"path": "tests/core/test_multi_entity_service_calls.py", "lineno": 45, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0b64880>\n\n    async def test_service_call_single_entity_id_string(rest):\n        \"\"\"Service call with single entity_id string works.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"switch.single_{tag}\"\n        await rest.set_state(eid, \"off\")\n    \n        resp = await rest.client.post(\n            f\"{rest.base_url}/api/services/switch/turn_on\",\n            json={\"entity_id\": eid},\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 400 == 200\nE        +  where 400 = <Response [400 Bad Request]>.status_code\n\ntests/core/test_multi_entity_service_calls.py:45: AssertionError"}, "teardown": {"duration": 0.0006704181432723999, "outcome": "passed"}}, {"nodeid": "tests/core/test_multi_entity_service_calls.py::test_service_call_returns_changed_states", "lineno": 50, "outcome": "failed", "keywords": ["test_service_call_returns_changed_states", "test_multi_entity_service_calls.py", "asyncio", "core", "tests", "marge", ""], "setup": {"duration": 0.005100362002849579, "outcome": "passed"}, "call": {"duration": 0.003992192912846804, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)"}, "traceback": [{"path": "tests/core/test_multi_entity_service_calls.py", "lineno": 62, "message": ""}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 832, "message": "in json"}, {"path": "../../anaconda3/lib/python3.9/json/__init__.py", "lineno": 346, "message": "in loads"}, {"path": "../../anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "JSONDecodeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0bc8760>\n\n    async def test_service_call_returns_changed_states(rest):\n        \"\"\"Service call returns changed entity states.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"light.ret_{tag}\"\n        await rest.set_state(eid, \"off\")\n    \n        resp = await rest.client.post(\n            f\"{rest.base_url}/api/services/light/turn_on\",\n            json={\"entity_id\": eid},\n            headers=rest._headers(),\n        )\n>       data = resp.json()\n\ntests/core/test_multi_entity_service_calls.py:62: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:832: in json\n    return jsonlib.loads(self.content, **kwargs)\n../../anaconda3/lib/python3.9/json/__init__.py:346: in loads\n    return _default_decoder.decode(s)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <json.decoder.JSONDecoder object at 0x7f47b2e5fe50>\ns = '400: Bad Request'\n_w = <built-in method match of re.Pattern object at 0x7f47b3015cf0>\n\n    def decode(self, s, _w=WHITESPACE.match):\n        \"\"\"Return the Python representation of ``s`` (a ``str`` instance\n        containing a JSON document).\n    \n        \"\"\"\n        obj, end = self.raw_decode(s, idx=_w(s, 0).end())\n        end = _w(s, end).end()\n        if end != len(s):\n>           raise JSONDecodeError(\"Extra data\", s, end)\nE           json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)\n\n../../anaconda3/lib/python3.9/json/decoder.py:340: JSONDecodeError"}, "teardown": {"duration": 0.0008713263086974621, "outcome": "passed"}}, {"nodeid": "tests/core/test_multi_entity_service_calls.py::test_service_call_empty_array", "lineno": 68, "outcome": "failed", "keywords": ["test_service_call_empty_array", "test_multi_entity_service_calls.py", "asyncio", "core", "tests", "marge", ""], "setup": {"duration": 0.005418782122433186, "outcome": "passed"}, "call": {"duration": 0.0030752108432352543, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/core/test_multi_entity_service_calls.py", "lineno": 77, "message": "assert 400 == 200\n +  where 400 = <Response [400 Bad Request]>.status_code"}, "traceback": [{"path": "tests/core/test_multi_entity_service_calls.py", "lineno": 77, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b04f73d0>\n\n    async def test_service_call_empty_array(rest):\n        \"\"\"Service call with empty entity_id array returns empty result.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        resp = await rest.client.post(\n            f\"{rest.base_url}/api/services/switch/turn_on\",\n            json={\"entity_id\": []},\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 400 == 200\nE        +  where 400 = <Response [400 Bad Request]>.status_code\n\ntests/core/test_multi_entity_service_calls.py:77: AssertionError"}, "teardown": {"duration": 0.0005545001477003098, "outcome": "passed"}}, {"nodeid": "tests/core/test_multi_entity_service_calls.py::test_service_call_preserves_existing_attributes", "lineno": 82, "outcome": "failed", "keywords": ["test_service_call_preserves_existing_attributes", "test_multi_entity_service_calls.py", "asyncio", "core", "tests", "marge", ""], "setup": {"duration": 0.005327962338924408, "outcome": "passed"}, "call": {"duration": 0.005189522169530392, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/core/test_multi_entity_service_calls.py", "lineno": 96, "message": "AssertionError: assert 'off' == 'on'\n  \n  - on\n  + off"}, "traceback": [{"path": "tests/core/test_multi_entity_service_calls.py", "lineno": 96, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0b1cb20>\n\n    async def test_service_call_preserves_existing_attributes(rest):\n        \"\"\"Service call preserves existing entity attributes.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"light.pres_{tag}\"\n        await rest.set_state(eid, \"off\", {\"friendly_name\": \"My Light\", \"custom\": True})\n    \n        await rest.client.post(\n            f\"{rest.base_url}/api/services/light/turn_on\",\n            json={\"entity_id\": eid, \"brightness\": 200},\n            headers=rest._headers(),\n        )\n    \n        state = await rest.get_state(eid)\n>       assert state[\"state\"] == \"on\"\nE       AssertionError: assert 'off' == 'on'\nE         \nE         - on\nE         + off\n\ntests/core/test_multi_entity_service_calls.py:96: AssertionError"}, "teardown": {"duration": 0.000628237146884203, "outcome": "passed"}}, {"nodeid": "tests/core/test_multi_entity_service_calls.py::test_service_call_no_handler_logs_warning", "lineno": 101, "outcome": "failed", "keywords": ["test_service_call_no_handler_logs_warning", "test_multi_entity_service_calls.py", "asyncio", "core", "tests", "marge", ""], "setup": {"duration": 0.006232861895114183, "outcome": "passed"}, "call": {"duration": 0.004335315898060799, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/core/test_multi_entity_service_calls.py", "lineno": 113, "message": "assert 400 == 200\n +  where 400 = <Response [400 Bad Request]>.status_code"}, "traceback": [{"path": "tests/core/test_multi_entity_service_calls.py", "lineno": 113, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0e286d0>\n\n    async def test_service_call_no_handler_logs_warning(rest):\n        \"\"\"Service call with no handler returns 200 (no state change).\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"sensor.nohandler_{tag}\"\n        await rest.set_state(eid, \"original\")\n    \n        resp = await rest.client.post(\n            f\"{rest.base_url}/api/services/sensor/custom_action\",\n            json={\"entity_id\": eid},\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 400 == 200\nE        +  where 400 = <Response [400 Bad Request]>.status_code\n\ntests/core/test_multi_entity_service_calls.py:113: AssertionError"}, "teardown": {"duration": 0.0004932363517582417, "outcome": "passed"}}, {"nodeid": "tests/core/test_multi_entity_service_calls.py::test_toggle_multiple_entities_mixed_states", "lineno": 119, "outcome": "failed", "keywords": ["test_toggle_multiple_entities_mixed_states", "test_multi_entity_service_calls.py", "asyncio", "core", "tests", "marge", ""], "setup": {"duration": 0.004976642318069935, "outcome": "passed"}, "call": {"duration": 0.0072052329778671265, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/core/test_multi_entity_service_calls.py", "lineno": 136, "message": "AssertionError: assert 'on' == 'off'\n  \n  - off\n  + on"}, "traceback": [{"path": "tests/core/test_multi_entity_service_calls.py", "lineno": 136, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0b5e970>\n\n    async def test_toggle_multiple_entities_mixed_states(rest):\n        \"\"\"Toggle on array with mixed states: each toggles individually.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid1 = f\"switch.mix1_{tag}\"\n        eid2 = f\"switch.mix2_{tag}\"\n        await rest.set_state(eid1, \"on\")\n        await rest.set_state(eid2, \"off\")\n    \n        await rest.client.post(\n            f\"{rest.base_url}/api/services/switch/toggle\",\n            json={\"entity_id\": [eid1, eid2]},\n            headers=rest._headers(),\n        )\n    \n        s1 = await rest.get_state(eid1)\n        s2 = await rest.get_state(eid2)\n>       assert s1[\"state\"] == \"off\"\nE       AssertionError: assert 'on' == 'off'\nE         \nE         - off\nE         + on\n\ntests/core/test_multi_entity_service_calls.py:136: AssertionError"}, "teardown": {"duration": 0.0005398793146014214, "outcome": "passed"}}, {"nodeid": "tests/core/test_multi_entity_service_calls.py::test_service_call_ten_entities", "lineno": 139, "outcome": "failed", "keywords": ["test_service_call_ten_entities", "test_multi_entity_service_calls.py", "asyncio", "core", "tests", "marge", ""], "setup": {"duration": 0.005064698867499828, "outcome": "passed"}, "call": {"duration": 0.01530939806252718, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/core/test_multi_entity_service_calls.py", "lineno": 152, "message": "assert 400 == 200\n +  where 400 = <Response [400 Bad Request]>.status_code"}, "traceback": [{"path": "tests/core/test_multi_entity_service_calls.py", "lineno": 152, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0cf1250>\n\n    async def test_service_call_ten_entities(rest):\n        \"\"\"Service call scales to 10 entities.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eids = [f\"light.scale_{tag}_{i}\" for i in range(10)]\n        for eid in eids:\n            await rest.set_state(eid, \"off\")\n    \n        resp = await rest.client.post(\n            f\"{rest.base_url}/api/services/light/turn_on\",\n            json={\"entity_id\": eids},\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 400 == 200\nE        +  where 400 = <Response [400 Bad Request]>.status_code\n\ntests/core/test_multi_entity_service_calls.py:152: AssertionError"}, "teardown": {"duration": 0.0005374187603592873, "outcome": "passed"}}, {"nodeid": "tests/core/test_service_registry_consistency.py::test_services_list_is_array", "lineno": 14, "outcome": "passed", "keywords": ["test_services_list_is_array", "test_service_registry_consistency.py", "asyncio", "core", "tests", "marge", ""], "setup": {"duration": 0.0050696879625320435, "outcome": "passed"}, "call": {"duration": 0.006727851927280426, "outcome": "passed"}, "teardown": {"duration": 0.0005103652365505695, "outcome": "passed"}}, {"nodeid": "tests/core/test_service_registry_consistency.py::test_services_list_has_domains", "lineno": 25, "outcome": "failed", "keywords": ["test_services_list_has_domains", "test_service_registry_consistency.py", "asyncio", "core", "tests", "marge", ""], "setup": {"duration": 0.005317477975040674, "outcome": "passed"}, "call": {"duration": 0.004491141997277737, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/core/test_service_registry_consistency.py", "lineno": 35, "message": "AssertionError: Missing domain: light\nassert 'light' in ['homeassistant', 'persistent_notification', 'logger', 'system_log', 'person', 'frontend', ...]"}, "traceback": [{"path": "tests/core/test_service_registry_consistency.py", "lineno": 35, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0bb94f0>\n\n    async def test_services_list_has_domains(rest):\n        \"\"\"Service listing includes core domains.\"\"\"\n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/services\",\n            headers=rest._headers(),\n        )\n        data = resp.json()\n        domains = [entry[\"domain\"] for entry in data]\n        for expected in [\"light\", \"switch\", \"lock\", \"climate\", \"cover\", \"fan\"]:\n>           assert expected in domains, f\"Missing domain: {expected}\"\nE           AssertionError: Missing domain: light\nE           assert 'light' in ['homeassistant', 'persistent_notification', 'logger', 'system_log', 'person', 'frontend', ...]\n\ntests/core/test_service_registry_consistency.py:35: AssertionError"}, "teardown": {"duration": 0.0005117878317832947, "outcome": "passed"}}, {"nodeid": "tests/core/test_service_registry_consistency.py::test_services_entry_has_services_map", "lineno": 37, "outcome": "passed", "keywords": ["test_services_entry_has_services_map", "test_service_registry_consistency.py", "asyncio", "core", "tests", "marge", ""], "setup": {"duration": 0.0051240697503089905, "outcome": "passed"}, "call": {"duration": 0.002959711942821741, "outcome": "passed"}, "teardown": {"duration": 0.00047626206651329994, "outcome": "passed"}}, {"nodeid": "tests/core/test_service_registry_consistency.py::test_light_services_registered", "lineno": 50, "outcome": "failed", "keywords": ["test_light_services_registered", "test_service_registry_consistency.py", "asyncio", "core", "tests", "marge", ""], "setup": {"duration": 0.005074267741292715, "outcome": "passed"}, "call": {"duration": 0.002874258905649185, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/asyncio/base_events.py", "lineno": 647, "message": "RuntimeError: coroutine raised StopIteration"}, "traceback": [{"path": "../../anaconda3/lib/python3.9/site-packages/pytest_asyncio/plugin.py", "lineno": 440, "message": ""}, {"path": "../../anaconda3/lib/python3.9/site-packages/pytest_asyncio/plugin.py", "lineno": 906, "message": "in inner"}, {"path": "../../anaconda3/lib/python3.9/asyncio/base_events.py", "lineno": 647, "message": "RuntimeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0b2cac0>\n\n    async def test_light_services_registered(rest):\n        \"\"\"Light domain has turn_on, turn_off, toggle services.\"\"\"\n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/services\",\n            headers=rest._headers(),\n        )\n        data = resp.json()\n>       light_entry = next(e for e in data if e[\"domain\"] == \"light\")\nE       StopIteration\n\ntests/core/test_service_registry_consistency.py:58: StopIteration\n\nThe above exception was the direct cause of the following exception:\n\nself = <Coroutine test_light_services_registered>\n\n    def runtest(self) -> None:\n        self.obj = wrap_in_sync(\n            # https://github.com/pytest-dev/pytest-asyncio/issues/596\n            self.obj,  # type: ignore[has-type]\n        )\n>       super().runtest()\n\n../../anaconda3/lib/python3.9/site-packages/pytest_asyncio/plugin.py:440: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/pytest_asyncio/plugin.py:906: in inner\n    _loop.run_until_complete(task)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <_UnixSelectorEventLoop running=False closed=False debug=False>\nfuture = <Task finished name='Task-4830' coro=<test_light_services_registered() done, defined at /home/jcrigby/fun/marge/tests/core/test_service_registry_consistency.py:51> exception=RuntimeError('coroutine raised StopIteration')>\n\n    def run_until_complete(self, future):\n        \"\"\"Run until the Future is done.\n    \n        If the argument is a coroutine, it is wrapped in a Task.\n    \n        WARNING: It would be disastrous to call run_until_complete()\n        with the same coroutine twice -- it would wrap it in two\n        different Tasks and that can't be good.\n    \n        Return the Future's result, or raise its exception.\n        \"\"\"\n        self._check_closed()\n        self._check_running()\n    \n        new_task = not futures.isfuture(future)\n        future = tasks.ensure_future(future, loop=self)\n        if new_task:\n            # An exception is raised if the future didn't complete, so there\n            # is no need to log the \"destroy pending task\" message\n            future._log_destroy_pending = False\n    \n        future.add_done_callback(_run_until_complete_cb)\n        try:\n            self.run_forever()\n        except:\n            if new_task and future.done() and not future.cancelled():\n                # The coroutine raised a BaseException. Consume the exception\n                # to not log a warning, the caller doesn't have access to the\n                # local task.\n                future.exception()\n            raise\n        finally:\n            future.remove_done_callback(_run_until_complete_cb)\n        if not future.done():\n            raise RuntimeError('Event loop stopped before Future completed.')\n    \n>       return future.result()\nE       RuntimeError: coroutine raised StopIteration\n\n../../anaconda3/lib/python3.9/asyncio/base_events.py:647: RuntimeError"}, "teardown": {"duration": 0.0007217810489237309, "outcome": "passed"}}, {"nodeid": "tests/core/test_service_registry_consistency.py::test_climate_services_registered", "lineno": 64, "outcome": "failed", "keywords": ["test_climate_services_registered", "test_service_registry_consistency.py", "asyncio", "core", "tests", "marge", ""], "setup": {"duration": 0.00540551682934165, "outcome": "passed"}, "call": {"duration": 0.0032507912255823612, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/asyncio/base_events.py", "lineno": 647, "message": "RuntimeError: coroutine raised StopIteration"}, "traceback": [{"path": "../../anaconda3/lib/python3.9/site-packages/pytest_asyncio/plugin.py", "lineno": 440, "message": ""}, {"path": "../../anaconda3/lib/python3.9/site-packages/pytest_asyncio/plugin.py", "lineno": 906, "message": "in inner"}, {"path": "../../anaconda3/lib/python3.9/asyncio/base_events.py", "lineno": 647, "message": "RuntimeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0b990d0>\n\n    async def test_climate_services_registered(rest):\n        \"\"\"Climate domain has set_temperature, set_hvac_mode, etc.\"\"\"\n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/services\",\n            headers=rest._headers(),\n        )\n        data = resp.json()\n>       climate_entry = next(e for e in data if e[\"domain\"] == \"climate\")\nE       StopIteration\n\ntests/core/test_service_registry_consistency.py:72: StopIteration\n\nThe above exception was the direct cause of the following exception:\n\nself = <Coroutine test_climate_services_registered>\n\n    def runtest(self) -> None:\n        self.obj = wrap_in_sync(\n            # https://github.com/pytest-dev/pytest-asyncio/issues/596\n            self.obj,  # type: ignore[has-type]\n        )\n>       super().runtest()\n\n../../anaconda3/lib/python3.9/site-packages/pytest_asyncio/plugin.py:440: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/pytest_asyncio/plugin.py:906: in inner\n    _loop.run_until_complete(task)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <_UnixSelectorEventLoop running=False closed=False debug=False>\nfuture = <Task finished name='Task-4834' coro=<test_climate_services_registered() done, defined at /home/jcrigby/fun/marge/tests/core/test_service_registry_consistency.py:65> exception=RuntimeError('coroutine raised StopIteration')>\n\n    def run_until_complete(self, future):\n        \"\"\"Run until the Future is done.\n    \n        If the argument is a coroutine, it is wrapped in a Task.\n    \n        WARNING: It would be disastrous to call run_until_complete()\n        with the same coroutine twice -- it would wrap it in two\n        different Tasks and that can't be good.\n    \n        Return the Future's result, or raise its exception.\n        \"\"\"\n        self._check_closed()\n        self._check_running()\n    \n        new_task = not futures.isfuture(future)\n        future = tasks.ensure_future(future, loop=self)\n        if new_task:\n            # An exception is raised if the future didn't complete, so there\n            # is no need to log the \"destroy pending task\" message\n            future._log_destroy_pending = False\n    \n        future.add_done_callback(_run_until_complete_cb)\n        try:\n            self.run_forever()\n        except:\n            if new_task and future.done() and not future.cancelled():\n                # The coroutine raised a BaseException. Consume the exception\n                # to not log a warning, the caller doesn't have access to the\n                # local task.\n                future.exception()\n            raise\n        finally:\n            future.remove_done_callback(_run_until_complete_cb)\n        if not future.done():\n            raise RuntimeError('Event loop stopped before Future completed.')\n    \n>       return future.result()\nE       RuntimeError: coroutine raised StopIteration\n\n../../anaconda3/lib/python3.9/asyncio/base_events.py:647: RuntimeError"}, "teardown": {"duration": 0.000772200059145689, "outcome": "passed"}}, {"nodeid": "tests/core/test_service_registry_consistency.py::test_service_entry_has_description", "lineno": 77, "outcome": "passed", "keywords": ["test_service_entry_has_description", "test_service_registry_consistency.py", "asyncio", "core", "tests", "marge", ""], "setup": {"duration": 0.005776636768132448, "outcome": "passed"}, "call": {"duration": 0.003330392297357321, "outcome": "passed"}, "teardown": {"duration": 0.0004900950007140636, "outcome": "passed"}}, {"nodeid": "tests/core/test_service_registry_consistency.py::test_fallback_turn_on_unknown_domain", "lineno": 89, "outcome": "failed", "keywords": ["test_fallback_turn_on_unknown_domain", "test_service_registry_consistency.py", "asyncio", "core", "tests", "marge", ""], "setup": {"duration": 0.00522678392007947, "outcome": "passed"}, "call": {"duration": 0.0044477637857198715, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/custom_domain/turn_on'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/core/test_service_registry_consistency.py", "lineno": 96, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0b99760>\n\n    async def test_fallback_turn_on_unknown_domain(rest):\n        \"\"\"Unknown domain with turn_on falls back to generic handler.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"custom_domain.fb_{tag}\"\n        await rest.set_state(eid, \"off\")\n    \n>       await rest.call_service(\"custom_domain\", \"turn_on\", {\"entity_id\": eid})\n\ntests/core/test_service_registry_consistency.py:96: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/custom_domain/turn_on'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0006557190790772438, "outcome": "passed"}}, {"nodeid": "tests/core/test_service_registry_consistency.py::test_fallback_turn_off_unknown_domain", "lineno": 101, "outcome": "failed", "keywords": ["test_fallback_turn_off_unknown_domain", "test_service_registry_consistency.py", "asyncio", "core", "tests", "marge", ""], "setup": {"duration": 0.0052755530923604965, "outcome": "passed"}, "call": {"duration": 0.005421895999461412, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/custom_domain/turn_off'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/core/test_service_registry_consistency.py", "lineno": 108, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0de3880>\n\n    async def test_fallback_turn_off_unknown_domain(rest):\n        \"\"\"Unknown domain with turn_off falls back to generic handler.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"custom_domain.fboff_{tag}\"\n        await rest.set_state(eid, \"on\")\n    \n>       await rest.call_service(\"custom_domain\", \"turn_off\", {\"entity_id\": eid})\n\ntests/core/test_service_registry_consistency.py:108: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/custom_domain/turn_off'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0010176938958466053, "outcome": "passed"}}, {"nodeid": "tests/core/test_service_registry_consistency.py::test_fallback_toggle_unknown_domain", "lineno": 113, "outcome": "failed", "keywords": ["test_fallback_toggle_unknown_domain", "test_service_registry_consistency.py", "asyncio", "core", "tests", "marge", ""], "setup": {"duration": 0.006967199966311455, "outcome": "passed"}, "call": {"duration": 0.005256001837551594, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/custom_domain/toggle'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/core/test_service_registry_consistency.py", "lineno": 120, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0b58820>\n\n    async def test_fallback_toggle_unknown_domain(rest):\n        \"\"\"Unknown domain with toggle falls back to generic handler.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"custom_domain.fbtog_{tag}\"\n        await rest.set_state(eid, \"on\")\n    \n>       await rest.call_service(\"custom_domain\", \"toggle\", {\"entity_id\": eid})\n\ntests/core/test_service_registry_consistency.py:120: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/custom_domain/toggle'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0007105311378836632, "outcome": "passed"}}, {"nodeid": "tests/core/test_service_registry_consistency.py::test_unknown_service_no_crash", "lineno": 125, "outcome": "failed", "keywords": ["test_unknown_service_no_crash", "test_service_registry_consistency.py", "asyncio", "core", "tests", "marge", ""], "setup": {"duration": 0.005075175780802965, "outcome": "passed"}, "call": {"duration": 0.0027121813036501408, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/core/test_service_registry_consistency.py", "lineno": 134, "message": "assert 400 == 200\n +  where 400 = <Response [400 Bad Request]>.status_code"}, "traceback": [{"path": "tests/core/test_service_registry_consistency.py", "lineno": 134, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0fe53a0>\n\n    async def test_unknown_service_no_crash(rest):\n        \"\"\"Unknown service on unknown domain returns 200 (no crash).\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        resp = await rest.client.post(\n            f\"{rest.base_url}/api/services/fake_domain_{tag}/fake_service_{tag}\",\n            json={\"entity_id\": \"sensor.doesnt_matter\"},\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 400 == 200\nE        +  where 400 = <Response [400 Bad Request]>.status_code\n\ntests/core/test_service_registry_consistency.py:134: AssertionError"}, "teardown": {"duration": 0.0005928068421781063, "outcome": "passed"}}, {"nodeid": "tests/core/test_service_registry_consistency.py::test_service_call_empty_entity_list", "lineno": 136, "outcome": "failed", "keywords": ["test_service_call_empty_entity_list", "test_service_registry_consistency.py", "asyncio", "core", "tests", "marge", ""], "setup": {"duration": 0.005108613986521959, "outcome": "passed"}, "call": {"duration": 0.002759410999715328, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/core/test_service_registry_consistency.py", "lineno": 144, "message": "assert 400 == 200\n +  where 400 = <Response [400 Bad Request]>.status_code"}, "traceback": [{"path": "tests/core/test_service_registry_consistency.py", "lineno": 144, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0fe52e0>\n\n    async def test_service_call_empty_entity_list(rest):\n        \"\"\"Service call with no entity_id returns 200 with empty result.\"\"\"\n        resp = await rest.client.post(\n            f\"{rest.base_url}/api/services/light/turn_on\",\n            json={},\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 400 == 200\nE        +  where 400 = <Response [400 Bad Request]>.status_code\n\ntests/core/test_service_registry_consistency.py:144: AssertionError"}, "teardown": {"duration": 0.0005451343022286892, "outcome": "passed"}}, {"nodeid": "tests/core/test_service_registry_consistency.py::test_rest_and_ws_services_match", "lineno": 146, "outcome": "failed", "keywords": ["test_rest_and_ws_services_match", "test_service_registry_consistency.py", "asyncio", "core", "tests", "marge", ""], "setup": {"duration": 0.008186275139451027, "outcome": "passed"}, "call": {"duration": 0.004338924773037434, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/core/test_service_registry_consistency.py", "lineno": 156, "message": "TypeError: string indices must be integers"}, "traceback": [{"path": "tests/core/test_service_registry_consistency.py", "lineno": 156, "message": ""}, {"path": "tests/core/test_service_registry_consistency.py", "lineno": 156, "message": "TypeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0510b50>\nws = <conftest.WSClient object at 0x7f47b0bc9c10>\n\n    async def test_rest_and_ws_services_match(rest, ws):\n        \"\"\"REST /api/services and WS get_services return same domains.\"\"\"\n        rest_resp = await rest.client.get(\n            f\"{rest.base_url}/api/services\",\n            headers=rest._headers(),\n        )\n        rest_domains = sorted(e[\"domain\"] for e in rest_resp.json())\n    \n        ws_resp = await ws.send_command(\"get_services\")\n>       ws_domains = sorted(e[\"domain\"] for e in ws_resp[\"result\"])\n\ntests/core/test_service_registry_consistency.py:156: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\n.0 = <dict_keyiterator object at 0x7f47b0c38d60>\n\n>   ws_domains = sorted(e[\"domain\"] for e in ws_resp[\"result\"])\nE   TypeError: string indices must be integers\n\ntests/core/test_service_registry_consistency.py:156: TypeError"}, "teardown": {"duration": 0.0012306291610002518, "outcome": "passed"}}, {"nodeid": "tests/core/test_service_registry_consistency.py::test_services_sorted_by_domain", "lineno": 160, "outcome": "failed", "keywords": ["test_services_sorted_by_domain", "test_service_registry_consistency.py", "asyncio", "core", "tests", "marge", ""], "setup": {"duration": 0.005368580110371113, "outcome": "passed"}, "call": {"duration": 0.0033795046620070934, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/core/test_service_registry_consistency.py", "lineno": 169, "message": "AssertionError: assert ['homeassista...rontend', ...] == ['automation'...rontend', ...]\n  \n  At index 0 diff: 'homeassistant' != 'automation'\n  Use -v to get more diff"}, "traceback": [{"path": "tests/core/test_service_registry_consistency.py", "lineno": 169, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0b9cdc0>\n\n    async def test_services_sorted_by_domain(rest):\n        \"\"\"Service listing domains are in alphabetical order.\"\"\"\n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/services\",\n            headers=rest._headers(),\n        )\n        data = resp.json()\n        domains = [e[\"domain\"] for e in data]\n>       assert domains == sorted(domains)\nE       AssertionError: assert ['homeassista...rontend', ...] == ['automation'...rontend', ...]\nE         \nE         At index 0 diff: 'homeassistant' != 'automation'\nE         Use -v to get more diff\n\ntests/core/test_service_registry_consistency.py:169: AssertionError"}, "teardown": {"duration": 0.0006413199007511139, "outcome": "passed"}}, {"nodeid": "tests/core/test_state_delete_recreate.py::test_delete_entity_returns_200", "lineno": 14, "outcome": "passed", "keywords": ["test_delete_entity_returns_200", "test_state_delete_recreate.py", "asyncio", "core", "tests", "marge", ""], "setup": {"duration": 0.005259343888610601, "outcome": "passed"}, "call": {"duration": 0.0036138552241027355, "outcome": "passed"}, "teardown": {"duration": 0.000466126948595047, "outcome": "passed"}}, {"nodeid": "tests/core/test_state_delete_recreate.py::test_deleted_entity_gone_from_list", "lineno": 27, "outcome": "passed", "keywords": ["test_deleted_entity_gone_from_list", "test_state_delete_recreate.py", "asyncio", "core", "tests", "marge", ""], "setup": {"duration": 0.005764469970017672, "outcome": "passed"}, "call": {"duration": 0.00839164201170206, "outcome": "passed"}, "teardown": {"duration": 0.00047176191583275795, "outcome": "passed"}}, {"nodeid": "tests/core/test_state_delete_recreate.py::test_get_nonexistent_entity_404", "lineno": 46, "outcome": "passed", "keywords": ["test_get_nonexistent_entity_404", "test_state_delete_recreate.py", "asyncio", "core", "tests", "marge", ""], "setup": {"duration": 0.005531827919185162, "outcome": "passed"}, "call": {"duration": 0.0024675861932337284, "outcome": "passed"}, "teardown": {"duration": 0.0004459521733224392, "outcome": "passed"}}, {"nodeid": "tests/core/test_state_delete_recreate.py::test_recreate_after_delete", "lineno": 55, "outcome": "passed", "keywords": ["test_recreate_after_delete", "test_state_delete_recreate.py", "asyncio", "core", "tests", "marge", ""], "setup": {"duration": 0.005148663185536861, "outcome": "passed"}, "call": {"duration": 0.007414311170578003, "outcome": "passed"}, "teardown": {"duration": 0.0005812118761241436, "outcome": "passed"}}, {"nodeid": "tests/core/test_state_delete_recreate.py::test_recreated_entity_fresh_context", "lineno": 71, "outcome": "passed", "keywords": ["test_recreated_entity_fresh_context", "test_state_delete_recreate.py", "asyncio", "core", "tests", "marge", ""], "setup": {"duration": 0.005757583770900965, "outcome": "passed"}, "call": {"duration": 0.007177412044256926, "outcome": "passed"}, "teardown": {"duration": 0.0005943658761680126, "outcome": "passed"}}, {"nodeid": "tests/core/test_state_delete_recreate.py::test_delete_preserves_other_entities", "lineno": 92, "outcome": "passed", "keywords": ["test_delete_preserves_other_entities", "test_state_delete_recreate.py", "asyncio", "core", "tests", "marge", ""], "setup": {"duration": 0.0053849369287490845, "outcome": "passed"}, "call": {"duration": 0.007234421093016863, "outcome": "passed"}, "teardown": {"duration": 0.0005155936814844608, "outcome": "passed"}}, {"nodeid": "tests/core/test_state_delete_recreate.py::test_delete_entity_with_attributes", "lineno": 110, "outcome": "passed", "keywords": ["test_delete_entity_with_attributes", "test_state_delete_recreate.py", "asyncio", "core", "tests", "marge", ""], "setup": {"duration": 0.006069845054298639, "outcome": "passed"}, "call": {"duration": 0.004881309345364571, "outcome": "passed"}, "teardown": {"duration": 0.0004892442375421524, "outcome": "passed"}}, {"nodeid": "tests/core/test_state_delete_recreate.py::test_recreated_entity_starts_clean", "lineno": 129, "outcome": "passed", "keywords": ["test_recreated_entity_starts_clean", "test_state_delete_recreate.py", "asyncio", "core", "tests", "marge", ""], "setup": {"duration": 0.005189309362322092, "outcome": "passed"}, "call": {"duration": 0.009415330830961466, "outcome": "passed"}, "teardown": {"duration": 0.0004964089021086693, "outcome": "passed"}}, {"nodeid": "tests/core/test_state_delete_recreate.py::test_multiple_deletes_idempotent", "lineno": 146, "outcome": "passed", "keywords": ["test_multiple_deletes_idempotent", "test_state_delete_recreate.py", "asyncio", "core", "tests", "marge", ""], "setup": {"duration": 0.005503139924257994, "outcome": "passed"}, "call": {"duration": 0.004902567248791456, "outcome": "passed"}, "teardown": {"duration": 0.0005020489916205406, "outcome": "passed"}}, {"nodeid": "tests/core/test_state_machine.py::test_api_running", "lineno": 17, "outcome": "passed", "keywords": ["test_api_running", "test_state_machine.py", "asyncio", "core", "tests", "marge", ""], "setup": {"duration": 0.005232772324234247, "outcome": "passed"}, "call": {"duration": 0.002317719627171755, "outcome": "passed"}, "teardown": {"duration": 0.0004493091255426407, "outcome": "passed"}}, {"nodeid": "tests/core/test_state_machine.py::test_get_states_returns_list", "lineno": 23, "outcome": "passed", "keywords": ["test_get_states_returns_list", "test_state_machine.py", "asyncio", "core", "tests", "marge", ""], "setup": {"duration": 0.005238387268036604, "outcome": "passed"}, "call": {"duration": 0.0075894808396697044, "outcome": "passed"}, "teardown": {"duration": 0.0005101398564875126, "outcome": "passed"}}, {"nodeid": "tests/core/test_state_machine.py::test_set_and_get_state", "lineno": 29, "outcome": "passed", "keywords": ["test_set_and_get_state", "test_state_machine.py", "asyncio", "core", "tests", "marge", ""], "setup": {"duration": 0.00557371973991394, "outcome": "passed"}, "call": {"duration": 0.004007865209132433, "outcome": "passed"}, "teardown": {"duration": 0.0005074446089565754, "outcome": "passed"}}, {"nodeid": "tests/core/test_state_machine.py::test_set_state_creates_entity", "lineno": 42, "outcome": "passed", "keywords": ["test_set_state_creates_entity", "test_state_machine.py", "asyncio", "core", "tests", "marge", ""], "setup": {"duration": 0.005245100241154432, "outcome": "passed"}, "call": {"duration": 0.0025202720426023006, "outcome": "passed"}, "teardown": {"duration": 0.000453287735581398, "outcome": "passed"}}, {"nodeid": "tests/core/test_state_machine.py::test_set_state_updates_existing", "lineno": 50, "outcome": "passed", "keywords": ["test_set_state_updates_existing", "test_state_machine.py", "asyncio", "core", "tests", "marge", ""], "setup": {"duration": 0.005260962061583996, "outcome": "passed"}, "call": {"duration": 0.006224196869879961, "outcome": "passed"}, "teardown": {"duration": 0.0004949141293764114, "outcome": "passed"}}, {"nodeid": "tests/core/test_state_machine.py::test_get_nonexistent_returns_404", "lineno": 58, "outcome": "passed", "keywords": ["test_get_nonexistent_returns_404", "test_state_machine.py", "asyncio", "core", "tests", "marge", ""], "setup": {"duration": 0.00550978584215045, "outcome": "passed"}, "call": {"duration": 0.0026442110538482666, "outcome": "passed"}, "teardown": {"duration": 0.0005021411925554276, "outcome": "passed"}}, {"nodeid": "tests/core/test_state_machine.py::test_state_has_timestamps", "lineno": 64, "outcome": "passed", "keywords": ["test_state_has_timestamps", "test_state_machine.py", "asyncio", "core", "tests", "marge", ""], "setup": {"duration": 0.005301246885210276, "outcome": "passed"}, "call": {"duration": 0.002645143773406744, "outcome": "passed"}, "teardown": {"duration": 0.00046619679778814316, "outcome": "passed"}}, {"nodeid": "tests/core/test_state_machine.py::test_last_changed_updates_on_value_change", "lineno": 73, "outcome": "passed", "keywords": ["test_last_changed_updates_on_value_change", "test_state_machine.py", "asyncio", "core", "tests", "marge", ""], "setup": {"duration": 0.0051489719189703465, "outcome": "passed"}, "call": {"duration": 0.05766442231833935, "outcome": "passed"}, "teardown": {"duration": 0.0005442257970571518, "outcome": "passed"}}, {"nodeid": "tests/core/test_state_machine.py::test_last_changed_stable_on_same_value", "lineno": 87, "outcome": "passed", "keywords": ["test_last_changed_stable_on_same_value", "test_state_machine.py", "asyncio", "core", "tests", "marge", ""], "setup": {"duration": 0.005593291949480772, "outcome": "passed"}, "call": {"duration": 0.054843203630298376, "outcome": "passed"}, "teardown": {"duration": 0.0007997080683708191, "outcome": "passed"}}, {"nodeid": "tests/core/test_state_machine.py::test_last_updated_changes_on_attribute_change", "lineno": 100, "outcome": "passed", "keywords": ["test_last_updated_changes_on_attribute_change", "test_state_machine.py", "asyncio", "core", "tests", "marge", ""], "setup": {"duration": 0.0055955545976758, "outcome": "passed"}, "call": {"duration": 0.054921716917306185, "outcome": "passed"}, "teardown": {"duration": 0.0005140849389135838, "outcome": "passed"}}, {"nodeid": "tests/core/test_state_machine.py::test_context_id_unique_per_update", "lineno": 113, "outcome": "passed", "keywords": ["test_context_id_unique_per_update", "test_state_machine.py", "asyncio", "core", "tests", "marge", ""], "setup": {"duration": 0.005299326963722706, "outcome": "passed"}, "call": {"duration": 0.009009539149701595, "outcome": "passed"}, "teardown": {"duration": 0.00048763398081064224, "outcome": "passed"}}, {"nodeid": "tests/core/test_state_machine.py::test_empty_attributes_default", "lineno": 121, "outcome": "passed", "keywords": ["test_empty_attributes_default", "test_state_machine.py", "asyncio", "core", "tests", "marge", ""], "setup": {"duration": 0.00562902819365263, "outcome": "passed"}, "call": {"duration": 0.0027550142258405685, "outcome": "passed"}, "teardown": {"duration": 0.00049990089610219, "outcome": "passed"}}, {"nodeid": "tests/core/test_state_machine.py::test_attributes_merge_replaced", "lineno": 128, "outcome": "passed", "keywords": ["test_attributes_merge_replaced", "test_state_machine.py", "asyncio", "core", "tests", "marge", ""], "setup": {"duration": 0.005149125121533871, "outcome": "passed"}, "call": {"duration": 0.003665382042527199, "outcome": "passed"}, "teardown": {"duration": 0.0005394080653786659, "outcome": "passed"}}, {"nodeid": "tests/core/test_state_machine.py::test_entity_id_format", "lineno": 137, "outcome": "passed", "keywords": ["test_entity_id_format", "test_state_machine.py", "asyncio", "core", "tests", "marge", ""], "setup": {"duration": 0.00533102685585618, "outcome": "passed"}, "call": {"duration": 0.005608914885669947, "outcome": "passed"}, "teardown": {"duration": 0.0005634631961584091, "outcome": "passed"}}, {"nodeid": "tests/core/test_state_machine.py::test_state_is_string", "lineno": 144, "outcome": "passed", "keywords": ["test_state_is_string", "test_state_machine.py", "asyncio", "core", "tests", "marge", ""], "setup": {"duration": 0.005202895030379295, "outcome": "passed"}, "call": {"duration": 0.002651473041623831, "outcome": "passed"}, "teardown": {"duration": 0.0005185948684811592, "outcome": "passed"}}, {"nodeid": "tests/core/test_state_machine.py::test_concurrent_writes", "lineno": 152, "outcome": "passed", "keywords": ["test_concurrent_writes", "test_state_machine.py", "asyncio", "core", "tests", "marge", ""], "setup": {"duration": 0.005170556250959635, "outcome": "passed"}, "call": {"duration": 0.01625382760539651, "outcome": "passed"}, "teardown": {"duration": 0.0009704297408461571, "outcome": "passed"}}, {"nodeid": "tests/core/test_state_machine_edge_cases.py::test_state_value_edge_cases[-empty]", "lineno": 18, "outcome": "passed", "keywords": ["test_state_value_edge_cases[-empty]", "parametrize", "pytestmark", "-empty", "test_state_machine_edge_cases.py", "asyncio", "core", "tests", "marge", ""], "setup": {"duration": 0.0057266768999397755, "outcome": "passed"}, "call": {"duration": 0.0036388346925377846, "outcome": "passed"}, "teardown": {"duration": 0.0005626948550343513, "outcome": "passed"}}, {"nodeid": "tests/core/test_state_machine_edge_cases.py::test_state_value_edge_cases[42.5-numeric]", "lineno": 18, "outcome": "passed", "keywords": ["test_state_value_edge_cases[42.5-numeric]", "parametrize", "pytestmark", "42.5-numeric", "test_state_machine_edge_cases.py", "asyncio", "core", "tests", "marge", ""], "setup": {"duration": 0.005242558661848307, "outcome": "passed"}, "call": {"duration": 0.00349314883351326, "outcome": "passed"}, "teardown": {"duration": 0.0005632219836115837, "outcome": "passed"}}, {"nodeid": "tests/core/test_state_machine_edge_cases.py::test_state_value_edge_cases[xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx-long]", "lineno": 18, "outcome": "failed", "keywords": ["test_state_value_edge_cases[xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx-long]", "parametrize", "pytestmark", "xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx-long", "test_state_machine_edge_cases.py", "asyncio", "core", "tests", "marge", ""], "setup": {"duration": 0.005479597020894289, "outcome": "passed"}, "call": {"duration": 0.005901791155338287, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/states/sensor.edge_long_a3a30d2c'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/core/test_state_machine_edge_cases.py", "lineno": 40, "message": ""}, {"path": "tests/conftest.py", "lineno": 94, "message": "in set_state"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0b79520>\nstate_val = 'xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx...xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx'\nlabel = 'long'\n\n    @pytest.mark.parametrize(\"state_val,label\", [\n        (\"\", \"empty\"),\n        (\"42.5\", \"numeric\"),\n        (\"x\" * 1000, \"long\"),\n        (\"x\" * 10000, \"very_long\"),\n        (\"23\u00b0C with wind\", \"unicode\"),\n        (\"\\u6e29\\u5ea6\", \"cjk\"),\n        (\"on/off <test> & 'value'\", \"special_chars\"),\n        ('He said \"hello\"', \"quotes\"),\n        (\"line1\\nline2\", \"newlines\"),\n        (\"path\\\\to\\\\file\", \"backslashes\"),\n        (\"-273.15\", \"negative\"),\n        (\"1.23e10\", \"scientific\"),\n        (\"   \", \"whitespace\"),\n        (\"x\", \"single_char\"),\n        (\"0\", \"zero\"),\n    ])\n    async def test_state_value_edge_cases(rest, state_val, label):\n        \"\"\"State machine correctly stores edge-case state values.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"sensor.edge_{label}_{tag}\"\n>       await rest.set_state(eid, state_val)\n\ntests/core/test_state_machine_edge_cases.py:40: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:94: in set_state\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/states/sensor.edge_long_a3a30d2c'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0006824731826782227, "outcome": "passed"}}, {"nodeid": "tests/core/test_state_machine_edge_cases.py::test_state_value_edge_cases[xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx-very_long]", "lineno": 18, "outcome": "failed", "keywords": ["test_state_value_edge_cases[xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx-very_long]", "parametrize", "pytestmark", "xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx-very_long", "test_state_machine_edge_cases.py", "asyncio", "core", "tests", "marge", ""], "setup": {"duration": 0.006607993971556425, "outcome": "passed"}, "call": {"duration": 0.0029397080652415752, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/states/sensor.edge_very_long_9021d69b'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/core/test_state_machine_edge_cases.py", "lineno": 40, "message": ""}, {"path": "tests/conftest.py", "lineno": 94, "message": "in set_state"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0d8cca0>\nstate_val = 'xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx...xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx'\nlabel = 'very_long'\n\n    @pytest.mark.parametrize(\"state_val,label\", [\n        (\"\", \"empty\"),\n        (\"42.5\", \"numeric\"),\n        (\"x\" * 1000, \"long\"),\n        (\"x\" * 10000, \"very_long\"),\n        (\"23\u00b0C with wind\", \"unicode\"),\n        (\"\\u6e29\\u5ea6\", \"cjk\"),\n        (\"on/off <test> & 'value'\", \"special_chars\"),\n        ('He said \"hello\"', \"quotes\"),\n        (\"line1\\nline2\", \"newlines\"),\n        (\"path\\\\to\\\\file\", \"backslashes\"),\n        (\"-273.15\", \"negative\"),\n        (\"1.23e10\", \"scientific\"),\n        (\"   \", \"whitespace\"),\n        (\"x\", \"single_char\"),\n        (\"0\", \"zero\"),\n    ])\n    async def test_state_value_edge_cases(rest, state_val, label):\n        \"\"\"State machine correctly stores edge-case state values.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"sensor.edge_{label}_{tag}\"\n>       await rest.set_state(eid, state_val)\n\ntests/core/test_state_machine_edge_cases.py:40: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:94: in set_state\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/states/sensor.edge_very_long_9021d69b'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0007306742481887341, "outcome": "passed"}}, {"nodeid": "tests/core/test_state_machine_edge_cases.py::test_state_value_edge_cases[23\\xb0C with wind-unicode]", "lineno": 18, "outcome": "passed", "keywords": ["test_state_value_edge_cases[23\\xb0C with wind-unicode]", "parametrize", "pytestmark", "23\\xb0C with wind-unicode", "test_state_machine_edge_cases.py", "asyncio", "core", "tests", "marge", ""], "setup": {"duration": 0.005739318672567606, "outcome": "passed"}, "call": {"duration": 0.005007562227547169, "outcome": "passed"}, "teardown": {"duration": 0.0005125016905367374, "outcome": "passed"}}, {"nodeid": "tests/core/test_state_machine_edge_cases.py::test_state_value_edge_cases[\\u6e29\\u5ea6-cjk]", "lineno": 18, "outcome": "passed", "keywords": ["test_state_value_edge_cases[\\u6e29\\u5ea6-cjk]", "parametrize", "pytestmark", "\\u6e29\\u5ea6-cjk", "test_state_machine_edge_cases.py", "asyncio", "core", "tests", "marge", ""], "setup": {"duration": 0.005388830788433552, "outcome": "passed"}, "call": {"duration": 0.0038873679004609585, "outcome": "passed"}, "teardown": {"duration": 0.000496481079608202, "outcome": "passed"}}, {"nodeid": "tests/core/test_state_machine_edge_cases.py::test_state_value_edge_cases[on/off <test> & 'value'-special_chars]", "lineno": 18, "outcome": "passed", "keywords": ["test_state_value_edge_cases[on/off <test> & 'value'-special_chars]", "parametrize", "pytestmark", "on/off <test> & 'value'-special_chars", "test_state_machine_edge_cases.py", "asyncio", "core", "tests", "marge", ""], "setup": {"duration": 0.0052446890622377396, "outcome": "passed"}, "call": {"duration": 0.005600100848823786, "outcome": "passed"}, "teardown": {"duration": 0.0004912768490612507, "outcome": "passed"}}, {"nodeid": "tests/core/test_state_machine_edge_cases.py::test_state_value_edge_cases[He said \"hello\"-quotes]", "lineno": 18, "outcome": "passed", "keywords": ["test_state_value_edge_cases[He said \"hello\"-quotes]", "parametrize", "pytestmark", "He said \"hello\"-quotes", "test_state_machine_edge_cases.py", "asyncio", "core", "tests", "marge", ""], "setup": {"duration": 0.005286177154630423, "outcome": "passed"}, "call": {"duration": 0.003410165663808584, "outcome": "passed"}, "teardown": {"duration": 0.0004664333537220955, "outcome": "passed"}}, {"nodeid": "tests/core/test_state_machine_edge_cases.py::test_state_value_edge_cases[line1\\nline2-newlines]", "lineno": 18, "outcome": "passed", "keywords": ["test_state_value_edge_cases[line1\\nline2-newlines]", "parametrize", "pytestmark", "line1\\nline2-newlines", "test_state_machine_edge_cases.py", "asyncio", "core", "tests", "marge", ""], "setup": {"duration": 0.005301641765981913, "outcome": "passed"}, "call": {"duration": 0.004070947878062725, "outcome": "passed"}, "teardown": {"duration": 0.0005431286990642548, "outcome": "passed"}}, {"nodeid": "tests/core/test_state_machine_edge_cases.py::test_state_value_edge_cases[path\\\\to\\\\file-backslashes]", "lineno": 18, "outcome": "passed", "keywords": ["test_state_value_edge_cases[path\\\\to\\\\file-backslashes]", "parametrize", "pytestmark", "path\\\\to\\\\file-backslashes", "test_state_machine_edge_cases.py", "asyncio", "core", "tests", "marge", ""], "setup": {"duration": 0.005215242970734835, "outcome": "passed"}, "call": {"duration": 0.006036264356225729, "outcome": "passed"}, "teardown": {"duration": 0.0004966980777680874, "outcome": "passed"}}, {"nodeid": "tests/core/test_state_machine_edge_cases.py::test_state_value_edge_cases[-273.15-negative]", "lineno": 18, "outcome": "passed", "keywords": ["test_state_value_edge_cases[-273.15-negative]", "parametrize", "pytestmark", "-273.15-negative", "test_state_machine_edge_cases.py", "asyncio", "core", "tests", "marge", ""], "setup": {"duration": 0.005265182349830866, "outcome": "passed"}, "call": {"duration": 0.003287032712250948, "outcome": "passed"}, "teardown": {"duration": 0.00045020692050457, "outcome": "passed"}}, {"nodeid": "tests/core/test_state_machine_edge_cases.py::test_state_value_edge_cases[1.23e10-scientific]", "lineno": 18, "outcome": "passed", "keywords": ["test_state_value_edge_cases[1.23e10-scientific]", "parametrize", "pytestmark", "1.23e10-scientific", "test_state_machine_edge_cases.py", "asyncio", "core", "tests", "marge", ""], "setup": {"duration": 0.005194614175707102, "outcome": "passed"}, "call": {"duration": 0.004875935148447752, "outcome": "passed"}, "teardown": {"duration": 0.0005973880179226398, "outcome": "passed"}}, {"nodeid": "tests/core/test_state_machine_edge_cases.py::test_state_value_edge_cases[   -whitespace]", "lineno": 18, "outcome": "passed", "keywords": ["test_state_value_edge_cases[   -whitespace]", "parametrize", "pytestmark", "   -whitespace", "test_state_machine_edge_cases.py", "asyncio", "core", "tests", "marge", ""], "setup": {"duration": 0.005292159970849752, "outcome": "passed"}, "call": {"duration": 0.006066311150789261, "outcome": "passed"}, "teardown": {"duration": 0.0004894002340734005, "outcome": "passed"}}, {"nodeid": "tests/core/test_state_machine_edge_cases.py::test_state_value_edge_cases[x-single_char]", "lineno": 18, "outcome": "passed", "keywords": ["test_state_value_edge_cases[x-single_char]", "parametrize", "pytestmark", "x-single_char", "test_state_machine_edge_cases.py", "asyncio", "core", "tests", "marge", ""], "setup": {"duration": 0.005238318350166082, "outcome": "passed"}, "call": {"duration": 0.00332846213132143, "outcome": "passed"}, "teardown": {"duration": 0.00043366383761167526, "outcome": "passed"}}, {"nodeid": "tests/core/test_state_machine_edge_cases.py::test_state_value_edge_cases[0-zero]", "lineno": 18, "outcome": "passed", "keywords": ["test_state_value_edge_cases[0-zero]", "parametrize", "pytestmark", "0-zero", "test_state_machine_edge_cases.py", "asyncio", "core", "tests", "marge", ""], "setup": {"duration": 0.005441004876047373, "outcome": "passed"}, "call": {"duration": 0.0037882081232964993, "outcome": "passed"}, "teardown": {"duration": 0.0005006948485970497, "outcome": "passed"}}, {"nodeid": "tests/core/test_state_machine_edge_cases.py::test_unicode_attribute_value", "lineno": 45, "outcome": "passed", "keywords": ["test_unicode_attribute_value", "test_state_machine_edge_cases.py", "asyncio", "core", "tests", "marge", ""], "setup": {"duration": 0.005085255019366741, "outcome": "passed"}, "call": {"duration": 0.00640060193836689, "outcome": "passed"}, "teardown": {"duration": 0.0005765780806541443, "outcome": "passed"}}, {"nodeid": "tests/core/test_state_machine_edge_cases.py::test_nested_attribute_values", "lineno": 56, "outcome": "passed", "keywords": ["test_nested_attribute_values", "test_state_machine_edge_cases.py", "asyncio", "core", "tests", "marge", ""], "setup": {"duration": 0.005319260060787201, "outcome": "passed"}, "call": {"duration": 0.003567327745258808, "outcome": "passed"}, "teardown": {"duration": 0.00045536085963249207, "outcome": "passed"}}, {"nodeid": "tests/core/test_state_machine_edge_cases.py::test_boolean_attribute_values", "lineno": 70, "outcome": "passed", "keywords": ["test_boolean_attribute_values", "test_state_machine_edge_cases.py", "asyncio", "core", "tests", "marge", ""], "setup": {"duration": 0.0055537717416882515, "outcome": "passed"}, "call": {"duration": 0.004887459799647331, "outcome": "passed"}, "teardown": {"duration": 0.0007818671874701977, "outcome": "passed"}}, {"nodeid": "tests/core/test_state_machine_edge_cases.py::test_null_attribute_value", "lineno": 81, "outcome": "passed", "keywords": ["test_null_attribute_value", "test_state_machine_edge_cases.py", "asyncio", "core", "tests", "marge", ""], "setup": {"duration": 0.005271784029901028, "outcome": "passed"}, "call": {"duration": 0.006974291987717152, "outcome": "passed"}, "teardown": {"duration": 0.0004973243921995163, "outcome": "passed"}}, {"nodeid": "tests/core/test_state_machine_edge_cases.py::test_rapid_updates_last_wins", "lineno": 91, "outcome": "passed", "keywords": ["test_rapid_updates_last_wins", "test_state_machine_edge_cases.py", "asyncio", "core", "tests", "marge", ""], "setup": {"duration": 0.005247048102319241, "outcome": "passed"}, "call": {"duration": 0.028405308723449707, "outcome": "passed"}, "teardown": {"duration": 0.0005003162659704685, "outcome": "passed"}}, {"nodeid": "tests/core/test_state_machine_edge_cases.py::test_many_attributes", "lineno": 103, "outcome": "passed", "keywords": ["test_many_attributes", "test_state_machine_edge_cases.py", "asyncio", "core", "tests", "marge", ""], "setup": {"duration": 0.005303097888827324, "outcome": "passed"}, "call": {"duration": 0.0050578187219798565, "outcome": "passed"}, "teardown": {"duration": 0.0005895867943763733, "outcome": "passed"}}, {"nodeid": "tests/core/test_state_machine_edge_cases.py::test_entity_id_variations[123abc-numbers_in_name]", "lineno": 118, "outcome": "passed", "keywords": ["test_entity_id_variations[123abc-numbers_in_name]", "parametrize", "pytestmark", "123abc-numbers_in_name", "test_state_machine_edge_cases.py", "asyncio", "core", "tests", "marge", ""], "setup": {"duration": 0.005755112040787935, "outcome": "passed"}, "call": {"duration": 0.0038884789682924747, "outcome": "passed"}, "teardown": {"duration": 0.0005447519943118095, "outcome": "passed"}}, {"nodeid": "tests/core/test_state_machine_edge_cases.py::test_entity_id_variations[a_b_c_d-underscores]", "lineno": 118, "outcome": "passed", "keywords": ["test_entity_id_variations[a_b_c_d-underscores]", "parametrize", "pytestmark", "a_b_c_d-underscores", "test_state_machine_edge_cases.py", "asyncio", "core", "tests", "marge", ""], "setup": {"duration": 0.005510311108082533, "outcome": "passed"}, "call": {"duration": 0.004097806755453348, "outcome": "passed"}, "teardown": {"duration": 0.0006026001647114754, "outcome": "passed"}}, {"nodeid": "tests/core/test_state_machine_edge_cases.py::test_unicode_cjk_attribute", "lineno": 134, "outcome": "passed", "keywords": ["test_unicode_cjk_attribute", "test_state_machine_edge_cases.py", "asyncio", "core", "tests", "marge", ""], "setup": {"duration": 0.005207920912653208, "outcome": "passed"}, "call": {"duration": 0.006782159209251404, "outcome": "passed"}, "teardown": {"duration": 0.0005952301435172558, "outcome": "passed"}}, {"nodeid": "tests/core/test_state_machine_edge_cases.py::test_overwrite_replaces_state", "lineno": 146, "outcome": "passed", "keywords": ["test_overwrite_replaces_state", "test_state_machine_edge_cases.py", "asyncio", "core", "tests", "marge", ""], "setup": {"duration": 0.005611159838736057, "outcome": "passed"}, "call": {"duration": 0.005032993853092194, "outcome": "passed"}, "teardown": {"duration": 0.0005790162831544876, "outcome": "passed"}}, {"nodeid": "tests/core/test_state_machine_edge_cases.py::test_overwrite_replaces_attributes", "lineno": 156, "outcome": "passed", "keywords": ["test_overwrite_replaces_attributes", "test_state_machine_edge_cases.py", "asyncio", "core", "tests", "marge", ""], "setup": {"duration": 0.005581150762736797, "outcome": "passed"}, "call": {"duration": 0.004954417236149311, "outcome": "passed"}, "teardown": {"duration": 0.00047444505617022514, "outcome": "passed"}}, {"nodeid": "tests/core/test_state_machine_edge_cases.py::test_overwrite_empty_attrs_clears", "lineno": 168, "outcome": "passed", "keywords": ["test_overwrite_empty_attrs_clears", "test_state_machine_edge_cases.py", "asyncio", "core", "tests", "marge", ""], "setup": {"duration": 0.005203620996326208, "outcome": "passed"}, "call": {"duration": 0.008054421283304691, "outcome": "passed"}, "teardown": {"duration": 0.0005020434036850929, "outcome": "passed"}}, {"nodeid": "tests/core/test_state_machine_edge_cases.py::test_get_all_contains_created_entity", "lineno": 181, "outcome": "passed", "keywords": ["test_get_all_contains_created_entity", "test_state_machine_edge_cases.py", "asyncio", "core", "tests", "marge", ""], "setup": {"duration": 0.005531769711524248, "outcome": "passed"}, "call": {"duration": 0.008708243258297443, "outcome": "passed"}, "teardown": {"duration": 0.0005225450731813908, "outcome": "passed"}}, {"nodeid": "tests/core/test_state_machine_edge_cases.py::test_attribute_numeric_type_preserved[42-integer]", "lineno": 195, "outcome": "passed", "keywords": ["test_attribute_numeric_type_preserved[42-integer]", "parametrize", "pytestmark", "42-integer", "test_state_machine_edge_cases.py", "asyncio", "core", "tests", "marge", ""], "setup": {"duration": 0.00521989306434989, "outcome": "passed"}, "call": {"duration": 0.003569674212485552, "outcome": "passed"}, "teardown": {"duration": 0.0004909150302410126, "outcome": "passed"}}, {"nodeid": "tests/core/test_state_machine_edge_cases.py::test_attribute_numeric_type_preserved[72.5-float]", "lineno": 195, "outcome": "passed", "keywords": ["test_attribute_numeric_type_preserved[72.5-float]", "parametrize", "pytestmark", "72.5-float", "test_state_machine_edge_cases.py", "asyncio", "core", "tests", "marge", ""], "setup": {"duration": 0.005346449092030525, "outcome": "passed"}, "call": {"duration": 0.00436445465311408, "outcome": "passed"}, "teardown": {"duration": 0.000554502010345459, "outcome": "passed"}}, {"nodeid": "tests/core/test_state_machine_edge_cases.py::test_overwrite_preserves_entity_id", "lineno": 211, "outcome": "passed", "keywords": ["test_overwrite_preserves_entity_id", "test_state_machine_edge_cases.py", "asyncio", "core", "tests", "marge", ""], "setup": {"duration": 0.00558566814288497, "outcome": "passed"}, "call": {"duration": 0.005948115140199661, "outcome": "passed"}, "teardown": {"duration": 0.0004813671112060547, "outcome": "passed"}}, {"nodeid": "tests/core/test_state_machine_edge_cases.py::test_timestamps_advance_on_state_update", "lineno": 224, "outcome": "passed", "keywords": ["test_timestamps_advance_on_state_update", "test_state_machine_edge_cases.py", "asyncio", "core", "tests", "marge", ""], "setup": {"duration": 0.005405033938586712, "outcome": "passed"}, "call": {"duration": 0.10983718372881413, "outcome": "passed"}, "teardown": {"duration": 0.000673539936542511, "outcome": "passed"}}, {"nodeid": "tests/core/test_state_operations.py::test_set_state_returns_full_entity", "lineno": 16, "outcome": "passed", "keywords": ["test_set_state_returns_full_entity", "test_state_operations.py", "asyncio", "core", "tests", "marge", ""], "setup": {"duration": 0.007043557707220316, "outcome": "passed"}, "call": {"duration": 0.0037377900443971157, "outcome": "passed"}, "teardown": {"duration": 0.0007154243066906929, "outcome": "passed"}}, {"nodeid": "tests/core/test_state_operations.py::test_set_state_preserves_existing_attrs", "lineno": 24, "outcome": "passed", "keywords": ["test_set_state_preserves_existing_attrs", "test_state_operations.py", "asyncio", "core", "tests", "marge", ""], "setup": {"duration": 0.006637420039623976, "outcome": "passed"}, "call": {"duration": 0.007852511946111917, "outcome": "passed"}, "teardown": {"duration": 0.0005274130962789059, "outcome": "passed"}}, {"nodeid": "tests/core/test_state_operations.py::test_get_state_returns_none_for_missing", "lineno": 34, "outcome": "passed", "keywords": ["test_get_state_returns_none_for_missing", "test_state_operations.py", "asyncio", "core", "tests", "marge", ""], "setup": {"duration": 0.005210172850638628, "outcome": "passed"}, "call": {"duration": 0.002431980799883604, "outcome": "passed"}, "teardown": {"duration": 0.0005583260208368301, "outcome": "passed"}}, {"nodeid": "tests/core/test_state_operations.py::test_get_all_states_is_list", "lineno": 40, "outcome": "passed", "keywords": ["test_get_all_states_is_list", "test_state_operations.py", "asyncio", "core", "tests", "marge", ""], "setup": {"duration": 0.005084870848804712, "outcome": "passed"}, "call": {"duration": 0.00826343335211277, "outcome": "passed"}, "teardown": {"duration": 0.0007623550482094288, "outcome": "passed"}}, {"nodeid": "tests/core/test_state_operations.py::test_set_state_with_empty_attrs", "lineno": 48, "outcome": "passed", "keywords": ["test_set_state_with_empty_attrs", "test_state_operations.py", "asyncio", "core", "tests", "marge", ""], "setup": {"duration": 0.005431254394352436, "outcome": "passed"}, "call": {"duration": 0.0035453708842396736, "outcome": "passed"}, "teardown": {"duration": 0.000770248007029295, "outcome": "passed"}}, {"nodeid": "tests/core/test_state_operations.py::test_set_state_with_null_like_value", "lineno": 55, "outcome": "passed", "keywords": ["test_set_state_with_null_like_value", "test_state_operations.py", "asyncio", "core", "tests", "marge", ""], "setup": {"duration": 0.0050234138034284115, "outcome": "passed"}, "call": {"duration": 0.002627238631248474, "outcome": "passed"}, "teardown": {"duration": 0.0005773128941655159, "outcome": "passed"}}, {"nodeid": "tests/core/test_state_operations.py::test_context_id_present", "lineno": 63, "outcome": "passed", "keywords": ["test_context_id_present", "test_state_operations.py", "asyncio", "core", "tests", "marge", ""], "setup": {"duration": 0.005165089853107929, "outcome": "passed"}, "call": {"duration": 0.006964166183024645, "outcome": "passed"}, "teardown": {"duration": 0.0005686720833182335, "outcome": "passed"}}, {"nodeid": "tests/core/test_state_operations.py::test_many_entities_created", "lineno": 74, "outcome": "passed", "keywords": ["test_many_entities_created", "test_state_operations.py", "asyncio", "core", "tests", "marge", ""], "setup": {"duration": 0.005345791112631559, "outcome": "passed"}, "call": {"duration": 0.06955050909891725, "outcome": "passed"}, "teardown": {"duration": 0.0005636001005768776, "outcome": "passed"}}, {"nodeid": "tests/core/test_state_operations.py::test_concurrent_different_entities", "lineno": 82, "outcome": "passed", "keywords": ["test_concurrent_different_entities", "test_state_operations.py", "asyncio", "core", "tests", "marge", ""], "setup": {"duration": 0.005337683949619532, "outcome": "passed"}, "call": {"duration": 0.033589910715818405, "outcome": "passed"}, "teardown": {"duration": 0.0016319449059665203, "outcome": "passed"}}, {"nodeid": "tests/core/test_state_operations.py::test_delete_and_verify_absent", "lineno": 96, "outcome": "passed", "keywords": ["test_delete_and_verify_absent", "test_state_operations.py", "asyncio", "core", "tests", "marge", ""], "setup": {"duration": 0.005435741040855646, "outcome": "passed"}, "call": {"duration": 0.009188513737171888, "outcome": "passed"}, "teardown": {"duration": 0.0005604247562587261, "outcome": "passed"}}, {"nodeid": "tests/core/test_state_operations.py::test_state_numeric_string", "lineno": 115, "outcome": "passed", "keywords": ["test_state_numeric_string", "test_state_operations.py", "asyncio", "core", "tests", "marge", ""], "setup": {"duration": 0.005221620202064514, "outcome": "passed"}, "call": {"duration": 0.002677702810615301, "outcome": "passed"}, "teardown": {"duration": 0.0004834681749343872, "outcome": "passed"}}, {"nodeid": "tests/core/test_state_operations.py::test_state_long_value", "lineno": 121, "outcome": "failed", "keywords": ["test_state_long_value", "test_state_operations.py", "asyncio", "core", "tests", "marge", ""], "setup": {"duration": 0.0053655728697776794, "outcome": "passed"}, "call": {"duration": 0.002790509257465601, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/states/sensor.long_val'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/core/test_state_operations.py", "lineno": 125, "message": ""}, {"path": "tests/conftest.py", "lineno": 94, "message": "in set_state"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0cc6430>\n\n    async def test_state_long_value(rest):\n        \"\"\"State accepts long strings.\"\"\"\n        long_val = \"x\" * 500\n>       result = await rest.set_state(\"sensor.long_val\", long_val)\n\ntests/core/test_state_operations.py:125: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:94: in set_state\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/states/sensor.long_val'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0007133078761398792, "outcome": "passed"}}, {"nodeid": "tests/core/test_state_operations.py::test_state_special_chars", "lineno": 128, "outcome": "passed", "keywords": ["test_state_special_chars", "test_state_operations.py", "asyncio", "core", "tests", "marge", ""], "setup": {"duration": 0.005572271067649126, "outcome": "passed"}, "call": {"duration": 0.002876095939427614, "outcome": "passed"}, "teardown": {"duration": 0.0005593840032815933, "outcome": "passed"}}, {"nodeid": "tests/core/test_state_operations.py::test_attribute_nested_object", "lineno": 134, "outcome": "passed", "keywords": ["test_attribute_nested_object", "test_state_operations.py", "asyncio", "core", "tests", "marge", ""], "setup": {"duration": 0.005245955195277929, "outcome": "passed"}, "call": {"duration": 0.002685702405869961, "outcome": "passed"}, "teardown": {"duration": 0.0004719872958958149, "outcome": "passed"}}, {"nodeid": "tests/core/test_state_operations.py::test_attribute_array_value", "lineno": 143, "outcome": "passed", "keywords": ["test_attribute_array_value", "test_state_operations.py", "asyncio", "core", "tests", "marge", ""], "setup": {"duration": 0.00535529525950551, "outcome": "passed"}, "call": {"duration": 0.004630980081856251, "outcome": "passed"}, "teardown": {"duration": 0.0005370108410716057, "outcome": "passed"}}, {"nodeid": "tests/core/test_state_timestamp_semantics.py::test_first_set_timestamps_all_equal", "lineno": 14, "outcome": "passed", "keywords": ["test_first_set_timestamps_all_equal", "test_state_timestamp_semantics.py", "asyncio", "core", "tests", "marge", ""], "setup": {"duration": 0.005283090751618147, "outcome": "passed"}, "call": {"duration": 0.004589877091348171, "outcome": "passed"}, "teardown": {"duration": 0.0005383500829339027, "outcome": "passed"}}, {"nodeid": "tests/core/test_state_timestamp_semantics.py::test_same_state_last_changed_stable", "lineno": 25, "outcome": "passed", "keywords": ["test_same_state_last_changed_stable", "test_state_timestamp_semantics.py", "asyncio", "core", "tests", "marge", ""], "setup": {"duration": 0.005503772757947445, "outcome": "passed"}, "call": {"duration": 0.05762500502169132, "outcome": "passed"}, "teardown": {"duration": 0.0007236478850245476, "outcome": "passed"}}, {"nodeid": "tests/core/test_state_timestamp_semantics.py::test_different_state_last_changed_advances", "lineno": 41, "outcome": "passed", "keywords": ["test_different_state_last_changed_advances", "test_state_timestamp_semantics.py", "asyncio", "core", "tests", "marge", ""], "setup": {"duration": 0.005347258877009153, "outcome": "passed"}, "call": {"duration": 0.05917371017858386, "outcome": "passed"}, "teardown": {"duration": 0.0005283709615468979, "outcome": "passed"}}, {"nodeid": "tests/core/test_state_timestamp_semantics.py::test_last_reported_always_advances", "lineno": 57, "outcome": "passed", "keywords": ["test_last_reported_always_advances", "test_state_timestamp_semantics.py", "asyncio", "core", "tests", "marge", ""], "setup": {"duration": 0.0055857012048363686, "outcome": "passed"}, "call": {"duration": 0.056925852317363024, "outcome": "passed"}, "teardown": {"duration": 0.000573956873267889, "outcome": "passed"}}, {"nodeid": "tests/core/test_state_timestamp_semantics.py::test_attribute_only_change_last_updated_advances", "lineno": 73, "outcome": "passed", "keywords": ["test_attribute_only_change_last_updated_advances", "test_state_timestamp_semantics.py", "asyncio", "core", "tests", "marge", ""], "setup": {"duration": 0.005427960772067308, "outcome": "passed"}, "call": {"duration": 0.06037385482341051, "outcome": "passed"}, "teardown": {"duration": 0.0006101629696786404, "outcome": "passed"}}, {"nodeid": "tests/core/test_state_timestamp_semantics.py::test_same_state_same_attrs_last_updated_stable", "lineno": 91, "outcome": "passed", "keywords": ["test_same_state_same_attrs_last_updated_stable", "test_state_timestamp_semantics.py", "asyncio", "core", "tests", "marge", ""], "setup": {"duration": 0.0064794039353728294, "outcome": "passed"}, "call": {"duration": 0.05892486497759819, "outcome": "passed"}, "teardown": {"duration": 0.0007142010144889355, "outcome": "passed"}}, {"nodeid": "tests/core/test_state_timestamp_semantics.py::test_context_has_uuid_format", "lineno": 107, "outcome": "failed", "keywords": ["test_context_has_uuid_format", "test_state_timestamp_semantics.py", "asyncio", "core", "tests", "marge", ""], "setup": {"duration": 0.007078726775944233, "outcome": "passed"}, "call": {"duration": 0.0047458261251449585, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/core/test_state_timestamp_semantics.py", "lineno": 117, "message": "AssertionError: assert 26 >= 32\n +  where 26 = len('01KHYN742KDSCPK3227D4JY2FF')"}, "traceback": [{"path": "tests/core/test_state_timestamp_semantics.py", "lineno": 117, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0ba63d0>\n\n    async def test_context_has_uuid_format(rest):\n        \"\"\"Context.id is a valid UUID-like string.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"sensor.ts_ctx_{tag}\"\n        await rest.set_state(eid, \"val\")\n    \n        state = await rest.get_state(eid)\n        ctx = state[\"context\"]\n        assert \"id\" in ctx\n>       assert len(ctx[\"id\"]) >= 32  # UUID with or without hyphens\nE       AssertionError: assert 26 >= 32\nE        +  where 26 = len('01KHYN742KDSCPK3227D4JY2FF')\n\ntests/core/test_state_timestamp_semantics.py:117: AssertionError"}, "teardown": {"duration": 0.0006048460491001606, "outcome": "passed"}}, {"nodeid": "tests/core/test_state_timestamp_semantics.py::test_context_id_has_dashes", "lineno": 119, "outcome": "failed", "keywords": ["test_context_id_has_dashes", "test_state_timestamp_semantics.py", "asyncio", "core", "tests", "marge", ""], "setup": {"duration": 0.005338625051081181, "outcome": "passed"}, "call": {"duration": 0.003557473886758089, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/core/test_state_timestamp_semantics.py", "lineno": 128, "message": "AssertionError: assert '-' in '01KHYN7434JB8PZ7ZV8Q8Q12D2'"}, "traceback": [{"path": "tests/core/test_state_timestamp_semantics.py", "lineno": 128, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b04f74c0>\n\n    async def test_context_id_has_dashes(rest):\n        \"\"\"context.id contains dashes (UUID format).\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"sensor.ctx_uuid_{tag}\"\n        await rest.set_state(eid, \"val\")\n    \n        state = await rest.get_state(eid)\n        ctx_id = state[\"context\"][\"id\"]\n>       assert \"-\" in ctx_id\nE       AssertionError: assert '-' in '01KHYN7434JB8PZ7ZV8Q8Q12D2'\n\ntests/core/test_state_timestamp_semantics.py:128: AssertionError"}, "teardown": {"duration": 0.0006208592094480991, "outcome": "passed"}}, {"nodeid": "tests/core/test_state_timestamp_semantics.py::test_context_changes_on_each_set", "lineno": 130, "outcome": "passed", "keywords": ["test_context_changes_on_each_set", "test_state_timestamp_semantics.py", "asyncio", "core", "tests", "marge", ""], "setup": {"duration": 0.005375831853598356, "outcome": "passed"}, "call": {"duration": 0.005951584316790104, "outcome": "passed"}, "teardown": {"duration": 0.0005224519409239292, "outcome": "passed"}}, {"nodeid": "tests/core/test_state_timestamp_semantics.py::test_state_change_event_via_ws", "lineno": 143, "outcome": "passed", "keywords": ["test_state_change_event_via_ws", "test_state_timestamp_semantics.py", "asyncio", "core", "tests", "marge", ""], "setup": {"duration": 0.007614089176058769, "outcome": "passed"}, "call": {"duration": 0.00643888907507062, "outcome": "passed"}, "teardown": {"duration": 0.0008229878731071949, "outcome": "passed"}}, {"nodeid": "tests/core/test_state_timestamp_semantics.py::test_old_state_none_on_first_set", "lineno": 174, "outcome": "passed", "keywords": ["test_old_state_none_on_first_set", "test_state_timestamp_semantics.py", "asyncio", "core", "tests", "marge", ""], "setup": {"duration": 0.007893738802522421, "outcome": "passed"}, "call": {"duration": 0.004425721243023872, "outcome": "passed"}, "teardown": {"duration": 0.001197780016809702, "outcome": "passed"}}, {"nodeid": "tests/core/test_state_timestamp_semantics.py::test_timestamps_are_iso8601", "lineno": 202, "outcome": "passed", "keywords": ["test_timestamps_are_iso8601", "test_state_timestamp_semantics.py", "asyncio", "core", "tests", "marge", ""], "setup": {"duration": 0.005573801696300507, "outcome": "passed"}, "call": {"duration": 0.0044428627006709576, "outcome": "passed"}, "teardown": {"duration": 0.0005113100633025169, "outcome": "passed"}}, {"nodeid": "tests/core/test_state_timestamp_semantics.py::test_entity_count_increases", "lineno": 218, "outcome": "passed", "keywords": ["test_entity_count_increases", "test_state_timestamp_semantics.py", "asyncio", "core", "tests", "marge", ""], "setup": {"duration": 0.005288124084472656, "outcome": "passed"}, "call": {"duration": 0.014462032821029425, "outcome": "passed"}, "teardown": {"duration": 0.0006454349495470524, "outcome": "passed"}}, {"nodeid": "tests/core/test_state_timestamp_semantics.py::test_delete_entity_decreases_count", "lineno": 227, "outcome": "passed", "keywords": ["test_delete_entity_decreases_count", "test_state_timestamp_semantics.py", "asyncio", "core", "tests", "marge", ""], "setup": {"duration": 0.0053534419275820255, "outcome": "passed"}, "call": {"duration": 0.056346853729337454, "outcome": "passed"}, "teardown": {"duration": 0.0005594179965555668, "outcome": "passed"}}, {"nodeid": "tests/core/test_state_timestamp_semantics.py::test_entity_id_in_state", "lineno": 245, "outcome": "passed", "keywords": ["test_entity_id_in_state", "test_state_timestamp_semantics.py", "asyncio", "core", "tests", "marge", ""], "setup": {"duration": 0.006092364899814129, "outcome": "passed"}, "call": {"duration": 0.00467446306720376, "outcome": "passed"}, "teardown": {"duration": 0.0006361966952681541, "outcome": "passed"}}, {"nodeid": "tests/core/test_state_timestamp_semantics.py::test_state_value_is_string", "lineno": 254, "outcome": "passed", "keywords": ["test_state_value_is_string", "test_state_timestamp_semantics.py", "asyncio", "core", "tests", "marge", ""], "setup": {"duration": 0.006135507021099329, "outcome": "passed"}, "call": {"duration": 0.004048037342727184, "outcome": "passed"}, "teardown": {"duration": 0.0005238307639956474, "outcome": "passed"}}, {"nodeid": "tests/core/test_state_timestamp_semantics.py::test_attributes_default_empty", "lineno": 267, "outcome": "passed", "keywords": ["test_attributes_default_empty", "test_state_timestamp_semantics.py", "asyncio", "core", "tests", "marge", ""], "setup": {"duration": 0.00583313312381506, "outcome": "passed"}, "call": {"duration": 0.007166893221437931, "outcome": "passed"}, "teardown": {"duration": 0.0005464255809783936, "outcome": "passed"}}, {"nodeid": "tests/core/test_state_timestamp_semantics.py::test_attributes_preserved_on_state_change", "lineno": 276, "outcome": "passed", "keywords": ["test_attributes_preserved_on_state_change", "test_state_timestamp_semantics.py", "asyncio", "core", "tests", "marge", ""], "setup": {"duration": 0.0057997857220470905, "outcome": "passed"}, "call": {"duration": 0.005452170968055725, "outcome": "passed"}, "teardown": {"duration": 0.0005102371796965599, "outcome": "passed"}}, {"nodeid": "tests/core/test_state_timestamp_semantics.py::test_rapid_updates_maintain_ordering", "lineno": 291, "outcome": "passed", "keywords": ["test_rapid_updates_maintain_ordering", "test_state_timestamp_semantics.py", "asyncio", "core", "tests", "marge", ""], "setup": {"duration": 0.00538006192073226, "outcome": "passed"}, "call": {"duration": 0.02744572190567851, "outcome": "passed"}, "teardown": {"duration": 0.0005650017410516739, "outcome": "passed"}}, {"nodeid": "tests/core/test_state_timestamp_semantics.py::test_multiple_entities_independent_timestamps", "lineno": 305, "outcome": "passed", "keywords": ["test_multiple_entities_independent_timestamps", "test_state_timestamp_semantics.py", "asyncio", "core", "tests", "marge", ""], "setup": {"duration": 0.00580220902338624, "outcome": "passed"}, "call": {"duration": 0.10923745017498732, "outcome": "passed"}, "teardown": {"duration": 0.0008041192777454853, "outcome": "passed"}}, {"nodeid": "tests/core/test_template_state_functions.py::test_states_returns_current_value", "lineno": 28, "outcome": "passed", "keywords": ["test_states_returns_current_value", "test_template_state_functions.py", "asyncio", "core", "tests", "marge", ""], "setup": {"duration": 0.007446610368788242, "outcome": "passed"}, "call": {"duration": 0.008858269080519676, "outcome": "passed"}, "teardown": {"duration": 0.0006609600968658924, "outcome": "passed"}}, {"nodeid": "tests/core/test_template_state_functions.py::test_states_unknown_entity", "lineno": 38, "outcome": "passed", "keywords": ["test_states_unknown_entity", "test_template_state_functions.py", "asyncio", "core", "tests", "marge", ""], "setup": {"duration": 0.0056365421041846275, "outcome": "passed"}, "call": {"duration": 0.003047793172299862, "outcome": "passed"}, "teardown": {"duration": 0.0004593692719936371, "outcome": "passed"}}, {"nodeid": "tests/core/test_template_state_functions.py::test_states_in_arithmetic", "lineno": 44, "outcome": "passed", "keywords": ["test_states_in_arithmetic", "test_template_state_functions.py", "asyncio", "core", "tests", "marge", ""], "setup": {"duration": 0.005575372837483883, "outcome": "passed"}, "call": {"duration": 0.00505914818495512, "outcome": "passed"}, "teardown": {"duration": 0.0006232652813196182, "outcome": "passed"}}, {"nodeid": "tests/core/test_template_state_functions.py::test_is_state_true", "lineno": 56, "outcome": "passed", "keywords": ["test_is_state_true", "test_template_state_functions.py", "asyncio", "core", "tests", "marge", ""], "setup": {"duration": 0.005630053114145994, "outcome": "passed"}, "call": {"duration": 0.007577117998152971, "outcome": "passed"}, "teardown": {"duration": 0.0005316287279129028, "outcome": "passed"}}, {"nodeid": "tests/core/test_template_state_functions.py::test_is_state_false", "lineno": 66, "outcome": "passed", "keywords": ["test_is_state_false", "test_template_state_functions.py", "asyncio", "core", "tests", "marge", ""], "setup": {"duration": 0.00536226574331522, "outcome": "passed"}, "call": {"duration": 0.005257817916572094, "outcome": "passed"}, "teardown": {"duration": 0.00056423619389534, "outcome": "passed"}}, {"nodeid": "tests/core/test_template_state_functions.py::test_is_state_nonexistent", "lineno": 76, "outcome": "passed", "keywords": ["test_is_state_nonexistent", "test_template_state_functions.py", "asyncio", "core", "tests", "marge", ""], "setup": {"duration": 0.005591351073235273, "outcome": "passed"}, "call": {"duration": 0.003271693829447031, "outcome": "passed"}, "teardown": {"duration": 0.0004964713007211685, "outcome": "passed"}}, {"nodeid": "tests/core/test_template_state_functions.py::test_state_attr_returns_value", "lineno": 84, "outcome": "passed", "keywords": ["test_state_attr_returns_value", "test_template_state_functions.py", "asyncio", "core", "tests", "marge", ""], "setup": {"duration": 0.005460300948470831, "outcome": "passed"}, "call": {"duration": 0.007662540767341852, "outcome": "passed"}, "teardown": {"duration": 0.0005398709326982498, "outcome": "passed"}}, {"nodeid": "tests/core/test_template_state_functions.py::test_state_attr_friendly_name", "lineno": 94, "outcome": "passed", "keywords": ["test_state_attr_friendly_name", "test_template_state_functions.py", "asyncio", "core", "tests", "marge", ""], "setup": {"duration": 0.0058240401558578014, "outcome": "passed"}, "call": {"duration": 0.005962050054222345, "outcome": "passed"}, "teardown": {"duration": 0.0006014611572027206, "outcome": "passed"}}, {"nodeid": "tests/core/test_template_state_functions.py::test_state_attr_missing", "lineno": 104, "outcome": "passed", "keywords": ["test_state_attr_missing", "test_template_state_functions.py", "asyncio", "core", "tests", "marge", ""], "setup": {"duration": 0.005572719965130091, "outcome": "passed"}, "call": {"duration": 0.006271766033023596, "outcome": "passed"}, "teardown": {"duration": 0.0005178782157599926, "outcome": "passed"}}, {"nodeid": "tests/core/test_template_state_functions.py::test_now_returns_timestamp", "lineno": 116, "outcome": "passed", "keywords": ["test_now_returns_timestamp", "test_template_state_functions.py", "asyncio", "core", "tests", "marge", ""], "setup": {"duration": 0.005221404135227203, "outcome": "passed"}, "call": {"duration": 0.005941716954112053, "outcome": "passed"}, "teardown": {"duration": 0.0006531300023198128, "outcome": "passed"}}, {"nodeid": "tests/core/test_template_state_functions.py::test_states_with_round_filter", "lineno": 125, "outcome": "passed", "keywords": ["test_states_with_round_filter", "test_template_state_functions.py", "asyncio", "core", "tests", "marge", ""], "setup": {"duration": 0.006197245791554451, "outcome": "passed"}, "call": {"duration": 0.005210089962929487, "outcome": "passed"}, "teardown": {"duration": 0.0005195979028940201, "outcome": "passed"}}, {"nodeid": "tests/core/test_template_state_functions.py::test_states_with_default_filter", "lineno": 135, "outcome": "passed", "keywords": ["test_states_with_default_filter", "test_template_state_functions.py", "asyncio", "core", "tests", "marge", ""], "setup": {"duration": 0.00563025800511241, "outcome": "passed"}, "call": {"duration": 0.003543141297996044, "outcome": "passed"}, "teardown": {"duration": 0.0006078132428228855, "outcome": "passed"}}, {"nodeid": "tests/core/test_template_state_functions.py::test_conditional_template", "lineno": 146, "outcome": "passed", "keywords": ["test_conditional_template", "test_template_state_functions.py", "asyncio", "core", "tests", "marge", ""], "setup": {"duration": 0.00514502078294754, "outcome": "passed"}, "call": {"duration": 0.00871742283925414, "outcome": "passed"}, "teardown": {"duration": 0.0006509721279144287, "outcome": "passed"}}, {"nodeid": "tests/core/test_template_state_functions.py::test_template_with_int_global_function", "lineno": 159, "outcome": "passed", "keywords": ["test_template_with_int_global_function", "test_template_state_functions.py", "asyncio", "core", "tests", "marge", ""], "setup": {"duration": 0.006642321590334177, "outcome": "passed"}, "call": {"duration": 0.0050826650112867355, "outcome": "passed"}, "teardown": {"duration": 0.0006138239987194538, "outcome": "passed"}}, {"nodeid": "tests/core/test_template_state_functions.py::test_template_with_bool_global_function", "lineno": 169, "outcome": "passed", "keywords": ["test_template_with_bool_global_function", "test_template_state_functions.py", "asyncio", "core", "tests", "marge", ""], "setup": {"duration": 0.005610744934529066, "outcome": "passed"}, "call": {"duration": 0.004027116112411022, "outcome": "passed"}, "teardown": {"duration": 0.0005485299043357372, "outcome": "passed"}}, {"nodeid": "tests/entity/test_alarm_climate_water_heater.py::test_alarm_service[arm_home-disarmed-armed_home]", "lineno": 15, "outcome": "failed", "keywords": ["test_alarm_service[arm_home-disarmed-armed_home]", "parametrize", "pytestmark", "arm_home-disarmed-armed_home", "test_alarm_climate_water_heater.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005572083406150341, "outcome": "passed"}, "call": {"duration": 0.007775601930916309, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/alarm_control_panel/arm_home'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_alarm_climate_water_heater.py", "lineno": 29, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0bc8670>, service = 'arm_home'\ninitial_state = 'disarmed', expected_state = 'armed_home'\n\n    @pytest.mark.parametrize(\"service,initial_state,expected_state\", [\n        (\"arm_home\", \"disarmed\", \"armed_home\"),\n        (\"arm_away\", \"disarmed\", \"armed_away\"),\n        (\"arm_night\", \"disarmed\", \"armed_night\"),\n        (\"disarm\", \"armed_home\", \"disarmed\"),\n        (\"trigger\", \"armed_home\", \"triggered\"),\n    ])\n    async def test_alarm_service(rest, service, initial_state, expected_state):\n        \"\"\"Alarm service sets expected state.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"alarm_control_panel.a_{service}_{tag}\"\n        await rest.set_state(eid, initial_state)\n    \n>       await rest.call_service(\"alarm_control_panel\", service, {\n            \"entity_id\": eid,\n        })\n\ntests/entity/test_alarm_climate_water_heater.py:29: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/alarm_control_panel/arm_home'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0007109660655260086, "outcome": "passed"}}, {"nodeid": "tests/entity/test_alarm_climate_water_heater.py::test_alarm_service[arm_away-disarmed-armed_away]", "lineno": 15, "outcome": "failed", "keywords": ["test_alarm_service[arm_away-disarmed-armed_away]", "parametrize", "pytestmark", "arm_away-disarmed-armed_away", "test_alarm_climate_water_heater.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.006153665017336607, "outcome": "passed"}, "call": {"duration": 0.004214832093566656, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/alarm_control_panel/arm_away'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_alarm_climate_water_heater.py", "lineno": 29, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0b74d30>, service = 'arm_away'\ninitial_state = 'disarmed', expected_state = 'armed_away'\n\n    @pytest.mark.parametrize(\"service,initial_state,expected_state\", [\n        (\"arm_home\", \"disarmed\", \"armed_home\"),\n        (\"arm_away\", \"disarmed\", \"armed_away\"),\n        (\"arm_night\", \"disarmed\", \"armed_night\"),\n        (\"disarm\", \"armed_home\", \"disarmed\"),\n        (\"trigger\", \"armed_home\", \"triggered\"),\n    ])\n    async def test_alarm_service(rest, service, initial_state, expected_state):\n        \"\"\"Alarm service sets expected state.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"alarm_control_panel.a_{service}_{tag}\"\n        await rest.set_state(eid, initial_state)\n    \n>       await rest.call_service(\"alarm_control_panel\", service, {\n            \"entity_id\": eid,\n        })\n\ntests/entity/test_alarm_climate_water_heater.py:29: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/alarm_control_panel/arm_away'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0006788279861211777, "outcome": "passed"}}, {"nodeid": "tests/entity/test_alarm_climate_water_heater.py::test_alarm_service[arm_night-disarmed-armed_night]", "lineno": 15, "outcome": "failed", "keywords": ["test_alarm_service[arm_night-disarmed-armed_night]", "parametrize", "pytestmark", "arm_night-disarmed-armed_night", "test_alarm_climate_water_heater.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005479154177010059, "outcome": "passed"}, "call": {"duration": 0.004300318192690611, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/alarm_control_panel/arm_night'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_alarm_climate_water_heater.py", "lineno": 29, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0bb97c0>, service = 'arm_night'\ninitial_state = 'disarmed', expected_state = 'armed_night'\n\n    @pytest.mark.parametrize(\"service,initial_state,expected_state\", [\n        (\"arm_home\", \"disarmed\", \"armed_home\"),\n        (\"arm_away\", \"disarmed\", \"armed_away\"),\n        (\"arm_night\", \"disarmed\", \"armed_night\"),\n        (\"disarm\", \"armed_home\", \"disarmed\"),\n        (\"trigger\", \"armed_home\", \"triggered\"),\n    ])\n    async def test_alarm_service(rest, service, initial_state, expected_state):\n        \"\"\"Alarm service sets expected state.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"alarm_control_panel.a_{service}_{tag}\"\n        await rest.set_state(eid, initial_state)\n    \n>       await rest.call_service(\"alarm_control_panel\", service, {\n            \"entity_id\": eid,\n        })\n\ntests/entity/test_alarm_climate_water_heater.py:29: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/alarm_control_panel/arm_night'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0007344051264226437, "outcome": "passed"}}, {"nodeid": "tests/entity/test_alarm_climate_water_heater.py::test_alarm_service[disarm-armed_home-disarmed]", "lineno": 15, "outcome": "failed", "keywords": ["test_alarm_service[disarm-armed_home-disarmed]", "parametrize", "pytestmark", "disarm-armed_home-disarmed", "test_alarm_climate_water_heater.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.00542284082621336, "outcome": "passed"}, "call": {"duration": 0.004197346046566963, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/alarm_control_panel/disarm'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_alarm_climate_water_heater.py", "lineno": 29, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0d5a2b0>, service = 'disarm'\ninitial_state = 'armed_home', expected_state = 'disarmed'\n\n    @pytest.mark.parametrize(\"service,initial_state,expected_state\", [\n        (\"arm_home\", \"disarmed\", \"armed_home\"),\n        (\"arm_away\", \"disarmed\", \"armed_away\"),\n        (\"arm_night\", \"disarmed\", \"armed_night\"),\n        (\"disarm\", \"armed_home\", \"disarmed\"),\n        (\"trigger\", \"armed_home\", \"triggered\"),\n    ])\n    async def test_alarm_service(rest, service, initial_state, expected_state):\n        \"\"\"Alarm service sets expected state.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"alarm_control_panel.a_{service}_{tag}\"\n        await rest.set_state(eid, initial_state)\n    \n>       await rest.call_service(\"alarm_control_panel\", service, {\n            \"entity_id\": eid,\n        })\n\ntests/entity/test_alarm_climate_water_heater.py:29: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/alarm_control_panel/disarm'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0007073269225656986, "outcome": "passed"}}, {"nodeid": "tests/entity/test_alarm_climate_water_heater.py::test_alarm_service[trigger-armed_home-triggered]", "lineno": 15, "outcome": "failed", "keywords": ["test_alarm_service[trigger-armed_home-triggered]", "parametrize", "pytestmark", "trigger-armed_home-triggered", "test_alarm_climate_water_heater.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.0059083909727633, "outcome": "passed"}, "call": {"duration": 0.004367091692984104, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/alarm_control_panel/trigger'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_alarm_climate_water_heater.py", "lineno": 29, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0b79340>, service = 'trigger'\ninitial_state = 'armed_home', expected_state = 'triggered'\n\n    @pytest.mark.parametrize(\"service,initial_state,expected_state\", [\n        (\"arm_home\", \"disarmed\", \"armed_home\"),\n        (\"arm_away\", \"disarmed\", \"armed_away\"),\n        (\"arm_night\", \"disarmed\", \"armed_night\"),\n        (\"disarm\", \"armed_home\", \"disarmed\"),\n        (\"trigger\", \"armed_home\", \"triggered\"),\n    ])\n    async def test_alarm_service(rest, service, initial_state, expected_state):\n        \"\"\"Alarm service sets expected state.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"alarm_control_panel.a_{service}_{tag}\"\n        await rest.set_state(eid, initial_state)\n    \n>       await rest.call_service(\"alarm_control_panel\", service, {\n            \"entity_id\": eid,\n        })\n\ntests/entity/test_alarm_climate_water_heater.py:29: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/alarm_control_panel/trigger'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0007567298598587513, "outcome": "passed"}}, {"nodeid": "tests/entity/test_alarm_climate_water_heater.py::test_alarm_full_lifecycle", "lineno": 38, "outcome": "failed", "keywords": ["test_alarm_full_lifecycle", "test_alarm_climate_water_heater.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005540752783417702, "outcome": "passed"}, "call": {"duration": 0.0042959279380738735, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/alarm_control_panel/arm_home'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_alarm_climate_water_heater.py", "lineno": 44, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0d3b070>\n\n    async def test_alarm_full_lifecycle(rest):\n        \"\"\"Alarm goes through full lifecycle: disarmed -> armed_home -> armed_away -> triggered -> disarmed.\"\"\"\n        entity_id = \"alarm_control_panel.lifecycle\"\n        await rest.set_state(entity_id, \"disarmed\")\n    \n>       await rest.call_service(\"alarm_control_panel\", \"arm_home\", {\"entity_id\": entity_id})\n\ntests/entity/test_alarm_climate_water_heater.py:44: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/alarm_control_panel/arm_home'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0006598616018891335, "outcome": "passed"}}, {"nodeid": "tests/entity/test_alarm_climate_water_heater.py::test_climate_set_temperature_stores_attr", "lineno": 62, "outcome": "failed", "keywords": ["test_climate_set_temperature_stores_attr", "test_alarm_climate_water_heater.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005153113976120949, "outcome": "passed"}, "call": {"duration": 0.004101132042706013, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/climate/set_temperature'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_alarm_climate_water_heater.py", "lineno": 69, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0b742b0>\n\n    async def test_climate_set_temperature_stores_attr(rest):\n        \"\"\"Climate set_temperature stores temperature and target_temp_high/low.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"climate.tattr_{tag}\"\n        await rest.set_state(eid, \"heat\")\n    \n>       await rest.call_service(\"climate\", \"set_temperature\", {\n            \"entity_id\": eid,\n            \"temperature\": 68,\n        })\n\ntests/entity/test_alarm_climate_water_heater.py:69: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/climate/set_temperature'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0006845030002295971, "outcome": "passed"}}, {"nodeid": "tests/entity/test_attribute_preservation.py::test_light_turn_on_preserves_brightness", "lineno": 15, "outcome": "failed", "keywords": ["test_light_turn_on_preserves_brightness", "test_attribute_preservation.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005547706037759781, "outcome": "passed"}, "call": {"duration": 0.0039828987792134285, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/light/turn_off'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_attribute_preservation.py", "lineno": 19, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0d70880>\n\n    async def test_light_turn_on_preserves_brightness(rest):\n        \"\"\"Turning on a light preserves existing brightness.\"\"\"\n        await rest.set_state(\"light.ap_bright\", \"on\", {\"brightness\": 150})\n>       await rest.call_service(\"light\", \"turn_off\", {\n            \"entity_id\": \"light.ap_bright\",\n        })\n\ntests/entity/test_attribute_preservation.py:19: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/light/turn_off'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0006738188676536083, "outcome": "passed"}}, {"nodeid": "tests/entity/test_attribute_preservation.py::test_light_turn_on_adds_brightness", "lineno": 26, "outcome": "failed", "keywords": ["test_light_turn_on_adds_brightness", "test_attribute_preservation.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005303211975842714, "outcome": "passed"}, "call": {"duration": 0.003976521082222462, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/light/turn_on'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_attribute_preservation.py", "lineno": 30, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0cfe880>\n\n    async def test_light_turn_on_adds_brightness(rest):\n        \"\"\"Turning on with brightness adds it to existing attrs.\"\"\"\n        await rest.set_state(\"light.ap_add_bright\", \"off\", {\"friendly_name\": \"Test Light\"})\n>       await rest.call_service(\"light\", \"turn_on\", {\n            \"entity_id\": \"light.ap_add_bright\",\n            \"brightness\": 200,\n        })\n\ntests/entity/test_attribute_preservation.py:30: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/light/turn_on'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0006393189541995525, "outcome": "passed"}}, {"nodeid": "tests/entity/test_attribute_preservation.py::test_light_color_temp_preserved", "lineno": 39, "outcome": "failed", "keywords": ["test_light_color_temp_preserved", "test_attribute_preservation.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005257762037217617, "outcome": "passed"}, "call": {"duration": 0.004034846089780331, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/light/toggle'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_attribute_preservation.py", "lineno": 43, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0ce9220>\n\n    async def test_light_color_temp_preserved(rest):\n        \"\"\"color_temp attribute preserved through toggle.\"\"\"\n        await rest.set_state(\"light.ap_ct\", \"on\", {\"color_temp\": 300})\n>       await rest.call_service(\"light\", \"toggle\", {\n            \"entity_id\": \"light.ap_ct\",\n        })\n\ntests/entity/test_attribute_preservation.py:43: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/light/toggle'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0006859172135591507, "outcome": "passed"}}, {"nodeid": "tests/entity/test_attribute_preservation.py::test_light_multiple_attrs_on_turn_on", "lineno": 50, "outcome": "failed", "keywords": ["test_light_multiple_attrs_on_turn_on", "test_attribute_preservation.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005199145060032606, "outcome": "passed"}, "call": {"duration": 0.005353571381419897, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/light/turn_on'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_attribute_preservation.py", "lineno": 54, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0dd7be0>\n\n    async def test_light_multiple_attrs_on_turn_on(rest):\n        \"\"\"Multiple attributes set on turn_on.\"\"\"\n        await rest.set_state(\"light.ap_multi\", \"off\")\n>       await rest.call_service(\"light\", \"turn_on\", {\n            \"entity_id\": \"light.ap_multi\",\n            \"brightness\": 255,\n            \"rgb_color\": [0, 255, 0],\n            \"effect\": \"rainbow\",\n        })\n\ntests/entity/test_attribute_preservation.py:54: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/light/turn_on'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0006553428247570992, "outcome": "passed"}}, {"nodeid": "tests/entity/test_attribute_preservation.py::test_climate_set_temp_preserves_fan_mode", "lineno": 67, "outcome": "failed", "keywords": ["test_climate_set_temp_preserves_fan_mode", "test_attribute_preservation.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005338571034371853, "outcome": "passed"}, "call": {"duration": 0.005359041038900614, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/climate/set_temperature'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_attribute_preservation.py", "lineno": 71, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0c4a550>\n\n    async def test_climate_set_temp_preserves_fan_mode(rest):\n        \"\"\"Setting temperature preserves fan_mode.\"\"\"\n        await rest.set_state(\"climate.ap_clim\", \"heat\", {\"fan_mode\": \"low\"})\n>       await rest.call_service(\"climate\", \"set_temperature\", {\n            \"entity_id\": \"climate.ap_clim\",\n            \"temperature\": 72,\n        })\n\ntests/entity/test_attribute_preservation.py:71: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/climate/set_temperature'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0007064142264425755, "outcome": "passed"}}, {"nodeid": "tests/entity/test_attribute_preservation.py::test_climate_set_fan_mode_preserves_temp", "lineno": 79, "outcome": "failed", "keywords": ["test_climate_set_fan_mode_preserves_temp", "test_attribute_preservation.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005156463012099266, "outcome": "passed"}, "call": {"duration": 0.004141919780522585, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/climate/set_fan_mode'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_attribute_preservation.py", "lineno": 83, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0c7c460>\n\n    async def test_climate_set_fan_mode_preserves_temp(rest):\n        \"\"\"Setting fan_mode preserves temperature.\"\"\"\n        await rest.set_state(\"climate.ap_clim2\", \"heat\", {\"temperature\": 68})\n>       await rest.call_service(\"climate\", \"set_fan_mode\", {\n            \"entity_id\": \"climate.ap_clim2\",\n            \"fan_mode\": \"high\",\n        })\n\ntests/entity/test_attribute_preservation.py:83: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/climate/set_fan_mode'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0006689229048788548, "outcome": "passed"}}, {"nodeid": "tests/entity/test_attribute_preservation.py::test_fan_turn_on_preserves_direction", "lineno": 93, "outcome": "failed", "keywords": ["test_fan_turn_on_preserves_direction", "test_attribute_preservation.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005534530151635408, "outcome": "passed"}, "call": {"duration": 0.003869256004691124, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/fan/turn_on'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_attribute_preservation.py", "lineno": 97, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0c09fa0>\n\n    async def test_fan_turn_on_preserves_direction(rest):\n        \"\"\"Turning on fan preserves direction attribute.\"\"\"\n        await rest.set_state(\"fan.ap_fan\", \"off\", {\"direction\": \"forward\"})\n>       await rest.call_service(\"fan\", \"turn_on\", {\n            \"entity_id\": \"fan.ap_fan\",\n        })\n\ntests/entity/test_attribute_preservation.py:97: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/fan/turn_on'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0006678332574665546, "outcome": "passed"}}, {"nodeid": "tests/entity/test_attribute_preservation.py::test_fan_set_direction_preserves_percentage", "lineno": 104, "outcome": "failed", "keywords": ["test_fan_set_direction_preserves_percentage", "test_attribute_preservation.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.006556028965860605, "outcome": "passed"}, "call": {"duration": 0.004065779037773609, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/fan/set_direction'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_attribute_preservation.py", "lineno": 108, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0c4ac10>\n\n    async def test_fan_set_direction_preserves_percentage(rest):\n        \"\"\"Setting direction preserves percentage.\"\"\"\n        await rest.set_state(\"fan.ap_fan2\", \"on\", {\"percentage\": 75})\n>       await rest.call_service(\"fan\", \"set_direction\", {\n            \"entity_id\": \"fan.ap_fan2\",\n            \"direction\": \"reverse\",\n        })\n\ntests/entity/test_attribute_preservation.py:108: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/fan/set_direction'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0006809867918491364, "outcome": "passed"}}, {"nodeid": "tests/entity/test_attribute_preservation.py::test_media_player_volume_preserves_source", "lineno": 118, "outcome": "failed", "keywords": ["test_media_player_volume_preserves_source", "test_attribute_preservation.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.00639039883390069, "outcome": "passed"}, "call": {"duration": 0.004281088709831238, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/media_player/volume_set'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_attribute_preservation.py", "lineno": 122, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0fe7a30>\n\n    async def test_media_player_volume_preserves_source(rest):\n        \"\"\"Volume set preserves source attribute.\"\"\"\n        await rest.set_state(\"media_player.ap_mp\", \"playing\", {\"source\": \"HDMI 1\"})\n>       await rest.call_service(\"media_player\", \"volume_set\", {\n            \"entity_id\": \"media_player.ap_mp\",\n            \"volume_level\": 0.5,\n        })\n\ntests/entity/test_attribute_preservation.py:122: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/media_player/volume_set'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0009108232334256172, "outcome": "passed"}}, {"nodeid": "tests/entity/test_attribute_preservation.py::test_media_player_source_preserves_volume", "lineno": 130, "outcome": "failed", "keywords": ["test_media_player_source_preserves_volume", "test_attribute_preservation.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.0063258809968829155, "outcome": "passed"}, "call": {"duration": 0.004055019002407789, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/media_player/select_source'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_attribute_preservation.py", "lineno": 134, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0b9d6d0>\n\n    async def test_media_player_source_preserves_volume(rest):\n        \"\"\"Source select preserves volume_level attribute.\"\"\"\n        await rest.set_state(\"media_player.ap_mp2\", \"playing\", {\"volume_level\": 0.8})\n>       await rest.call_service(\"media_player\", \"select_source\", {\n            \"entity_id\": \"media_player.ap_mp2\",\n            \"source\": \"Bluetooth\",\n        })\n\ntests/entity/test_attribute_preservation.py:134: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/media_player/select_source'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0006522350013256073, "outcome": "passed"}}, {"nodeid": "tests/entity/test_attribute_preservation.py::test_cover_toggle_updates_position", "lineno": 144, "outcome": "failed", "keywords": ["test_cover_toggle_updates_position", "test_attribute_preservation.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.0052416399121284485, "outcome": "passed"}, "call": {"duration": 0.004842822905629873, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/cover/toggle'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_attribute_preservation.py", "lineno": 148, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0e69d30>\n\n    async def test_cover_toggle_updates_position(rest):\n        \"\"\"Cover toggle from open\u2192closed sets position to 0.\"\"\"\n        await rest.set_state(\"cover.ap_cov\", \"open\", {\"current_position\": 100})\n>       await rest.call_service(\"cover\", \"toggle\", {\n            \"entity_id\": \"cover.ap_cov\",\n        })\n\ntests/entity/test_attribute_preservation.py:148: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/cover/toggle'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0007566106505692005, "outcome": "passed"}}, {"nodeid": "tests/entity/test_attribute_preservation.py::test_cover_toggle_from_closed_sets_position", "lineno": 155, "outcome": "failed", "keywords": ["test_cover_toggle_from_closed_sets_position", "test_attribute_preservation.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005159066990017891, "outcome": "passed"}, "call": {"duration": 0.0042418851517140865, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/cover/toggle'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_attribute_preservation.py", "lineno": 159, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0e69910>\n\n    async def test_cover_toggle_from_closed_sets_position(rest):\n        \"\"\"Cover toggle from closed\u2192open sets position to 100.\"\"\"\n        await rest.set_state(\"cover.ap_cov2\", \"closed\", {\"current_position\": 0})\n>       await rest.call_service(\"cover\", \"toggle\", {\n            \"entity_id\": \"cover.ap_cov2\",\n        })\n\ntests/entity/test_attribute_preservation.py:159: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/cover/toggle'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0006978409364819527, "outcome": "passed"}}, {"nodeid": "tests/entity/test_attribute_preservation.py::test_humidifier_turn_off_preserves_humidity", "lineno": 168, "outcome": "failed", "keywords": ["test_humidifier_turn_off_preserves_humidity", "test_attribute_preservation.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.006113196257501841, "outcome": "passed"}, "call": {"duration": 0.004885057918727398, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/humidifier/turn_off'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_attribute_preservation.py", "lineno": 172, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0b2c4f0>\n\n    async def test_humidifier_turn_off_preserves_humidity(rest):\n        \"\"\"Turning off humidifier preserves humidity setting.\"\"\"\n        await rest.set_state(\"humidifier.ap_hum\", \"on\", {\"humidity\": 60})\n>       await rest.call_service(\"humidifier\", \"turn_off\", {\n            \"entity_id\": \"humidifier.ap_hum\",\n        })\n\ntests/entity/test_attribute_preservation.py:172: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/humidifier/turn_off'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0007846062071621418, "outcome": "passed"}}, {"nodeid": "tests/entity/test_attribute_preservation.py::test_humidifier_set_mode_preserves_humidity", "lineno": 179, "outcome": "failed", "keywords": ["test_humidifier_set_mode_preserves_humidity", "test_attribute_preservation.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005460370797663927, "outcome": "passed"}, "call": {"duration": 0.0046624066308140755, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/humidifier/set_mode'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_attribute_preservation.py", "lineno": 183, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0d242e0>\n\n    async def test_humidifier_set_mode_preserves_humidity(rest):\n        \"\"\"Setting mode preserves humidity attribute.\"\"\"\n        await rest.set_state(\"humidifier.ap_hum2\", \"on\", {\"humidity\": 55})\n>       await rest.call_service(\"humidifier\", \"set_mode\", {\n            \"entity_id\": \"humidifier.ap_hum2\",\n            \"mode\": \"eco\",\n        })\n\ntests/entity/test_attribute_preservation.py:183: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/humidifier/set_mode'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0006650760769844055, "outcome": "passed"}}, {"nodeid": "tests/entity/test_climate_extended.py::test_climate_set_temperature_high_low", "lineno": 14, "outcome": "failed", "keywords": ["test_climate_set_temperature_high_low", "test_climate_extended.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.0053536961786448956, "outcome": "passed"}, "call": {"duration": 0.005919096991419792, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/entity/test_climate_extended.py", "lineno": 32, "message": "KeyError: 'target_temp_high'"}, "traceback": [{"path": "tests/entity/test_climate_extended.py", "lineno": 32, "message": "KeyError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0d3b880>\n\n    async def test_climate_set_temperature_high_low(rest):\n        \"\"\"climate.set_temperature with target_temp_high/low stores both.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"climate.chl_{tag}\"\n        await rest.set_state(eid, \"auto\")\n    \n        await rest.client.post(\n            f\"{rest.base_url}/api/services/climate/set_temperature\",\n            json={\n                \"entity_id\": eid,\n                \"target_temp_high\": 78,\n                \"target_temp_low\": 68,\n            },\n            headers=rest._headers(),\n        )\n    \n        state = await rest.get_state(eid)\n>       assert state[\"attributes\"][\"target_temp_high\"] == 78\nE       KeyError: 'target_temp_high'\n\ntests/entity/test_climate_extended.py:32: KeyError"}, "teardown": {"duration": 0.0006184782832860947, "outcome": "passed"}}, {"nodeid": "tests/entity/test_climate_extended.py::test_climate_set_preset_mode", "lineno": 35, "outcome": "failed", "keywords": ["test_climate_set_preset_mode", "test_climate_extended.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.0051704393699765205, "outcome": "passed"}, "call": {"duration": 0.004910334944725037, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/entity/test_climate_extended.py", "lineno": 49, "message": "KeyError: 'preset_mode'"}, "traceback": [{"path": "tests/entity/test_climate_extended.py", "lineno": 49, "message": "KeyError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0b41d60>\n\n    async def test_climate_set_preset_mode(rest):\n        \"\"\"climate.set_preset_mode stores preset_mode attribute.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"climate.cpm_{tag}\"\n        await rest.set_state(eid, \"auto\")\n    \n        await rest.client.post(\n            f\"{rest.base_url}/api/services/climate/set_preset_mode\",\n            json={\"entity_id\": eid, \"preset_mode\": \"eco\"},\n            headers=rest._headers(),\n        )\n    \n        state = await rest.get_state(eid)\n>       assert state[\"attributes\"][\"preset_mode\"] == \"eco\"\nE       KeyError: 'preset_mode'\n\ntests/entity/test_climate_extended.py:49: KeyError"}, "teardown": {"duration": 0.0006963522173464298, "outcome": "passed"}}, {"nodeid": "tests/entity/test_climate_extended.py::test_climate_set_swing_mode", "lineno": 51, "outcome": "failed", "keywords": ["test_climate_set_swing_mode", "test_climate_extended.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.0052295890636742115, "outcome": "passed"}, "call": {"duration": 0.00531385000795126, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/entity/test_climate_extended.py", "lineno": 65, "message": "KeyError: 'swing_mode'"}, "traceback": [{"path": "tests/entity/test_climate_extended.py", "lineno": 65, "message": "KeyError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0b885b0>\n\n    async def test_climate_set_swing_mode(rest):\n        \"\"\"climate.set_swing_mode stores swing_mode attribute.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"climate.csm_{tag}\"\n        await rest.set_state(eid, \"cool\")\n    \n        await rest.client.post(\n            f\"{rest.base_url}/api/services/climate/set_swing_mode\",\n            json={\"entity_id\": eid, \"swing_mode\": \"vertical\"},\n            headers=rest._headers(),\n        )\n    \n        state = await rest.get_state(eid)\n>       assert state[\"attributes\"][\"swing_mode\"] == \"vertical\"\nE       KeyError: 'swing_mode'\n\ntests/entity/test_climate_extended.py:65: KeyError"}, "teardown": {"duration": 0.00066010607406497, "outcome": "passed"}}, {"nodeid": "tests/entity/test_climate_extended.py::test_climate_turn_on", "lineno": 67, "outcome": "failed", "keywords": ["test_climate_turn_on", "test_climate_extended.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.0050968993455171585, "outcome": "passed"}, "call": {"duration": 0.005367999896407127, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/entity/test_climate_extended.py", "lineno": 81, "message": "AssertionError: assert 'off' == 'on'\n  \n  - on\n  + off"}, "traceback": [{"path": "tests/entity/test_climate_extended.py", "lineno": 81, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0d76970>\n\n    async def test_climate_turn_on(rest):\n        \"\"\"climate.turn_on sets state to on.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"climate.con_{tag}\"\n        await rest.set_state(eid, \"off\")\n    \n        await rest.client.post(\n            f\"{rest.base_url}/api/services/climate/turn_on\",\n            json={\"entity_id\": eid},\n            headers=rest._headers(),\n        )\n    \n        state = await rest.get_state(eid)\n>       assert state[\"state\"] == \"on\"\nE       AssertionError: assert 'off' == 'on'\nE         \nE         - on\nE         + off\n\ntests/entity/test_climate_extended.py:81: AssertionError"}, "teardown": {"duration": 0.0005974569357931614, "outcome": "passed"}}, {"nodeid": "tests/entity/test_climate_extended.py::test_climate_turn_off", "lineno": 83, "outcome": "failed", "keywords": ["test_climate_turn_off", "test_climate_extended.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.00569421099498868, "outcome": "passed"}, "call": {"duration": 0.0064186169765889645, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/entity/test_climate_extended.py", "lineno": 97, "message": "AssertionError: assert 'heat' == 'off'\n  \n  - off\n  + heat"}, "traceback": [{"path": "tests/entity/test_climate_extended.py", "lineno": 97, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0de3fa0>\n\n    async def test_climate_turn_off(rest):\n        \"\"\"climate.turn_off sets state to off.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"climate.coff_{tag}\"\n        await rest.set_state(eid, \"heat\")\n    \n        await rest.client.post(\n            f\"{rest.base_url}/api/services/climate/turn_off\",\n            json={\"entity_id\": eid},\n            headers=rest._headers(),\n        )\n    \n        state = await rest.get_state(eid)\n>       assert state[\"state\"] == \"off\"\nE       AssertionError: assert 'heat' == 'off'\nE         \nE         - off\nE         + heat\n\ntests/entity/test_climate_extended.py:97: AssertionError"}, "teardown": {"duration": 0.0007270351052284241, "outcome": "passed"}}, {"nodeid": "tests/entity/test_climate_extended.py::test_climate_lifecycle", "lineno": 99, "outcome": "failed", "keywords": ["test_climate_lifecycle", "test_climate_extended.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.0050949882715940475, "outcome": "passed"}, "call": {"duration": 0.005752800963819027, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/entity/test_climate_extended.py", "lineno": 113, "message": "AssertionError: assert 'off' == 'heat'\n  \n  - heat\n  + off"}, "traceback": [{"path": "tests/entity/test_climate_extended.py", "lineno": 113, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0cafca0>\n\n    async def test_climate_lifecycle(rest):\n        \"\"\"Climate lifecycle: off -> heat -> cool -> auto -> off.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"climate.clc_{tag}\"\n        await rest.set_state(eid, \"off\")\n    \n        for mode in [\"heat\", \"cool\", \"auto\", \"off\"]:\n            await rest.client.post(\n                f\"{rest.base_url}/api/services/climate/set_hvac_mode\",\n                json={\"entity_id\": eid, \"hvac_mode\": mode},\n                headers=rest._headers(),\n            )\n            state = await rest.get_state(eid)\n>           assert state[\"state\"] == mode\nE           AssertionError: assert 'off' == 'heat'\nE             \nE             - heat\nE             + off\n\ntests/entity/test_climate_extended.py:113: AssertionError"}, "teardown": {"duration": 0.0007842499762773514, "outcome": "passed"}}, {"nodeid": "tests/entity/test_climate_extended.py::test_climate_temperature_preserves_across_mode_changes", "lineno": 115, "outcome": "failed", "keywords": ["test_climate_temperature_preserves_across_mode_changes", "test_climate_extended.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005520655773580074, "outcome": "passed"}, "call": {"duration": 0.0068550859577953815, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/entity/test_climate_extended.py", "lineno": 135, "message": "AssertionError: assert 'heat' == 'cool'\n  \n  - cool\n  + heat"}, "traceback": [{"path": "tests/entity/test_climate_extended.py", "lineno": 135, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0b9d6a0>\n\n    async def test_climate_temperature_preserves_across_mode_changes(rest):\n        \"\"\"Temperature attribute survives HVAC mode changes.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"climate.ctp_{tag}\"\n        await rest.set_state(eid, \"heat\")\n    \n        await rest.client.post(\n            f\"{rest.base_url}/api/services/climate/set_temperature\",\n            json={\"entity_id\": eid, \"temperature\": 72},\n            headers=rest._headers(),\n        )\n    \n        await rest.client.post(\n            f\"{rest.base_url}/api/services/climate/set_hvac_mode\",\n            json={\"entity_id\": eid, \"hvac_mode\": \"cool\"},\n            headers=rest._headers(),\n        )\n    \n        state = await rest.get_state(eid)\n>       assert state[\"state\"] == \"cool\"\nE       AssertionError: assert 'heat' == 'cool'\nE         \nE         - cool\nE         + heat\n\ntests/entity/test_climate_extended.py:135: AssertionError"}, "teardown": {"duration": 0.0006634071469306946, "outcome": "passed"}}, {"nodeid": "tests/entity/test_climate_extended.py::test_climate_set_temperature", "lineno": 141, "outcome": "failed", "keywords": ["test_climate_set_temperature", "test_climate_extended.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.00517481891438365, "outcome": "passed"}, "call": {"duration": 0.004091292154043913, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/climate/set_temperature'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_climate_extended.py", "lineno": 146, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0b20e20>\n\n    async def test_climate_set_temperature(rest):\n        \"\"\"climate.set_temperature updates the temperature attribute.\"\"\"\n        entity_id = \"climate.test_temp\"\n        await rest.set_state(entity_id, \"heat\", {\"temperature\": 66})\n>       await rest.call_service(\"climate\", \"set_temperature\", {\n            \"entity_id\": entity_id,\n            \"temperature\": 72,\n        })\n\ntests/entity/test_climate_extended.py:146: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/climate/set_temperature'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0008837650530040264, "outcome": "passed"}}, {"nodeid": "tests/entity/test_climate_extended.py::test_climate_set_hvac_mode", "lineno": 153, "outcome": "failed", "keywords": ["test_climate_set_hvac_mode", "test_climate_extended.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005220773164182901, "outcome": "passed"}, "call": {"duration": 0.004091302398592234, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/climate/set_hvac_mode'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_climate_extended.py", "lineno": 158, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0350670>\n\n    async def test_climate_set_hvac_mode(rest):\n        \"\"\"climate.set_hvac_mode changes the state to the mode.\"\"\"\n        entity_id = \"climate.test_mode\"\n        await rest.set_state(entity_id, \"heat\")\n>       await rest.call_service(\"climate\", \"set_hvac_mode\", {\n            \"entity_id\": entity_id,\n            \"hvac_mode\": \"cool\",\n        })\n\ntests/entity/test_climate_extended.py:158: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/climate/set_hvac_mode'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0007269461639225483, "outcome": "passed"}}, {"nodeid": "tests/entity/test_climate_extended.py::test_climate_set_hvac_mode_off", "lineno": 165, "outcome": "failed", "keywords": ["test_climate_set_hvac_mode_off", "test_climate_extended.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005789896007627249, "outcome": "passed"}, "call": {"duration": 0.0042606317438185215, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/climate/set_hvac_mode'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_climate_extended.py", "lineno": 170, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0b83b80>\n\n    async def test_climate_set_hvac_mode_off(rest):\n        \"\"\"climate.set_hvac_mode to 'off' turns off HVAC, preserves temperature.\"\"\"\n        entity_id = \"climate.test_mode_off\"\n        await rest.set_state(entity_id, \"heat\", {\"temperature\": 70})\n>       await rest.call_service(\"climate\", \"set_hvac_mode\", {\n            \"entity_id\": entity_id,\n            \"hvac_mode\": \"off\",\n        })\n\ntests/entity/test_climate_extended.py:170: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/climate/set_hvac_mode'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.000735933892428875, "outcome": "passed"}}, {"nodeid": "tests/entity/test_climate_extended.py::test_climate_set_fan_mode", "lineno": 178, "outcome": "failed", "keywords": ["test_climate_set_fan_mode", "test_climate_extended.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.0052564251236617565, "outcome": "passed"}, "call": {"duration": 0.004400077275931835, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/climate/set_fan_mode'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_climate_extended.py", "lineno": 183, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0bb9ac0>\n\n    async def test_climate_set_fan_mode(rest):\n        \"\"\"climate.set_fan_mode updates the fan_mode attribute.\"\"\"\n        entity_id = \"climate.test_fan\"\n        await rest.set_state(entity_id, \"cool\", {\"fan_mode\": \"auto\"})\n>       await rest.call_service(\"climate\", \"set_fan_mode\", {\n            \"entity_id\": entity_id,\n            \"fan_mode\": \"high\",\n        })\n\ntests/entity/test_climate_extended.py:183: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/climate/set_fan_mode'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0007180809043347836, "outcome": "passed"}}, {"nodeid": "tests/entity/test_climate_extended.py::test_climate_set_temperature_preserves_mode", "lineno": 191, "outcome": "failed", "keywords": ["test_climate_set_temperature_preserves_mode", "test_climate_extended.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005748559720814228, "outcome": "passed"}, "call": {"duration": 0.004170170985162258, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/climate/set_temperature'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_climate_extended.py", "lineno": 196, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b04f7400>\n\n    async def test_climate_set_temperature_preserves_mode(rest):\n        \"\"\"climate.set_temperature preserves the current HVAC mode.\"\"\"\n        entity_id = \"climate.test_temp_mode\"\n        await rest.set_state(entity_id, \"auto\", {\"temperature\": 68})\n>       await rest.call_service(\"climate\", \"set_temperature\", {\n            \"entity_id\": entity_id,\n            \"temperature\": 74,\n        })\n\ntests/entity/test_climate_extended.py:196: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/climate/set_temperature'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0007018712349236012, "outcome": "passed"}}, {"nodeid": "tests/entity/test_domain_state_formats.py::test_light_on_off_states", "lineno": 14, "outcome": "failed", "keywords": ["test_light_on_off_states", "test_domain_state_formats.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005490640178322792, "outcome": "passed"}, "call": {"duration": 0.004297476261854172, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/light/turn_on'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_domain_state_formats.py", "lineno": 20, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b03fbeb0>\n\n    async def test_light_on_off_states(rest):\n        \"\"\"Light domain: turn_on \u2192 'on', turn_off \u2192 'off'.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"light.fmt_{tag}\"\n        await rest.set_state(eid, \"off\")\n>       await rest.call_service(\"light\", \"turn_on\", {\"entity_id\": eid})\n\ntests/entity/test_domain_state_formats.py:20: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/light/turn_on'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0006693736650049686, "outcome": "passed"}}, {"nodeid": "tests/entity/test_domain_state_formats.py::test_switch_on_off_states", "lineno": 25, "outcome": "failed", "keywords": ["test_switch_on_off_states", "test_domain_state_formats.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005280669778585434, "outcome": "passed"}, "call": {"duration": 0.00437687523663044, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/switch/turn_on'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_domain_state_formats.py", "lineno": 31, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0b26f10>\n\n    async def test_switch_on_off_states(rest):\n        \"\"\"Switch domain: turn_on \u2192 'on', turn_off \u2192 'off'.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"switch.fmt_{tag}\"\n        await rest.set_state(eid, \"off\")\n>       await rest.call_service(\"switch\", \"turn_on\", {\"entity_id\": eid})\n\ntests/entity/test_domain_state_formats.py:31: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/switch/turn_on'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0006679068319499493, "outcome": "passed"}}, {"nodeid": "tests/entity/test_domain_state_formats.py::test_lock_locked_unlocked_states", "lineno": 36, "outcome": "failed", "keywords": ["test_lock_locked_unlocked_states", "test_domain_state_formats.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005388321354985237, "outcome": "passed"}, "call": {"duration": 0.00430584792047739, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/lock/lock'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_domain_state_formats.py", "lineno": 42, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0c9dfa0>\n\n    async def test_lock_locked_unlocked_states(rest):\n        \"\"\"Lock domain: lock \u2192 'locked', unlock \u2192 'unlocked'.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"lock.fmt_{tag}\"\n        await rest.set_state(eid, \"unlocked\")\n>       await rest.call_service(\"lock\", \"lock\", {\"entity_id\": eid})\n\ntests/entity/test_domain_state_formats.py:42: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/lock/lock'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0007196958176791668, "outcome": "passed"}}, {"nodeid": "tests/entity/test_domain_state_formats.py::test_cover_open_closed_states", "lineno": 47, "outcome": "failed", "keywords": ["test_cover_open_closed_states", "test_domain_state_formats.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005550090689212084, "outcome": "passed"}, "call": {"duration": 0.004553363658487797, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/cover/open_cover'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_domain_state_formats.py", "lineno": 53, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0d24370>\n\n    async def test_cover_open_closed_states(rest):\n        \"\"\"Cover domain: open \u2192 'open', close \u2192 'closed'.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"cover.fmt_{tag}\"\n        await rest.set_state(eid, \"closed\")\n>       await rest.call_service(\"cover\", \"open_cover\", {\"entity_id\": eid})\n\ntests/entity/test_domain_state_formats.py:53: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/cover/open_cover'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.000681866891682148, "outcome": "passed"}}, {"nodeid": "tests/entity/test_domain_state_formats.py::test_siren_on_off_states", "lineno": 58, "outcome": "failed", "keywords": ["test_siren_on_off_states", "test_domain_state_formats.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005552014801651239, "outcome": "passed"}, "call": {"duration": 0.004307095892727375, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/siren/turn_on'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_domain_state_formats.py", "lineno": 64, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0b88160>\n\n    async def test_siren_on_off_states(rest):\n        \"\"\"Siren domain: turn_on \u2192 'on', turn_off \u2192 'off'.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"siren.fmt_{tag}\"\n        await rest.set_state(eid, \"off\")\n>       await rest.call_service(\"siren\", \"turn_on\", {\"entity_id\": eid})\n\ntests/entity/test_domain_state_formats.py:64: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/siren/turn_on'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0007057669572532177, "outcome": "passed"}}, {"nodeid": "tests/entity/test_domain_state_formats.py::test_vacuum_state_values", "lineno": 69, "outcome": "failed", "keywords": ["test_vacuum_state_values", "test_domain_state_formats.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005715641658753157, "outcome": "passed"}, "call": {"duration": 0.004927678033709526, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/vacuum/start'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_domain_state_formats.py", "lineno": 76, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0dd7670>\n\n    async def test_vacuum_state_values(rest):\n        \"\"\"Vacuum domain: start \u2192 'cleaning', stop \u2192 'idle', return_to_base \u2192 'returning'.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"vacuum.fmt_{tag}\"\n        await rest.set_state(eid, \"docked\")\n    \n>       await rest.call_service(\"vacuum\", \"start\", {\"entity_id\": eid})\n\ntests/entity/test_domain_state_formats.py:76: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/vacuum/start'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0006470521911978722, "outcome": "passed"}}, {"nodeid": "tests/entity/test_domain_state_formats.py::test_vacuum_lifecycle", "lineno": 88, "outcome": "failed", "keywords": ["test_vacuum_lifecycle", "test_domain_state_formats.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005371285602450371, "outcome": "passed"}, "call": {"duration": 0.004052707925438881, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/vacuum/start'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_domain_state_formats.py", "lineno": 95, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0e28880>\n\n    async def test_vacuum_lifecycle(rest):\n        \"\"\"Full vacuum lifecycle: docked -> cleaning -> paused -> cleaning -> returning.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"vacuum.lc_{tag}\"\n        await rest.set_state(eid, \"docked\")\n    \n>       await rest.call_service(\"vacuum\", \"start\", {\"entity_id\": eid})\n\ntests/entity/test_domain_state_formats.py:95: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/vacuum/start'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0008208169601857662, "outcome": "passed"}}, {"nodeid": "tests/entity/test_domain_state_formats.py::test_valve_open_closed_states", "lineno": 107, "outcome": "failed", "keywords": ["test_valve_open_closed_states", "test_domain_state_formats.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005276940297335386, "outcome": "passed"}, "call": {"duration": 0.004441677127033472, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/valve/open_valve'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_domain_state_formats.py", "lineno": 113, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0c09520>\n\n    async def test_valve_open_closed_states(rest):\n        \"\"\"Valve domain: open \u2192 'open', close \u2192 'closed'.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"valve.fmt_{tag}\"\n        await rest.set_state(eid, \"closed\")\n>       await rest.call_service(\"valve\", \"open_valve\", {\"entity_id\": eid})\n\ntests/entity/test_domain_state_formats.py:113: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/valve/open_valve'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0006784079596400261, "outcome": "passed"}}, {"nodeid": "tests/entity/test_domain_state_formats.py::test_alarm_arm_states", "lineno": 118, "outcome": "failed", "keywords": ["test_alarm_arm_states", "test_domain_state_formats.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005241199862211943, "outcome": "passed"}, "call": {"duration": 0.004377327859401703, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/alarm_control_panel/arm_home'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_domain_state_formats.py", "lineno": 125, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0b1cf70>\n\n    async def test_alarm_arm_states(rest):\n        \"\"\"Alarm panel: arm_home \u2192 'armed_home', arm_away \u2192 'armed_away', disarm \u2192 'disarmed'.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"alarm_control_panel.fmt_{tag}\"\n        await rest.set_state(eid, \"disarmed\")\n    \n>       await rest.call_service(\"alarm_control_panel\", \"arm_home\", {\"entity_id\": eid})\n\ntests/entity/test_domain_state_formats.py:125: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/alarm_control_panel/arm_home'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0007228720933198929, "outcome": "passed"}}, {"nodeid": "tests/entity/test_domain_state_formats.py::test_fan_on_off_states", "lineno": 137, "outcome": "failed", "keywords": ["test_fan_on_off_states", "test_domain_state_formats.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.00546679412946105, "outcome": "passed"}, "call": {"duration": 0.0044928910210728645, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/fan/turn_on'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_domain_state_formats.py", "lineno": 143, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0d6da90>\n\n    async def test_fan_on_off_states(rest):\n        \"\"\"Fan domain: turn_on \u2192 'on', turn_off \u2192 'off'.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"fan.fmt_{tag}\"\n        await rest.set_state(eid, \"off\")\n>       await rest.call_service(\"fan\", \"turn_on\", {\"entity_id\": eid})\n\ntests/entity/test_domain_state_formats.py:143: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/fan/turn_on'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0006642690859735012, "outcome": "passed"}}, {"nodeid": "tests/entity/test_domain_state_formats.py::test_camera_streaming_idle", "lineno": 148, "outcome": "failed", "keywords": ["test_camera_streaming_idle", "test_domain_state_formats.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005221663974225521, "outcome": "passed"}, "call": {"duration": 0.004103433340787888, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/camera/turn_on'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_domain_state_formats.py", "lineno": 154, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0c46b80>\n\n    async def test_camera_streaming_idle(rest):\n        \"\"\"Camera domain: turn_on \u2192 'streaming', turn_off \u2192 'idle'.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"camera.fmt_{tag}\"\n        await rest.set_state(eid, \"idle\")\n>       await rest.call_service(\"camera\", \"turn_on\", {\"entity_id\": eid})\n\ntests/entity/test_domain_state_formats.py:154: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/camera/turn_on'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0006619528867304325, "outcome": "passed"}}, {"nodeid": "tests/entity/test_domain_state_formats.py::test_number_set_value_state", "lineno": 159, "outcome": "failed", "keywords": ["test_number_set_value_state", "test_domain_state_formats.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005569649860262871, "outcome": "passed"}, "call": {"duration": 0.003922509029507637, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/number/set_value'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_domain_state_formats.py", "lineno": 165, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0b9e520>\n\n    async def test_number_set_value_state(rest):\n        \"\"\"Number domain: set_value stores numeric string.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"number.fmt_{tag}\"\n        await rest.set_state(eid, \"0\")\n>       await rest.call_service(\"number\", \"set_value\", {\n            \"entity_id\": eid,\n            \"value\": 75,\n        })\n\ntests/entity/test_domain_state_formats.py:165: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/number/set_value'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0006853011436760426, "outcome": "passed"}}, {"nodeid": "tests/entity/test_domain_state_formats.py::test_select_option_state", "lineno": 171, "outcome": "failed", "keywords": ["test_select_option_state", "test_domain_state_formats.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005430254153907299, "outcome": "passed"}, "call": {"duration": 0.004512418061494827, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/select/select_option'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_domain_state_formats.py", "lineno": 177, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b035d5b0>\n\n    async def test_select_option_state(rest):\n        \"\"\"Select domain: select_option stores option string.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"select.fmt_{tag}\"\n        await rest.set_state(eid, \"option_a\")\n>       await rest.call_service(\"select\", \"select_option\", {\n            \"entity_id\": eid,\n            \"option\": \"option_b\",\n        })\n\ntests/entity/test_domain_state_formats.py:177: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/select/select_option'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0006806729361414909, "outcome": "passed"}}, {"nodeid": "tests/entity/test_domain_toggles.py::test_light_turn_on", "lineno": 15, "outcome": "failed", "keywords": ["test_light_turn_on", "test_domain_toggles.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005205977242439985, "outcome": "passed"}, "call": {"duration": 0.004579720087349415, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/light/turn_on'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_domain_toggles.py", "lineno": 19, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0b88c10>\n\n    async def test_light_turn_on(rest):\n        \"\"\"light.turn_on sets state to 'on'.\"\"\"\n        await rest.set_state(\"light.dt_lt_on\", \"off\")\n>       await rest.call_service(\"light\", \"turn_on\", {\"entity_id\": \"light.dt_lt_on\"})\n\ntests/entity/test_domain_toggles.py:19: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/light/turn_on'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0007173218764364719, "outcome": "passed"}}, {"nodeid": "tests/entity/test_domain_toggles.py::test_light_turn_off", "lineno": 23, "outcome": "failed", "keywords": ["test_light_turn_off", "test_domain_toggles.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.0053438469767570496, "outcome": "passed"}, "call": {"duration": 0.004379021003842354, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/light/turn_off'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_domain_toggles.py", "lineno": 27, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0b9cfa0>\n\n    async def test_light_turn_off(rest):\n        \"\"\"light.turn_off sets state to 'off'.\"\"\"\n        await rest.set_state(\"light.dt_lt_off\", \"on\")\n>       await rest.call_service(\"light\", \"turn_off\", {\"entity_id\": \"light.dt_lt_off\"})\n\ntests/entity/test_domain_toggles.py:27: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/light/turn_off'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0007702009752392769, "outcome": "passed"}}, {"nodeid": "tests/entity/test_domain_toggles.py::test_light_turn_on_with_attribute[brightness-128]", "lineno": 31, "outcome": "failed", "keywords": ["test_light_turn_on_with_attribute[brightness-128]", "parametrize", "pytestmark", "brightness-128", "test_domain_toggles.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.0056956117041409016, "outcome": "passed"}, "call": {"duration": 0.004162680823355913, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/light/turn_on'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_domain_toggles.py", "lineno": 40, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0b74040>, attr = 'brightness'\nvalue = 128\n\n    @pytest.mark.parametrize(\"attr,value\", [\n        (\"brightness\", 128),\n        (\"color_temp\", 400),\n    ])\n    async def test_light_turn_on_with_attribute(rest, attr, value):\n        \"\"\"light.turn_on with brightness/color_temp sets the attribute.\"\"\"\n        eid = f\"light.dt_lt_{attr}\"\n        await rest.set_state(eid, \"off\")\n>       await rest.call_service(\"light\", \"turn_on\", {\n            \"entity_id\": eid,\n            attr: value,\n        })\n\ntests/entity/test_domain_toggles.py:40: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/light/turn_on'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0007415791042149067, "outcome": "passed"}}, {"nodeid": "tests/entity/test_domain_toggles.py::test_light_turn_on_with_attribute[color_temp-400]", "lineno": 31, "outcome": "failed", "keywords": ["test_light_turn_on_with_attribute[color_temp-400]", "parametrize", "pytestmark", "color_temp-400", "test_domain_toggles.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005648641847074032, "outcome": "passed"}, "call": {"duration": 0.004206508863717318, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/light/turn_on'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_domain_toggles.py", "lineno": 40, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b2290dc0>, attr = 'color_temp'\nvalue = 400\n\n    @pytest.mark.parametrize(\"attr,value\", [\n        (\"brightness\", 128),\n        (\"color_temp\", 400),\n    ])\n    async def test_light_turn_on_with_attribute(rest, attr, value):\n        \"\"\"light.turn_on with brightness/color_temp sets the attribute.\"\"\"\n        eid = f\"light.dt_lt_{attr}\"\n        await rest.set_state(eid, \"off\")\n>       await rest.call_service(\"light\", \"turn_on\", {\n            \"entity_id\": eid,\n            attr: value,\n        })\n\ntests/entity/test_domain_toggles.py:40: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/light/turn_on'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0006703250110149384, "outcome": "passed"}}, {"nodeid": "tests/entity/test_domain_toggles.py::test_light_turn_on_multiple", "lineno": 48, "outcome": "failed", "keywords": ["test_light_turn_on_multiple", "test_domain_toggles.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005567543674260378, "outcome": "passed"}, "call": {"duration": 0.005099174100905657, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/light/turn_on'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_domain_toggles.py", "lineno": 54, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0c46ca0>\n\n    async def test_light_turn_on_multiple(rest):\n        \"\"\"light.turn_on with multiple entity_ids.\"\"\"\n        ids = [\"light.dt_lt_multi_a\", \"light.dt_lt_multi_b\"]\n        for eid in ids:\n            await rest.set_state(eid, \"off\")\n>       await rest.call_service(\"light\", \"turn_on\", {\"entity_id\": ids})\n\ntests/entity/test_domain_toggles.py:54: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/light/turn_on'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0007972931489348412, "outcome": "passed"}}, {"nodeid": "tests/entity/test_domain_toggles.py::test_light_preserves_attributes_on_off", "lineno": 59, "outcome": "failed", "keywords": ["test_light_preserves_attributes_on_off", "test_domain_toggles.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005633975379168987, "outcome": "passed"}, "call": {"duration": 0.004002872854471207, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/light/turn_off'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_domain_toggles.py", "lineno": 63, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b036a520>\n\n    async def test_light_preserves_attributes_on_off(rest):\n        \"\"\"Turning off a light preserves its attributes.\"\"\"\n        await rest.set_state(\"light.dt_lt_preserve\", \"on\", {\"brightness\": 200, \"color_temp\": 350})\n>       await rest.call_service(\"light\", \"turn_off\", {\"entity_id\": \"light.dt_lt_preserve\"})\n\ntests/entity/test_domain_toggles.py:63: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/light/turn_off'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0008277939632534981, "outcome": "passed"}}, {"nodeid": "tests/entity/test_domain_toggles.py::test_switch_turn_on", "lineno": 70, "outcome": "failed", "keywords": ["test_switch_turn_on", "test_domain_toggles.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005540231708437204, "outcome": "passed"}, "call": {"duration": 0.003988038748502731, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/switch/turn_on'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_domain_toggles.py", "lineno": 74, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0ba61f0>\n\n    async def test_switch_turn_on(rest):\n        \"\"\"switch.turn_on sets state to 'on'.\"\"\"\n        await rest.set_state(\"switch.dt_sw_on\", \"off\")\n>       await rest.call_service(\"switch\", \"turn_on\", {\"entity_id\": \"switch.dt_sw_on\"})\n\ntests/entity/test_domain_toggles.py:74: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/switch/turn_on'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.000690569169819355, "outcome": "passed"}}, {"nodeid": "tests/entity/test_domain_toggles.py::test_switch_turn_off", "lineno": 78, "outcome": "failed", "keywords": ["test_switch_turn_off", "test_domain_toggles.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005482719745486975, "outcome": "passed"}, "call": {"duration": 0.004293648060411215, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/switch/turn_off'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_domain_toggles.py", "lineno": 82, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0c0a310>\n\n    async def test_switch_turn_off(rest):\n        \"\"\"switch.turn_off sets state to 'off'.\"\"\"\n        await rest.set_state(\"switch.dt_sw_off\", \"on\")\n>       await rest.call_service(\"switch\", \"turn_off\", {\"entity_id\": \"switch.dt_sw_off\"})\n\ntests/entity/test_domain_toggles.py:82: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/switch/turn_off'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.00062570720911026, "outcome": "passed"}}, {"nodeid": "tests/entity/test_domain_toggles.py::test_switch_toggle_on_to_off", "lineno": 86, "outcome": "failed", "keywords": ["test_switch_toggle_on_to_off", "test_domain_toggles.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.00514020211994648, "outcome": "passed"}, "call": {"duration": 0.004231726285070181, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/switch/toggle'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_domain_toggles.py", "lineno": 90, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0ba6850>\n\n    async def test_switch_toggle_on_to_off(rest):\n        \"\"\"switch.toggle from on goes to off.\"\"\"\n        await rest.set_state(\"switch.dt_sw1\", \"on\")\n>       await rest.call_service(\"switch\", \"toggle\", {\"entity_id\": \"switch.dt_sw1\"})\n\ntests/entity/test_domain_toggles.py:90: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/switch/toggle'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0006659622304141521, "outcome": "passed"}}, {"nodeid": "tests/entity/test_domain_toggles.py::test_switch_toggle_off_to_on", "lineno": 94, "outcome": "failed", "keywords": ["test_switch_toggle_off_to_on", "test_domain_toggles.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005781141109764576, "outcome": "passed"}, "call": {"duration": 0.004873366095125675, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/switch/toggle'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_domain_toggles.py", "lineno": 98, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b22c3580>\n\n    async def test_switch_toggle_off_to_on(rest):\n        \"\"\"switch.toggle from off goes to on.\"\"\"\n        await rest.set_state(\"switch.dt_sw2\", \"off\")\n>       await rest.call_service(\"switch\", \"toggle\", {\"entity_id\": \"switch.dt_sw2\"})\n\ntests/entity/test_domain_toggles.py:98: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/switch/toggle'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0007993709295988083, "outcome": "passed"}}, {"nodeid": "tests/entity/test_domain_toggles.py::test_switch_preserves_attributes", "lineno": 102, "outcome": "failed", "keywords": ["test_switch_preserves_attributes", "test_domain_toggles.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.006171843037009239, "outcome": "passed"}, "call": {"duration": 0.0045503778383135796, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/switch/turn_off'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_domain_toggles.py", "lineno": 106, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0d704f0>\n\n    async def test_switch_preserves_attributes(rest):\n        \"\"\"switch operations preserve entity attributes.\"\"\"\n        await rest.set_state(\"switch.dt_sw_attrs\", \"on\", {\"friendly_name\": \"Coffee Maker\", \"icon\": \"mdi:coffee\"})\n>       await rest.call_service(\"switch\", \"turn_off\", {\"entity_id\": \"switch.dt_sw_attrs\"})\n\ntests/entity/test_domain_toggles.py:106: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/switch/turn_off'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0007476271130144596, "outcome": "passed"}}, {"nodeid": "tests/entity/test_domain_toggles.py::test_input_boolean_turn_on", "lineno": 114, "outcome": "failed", "keywords": ["test_input_boolean_turn_on", "test_domain_toggles.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005663373973220587, "outcome": "passed"}, "call": {"duration": 0.005992684047669172, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/entity/test_domain_toggles.py", "lineno": 120, "message": "AssertionError: assert 'off' == 'on'\n  \n  - on\n  + off"}, "traceback": [{"path": "tests/entity/test_domain_toggles.py", "lineno": 120, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0bbe1c0>\n\n    async def test_input_boolean_turn_on(rest):\n        \"\"\"input_boolean.turn_on sets on.\"\"\"\n        await rest.set_state(\"input_boolean.dt_ib1\", \"off\")\n        await rest.call_service(\"input_boolean\", \"turn_on\", {\"entity_id\": \"input_boolean.dt_ib1\"})\n        state = await rest.get_state(\"input_boolean.dt_ib1\")\n>       assert state[\"state\"] == \"on\"\nE       AssertionError: assert 'off' == 'on'\nE         \nE         - on\nE         + off\n\ntests/entity/test_domain_toggles.py:120: AssertionError"}, "teardown": {"duration": 0.0005375100299715996, "outcome": "passed"}}, {"nodeid": "tests/entity/test_domain_toggles.py::test_input_boolean_turn_off", "lineno": 122, "outcome": "failed", "keywords": ["test_input_boolean_turn_off", "test_domain_toggles.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005518732126802206, "outcome": "passed"}, "call": {"duration": 0.006015677936375141, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/entity/test_domain_toggles.py", "lineno": 128, "message": "AssertionError: assert 'on' == 'off'\n  \n  - off\n  + on"}, "traceback": [{"path": "tests/entity/test_domain_toggles.py", "lineno": 128, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b22c3190>\n\n    async def test_input_boolean_turn_off(rest):\n        \"\"\"input_boolean.turn_off sets off.\"\"\"\n        await rest.set_state(\"input_boolean.dt_ib2\", \"on\")\n        await rest.call_service(\"input_boolean\", \"turn_off\", {\"entity_id\": \"input_boolean.dt_ib2\"})\n        state = await rest.get_state(\"input_boolean.dt_ib2\")\n>       assert state[\"state\"] == \"off\"\nE       AssertionError: assert 'on' == 'off'\nE         \nE         - off\nE         + on\n\ntests/entity/test_domain_toggles.py:128: AssertionError"}, "teardown": {"duration": 0.0005950280465185642, "outcome": "passed"}}, {"nodeid": "tests/entity/test_domain_toggles.py::test_siren_toggle_on_to_off", "lineno": 132, "outcome": "failed", "keywords": ["test_siren_toggle_on_to_off", "test_domain_toggles.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005381118971854448, "outcome": "passed"}, "call": {"duration": 0.004336004611104727, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/siren/toggle'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_domain_toggles.py", "lineno": 136, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b04f7250>\n\n    async def test_siren_toggle_on_to_off(rest):\n        \"\"\"siren.toggle from on goes to off.\"\"\"\n        await rest.set_state(\"siren.dt_sir1\", \"on\")\n>       await rest.call_service(\"siren\", \"toggle\", {\"entity_id\": \"siren.dt_sir1\"})\n\ntests/entity/test_domain_toggles.py:136: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/siren/toggle'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0007253489457070827, "outcome": "passed"}}, {"nodeid": "tests/entity/test_domain_toggles.py::test_siren_toggle_off_to_on", "lineno": 140, "outcome": "failed", "keywords": ["test_siren_toggle_off_to_on", "test_domain_toggles.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005420933943241835, "outcome": "passed"}, "call": {"duration": 0.004582682158797979, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/siren/toggle'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_domain_toggles.py", "lineno": 144, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b044f160>\n\n    async def test_siren_toggle_off_to_on(rest):\n        \"\"\"siren.toggle from off goes to on.\"\"\"\n        await rest.set_state(\"siren.dt_sir2\", \"off\")\n>       await rest.call_service(\"siren\", \"toggle\", {\"entity_id\": \"siren.dt_sir2\"})\n\ntests/entity/test_domain_toggles.py:144: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/siren/toggle'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0006974781863391399, "outcome": "passed"}}, {"nodeid": "tests/entity/test_domain_toggles.py::test_valve_toggle_open_to_closed", "lineno": 150, "outcome": "failed", "keywords": ["test_valve_toggle_open_to_closed", "test_domain_toggles.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005148004740476608, "outcome": "passed"}, "call": {"duration": 0.004046517889946699, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/valve/toggle'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_domain_toggles.py", "lineno": 154, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0b1c820>\n\n    async def test_valve_toggle_open_to_closed(rest):\n        \"\"\"valve.toggle from open goes to closed.\"\"\"\n        await rest.set_state(\"valve.dt_v1\", \"open\")\n>       await rest.call_service(\"valve\", \"toggle\", {\"entity_id\": \"valve.dt_v1\"})\n\ntests/entity/test_domain_toggles.py:154: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/valve/toggle'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0007245698943734169, "outcome": "passed"}}, {"nodeid": "tests/entity/test_domain_toggles.py::test_valve_toggle_closed_to_open", "lineno": 158, "outcome": "failed", "keywords": ["test_valve_toggle_closed_to_open", "test_domain_toggles.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005137895233929157, "outcome": "passed"}, "call": {"duration": 0.004009028896689415, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/valve/toggle'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_domain_toggles.py", "lineno": 162, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0b7bd90>\n\n    async def test_valve_toggle_closed_to_open(rest):\n        \"\"\"valve.toggle from closed goes to open.\"\"\"\n        await rest.set_state(\"valve.dt_v2\", \"closed\")\n>       await rest.call_service(\"valve\", \"toggle\", {\"entity_id\": \"valve.dt_v2\"})\n\ntests/entity/test_domain_toggles.py:162: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/valve/toggle'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0006546680815517902, "outcome": "passed"}}, {"nodeid": "tests/entity/test_domain_toggles.py::test_fan_toggle_on_to_off", "lineno": 168, "outcome": "failed", "keywords": ["test_fan_toggle_on_to_off", "test_domain_toggles.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.006098056212067604, "outcome": "passed"}, "call": {"duration": 0.004212446045130491, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/fan/toggle'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_domain_toggles.py", "lineno": 172, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0cd11f0>\n\n    async def test_fan_toggle_on_to_off(rest):\n        \"\"\"fan.toggle from on goes to off.\"\"\"\n        await rest.set_state(\"fan.dt_fan1\", \"on\")\n>       await rest.call_service(\"fan\", \"toggle\", {\"entity_id\": \"fan.dt_fan1\"})\n\ntests/entity/test_domain_toggles.py:172: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/fan/toggle'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0007325229234993458, "outcome": "passed"}}, {"nodeid": "tests/entity/test_domain_toggles.py::test_fan_toggle_off_to_on", "lineno": 176, "outcome": "failed", "keywords": ["test_fan_toggle_off_to_on", "test_domain_toggles.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005487259943038225, "outcome": "passed"}, "call": {"duration": 0.0049011423252522945, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/fan/toggle'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_domain_toggles.py", "lineno": 180, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0ce8f40>\n\n    async def test_fan_toggle_off_to_on(rest):\n        \"\"\"fan.toggle from off goes to on.\"\"\"\n        await rest.set_state(\"fan.dt_fan2\", \"off\")\n>       await rest.call_service(\"fan\", \"toggle\", {\"entity_id\": \"fan.dt_fan2\"})\n\ntests/entity/test_domain_toggles.py:180: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/fan/toggle'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0006594960577785969, "outcome": "passed"}}, {"nodeid": "tests/entity/test_domain_toggles.py::test_homeassistant_toggle_on_to_off", "lineno": 186, "outcome": "failed", "keywords": ["test_homeassistant_toggle_on_to_off", "test_domain_toggles.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005277901887893677, "outcome": "passed"}, "call": {"duration": 0.00667106918990612, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/entity/test_domain_toggles.py", "lineno": 192, "message": "AssertionError: assert 'on' == 'off'\n  \n  - off\n  + on"}, "traceback": [{"path": "tests/entity/test_domain_toggles.py", "lineno": 192, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0d707f0>\n\n    async def test_homeassistant_toggle_on_to_off(rest):\n        \"\"\"homeassistant.toggle from on goes to off.\"\"\"\n        await rest.set_state(\"light.dt_ha1\", \"on\")\n        await rest.call_service(\"homeassistant\", \"toggle\", {\"entity_id\": \"light.dt_ha1\"})\n        state = await rest.get_state(\"light.dt_ha1\")\n>       assert state[\"state\"] == \"off\"\nE       AssertionError: assert 'on' == 'off'\nE         \nE         - off\nE         + on\n\ntests/entity/test_domain_toggles.py:192: AssertionError"}, "teardown": {"duration": 0.0005650250241160393, "outcome": "passed"}}, {"nodeid": "tests/entity/test_domain_toggles.py::test_homeassistant_toggle_off_to_on", "lineno": 194, "outcome": "failed", "keywords": ["test_homeassistant_toggle_off_to_on", "test_domain_toggles.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005202684085816145, "outcome": "passed"}, "call": {"duration": 0.005773116368800402, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/entity/test_domain_toggles.py", "lineno": 200, "message": "AssertionError: assert 'off' == 'on'\n  \n  - on\n  + off"}, "traceback": [{"path": "tests/entity/test_domain_toggles.py", "lineno": 200, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b033f790>\n\n    async def test_homeassistant_toggle_off_to_on(rest):\n        \"\"\"homeassistant.toggle from off goes to on.\"\"\"\n        await rest.set_state(\"switch.dt_ha2\", \"off\")\n        await rest.call_service(\"homeassistant\", \"toggle\", {\"entity_id\": \"switch.dt_ha2\"})\n        state = await rest.get_state(\"switch.dt_ha2\")\n>       assert state[\"state\"] == \"on\"\nE       AssertionError: assert 'off' == 'on'\nE         \nE         - on\nE         + off\n\ntests/entity/test_domain_toggles.py:200: AssertionError"}, "teardown": {"duration": 0.0005559870041906834, "outcome": "passed"}}, {"nodeid": "tests/entity/test_domain_toggles.py::test_homeassistant_turn_on_any", "lineno": 202, "outcome": "failed", "keywords": ["test_homeassistant_turn_on_any", "test_domain_toggles.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005202168133109808, "outcome": "passed"}, "call": {"duration": 0.005514929071068764, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/entity/test_domain_toggles.py", "lineno": 208, "message": "AssertionError: assert 'off' == 'on'\n  \n  - on\n  + off"}, "traceback": [{"path": "tests/entity/test_domain_toggles.py", "lineno": 208, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0b2ceb0>\n\n    async def test_homeassistant_turn_on_any(rest):\n        \"\"\"homeassistant.turn_on works across domains.\"\"\"\n        await rest.set_state(\"sensor.dt_ha_on\", \"off\")\n        await rest.call_service(\"homeassistant\", \"turn_on\", {\"entity_id\": \"sensor.dt_ha_on\"})\n        state = await rest.get_state(\"sensor.dt_ha_on\")\n>       assert state[\"state\"] == \"on\"\nE       AssertionError: assert 'off' == 'on'\nE         \nE         - on\nE         + off\n\ntests/entity/test_domain_toggles.py:208: AssertionError"}, "teardown": {"duration": 0.0005852770991623402, "outcome": "passed"}}, {"nodeid": "tests/entity/test_domain_toggles.py::test_homeassistant_turn_off_any", "lineno": 210, "outcome": "failed", "keywords": ["test_homeassistant_turn_off_any", "test_domain_toggles.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005175522994250059, "outcome": "passed"}, "call": {"duration": 0.005385194905102253, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/entity/test_domain_toggles.py", "lineno": 216, "message": "AssertionError: assert 'on' == 'off'\n  \n  - off\n  + on"}, "traceback": [{"path": "tests/entity/test_domain_toggles.py", "lineno": 216, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0e4da00>\n\n    async def test_homeassistant_turn_off_any(rest):\n        \"\"\"homeassistant.turn_off works across domains.\"\"\"\n        await rest.set_state(\"sensor.dt_ha_off\", \"on\")\n        await rest.call_service(\"homeassistant\", \"turn_off\", {\"entity_id\": \"sensor.dt_ha_off\"})\n        state = await rest.get_state(\"sensor.dt_ha_off\")\n>       assert state[\"state\"] == \"off\"\nE       AssertionError: assert 'on' == 'off'\nE         \nE         - off\nE         + on\n\ntests/entity/test_domain_toggles.py:216: AssertionError"}, "teardown": {"duration": 0.0005882061086595058, "outcome": "passed"}}, {"nodeid": "tests/entity/test_domain_toggles.py::test_humidifier_toggle_on_to_off", "lineno": 220, "outcome": "failed", "keywords": ["test_humidifier_toggle_on_to_off", "test_domain_toggles.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005120790097862482, "outcome": "passed"}, "call": {"duration": 0.004085587337613106, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/humidifier/toggle'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_domain_toggles.py", "lineno": 224, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0d24910>\n\n    async def test_humidifier_toggle_on_to_off(rest):\n        \"\"\"humidifier.toggle from on goes to off.\"\"\"\n        await rest.set_state(\"humidifier.dt_hum1\", \"on\")\n>       await rest.call_service(\"humidifier\", \"toggle\", {\"entity_id\": \"humidifier.dt_hum1\"})\n\ntests/entity/test_domain_toggles.py:224: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/humidifier/toggle'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0006573782302439213, "outcome": "passed"}}, {"nodeid": "tests/entity/test_domain_toggles.py::test_humidifier_toggle_off_to_on", "lineno": 228, "outcome": "failed", "keywords": ["test_humidifier_toggle_off_to_on", "test_domain_toggles.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005207295063883066, "outcome": "passed"}, "call": {"duration": 0.0038757571019232273, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/humidifier/toggle'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_domain_toggles.py", "lineno": 232, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0fdf130>\n\n    async def test_humidifier_toggle_off_to_on(rest):\n        \"\"\"humidifier.toggle from off goes to on.\"\"\"\n        await rest.set_state(\"humidifier.dt_hum2\", \"off\")\n>       await rest.call_service(\"humidifier\", \"toggle\", {\"entity_id\": \"humidifier.dt_hum2\"})\n\ntests/entity/test_domain_toggles.py:232: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/humidifier/toggle'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0007071420550346375, "outcome": "passed"}}, {"nodeid": "tests/entity/test_domain_toggles.py::test_alarm_arm_home", "lineno": 238, "outcome": "failed", "keywords": ["test_alarm_arm_home", "test_domain_toggles.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005396610125899315, "outcome": "passed"}, "call": {"duration": 0.004044949077069759, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/alarm_control_panel/arm_home'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_domain_toggles.py", "lineno": 242, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0c0a220>\n\n    async def test_alarm_arm_home(rest):\n        \"\"\"alarm_control_panel.arm_home sets armed_home.\"\"\"\n        await rest.set_state(\"alarm_control_panel.dt_alarm\", \"disarmed\")\n>       await rest.call_service(\"alarm_control_panel\", \"arm_home\", {\n            \"entity_id\": \"alarm_control_panel.dt_alarm\",\n        })\n\ntests/entity/test_domain_toggles.py:242: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/alarm_control_panel/arm_home'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0006704358384013176, "outcome": "passed"}}, {"nodeid": "tests/entity/test_domain_toggles.py::test_alarm_arm_away", "lineno": 248, "outcome": "failed", "keywords": ["test_alarm_arm_away", "test_domain_toggles.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.0054983231239020824, "outcome": "passed"}, "call": {"duration": 0.003910284023731947, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/alarm_control_panel/arm_away'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_domain_toggles.py", "lineno": 252, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0b1c4c0>\n\n    async def test_alarm_arm_away(rest):\n        \"\"\"alarm_control_panel.arm_away sets armed_away.\"\"\"\n        await rest.set_state(\"alarm_control_panel.dt_alarm2\", \"disarmed\")\n>       await rest.call_service(\"alarm_control_panel\", \"arm_away\", {\n            \"entity_id\": \"alarm_control_panel.dt_alarm2\",\n        })\n\ntests/entity/test_domain_toggles.py:252: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/alarm_control_panel/arm_away'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0006818841211497784, "outcome": "passed"}}, {"nodeid": "tests/entity/test_domain_toggles.py::test_alarm_arm_night", "lineno": 258, "outcome": "failed", "keywords": ["test_alarm_arm_night", "test_domain_toggles.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.006268789060413837, "outcome": "passed"}, "call": {"duration": 0.004097814206033945, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/alarm_control_panel/arm_night'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_domain_toggles.py", "lineno": 262, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0d76490>\n\n    async def test_alarm_arm_night(rest):\n        \"\"\"alarm_control_panel.arm_night sets armed_night.\"\"\"\n        await rest.set_state(\"alarm_control_panel.dt_alarm3\", \"disarmed\")\n>       await rest.call_service(\"alarm_control_panel\", \"arm_night\", {\n            \"entity_id\": \"alarm_control_panel.dt_alarm3\",\n        })\n\ntests/entity/test_domain_toggles.py:262: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/alarm_control_panel/arm_night'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.000722742173820734, "outcome": "passed"}}, {"nodeid": "tests/entity/test_domain_toggles.py::test_alarm_disarm", "lineno": 268, "outcome": "failed", "keywords": ["test_alarm_disarm", "test_domain_toggles.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005303557962179184, "outcome": "passed"}, "call": {"duration": 0.004047691822052002, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/alarm_control_panel/disarm'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_domain_toggles.py", "lineno": 272, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0bd9430>\n\n    async def test_alarm_disarm(rest):\n        \"\"\"alarm_control_panel.disarm sets disarmed.\"\"\"\n        await rest.set_state(\"alarm_control_panel.dt_alarm4\", \"armed_home\")\n>       await rest.call_service(\"alarm_control_panel\", \"disarm\", {\n            \"entity_id\": \"alarm_control_panel.dt_alarm4\",\n        })\n\ntests/entity/test_domain_toggles.py:272: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/alarm_control_panel/disarm'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0006705382838845253, "outcome": "passed"}}, {"nodeid": "tests/entity/test_domain_toggles.py::test_alarm_trigger", "lineno": 278, "outcome": "failed", "keywords": ["test_alarm_trigger", "test_domain_toggles.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005893039982765913, "outcome": "passed"}, "call": {"duration": 0.0042671626433730125, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/alarm_control_panel/trigger'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_domain_toggles.py", "lineno": 282, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0b83d90>\n\n    async def test_alarm_trigger(rest):\n        \"\"\"alarm_control_panel.trigger sets triggered.\"\"\"\n        await rest.set_state(\"alarm_control_panel.dt_alarm5\", \"armed_away\")\n>       await rest.call_service(\"alarm_control_panel\", \"trigger\", {\n            \"entity_id\": \"alarm_control_panel.dt_alarm5\",\n        })\n\ntests/entity/test_domain_toggles.py:282: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/alarm_control_panel/trigger'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0006980909965932369, "outcome": "passed"}}, {"nodeid": "tests/entity/test_entity_delete.py::test_delete_entity", "lineno": 14, "outcome": "passed", "keywords": ["test_delete_entity", "test_entity_delete.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005545939784497023, "outcome": "passed"}, "call": {"duration": 0.006461843848228455, "outcome": "passed"}, "teardown": {"duration": 0.0006827376782894135, "outcome": "passed"}}, {"nodeid": "tests/entity/test_entity_delete.py::test_delete_nonexistent_returns_404", "lineno": 36, "outcome": "passed", "keywords": ["test_delete_nonexistent_returns_404", "test_entity_delete.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005224237218499184, "outcome": "passed"}, "call": {"duration": 0.0034722480922937393, "outcome": "passed"}, "teardown": {"duration": 0.0004759528674185276, "outcome": "passed"}}, {"nodeid": "tests/entity/test_entity_delete.py::test_delete_then_recreate", "lineno": 46, "outcome": "passed", "keywords": ["test_delete_then_recreate", "test_entity_delete.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005215897690504789, "outcome": "passed"}, "call": {"duration": 0.006428675260394812, "outcome": "passed"}, "teardown": {"duration": 0.0005081463605165482, "outcome": "passed"}}, {"nodeid": "tests/entity/test_entity_delete.py::test_delete_reduces_entity_count", "lineno": 68, "outcome": "passed", "keywords": ["test_delete_reduces_entity_count", "test_entity_delete.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005138896871358156, "outcome": "passed"}, "call": {"duration": 0.014606338925659657, "outcome": "passed"}, "teardown": {"duration": 0.0005656559951603413, "outcome": "passed"}}, {"nodeid": "tests/entity/test_entity_delete.py::test_search_by_label", "lineno": 88, "outcome": "failed", "keywords": ["test_search_by_label", "test_entity_delete.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005485610105097294, "outcome": "passed"}, "call": {"duration": 0.007681404240429401, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/entity/test_entity_delete.py", "lineno": 111, "message": "assert 404 == 200\n +  where 404 = <Response [404 Not Found]>.status_code"}, "traceback": [{"path": "tests/entity/test_entity_delete.py", "lineno": 111, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0bc80d0>\n\n    async def test_search_by_label(rest):\n        \"\"\"Search with label= filter returns only labeled entities.\"\"\"\n        # Create label and entity\n        await rest.client.post(\n            f\"{rest.base_url}/api/labels\",\n            json={\"label_id\": \"search_label_test\", \"name\": \"Test Label\"},\n            headers=rest._headers(),\n        )\n        await rest.set_state(\"sensor.labeled_search\", \"99\")\n        await rest.set_state(\"sensor.unlabeled_search\", \"88\")\n    \n        # Assign label\n        await rest.client.post(\n            f\"{rest.base_url}/api/labels/search_label_test/entities/sensor.labeled_search\",\n            headers=rest._headers(),\n        )\n    \n        # Search\n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/states/search?label=search_label_test\",\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 404 == 200\nE        +  where 404 = <Response [404 Not Found]>.status_code\n\ntests/entity/test_entity_delete.py:111: AssertionError"}, "teardown": {"duration": 0.0005133277736604214, "outcome": "passed"}}, {"nodeid": "tests/entity/test_entity_delete.py::test_search_by_area", "lineno": 129, "outcome": "failed", "keywords": ["test_search_by_area", "test_entity_delete.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005161206237971783, "outcome": "passed"}, "call": {"duration": 0.0075347102247178555, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/entity/test_entity_delete.py", "lineno": 152, "message": "assert 404 == 200\n +  where 404 = <Response [404 Not Found]>.status_code"}, "traceback": [{"path": "tests/entity/test_entity_delete.py", "lineno": 152, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0b0e970>\n\n    async def test_search_by_area(rest):\n        \"\"\"Search with area= filter returns only entities in that area.\"\"\"\n        # Create area and entity\n        await rest.client.post(\n            f\"{rest.base_url}/api/areas\",\n            json={\"area_id\": \"search_area_test\", \"name\": \"Search Room\"},\n            headers=rest._headers(),\n        )\n        await rest.set_state(\"sensor.area_search\", \"50\")\n        await rest.set_state(\"sensor.noarea_search\", \"60\")\n    \n        # Assign to area\n        await rest.client.post(\n            f\"{rest.base_url}/api/areas/search_area_test/entities/sensor.area_search\",\n            headers=rest._headers(),\n        )\n    \n        # Search\n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/states/search?area=search_area_test\",\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 404 == 200\nE        +  where 404 = <Response [404 Not Found]>.status_code\n\ntests/entity/test_entity_delete.py:152: AssertionError"}, "teardown": {"duration": 0.0006431927904486656, "outcome": "passed"}}, {"nodeid": "tests/entity/test_entity_format_consistency.py::test_create_entity_minimal", "lineno": 14, "outcome": "passed", "keywords": ["test_create_entity_minimal", "test_entity_format_consistency.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005618233233690262, "outcome": "passed"}, "call": {"duration": 0.004178124945610762, "outcome": "passed"}, "teardown": {"duration": 0.00046911509707570076, "outcome": "passed"}}, {"nodeid": "tests/entity/test_entity_format_consistency.py::test_create_entity_with_attributes", "lineno": 26, "outcome": "passed", "keywords": ["test_create_entity_with_attributes", "test_entity_format_consistency.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.004994979128241539, "outcome": "passed"}, "call": {"duration": 0.0032042087987065315, "outcome": "passed"}, "teardown": {"duration": 0.0004255841486155987, "outcome": "passed"}}, {"nodeid": "tests/entity/test_entity_format_consistency.py::test_delete_and_recreate", "lineno": 37, "outcome": "passed", "keywords": ["test_delete_and_recreate", "test_entity_format_consistency.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005458302795886993, "outcome": "passed"}, "call": {"duration": 0.009013583417981863, "outcome": "passed"}, "teardown": {"duration": 0.0005113766528666019, "outcome": "passed"}}, {"nodeid": "tests/entity/test_entity_format_consistency.py::test_entity_has_context", "lineno": 58, "outcome": "passed", "keywords": ["test_entity_has_context", "test_entity_format_consistency.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005475831218063831, "outcome": "passed"}, "call": {"duration": 0.003734858240932226, "outcome": "passed"}, "teardown": {"duration": 0.00046916399151086807, "outcome": "passed"}}, {"nodeid": "tests/entity/test_entity_format_consistency.py::test_context_changes_on_update", "lineno": 70, "outcome": "passed", "keywords": ["test_context_changes_on_update", "test_entity_format_consistency.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.00499614467844367, "outcome": "passed"}, "call": {"duration": 0.0073674628511071205, "outcome": "passed"}, "teardown": {"duration": 0.0005050762556493282, "outcome": "passed"}}, {"nodeid": "tests/entity/test_entity_format_consistency.py::test_last_changed_only_on_state_change", "lineno": 84, "outcome": "passed", "keywords": ["test_last_changed_only_on_state_change", "test_entity_format_consistency.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005547777749598026, "outcome": "passed"}, "call": {"duration": 0.009211552795022726, "outcome": "passed"}, "teardown": {"duration": 0.0005021393299102783, "outcome": "passed"}}, {"nodeid": "tests/entity/test_entity_format_consistency.py::test_many_domains", "lineno": 102, "outcome": "passed", "keywords": ["test_many_domains", "test_entity_format_consistency.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005096928216516972, "outcome": "passed"}, "call": {"duration": 0.026275289710611105, "outcome": "passed"}, "teardown": {"duration": 0.0005771280266344547, "outcome": "passed"}}, {"nodeid": "tests/entity/test_entity_format_consistency.py::test_entity_id_preserved_exactly", "lineno": 116, "outcome": "passed", "keywords": ["test_entity_id_preserved_exactly", "test_entity_format_consistency.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005233104806393385, "outcome": "passed"}, "call": {"duration": 0.0037760953418910503, "outcome": "passed"}, "teardown": {"duration": 0.0004542618989944458, "outcome": "passed"}}, {"nodeid": "tests/entity/test_entity_format_consistency.py::test_large_attributes", "lineno": 126, "outcome": "passed", "keywords": ["test_large_attributes", "test_entity_format_consistency.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005020204000174999, "outcome": "passed"}, "call": {"duration": 0.004262773785740137, "outcome": "passed"}, "teardown": {"duration": 0.0005387458950281143, "outcome": "passed"}}, {"nodeid": "tests/entity/test_entity_format_consistency.py::test_numeric_attribute_types", "lineno": 139, "outcome": "passed", "keywords": ["test_numeric_attribute_types", "test_entity_format_consistency.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005262726917862892, "outcome": "passed"}, "call": {"duration": 0.009430528618395329, "outcome": "passed"}, "teardown": {"duration": 0.0004843520000576973, "outcome": "passed"}}, {"nodeid": "tests/entity/test_entity_format_consistency.py::test_nested_attribute_objects", "lineno": 157, "outcome": "passed", "keywords": ["test_nested_attribute_objects", "test_entity_format_consistency.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005240544211119413, "outcome": "passed"}, "call": {"duration": 0.00337904691696167, "outcome": "passed"}, "teardown": {"duration": 0.00044812168926000595, "outcome": "passed"}}, {"nodeid": "tests/entity/test_entity_format_consistency.py::test_response_has_required_fields", "lineno": 171, "outcome": "passed", "keywords": ["test_response_has_required_fields", "test_entity_format_consistency.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.00553969107568264, "outcome": "passed"}, "call": {"duration": 0.002862093038856983, "outcome": "passed"}, "teardown": {"duration": 0.0004671202041208744, "outcome": "passed"}}, {"nodeid": "tests/entity/test_entity_format_consistency.py::test_state_empty_string", "lineno": 187, "outcome": "passed", "keywords": ["test_state_empty_string", "test_entity_format_consistency.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005108427256345749, "outcome": "passed"}, "call": {"duration": 0.006413748953491449, "outcome": "passed"}, "teardown": {"duration": 0.0005098208785057068, "outcome": "passed"}}, {"nodeid": "tests/entity/test_extended_domains.py::test_camera_turn_on", "lineno": 13, "outcome": "failed", "keywords": ["test_camera_turn_on", "test_extended_domains.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005465433932840824, "outcome": "passed"}, "call": {"duration": 0.004032234661281109, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/camera/turn_on'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_extended_domains.py", "lineno": 17, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0b9e850>\n\n    async def test_camera_turn_on(rest):\n        \"\"\"camera.turn_on sets state to streaming.\"\"\"\n        await rest.set_state(\"camera.front_door\", \"idle\")\n>       await rest.call_service(\"camera\", \"turn_on\", {\n            \"entity_id\": \"camera.front_door\",\n        })\n\ntests/entity/test_extended_domains.py:17: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/camera/turn_on'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0007276786491274834, "outcome": "passed"}}, {"nodeid": "tests/entity/test_extended_domains.py::test_camera_turn_off", "lineno": 23, "outcome": "failed", "keywords": ["test_camera_turn_off", "test_extended_domains.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005524252075701952, "outcome": "passed"}, "call": {"duration": 0.00427190912887454, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/camera/turn_off'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_extended_domains.py", "lineno": 27, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0be1e20>\n\n    async def test_camera_turn_off(rest):\n        \"\"\"camera.turn_off sets state to idle.\"\"\"\n        await rest.set_state(\"camera.front_door\", \"streaming\")\n>       await rest.call_service(\"camera\", \"turn_off\", {\n            \"entity_id\": \"camera.front_door\",\n        })\n\ntests/entity/test_extended_domains.py:27: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/camera/turn_off'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0006936909630894661, "outcome": "passed"}}, {"nodeid": "tests/entity/test_extended_domains.py::test_device_tracker_see", "lineno": 35, "outcome": "failed", "keywords": ["test_device_tracker_see", "test_extended_domains.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005325058940798044, "outcome": "passed"}, "call": {"duration": 0.004063358996063471, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/device_tracker/see'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_extended_domains.py", "lineno": 39, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0ba6520>\n\n    async def test_device_tracker_see(rest):\n        \"\"\"device_tracker.see sets location state.\"\"\"\n        await rest.set_state(\"device_tracker.phone\", \"not_home\")\n>       await rest.call_service(\"device_tracker\", \"see\", {\n            \"entity_id\": \"device_tracker.phone\",\n            \"location_name\": \"home\",\n        })\n\ntests/entity/test_extended_domains.py:39: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/device_tracker/see'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0009210673160851002, "outcome": "passed"}}, {"nodeid": "tests/entity/test_extended_domains.py::test_services_include_persistent_notification", "lineno": 49, "outcome": "passed", "keywords": ["test_services_include_persistent_notification", "test_extended_domains.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.009148085955530405, "outcome": "passed"}, "call": {"duration": 0.0057458579540252686, "outcome": "passed"}, "teardown": {"duration": 0.0006958441808819771, "outcome": "passed"}}, {"nodeid": "tests/entity/test_extended_domains.py::test_services_include_camera", "lineno": 63, "outcome": "failed", "keywords": ["test_services_include_camera", "test_extended_domains.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.00899833207949996, "outcome": "passed"}, "call": {"duration": 0.004219584167003632, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/entity/test_extended_domains.py", "lineno": 72, "message": "AssertionError: assert 'camera' in ['homeassistant', 'persistent_notification', 'logger', 'system_log', 'person', 'frontend', ...]"}, "traceback": [{"path": "tests/entity/test_extended_domains.py", "lineno": 72, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0b2ce50>\n\n    async def test_services_include_camera(rest):\n        \"\"\"GET /api/services includes camera domain.\"\"\"\n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/services\",\n            headers=rest._headers(),\n        )\n        services = resp.json()\n        domains = [s[\"domain\"] for s in services]\n>       assert \"camera\" in domains\nE       AssertionError: assert 'camera' in ['homeassistant', 'persistent_notification', 'logger', 'system_log', 'person', 'frontend', ...]\n\ntests/entity/test_extended_domains.py:72: AssertionError"}, "teardown": {"duration": 0.0007371040992438793, "outcome": "passed"}}, {"nodeid": "tests/entity/test_extended_domains.py::test_services_include_device_tracker", "lineno": 74, "outcome": "failed", "keywords": ["test_services_include_device_tracker", "test_extended_domains.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.008315788116306067, "outcome": "passed"}, "call": {"duration": 0.0035090288147330284, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/entity/test_extended_domains.py", "lineno": 83, "message": "AssertionError: assert 'device_tracker' in ['homeassistant', 'persistent_notification', 'logger', 'system_log', 'person', 'frontend', ...]"}, "traceback": [{"path": "tests/entity/test_extended_domains.py", "lineno": 83, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0b9e790>\n\n    async def test_services_include_device_tracker(rest):\n        \"\"\"GET /api/services includes device_tracker domain.\"\"\"\n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/services\",\n            headers=rest._headers(),\n        )\n        services = resp.json()\n        domains = [s[\"domain\"] for s in services]\n>       assert \"device_tracker\" in domains\nE       AssertionError: assert 'device_tracker' in ['homeassistant', 'persistent_notification', 'logger', 'system_log', 'person', 'frontend', ...]\n\ntests/entity/test_extended_domains.py:83: AssertionError"}, "teardown": {"duration": 0.0005474337376654148, "outcome": "passed"}}, {"nodeid": "tests/entity/test_extended_domains.py::test_services_total_domain_count", "lineno": 85, "outcome": "failed", "keywords": ["test_services_total_domain_count", "test_extended_domains.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005185306072235107, "outcome": "passed"}, "call": {"duration": 0.0034528709948062897, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/entity/test_extended_domains.py", "lineno": 93, "message": "AssertionError: Expected 34+ domains, got 28\nassert 28 >= 34\n +  where 28 = len([{'domain': 'homeassistant', 'services': {'check_config': {'description': 'Checks the Home Assistant YAML-configuratio... of a theme.', 'example': 'default', 'name': 'Theme', 'required': True, ...}}, 'name': 'Set the default theme'}}}, ...])"}, "traceback": [{"path": "tests/entity/test_extended_domains.py", "lineno": 93, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0d700d0>\n\n    async def test_services_total_domain_count(rest):\n        \"\"\"GET /api/services returns at least 35 domains.\"\"\"\n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/services\",\n            headers=rest._headers(),\n        )\n        services = resp.json()\n>       assert len(services) >= 34, f\"Expected 34+ domains, got {len(services)}\"\nE       AssertionError: Expected 34+ domains, got 28\nE       assert 28 >= 34\nE        +  where 28 = len([{'domain': 'homeassistant', 'services': {'check_config': {'description': 'Checks the Home Assistant YAML-configuratio... of a theme.', 'example': 'default', 'name': 'Theme', 'required': True, ...}}, 'name': 'Set the default theme'}}}, ...])\n\ntests/entity/test_extended_domains.py:93: AssertionError"}, "teardown": {"duration": 0.0005615381523966789, "outcome": "passed"}}, {"nodeid": "tests/entity/test_fan_cover_extended.py::test_fan_turn_on", "lineno": 16, "outcome": "failed", "keywords": ["test_fan_turn_on", "test_fan_cover_extended.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.00530795194208622, "outcome": "passed"}, "call": {"duration": 0.0041519165970385075, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/fan/turn_on'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_fan_cover_extended.py", "lineno": 22, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0b83100>\n\n    async def test_fan_turn_on(rest):\n        \"\"\"fan.turn_on sets state to 'on'.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"fan.fon_{tag}\"\n        await rest.set_state(eid, \"off\")\n>       await rest.call_service(\"fan\", \"turn_on\", {\"entity_id\": eid})\n\ntests/entity/test_fan_cover_extended.py:22: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/fan/turn_on'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0006972081027925014, "outcome": "passed"}}, {"nodeid": "tests/entity/test_fan_cover_extended.py::test_fan_turn_off", "lineno": 26, "outcome": "failed", "keywords": ["test_fan_turn_off", "test_fan_cover_extended.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005458527244627476, "outcome": "passed"}, "call": {"duration": 0.0041148909367620945, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/fan/turn_off'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_fan_cover_extended.py", "lineno": 32, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0c7c250>\n\n    async def test_fan_turn_off(rest):\n        \"\"\"fan.turn_off sets state to 'off'.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"fan.foff_{tag}\"\n        await rest.set_state(eid, \"on\", {\"percentage\": 50})\n>       await rest.call_service(\"fan\", \"turn_off\", {\"entity_id\": eid})\n\ntests/entity/test_fan_cover_extended.py:32: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/fan/turn_off'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0006941128522157669, "outcome": "passed"}}, {"nodeid": "tests/entity/test_fan_cover_extended.py::test_fan_toggle", "lineno": 36, "outcome": "failed", "keywords": ["test_fan_toggle", "test_fan_cover_extended.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.00540991872549057, "outcome": "passed"}, "call": {"duration": 0.004089046735316515, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/fan/toggle'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_fan_cover_extended.py", "lineno": 42, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0c7ccd0>\n\n    async def test_fan_toggle(rest):\n        \"\"\"fan.toggle flips state on->off->on.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"fan.ftog_{tag}\"\n        await rest.set_state(eid, \"on\")\n>       await rest.call_service(\"fan\", \"toggle\", {\"entity_id\": eid})\n\ntests/entity/test_fan_cover_extended.py:42: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/fan/toggle'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0006585749797523022, "outcome": "passed"}}, {"nodeid": "tests/entity/test_fan_cover_extended.py::test_fan_turn_on_with_percentage", "lineno": 52, "outcome": "failed", "keywords": ["test_fan_turn_on_with_percentage", "test_fan_cover_extended.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005210747942328453, "outcome": "passed"}, "call": {"duration": 0.004402423743158579, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/entity/test_fan_cover_extended.py", "lineno": 64, "message": "assert 400 == 200\n +  where 400 = <Response [400 Bad Request]>.status_code"}, "traceback": [{"path": "tests/entity/test_fan_cover_extended.py", "lineno": 64, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0c09b20>\n\n    async def test_fan_turn_on_with_percentage(rest):\n        \"\"\"fan.turn_on with percentage stores attribute.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"fan.fp_{tag}\"\n        await rest.set_state(eid, \"off\")\n    \n        resp = await rest.client.post(\n            f\"{rest.base_url}/api/services/fan/turn_on\",\n            json={\"entity_id\": eid, \"percentage\": 75},\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 400 == 200\nE        +  where 400 = <Response [400 Bad Request]>.status_code\n\ntests/entity/test_fan_cover_extended.py:64: AssertionError"}, "teardown": {"duration": 0.0006038942374289036, "outcome": "passed"}}, {"nodeid": "tests/entity/test_fan_cover_extended.py::test_fan_turn_on_with_preset", "lineno": 70, "outcome": "failed", "keywords": ["test_fan_turn_on_with_preset", "test_fan_cover_extended.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005167432129383087, "outcome": "passed"}, "call": {"duration": 0.005447406321763992, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/entity/test_fan_cover_extended.py", "lineno": 84, "message": "AssertionError: assert 'off' == 'on'\n  \n  - on\n  + off"}, "traceback": [{"path": "tests/entity/test_fan_cover_extended.py", "lineno": 84, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b039ca90>\n\n    async def test_fan_turn_on_with_preset(rest):\n        \"\"\"fan.turn_on with preset_mode stores attribute.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"fan.fpm_{tag}\"\n        await rest.set_state(eid, \"off\")\n    \n        await rest.client.post(\n            f\"{rest.base_url}/api/services/fan/turn_on\",\n            json={\"entity_id\": eid, \"preset_mode\": \"silent\"},\n            headers=rest._headers(),\n        )\n    \n        state = await rest.get_state(eid)\n>       assert state[\"state\"] == \"on\"\nE       AssertionError: assert 'off' == 'on'\nE         \nE         - on\nE         + off\n\ntests/entity/test_fan_cover_extended.py:84: AssertionError"}, "teardown": {"duration": 0.0005828649736940861, "outcome": "passed"}}, {"nodeid": "tests/entity/test_fan_cover_extended.py::test_fan_set_direction", "lineno": 87, "outcome": "failed", "keywords": ["test_fan_set_direction", "test_fan_cover_extended.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005134910810738802, "outcome": "passed"}, "call": {"duration": 0.00411621481180191, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/entity/test_fan_cover_extended.py", "lineno": 99, "message": "assert 400 == 200\n +  where 400 = <Response [400 Bad Request]>.status_code"}, "traceback": [{"path": "tests/entity/test_fan_cover_extended.py", "lineno": 99, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b22b2d30>\n\n    async def test_fan_set_direction(rest):\n        \"\"\"fan.set_direction stores direction attribute.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"fan.fd_{tag}\"\n        await rest.set_state(eid, \"on\")\n    \n        resp = await rest.client.post(\n            f\"{rest.base_url}/api/services/fan/set_direction\",\n            json={\"entity_id\": eid, \"direction\": \"reverse\"},\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 400 == 200\nE        +  where 400 = <Response [400 Bad Request]>.status_code\n\ntests/entity/test_fan_cover_extended.py:99: AssertionError"}, "teardown": {"duration": 0.0007469067350029945, "outcome": "passed"}}, {"nodeid": "tests/entity/test_fan_cover_extended.py::test_fan_set_preset_mode", "lineno": 104, "outcome": "failed", "keywords": ["test_fan_set_preset_mode", "test_fan_cover_extended.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005787532776594162, "outcome": "passed"}, "call": {"duration": 0.0058347187004983425, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/entity/test_fan_cover_extended.py", "lineno": 118, "message": "KeyError: 'preset_mode'"}, "traceback": [{"path": "tests/entity/test_fan_cover_extended.py", "lineno": 118, "message": "KeyError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b2288460>\n\n    async def test_fan_set_preset_mode(rest):\n        \"\"\"fan.set_preset_mode stores preset_mode attribute.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"fan.fspm_{tag}\"\n        await rest.set_state(eid, \"on\")\n    \n        await rest.client.post(\n            f\"{rest.base_url}/api/services/fan/set_preset_mode\",\n            json={\"entity_id\": eid, \"preset_mode\": \"turbo\"},\n            headers=rest._headers(),\n        )\n    \n        state = await rest.get_state(eid)\n>       assert state[\"attributes\"][\"preset_mode\"] == \"turbo\"\nE       KeyError: 'preset_mode'\n\ntests/entity/test_fan_cover_extended.py:118: KeyError"}, "teardown": {"duration": 0.0006789560429751873, "outcome": "passed"}}, {"nodeid": "tests/entity/test_fan_cover_extended.py::test_fan_set_percentage_zero_is_off", "lineno": 120, "outcome": "failed", "keywords": ["test_fan_set_percentage_zero_is_off", "test_fan_cover_extended.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005367231089621782, "outcome": "passed"}, "call": {"duration": 0.005291384644806385, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/entity/test_fan_cover_extended.py", "lineno": 134, "message": "AssertionError: assert 'on' == 'off'\n  \n  - off\n  + on"}, "traceback": [{"path": "tests/entity/test_fan_cover_extended.py", "lineno": 134, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0b58ac0>\n\n    async def test_fan_set_percentage_zero_is_off(rest):\n        \"\"\"fan.set_percentage with 0 sets state to off.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"fan.fz_{tag}\"\n        await rest.set_state(eid, \"on\")\n    \n        await rest.client.post(\n            f\"{rest.base_url}/api/services/fan/set_percentage\",\n            json={\"entity_id\": eid, \"percentage\": 0},\n            headers=rest._headers(),\n        )\n    \n        state = await rest.get_state(eid)\n>       assert state[\"state\"] == \"off\"\nE       AssertionError: assert 'on' == 'off'\nE         \nE         - off\nE         + on\n\ntests/entity/test_fan_cover_extended.py:134: AssertionError"}, "teardown": {"duration": 0.0007230839692056179, "outcome": "passed"}}, {"nodeid": "tests/entity/test_fan_cover_extended.py::test_fan_set_percentage_nonzero_is_on", "lineno": 137, "outcome": "failed", "keywords": ["test_fan_set_percentage_nonzero_is_on", "test_fan_cover_extended.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005289081949740648, "outcome": "passed"}, "call": {"duration": 0.0051497239619493484, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/entity/test_fan_cover_extended.py", "lineno": 151, "message": "AssertionError: assert 'off' == 'on'\n  \n  - on\n  + off"}, "traceback": [{"path": "tests/entity/test_fan_cover_extended.py", "lineno": 151, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0d24700>\n\n    async def test_fan_set_percentage_nonzero_is_on(rest):\n        \"\"\"fan.set_percentage with >0 sets state to on.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"fan.fnz_{tag}\"\n        await rest.set_state(eid, \"off\")\n    \n        await rest.client.post(\n            f\"{rest.base_url}/api/services/fan/set_percentage\",\n            json={\"entity_id\": eid, \"percentage\": 50},\n            headers=rest._headers(),\n        )\n    \n        state = await rest.get_state(eid)\n>       assert state[\"state\"] == \"on\"\nE       AssertionError: assert 'off' == 'on'\nE         \nE         - on\nE         + off\n\ntests/entity/test_fan_cover_extended.py:151: AssertionError"}, "teardown": {"duration": 0.0006771688349545002, "outcome": "passed"}}, {"nodeid": "tests/entity/test_fan_cover_extended.py::test_cover_open_sets_position_100", "lineno": 156, "outcome": "failed", "keywords": ["test_cover_open_sets_position_100", "test_fan_cover_extended.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005553047172725201, "outcome": "passed"}, "call": {"duration": 0.004168450832366943, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/entity/test_fan_cover_extended.py", "lineno": 168, "message": "assert 400 == 200\n +  where 400 = <Response [400 Bad Request]>.status_code"}, "traceback": [{"path": "tests/entity/test_fan_cover_extended.py", "lineno": 168, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b22eab50>\n\n    async def test_cover_open_sets_position_100(rest):\n        \"\"\"cover.open_cover sets current_position to 100.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"cover.cp_{tag}\"\n        await rest.set_state(eid, \"closed\")\n    \n        resp = await rest.client.post(\n            f\"{rest.base_url}/api/services/cover/open_cover\",\n            json={\"entity_id\": eid},\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 400 == 200\nE        +  where 400 = <Response [400 Bad Request]>.status_code\n\ntests/entity/test_fan_cover_extended.py:168: AssertionError"}, "teardown": {"duration": 0.0006079981103539467, "outcome": "passed"}}, {"nodeid": "tests/entity/test_fan_cover_extended.py::test_cover_close_sets_position_0", "lineno": 174, "outcome": "failed", "keywords": ["test_cover_close_sets_position_0", "test_fan_cover_extended.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005454096011817455, "outcome": "passed"}, "call": {"duration": 0.005174885969609022, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/entity/test_fan_cover_extended.py", "lineno": 188, "message": "AssertionError: assert 'open' == 'closed'\n  \n  - closed\n  + open"}, "traceback": [{"path": "tests/entity/test_fan_cover_extended.py", "lineno": 188, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0b09f40>\n\n    async def test_cover_close_sets_position_0(rest):\n        \"\"\"cover.close_cover sets current_position to 0.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"cover.cc_{tag}\"\n        await rest.set_state(eid, \"open\")\n    \n        await rest.client.post(\n            f\"{rest.base_url}/api/services/cover/close_cover\",\n            json={\"entity_id\": eid},\n            headers=rest._headers(),\n        )\n    \n        state = await rest.get_state(eid)\n>       assert state[\"state\"] == \"closed\"\nE       AssertionError: assert 'open' == 'closed'\nE         \nE         - closed\nE         + open\n\ntests/entity/test_fan_cover_extended.py:188: AssertionError"}, "teardown": {"duration": 0.0005674911662936211, "outcome": "passed"}}, {"nodeid": "tests/entity/test_fan_cover_extended.py::test_cover_toggle_open_to_closed", "lineno": 191, "outcome": "failed", "keywords": ["test_cover_toggle_open_to_closed", "test_fan_cover_extended.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005296860821545124, "outcome": "passed"}, "call": {"duration": 0.0053668939508497715, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/entity/test_fan_cover_extended.py", "lineno": 205, "message": "AssertionError: assert 'open' == 'closed'\n  \n  - closed\n  + open"}, "traceback": [{"path": "tests/entity/test_fan_cover_extended.py", "lineno": 205, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0b205e0>\n\n    async def test_cover_toggle_open_to_closed(rest):\n        \"\"\"cover.toggle from open to closed with position.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"cover.ct_{tag}\"\n        await rest.set_state(eid, \"open\")\n    \n        await rest.client.post(\n            f\"{rest.base_url}/api/services/cover/toggle\",\n            json={\"entity_id\": eid},\n            headers=rest._headers(),\n        )\n    \n        state = await rest.get_state(eid)\n>       assert state[\"state\"] == \"closed\"\nE       AssertionError: assert 'open' == 'closed'\nE         \nE         - closed\nE         + open\n\ntests/entity/test_fan_cover_extended.py:205: AssertionError"}, "teardown": {"duration": 0.0006209057755768299, "outcome": "passed"}}, {"nodeid": "tests/entity/test_fan_cover_extended.py::test_cover_toggle_closed_to_open", "lineno": 208, "outcome": "failed", "keywords": ["test_cover_toggle_closed_to_open", "test_fan_cover_extended.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005436982959508896, "outcome": "passed"}, "call": {"duration": 0.0049809059128165245, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/entity/test_fan_cover_extended.py", "lineno": 222, "message": "AssertionError: assert 'closed' == 'open'\n  \n  - open\n  + closed"}, "traceback": [{"path": "tests/entity/test_fan_cover_extended.py", "lineno": 222, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0b9da90>\n\n    async def test_cover_toggle_closed_to_open(rest):\n        \"\"\"cover.toggle from closed to open with position.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"cover.ct2_{tag}\"\n        await rest.set_state(eid, \"closed\")\n    \n        await rest.client.post(\n            f\"{rest.base_url}/api/services/cover/toggle\",\n            json={\"entity_id\": eid},\n            headers=rest._headers(),\n        )\n    \n        state = await rest.get_state(eid)\n>       assert state[\"state\"] == \"open\"\nE       AssertionError: assert 'closed' == 'open'\nE         \nE         - open\nE         + closed\n\ntests/entity/test_fan_cover_extended.py:222: AssertionError"}, "teardown": {"duration": 0.0005467161536216736, "outcome": "passed"}}, {"nodeid": "tests/entity/test_fan_cover_extended.py::test_cover_set_position_partial", "lineno": 225, "outcome": "failed", "keywords": ["test_cover_set_position_partial", "test_fan_cover_extended.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005307992920279503, "outcome": "passed"}, "call": {"duration": 0.0051040491089224815, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/entity/test_fan_cover_extended.py", "lineno": 239, "message": "AssertionError: assert 'closed' == 'open'\n  \n  - open\n  + closed"}, "traceback": [{"path": "tests/entity/test_fan_cover_extended.py", "lineno": 239, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b2288580>\n\n    async def test_cover_set_position_partial(rest):\n        \"\"\"cover.set_cover_position with partial value sets open state.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"cover.csp_{tag}\"\n        await rest.set_state(eid, \"closed\")\n    \n        await rest.client.post(\n            f\"{rest.base_url}/api/services/cover/set_cover_position\",\n            json={\"entity_id\": eid, \"position\": 50},\n            headers=rest._headers(),\n        )\n    \n        state = await rest.get_state(eid)\n>       assert state[\"state\"] == \"open\"\nE       AssertionError: assert 'closed' == 'open'\nE         \nE         - open\nE         + closed\n\ntests/entity/test_fan_cover_extended.py:239: AssertionError"}, "teardown": {"duration": 0.0004995781928300858, "outcome": "passed"}}, {"nodeid": "tests/entity/test_fan_cover_extended.py::test_cover_set_position_zero_is_closed", "lineno": 242, "outcome": "failed", "keywords": ["test_cover_set_position_zero_is_closed", "test_fan_cover_extended.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005269461777061224, "outcome": "passed"}, "call": {"duration": 0.005154300946742296, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/entity/test_fan_cover_extended.py", "lineno": 256, "message": "AssertionError: assert 'open' == 'closed'\n  \n  - closed\n  + open"}, "traceback": [{"path": "tests/entity/test_fan_cover_extended.py", "lineno": 256, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0c09040>\n\n    async def test_cover_set_position_zero_is_closed(rest):\n        \"\"\"cover.set_cover_position with 0 sets closed state.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"cover.csz_{tag}\"\n        await rest.set_state(eid, \"open\")\n    \n        await rest.client.post(\n            f\"{rest.base_url}/api/services/cover/set_cover_position\",\n            json={\"entity_id\": eid, \"position\": 0},\n            headers=rest._headers(),\n        )\n    \n        state = await rest.get_state(eid)\n>       assert state[\"state\"] == \"closed\"\nE       AssertionError: assert 'open' == 'closed'\nE         \nE         - closed\nE         + open\n\ntests/entity/test_fan_cover_extended.py:256: AssertionError"}, "teardown": {"duration": 0.0005859318189322948, "outcome": "passed"}}, {"nodeid": "tests/entity/test_fan_cover_extended.py::test_cover_stop_preserves_state", "lineno": 258, "outcome": "passed", "keywords": ["test_cover_stop_preserves_state", "test_fan_cover_extended.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005428708624094725, "outcome": "passed"}, "call": {"duration": 0.004902375862002373, "outcome": "passed"}, "teardown": {"duration": 0.000492587685585022, "outcome": "passed"}}, {"nodeid": "tests/entity/test_generic_fallback_services.py::test_unknown_domain_turn_on", "lineno": 12, "outcome": "failed", "keywords": ["test_unknown_domain_turn_on", "test_generic_fallback_services.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005329987034201622, "outcome": "passed"}, "call": {"duration": 0.003928651101887226, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/custom_domain/turn_on'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_generic_fallback_services.py", "lineno": 16, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b22b25b0>\n\n    async def test_unknown_domain_turn_on(rest):\n        \"\"\"Generic turn_on works for unregistered domain.\"\"\"\n        await rest.set_state(\"custom_domain.fallback_1\", \"off\")\n>       await rest.call_service(\"custom_domain\", \"turn_on\", {\n            \"entity_id\": \"custom_domain.fallback_1\",\n        })\n\ntests/entity/test_generic_fallback_services.py:16: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/custom_domain/turn_on'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.000676961150020361, "outcome": "passed"}}, {"nodeid": "tests/entity/test_generic_fallback_services.py::test_unknown_domain_turn_off", "lineno": 22, "outcome": "failed", "keywords": ["test_unknown_domain_turn_off", "test_generic_fallback_services.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005617144051939249, "outcome": "passed"}, "call": {"duration": 0.004198200069367886, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/custom_domain/turn_off'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_generic_fallback_services.py", "lineno": 26, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0e18a30>\n\n    async def test_unknown_domain_turn_off(rest):\n        \"\"\"Generic turn_off works for unregistered domain.\"\"\"\n        await rest.set_state(\"custom_domain.fallback_2\", \"on\")\n>       await rest.call_service(\"custom_domain\", \"turn_off\", {\n            \"entity_id\": \"custom_domain.fallback_2\",\n        })\n\ntests/entity/test_generic_fallback_services.py:26: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/custom_domain/turn_off'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0007115821354091167, "outcome": "passed"}}, {"nodeid": "tests/entity/test_generic_fallback_services.py::test_unknown_domain_toggle_on_to_off", "lineno": 32, "outcome": "failed", "keywords": ["test_unknown_domain_toggle_on_to_off", "test_generic_fallback_services.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.0051644728519022465, "outcome": "passed"}, "call": {"duration": 0.004467800725251436, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/custom_domain/toggle'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_generic_fallback_services.py", "lineno": 36, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0442b50>\n\n    async def test_unknown_domain_toggle_on_to_off(rest):\n        \"\"\"Generic toggle works for unregistered domain.\"\"\"\n        await rest.set_state(\"custom_domain.fallback_3\", \"on\")\n>       await rest.call_service(\"custom_domain\", \"toggle\", {\n            \"entity_id\": \"custom_domain.fallback_3\",\n        })\n\ntests/entity/test_generic_fallback_services.py:36: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/custom_domain/toggle'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.000712358858436346, "outcome": "passed"}}, {"nodeid": "tests/entity/test_generic_fallback_services.py::test_unknown_domain_toggle_off_to_on", "lineno": 42, "outcome": "failed", "keywords": ["test_unknown_domain_toggle_off_to_on", "test_generic_fallback_services.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005170965567231178, "outcome": "passed"}, "call": {"duration": 0.004165719263255596, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/custom_domain/toggle'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_generic_fallback_services.py", "lineno": 46, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0b41b50>\n\n    async def test_unknown_domain_toggle_off_to_on(rest):\n        \"\"\"Generic toggle from off to on for unregistered domain.\"\"\"\n        await rest.set_state(\"custom_domain.fallback_4\", \"off\")\n>       await rest.call_service(\"custom_domain\", \"toggle\", {\n            \"entity_id\": \"custom_domain.fallback_4\",\n        })\n\ntests/entity/test_generic_fallback_services.py:46: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/custom_domain/toggle'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0006589633412659168, "outcome": "passed"}}, {"nodeid": "tests/entity/test_generic_fallback_services.py::test_fallback_preserves_attrs", "lineno": 52, "outcome": "failed", "keywords": ["test_fallback_preserves_attrs", "test_generic_fallback_services.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.0053144218400120735, "outcome": "passed"}, "call": {"duration": 0.0044050090946257114, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/custom_domain/turn_on'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_generic_fallback_services.py", "lineno": 56, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0bd90d0>\n\n    async def test_fallback_preserves_attrs(rest):\n        \"\"\"Generic fallback service preserves entity attributes.\"\"\"\n        await rest.set_state(\"custom_domain.fallback_5\", \"off\", {\"custom_key\": \"custom_val\"})\n>       await rest.call_service(\"custom_domain\", \"turn_on\", {\n            \"entity_id\": \"custom_domain.fallback_5\",\n        })\n\ntests/entity/test_generic_fallback_services.py:56: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/custom_domain/turn_on'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0007129600271582603, "outcome": "passed"}}, {"nodeid": "tests/entity/test_generic_fallback_services.py::test_fallback_unknown_service", "lineno": 63, "outcome": "failed", "keywords": ["test_fallback_unknown_service", "test_generic_fallback_services.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005681451875716448, "outcome": "passed"}, "call": {"duration": 0.004366778768599033, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/entity/test_generic_fallback_services.py", "lineno": 72, "message": "assert 400 == 200\n +  where 400 = <Response [400 Bad Request]>.status_code"}, "traceback": [{"path": "tests/entity/test_generic_fallback_services.py", "lineno": 72, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0c664f0>\n\n    async def test_fallback_unknown_service(rest):\n        \"\"\"Unknown service for unknown domain returns 200 (no state change).\"\"\"\n        await rest.set_state(\"custom_domain.fallback_6\", \"initial\")\n        resp = await rest.client.post(\n            f\"{rest.base_url}/api/services/custom_domain/unknown_service\",\n            json={\"entity_id\": \"custom_domain.fallback_6\"},\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 400 == 200\nE        +  where 400 = <Response [400 Bad Request]>.status_code\n\ntests/entity/test_generic_fallback_services.py:72: AssertionError"}, "teardown": {"duration": 0.0005215359851717949, "outcome": "passed"}}, {"nodeid": "tests/entity/test_generic_fallback_services.py::test_binary_sensor_domain_fallback", "lineno": 77, "outcome": "failed", "keywords": ["test_binary_sensor_domain_fallback", "test_generic_fallback_services.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005566505249589682, "outcome": "passed"}, "call": {"duration": 0.00438985088840127, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/binary_sensor/turn_on'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_generic_fallback_services.py", "lineno": 81, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b22c3e50>\n\n    async def test_binary_sensor_domain_fallback(rest):\n        \"\"\"binary_sensor domain uses generic fallback.\"\"\"\n        await rest.set_state(\"binary_sensor.fallback_bs\", \"off\")\n>       await rest.call_service(\"binary_sensor\", \"turn_on\", {\n            \"entity_id\": \"binary_sensor.fallback_bs\",\n        })\n\ntests/entity/test_generic_fallback_services.py:81: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/binary_sensor/turn_on'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0007021459750831127, "outcome": "passed"}}, {"nodeid": "tests/entity/test_homeassistant_domain_services.py::test_homeassistant_turn_on", "lineno": 14, "outcome": "failed", "keywords": ["test_homeassistant_turn_on", "test_homeassistant_domain_services.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005683324299752712, "outcome": "passed"}, "call": {"duration": 0.006622110027819872, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/entity/test_homeassistant_domain_services.py", "lineno": 22, "message": "AssertionError: assert 'off' == 'on'\n  \n  - on\n  + off"}, "traceback": [{"path": "tests/entity/test_homeassistant_domain_services.py", "lineno": 22, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0510d00>\n\n    async def test_homeassistant_turn_on(rest):\n        \"\"\"homeassistant.turn_on sets entity to 'on'.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"light.ha_svc_{tag}\"\n        await rest.set_state(eid, \"off\")\n    \n        await rest.call_service(\"homeassistant\", \"turn_on\", {\"entity_id\": eid})\n>       assert (await rest.get_state(eid))[\"state\"] == \"on\"\nE       AssertionError: assert 'off' == 'on'\nE         \nE         - on\nE         + off\n\ntests/entity/test_homeassistant_domain_services.py:22: AssertionError"}, "teardown": {"duration": 0.0006478498689830303, "outcome": "passed"}}, {"nodeid": "tests/entity/test_homeassistant_domain_services.py::test_homeassistant_turn_off", "lineno": 24, "outcome": "failed", "keywords": ["test_homeassistant_turn_off", "test_homeassistant_domain_services.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005420063156634569, "outcome": "passed"}, "call": {"duration": 0.006894672755151987, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/entity/test_homeassistant_domain_services.py", "lineno": 32, "message": "AssertionError: assert 'on' == 'off'\n  \n  - off\n  + on"}, "traceback": [{"path": "tests/entity/test_homeassistant_domain_services.py", "lineno": 32, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b22c7d60>\n\n    async def test_homeassistant_turn_off(rest):\n        \"\"\"homeassistant.turn_off sets entity to 'off'.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"light.ha_off_{tag}\"\n        await rest.set_state(eid, \"on\")\n    \n        await rest.call_service(\"homeassistant\", \"turn_off\", {\"entity_id\": eid})\n>       assert (await rest.get_state(eid))[\"state\"] == \"off\"\nE       AssertionError: assert 'on' == 'off'\nE         \nE         - off\nE         + on\n\ntests/entity/test_homeassistant_domain_services.py:32: AssertionError"}, "teardown": {"duration": 0.0005413638427853584, "outcome": "passed"}}, {"nodeid": "tests/entity/test_homeassistant_domain_services.py::test_homeassistant_toggle", "lineno": 34, "outcome": "failed", "keywords": ["test_homeassistant_toggle", "test_homeassistant_domain_services.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005311262793838978, "outcome": "passed"}, "call": {"duration": 0.00651552015915513, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/entity/test_homeassistant_domain_services.py", "lineno": 42, "message": "AssertionError: assert 'on' == 'off'\n  \n  - off\n  + on"}, "traceback": [{"path": "tests/entity/test_homeassistant_domain_services.py", "lineno": 42, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b22ec9a0>\n\n    async def test_homeassistant_toggle(rest):\n        \"\"\"homeassistant.toggle flips entity state.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"switch.ha_tog_{tag}\"\n        await rest.set_state(eid, \"on\")\n    \n        await rest.call_service(\"homeassistant\", \"toggle\", {\"entity_id\": eid})\n>       assert (await rest.get_state(eid))[\"state\"] == \"off\"\nE       AssertionError: assert 'on' == 'off'\nE         \nE         - off\nE         + on\n\ntests/entity/test_homeassistant_domain_services.py:42: AssertionError"}, "teardown": {"duration": 0.0005715051665902138, "outcome": "passed"}}, {"nodeid": "tests/entity/test_homeassistant_domain_services.py::test_homeassistant_restart_stub", "lineno": 44, "outcome": "passed", "keywords": ["test_homeassistant_restart_stub", "test_homeassistant_domain_services.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005193344783037901, "outcome": "passed"}, "call": {"duration": 0.011180150788277388, "outcome": "passed"}, "teardown": {"duration": 0.0005308338440954685, "outcome": "passed"}}, {"nodeid": "tests/entity/test_homeassistant_domain_services.py::test_homeassistant_stop_stub", "lineno": 54, "outcome": "failed", "keywords": ["test_homeassistant_stop_stub", "test_homeassistant_domain_services.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.009403295814990997, "outcome": "passed"}, "call": {"duration": 0.0029342337511479855, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py", "lineno": 118, "message": "httpx.ReadError"}, "traceback": [{"path": "tests/entity/test_homeassistant_domain_services.py", "lineno": 57, "message": ""}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1859, "message": "in post"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1540, "message": "in request"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1629, "message": "in send"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1657, "message": "in _send_handling_auth"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1694, "message": "in _send_handling_redirects"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1730, "message": "in _send_single_request"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py", "lineno": 394, "message": "in handle_async_request"}, {"path": "../../anaconda3/lib/python3.9/contextlib.py", "lineno": 137, "message": "in __exit__"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py", "lineno": 118, "message": "ReadError"}], "longrepr": "@contextlib.contextmanager\n    def map_httpcore_exceptions() -> typing.Iterator[None]:\n        global HTTPCORE_EXC_MAP\n        if len(HTTPCORE_EXC_MAP) == 0:\n            HTTPCORE_EXC_MAP = _load_httpcore_exceptions()\n        try:\n>           yield\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:101: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:394: in handle_async_request\n    resp = await self._pool.handle_async_request(req)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/connection_pool.py:256: in handle_async_request\n    raise exc from None\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/connection_pool.py:236: in handle_async_request\n    response = await connection.handle_async_request(\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/connection.py:103: in handle_async_request\n    return await self._connection.handle_async_request(request)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:136: in handle_async_request\n    raise exc\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:106: in handle_async_request\n    ) = await self._receive_response_headers(**kwargs)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:177: in _receive_response_headers\n    event = await self._receive_event(timeout=timeout)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:217: in _receive_event\n    data = await self._network_stream.read(\n../../anaconda3/lib/python3.9/site-packages/httpcore/_backends/anyio.py:37: in read\n    return b\"\"\n../../anaconda3/lib/python3.9/contextlib.py:137: in __exit__\n    self.gen.throw(typ, value, traceback)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nmap = {<class 'TimeoutError'>: <class 'httpcore.ReadTimeout'>, <class 'anyio.BrokenResourceError'>: <class 'httpcore.ReadErr... 'anyio.ClosedResourceError'>: <class 'httpcore.ReadError'>, <class 'anyio.EndOfStream'>: <class 'httpcore.ReadError'>}\n\n    @contextlib.contextmanager\n    def map_exceptions(map: ExceptionMapping) -> typing.Iterator[None]:\n        try:\n            yield\n        except Exception as exc:  # noqa: PIE786\n            for from_exc, to_exc in map.items():\n                if isinstance(exc, from_exc):\n>                   raise to_exc(exc) from exc\nE                   httpcore.ReadError\n\n../../anaconda3/lib/python3.9/site-packages/httpcore/_exceptions.py:14: ReadError\n\nThe above exception was the direct cause of the following exception:\n\nrest = <conftest.RESTClient object at 0x7f47b0b2c9d0>\n\n    async def test_homeassistant_stop_stub(rest):\n        \"\"\"homeassistant.stop is a no-op stub (returns 200).\"\"\"\n>       resp = await rest.client.post(\n            f\"{rest.base_url}/api/services/homeassistant/stop\",\n            json={},\n            headers=rest._headers(),\n        )\n\ntests/entity/test_homeassistant_domain_services.py:57: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1859: in post\n    return await self.request(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1540: in request\n    return await self.send(request, auth=auth, follow_redirects=follow_redirects)\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1629: in send\n    response = await self._send_handling_auth(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1657: in _send_handling_auth\n    response = await self._send_handling_redirects(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1694: in _send_handling_redirects\n    response = await self._send_single_request(request)\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1730: in _send_single_request\n    response = await transport.handle_async_request(request)\n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:394: in handle_async_request\n    resp = await self._pool.handle_async_request(req)\n../../anaconda3/lib/python3.9/contextlib.py:137: in __exit__\n    self.gen.throw(typ, value, traceback)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\n    @contextlib.contextmanager\n    def map_httpcore_exceptions() -> typing.Iterator[None]:\n        global HTTPCORE_EXC_MAP\n        if len(HTTPCORE_EXC_MAP) == 0:\n            HTTPCORE_EXC_MAP = _load_httpcore_exceptions()\n        try:\n            yield\n        except Exception as exc:\n            mapped_exc = None\n    \n            for from_exc, to_exc in HTTPCORE_EXC_MAP.items():\n                if not isinstance(exc, from_exc):\n                    continue\n                # We want to map to the most specific exception we can find.\n                # Eg if `exc` is an `httpcore.ReadTimeout`, we want to map to\n                # `httpx.ReadTimeout`, not just `httpx.TimeoutException`.\n                if mapped_exc is None or issubclass(to_exc, mapped_exc):\n                    mapped_exc = to_exc\n    \n            if mapped_exc is None:  # pragma: no cover\n                raise\n    \n            message = str(exc)\n>           raise mapped_exc(message) from exc\nE           httpx.ReadError\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:118: ReadError"}, "teardown": {"duration": 0.0007334756664931774, "outcome": "passed"}}, {"nodeid": "tests/entity/test_homeassistant_domain_services.py::test_homeassistant_reload_core_config_stub", "lineno": 64, "outcome": "failed", "keywords": ["test_homeassistant_reload_core_config_stub", "test_homeassistant_domain_services.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005984819959849119, "outcome": "passed"}, "call": {"duration": 0.0020213453099131584, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py", "lineno": 118, "message": "httpx.ReadError"}, "traceback": [{"path": "tests/entity/test_homeassistant_domain_services.py", "lineno": 67, "message": ""}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1859, "message": "in post"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1540, "message": "in request"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1629, "message": "in send"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1657, "message": "in _send_handling_auth"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1694, "message": "in _send_handling_redirects"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1730, "message": "in _send_single_request"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py", "lineno": 394, "message": "in handle_async_request"}, {"path": "../../anaconda3/lib/python3.9/contextlib.py", "lineno": 137, "message": "in __exit__"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py", "lineno": 118, "message": "ReadError"}], "longrepr": "@contextlib.contextmanager\n    def map_httpcore_exceptions() -> typing.Iterator[None]:\n        global HTTPCORE_EXC_MAP\n        if len(HTTPCORE_EXC_MAP) == 0:\n            HTTPCORE_EXC_MAP = _load_httpcore_exceptions()\n        try:\n>           yield\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:101: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:394: in handle_async_request\n    resp = await self._pool.handle_async_request(req)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/connection_pool.py:256: in handle_async_request\n    raise exc from None\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/connection_pool.py:236: in handle_async_request\n    response = await connection.handle_async_request(\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/connection.py:103: in handle_async_request\n    return await self._connection.handle_async_request(request)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:136: in handle_async_request\n    raise exc\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:106: in handle_async_request\n    ) = await self._receive_response_headers(**kwargs)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:177: in _receive_response_headers\n    event = await self._receive_event(timeout=timeout)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:217: in _receive_event\n    data = await self._network_stream.read(\n../../anaconda3/lib/python3.9/site-packages/httpcore/_backends/anyio.py:37: in read\n    return b\"\"\n../../anaconda3/lib/python3.9/contextlib.py:137: in __exit__\n    self.gen.throw(typ, value, traceback)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nmap = {<class 'TimeoutError'>: <class 'httpcore.ReadTimeout'>, <class 'anyio.BrokenResourceError'>: <class 'httpcore.ReadErr... 'anyio.ClosedResourceError'>: <class 'httpcore.ReadError'>, <class 'anyio.EndOfStream'>: <class 'httpcore.ReadError'>}\n\n    @contextlib.contextmanager\n    def map_exceptions(map: ExceptionMapping) -> typing.Iterator[None]:\n        try:\n            yield\n        except Exception as exc:  # noqa: PIE786\n            for from_exc, to_exc in map.items():\n                if isinstance(exc, from_exc):\n>                   raise to_exc(exc) from exc\nE                   httpcore.ReadError\n\n../../anaconda3/lib/python3.9/site-packages/httpcore/_exceptions.py:14: ReadError\n\nThe above exception was the direct cause of the following exception:\n\nrest = <conftest.RESTClient object at 0x7f47ab7a5700>\n\n    async def test_homeassistant_reload_core_config_stub(rest):\n        \"\"\"homeassistant.reload_core_config is a no-op stub (returns 200).\"\"\"\n>       resp = await rest.client.post(\n            f\"{rest.base_url}/api/services/homeassistant/reload_core_config\",\n            json={},\n            headers=rest._headers(),\n        )\n\ntests/entity/test_homeassistant_domain_services.py:67: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1859: in post\n    return await self.request(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1540: in request\n    return await self.send(request, auth=auth, follow_redirects=follow_redirects)\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1629: in send\n    response = await self._send_handling_auth(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1657: in _send_handling_auth\n    response = await self._send_handling_redirects(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1694: in _send_handling_redirects\n    response = await self._send_single_request(request)\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1730: in _send_single_request\n    response = await transport.handle_async_request(request)\n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:394: in handle_async_request\n    resp = await self._pool.handle_async_request(req)\n../../anaconda3/lib/python3.9/contextlib.py:137: in __exit__\n    self.gen.throw(typ, value, traceback)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\n    @contextlib.contextmanager\n    def map_httpcore_exceptions() -> typing.Iterator[None]:\n        global HTTPCORE_EXC_MAP\n        if len(HTTPCORE_EXC_MAP) == 0:\n            HTTPCORE_EXC_MAP = _load_httpcore_exceptions()\n        try:\n            yield\n        except Exception as exc:\n            mapped_exc = None\n    \n            for from_exc, to_exc in HTTPCORE_EXC_MAP.items():\n                if not isinstance(exc, from_exc):\n                    continue\n                # We want to map to the most specific exception we can find.\n                # Eg if `exc` is an `httpcore.ReadTimeout`, we want to map to\n                # `httpx.ReadTimeout`, not just `httpx.TimeoutException`.\n                if mapped_exc is None or issubclass(to_exc, mapped_exc):\n                    mapped_exc = to_exc\n    \n            if mapped_exc is None:  # pragma: no cover\n                raise\n    \n            message = str(exc)\n>           raise mapped_exc(message) from exc\nE           httpx.ReadError\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:118: ReadError"}, "teardown": {"duration": 0.000643701758235693, "outcome": "passed"}}, {"nodeid": "tests/entity/test_homeassistant_domain_services.py::test_homeassistant_turn_on_preserves_attributes", "lineno": 74, "outcome": "failed", "keywords": ["test_homeassistant_turn_on_preserves_attributes", "test_homeassistant_domain_services.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005482603795826435, "outcome": "passed"}, "call": {"duration": 0.0019516488537192345, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py", "lineno": 118, "message": "httpx.ReadError"}, "traceback": [{"path": "tests/entity/test_homeassistant_domain_services.py", "lineno": 79, "message": ""}, {"path": "tests/conftest.py", "lineno": 89, "message": "in set_state"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1859, "message": "in post"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1540, "message": "in request"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1629, "message": "in send"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1657, "message": "in _send_handling_auth"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1694, "message": "in _send_handling_redirects"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1730, "message": "in _send_single_request"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py", "lineno": 394, "message": "in handle_async_request"}, {"path": "../../anaconda3/lib/python3.9/contextlib.py", "lineno": 137, "message": "in __exit__"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py", "lineno": 118, "message": "ReadError"}], "longrepr": "@contextlib.contextmanager\n    def map_httpcore_exceptions() -> typing.Iterator[None]:\n        global HTTPCORE_EXC_MAP\n        if len(HTTPCORE_EXC_MAP) == 0:\n            HTTPCORE_EXC_MAP = _load_httpcore_exceptions()\n        try:\n>           yield\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:101: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:394: in handle_async_request\n    resp = await self._pool.handle_async_request(req)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/connection_pool.py:256: in handle_async_request\n    raise exc from None\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/connection_pool.py:236: in handle_async_request\n    response = await connection.handle_async_request(\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/connection.py:103: in handle_async_request\n    return await self._connection.handle_async_request(request)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:136: in handle_async_request\n    raise exc\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:106: in handle_async_request\n    ) = await self._receive_response_headers(**kwargs)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:177: in _receive_response_headers\n    event = await self._receive_event(timeout=timeout)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:217: in _receive_event\n    data = await self._network_stream.read(\n../../anaconda3/lib/python3.9/site-packages/httpcore/_backends/anyio.py:37: in read\n    return b\"\"\n../../anaconda3/lib/python3.9/contextlib.py:137: in __exit__\n    self.gen.throw(typ, value, traceback)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nmap = {<class 'TimeoutError'>: <class 'httpcore.ReadTimeout'>, <class 'anyio.BrokenResourceError'>: <class 'httpcore.ReadErr... 'anyio.ClosedResourceError'>: <class 'httpcore.ReadError'>, <class 'anyio.EndOfStream'>: <class 'httpcore.ReadError'>}\n\n    @contextlib.contextmanager\n    def map_exceptions(map: ExceptionMapping) -> typing.Iterator[None]:\n        try:\n            yield\n        except Exception as exc:  # noqa: PIE786\n            for from_exc, to_exc in map.items():\n                if isinstance(exc, from_exc):\n>                   raise to_exc(exc) from exc\nE                   httpcore.ReadError\n\n../../anaconda3/lib/python3.9/site-packages/httpcore/_exceptions.py:14: ReadError\n\nThe above exception was the direct cause of the following exception:\n\nrest = <conftest.RESTClient object at 0x7f47b03ea7c0>\n\n    async def test_homeassistant_turn_on_preserves_attributes(rest):\n        \"\"\"homeassistant.turn_on preserves existing attributes.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"light.ha_attr_{tag}\"\n>       await rest.set_state(eid, \"off\", {\"brightness\": 200, \"friendly_name\": f\"Test {tag}\"})\n\ntests/entity/test_homeassistant_domain_services.py:79: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:89: in set_state\n    resp = await self.client.post(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1859: in post\n    return await self.request(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1540: in request\n    return await self.send(request, auth=auth, follow_redirects=follow_redirects)\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1629: in send\n    response = await self._send_handling_auth(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1657: in _send_handling_auth\n    response = await self._send_handling_redirects(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1694: in _send_handling_redirects\n    response = await self._send_single_request(request)\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1730: in _send_single_request\n    response = await transport.handle_async_request(request)\n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:394: in handle_async_request\n    resp = await self._pool.handle_async_request(req)\n../../anaconda3/lib/python3.9/contextlib.py:137: in __exit__\n    self.gen.throw(typ, value, traceback)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\n    @contextlib.contextmanager\n    def map_httpcore_exceptions() -> typing.Iterator[None]:\n        global HTTPCORE_EXC_MAP\n        if len(HTTPCORE_EXC_MAP) == 0:\n            HTTPCORE_EXC_MAP = _load_httpcore_exceptions()\n        try:\n            yield\n        except Exception as exc:\n            mapped_exc = None\n    \n            for from_exc, to_exc in HTTPCORE_EXC_MAP.items():\n                if not isinstance(exc, from_exc):\n                    continue\n                # We want to map to the most specific exception we can find.\n                # Eg if `exc` is an `httpcore.ReadTimeout`, we want to map to\n                # `httpx.ReadTimeout`, not just `httpx.TimeoutException`.\n                if mapped_exc is None or issubclass(to_exc, mapped_exc):\n                    mapped_exc = to_exc\n    \n            if mapped_exc is None:  # pragma: no cover\n                raise\n    \n            message = str(exc)\n>           raise mapped_exc(message) from exc\nE           httpx.ReadError\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:118: ReadError"}, "teardown": {"duration": 0.0005839299410581589, "outcome": "passed"}}, {"nodeid": "tests/entity/test_homeassistant_domain_services.py::test_homeassistant_works_across_domains", "lineno": 87, "outcome": "failed", "keywords": ["test_homeassistant_works_across_domains", "test_homeassistant_domain_services.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005726241040974855, "outcome": "passed"}, "call": {"duration": 0.0019187219440937042, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py", "lineno": 118, "message": "httpx.ReadError"}, "traceback": [{"path": "tests/entity/test_homeassistant_domain_services.py", "lineno": 98, "message": ""}, {"path": "tests/conftest.py", "lineno": 89, "message": "in set_state"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1859, "message": "in post"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1540, "message": "in request"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1629, "message": "in send"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1657, "message": "in _send_handling_auth"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1694, "message": "in _send_handling_redirects"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1730, "message": "in _send_single_request"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py", "lineno": 394, "message": "in handle_async_request"}, {"path": "../../anaconda3/lib/python3.9/contextlib.py", "lineno": 137, "message": "in __exit__"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py", "lineno": 118, "message": "ReadError"}], "longrepr": "@contextlib.contextmanager\n    def map_httpcore_exceptions() -> typing.Iterator[None]:\n        global HTTPCORE_EXC_MAP\n        if len(HTTPCORE_EXC_MAP) == 0:\n            HTTPCORE_EXC_MAP = _load_httpcore_exceptions()\n        try:\n>           yield\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:101: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:394: in handle_async_request\n    resp = await self._pool.handle_async_request(req)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/connection_pool.py:256: in handle_async_request\n    raise exc from None\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/connection_pool.py:236: in handle_async_request\n    response = await connection.handle_async_request(\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/connection.py:103: in handle_async_request\n    return await self._connection.handle_async_request(request)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:136: in handle_async_request\n    raise exc\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:106: in handle_async_request\n    ) = await self._receive_response_headers(**kwargs)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:177: in _receive_response_headers\n    event = await self._receive_event(timeout=timeout)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:217: in _receive_event\n    data = await self._network_stream.read(\n../../anaconda3/lib/python3.9/site-packages/httpcore/_backends/anyio.py:37: in read\n    return b\"\"\n../../anaconda3/lib/python3.9/contextlib.py:137: in __exit__\n    self.gen.throw(typ, value, traceback)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nmap = {<class 'TimeoutError'>: <class 'httpcore.ReadTimeout'>, <class 'anyio.BrokenResourceError'>: <class 'httpcore.ReadErr... 'anyio.ClosedResourceError'>: <class 'httpcore.ReadError'>, <class 'anyio.EndOfStream'>: <class 'httpcore.ReadError'>}\n\n    @contextlib.contextmanager\n    def map_exceptions(map: ExceptionMapping) -> typing.Iterator[None]:\n        try:\n            yield\n        except Exception as exc:  # noqa: PIE786\n            for from_exc, to_exc in map.items():\n                if isinstance(exc, from_exc):\n>                   raise to_exc(exc) from exc\nE                   httpcore.ReadError\n\n../../anaconda3/lib/python3.9/site-packages/httpcore/_exceptions.py:14: ReadError\n\nThe above exception was the direct cause of the following exception:\n\nrest = <conftest.RESTClient object at 0x7f47b222b700>\n\n    async def test_homeassistant_works_across_domains(rest):\n        \"\"\"homeassistant.turn_on works on any domain entity.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n    \n        entities = [\n            f\"light.ha_cross_{tag}\",\n            f\"switch.ha_cross_{tag}\",\n            f\"fan.ha_cross_{tag}\",\n        ]\n        for eid in entities:\n>           await rest.set_state(eid, \"off\")\n\ntests/entity/test_homeassistant_domain_services.py:98: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:89: in set_state\n    resp = await self.client.post(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1859: in post\n    return await self.request(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1540: in request\n    return await self.send(request, auth=auth, follow_redirects=follow_redirects)\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1629: in send\n    response = await self._send_handling_auth(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1657: in _send_handling_auth\n    response = await self._send_handling_redirects(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1694: in _send_handling_redirects\n    response = await self._send_single_request(request)\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1730: in _send_single_request\n    response = await transport.handle_async_request(request)\n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:394: in handle_async_request\n    resp = await self._pool.handle_async_request(req)\n../../anaconda3/lib/python3.9/contextlib.py:137: in __exit__\n    self.gen.throw(typ, value, traceback)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\n    @contextlib.contextmanager\n    def map_httpcore_exceptions() -> typing.Iterator[None]:\n        global HTTPCORE_EXC_MAP\n        if len(HTTPCORE_EXC_MAP) == 0:\n            HTTPCORE_EXC_MAP = _load_httpcore_exceptions()\n        try:\n            yield\n        except Exception as exc:\n            mapped_exc = None\n    \n            for from_exc, to_exc in HTTPCORE_EXC_MAP.items():\n                if not isinstance(exc, from_exc):\n                    continue\n                # We want to map to the most specific exception we can find.\n                # Eg if `exc` is an `httpcore.ReadTimeout`, we want to map to\n                # `httpx.ReadTimeout`, not just `httpx.TimeoutException`.\n                if mapped_exc is None or issubclass(to_exc, mapped_exc):\n                    mapped_exc = to_exc\n    \n            if mapped_exc is None:  # pragma: no cover\n                raise\n    \n            message = str(exc)\n>           raise mapped_exc(message) from exc\nE           httpx.ReadError\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:118: ReadError"}, "teardown": {"duration": 0.0005676872096955776, "outcome": "passed"}}, {"nodeid": "tests/entity/test_homeassistant_service.py::test_ha_turn_on", "lineno": 13, "outcome": "failed", "keywords": ["test_ha_turn_on", "test_homeassistant_service.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005390748847275972, "outcome": "passed"}, "call": {"duration": 0.0019295932725071907, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py", "lineno": 118, "message": "httpx.ReadError"}, "traceback": [{"path": "tests/entity/test_homeassistant_service.py", "lineno": 18, "message": ""}, {"path": "tests/conftest.py", "lineno": 89, "message": "in set_state"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1859, "message": "in post"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1540, "message": "in request"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1629, "message": "in send"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1657, "message": "in _send_handling_auth"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1694, "message": "in _send_handling_redirects"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1730, "message": "in _send_single_request"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py", "lineno": 394, "message": "in handle_async_request"}, {"path": "../../anaconda3/lib/python3.9/contextlib.py", "lineno": 137, "message": "in __exit__"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py", "lineno": 118, "message": "ReadError"}], "longrepr": "@contextlib.contextmanager\n    def map_httpcore_exceptions() -> typing.Iterator[None]:\n        global HTTPCORE_EXC_MAP\n        if len(HTTPCORE_EXC_MAP) == 0:\n            HTTPCORE_EXC_MAP = _load_httpcore_exceptions()\n        try:\n>           yield\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:101: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:394: in handle_async_request\n    resp = await self._pool.handle_async_request(req)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/connection_pool.py:256: in handle_async_request\n    raise exc from None\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/connection_pool.py:236: in handle_async_request\n    response = await connection.handle_async_request(\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/connection.py:103: in handle_async_request\n    return await self._connection.handle_async_request(request)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:136: in handle_async_request\n    raise exc\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:106: in handle_async_request\n    ) = await self._receive_response_headers(**kwargs)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:177: in _receive_response_headers\n    event = await self._receive_event(timeout=timeout)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:217: in _receive_event\n    data = await self._network_stream.read(\n../../anaconda3/lib/python3.9/site-packages/httpcore/_backends/anyio.py:37: in read\n    return b\"\"\n../../anaconda3/lib/python3.9/contextlib.py:137: in __exit__\n    self.gen.throw(typ, value, traceback)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nmap = {<class 'TimeoutError'>: <class 'httpcore.ReadTimeout'>, <class 'anyio.BrokenResourceError'>: <class 'httpcore.ReadErr... 'anyio.ClosedResourceError'>: <class 'httpcore.ReadError'>, <class 'anyio.EndOfStream'>: <class 'httpcore.ReadError'>}\n\n    @contextlib.contextmanager\n    def map_exceptions(map: ExceptionMapping) -> typing.Iterator[None]:\n        try:\n            yield\n        except Exception as exc:  # noqa: PIE786\n            for from_exc, to_exc in map.items():\n                if isinstance(exc, from_exc):\n>                   raise to_exc(exc) from exc\nE                   httpcore.ReadError\n\n../../anaconda3/lib/python3.9/site-packages/httpcore/_exceptions.py:14: ReadError\n\nThe above exception was the direct cause of the following exception:\n\nrest = <conftest.RESTClient object at 0x7f47ab641fa0>\n\n    async def test_ha_turn_on(rest):\n        \"\"\"homeassistant.turn_on sets entity to on.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"light.ha_on_{tag}\"\n>       await rest.set_state(eid, \"off\")\n\ntests/entity/test_homeassistant_service.py:18: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:89: in set_state\n    resp = await self.client.post(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1859: in post\n    return await self.request(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1540: in request\n    return await self.send(request, auth=auth, follow_redirects=follow_redirects)\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1629: in send\n    response = await self._send_handling_auth(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1657: in _send_handling_auth\n    response = await self._send_handling_redirects(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1694: in _send_handling_redirects\n    response = await self._send_single_request(request)\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1730: in _send_single_request\n    response = await transport.handle_async_request(request)\n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:394: in handle_async_request\n    resp = await self._pool.handle_async_request(req)\n../../anaconda3/lib/python3.9/contextlib.py:137: in __exit__\n    self.gen.throw(typ, value, traceback)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\n    @contextlib.contextmanager\n    def map_httpcore_exceptions() -> typing.Iterator[None]:\n        global HTTPCORE_EXC_MAP\n        if len(HTTPCORE_EXC_MAP) == 0:\n            HTTPCORE_EXC_MAP = _load_httpcore_exceptions()\n        try:\n            yield\n        except Exception as exc:\n            mapped_exc = None\n    \n            for from_exc, to_exc in HTTPCORE_EXC_MAP.items():\n                if not isinstance(exc, from_exc):\n                    continue\n                # We want to map to the most specific exception we can find.\n                # Eg if `exc` is an `httpcore.ReadTimeout`, we want to map to\n                # `httpx.ReadTimeout`, not just `httpx.TimeoutException`.\n                if mapped_exc is None or issubclass(to_exc, mapped_exc):\n                    mapped_exc = to_exc\n    \n            if mapped_exc is None:  # pragma: no cover\n                raise\n    \n            message = str(exc)\n>           raise mapped_exc(message) from exc\nE           httpx.ReadError\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:118: ReadError"}, "teardown": {"duration": 0.0005842181853950024, "outcome": "passed"}}, {"nodeid": "tests/entity/test_homeassistant_service.py::test_ha_turn_off", "lineno": 30, "outcome": "failed", "keywords": ["test_ha_turn_off", "test_homeassistant_service.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005356268957257271, "outcome": "passed"}, "call": {"duration": 0.0019074762240052223, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py", "lineno": 118, "message": "httpx.ReadError"}, "traceback": [{"path": "tests/entity/test_homeassistant_service.py", "lineno": 35, "message": ""}, {"path": "tests/conftest.py", "lineno": 89, "message": "in set_state"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1859, "message": "in post"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1540, "message": "in request"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1629, "message": "in send"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1657, "message": "in _send_handling_auth"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1694, "message": "in _send_handling_redirects"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1730, "message": "in _send_single_request"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py", "lineno": 394, "message": "in handle_async_request"}, {"path": "../../anaconda3/lib/python3.9/contextlib.py", "lineno": 137, "message": "in __exit__"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py", "lineno": 118, "message": "ReadError"}], "longrepr": "@contextlib.contextmanager\n    def map_httpcore_exceptions() -> typing.Iterator[None]:\n        global HTTPCORE_EXC_MAP\n        if len(HTTPCORE_EXC_MAP) == 0:\n            HTTPCORE_EXC_MAP = _load_httpcore_exceptions()\n        try:\n>           yield\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:101: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:394: in handle_async_request\n    resp = await self._pool.handle_async_request(req)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/connection_pool.py:256: in handle_async_request\n    raise exc from None\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/connection_pool.py:236: in handle_async_request\n    response = await connection.handle_async_request(\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/connection.py:103: in handle_async_request\n    return await self._connection.handle_async_request(request)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:136: in handle_async_request\n    raise exc\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:106: in handle_async_request\n    ) = await self._receive_response_headers(**kwargs)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:177: in _receive_response_headers\n    event = await self._receive_event(timeout=timeout)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:217: in _receive_event\n    data = await self._network_stream.read(\n../../anaconda3/lib/python3.9/site-packages/httpcore/_backends/anyio.py:37: in read\n    return b\"\"\n../../anaconda3/lib/python3.9/contextlib.py:137: in __exit__\n    self.gen.throw(typ, value, traceback)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nmap = {<class 'TimeoutError'>: <class 'httpcore.ReadTimeout'>, <class 'anyio.BrokenResourceError'>: <class 'httpcore.ReadErr... 'anyio.ClosedResourceError'>: <class 'httpcore.ReadError'>, <class 'anyio.EndOfStream'>: <class 'httpcore.ReadError'>}\n\n    @contextlib.contextmanager\n    def map_exceptions(map: ExceptionMapping) -> typing.Iterator[None]:\n        try:\n            yield\n        except Exception as exc:  # noqa: PIE786\n            for from_exc, to_exc in map.items():\n                if isinstance(exc, from_exc):\n>                   raise to_exc(exc) from exc\nE                   httpcore.ReadError\n\n../../anaconda3/lib/python3.9/site-packages/httpcore/_exceptions.py:14: ReadError\n\nThe above exception was the direct cause of the following exception:\n\nrest = <conftest.RESTClient object at 0x7f47ab775d30>\n\n    async def test_ha_turn_off(rest):\n        \"\"\"homeassistant.turn_off sets entity to off.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"light.ha_off_{tag}\"\n>       await rest.set_state(eid, \"on\")\n\ntests/entity/test_homeassistant_service.py:35: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:89: in set_state\n    resp = await self.client.post(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1859: in post\n    return await self.request(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1540: in request\n    return await self.send(request, auth=auth, follow_redirects=follow_redirects)\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1629: in send\n    response = await self._send_handling_auth(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1657: in _send_handling_auth\n    response = await self._send_handling_redirects(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1694: in _send_handling_redirects\n    response = await self._send_single_request(request)\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1730: in _send_single_request\n    response = await transport.handle_async_request(request)\n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:394: in handle_async_request\n    resp = await self._pool.handle_async_request(req)\n../../anaconda3/lib/python3.9/contextlib.py:137: in __exit__\n    self.gen.throw(typ, value, traceback)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\n    @contextlib.contextmanager\n    def map_httpcore_exceptions() -> typing.Iterator[None]:\n        global HTTPCORE_EXC_MAP\n        if len(HTTPCORE_EXC_MAP) == 0:\n            HTTPCORE_EXC_MAP = _load_httpcore_exceptions()\n        try:\n            yield\n        except Exception as exc:\n            mapped_exc = None\n    \n            for from_exc, to_exc in HTTPCORE_EXC_MAP.items():\n                if not isinstance(exc, from_exc):\n                    continue\n                # We want to map to the most specific exception we can find.\n                # Eg if `exc` is an `httpcore.ReadTimeout`, we want to map to\n                # `httpx.ReadTimeout`, not just `httpx.TimeoutException`.\n                if mapped_exc is None or issubclass(to_exc, mapped_exc):\n                    mapped_exc = to_exc\n    \n            if mapped_exc is None:  # pragma: no cover\n                raise\n    \n            message = str(exc)\n>           raise mapped_exc(message) from exc\nE           httpx.ReadError\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:118: ReadError"}, "teardown": {"duration": 0.000574708916246891, "outcome": "passed"}}, {"nodeid": "tests/entity/test_homeassistant_service.py::test_ha_toggle", "lineno": 47, "outcome": "failed", "keywords": ["test_ha_toggle", "test_homeassistant_service.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005927033722400665, "outcome": "passed"}, "call": {"duration": 0.0019297599792480469, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py", "lineno": 118, "message": "httpx.ReadError"}, "traceback": [{"path": "tests/entity/test_homeassistant_service.py", "lineno": 52, "message": ""}, {"path": "tests/conftest.py", "lineno": 89, "message": "in set_state"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1859, "message": "in post"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1540, "message": "in request"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1629, "message": "in send"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1657, "message": "in _send_handling_auth"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1694, "message": "in _send_handling_redirects"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1730, "message": "in _send_single_request"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py", "lineno": 394, "message": "in handle_async_request"}, {"path": "../../anaconda3/lib/python3.9/contextlib.py", "lineno": 137, "message": "in __exit__"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py", "lineno": 118, "message": "ReadError"}], "longrepr": "@contextlib.contextmanager\n    def map_httpcore_exceptions() -> typing.Iterator[None]:\n        global HTTPCORE_EXC_MAP\n        if len(HTTPCORE_EXC_MAP) == 0:\n            HTTPCORE_EXC_MAP = _load_httpcore_exceptions()\n        try:\n>           yield\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:101: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:394: in handle_async_request\n    resp = await self._pool.handle_async_request(req)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/connection_pool.py:256: in handle_async_request\n    raise exc from None\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/connection_pool.py:236: in handle_async_request\n    response = await connection.handle_async_request(\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/connection.py:103: in handle_async_request\n    return await self._connection.handle_async_request(request)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:136: in handle_async_request\n    raise exc\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:106: in handle_async_request\n    ) = await self._receive_response_headers(**kwargs)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:177: in _receive_response_headers\n    event = await self._receive_event(timeout=timeout)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:217: in _receive_event\n    data = await self._network_stream.read(\n../../anaconda3/lib/python3.9/site-packages/httpcore/_backends/anyio.py:37: in read\n    return b\"\"\n../../anaconda3/lib/python3.9/contextlib.py:137: in __exit__\n    self.gen.throw(typ, value, traceback)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nmap = {<class 'TimeoutError'>: <class 'httpcore.ReadTimeout'>, <class 'anyio.BrokenResourceError'>: <class 'httpcore.ReadErr... 'anyio.ClosedResourceError'>: <class 'httpcore.ReadError'>, <class 'anyio.EndOfStream'>: <class 'httpcore.ReadError'>}\n\n    @contextlib.contextmanager\n    def map_exceptions(map: ExceptionMapping) -> typing.Iterator[None]:\n        try:\n            yield\n        except Exception as exc:  # noqa: PIE786\n            for from_exc, to_exc in map.items():\n                if isinstance(exc, from_exc):\n>                   raise to_exc(exc) from exc\nE                   httpcore.ReadError\n\n../../anaconda3/lib/python3.9/site-packages/httpcore/_exceptions.py:14: ReadError\n\nThe above exception was the direct cause of the following exception:\n\nrest = <conftest.RESTClient object at 0x7f47ab6793a0>\n\n    async def test_ha_toggle(rest):\n        \"\"\"homeassistant.toggle flips entity state.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"switch.ha_toggle_{tag}\"\n>       await rest.set_state(eid, \"on\")\n\ntests/entity/test_homeassistant_service.py:52: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:89: in set_state\n    resp = await self.client.post(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1859: in post\n    return await self.request(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1540: in request\n    return await self.send(request, auth=auth, follow_redirects=follow_redirects)\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1629: in send\n    response = await self._send_handling_auth(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1657: in _send_handling_auth\n    response = await self._send_handling_redirects(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1694: in _send_handling_redirects\n    response = await self._send_single_request(request)\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1730: in _send_single_request\n    response = await transport.handle_async_request(request)\n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:394: in handle_async_request\n    resp = await self._pool.handle_async_request(req)\n../../anaconda3/lib/python3.9/contextlib.py:137: in __exit__\n    self.gen.throw(typ, value, traceback)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\n    @contextlib.contextmanager\n    def map_httpcore_exceptions() -> typing.Iterator[None]:\n        global HTTPCORE_EXC_MAP\n        if len(HTTPCORE_EXC_MAP) == 0:\n            HTTPCORE_EXC_MAP = _load_httpcore_exceptions()\n        try:\n            yield\n        except Exception as exc:\n            mapped_exc = None\n    \n            for from_exc, to_exc in HTTPCORE_EXC_MAP.items():\n                if not isinstance(exc, from_exc):\n                    continue\n                # We want to map to the most specific exception we can find.\n                # Eg if `exc` is an `httpcore.ReadTimeout`, we want to map to\n                # `httpx.ReadTimeout`, not just `httpx.TimeoutException`.\n                if mapped_exc is None or issubclass(to_exc, mapped_exc):\n                    mapped_exc = to_exc\n    \n            if mapped_exc is None:  # pragma: no cover\n                raise\n    \n            message = str(exc)\n>           raise mapped_exc(message) from exc\nE           httpx.ReadError\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:118: ReadError"}, "teardown": {"duration": 0.0005389060825109482, "outcome": "passed"}}, {"nodeid": "tests/entity/test_homeassistant_service.py::test_ha_turn_on_multiple", "lineno": 63, "outcome": "failed", "keywords": ["test_ha_turn_on_multiple", "test_homeassistant_service.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005554869305342436, "outcome": "passed"}, "call": {"duration": 0.0019977916963398457, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py", "lineno": 118, "message": "httpx.ReadError"}, "traceback": [{"path": "tests/entity/test_homeassistant_service.py", "lineno": 69, "message": ""}, {"path": "tests/conftest.py", "lineno": 89, "message": "in set_state"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1859, "message": "in post"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1540, "message": "in request"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1629, "message": "in send"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1657, "message": "in _send_handling_auth"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1694, "message": "in _send_handling_redirects"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1730, "message": "in _send_single_request"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py", "lineno": 394, "message": "in handle_async_request"}, {"path": "../../anaconda3/lib/python3.9/contextlib.py", "lineno": 137, "message": "in __exit__"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py", "lineno": 118, "message": "ReadError"}], "longrepr": "@contextlib.contextmanager\n    def map_httpcore_exceptions() -> typing.Iterator[None]:\n        global HTTPCORE_EXC_MAP\n        if len(HTTPCORE_EXC_MAP) == 0:\n            HTTPCORE_EXC_MAP = _load_httpcore_exceptions()\n        try:\n>           yield\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:101: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:394: in handle_async_request\n    resp = await self._pool.handle_async_request(req)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/connection_pool.py:256: in handle_async_request\n    raise exc from None\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/connection_pool.py:236: in handle_async_request\n    response = await connection.handle_async_request(\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/connection.py:103: in handle_async_request\n    return await self._connection.handle_async_request(request)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:136: in handle_async_request\n    raise exc\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:106: in handle_async_request\n    ) = await self._receive_response_headers(**kwargs)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:177: in _receive_response_headers\n    event = await self._receive_event(timeout=timeout)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:217: in _receive_event\n    data = await self._network_stream.read(\n../../anaconda3/lib/python3.9/site-packages/httpcore/_backends/anyio.py:37: in read\n    return b\"\"\n../../anaconda3/lib/python3.9/contextlib.py:137: in __exit__\n    self.gen.throw(typ, value, traceback)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nmap = {<class 'TimeoutError'>: <class 'httpcore.ReadTimeout'>, <class 'anyio.BrokenResourceError'>: <class 'httpcore.ReadErr... 'anyio.ClosedResourceError'>: <class 'httpcore.ReadError'>, <class 'anyio.EndOfStream'>: <class 'httpcore.ReadError'>}\n\n    @contextlib.contextmanager\n    def map_exceptions(map: ExceptionMapping) -> typing.Iterator[None]:\n        try:\n            yield\n        except Exception as exc:  # noqa: PIE786\n            for from_exc, to_exc in map.items():\n                if isinstance(exc, from_exc):\n>                   raise to_exc(exc) from exc\nE                   httpcore.ReadError\n\n../../anaconda3/lib/python3.9/site-packages/httpcore/_exceptions.py:14: ReadError\n\nThe above exception was the direct cause of the following exception:\n\nrest = <conftest.RESTClient object at 0x7f47ab651a00>\n\n    async def test_ha_turn_on_multiple(rest):\n        \"\"\"homeassistant.turn_on with entity_id array.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eids = [f\"light.ha_multi_{tag}_{i}\" for i in range(3)]\n        for eid in eids:\n>           await rest.set_state(eid, \"off\")\n\ntests/entity/test_homeassistant_service.py:69: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:89: in set_state\n    resp = await self.client.post(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1859: in post\n    return await self.request(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1540: in request\n    return await self.send(request, auth=auth, follow_redirects=follow_redirects)\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1629: in send\n    response = await self._send_handling_auth(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1657: in _send_handling_auth\n    response = await self._send_handling_redirects(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1694: in _send_handling_redirects\n    response = await self._send_single_request(request)\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1730: in _send_single_request\n    response = await transport.handle_async_request(request)\n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:394: in handle_async_request\n    resp = await self._pool.handle_async_request(req)\n../../anaconda3/lib/python3.9/contextlib.py:137: in __exit__\n    self.gen.throw(typ, value, traceback)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\n    @contextlib.contextmanager\n    def map_httpcore_exceptions() -> typing.Iterator[None]:\n        global HTTPCORE_EXC_MAP\n        if len(HTTPCORE_EXC_MAP) == 0:\n            HTTPCORE_EXC_MAP = _load_httpcore_exceptions()\n        try:\n            yield\n        except Exception as exc:\n            mapped_exc = None\n    \n            for from_exc, to_exc in HTTPCORE_EXC_MAP.items():\n                if not isinstance(exc, from_exc):\n                    continue\n                # We want to map to the most specific exception we can find.\n                # Eg if `exc` is an `httpcore.ReadTimeout`, we want to map to\n                # `httpx.ReadTimeout`, not just `httpx.TimeoutException`.\n                if mapped_exc is None or issubclass(to_exc, mapped_exc):\n                    mapped_exc = to_exc\n    \n            if mapped_exc is None:  # pragma: no cover\n                raise\n    \n            message = str(exc)\n>           raise mapped_exc(message) from exc\nE           httpx.ReadError\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:118: ReadError"}, "teardown": {"duration": 0.0005360483191907406, "outcome": "passed"}}, {"nodeid": "tests/entity/test_homeassistant_service.py::test_ha_turn_off_multiple", "lineno": 82, "outcome": "failed", "keywords": ["test_ha_turn_off_multiple", "test_homeassistant_service.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005195027217268944, "outcome": "passed"}, "call": {"duration": 0.0019953721202909946, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py", "lineno": 118, "message": "httpx.ReadError"}, "traceback": [{"path": "tests/entity/test_homeassistant_service.py", "lineno": 88, "message": ""}, {"path": "tests/conftest.py", "lineno": 89, "message": "in set_state"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1859, "message": "in post"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1540, "message": "in request"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1629, "message": "in send"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1657, "message": "in _send_handling_auth"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1694, "message": "in _send_handling_redirects"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1730, "message": "in _send_single_request"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py", "lineno": 394, "message": "in handle_async_request"}, {"path": "../../anaconda3/lib/python3.9/contextlib.py", "lineno": 137, "message": "in __exit__"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py", "lineno": 118, "message": "ReadError"}], "longrepr": "@contextlib.contextmanager\n    def map_httpcore_exceptions() -> typing.Iterator[None]:\n        global HTTPCORE_EXC_MAP\n        if len(HTTPCORE_EXC_MAP) == 0:\n            HTTPCORE_EXC_MAP = _load_httpcore_exceptions()\n        try:\n>           yield\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:101: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:394: in handle_async_request\n    resp = await self._pool.handle_async_request(req)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/connection_pool.py:256: in handle_async_request\n    raise exc from None\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/connection_pool.py:236: in handle_async_request\n    response = await connection.handle_async_request(\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/connection.py:103: in handle_async_request\n    return await self._connection.handle_async_request(request)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:136: in handle_async_request\n    raise exc\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:106: in handle_async_request\n    ) = await self._receive_response_headers(**kwargs)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:177: in _receive_response_headers\n    event = await self._receive_event(timeout=timeout)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:217: in _receive_event\n    data = await self._network_stream.read(\n../../anaconda3/lib/python3.9/site-packages/httpcore/_backends/anyio.py:37: in read\n    return b\"\"\n../../anaconda3/lib/python3.9/contextlib.py:137: in __exit__\n    self.gen.throw(typ, value, traceback)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nmap = {<class 'TimeoutError'>: <class 'httpcore.ReadTimeout'>, <class 'anyio.BrokenResourceError'>: <class 'httpcore.ReadErr... 'anyio.ClosedResourceError'>: <class 'httpcore.ReadError'>, <class 'anyio.EndOfStream'>: <class 'httpcore.ReadError'>}\n\n    @contextlib.contextmanager\n    def map_exceptions(map: ExceptionMapping) -> typing.Iterator[None]:\n        try:\n            yield\n        except Exception as exc:  # noqa: PIE786\n            for from_exc, to_exc in map.items():\n                if isinstance(exc, from_exc):\n>                   raise to_exc(exc) from exc\nE                   httpcore.ReadError\n\n../../anaconda3/lib/python3.9/site-packages/httpcore/_exceptions.py:14: ReadError\n\nThe above exception was the direct cause of the following exception:\n\nrest = <conftest.RESTClient object at 0x7f47ab651a90>\n\n    async def test_ha_turn_off_multiple(rest):\n        \"\"\"homeassistant.turn_off with entity_id array.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eids = [f\"switch.ha_off_multi_{tag}_{i}\" for i in range(3)]\n        for eid in eids:\n>           await rest.set_state(eid, \"on\")\n\ntests/entity/test_homeassistant_service.py:88: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:89: in set_state\n    resp = await self.client.post(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1859: in post\n    return await self.request(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1540: in request\n    return await self.send(request, auth=auth, follow_redirects=follow_redirects)\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1629: in send\n    response = await self._send_handling_auth(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1657: in _send_handling_auth\n    response = await self._send_handling_redirects(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1694: in _send_handling_redirects\n    response = await self._send_single_request(request)\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1730: in _send_single_request\n    response = await transport.handle_async_request(request)\n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:394: in handle_async_request\n    resp = await self._pool.handle_async_request(req)\n../../anaconda3/lib/python3.9/contextlib.py:137: in __exit__\n    self.gen.throw(typ, value, traceback)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\n    @contextlib.contextmanager\n    def map_httpcore_exceptions() -> typing.Iterator[None]:\n        global HTTPCORE_EXC_MAP\n        if len(HTTPCORE_EXC_MAP) == 0:\n            HTTPCORE_EXC_MAP = _load_httpcore_exceptions()\n        try:\n            yield\n        except Exception as exc:\n            mapped_exc = None\n    \n            for from_exc, to_exc in HTTPCORE_EXC_MAP.items():\n                if not isinstance(exc, from_exc):\n                    continue\n                # We want to map to the most specific exception we can find.\n                # Eg if `exc` is an `httpcore.ReadTimeout`, we want to map to\n                # `httpx.ReadTimeout`, not just `httpx.TimeoutException`.\n                if mapped_exc is None or issubclass(to_exc, mapped_exc):\n                    mapped_exc = to_exc\n    \n            if mapped_exc is None:  # pragma: no cover\n                raise\n    \n            message = str(exc)\n>           raise mapped_exc(message) from exc\nE           httpx.ReadError\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:118: ReadError"}, "teardown": {"duration": 0.0005884976126253605, "outcome": "passed"}}, {"nodeid": "tests/entity/test_homeassistant_service.py::test_ha_toggle_mixed_states", "lineno": 100, "outcome": "failed", "keywords": ["test_ha_toggle_mixed_states", "test_homeassistant_service.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005649416707456112, "outcome": "passed"}, "call": {"duration": 0.001863773912191391, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py", "lineno": 118, "message": "httpx.ReadError"}, "traceback": [{"path": "tests/entity/test_homeassistant_service.py", "lineno": 106, "message": ""}, {"path": "tests/conftest.py", "lineno": 89, "message": "in set_state"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1859, "message": "in post"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1540, "message": "in request"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1629, "message": "in send"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1657, "message": "in _send_handling_auth"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1694, "message": "in _send_handling_redirects"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1730, "message": "in _send_single_request"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py", "lineno": 394, "message": "in handle_async_request"}, {"path": "../../anaconda3/lib/python3.9/contextlib.py", "lineno": 137, "message": "in __exit__"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py", "lineno": 118, "message": "ReadError"}], "longrepr": "@contextlib.contextmanager\n    def map_httpcore_exceptions() -> typing.Iterator[None]:\n        global HTTPCORE_EXC_MAP\n        if len(HTTPCORE_EXC_MAP) == 0:\n            HTTPCORE_EXC_MAP = _load_httpcore_exceptions()\n        try:\n>           yield\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:101: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:394: in handle_async_request\n    resp = await self._pool.handle_async_request(req)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/connection_pool.py:256: in handle_async_request\n    raise exc from None\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/connection_pool.py:236: in handle_async_request\n    response = await connection.handle_async_request(\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/connection.py:103: in handle_async_request\n    return await self._connection.handle_async_request(request)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:136: in handle_async_request\n    raise exc\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:106: in handle_async_request\n    ) = await self._receive_response_headers(**kwargs)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:177: in _receive_response_headers\n    event = await self._receive_event(timeout=timeout)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:217: in _receive_event\n    data = await self._network_stream.read(\n../../anaconda3/lib/python3.9/site-packages/httpcore/_backends/anyio.py:37: in read\n    return b\"\"\n../../anaconda3/lib/python3.9/contextlib.py:137: in __exit__\n    self.gen.throw(typ, value, traceback)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nmap = {<class 'TimeoutError'>: <class 'httpcore.ReadTimeout'>, <class 'anyio.BrokenResourceError'>: <class 'httpcore.ReadErr... 'anyio.ClosedResourceError'>: <class 'httpcore.ReadError'>, <class 'anyio.EndOfStream'>: <class 'httpcore.ReadError'>}\n\n    @contextlib.contextmanager\n    def map_exceptions(map: ExceptionMapping) -> typing.Iterator[None]:\n        try:\n            yield\n        except Exception as exc:  # noqa: PIE786\n            for from_exc, to_exc in map.items():\n                if isinstance(exc, from_exc):\n>                   raise to_exc(exc) from exc\nE                   httpcore.ReadError\n\n../../anaconda3/lib/python3.9/site-packages/httpcore/_exceptions.py:14: ReadError\n\nThe above exception was the direct cause of the following exception:\n\nrest = <conftest.RESTClient object at 0x7f47b0bc85b0>\n\n    async def test_ha_toggle_mixed_states(rest):\n        \"\"\"homeassistant.toggle with mixed on/off entities.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid_on = f\"light.ha_tmix_on_{tag}\"\n        eid_off = f\"light.ha_tmix_off_{tag}\"\n>       await rest.set_state(eid_on, \"on\")\n\ntests/entity/test_homeassistant_service.py:106: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:89: in set_state\n    resp = await self.client.post(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1859: in post\n    return await self.request(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1540: in request\n    return await self.send(request, auth=auth, follow_redirects=follow_redirects)\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1629: in send\n    response = await self._send_handling_auth(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1657: in _send_handling_auth\n    response = await self._send_handling_redirects(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1694: in _send_handling_redirects\n    response = await self._send_single_request(request)\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1730: in _send_single_request\n    response = await transport.handle_async_request(request)\n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:394: in handle_async_request\n    resp = await self._pool.handle_async_request(req)\n../../anaconda3/lib/python3.9/contextlib.py:137: in __exit__\n    self.gen.throw(typ, value, traceback)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\n    @contextlib.contextmanager\n    def map_httpcore_exceptions() -> typing.Iterator[None]:\n        global HTTPCORE_EXC_MAP\n        if len(HTTPCORE_EXC_MAP) == 0:\n            HTTPCORE_EXC_MAP = _load_httpcore_exceptions()\n        try:\n            yield\n        except Exception as exc:\n            mapped_exc = None\n    \n            for from_exc, to_exc in HTTPCORE_EXC_MAP.items():\n                if not isinstance(exc, from_exc):\n                    continue\n                # We want to map to the most specific exception we can find.\n                # Eg if `exc` is an `httpcore.ReadTimeout`, we want to map to\n                # `httpx.ReadTimeout`, not just `httpx.TimeoutException`.\n                if mapped_exc is None or issubclass(to_exc, mapped_exc):\n                    mapped_exc = to_exc\n    \n            if mapped_exc is None:  # pragma: no cover\n                raise\n    \n            message = str(exc)\n>           raise mapped_exc(message) from exc\nE           httpx.ReadError\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:118: ReadError"}, "teardown": {"duration": 0.0005662180483341217, "outcome": "passed"}}, {"nodeid": "tests/entity/test_homeassistant_service.py::test_ha_turn_on_different_domains", "lineno": 120, "outcome": "failed", "keywords": ["test_ha_turn_on_different_domains", "test_homeassistant_service.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005524718668311834, "outcome": "passed"}, "call": {"duration": 0.0019636531360447407, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py", "lineno": 118, "message": "httpx.ReadError"}, "traceback": [{"path": "tests/entity/test_homeassistant_service.py", "lineno": 130, "message": ""}, {"path": "tests/conftest.py", "lineno": 89, "message": "in set_state"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1859, "message": "in post"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1540, "message": "in request"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1629, "message": "in send"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1657, "message": "in _send_handling_auth"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1694, "message": "in _send_handling_redirects"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1730, "message": "in _send_single_request"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py", "lineno": 394, "message": "in handle_async_request"}, {"path": "../../anaconda3/lib/python3.9/contextlib.py", "lineno": 137, "message": "in __exit__"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py", "lineno": 118, "message": "ReadError"}], "longrepr": "@contextlib.contextmanager\n    def map_httpcore_exceptions() -> typing.Iterator[None]:\n        global HTTPCORE_EXC_MAP\n        if len(HTTPCORE_EXC_MAP) == 0:\n            HTTPCORE_EXC_MAP = _load_httpcore_exceptions()\n        try:\n>           yield\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:101: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:394: in handle_async_request\n    resp = await self._pool.handle_async_request(req)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/connection_pool.py:256: in handle_async_request\n    raise exc from None\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/connection_pool.py:236: in handle_async_request\n    response = await connection.handle_async_request(\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/connection.py:103: in handle_async_request\n    return await self._connection.handle_async_request(request)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:136: in handle_async_request\n    raise exc\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:106: in handle_async_request\n    ) = await self._receive_response_headers(**kwargs)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:177: in _receive_response_headers\n    event = await self._receive_event(timeout=timeout)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:217: in _receive_event\n    data = await self._network_stream.read(\n../../anaconda3/lib/python3.9/site-packages/httpcore/_backends/anyio.py:37: in read\n    return b\"\"\n../../anaconda3/lib/python3.9/contextlib.py:137: in __exit__\n    self.gen.throw(typ, value, traceback)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nmap = {<class 'TimeoutError'>: <class 'httpcore.ReadTimeout'>, <class 'anyio.BrokenResourceError'>: <class 'httpcore.ReadErr... 'anyio.ClosedResourceError'>: <class 'httpcore.ReadError'>, <class 'anyio.EndOfStream'>: <class 'httpcore.ReadError'>}\n\n    @contextlib.contextmanager\n    def map_exceptions(map: ExceptionMapping) -> typing.Iterator[None]:\n        try:\n            yield\n        except Exception as exc:  # noqa: PIE786\n            for from_exc, to_exc in map.items():\n                if isinstance(exc, from_exc):\n>                   raise to_exc(exc) from exc\nE                   httpcore.ReadError\n\n../../anaconda3/lib/python3.9/site-packages/httpcore/_exceptions.py:14: ReadError\n\nThe above exception was the direct cause of the following exception:\n\nrest = <conftest.RESTClient object at 0x7f47b0bc89d0>\n\n    async def test_ha_turn_on_different_domains(rest):\n        \"\"\"homeassistant.turn_on works across different domains.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        entities = {\n            f\"light.ha_dom_{tag}\": \"off\",\n            f\"switch.ha_dom_{tag}\": \"off\",\n            f\"fan.ha_dom_{tag}\": \"off\",\n        }\n        for eid, state in entities.items():\n>           await rest.set_state(eid, state)\n\ntests/entity/test_homeassistant_service.py:130: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:89: in set_state\n    resp = await self.client.post(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1859: in post\n    return await self.request(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1540: in request\n    return await self.send(request, auth=auth, follow_redirects=follow_redirects)\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1629: in send\n    response = await self._send_handling_auth(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1657: in _send_handling_auth\n    response = await self._send_handling_redirects(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1694: in _send_handling_redirects\n    response = await self._send_single_request(request)\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1730: in _send_single_request\n    response = await transport.handle_async_request(request)\n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:394: in handle_async_request\n    resp = await self._pool.handle_async_request(req)\n../../anaconda3/lib/python3.9/contextlib.py:137: in __exit__\n    self.gen.throw(typ, value, traceback)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\n    @contextlib.contextmanager\n    def map_httpcore_exceptions() -> typing.Iterator[None]:\n        global HTTPCORE_EXC_MAP\n        if len(HTTPCORE_EXC_MAP) == 0:\n            HTTPCORE_EXC_MAP = _load_httpcore_exceptions()\n        try:\n            yield\n        except Exception as exc:\n            mapped_exc = None\n    \n            for from_exc, to_exc in HTTPCORE_EXC_MAP.items():\n                if not isinstance(exc, from_exc):\n                    continue\n                # We want to map to the most specific exception we can find.\n                # Eg if `exc` is an `httpcore.ReadTimeout`, we want to map to\n                # `httpx.ReadTimeout`, not just `httpx.TimeoutException`.\n                if mapped_exc is None or issubclass(to_exc, mapped_exc):\n                    mapped_exc = to_exc\n    \n            if mapped_exc is None:  # pragma: no cover\n                raise\n    \n            message = str(exc)\n>           raise mapped_exc(message) from exc\nE           httpx.ReadError\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:118: ReadError"}, "teardown": {"duration": 0.0005723689682781696, "outcome": "passed"}}, {"nodeid": "tests/entity/test_homeassistant_service.py::test_ha_check_config", "lineno": 143, "outcome": "failed", "keywords": ["test_ha_check_config", "test_homeassistant_service.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.00542012695223093, "outcome": "passed"}, "call": {"duration": 0.0020248987711966038, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py", "lineno": 118, "message": "httpx.ReadError"}, "traceback": [{"path": "tests/entity/test_homeassistant_service.py", "lineno": 146, "message": ""}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1859, "message": "in post"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1540, "message": "in request"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1629, "message": "in send"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1657, "message": "in _send_handling_auth"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1694, "message": "in _send_handling_redirects"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1730, "message": "in _send_single_request"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py", "lineno": 394, "message": "in handle_async_request"}, {"path": "../../anaconda3/lib/python3.9/contextlib.py", "lineno": 137, "message": "in __exit__"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py", "lineno": 118, "message": "ReadError"}], "longrepr": "@contextlib.contextmanager\n    def map_httpcore_exceptions() -> typing.Iterator[None]:\n        global HTTPCORE_EXC_MAP\n        if len(HTTPCORE_EXC_MAP) == 0:\n            HTTPCORE_EXC_MAP = _load_httpcore_exceptions()\n        try:\n>           yield\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:101: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:394: in handle_async_request\n    resp = await self._pool.handle_async_request(req)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/connection_pool.py:256: in handle_async_request\n    raise exc from None\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/connection_pool.py:236: in handle_async_request\n    response = await connection.handle_async_request(\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/connection.py:103: in handle_async_request\n    return await self._connection.handle_async_request(request)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:136: in handle_async_request\n    raise exc\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:106: in handle_async_request\n    ) = await self._receive_response_headers(**kwargs)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:177: in _receive_response_headers\n    event = await self._receive_event(timeout=timeout)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:217: in _receive_event\n    data = await self._network_stream.read(\n../../anaconda3/lib/python3.9/site-packages/httpcore/_backends/anyio.py:37: in read\n    return b\"\"\n../../anaconda3/lib/python3.9/contextlib.py:137: in __exit__\n    self.gen.throw(typ, value, traceback)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nmap = {<class 'TimeoutError'>: <class 'httpcore.ReadTimeout'>, <class 'anyio.BrokenResourceError'>: <class 'httpcore.ReadErr... 'anyio.ClosedResourceError'>: <class 'httpcore.ReadError'>, <class 'anyio.EndOfStream'>: <class 'httpcore.ReadError'>}\n\n    @contextlib.contextmanager\n    def map_exceptions(map: ExceptionMapping) -> typing.Iterator[None]:\n        try:\n            yield\n        except Exception as exc:  # noqa: PIE786\n            for from_exc, to_exc in map.items():\n                if isinstance(exc, from_exc):\n>                   raise to_exc(exc) from exc\nE                   httpcore.ReadError\n\n../../anaconda3/lib/python3.9/site-packages/httpcore/_exceptions.py:14: ReadError\n\nThe above exception was the direct cause of the following exception:\n\nrest = <conftest.RESTClient object at 0x7f47b0470af0>\n\n    async def test_ha_check_config(rest):\n        \"\"\"homeassistant.check_config returns valid.\"\"\"\n>       resp = await rest.client.post(\n            f\"{rest.base_url}/api/config/core/check_config\",\n            json={},\n            headers=rest._headers(),\n        )\n\ntests/entity/test_homeassistant_service.py:146: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1859: in post\n    return await self.request(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1540: in request\n    return await self.send(request, auth=auth, follow_redirects=follow_redirects)\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1629: in send\n    response = await self._send_handling_auth(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1657: in _send_handling_auth\n    response = await self._send_handling_redirects(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1694: in _send_handling_redirects\n    response = await self._send_single_request(request)\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1730: in _send_single_request\n    response = await transport.handle_async_request(request)\n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:394: in handle_async_request\n    resp = await self._pool.handle_async_request(req)\n../../anaconda3/lib/python3.9/contextlib.py:137: in __exit__\n    self.gen.throw(typ, value, traceback)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\n    @contextlib.contextmanager\n    def map_httpcore_exceptions() -> typing.Iterator[None]:\n        global HTTPCORE_EXC_MAP\n        if len(HTTPCORE_EXC_MAP) == 0:\n            HTTPCORE_EXC_MAP = _load_httpcore_exceptions()\n        try:\n            yield\n        except Exception as exc:\n            mapped_exc = None\n    \n            for from_exc, to_exc in HTTPCORE_EXC_MAP.items():\n                if not isinstance(exc, from_exc):\n                    continue\n                # We want to map to the most specific exception we can find.\n                # Eg if `exc` is an `httpcore.ReadTimeout`, we want to map to\n                # `httpx.ReadTimeout`, not just `httpx.TimeoutException`.\n                if mapped_exc is None or issubclass(to_exc, mapped_exc):\n                    mapped_exc = to_exc\n    \n            if mapped_exc is None:  # pragma: no cover\n                raise\n    \n            message = str(exc)\n>           raise mapped_exc(message) from exc\nE           httpx.ReadError\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:118: ReadError"}, "teardown": {"duration": 0.0005507939495146275, "outcome": "passed"}}, {"nodeid": "tests/entity/test_homeassistant_service.py::test_ha_turn_on_preserves_attributes", "lineno": 155, "outcome": "failed", "keywords": ["test_ha_turn_on_preserves_attributes", "test_homeassistant_service.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005485080182552338, "outcome": "passed"}, "call": {"duration": 0.0017994288355112076, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py", "lineno": 118, "message": "httpx.ReadError"}, "traceback": [{"path": "tests/entity/test_homeassistant_service.py", "lineno": 160, "message": ""}, {"path": "tests/conftest.py", "lineno": 89, "message": "in set_state"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1859, "message": "in post"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1540, "message": "in request"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1629, "message": "in send"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1657, "message": "in _send_handling_auth"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1694, "message": "in _send_handling_redirects"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1730, "message": "in _send_single_request"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py", "lineno": 394, "message": "in handle_async_request"}, {"path": "../../anaconda3/lib/python3.9/contextlib.py", "lineno": 137, "message": "in __exit__"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py", "lineno": 118, "message": "ReadError"}], "longrepr": "@contextlib.contextmanager\n    def map_httpcore_exceptions() -> typing.Iterator[None]:\n        global HTTPCORE_EXC_MAP\n        if len(HTTPCORE_EXC_MAP) == 0:\n            HTTPCORE_EXC_MAP = _load_httpcore_exceptions()\n        try:\n>           yield\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:101: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:394: in handle_async_request\n    resp = await self._pool.handle_async_request(req)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/connection_pool.py:256: in handle_async_request\n    raise exc from None\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/connection_pool.py:236: in handle_async_request\n    response = await connection.handle_async_request(\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/connection.py:103: in handle_async_request\n    return await self._connection.handle_async_request(request)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:136: in handle_async_request\n    raise exc\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:106: in handle_async_request\n    ) = await self._receive_response_headers(**kwargs)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:177: in _receive_response_headers\n    event = await self._receive_event(timeout=timeout)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:217: in _receive_event\n    data = await self._network_stream.read(\n../../anaconda3/lib/python3.9/site-packages/httpcore/_backends/anyio.py:37: in read\n    return b\"\"\n../../anaconda3/lib/python3.9/contextlib.py:137: in __exit__\n    self.gen.throw(typ, value, traceback)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nmap = {<class 'TimeoutError'>: <class 'httpcore.ReadTimeout'>, <class 'anyio.BrokenResourceError'>: <class 'httpcore.ReadErr... 'anyio.ClosedResourceError'>: <class 'httpcore.ReadError'>, <class 'anyio.EndOfStream'>: <class 'httpcore.ReadError'>}\n\n    @contextlib.contextmanager\n    def map_exceptions(map: ExceptionMapping) -> typing.Iterator[None]:\n        try:\n            yield\n        except Exception as exc:  # noqa: PIE786\n            for from_exc, to_exc in map.items():\n                if isinstance(exc, from_exc):\n>                   raise to_exc(exc) from exc\nE                   httpcore.ReadError\n\n../../anaconda3/lib/python3.9/site-packages/httpcore/_exceptions.py:14: ReadError\n\nThe above exception was the direct cause of the following exception:\n\nrest = <conftest.RESTClient object at 0x7f47b0bc9eb0>\n\n    async def test_ha_turn_on_preserves_attributes(rest):\n        \"\"\"homeassistant.turn_on preserves existing attributes.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"light.ha_attrs_{tag}\"\n>       await rest.set_state(eid, \"off\", {\"brightness\": 200})\n\ntests/entity/test_homeassistant_service.py:160: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:89: in set_state\n    resp = await self.client.post(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1859: in post\n    return await self.request(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1540: in request\n    return await self.send(request, auth=auth, follow_redirects=follow_redirects)\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1629: in send\n    response = await self._send_handling_auth(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1657: in _send_handling_auth\n    response = await self._send_handling_redirects(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1694: in _send_handling_redirects\n    response = await self._send_single_request(request)\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1730: in _send_single_request\n    response = await transport.handle_async_request(request)\n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:394: in handle_async_request\n    resp = await self._pool.handle_async_request(req)\n../../anaconda3/lib/python3.9/contextlib.py:137: in __exit__\n    self.gen.throw(typ, value, traceback)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\n    @contextlib.contextmanager\n    def map_httpcore_exceptions() -> typing.Iterator[None]:\n        global HTTPCORE_EXC_MAP\n        if len(HTTPCORE_EXC_MAP) == 0:\n            HTTPCORE_EXC_MAP = _load_httpcore_exceptions()\n        try:\n            yield\n        except Exception as exc:\n            mapped_exc = None\n    \n            for from_exc, to_exc in HTTPCORE_EXC_MAP.items():\n                if not isinstance(exc, from_exc):\n                    continue\n                # We want to map to the most specific exception we can find.\n                # Eg if `exc` is an `httpcore.ReadTimeout`, we want to map to\n                # `httpx.ReadTimeout`, not just `httpx.TimeoutException`.\n                if mapped_exc is None or issubclass(to_exc, mapped_exc):\n                    mapped_exc = to_exc\n    \n            if mapped_exc is None:  # pragma: no cover\n                raise\n    \n            message = str(exc)\n>           raise mapped_exc(message) from exc\nE           httpx.ReadError\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:118: ReadError"}, "teardown": {"duration": 0.0005465340800583363, "outcome": "passed"}}, {"nodeid": "tests/entity/test_homeassistant_service.py::test_group_set", "lineno": 174, "outcome": "failed", "keywords": ["test_group_set", "test_homeassistant_service.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005489284638315439, "outcome": "passed"}, "call": {"duration": 0.0019549280405044556, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py", "lineno": 118, "message": "httpx.ReadError"}, "traceback": [{"path": "tests/entity/test_homeassistant_service.py", "lineno": 178, "message": ""}, {"path": "tests/conftest.py", "lineno": 89, "message": "in set_state"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1859, "message": "in post"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1540, "message": "in request"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1629, "message": "in send"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1657, "message": "in _send_handling_auth"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1694, "message": "in _send_handling_redirects"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1730, "message": "in _send_single_request"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py", "lineno": 394, "message": "in handle_async_request"}, {"path": "../../anaconda3/lib/python3.9/contextlib.py", "lineno": 137, "message": "in __exit__"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py", "lineno": 118, "message": "ReadError"}], "longrepr": "@contextlib.contextmanager\n    def map_httpcore_exceptions() -> typing.Iterator[None]:\n        global HTTPCORE_EXC_MAP\n        if len(HTTPCORE_EXC_MAP) == 0:\n            HTTPCORE_EXC_MAP = _load_httpcore_exceptions()\n        try:\n>           yield\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:101: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:394: in handle_async_request\n    resp = await self._pool.handle_async_request(req)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/connection_pool.py:256: in handle_async_request\n    raise exc from None\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/connection_pool.py:236: in handle_async_request\n    response = await connection.handle_async_request(\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/connection.py:103: in handle_async_request\n    return await self._connection.handle_async_request(request)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:136: in handle_async_request\n    raise exc\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:106: in handle_async_request\n    ) = await self._receive_response_headers(**kwargs)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:177: in _receive_response_headers\n    event = await self._receive_event(timeout=timeout)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:217: in _receive_event\n    data = await self._network_stream.read(\n../../anaconda3/lib/python3.9/site-packages/httpcore/_backends/anyio.py:37: in read\n    return b\"\"\n../../anaconda3/lib/python3.9/contextlib.py:137: in __exit__\n    self.gen.throw(typ, value, traceback)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nmap = {<class 'TimeoutError'>: <class 'httpcore.ReadTimeout'>, <class 'anyio.BrokenResourceError'>: <class 'httpcore.ReadErr... 'anyio.ClosedResourceError'>: <class 'httpcore.ReadError'>, <class 'anyio.EndOfStream'>: <class 'httpcore.ReadError'>}\n\n    @contextlib.contextmanager\n    def map_exceptions(map: ExceptionMapping) -> typing.Iterator[None]:\n        try:\n            yield\n        except Exception as exc:  # noqa: PIE786\n            for from_exc, to_exc in map.items():\n                if isinstance(exc, from_exc):\n>                   raise to_exc(exc) from exc\nE                   httpcore.ReadError\n\n../../anaconda3/lib/python3.9/site-packages/httpcore/_exceptions.py:14: ReadError\n\nThe above exception was the direct cause of the following exception:\n\nrest = <conftest.RESTClient object at 0x7f47ab754d60>\n\n    async def test_group_set(rest):\n        \"\"\"group.set sets group state.\"\"\"\n        entity_id = \"group.test_group\"\n>       await rest.set_state(entity_id, \"off\")\n\ntests/entity/test_homeassistant_service.py:178: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:89: in set_state\n    resp = await self.client.post(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1859: in post\n    return await self.request(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1540: in request\n    return await self.send(request, auth=auth, follow_redirects=follow_redirects)\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1629: in send\n    response = await self._send_handling_auth(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1657: in _send_handling_auth\n    response = await self._send_handling_redirects(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1694: in _send_handling_redirects\n    response = await self._send_single_request(request)\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1730: in _send_single_request\n    response = await transport.handle_async_request(request)\n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:394: in handle_async_request\n    resp = await self._pool.handle_async_request(req)\n../../anaconda3/lib/python3.9/contextlib.py:137: in __exit__\n    self.gen.throw(typ, value, traceback)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\n    @contextlib.contextmanager\n    def map_httpcore_exceptions() -> typing.Iterator[None]:\n        global HTTPCORE_EXC_MAP\n        if len(HTTPCORE_EXC_MAP) == 0:\n            HTTPCORE_EXC_MAP = _load_httpcore_exceptions()\n        try:\n            yield\n        except Exception as exc:\n            mapped_exc = None\n    \n            for from_exc, to_exc in HTTPCORE_EXC_MAP.items():\n                if not isinstance(exc, from_exc):\n                    continue\n                # We want to map to the most specific exception we can find.\n                # Eg if `exc` is an `httpcore.ReadTimeout`, we want to map to\n                # `httpx.ReadTimeout`, not just `httpx.TimeoutException`.\n                if mapped_exc is None or issubclass(to_exc, mapped_exc):\n                    mapped_exc = to_exc\n    \n            if mapped_exc is None:  # pragma: no cover\n                raise\n    \n            message = str(exc)\n>           raise mapped_exc(message) from exc\nE           httpx.ReadError\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:118: ReadError"}, "teardown": {"duration": 0.0006570178084075451, "outcome": "passed"}}, {"nodeid": "tests/entity/test_homeassistant_service.py::test_update_install", "lineno": 188, "outcome": "failed", "keywords": ["test_update_install", "test_homeassistant_service.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005850895307958126, "outcome": "passed"}, "call": {"duration": 0.001932219136506319, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py", "lineno": 118, "message": "httpx.ReadError"}, "traceback": [{"path": "tests/entity/test_homeassistant_service.py", "lineno": 192, "message": ""}, {"path": "tests/conftest.py", "lineno": 89, "message": "in set_state"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1859, "message": "in post"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1540, "message": "in request"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1629, "message": "in send"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1657, "message": "in _send_handling_auth"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1694, "message": "in _send_handling_redirects"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1730, "message": "in _send_single_request"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py", "lineno": 394, "message": "in handle_async_request"}, {"path": "../../anaconda3/lib/python3.9/contextlib.py", "lineno": 137, "message": "in __exit__"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py", "lineno": 118, "message": "ReadError"}], "longrepr": "@contextlib.contextmanager\n    def map_httpcore_exceptions() -> typing.Iterator[None]:\n        global HTTPCORE_EXC_MAP\n        if len(HTTPCORE_EXC_MAP) == 0:\n            HTTPCORE_EXC_MAP = _load_httpcore_exceptions()\n        try:\n>           yield\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:101: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:394: in handle_async_request\n    resp = await self._pool.handle_async_request(req)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/connection_pool.py:256: in handle_async_request\n    raise exc from None\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/connection_pool.py:236: in handle_async_request\n    response = await connection.handle_async_request(\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/connection.py:103: in handle_async_request\n    return await self._connection.handle_async_request(request)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:136: in handle_async_request\n    raise exc\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:106: in handle_async_request\n    ) = await self._receive_response_headers(**kwargs)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:177: in _receive_response_headers\n    event = await self._receive_event(timeout=timeout)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:217: in _receive_event\n    data = await self._network_stream.read(\n../../anaconda3/lib/python3.9/site-packages/httpcore/_backends/anyio.py:37: in read\n    return b\"\"\n../../anaconda3/lib/python3.9/contextlib.py:137: in __exit__\n    self.gen.throw(typ, value, traceback)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nmap = {<class 'TimeoutError'>: <class 'httpcore.ReadTimeout'>, <class 'anyio.BrokenResourceError'>: <class 'httpcore.ReadErr... 'anyio.ClosedResourceError'>: <class 'httpcore.ReadError'>, <class 'anyio.EndOfStream'>: <class 'httpcore.ReadError'>}\n\n    @contextlib.contextmanager\n    def map_exceptions(map: ExceptionMapping) -> typing.Iterator[None]:\n        try:\n            yield\n        except Exception as exc:  # noqa: PIE786\n            for from_exc, to_exc in map.items():\n                if isinstance(exc, from_exc):\n>                   raise to_exc(exc) from exc\nE                   httpcore.ReadError\n\n../../anaconda3/lib/python3.9/site-packages/httpcore/_exceptions.py:14: ReadError\n\nThe above exception was the direct cause of the following exception:\n\nrest = <conftest.RESTClient object at 0x7f47b003a8b0>\n\n    async def test_update_install(rest):\n        \"\"\"update.install sets state to 'installing'.\"\"\"\n        entity_id = \"update.test_update\"\n>       await rest.set_state(entity_id, \"available\")\n\ntests/entity/test_homeassistant_service.py:192: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:89: in set_state\n    resp = await self.client.post(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1859: in post\n    return await self.request(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1540: in request\n    return await self.send(request, auth=auth, follow_redirects=follow_redirects)\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1629: in send\n    response = await self._send_handling_auth(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1657: in _send_handling_auth\n    response = await self._send_handling_redirects(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1694: in _send_handling_redirects\n    response = await self._send_single_request(request)\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1730: in _send_single_request\n    response = await transport.handle_async_request(request)\n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:394: in handle_async_request\n    resp = await self._pool.handle_async_request(req)\n../../anaconda3/lib/python3.9/contextlib.py:137: in __exit__\n    self.gen.throw(typ, value, traceback)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\n    @contextlib.contextmanager\n    def map_httpcore_exceptions() -> typing.Iterator[None]:\n        global HTTPCORE_EXC_MAP\n        if len(HTTPCORE_EXC_MAP) == 0:\n            HTTPCORE_EXC_MAP = _load_httpcore_exceptions()\n        try:\n            yield\n        except Exception as exc:\n            mapped_exc = None\n    \n            for from_exc, to_exc in HTTPCORE_EXC_MAP.items():\n                if not isinstance(exc, from_exc):\n                    continue\n                # We want to map to the most specific exception we can find.\n                # Eg if `exc` is an `httpcore.ReadTimeout`, we want to map to\n                # `httpx.ReadTimeout`, not just `httpx.TimeoutException`.\n                if mapped_exc is None or issubclass(to_exc, mapped_exc):\n                    mapped_exc = to_exc\n    \n            if mapped_exc is None:  # pragma: no cover\n                raise\n    \n            message = str(exc)\n>           raise mapped_exc(message) from exc\nE           httpx.ReadError\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:118: ReadError"}, "teardown": {"duration": 0.000587190967053175, "outcome": "passed"}}, {"nodeid": "tests/entity/test_input_number_select_button.py::test_input_number_set_value", "lineno": 15, "outcome": "failed", "keywords": ["test_input_number_set_value", "test_input_number_select_button.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.0057624331675469875, "outcome": "passed"}, "call": {"duration": 0.002042686101049185, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py", "lineno": 118, "message": "httpx.ReadError"}, "traceback": [{"path": "tests/entity/test_input_number_select_button.py", "lineno": 20, "message": ""}, {"path": "tests/conftest.py", "lineno": 89, "message": "in set_state"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1859, "message": "in post"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1540, "message": "in request"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1629, "message": "in send"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1657, "message": "in _send_handling_auth"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1694, "message": "in _send_handling_redirects"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1730, "message": "in _send_single_request"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py", "lineno": 394, "message": "in handle_async_request"}, {"path": "../../anaconda3/lib/python3.9/contextlib.py", "lineno": 137, "message": "in __exit__"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py", "lineno": 118, "message": "ReadError"}], "longrepr": "@contextlib.contextmanager\n    def map_httpcore_exceptions() -> typing.Iterator[None]:\n        global HTTPCORE_EXC_MAP\n        if len(HTTPCORE_EXC_MAP) == 0:\n            HTTPCORE_EXC_MAP = _load_httpcore_exceptions()\n        try:\n>           yield\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:101: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:394: in handle_async_request\n    resp = await self._pool.handle_async_request(req)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/connection_pool.py:256: in handle_async_request\n    raise exc from None\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/connection_pool.py:236: in handle_async_request\n    response = await connection.handle_async_request(\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/connection.py:103: in handle_async_request\n    return await self._connection.handle_async_request(request)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:136: in handle_async_request\n    raise exc\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:106: in handle_async_request\n    ) = await self._receive_response_headers(**kwargs)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:177: in _receive_response_headers\n    event = await self._receive_event(timeout=timeout)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:217: in _receive_event\n    data = await self._network_stream.read(\n../../anaconda3/lib/python3.9/site-packages/httpcore/_backends/anyio.py:37: in read\n    return b\"\"\n../../anaconda3/lib/python3.9/contextlib.py:137: in __exit__\n    self.gen.throw(typ, value, traceback)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nmap = {<class 'TimeoutError'>: <class 'httpcore.ReadTimeout'>, <class 'anyio.BrokenResourceError'>: <class 'httpcore.ReadErr... 'anyio.ClosedResourceError'>: <class 'httpcore.ReadError'>, <class 'anyio.EndOfStream'>: <class 'httpcore.ReadError'>}\n\n    @contextlib.contextmanager\n    def map_exceptions(map: ExceptionMapping) -> typing.Iterator[None]:\n        try:\n            yield\n        except Exception as exc:  # noqa: PIE786\n            for from_exc, to_exc in map.items():\n                if isinstance(exc, from_exc):\n>                   raise to_exc(exc) from exc\nE                   httpcore.ReadError\n\n../../anaconda3/lib/python3.9/site-packages/httpcore/_exceptions.py:14: ReadError\n\nThe above exception was the direct cause of the following exception:\n\nrest = <conftest.RESTClient object at 0x7f47ab635fa0>\n\n    async def test_input_number_set_value(rest):\n        \"\"\"input_number.set_value changes state to numeric string.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"input_number.in_{tag}\"\n>       await rest.set_state(eid, \"0\")\n\ntests/entity/test_input_number_select_button.py:20: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:89: in set_state\n    resp = await self.client.post(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1859: in post\n    return await self.request(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1540: in request\n    return await self.send(request, auth=auth, follow_redirects=follow_redirects)\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1629: in send\n    response = await self._send_handling_auth(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1657: in _send_handling_auth\n    response = await self._send_handling_redirects(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1694: in _send_handling_redirects\n    response = await self._send_single_request(request)\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1730: in _send_single_request\n    response = await transport.handle_async_request(request)\n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:394: in handle_async_request\n    resp = await self._pool.handle_async_request(req)\n../../anaconda3/lib/python3.9/contextlib.py:137: in __exit__\n    self.gen.throw(typ, value, traceback)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\n    @contextlib.contextmanager\n    def map_httpcore_exceptions() -> typing.Iterator[None]:\n        global HTTPCORE_EXC_MAP\n        if len(HTTPCORE_EXC_MAP) == 0:\n            HTTPCORE_EXC_MAP = _load_httpcore_exceptions()\n        try:\n            yield\n        except Exception as exc:\n            mapped_exc = None\n    \n            for from_exc, to_exc in HTTPCORE_EXC_MAP.items():\n                if not isinstance(exc, from_exc):\n                    continue\n                # We want to map to the most specific exception we can find.\n                # Eg if `exc` is an `httpcore.ReadTimeout`, we want to map to\n                # `httpx.ReadTimeout`, not just `httpx.TimeoutException`.\n                if mapped_exc is None or issubclass(to_exc, mapped_exc):\n                    mapped_exc = to_exc\n    \n            if mapped_exc is None:  # pragma: no cover\n                raise\n    \n            message = str(exc)\n>           raise mapped_exc(message) from exc\nE           httpx.ReadError\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:118: ReadError"}, "teardown": {"duration": 0.0005530598573386669, "outcome": "passed"}}, {"nodeid": "tests/entity/test_input_number_select_button.py::test_input_number_set_zero", "lineno": 32, "outcome": "failed", "keywords": ["test_input_number_set_zero", "test_input_number_select_button.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.0052817510440945625, "outcome": "passed"}, "call": {"duration": 0.0018341541290283203, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py", "lineno": 118, "message": "httpx.ReadError"}, "traceback": [{"path": "tests/entity/test_input_number_select_button.py", "lineno": 37, "message": ""}, {"path": "tests/conftest.py", "lineno": 89, "message": "in set_state"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1859, "message": "in post"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1540, "message": "in request"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1629, "message": "in send"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1657, "message": "in _send_handling_auth"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1694, "message": "in _send_handling_redirects"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1730, "message": "in _send_single_request"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py", "lineno": 394, "message": "in handle_async_request"}, {"path": "../../anaconda3/lib/python3.9/contextlib.py", "lineno": 137, "message": "in __exit__"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py", "lineno": 118, "message": "ReadError"}], "longrepr": "@contextlib.contextmanager\n    def map_httpcore_exceptions() -> typing.Iterator[None]:\n        global HTTPCORE_EXC_MAP\n        if len(HTTPCORE_EXC_MAP) == 0:\n            HTTPCORE_EXC_MAP = _load_httpcore_exceptions()\n        try:\n>           yield\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:101: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:394: in handle_async_request\n    resp = await self._pool.handle_async_request(req)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/connection_pool.py:256: in handle_async_request\n    raise exc from None\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/connection_pool.py:236: in handle_async_request\n    response = await connection.handle_async_request(\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/connection.py:103: in handle_async_request\n    return await self._connection.handle_async_request(request)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:136: in handle_async_request\n    raise exc\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:106: in handle_async_request\n    ) = await self._receive_response_headers(**kwargs)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:177: in _receive_response_headers\n    event = await self._receive_event(timeout=timeout)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:217: in _receive_event\n    data = await self._network_stream.read(\n../../anaconda3/lib/python3.9/site-packages/httpcore/_backends/anyio.py:37: in read\n    return b\"\"\n../../anaconda3/lib/python3.9/contextlib.py:137: in __exit__\n    self.gen.throw(typ, value, traceback)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nmap = {<class 'TimeoutError'>: <class 'httpcore.ReadTimeout'>, <class 'anyio.BrokenResourceError'>: <class 'httpcore.ReadErr... 'anyio.ClosedResourceError'>: <class 'httpcore.ReadError'>, <class 'anyio.EndOfStream'>: <class 'httpcore.ReadError'>}\n\n    @contextlib.contextmanager\n    def map_exceptions(map: ExceptionMapping) -> typing.Iterator[None]:\n        try:\n            yield\n        except Exception as exc:  # noqa: PIE786\n            for from_exc, to_exc in map.items():\n                if isinstance(exc, from_exc):\n>                   raise to_exc(exc) from exc\nE                   httpcore.ReadError\n\n../../anaconda3/lib/python3.9/site-packages/httpcore/_exceptions.py:14: ReadError\n\nThe above exception was the direct cause of the following exception:\n\nrest = <conftest.RESTClient object at 0x7f47ab635af0>\n\n    async def test_input_number_set_zero(rest):\n        \"\"\"input_number.set_value with 0.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"input_number.inz_{tag}\"\n>       await rest.set_state(eid, \"100\")\n\ntests/entity/test_input_number_select_button.py:37: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:89: in set_state\n    resp = await self.client.post(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1859: in post\n    return await self.request(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1540: in request\n    return await self.send(request, auth=auth, follow_redirects=follow_redirects)\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1629: in send\n    response = await self._send_handling_auth(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1657: in _send_handling_auth\n    response = await self._send_handling_redirects(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1694: in _send_handling_redirects\n    response = await self._send_single_request(request)\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1730: in _send_single_request\n    response = await transport.handle_async_request(request)\n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:394: in handle_async_request\n    resp = await self._pool.handle_async_request(req)\n../../anaconda3/lib/python3.9/contextlib.py:137: in __exit__\n    self.gen.throw(typ, value, traceback)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\n    @contextlib.contextmanager\n    def map_httpcore_exceptions() -> typing.Iterator[None]:\n        global HTTPCORE_EXC_MAP\n        if len(HTTPCORE_EXC_MAP) == 0:\n            HTTPCORE_EXC_MAP = _load_httpcore_exceptions()\n        try:\n            yield\n        except Exception as exc:\n            mapped_exc = None\n    \n            for from_exc, to_exc in HTTPCORE_EXC_MAP.items():\n                if not isinstance(exc, from_exc):\n                    continue\n                # We want to map to the most specific exception we can find.\n                # Eg if `exc` is an `httpcore.ReadTimeout`, we want to map to\n                # `httpx.ReadTimeout`, not just `httpx.TimeoutException`.\n                if mapped_exc is None or issubclass(to_exc, mapped_exc):\n                    mapped_exc = to_exc\n    \n            if mapped_exc is None:  # pragma: no cover\n                raise\n    \n            message = str(exc)\n>           raise mapped_exc(message) from exc\nE           httpx.ReadError\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:118: ReadError"}, "teardown": {"duration": 0.0005620056763291359, "outcome": "passed"}}, {"nodeid": "tests/entity/test_input_number_select_button.py::test_input_number_set_negative", "lineno": 48, "outcome": "failed", "keywords": ["test_input_number_set_negative", "test_input_number_select_button.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005185261368751526, "outcome": "passed"}, "call": {"duration": 0.0020607197657227516, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py", "lineno": 118, "message": "httpx.ReadError"}, "traceback": [{"path": "tests/entity/test_input_number_select_button.py", "lineno": 53, "message": ""}, {"path": "tests/conftest.py", "lineno": 89, "message": "in set_state"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1859, "message": "in post"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1540, "message": "in request"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1629, "message": "in send"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1657, "message": "in _send_handling_auth"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1694, "message": "in _send_handling_redirects"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1730, "message": "in _send_single_request"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py", "lineno": 394, "message": "in handle_async_request"}, {"path": "../../anaconda3/lib/python3.9/contextlib.py", "lineno": 137, "message": "in __exit__"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py", "lineno": 118, "message": "ReadError"}], "longrepr": "@contextlib.contextmanager\n    def map_httpcore_exceptions() -> typing.Iterator[None]:\n        global HTTPCORE_EXC_MAP\n        if len(HTTPCORE_EXC_MAP) == 0:\n            HTTPCORE_EXC_MAP = _load_httpcore_exceptions()\n        try:\n>           yield\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:101: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:394: in handle_async_request\n    resp = await self._pool.handle_async_request(req)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/connection_pool.py:256: in handle_async_request\n    raise exc from None\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/connection_pool.py:236: in handle_async_request\n    response = await connection.handle_async_request(\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/connection.py:103: in handle_async_request\n    return await self._connection.handle_async_request(request)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:136: in handle_async_request\n    raise exc\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:106: in handle_async_request\n    ) = await self._receive_response_headers(**kwargs)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:177: in _receive_response_headers\n    event = await self._receive_event(timeout=timeout)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:217: in _receive_event\n    data = await self._network_stream.read(\n../../anaconda3/lib/python3.9/site-packages/httpcore/_backends/anyio.py:37: in read\n    return b\"\"\n../../anaconda3/lib/python3.9/contextlib.py:137: in __exit__\n    self.gen.throw(typ, value, traceback)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nmap = {<class 'TimeoutError'>: <class 'httpcore.ReadTimeout'>, <class 'anyio.BrokenResourceError'>: <class 'httpcore.ReadErr... 'anyio.ClosedResourceError'>: <class 'httpcore.ReadError'>, <class 'anyio.EndOfStream'>: <class 'httpcore.ReadError'>}\n\n    @contextlib.contextmanager\n    def map_exceptions(map: ExceptionMapping) -> typing.Iterator[None]:\n        try:\n            yield\n        except Exception as exc:  # noqa: PIE786\n            for from_exc, to_exc in map.items():\n                if isinstance(exc, from_exc):\n>                   raise to_exc(exc) from exc\nE                   httpcore.ReadError\n\n../../anaconda3/lib/python3.9/site-packages/httpcore/_exceptions.py:14: ReadError\n\nThe above exception was the direct cause of the following exception:\n\nrest = <conftest.RESTClient object at 0x7f47ab6357c0>\n\n    async def test_input_number_set_negative(rest):\n        \"\"\"input_number.set_value with negative number.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"input_number.inn_{tag}\"\n>       await rest.set_state(eid, \"0\")\n\ntests/entity/test_input_number_select_button.py:53: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:89: in set_state\n    resp = await self.client.post(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1859: in post\n    return await self.request(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1540: in request\n    return await self.send(request, auth=auth, follow_redirects=follow_redirects)\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1629: in send\n    response = await self._send_handling_auth(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1657: in _send_handling_auth\n    response = await self._send_handling_redirects(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1694: in _send_handling_redirects\n    response = await self._send_single_request(request)\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1730: in _send_single_request\n    response = await transport.handle_async_request(request)\n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:394: in handle_async_request\n    resp = await self._pool.handle_async_request(req)\n../../anaconda3/lib/python3.9/contextlib.py:137: in __exit__\n    self.gen.throw(typ, value, traceback)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\n    @contextlib.contextmanager\n    def map_httpcore_exceptions() -> typing.Iterator[None]:\n        global HTTPCORE_EXC_MAP\n        if len(HTTPCORE_EXC_MAP) == 0:\n            HTTPCORE_EXC_MAP = _load_httpcore_exceptions()\n        try:\n            yield\n        except Exception as exc:\n            mapped_exc = None\n    \n            for from_exc, to_exc in HTTPCORE_EXC_MAP.items():\n                if not isinstance(exc, from_exc):\n                    continue\n                # We want to map to the most specific exception we can find.\n                # Eg if `exc` is an `httpcore.ReadTimeout`, we want to map to\n                # `httpx.ReadTimeout`, not just `httpx.TimeoutException`.\n                if mapped_exc is None or issubclass(to_exc, mapped_exc):\n                    mapped_exc = to_exc\n    \n            if mapped_exc is None:  # pragma: no cover\n                raise\n    \n            message = str(exc)\n>           raise mapped_exc(message) from exc\nE           httpx.ReadError\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:118: ReadError"}, "teardown": {"duration": 0.0005620098672807217, "outcome": "passed"}}, {"nodeid": "tests/entity/test_input_number_select_button.py::test_input_text_set_value", "lineno": 66, "outcome": "failed", "keywords": ["test_input_text_set_value", "test_input_number_select_button.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005502897780388594, "outcome": "passed"}, "call": {"duration": 0.0017610439099371433, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py", "lineno": 118, "message": "httpx.ReadError"}, "traceback": [{"path": "tests/entity/test_input_number_select_button.py", "lineno": 71, "message": ""}, {"path": "tests/conftest.py", "lineno": 89, "message": "in set_state"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1859, "message": "in post"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1540, "message": "in request"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1629, "message": "in send"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1657, "message": "in _send_handling_auth"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1694, "message": "in _send_handling_redirects"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1730, "message": "in _send_single_request"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py", "lineno": 394, "message": "in handle_async_request"}, {"path": "../../anaconda3/lib/python3.9/contextlib.py", "lineno": 137, "message": "in __exit__"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py", "lineno": 118, "message": "ReadError"}], "longrepr": "@contextlib.contextmanager\n    def map_httpcore_exceptions() -> typing.Iterator[None]:\n        global HTTPCORE_EXC_MAP\n        if len(HTTPCORE_EXC_MAP) == 0:\n            HTTPCORE_EXC_MAP = _load_httpcore_exceptions()\n        try:\n>           yield\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:101: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:394: in handle_async_request\n    resp = await self._pool.handle_async_request(req)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/connection_pool.py:256: in handle_async_request\n    raise exc from None\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/connection_pool.py:236: in handle_async_request\n    response = await connection.handle_async_request(\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/connection.py:103: in handle_async_request\n    return await self._connection.handle_async_request(request)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:136: in handle_async_request\n    raise exc\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:106: in handle_async_request\n    ) = await self._receive_response_headers(**kwargs)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:177: in _receive_response_headers\n    event = await self._receive_event(timeout=timeout)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:217: in _receive_event\n    data = await self._network_stream.read(\n../../anaconda3/lib/python3.9/site-packages/httpcore/_backends/anyio.py:37: in read\n    return b\"\"\n../../anaconda3/lib/python3.9/contextlib.py:137: in __exit__\n    self.gen.throw(typ, value, traceback)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nmap = {<class 'TimeoutError'>: <class 'httpcore.ReadTimeout'>, <class 'anyio.BrokenResourceError'>: <class 'httpcore.ReadErr... 'anyio.ClosedResourceError'>: <class 'httpcore.ReadError'>, <class 'anyio.EndOfStream'>: <class 'httpcore.ReadError'>}\n\n    @contextlib.contextmanager\n    def map_exceptions(map: ExceptionMapping) -> typing.Iterator[None]:\n        try:\n            yield\n        except Exception as exc:  # noqa: PIE786\n            for from_exc, to_exc in map.items():\n                if isinstance(exc, from_exc):\n>                   raise to_exc(exc) from exc\nE                   httpcore.ReadError\n\n../../anaconda3/lib/python3.9/site-packages/httpcore/_exceptions.py:14: ReadError\n\nThe above exception was the direct cause of the following exception:\n\nrest = <conftest.RESTClient object at 0x7f47b03c73a0>\n\n    async def test_input_text_set_value(rest):\n        \"\"\"input_text.set_value changes state.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"input_text.it_{tag}\"\n>       await rest.set_state(eid, \"old\")\n\ntests/entity/test_input_number_select_button.py:71: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:89: in set_state\n    resp = await self.client.post(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1859: in post\n    return await self.request(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1540: in request\n    return await self.send(request, auth=auth, follow_redirects=follow_redirects)\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1629: in send\n    response = await self._send_handling_auth(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1657: in _send_handling_auth\n    response = await self._send_handling_redirects(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1694: in _send_handling_redirects\n    response = await self._send_single_request(request)\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1730: in _send_single_request\n    response = await transport.handle_async_request(request)\n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:394: in handle_async_request\n    resp = await self._pool.handle_async_request(req)\n../../anaconda3/lib/python3.9/contextlib.py:137: in __exit__\n    self.gen.throw(typ, value, traceback)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\n    @contextlib.contextmanager\n    def map_httpcore_exceptions() -> typing.Iterator[None]:\n        global HTTPCORE_EXC_MAP\n        if len(HTTPCORE_EXC_MAP) == 0:\n            HTTPCORE_EXC_MAP = _load_httpcore_exceptions()\n        try:\n            yield\n        except Exception as exc:\n            mapped_exc = None\n    \n            for from_exc, to_exc in HTTPCORE_EXC_MAP.items():\n                if not isinstance(exc, from_exc):\n                    continue\n                # We want to map to the most specific exception we can find.\n                # Eg if `exc` is an `httpcore.ReadTimeout`, we want to map to\n                # `httpx.ReadTimeout`, not just `httpx.TimeoutException`.\n                if mapped_exc is None or issubclass(to_exc, mapped_exc):\n                    mapped_exc = to_exc\n    \n            if mapped_exc is None:  # pragma: no cover\n                raise\n    \n            message = str(exc)\n>           raise mapped_exc(message) from exc\nE           httpx.ReadError\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:118: ReadError"}, "teardown": {"duration": 0.000570791307836771, "outcome": "passed"}}, {"nodeid": "tests/entity/test_input_number_select_button.py::test_input_text_set_empty", "lineno": 82, "outcome": "failed", "keywords": ["test_input_text_set_empty", "test_input_number_select_button.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005590904038399458, "outcome": "passed"}, "call": {"duration": 0.0021135411225259304, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py", "lineno": 118, "message": "httpx.ReadError"}, "traceback": [{"path": "tests/entity/test_input_number_select_button.py", "lineno": 87, "message": ""}, {"path": "tests/conftest.py", "lineno": 89, "message": "in set_state"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1859, "message": "in post"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1540, "message": "in request"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1629, "message": "in send"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1657, "message": "in _send_handling_auth"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1694, "message": "in _send_handling_redirects"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1730, "message": "in _send_single_request"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py", "lineno": 394, "message": "in handle_async_request"}, {"path": "../../anaconda3/lib/python3.9/contextlib.py", "lineno": 137, "message": "in __exit__"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py", "lineno": 118, "message": "ReadError"}], "longrepr": "@contextlib.contextmanager\n    def map_httpcore_exceptions() -> typing.Iterator[None]:\n        global HTTPCORE_EXC_MAP\n        if len(HTTPCORE_EXC_MAP) == 0:\n            HTTPCORE_EXC_MAP = _load_httpcore_exceptions()\n        try:\n>           yield\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:101: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:394: in handle_async_request\n    resp = await self._pool.handle_async_request(req)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/connection_pool.py:256: in handle_async_request\n    raise exc from None\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/connection_pool.py:236: in handle_async_request\n    response = await connection.handle_async_request(\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/connection.py:103: in handle_async_request\n    return await self._connection.handle_async_request(request)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:136: in handle_async_request\n    raise exc\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:106: in handle_async_request\n    ) = await self._receive_response_headers(**kwargs)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:177: in _receive_response_headers\n    event = await self._receive_event(timeout=timeout)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:217: in _receive_event\n    data = await self._network_stream.read(\n../../anaconda3/lib/python3.9/site-packages/httpcore/_backends/anyio.py:37: in read\n    return b\"\"\n../../anaconda3/lib/python3.9/contextlib.py:137: in __exit__\n    self.gen.throw(typ, value, traceback)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nmap = {<class 'TimeoutError'>: <class 'httpcore.ReadTimeout'>, <class 'anyio.BrokenResourceError'>: <class 'httpcore.ReadErr... 'anyio.ClosedResourceError'>: <class 'httpcore.ReadError'>, <class 'anyio.EndOfStream'>: <class 'httpcore.ReadError'>}\n\n    @contextlib.contextmanager\n    def map_exceptions(map: ExceptionMapping) -> typing.Iterator[None]:\n        try:\n            yield\n        except Exception as exc:  # noqa: PIE786\n            for from_exc, to_exc in map.items():\n                if isinstance(exc, from_exc):\n>                   raise to_exc(exc) from exc\nE                   httpcore.ReadError\n\n../../anaconda3/lib/python3.9/site-packages/httpcore/_exceptions.py:14: ReadError\n\nThe above exception was the direct cause of the following exception:\n\nrest = <conftest.RESTClient object at 0x7f47b04723a0>\n\n    async def test_input_text_set_empty(rest):\n        \"\"\"input_text.set_value with empty string.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"input_text.ite_{tag}\"\n>       await rest.set_state(eid, \"content\")\n\ntests/entity/test_input_number_select_button.py:87: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:89: in set_state\n    resp = await self.client.post(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1859: in post\n    return await self.request(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1540: in request\n    return await self.send(request, auth=auth, follow_redirects=follow_redirects)\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1629: in send\n    response = await self._send_handling_auth(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1657: in _send_handling_auth\n    response = await self._send_handling_redirects(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1694: in _send_handling_redirects\n    response = await self._send_single_request(request)\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1730: in _send_single_request\n    response = await transport.handle_async_request(request)\n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:394: in handle_async_request\n    resp = await self._pool.handle_async_request(req)\n../../anaconda3/lib/python3.9/contextlib.py:137: in __exit__\n    self.gen.throw(typ, value, traceback)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\n    @contextlib.contextmanager\n    def map_httpcore_exceptions() -> typing.Iterator[None]:\n        global HTTPCORE_EXC_MAP\n        if len(HTTPCORE_EXC_MAP) == 0:\n            HTTPCORE_EXC_MAP = _load_httpcore_exceptions()\n        try:\n            yield\n        except Exception as exc:\n            mapped_exc = None\n    \n            for from_exc, to_exc in HTTPCORE_EXC_MAP.items():\n                if not isinstance(exc, from_exc):\n                    continue\n                # We want to map to the most specific exception we can find.\n                # Eg if `exc` is an `httpcore.ReadTimeout`, we want to map to\n                # `httpx.ReadTimeout`, not just `httpx.TimeoutException`.\n                if mapped_exc is None or issubclass(to_exc, mapped_exc):\n                    mapped_exc = to_exc\n    \n            if mapped_exc is None:  # pragma: no cover\n                raise\n    \n            message = str(exc)\n>           raise mapped_exc(message) from exc\nE           httpx.ReadError\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:118: ReadError"}, "teardown": {"duration": 0.0005555539391934872, "outcome": "passed"}}, {"nodeid": "tests/entity/test_input_number_select_button.py::test_input_select_select_option", "lineno": 100, "outcome": "failed", "keywords": ["test_input_select_select_option", "test_input_number_select_button.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.00524853216484189, "outcome": "passed"}, "call": {"duration": 0.0019689640030264854, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py", "lineno": 118, "message": "httpx.ReadError"}, "traceback": [{"path": "tests/entity/test_input_number_select_button.py", "lineno": 105, "message": ""}, {"path": "tests/conftest.py", "lineno": 89, "message": "in set_state"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1859, "message": "in post"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1540, "message": "in request"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1629, "message": "in send"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1657, "message": "in _send_handling_auth"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1694, "message": "in _send_handling_redirects"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1730, "message": "in _send_single_request"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py", "lineno": 394, "message": "in handle_async_request"}, {"path": "../../anaconda3/lib/python3.9/contextlib.py", "lineno": 137, "message": "in __exit__"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py", "lineno": 118, "message": "ReadError"}], "longrepr": "@contextlib.contextmanager\n    def map_httpcore_exceptions() -> typing.Iterator[None]:\n        global HTTPCORE_EXC_MAP\n        if len(HTTPCORE_EXC_MAP) == 0:\n            HTTPCORE_EXC_MAP = _load_httpcore_exceptions()\n        try:\n>           yield\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:101: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:394: in handle_async_request\n    resp = await self._pool.handle_async_request(req)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/connection_pool.py:256: in handle_async_request\n    raise exc from None\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/connection_pool.py:236: in handle_async_request\n    response = await connection.handle_async_request(\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/connection.py:103: in handle_async_request\n    return await self._connection.handle_async_request(request)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:136: in handle_async_request\n    raise exc\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:106: in handle_async_request\n    ) = await self._receive_response_headers(**kwargs)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:177: in _receive_response_headers\n    event = await self._receive_event(timeout=timeout)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:217: in _receive_event\n    data = await self._network_stream.read(\n../../anaconda3/lib/python3.9/site-packages/httpcore/_backends/anyio.py:37: in read\n    return b\"\"\n../../anaconda3/lib/python3.9/contextlib.py:137: in __exit__\n    self.gen.throw(typ, value, traceback)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nmap = {<class 'TimeoutError'>: <class 'httpcore.ReadTimeout'>, <class 'anyio.BrokenResourceError'>: <class 'httpcore.ReadErr... 'anyio.ClosedResourceError'>: <class 'httpcore.ReadError'>, <class 'anyio.EndOfStream'>: <class 'httpcore.ReadError'>}\n\n    @contextlib.contextmanager\n    def map_exceptions(map: ExceptionMapping) -> typing.Iterator[None]:\n        try:\n            yield\n        except Exception as exc:  # noqa: PIE786\n            for from_exc, to_exc in map.items():\n                if isinstance(exc, from_exc):\n>                   raise to_exc(exc) from exc\nE                   httpcore.ReadError\n\n../../anaconda3/lib/python3.9/site-packages/httpcore/_exceptions.py:14: ReadError\n\nThe above exception was the direct cause of the following exception:\n\nrest = <conftest.RESTClient object at 0x7f47b0472970>\n\n    async def test_input_select_select_option(rest):\n        \"\"\"input_select.select_option changes state.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"input_select.is_{tag}\"\n>       await rest.set_state(eid, \"option_a\")\n\ntests/entity/test_input_number_select_button.py:105: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:89: in set_state\n    resp = await self.client.post(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1859: in post\n    return await self.request(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1540: in request\n    return await self.send(request, auth=auth, follow_redirects=follow_redirects)\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1629: in send\n    response = await self._send_handling_auth(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1657: in _send_handling_auth\n    response = await self._send_handling_redirects(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1694: in _send_handling_redirects\n    response = await self._send_single_request(request)\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1730: in _send_single_request\n    response = await transport.handle_async_request(request)\n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:394: in handle_async_request\n    resp = await self._pool.handle_async_request(req)\n../../anaconda3/lib/python3.9/contextlib.py:137: in __exit__\n    self.gen.throw(typ, value, traceback)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\n    @contextlib.contextmanager\n    def map_httpcore_exceptions() -> typing.Iterator[None]:\n        global HTTPCORE_EXC_MAP\n        if len(HTTPCORE_EXC_MAP) == 0:\n            HTTPCORE_EXC_MAP = _load_httpcore_exceptions()\n        try:\n            yield\n        except Exception as exc:\n            mapped_exc = None\n    \n            for from_exc, to_exc in HTTPCORE_EXC_MAP.items():\n                if not isinstance(exc, from_exc):\n                    continue\n                # We want to map to the most specific exception we can find.\n                # Eg if `exc` is an `httpcore.ReadTimeout`, we want to map to\n                # `httpx.ReadTimeout`, not just `httpx.TimeoutException`.\n                if mapped_exc is None or issubclass(to_exc, mapped_exc):\n                    mapped_exc = to_exc\n    \n            if mapped_exc is None:  # pragma: no cover\n                raise\n    \n            message = str(exc)\n>           raise mapped_exc(message) from exc\nE           httpx.ReadError\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:118: ReadError"}, "teardown": {"duration": 0.0005886568687856197, "outcome": "passed"}}, {"nodeid": "tests/entity/test_input_number_select_button.py::test_input_select_empty_option", "lineno": 116, "outcome": "failed", "keywords": ["test_input_select_empty_option", "test_input_number_select_button.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005781074985861778, "outcome": "passed"}, "call": {"duration": 0.0021226899698376656, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py", "lineno": 118, "message": "httpx.ReadError"}, "traceback": [{"path": "tests/entity/test_input_number_select_button.py", "lineno": 121, "message": ""}, {"path": "tests/conftest.py", "lineno": 89, "message": "in set_state"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1859, "message": "in post"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1540, "message": "in request"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1629, "message": "in send"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1657, "message": "in _send_handling_auth"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1694, "message": "in _send_handling_redirects"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1730, "message": "in _send_single_request"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py", "lineno": 394, "message": "in handle_async_request"}, {"path": "../../anaconda3/lib/python3.9/contextlib.py", "lineno": 137, "message": "in __exit__"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py", "lineno": 118, "message": "ReadError"}], "longrepr": "@contextlib.contextmanager\n    def map_httpcore_exceptions() -> typing.Iterator[None]:\n        global HTTPCORE_EXC_MAP\n        if len(HTTPCORE_EXC_MAP) == 0:\n            HTTPCORE_EXC_MAP = _load_httpcore_exceptions()\n        try:\n>           yield\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:101: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:394: in handle_async_request\n    resp = await self._pool.handle_async_request(req)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/connection_pool.py:256: in handle_async_request\n    raise exc from None\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/connection_pool.py:236: in handle_async_request\n    response = await connection.handle_async_request(\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/connection.py:103: in handle_async_request\n    return await self._connection.handle_async_request(request)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:136: in handle_async_request\n    raise exc\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:106: in handle_async_request\n    ) = await self._receive_response_headers(**kwargs)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:177: in _receive_response_headers\n    event = await self._receive_event(timeout=timeout)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:217: in _receive_event\n    data = await self._network_stream.read(\n../../anaconda3/lib/python3.9/site-packages/httpcore/_backends/anyio.py:37: in read\n    return b\"\"\n../../anaconda3/lib/python3.9/contextlib.py:137: in __exit__\n    self.gen.throw(typ, value, traceback)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nmap = {<class 'TimeoutError'>: <class 'httpcore.ReadTimeout'>, <class 'anyio.BrokenResourceError'>: <class 'httpcore.ReadErr... 'anyio.ClosedResourceError'>: <class 'httpcore.ReadError'>, <class 'anyio.EndOfStream'>: <class 'httpcore.ReadError'>}\n\n    @contextlib.contextmanager\n    def map_exceptions(map: ExceptionMapping) -> typing.Iterator[None]:\n        try:\n            yield\n        except Exception as exc:  # noqa: PIE786\n            for from_exc, to_exc in map.items():\n                if isinstance(exc, from_exc):\n>                   raise to_exc(exc) from exc\nE                   httpcore.ReadError\n\n../../anaconda3/lib/python3.9/site-packages/httpcore/_exceptions.py:14: ReadError\n\nThe above exception was the direct cause of the following exception:\n\nrest = <conftest.RESTClient object at 0x7f47ab79b190>\n\n    async def test_input_select_empty_option(rest):\n        \"\"\"input_select.select_option with empty string.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"input_select.ise_{tag}\"\n>       await rest.set_state(eid, \"something\")\n\ntests/entity/test_input_number_select_button.py:121: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:89: in set_state\n    resp = await self.client.post(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1859: in post\n    return await self.request(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1540: in request\n    return await self.send(request, auth=auth, follow_redirects=follow_redirects)\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1629: in send\n    response = await self._send_handling_auth(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1657: in _send_handling_auth\n    response = await self._send_handling_redirects(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1694: in _send_handling_redirects\n    response = await self._send_single_request(request)\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1730: in _send_single_request\n    response = await transport.handle_async_request(request)\n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:394: in handle_async_request\n    resp = await self._pool.handle_async_request(req)\n../../anaconda3/lib/python3.9/contextlib.py:137: in __exit__\n    self.gen.throw(typ, value, traceback)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\n    @contextlib.contextmanager\n    def map_httpcore_exceptions() -> typing.Iterator[None]:\n        global HTTPCORE_EXC_MAP\n        if len(HTTPCORE_EXC_MAP) == 0:\n            HTTPCORE_EXC_MAP = _load_httpcore_exceptions()\n        try:\n            yield\n        except Exception as exc:\n            mapped_exc = None\n    \n            for from_exc, to_exc in HTTPCORE_EXC_MAP.items():\n                if not isinstance(exc, from_exc):\n                    continue\n                # We want to map to the most specific exception we can find.\n                # Eg if `exc` is an `httpcore.ReadTimeout`, we want to map to\n                # `httpx.ReadTimeout`, not just `httpx.TimeoutException`.\n                if mapped_exc is None or issubclass(to_exc, mapped_exc):\n                    mapped_exc = to_exc\n    \n            if mapped_exc is None:  # pragma: no cover\n                raise\n    \n            message = str(exc)\n>           raise mapped_exc(message) from exc\nE           httpx.ReadError\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:118: ReadError"}, "teardown": {"duration": 0.0006452221423387527, "outcome": "passed"}}, {"nodeid": "tests/entity/test_input_number_select_button.py::test_input_boolean_turn_on", "lineno": 134, "outcome": "failed", "keywords": ["test_input_boolean_turn_on", "test_input_number_select_button.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005615802016109228, "outcome": "passed"}, "call": {"duration": 0.0021968181245028973, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py", "lineno": 118, "message": "httpx.ReadError"}, "traceback": [{"path": "tests/entity/test_input_number_select_button.py", "lineno": 139, "message": ""}, {"path": "tests/conftest.py", "lineno": 89, "message": "in set_state"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1859, "message": "in post"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1540, "message": "in request"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1629, "message": "in send"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1657, "message": "in _send_handling_auth"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1694, "message": "in _send_handling_redirects"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1730, "message": "in _send_single_request"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py", "lineno": 394, "message": "in handle_async_request"}, {"path": "../../anaconda3/lib/python3.9/contextlib.py", "lineno": 137, "message": "in __exit__"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py", "lineno": 118, "message": "ReadError"}], "longrepr": "@contextlib.contextmanager\n    def map_httpcore_exceptions() -> typing.Iterator[None]:\n        global HTTPCORE_EXC_MAP\n        if len(HTTPCORE_EXC_MAP) == 0:\n            HTTPCORE_EXC_MAP = _load_httpcore_exceptions()\n        try:\n>           yield\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:101: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:394: in handle_async_request\n    resp = await self._pool.handle_async_request(req)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/connection_pool.py:256: in handle_async_request\n    raise exc from None\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/connection_pool.py:236: in handle_async_request\n    response = await connection.handle_async_request(\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/connection.py:103: in handle_async_request\n    return await self._connection.handle_async_request(request)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:136: in handle_async_request\n    raise exc\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:106: in handle_async_request\n    ) = await self._receive_response_headers(**kwargs)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:177: in _receive_response_headers\n    event = await self._receive_event(timeout=timeout)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:217: in _receive_event\n    data = await self._network_stream.read(\n../../anaconda3/lib/python3.9/site-packages/httpcore/_backends/anyio.py:37: in read\n    return b\"\"\n../../anaconda3/lib/python3.9/contextlib.py:137: in __exit__\n    self.gen.throw(typ, value, traceback)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nmap = {<class 'TimeoutError'>: <class 'httpcore.ReadTimeout'>, <class 'anyio.BrokenResourceError'>: <class 'httpcore.ReadErr... 'anyio.ClosedResourceError'>: <class 'httpcore.ReadError'>, <class 'anyio.EndOfStream'>: <class 'httpcore.ReadError'>}\n\n    @contextlib.contextmanager\n    def map_exceptions(map: ExceptionMapping) -> typing.Iterator[None]:\n        try:\n            yield\n        except Exception as exc:  # noqa: PIE786\n            for from_exc, to_exc in map.items():\n                if isinstance(exc, from_exc):\n>                   raise to_exc(exc) from exc\nE                   httpcore.ReadError\n\n../../anaconda3/lib/python3.9/site-packages/httpcore/_exceptions.py:14: ReadError\n\nThe above exception was the direct cause of the following exception:\n\nrest = <conftest.RESTClient object at 0x7f47ab5f0e50>\n\n    async def test_input_boolean_turn_on(rest):\n        \"\"\"input_boolean.turn_on sets state to on.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"input_boolean.ib_{tag}\"\n>       await rest.set_state(eid, \"off\")\n\ntests/entity/test_input_number_select_button.py:139: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:89: in set_state\n    resp = await self.client.post(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1859: in post\n    return await self.request(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1540: in request\n    return await self.send(request, auth=auth, follow_redirects=follow_redirects)\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1629: in send\n    response = await self._send_handling_auth(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1657: in _send_handling_auth\n    response = await self._send_handling_redirects(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1694: in _send_handling_redirects\n    response = await self._send_single_request(request)\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1730: in _send_single_request\n    response = await transport.handle_async_request(request)\n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:394: in handle_async_request\n    resp = await self._pool.handle_async_request(req)\n../../anaconda3/lib/python3.9/contextlib.py:137: in __exit__\n    self.gen.throw(typ, value, traceback)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\n    @contextlib.contextmanager\n    def map_httpcore_exceptions() -> typing.Iterator[None]:\n        global HTTPCORE_EXC_MAP\n        if len(HTTPCORE_EXC_MAP) == 0:\n            HTTPCORE_EXC_MAP = _load_httpcore_exceptions()\n        try:\n            yield\n        except Exception as exc:\n            mapped_exc = None\n    \n            for from_exc, to_exc in HTTPCORE_EXC_MAP.items():\n                if not isinstance(exc, from_exc):\n                    continue\n                # We want to map to the most specific exception we can find.\n                # Eg if `exc` is an `httpcore.ReadTimeout`, we want to map to\n                # `httpx.ReadTimeout`, not just `httpx.TimeoutException`.\n                if mapped_exc is None or issubclass(to_exc, mapped_exc):\n                    mapped_exc = to_exc\n    \n            if mapped_exc is None:  # pragma: no cover\n                raise\n    \n            message = str(exc)\n>           raise mapped_exc(message) from exc\nE           httpx.ReadError\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:118: ReadError"}, "teardown": {"duration": 0.0005578789860010147, "outcome": "passed"}}, {"nodeid": "tests/entity/test_input_number_select_button.py::test_input_boolean_turn_off", "lineno": 150, "outcome": "failed", "keywords": ["test_input_boolean_turn_off", "test_input_number_select_button.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005404903087764978, "outcome": "passed"}, "call": {"duration": 0.0020959931425750256, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py", "lineno": 118, "message": "httpx.ReadError"}, "traceback": [{"path": "tests/entity/test_input_number_select_button.py", "lineno": 155, "message": ""}, {"path": "tests/conftest.py", "lineno": 89, "message": "in set_state"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1859, "message": "in post"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1540, "message": "in request"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1629, "message": "in send"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1657, "message": "in _send_handling_auth"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1694, "message": "in _send_handling_redirects"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1730, "message": "in _send_single_request"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py", "lineno": 394, "message": "in handle_async_request"}, {"path": "../../anaconda3/lib/python3.9/contextlib.py", "lineno": 137, "message": "in __exit__"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py", "lineno": 118, "message": "ReadError"}], "longrepr": "@contextlib.contextmanager\n    def map_httpcore_exceptions() -> typing.Iterator[None]:\n        global HTTPCORE_EXC_MAP\n        if len(HTTPCORE_EXC_MAP) == 0:\n            HTTPCORE_EXC_MAP = _load_httpcore_exceptions()\n        try:\n>           yield\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:101: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:394: in handle_async_request\n    resp = await self._pool.handle_async_request(req)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/connection_pool.py:256: in handle_async_request\n    raise exc from None\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/connection_pool.py:236: in handle_async_request\n    response = await connection.handle_async_request(\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/connection.py:103: in handle_async_request\n    return await self._connection.handle_async_request(request)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:136: in handle_async_request\n    raise exc\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:106: in handle_async_request\n    ) = await self._receive_response_headers(**kwargs)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:177: in _receive_response_headers\n    event = await self._receive_event(timeout=timeout)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:217: in _receive_event\n    data = await self._network_stream.read(\n../../anaconda3/lib/python3.9/site-packages/httpcore/_backends/anyio.py:37: in read\n    return b\"\"\n../../anaconda3/lib/python3.9/contextlib.py:137: in __exit__\n    self.gen.throw(typ, value, traceback)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nmap = {<class 'TimeoutError'>: <class 'httpcore.ReadTimeout'>, <class 'anyio.BrokenResourceError'>: <class 'httpcore.ReadErr... 'anyio.ClosedResourceError'>: <class 'httpcore.ReadError'>, <class 'anyio.EndOfStream'>: <class 'httpcore.ReadError'>}\n\n    @contextlib.contextmanager\n    def map_exceptions(map: ExceptionMapping) -> typing.Iterator[None]:\n        try:\n            yield\n        except Exception as exc:  # noqa: PIE786\n            for from_exc, to_exc in map.items():\n                if isinstance(exc, from_exc):\n>                   raise to_exc(exc) from exc\nE                   httpcore.ReadError\n\n../../anaconda3/lib/python3.9/site-packages/httpcore/_exceptions.py:14: ReadError\n\nThe above exception was the direct cause of the following exception:\n\nrest = <conftest.RESTClient object at 0x7f47b0b64220>\n\n    async def test_input_boolean_turn_off(rest):\n        \"\"\"input_boolean.turn_off sets state to off.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"input_boolean.ibo_{tag}\"\n>       await rest.set_state(eid, \"on\")\n\ntests/entity/test_input_number_select_button.py:155: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:89: in set_state\n    resp = await self.client.post(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1859: in post\n    return await self.request(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1540: in request\n    return await self.send(request, auth=auth, follow_redirects=follow_redirects)\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1629: in send\n    response = await self._send_handling_auth(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1657: in _send_handling_auth\n    response = await self._send_handling_redirects(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1694: in _send_handling_redirects\n    response = await self._send_single_request(request)\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1730: in _send_single_request\n    response = await transport.handle_async_request(request)\n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:394: in handle_async_request\n    resp = await self._pool.handle_async_request(req)\n../../anaconda3/lib/python3.9/contextlib.py:137: in __exit__\n    self.gen.throw(typ, value, traceback)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\n    @contextlib.contextmanager\n    def map_httpcore_exceptions() -> typing.Iterator[None]:\n        global HTTPCORE_EXC_MAP\n        if len(HTTPCORE_EXC_MAP) == 0:\n            HTTPCORE_EXC_MAP = _load_httpcore_exceptions()\n        try:\n            yield\n        except Exception as exc:\n            mapped_exc = None\n    \n            for from_exc, to_exc in HTTPCORE_EXC_MAP.items():\n                if not isinstance(exc, from_exc):\n                    continue\n                # We want to map to the most specific exception we can find.\n                # Eg if `exc` is an `httpcore.ReadTimeout`, we want to map to\n                # `httpx.ReadTimeout`, not just `httpx.TimeoutException`.\n                if mapped_exc is None or issubclass(to_exc, mapped_exc):\n                    mapped_exc = to_exc\n    \n            if mapped_exc is None:  # pragma: no cover\n                raise\n    \n            message = str(exc)\n>           raise mapped_exc(message) from exc\nE           httpx.ReadError\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:118: ReadError"}, "teardown": {"duration": 0.0007319506257772446, "outcome": "passed"}}, {"nodeid": "tests/entity/test_input_number_select_button.py::test_input_boolean_toggle_on_to_off", "lineno": 166, "outcome": "failed", "keywords": ["test_input_boolean_toggle_on_to_off", "test_input_number_select_button.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.00596556207165122, "outcome": "passed"}, "call": {"duration": 0.0021919719874858856, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py", "lineno": 118, "message": "httpx.ReadError"}, "traceback": [{"path": "tests/entity/test_input_number_select_button.py", "lineno": 171, "message": ""}, {"path": "tests/conftest.py", "lineno": 89, "message": "in set_state"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1859, "message": "in post"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1540, "message": "in request"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1629, "message": "in send"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1657, "message": "in _send_handling_auth"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1694, "message": "in _send_handling_redirects"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1730, "message": "in _send_single_request"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py", "lineno": 394, "message": "in handle_async_request"}, {"path": "../../anaconda3/lib/python3.9/contextlib.py", "lineno": 137, "message": "in __exit__"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py", "lineno": 118, "message": "ReadError"}], "longrepr": "@contextlib.contextmanager\n    def map_httpcore_exceptions() -> typing.Iterator[None]:\n        global HTTPCORE_EXC_MAP\n        if len(HTTPCORE_EXC_MAP) == 0:\n            HTTPCORE_EXC_MAP = _load_httpcore_exceptions()\n        try:\n>           yield\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:101: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:394: in handle_async_request\n    resp = await self._pool.handle_async_request(req)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/connection_pool.py:256: in handle_async_request\n    raise exc from None\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/connection_pool.py:236: in handle_async_request\n    response = await connection.handle_async_request(\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/connection.py:103: in handle_async_request\n    return await self._connection.handle_async_request(request)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:136: in handle_async_request\n    raise exc\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:106: in handle_async_request\n    ) = await self._receive_response_headers(**kwargs)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:177: in _receive_response_headers\n    event = await self._receive_event(timeout=timeout)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:217: in _receive_event\n    data = await self._network_stream.read(\n../../anaconda3/lib/python3.9/site-packages/httpcore/_backends/anyio.py:37: in read\n    return b\"\"\n../../anaconda3/lib/python3.9/contextlib.py:137: in __exit__\n    self.gen.throw(typ, value, traceback)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nmap = {<class 'TimeoutError'>: <class 'httpcore.ReadTimeout'>, <class 'anyio.BrokenResourceError'>: <class 'httpcore.ReadErr... 'anyio.ClosedResourceError'>: <class 'httpcore.ReadError'>, <class 'anyio.EndOfStream'>: <class 'httpcore.ReadError'>}\n\n    @contextlib.contextmanager\n    def map_exceptions(map: ExceptionMapping) -> typing.Iterator[None]:\n        try:\n            yield\n        except Exception as exc:  # noqa: PIE786\n            for from_exc, to_exc in map.items():\n                if isinstance(exc, from_exc):\n>                   raise to_exc(exc) from exc\nE                   httpcore.ReadError\n\n../../anaconda3/lib/python3.9/site-packages/httpcore/_exceptions.py:14: ReadError\n\nThe above exception was the direct cause of the following exception:\n\nrest = <conftest.RESTClient object at 0x7f47ab5b6730>\n\n    async def test_input_boolean_toggle_on_to_off(rest):\n        \"\"\"input_boolean.toggle flips on\u2192off.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"input_boolean.ibt_{tag}\"\n>       await rest.set_state(eid, \"on\")\n\ntests/entity/test_input_number_select_button.py:171: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:89: in set_state\n    resp = await self.client.post(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1859: in post\n    return await self.request(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1540: in request\n    return await self.send(request, auth=auth, follow_redirects=follow_redirects)\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1629: in send\n    response = await self._send_handling_auth(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1657: in _send_handling_auth\n    response = await self._send_handling_redirects(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1694: in _send_handling_redirects\n    response = await self._send_single_request(request)\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1730: in _send_single_request\n    response = await transport.handle_async_request(request)\n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:394: in handle_async_request\n    resp = await self._pool.handle_async_request(req)\n../../anaconda3/lib/python3.9/contextlib.py:137: in __exit__\n    self.gen.throw(typ, value, traceback)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\n    @contextlib.contextmanager\n    def map_httpcore_exceptions() -> typing.Iterator[None]:\n        global HTTPCORE_EXC_MAP\n        if len(HTTPCORE_EXC_MAP) == 0:\n            HTTPCORE_EXC_MAP = _load_httpcore_exceptions()\n        try:\n            yield\n        except Exception as exc:\n            mapped_exc = None\n    \n            for from_exc, to_exc in HTTPCORE_EXC_MAP.items():\n                if not isinstance(exc, from_exc):\n                    continue\n                # We want to map to the most specific exception we can find.\n                # Eg if `exc` is an `httpcore.ReadTimeout`, we want to map to\n                # `httpx.ReadTimeout`, not just `httpx.TimeoutException`.\n                if mapped_exc is None or issubclass(to_exc, mapped_exc):\n                    mapped_exc = to_exc\n    \n            if mapped_exc is None:  # pragma: no cover\n                raise\n    \n            message = str(exc)\n>           raise mapped_exc(message) from exc\nE           httpx.ReadError\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:118: ReadError"}, "teardown": {"duration": 0.0006677866913378239, "outcome": "passed"}}, {"nodeid": "tests/entity/test_input_number_select_button.py::test_input_boolean_toggle_off_to_on", "lineno": 182, "outcome": "failed", "keywords": ["test_input_boolean_toggle_off_to_on", "test_input_number_select_button.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.00574288098141551, "outcome": "passed"}, "call": {"duration": 0.0020509730093181133, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py", "lineno": 118, "message": "httpx.ReadError"}, "traceback": [{"path": "tests/entity/test_input_number_select_button.py", "lineno": 187, "message": ""}, {"path": "tests/conftest.py", "lineno": 89, "message": "in set_state"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1859, "message": "in post"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1540, "message": "in request"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1629, "message": "in send"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1657, "message": "in _send_handling_auth"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1694, "message": "in _send_handling_redirects"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1730, "message": "in _send_single_request"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py", "lineno": 394, "message": "in handle_async_request"}, {"path": "../../anaconda3/lib/python3.9/contextlib.py", "lineno": 137, "message": "in __exit__"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py", "lineno": 118, "message": "ReadError"}], "longrepr": "@contextlib.contextmanager\n    def map_httpcore_exceptions() -> typing.Iterator[None]:\n        global HTTPCORE_EXC_MAP\n        if len(HTTPCORE_EXC_MAP) == 0:\n            HTTPCORE_EXC_MAP = _load_httpcore_exceptions()\n        try:\n>           yield\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:101: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:394: in handle_async_request\n    resp = await self._pool.handle_async_request(req)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/connection_pool.py:256: in handle_async_request\n    raise exc from None\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/connection_pool.py:236: in handle_async_request\n    response = await connection.handle_async_request(\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/connection.py:103: in handle_async_request\n    return await self._connection.handle_async_request(request)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:136: in handle_async_request\n    raise exc\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:106: in handle_async_request\n    ) = await self._receive_response_headers(**kwargs)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:177: in _receive_response_headers\n    event = await self._receive_event(timeout=timeout)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:217: in _receive_event\n    data = await self._network_stream.read(\n../../anaconda3/lib/python3.9/site-packages/httpcore/_backends/anyio.py:37: in read\n    return b\"\"\n../../anaconda3/lib/python3.9/contextlib.py:137: in __exit__\n    self.gen.throw(typ, value, traceback)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nmap = {<class 'TimeoutError'>: <class 'httpcore.ReadTimeout'>, <class 'anyio.BrokenResourceError'>: <class 'httpcore.ReadErr... 'anyio.ClosedResourceError'>: <class 'httpcore.ReadError'>, <class 'anyio.EndOfStream'>: <class 'httpcore.ReadError'>}\n\n    @contextlib.contextmanager\n    def map_exceptions(map: ExceptionMapping) -> typing.Iterator[None]:\n        try:\n            yield\n        except Exception as exc:  # noqa: PIE786\n            for from_exc, to_exc in map.items():\n                if isinstance(exc, from_exc):\n>                   raise to_exc(exc) from exc\nE                   httpcore.ReadError\n\n../../anaconda3/lib/python3.9/site-packages/httpcore/_exceptions.py:14: ReadError\n\nThe above exception was the direct cause of the following exception:\n\nrest = <conftest.RESTClient object at 0x7f47b0b64640>\n\n    async def test_input_boolean_toggle_off_to_on(rest):\n        \"\"\"input_boolean.toggle flips off\u2192on.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"input_boolean.ibt2_{tag}\"\n>       await rest.set_state(eid, \"off\")\n\ntests/entity/test_input_number_select_button.py:187: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:89: in set_state\n    resp = await self.client.post(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1859: in post\n    return await self.request(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1540: in request\n    return await self.send(request, auth=auth, follow_redirects=follow_redirects)\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1629: in send\n    response = await self._send_handling_auth(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1657: in _send_handling_auth\n    response = await self._send_handling_redirects(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1694: in _send_handling_redirects\n    response = await self._send_single_request(request)\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1730: in _send_single_request\n    response = await transport.handle_async_request(request)\n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:394: in handle_async_request\n    resp = await self._pool.handle_async_request(req)\n../../anaconda3/lib/python3.9/contextlib.py:137: in __exit__\n    self.gen.throw(typ, value, traceback)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\n    @contextlib.contextmanager\n    def map_httpcore_exceptions() -> typing.Iterator[None]:\n        global HTTPCORE_EXC_MAP\n        if len(HTTPCORE_EXC_MAP) == 0:\n            HTTPCORE_EXC_MAP = _load_httpcore_exceptions()\n        try:\n            yield\n        except Exception as exc:\n            mapped_exc = None\n    \n            for from_exc, to_exc in HTTPCORE_EXC_MAP.items():\n                if not isinstance(exc, from_exc):\n                    continue\n                # We want to map to the most specific exception we can find.\n                # Eg if `exc` is an `httpcore.ReadTimeout`, we want to map to\n                # `httpx.ReadTimeout`, not just `httpx.TimeoutException`.\n                if mapped_exc is None or issubclass(to_exc, mapped_exc):\n                    mapped_exc = to_exc\n    \n            if mapped_exc is None:  # pragma: no cover\n                raise\n    \n            message = str(exc)\n>           raise mapped_exc(message) from exc\nE           httpx.ReadError\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:118: ReadError"}, "teardown": {"duration": 0.0005674269050359726, "outcome": "passed"}}, {"nodeid": "tests/entity/test_input_number_select_button.py::test_number_set_value", "lineno": 200, "outcome": "failed", "keywords": ["test_number_set_value", "test_input_number_select_button.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005251868162304163, "outcome": "passed"}, "call": {"duration": 0.0022288612090051174, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py", "lineno": 118, "message": "httpx.ReadError"}, "traceback": [{"path": "tests/entity/test_input_number_select_button.py", "lineno": 205, "message": ""}, {"path": "tests/conftest.py", "lineno": 89, "message": "in set_state"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1859, "message": "in post"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1540, "message": "in request"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1629, "message": "in send"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1657, "message": "in _send_handling_auth"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1694, "message": "in _send_handling_redirects"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1730, "message": "in _send_single_request"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py", "lineno": 394, "message": "in handle_async_request"}, {"path": "../../anaconda3/lib/python3.9/contextlib.py", "lineno": 137, "message": "in __exit__"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py", "lineno": 118, "message": "ReadError"}], "longrepr": "@contextlib.contextmanager\n    def map_httpcore_exceptions() -> typing.Iterator[None]:\n        global HTTPCORE_EXC_MAP\n        if len(HTTPCORE_EXC_MAP) == 0:\n            HTTPCORE_EXC_MAP = _load_httpcore_exceptions()\n        try:\n>           yield\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:101: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:394: in handle_async_request\n    resp = await self._pool.handle_async_request(req)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/connection_pool.py:256: in handle_async_request\n    raise exc from None\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/connection_pool.py:236: in handle_async_request\n    response = await connection.handle_async_request(\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/connection.py:103: in handle_async_request\n    return await self._connection.handle_async_request(request)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:136: in handle_async_request\n    raise exc\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:106: in handle_async_request\n    ) = await self._receive_response_headers(**kwargs)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:177: in _receive_response_headers\n    event = await self._receive_event(timeout=timeout)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:217: in _receive_event\n    data = await self._network_stream.read(\n../../anaconda3/lib/python3.9/site-packages/httpcore/_backends/anyio.py:37: in read\n    return b\"\"\n../../anaconda3/lib/python3.9/contextlib.py:137: in __exit__\n    self.gen.throw(typ, value, traceback)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nmap = {<class 'TimeoutError'>: <class 'httpcore.ReadTimeout'>, <class 'anyio.BrokenResourceError'>: <class 'httpcore.ReadErr... 'anyio.ClosedResourceError'>: <class 'httpcore.ReadError'>, <class 'anyio.EndOfStream'>: <class 'httpcore.ReadError'>}\n\n    @contextlib.contextmanager\n    def map_exceptions(map: ExceptionMapping) -> typing.Iterator[None]:\n        try:\n            yield\n        except Exception as exc:  # noqa: PIE786\n            for from_exc, to_exc in map.items():\n                if isinstance(exc, from_exc):\n>                   raise to_exc(exc) from exc\nE                   httpcore.ReadError\n\n../../anaconda3/lib/python3.9/site-packages/httpcore/_exceptions.py:14: ReadError\n\nThe above exception was the direct cause of the following exception:\n\nrest = <conftest.RESTClient object at 0x7f47b0c66fd0>\n\n    async def test_number_set_value(rest):\n        \"\"\"number.set_value changes state.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"number.n_{tag}\"\n>       await rest.set_state(eid, \"0\")\n\ntests/entity/test_input_number_select_button.py:205: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:89: in set_state\n    resp = await self.client.post(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1859: in post\n    return await self.request(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1540: in request\n    return await self.send(request, auth=auth, follow_redirects=follow_redirects)\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1629: in send\n    response = await self._send_handling_auth(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1657: in _send_handling_auth\n    response = await self._send_handling_redirects(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1694: in _send_handling_redirects\n    response = await self._send_single_request(request)\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1730: in _send_single_request\n    response = await transport.handle_async_request(request)\n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:394: in handle_async_request\n    resp = await self._pool.handle_async_request(req)\n../../anaconda3/lib/python3.9/contextlib.py:137: in __exit__\n    self.gen.throw(typ, value, traceback)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\n    @contextlib.contextmanager\n    def map_httpcore_exceptions() -> typing.Iterator[None]:\n        global HTTPCORE_EXC_MAP\n        if len(HTTPCORE_EXC_MAP) == 0:\n            HTTPCORE_EXC_MAP = _load_httpcore_exceptions()\n        try:\n            yield\n        except Exception as exc:\n            mapped_exc = None\n    \n            for from_exc, to_exc in HTTPCORE_EXC_MAP.items():\n                if not isinstance(exc, from_exc):\n                    continue\n                # We want to map to the most specific exception we can find.\n                # Eg if `exc` is an `httpcore.ReadTimeout`, we want to map to\n                # `httpx.ReadTimeout`, not just `httpx.TimeoutException`.\n                if mapped_exc is None or issubclass(to_exc, mapped_exc):\n                    mapped_exc = to_exc\n    \n            if mapped_exc is None:  # pragma: no cover\n                raise\n    \n            message = str(exc)\n>           raise mapped_exc(message) from exc\nE           httpx.ReadError\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:118: ReadError"}, "teardown": {"duration": 0.0005684220232069492, "outcome": "passed"}}, {"nodeid": "tests/entity/test_input_number_select_button.py::test_select_select_option", "lineno": 218, "outcome": "failed", "keywords": ["test_select_select_option", "test_input_number_select_button.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.006080925930291414, "outcome": "passed"}, "call": {"duration": 0.010608957149088383, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/entity/test_input_number_select_button.py", "lineno": 232, "message": "AssertionError: assert 'first' == 'second'\n  \n  - second\n  + first"}, "traceback": [{"path": "tests/entity/test_input_number_select_button.py", "lineno": 232, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47ab6ef3a0>\n\n    async def test_select_select_option(rest):\n        \"\"\"select.select_option changes state.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"select.s_{tag}\"\n        await rest.set_state(eid, \"first\")\n    \n        await rest.client.post(\n            f\"{rest.base_url}/api/services/select/select_option\",\n            json={\"entity_id\": eid, \"option\": \"second\"},\n            headers=rest._headers(),\n        )\n    \n        state = await rest.get_state(eid)\n>       assert state[\"state\"] == \"second\"\nE       AssertionError: assert 'first' == 'second'\nE         \nE         - second\nE         + first\n\ntests/entity/test_input_number_select_button.py:232: AssertionError"}, "teardown": {"duration": 0.0007462324574589729, "outcome": "passed"}}, {"nodeid": "tests/entity/test_input_number_select_button.py::test_button_press_no_state_change", "lineno": 236, "outcome": "failed", "keywords": ["test_button_press_no_state_change", "test_input_number_select_button.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005485801957547665, "outcome": "passed"}, "call": {"duration": 0.006039556115865707, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/entity/test_input_number_select_button.py", "lineno": 248, "message": "assert 400 == 200\n +  where 400 = <Response [400 Bad Request]>.status_code"}, "traceback": [{"path": "tests/entity/test_input_number_select_button.py", "lineno": 248, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0b79370>\n\n    async def test_button_press_no_state_change(rest):\n        \"\"\"button.press returns 200 without changing state.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"button.b_{tag}\"\n        await rest.set_state(eid, \"idle\")\n    \n        resp = await rest.client.post(\n            f\"{rest.base_url}/api/services/button/press\",\n            json={\"entity_id\": eid},\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 400 == 200\nE        +  where 400 = <Response [400 Bad Request]>.status_code\n\ntests/entity/test_input_number_select_button.py:248: AssertionError"}, "teardown": {"duration": 0.0007261252030730247, "outcome": "passed"}}, {"nodeid": "tests/entity/test_input_number_select_button.py::test_button_press_multiple_times", "lineno": 253, "outcome": "passed", "keywords": ["test_button_press_multiple_times", "test_input_number_select_button.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005316494032740593, "outcome": "passed"}, "call": {"duration": 0.015459476970136166, "outcome": "passed"}, "teardown": {"duration": 0.0005462579429149628, "outcome": "passed"}}, {"nodeid": "tests/entity/test_input_number_select_button.py::test_input_number_preserves_attributes", "lineno": 272, "outcome": "passed", "keywords": ["test_input_number_preserves_attributes", "test_input_number_select_button.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005267314612865448, "outcome": "passed"}, "call": {"duration": 0.011463315226137638, "outcome": "passed"}, "teardown": {"duration": 0.0005094548687338829, "outcome": "passed"}}, {"nodeid": "tests/entity/test_input_number_select_button.py::test_input_select_preserves_options", "lineno": 289, "outcome": "passed", "keywords": ["test_input_select_preserves_options", "test_input_number_select_button.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005491714924573898, "outcome": "passed"}, "call": {"duration": 0.04051904892548919, "outcome": "passed"}, "teardown": {"duration": 0.0005392362363636494, "outcome": "passed"}}, {"nodeid": "tests/entity/test_media_player_extended.py::test_media_player_state_service[off-turn_on-on]", "lineno": 16, "outcome": "failed", "keywords": ["test_media_player_state_service[off-turn_on-on]", "parametrize", "pytestmark", "off-turn_on-on", "test_media_player_extended.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005308180116117001, "outcome": "passed"}, "call": {"duration": 0.005635459907352924, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/entity/test_media_player_extended.py", "lineno": 35, "message": "assert 400 == 200\n +  where 400 = <Response [400 Bad Request]>.status_code"}, "traceback": [{"path": "tests/entity/test_media_player_extended.py", "lineno": 35, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b21cceb0>, initial_state = 'off'\nservice = 'turn_on', expected_state = 'on'\n\n    @pytest.mark.parametrize(\"initial_state,service,expected_state\", [\n        (\"off\", \"turn_on\", \"on\"),\n        (\"playing\", \"turn_off\", \"off\"),\n        (\"paused\", \"media_play\", \"playing\"),\n        (\"playing\", \"media_pause\", \"paused\"),\n        (\"playing\", \"media_stop\", \"idle\"),\n    ])\n    async def test_media_player_state_service(rest, initial_state, service, expected_state):\n        \"\"\"media_player service transitions to expected state.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"media_player.mp_{service}_{tag}\"\n        await rest.set_state(eid, initial_state)\n    \n        resp = await rest.client.post(\n            f\"{rest.base_url}/api/services/media_player/{service}\",\n            json={\"entity_id\": eid},\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 400 == 200\nE        +  where 400 = <Response [400 Bad Request]>.status_code\n\ntests/entity/test_media_player_extended.py:35: AssertionError"}, "teardown": {"duration": 0.0006189160048961639, "outcome": "passed"}}, {"nodeid": "tests/entity/test_media_player_extended.py::test_media_player_state_service[playing-turn_off-off]", "lineno": 16, "outcome": "failed", "keywords": ["test_media_player_state_service[playing-turn_off-off]", "parametrize", "pytestmark", "playing-turn_off-off", "test_media_player_extended.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005697212647646666, "outcome": "passed"}, "call": {"duration": 0.01502592908218503, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/entity/test_media_player_extended.py", "lineno": 35, "message": "assert 400 == 200\n +  where 400 = <Response [400 Bad Request]>.status_code"}, "traceback": [{"path": "tests/entity/test_media_player_extended.py", "lineno": 35, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47ab5ea700>, initial_state = 'playing'\nservice = 'turn_off', expected_state = 'off'\n\n    @pytest.mark.parametrize(\"initial_state,service,expected_state\", [\n        (\"off\", \"turn_on\", \"on\"),\n        (\"playing\", \"turn_off\", \"off\"),\n        (\"paused\", \"media_play\", \"playing\"),\n        (\"playing\", \"media_pause\", \"paused\"),\n        (\"playing\", \"media_stop\", \"idle\"),\n    ])\n    async def test_media_player_state_service(rest, initial_state, service, expected_state):\n        \"\"\"media_player service transitions to expected state.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"media_player.mp_{service}_{tag}\"\n        await rest.set_state(eid, initial_state)\n    \n        resp = await rest.client.post(\n            f\"{rest.base_url}/api/services/media_player/{service}\",\n            json={\"entity_id\": eid},\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 400 == 200\nE        +  where 400 = <Response [400 Bad Request]>.status_code\n\ntests/entity/test_media_player_extended.py:35: AssertionError"}, "teardown": {"duration": 0.0007325070910155773, "outcome": "passed"}}, {"nodeid": "tests/entity/test_media_player_extended.py::test_media_player_state_service[paused-media_play-playing]", "lineno": 16, "outcome": "failed", "keywords": ["test_media_player_state_service[paused-media_play-playing]", "parametrize", "pytestmark", "paused-media_play-playing", "test_media_player_extended.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005656430032104254, "outcome": "passed"}, "call": {"duration": 0.01804189383983612, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/entity/test_media_player_extended.py", "lineno": 35, "message": "assert 400 == 200\n +  where 400 = <Response [400 Bad Request]>.status_code"}, "traceback": [{"path": "tests/entity/test_media_player_extended.py", "lineno": 35, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b2243340>, initial_state = 'paused'\nservice = 'media_play', expected_state = 'playing'\n\n    @pytest.mark.parametrize(\"initial_state,service,expected_state\", [\n        (\"off\", \"turn_on\", \"on\"),\n        (\"playing\", \"turn_off\", \"off\"),\n        (\"paused\", \"media_play\", \"playing\"),\n        (\"playing\", \"media_pause\", \"paused\"),\n        (\"playing\", \"media_stop\", \"idle\"),\n    ])\n    async def test_media_player_state_service(rest, initial_state, service, expected_state):\n        \"\"\"media_player service transitions to expected state.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"media_player.mp_{service}_{tag}\"\n        await rest.set_state(eid, initial_state)\n    \n        resp = await rest.client.post(\n            f\"{rest.base_url}/api/services/media_player/{service}\",\n            json={\"entity_id\": eid},\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 400 == 200\nE        +  where 400 = <Response [400 Bad Request]>.status_code\n\ntests/entity/test_media_player_extended.py:35: AssertionError"}, "teardown": {"duration": 0.0006025810725986958, "outcome": "passed"}}, {"nodeid": "tests/entity/test_media_player_extended.py::test_media_player_state_service[playing-media_pause-paused]", "lineno": 16, "outcome": "failed", "keywords": ["test_media_player_state_service[playing-media_pause-paused]", "parametrize", "pytestmark", "playing-media_pause-paused", "test_media_player_extended.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.006375935859978199, "outcome": "passed"}, "call": {"duration": 0.005631122272461653, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/entity/test_media_player_extended.py", "lineno": 35, "message": "assert 400 == 200\n +  where 400 = <Response [400 Bad Request]>.status_code"}, "traceback": [{"path": "tests/entity/test_media_player_extended.py", "lineno": 35, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0bb9610>, initial_state = 'playing'\nservice = 'media_pause', expected_state = 'paused'\n\n    @pytest.mark.parametrize(\"initial_state,service,expected_state\", [\n        (\"off\", \"turn_on\", \"on\"),\n        (\"playing\", \"turn_off\", \"off\"),\n        (\"paused\", \"media_play\", \"playing\"),\n        (\"playing\", \"media_pause\", \"paused\"),\n        (\"playing\", \"media_stop\", \"idle\"),\n    ])\n    async def test_media_player_state_service(rest, initial_state, service, expected_state):\n        \"\"\"media_player service transitions to expected state.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"media_player.mp_{service}_{tag}\"\n        await rest.set_state(eid, initial_state)\n    \n        resp = await rest.client.post(\n            f\"{rest.base_url}/api/services/media_player/{service}\",\n            json={\"entity_id\": eid},\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 400 == 200\nE        +  where 400 = <Response [400 Bad Request]>.status_code\n\ntests/entity/test_media_player_extended.py:35: AssertionError"}, "teardown": {"duration": 0.0006525302305817604, "outcome": "passed"}}, {"nodeid": "tests/entity/test_media_player_extended.py::test_media_player_state_service[playing-media_stop-idle]", "lineno": 16, "outcome": "failed", "keywords": ["test_media_player_state_service[playing-media_stop-idle]", "parametrize", "pytestmark", "playing-media_stop-idle", "test_media_player_extended.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.00648077204823494, "outcome": "passed"}, "call": {"duration": 0.008437860291451216, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/entity/test_media_player_extended.py", "lineno": 35, "message": "assert 400 == 200\n +  where 400 = <Response [400 Bad Request]>.status_code"}, "traceback": [{"path": "tests/entity/test_media_player_extended.py", "lineno": 35, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0bb9cd0>, initial_state = 'playing'\nservice = 'media_stop', expected_state = 'idle'\n\n    @pytest.mark.parametrize(\"initial_state,service,expected_state\", [\n        (\"off\", \"turn_on\", \"on\"),\n        (\"playing\", \"turn_off\", \"off\"),\n        (\"paused\", \"media_play\", \"playing\"),\n        (\"playing\", \"media_pause\", \"paused\"),\n        (\"playing\", \"media_stop\", \"idle\"),\n    ])\n    async def test_media_player_state_service(rest, initial_state, service, expected_state):\n        \"\"\"media_player service transitions to expected state.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"media_player.mp_{service}_{tag}\"\n        await rest.set_state(eid, initial_state)\n    \n        resp = await rest.client.post(\n            f\"{rest.base_url}/api/services/media_player/{service}\",\n            json={\"entity_id\": eid},\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 400 == 200\nE        +  where 400 = <Response [400 Bad Request]>.status_code\n\ntests/entity/test_media_player_extended.py:35: AssertionError"}, "teardown": {"duration": 0.0007877224124968052, "outcome": "passed"}}, {"nodeid": "tests/entity/test_media_player_extended.py::test_media_player_track_service[media_next_track]", "lineno": 41, "outcome": "passed", "keywords": ["test_media_player_track_service[media_next_track]", "parametrize", "pytestmark", "media_next_track", "test_media_player_extended.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005664273165166378, "outcome": "passed"}, "call": {"duration": 0.0066766138188540936, "outcome": "passed"}, "teardown": {"duration": 0.0005505257286131382, "outcome": "passed"}}, {"nodeid": "tests/entity/test_media_player_extended.py::test_media_player_track_service[media_previous_track]", "lineno": 41, "outcome": "passed", "keywords": ["test_media_player_track_service[media_previous_track]", "parametrize", "pytestmark", "media_previous_track", "test_media_player_extended.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005994383245706558, "outcome": "passed"}, "call": {"duration": 0.008041689172387123, "outcome": "passed"}, "teardown": {"duration": 0.0005654441192746162, "outcome": "passed"}}, {"nodeid": "tests/entity/test_media_player_extended.py::test_media_player_attribute_set[select_source-payload0-source-Spotify]", "lineno": 62, "outcome": "failed", "keywords": ["test_media_player_attribute_set[select_source-payload0-source-Spotify]", "parametrize", "pytestmark", "select_source-payload0-source-Spotify", "test_media_player_extended.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.006161937024444342, "outcome": "passed"}, "call": {"duration": 0.007479364052414894, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/entity/test_media_player_extended.py", "lineno": 82, "message": "KeyError: 'source'"}, "traceback": [{"path": "tests/entity/test_media_player_extended.py", "lineno": 82, "message": "KeyError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0dd5250>, service = 'select_source'\npayload = {'source': 'Spotify'}, attr_key = 'source', expected = 'Spotify'\n\n    @pytest.mark.parametrize(\"service,payload,attr_key,expected\", [\n        (\"select_source\", {\"source\": \"Spotify\"}, \"source\", \"Spotify\"),\n        (\"volume_set\", {\"volume_level\": 0.75}, \"volume_level\", 0.75),\n        (\"volume_mute\", {\"is_volume_muted\": True}, \"is_volume_muted\", True),\n        (\"shuffle_set\", {\"shuffle\": True}, \"shuffle\", True),\n        (\"repeat_set\", {\"repeat\": \"all\"}, \"repeat\", \"all\"),\n    ])\n    async def test_media_player_attribute_set(rest, service, payload, attr_key, expected):\n        \"\"\"media_player service stores expected attribute via raw HTTP.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"media_player.mp_{service}_{tag}\"\n        await rest.set_state(eid, \"on\" if service in (\"select_source\", \"volume_set\", \"volume_mute\") else \"playing\")\n    \n        await rest.client.post(\n            f\"{rest.base_url}/api/services/media_player/{service}\",\n            json={\"entity_id\": eid, **payload},\n            headers=rest._headers(),\n        )\n        state = await rest.get_state(eid)\n>       assert state[\"attributes\"][attr_key] == expected\nE       KeyError: 'source'\n\ntests/entity/test_media_player_extended.py:82: KeyError"}, "teardown": {"duration": 0.0008285469375550747, "outcome": "passed"}}, {"nodeid": "tests/entity/test_media_player_extended.py::test_media_player_attribute_set[volume_set-payload1-volume_level-0.75]", "lineno": 62, "outcome": "failed", "keywords": ["test_media_player_attribute_set[volume_set-payload1-volume_level-0.75]", "parametrize", "pytestmark", "volume_set-payload1-volume_level-0.75", "test_media_player_extended.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005811955779790878, "outcome": "passed"}, "call": {"duration": 0.007347908802330494, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/entity/test_media_player_extended.py", "lineno": 82, "message": "KeyError: 'volume_level'"}, "traceback": [{"path": "tests/entity/test_media_player_extended.py", "lineno": 82, "message": "KeyError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47ab5a5700>, service = 'volume_set'\npayload = {'volume_level': 0.75}, attr_key = 'volume_level', expected = 0.75\n\n    @pytest.mark.parametrize(\"service,payload,attr_key,expected\", [\n        (\"select_source\", {\"source\": \"Spotify\"}, \"source\", \"Spotify\"),\n        (\"volume_set\", {\"volume_level\": 0.75}, \"volume_level\", 0.75),\n        (\"volume_mute\", {\"is_volume_muted\": True}, \"is_volume_muted\", True),\n        (\"shuffle_set\", {\"shuffle\": True}, \"shuffle\", True),\n        (\"repeat_set\", {\"repeat\": \"all\"}, \"repeat\", \"all\"),\n    ])\n    async def test_media_player_attribute_set(rest, service, payload, attr_key, expected):\n        \"\"\"media_player service stores expected attribute via raw HTTP.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"media_player.mp_{service}_{tag}\"\n        await rest.set_state(eid, \"on\" if service in (\"select_source\", \"volume_set\", \"volume_mute\") else \"playing\")\n    \n        await rest.client.post(\n            f\"{rest.base_url}/api/services/media_player/{service}\",\n            json={\"entity_id\": eid, **payload},\n            headers=rest._headers(),\n        )\n        state = await rest.get_state(eid)\n>       assert state[\"attributes\"][attr_key] == expected\nE       KeyError: 'volume_level'\n\ntests/entity/test_media_player_extended.py:82: KeyError"}, "teardown": {"duration": 0.0007160068489611149, "outcome": "passed"}}, {"nodeid": "tests/entity/test_media_player_extended.py::test_media_player_attribute_set[volume_mute-payload2-is_volume_muted-True]", "lineno": 62, "outcome": "failed", "keywords": ["test_media_player_attribute_set[volume_mute-payload2-is_volume_muted-True]", "parametrize", "pytestmark", "volume_mute-payload2-is_volume_muted-True", "test_media_player_extended.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.00563395768404007, "outcome": "passed"}, "call": {"duration": 0.005817387718707323, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/entity/test_media_player_extended.py", "lineno": 82, "message": "KeyError: 'is_volume_muted'"}, "traceback": [{"path": "tests/entity/test_media_player_extended.py", "lineno": 82, "message": "KeyError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47ab676070>, service = 'volume_mute'\npayload = {'is_volume_muted': True}, attr_key = 'is_volume_muted'\nexpected = True\n\n    @pytest.mark.parametrize(\"service,payload,attr_key,expected\", [\n        (\"select_source\", {\"source\": \"Spotify\"}, \"source\", \"Spotify\"),\n        (\"volume_set\", {\"volume_level\": 0.75}, \"volume_level\", 0.75),\n        (\"volume_mute\", {\"is_volume_muted\": True}, \"is_volume_muted\", True),\n        (\"shuffle_set\", {\"shuffle\": True}, \"shuffle\", True),\n        (\"repeat_set\", {\"repeat\": \"all\"}, \"repeat\", \"all\"),\n    ])\n    async def test_media_player_attribute_set(rest, service, payload, attr_key, expected):\n        \"\"\"media_player service stores expected attribute via raw HTTP.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"media_player.mp_{service}_{tag}\"\n        await rest.set_state(eid, \"on\" if service in (\"select_source\", \"volume_set\", \"volume_mute\") else \"playing\")\n    \n        await rest.client.post(\n            f\"{rest.base_url}/api/services/media_player/{service}\",\n            json={\"entity_id\": eid, **payload},\n            headers=rest._headers(),\n        )\n        state = await rest.get_state(eid)\n>       assert state[\"attributes\"][attr_key] == expected\nE       KeyError: 'is_volume_muted'\n\ntests/entity/test_media_player_extended.py:82: KeyError"}, "teardown": {"duration": 0.0006997827440500259, "outcome": "passed"}}, {"nodeid": "tests/entity/test_media_player_extended.py::test_media_player_attribute_set[shuffle_set-payload3-shuffle-True]", "lineno": 62, "outcome": "failed", "keywords": ["test_media_player_attribute_set[shuffle_set-payload3-shuffle-True]", "parametrize", "pytestmark", "shuffle_set-payload3-shuffle-True", "test_media_player_extended.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.0053829471580684185, "outcome": "passed"}, "call": {"duration": 0.005314571782946587, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/entity/test_media_player_extended.py", "lineno": 82, "message": "KeyError: 'shuffle'"}, "traceback": [{"path": "tests/entity/test_media_player_extended.py", "lineno": 82, "message": "KeyError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47ab705550>, service = 'shuffle_set'\npayload = {'shuffle': True}, attr_key = 'shuffle', expected = True\n\n    @pytest.mark.parametrize(\"service,payload,attr_key,expected\", [\n        (\"select_source\", {\"source\": \"Spotify\"}, \"source\", \"Spotify\"),\n        (\"volume_set\", {\"volume_level\": 0.75}, \"volume_level\", 0.75),\n        (\"volume_mute\", {\"is_volume_muted\": True}, \"is_volume_muted\", True),\n        (\"shuffle_set\", {\"shuffle\": True}, \"shuffle\", True),\n        (\"repeat_set\", {\"repeat\": \"all\"}, \"repeat\", \"all\"),\n    ])\n    async def test_media_player_attribute_set(rest, service, payload, attr_key, expected):\n        \"\"\"media_player service stores expected attribute via raw HTTP.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"media_player.mp_{service}_{tag}\"\n        await rest.set_state(eid, \"on\" if service in (\"select_source\", \"volume_set\", \"volume_mute\") else \"playing\")\n    \n        await rest.client.post(\n            f\"{rest.base_url}/api/services/media_player/{service}\",\n            json={\"entity_id\": eid, **payload},\n            headers=rest._headers(),\n        )\n        state = await rest.get_state(eid)\n>       assert state[\"attributes\"][attr_key] == expected\nE       KeyError: 'shuffle'\n\ntests/entity/test_media_player_extended.py:82: KeyError"}, "teardown": {"duration": 0.0006774319335818291, "outcome": "passed"}}, {"nodeid": "tests/entity/test_media_player_extended.py::test_media_player_attribute_set[repeat_set-payload4-repeat-all]", "lineno": 62, "outcome": "failed", "keywords": ["test_media_player_attribute_set[repeat_set-payload4-repeat-all]", "parametrize", "pytestmark", "repeat_set-payload4-repeat-all", "test_media_player_extended.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005341275129467249, "outcome": "passed"}, "call": {"duration": 0.005083117168396711, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/entity/test_media_player_extended.py", "lineno": 82, "message": "KeyError: 'repeat'"}, "traceback": [{"path": "tests/entity/test_media_player_extended.py", "lineno": 82, "message": "KeyError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47ab709dc0>, service = 'repeat_set'\npayload = {'repeat': 'all'}, attr_key = 'repeat', expected = 'all'\n\n    @pytest.mark.parametrize(\"service,payload,attr_key,expected\", [\n        (\"select_source\", {\"source\": \"Spotify\"}, \"source\", \"Spotify\"),\n        (\"volume_set\", {\"volume_level\": 0.75}, \"volume_level\", 0.75),\n        (\"volume_mute\", {\"is_volume_muted\": True}, \"is_volume_muted\", True),\n        (\"shuffle_set\", {\"shuffle\": True}, \"shuffle\", True),\n        (\"repeat_set\", {\"repeat\": \"all\"}, \"repeat\", \"all\"),\n    ])\n    async def test_media_player_attribute_set(rest, service, payload, attr_key, expected):\n        \"\"\"media_player service stores expected attribute via raw HTTP.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"media_player.mp_{service}_{tag}\"\n        await rest.set_state(eid, \"on\" if service in (\"select_source\", \"volume_set\", \"volume_mute\") else \"playing\")\n    \n        await rest.client.post(\n            f\"{rest.base_url}/api/services/media_player/{service}\",\n            json={\"entity_id\": eid, **payload},\n            headers=rest._headers(),\n        )\n        state = await rest.get_state(eid)\n>       assert state[\"attributes\"][attr_key] == expected\nE       KeyError: 'repeat'\n\ntests/entity/test_media_player_extended.py:82: KeyError"}, "teardown": {"duration": 0.0006758682429790497, "outcome": "passed"}}, {"nodeid": "tests/entity/test_media_player_extended.py::test_media_player_turn_on_with_source", "lineno": 86, "outcome": "failed", "keywords": ["test_media_player_turn_on_with_source", "test_media_player_extended.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005524884443730116, "outcome": "passed"}, "call": {"duration": 0.0060636489652097225, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/entity/test_media_player_extended.py", "lineno": 99, "message": "AssertionError: assert 'off' == 'on'\n  \n  - on\n  + off"}, "traceback": [{"path": "tests/entity/test_media_player_extended.py", "lineno": 99, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47ab6eeaf0>\n\n    async def test_media_player_turn_on_with_source(rest):\n        \"\"\"media_player.turn_on with source stores attribute.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"media_player.mpon_{tag}\"\n        await rest.set_state(eid, \"off\")\n    \n        await rest.client.post(\n            f\"{rest.base_url}/api/services/media_player/turn_on\",\n            json={\"entity_id\": eid, \"source\": \"HDMI1\"},\n            headers=rest._headers(),\n        )\n        state = await rest.get_state(eid)\n>       assert state[\"state\"] == \"on\"\nE       AssertionError: assert 'off' == 'on'\nE         \nE         - on\nE         + off\n\ntests/entity/test_media_player_extended.py:99: AssertionError"}, "teardown": {"duration": 0.000642010010778904, "outcome": "passed"}}, {"nodeid": "tests/entity/test_media_player_extended.py::test_media_player_lifecycle", "lineno": 104, "outcome": "failed", "keywords": ["test_media_player_lifecycle", "test_media_player_extended.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.0053853560239076614, "outcome": "passed"}, "call": {"duration": 0.006464810110628605, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/entity/test_media_player_extended.py", "lineno": 125, "message": "AssertionError: After turn_on: expected on\nassert 'off' == 'on'\n  \n  - on\n  + off"}, "traceback": [{"path": "tests/entity/test_media_player_extended.py", "lineno": 125, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0b7b0d0>\n\n    async def test_media_player_lifecycle(rest):\n        \"\"\"Media player lifecycle: off -> on -> playing -> paused -> stopped.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"media_player.mplc_{tag}\"\n        await rest.set_state(eid, \"off\")\n    \n        for service, expected in [\n            (\"turn_on\", \"on\"),\n            (\"media_play\", \"playing\"),\n            (\"media_pause\", \"paused\"),\n            (\"media_play\", \"playing\"),\n            (\"media_stop\", \"idle\"),\n            (\"turn_off\", \"off\"),\n        ]:\n            await rest.client.post(\n                f\"{rest.base_url}/api/services/media_player/{service}\",\n                json={\"entity_id\": eid},\n                headers=rest._headers(),\n            )\n            state = await rest.get_state(eid)\n>           assert state[\"state\"] == expected, f\"After {service}: expected {expected}\"\nE           AssertionError: After turn_on: expected on\nE           assert 'off' == 'on'\nE             \nE             - on\nE             + off\n\ntests/entity/test_media_player_extended.py:125: AssertionError"}, "teardown": {"duration": 0.0006439583376049995, "outcome": "passed"}}, {"nodeid": "tests/entity/test_media_player_extended.py::test_media_player_play_media", "lineno": 129, "outcome": "failed", "keywords": ["test_media_player_play_media", "test_media_player_extended.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.00537363113835454, "outcome": "passed"}, "call": {"duration": 0.00458071893081069, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/media_player/play_media'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_media_player_extended.py", "lineno": 135, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47ab6effa0>\n\n    async def test_media_player_play_media(rest):\n        \"\"\"media_player.play_media sets state to playing and content attributes.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"media_player.mp_pm_{tag}\"\n        await rest.set_state(eid, \"idle\")\n>       await rest.call_service(\"media_player\", \"play_media\", {\n            \"entity_id\": eid,\n            \"media_content_id\": \"spotify:track:123\",\n            \"media_content_type\": \"music\",\n        })\n\ntests/entity/test_media_player_extended.py:135: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/media_player/play_media'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0006644581444561481, "outcome": "passed"}}, {"nodeid": "tests/entity/test_media_player_extended.py::test_media_player_play_media_preserves_volume", "lineno": 145, "outcome": "failed", "keywords": ["test_media_player_play_media_preserves_volume", "test_media_player_extended.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005477431230247021, "outcome": "passed"}, "call": {"duration": 0.004057582933455706, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/media_player/play_media'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_media_player_extended.py", "lineno": 151, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0480130>\n\n    async def test_media_player_play_media_preserves_volume(rest):\n        \"\"\"play_media preserves existing volume attribute.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"media_player.mp_pmv_{tag}\"\n        await rest.set_state(eid, \"on\", {\"volume_level\": 0.5})\n>       await rest.call_service(\"media_player\", \"play_media\", {\n            \"entity_id\": eid,\n            \"media_content_id\": \"radio:fm101\",\n            \"media_content_type\": \"music\",\n        })\n\ntests/entity/test_media_player_extended.py:151: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/media_player/play_media'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0007744012400507927, "outcome": "passed"}}, {"nodeid": "tests/entity/test_media_player_extended.py::test_media_player_select_source_preserves_state", "lineno": 162, "outcome": "failed", "keywords": ["test_media_player_select_source_preserves_state", "test_media_player_extended.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005572129972279072, "outcome": "passed"}, "call": {"duration": 0.003920928109437227, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/media_player/select_source'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_media_player_extended.py", "lineno": 168, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47ab79abb0>\n\n    async def test_media_player_select_source_preserves_state(rest):\n        \"\"\"select_source preserves current playing state.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"media_player.mp_srcp_{tag}\"\n        await rest.set_state(eid, \"playing\")\n>       await rest.call_service(\"media_player\", \"select_source\", {\n            \"entity_id\": eid, \"source\": \"Bluetooth\",\n        })\n\ntests/entity/test_media_player_extended.py:168: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/media_player/select_source'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0007190899923443794, "outcome": "passed"}}, {"nodeid": "tests/entity/test_media_player_extended.py::test_media_player_select_sound_mode", "lineno": 177, "outcome": "failed", "keywords": ["test_media_player_select_sound_mode", "test_media_player_extended.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005500986240804195, "outcome": "passed"}, "call": {"duration": 0.003897292073816061, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/media_player/select_sound_mode'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_media_player_extended.py", "lineno": 183, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47ab7063d0>\n\n    async def test_media_player_select_sound_mode(rest):\n        \"\"\"media_player.select_sound_mode sets sound_mode attribute.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"media_player.mp_sm_{tag}\"\n        await rest.set_state(eid, \"on\")\n>       await rest.call_service(\"media_player\", \"select_sound_mode\", {\n            \"entity_id\": eid, \"sound_mode\": \"surround\",\n        })\n\ntests/entity/test_media_player_extended.py:183: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/media_player/select_sound_mode'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0006762868724763393, "outcome": "passed"}}, {"nodeid": "tests/entity/test_media_player_extended.py::test_media_player_volume_unmute", "lineno": 191, "outcome": "failed", "keywords": ["test_media_player_volume_unmute", "test_media_player_extended.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005309252068400383, "outcome": "passed"}, "call": {"duration": 0.004706103354692459, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/media_player/volume_mute'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_media_player_extended.py", "lineno": 197, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47ab7cd310>\n\n    async def test_media_player_volume_unmute(rest):\n        \"\"\"media_player.volume_mute can unmute.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"media_player.mp_unmute_{tag}\"\n        await rest.set_state(eid, \"playing\", {\"is_volume_muted\": True})\n>       await rest.call_service(\"media_player\", \"volume_mute\", {\n            \"entity_id\": eid, \"is_volume_muted\": False,\n        })\n\ntests/entity/test_media_player_extended.py:197: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/media_player/volume_mute'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0006735250353813171, "outcome": "passed"}}, {"nodeid": "tests/entity/test_media_player_lock_camera_group.py::test_media_player_play_media", "lineno": 17, "outcome": "failed", "keywords": ["test_media_player_play_media", "test_media_player_lock_camera_group.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005661558825522661, "outcome": "passed"}, "call": {"duration": 0.004658757708966732, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/entity/test_media_player_lock_camera_group.py", "lineno": 33, "message": "assert 400 == 200\n +  where 400 = <Response [400 Bad Request]>.status_code"}, "traceback": [{"path": "tests/entity/test_media_player_lock_camera_group.py", "lineno": 33, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b2272610>\n\n    async def test_media_player_play_media(rest):\n        \"\"\"media_player.play_media sets state to playing and stores content attrs.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"media_player.mp_{tag}\"\n        await rest.set_state(eid, \"idle\")\n    \n        resp = await rest.client.post(\n            f\"{rest.base_url}/api/services/media_player/play_media\",\n            json={\n                \"entity_id\": eid,\n                \"media_content_id\": \"spotify:track:abc123\",\n                \"media_content_type\": \"music\",\n            },\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 400 == 200\nE        +  where 400 = <Response [400 Bad Request]>.status_code\n\ntests/entity/test_media_player_lock_camera_group.py:33: AssertionError"}, "teardown": {"duration": 0.000641274731606245, "outcome": "passed"}}, {"nodeid": "tests/entity/test_media_player_lock_camera_group.py::test_media_player_select_sound_mode", "lineno": 40, "outcome": "failed", "keywords": ["test_media_player_select_sound_mode", "test_media_player_lock_camera_group.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005450233817100525, "outcome": "passed"}, "call": {"duration": 0.007657582405954599, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/entity/test_media_player_lock_camera_group.py", "lineno": 52, "message": "assert 400 == 200\n +  where 400 = <Response [400 Bad Request]>.status_code"}, "traceback": [{"path": "tests/entity/test_media_player_lock_camera_group.py", "lineno": 52, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47ab726280>\n\n    async def test_media_player_select_sound_mode(rest):\n        \"\"\"media_player.select_sound_mode stores sound_mode attribute.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"media_player.sm_{tag}\"\n        await rest.set_state(eid, \"playing\")\n    \n        resp = await rest.client.post(\n            f\"{rest.base_url}/api/services/media_player/select_sound_mode\",\n            json={\"entity_id\": eid, \"sound_mode\": \"surround\"},\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 400 == 200\nE        +  where 400 = <Response [400 Bad Request]>.status_code\n\ntests/entity/test_media_player_lock_camera_group.py:52: AssertionError"}, "teardown": {"duration": 0.0006887628696858883, "outcome": "passed"}}, {"nodeid": "tests/entity/test_media_player_lock_camera_group.py::test_lock_open", "lineno": 59, "outcome": "failed", "keywords": ["test_lock_open", "test_media_player_lock_camera_group.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005461444146931171, "outcome": "passed"}, "call": {"duration": 0.005008305888622999, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/entity/test_media_player_lock_camera_group.py", "lineno": 71, "message": "assert 400 == 200\n +  where 400 = <Response [400 Bad Request]>.status_code"}, "traceback": [{"path": "tests/entity/test_media_player_lock_camera_group.py", "lineno": 71, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47ab6760a0>\n\n    async def test_lock_open(rest):\n        \"\"\"lock.open sets state to open.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"lock.lo_{tag}\"\n        await rest.set_state(eid, \"locked\")\n    \n        resp = await rest.client.post(\n            f\"{rest.base_url}/api/services/lock/open\",\n            json={\"entity_id\": eid},\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 400 == 200\nE        +  where 400 = <Response [400 Bad Request]>.status_code\n\ntests/entity/test_media_player_lock_camera_group.py:71: AssertionError"}, "teardown": {"duration": 0.0005410918965935707, "outcome": "passed"}}, {"nodeid": "tests/entity/test_media_player_lock_camera_group.py::test_lock_unlock_then_open", "lineno": 76, "outcome": "failed", "keywords": ["test_lock_unlock_then_open", "test_media_player_lock_camera_group.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005047937855124474, "outcome": "passed"}, "call": {"duration": 0.005208034999668598, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/entity/test_media_player_lock_camera_group.py", "lineno": 89, "message": "AssertionError: assert 'locked' == 'unlocked'\n  \n  - unlocked\n  ? --\n  + locked"}, "traceback": [{"path": "tests/entity/test_media_player_lock_camera_group.py", "lineno": 89, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b21ed970>\n\n    async def test_lock_unlock_then_open(rest):\n        \"\"\"lock.unlock then lock.open: state goes locked \u2192 unlocked \u2192 open.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"lock.ulo_{tag}\"\n        await rest.set_state(eid, \"locked\")\n    \n        await rest.client.post(\n            f\"{rest.base_url}/api/services/lock/unlock\",\n            json={\"entity_id\": eid},\n            headers=rest._headers(),\n        )\n        s1 = await rest.get_state(eid)\n>       assert s1[\"state\"] == \"unlocked\"\nE       AssertionError: assert 'locked' == 'unlocked'\nE         \nE         - unlocked\nE         ? --\nE         + locked\n\ntests/entity/test_media_player_lock_camera_group.py:89: AssertionError"}, "teardown": {"duration": 0.0006280350498855114, "outcome": "passed"}}, {"nodeid": "tests/entity/test_media_player_lock_camera_group.py::test_lock_locks", "lineno": 99, "outcome": "failed", "keywords": ["test_lock_locks", "test_media_player_lock_camera_group.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005073951091617346, "outcome": "passed"}, "call": {"duration": 0.0039048180915415287, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/lock/lock'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_media_player_lock_camera_group.py", "lineno": 105, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b22ed040>\n\n    async def test_lock_locks(rest):\n        \"\"\"lock.lock sets state to 'locked'.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"lock.ll_{tag}\"\n        await rest.set_state(eid, \"unlocked\")\n>       await rest.call_service(\"lock\", \"lock\", {\"entity_id\": eid})\n\ntests/entity/test_media_player_lock_camera_group.py:105: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/lock/lock'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0006678551435470581, "outcome": "passed"}}, {"nodeid": "tests/entity/test_media_player_lock_camera_group.py::test_lock_unlocks", "lineno": 109, "outcome": "failed", "keywords": ["test_lock_unlocks", "test_media_player_lock_camera_group.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005273564253002405, "outcome": "passed"}, "call": {"duration": 0.003825124818831682, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/lock/unlock'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_media_player_lock_camera_group.py", "lineno": 115, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47ab770040>\n\n    async def test_lock_unlocks(rest):\n        \"\"\"lock.unlock sets state to 'unlocked'.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"lock.lu_{tag}\"\n        await rest.set_state(eid, \"locked\")\n>       await rest.call_service(\"lock\", \"unlock\", {\"entity_id\": eid})\n\ntests/entity/test_media_player_lock_camera_group.py:115: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/lock/unlock'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0006900113075971603, "outcome": "passed"}}, {"nodeid": "tests/entity/test_media_player_lock_camera_group.py::test_lock_toggle_locked_to_unlocked", "lineno": 119, "outcome": "failed", "keywords": ["test_lock_toggle_locked_to_unlocked", "test_media_player_lock_camera_group.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005163016729056835, "outcome": "passed"}, "call": {"duration": 0.0039292750880122185, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/lock/toggle'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_media_player_lock_camera_group.py", "lineno": 125, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47ab647820>\n\n    async def test_lock_toggle_locked_to_unlocked(rest):\n        \"\"\"lock.toggle flips locked to unlocked (via generic fallback).\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"lock.lt_{tag}\"\n        await rest.set_state(eid, \"locked\")\n>       await rest.call_service(\"lock\", \"toggle\", {\"entity_id\": eid})\n\ntests/entity/test_media_player_lock_camera_group.py:125: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/lock/toggle'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.000696863979101181, "outcome": "passed"}}, {"nodeid": "tests/entity/test_media_player_lock_camera_group.py::test_lock_preserves_attributes", "lineno": 130, "outcome": "failed", "keywords": ["test_lock_preserves_attributes", "test_media_player_lock_camera_group.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.006141153164207935, "outcome": "passed"}, "call": {"duration": 0.004611690994352102, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/lock/lock'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_media_player_lock_camera_group.py", "lineno": 136, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0d88af0>\n\n    async def test_lock_preserves_attributes(rest):\n        \"\"\"lock/unlock preserves existing attributes.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"lock.la_{tag}\"\n        await rest.set_state(eid, \"unlocked\", {\"friendly_name\": \"Front Door\", \"battery\": 85})\n>       await rest.call_service(\"lock\", \"lock\", {\"entity_id\": eid})\n\ntests/entity/test_media_player_lock_camera_group.py:136: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/lock/lock'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0007596788927912712, "outcome": "passed"}}, {"nodeid": "tests/entity/test_media_player_lock_camera_group.py::test_camera_enable_motion_detection", "lineno": 144, "outcome": "failed", "keywords": ["test_camera_enable_motion_detection", "test_media_player_lock_camera_group.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005261681042611599, "outcome": "passed"}, "call": {"duration": 0.00449129706248641, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/entity/test_media_player_lock_camera_group.py", "lineno": 156, "message": "assert 400 == 200\n +  where 400 = <Response [400 Bad Request]>.status_code"}, "traceback": [{"path": "tests/entity/test_media_player_lock_camera_group.py", "lineno": 156, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0037d00>\n\n    async def test_camera_enable_motion_detection(rest):\n        \"\"\"camera.enable_motion_detection sets motion_detection attribute to true.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"camera.em_{tag}\"\n        await rest.set_state(eid, \"idle\")\n    \n        resp = await rest.client.post(\n            f\"{rest.base_url}/api/services/camera/enable_motion_detection\",\n            json={\"entity_id\": eid},\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 400 == 200\nE        +  where 400 = <Response [400 Bad Request]>.status_code\n\ntests/entity/test_media_player_lock_camera_group.py:156: AssertionError"}, "teardown": {"duration": 0.0006975238211452961, "outcome": "passed"}}, {"nodeid": "tests/entity/test_media_player_lock_camera_group.py::test_camera_disable_motion_detection", "lineno": 161, "outcome": "failed", "keywords": ["test_camera_disable_motion_detection", "test_media_player_lock_camera_group.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005157771985977888, "outcome": "passed"}, "call": {"duration": 0.004311033990234137, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/entity/test_media_player_lock_camera_group.py", "lineno": 173, "message": "assert 400 == 200\n +  where 400 = <Response [400 Bad Request]>.status_code"}, "traceback": [{"path": "tests/entity/test_media_player_lock_camera_group.py", "lineno": 173, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b22521c0>\n\n    async def test_camera_disable_motion_detection(rest):\n        \"\"\"camera.disable_motion_detection sets motion_detection attribute to false.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"camera.dm_{tag}\"\n        await rest.set_state(eid, \"streaming\", {\"motion_detection\": True})\n    \n        resp = await rest.client.post(\n            f\"{rest.base_url}/api/services/camera/disable_motion_detection\",\n            json={\"entity_id\": eid},\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 400 == 200\nE        +  where 400 = <Response [400 Bad Request]>.status_code\n\ntests/entity/test_media_player_lock_camera_group.py:173: AssertionError"}, "teardown": {"duration": 0.0005606370978057384, "outcome": "passed"}}, {"nodeid": "tests/entity/test_media_player_lock_camera_group.py::test_camera_motion_preserves_state", "lineno": 178, "outcome": "failed", "keywords": ["test_camera_motion_preserves_state", "test_media_player_lock_camera_group.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.00516359182074666, "outcome": "passed"}, "call": {"duration": 0.005042145028710365, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/entity/test_media_player_lock_camera_group.py", "lineno": 193, "message": "KeyError: 'motion_detection'"}, "traceback": [{"path": "tests/entity/test_media_player_lock_camera_group.py", "lineno": 193, "message": "KeyError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b2208130>\n\n    async def test_camera_motion_preserves_state(rest):\n        \"\"\"camera.enable_motion_detection preserves current state.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"camera.mp_{tag}\"\n        await rest.set_state(eid, \"streaming\")\n    \n        await rest.client.post(\n            f\"{rest.base_url}/api/services/camera/enable_motion_detection\",\n            json={\"entity_id\": eid},\n            headers=rest._headers(),\n        )\n    \n        state = await rest.get_state(eid)\n        assert state[\"state\"] == \"streaming\"\n>       assert state[\"attributes\"][\"motion_detection\"] is True\nE       KeyError: 'motion_detection'\n\ntests/entity/test_media_player_lock_camera_group.py:193: KeyError"}, "teardown": {"duration": 0.0007849149405956268, "outcome": "passed"}}, {"nodeid": "tests/entity/test_media_player_lock_camera_group.py::test_group_set_state", "lineno": 197, "outcome": "failed", "keywords": ["test_group_set_state", "test_media_player_lock_camera_group.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005660437047481537, "outcome": "passed"}, "call": {"duration": 0.005853244103491306, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/entity/test_media_player_lock_camera_group.py", "lineno": 209, "message": "assert 400 == 200\n +  where 400 = <Response [400 Bad Request]>.status_code"}, "traceback": [{"path": "tests/entity/test_media_player_lock_camera_group.py", "lineno": 209, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47ab6274f0>\n\n    async def test_group_set_state(rest):\n        \"\"\"group.set changes group state.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"group.g_{tag}\"\n        await rest.set_state(eid, \"off\")\n    \n        resp = await rest.client.post(\n            f\"{rest.base_url}/api/services/group/set\",\n            json={\"entity_id\": eid, \"state\": \"on\"},\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 400 == 200\nE        +  where 400 = <Response [400 Bad Request]>.status_code\n\ntests/entity/test_media_player_lock_camera_group.py:209: AssertionError"}, "teardown": {"duration": 0.0007248567417263985, "outcome": "passed"}}, {"nodeid": "tests/entity/test_media_player_lock_camera_group.py::test_group_set_default_on", "lineno": 214, "outcome": "failed", "keywords": ["test_group_set_default_on", "test_media_player_lock_camera_group.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.008016171399503946, "outcome": "passed"}, "call": {"duration": 0.008464208338409662, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/entity/test_media_player_lock_camera_group.py", "lineno": 228, "message": "AssertionError: assert 'off' == 'on'\n  \n  - on\n  + off"}, "traceback": [{"path": "tests/entity/test_media_player_lock_camera_group.py", "lineno": 228, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47ab738310>\n\n    async def test_group_set_default_on(rest):\n        \"\"\"group.set without state param defaults to on.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"group.gd_{tag}\"\n        await rest.set_state(eid, \"off\")\n    \n        await rest.client.post(\n            f\"{rest.base_url}/api/services/group/set\",\n            json={\"entity_id\": eid},\n            headers=rest._headers(),\n        )\n    \n        state = await rest.get_state(eid)\n>       assert state[\"state\"] == \"on\"\nE       AssertionError: assert 'off' == 'on'\nE         \nE         - on\nE         + off\n\ntests/entity/test_media_player_lock_camera_group.py:228: AssertionError"}, "teardown": {"duration": 0.0013137711212038994, "outcome": "passed"}}, {"nodeid": "tests/entity/test_media_player_lock_camera_group.py::test_update_skip", "lineno": 232, "outcome": "failed", "keywords": ["test_update_skip", "test_media_player_lock_camera_group.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005570400971919298, "outcome": "passed"}, "call": {"duration": 0.0041463361121714115, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/entity/test_media_player_lock_camera_group.py", "lineno": 244, "message": "assert 400 == 200\n +  where 400 = <Response [400 Bad Request]>.status_code"}, "traceback": [{"path": "tests/entity/test_media_player_lock_camera_group.py", "lineno": 244, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b009a6a0>\n\n    async def test_update_skip(rest):\n        \"\"\"update.skip sets state to skipped.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"update.us_{tag}\"\n        await rest.set_state(eid, \"available\")\n    \n        resp = await rest.client.post(\n            f\"{rest.base_url}/api/services/update/skip\",\n            json={\"entity_id\": eid},\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 400 == 200\nE        +  where 400 = <Response [400 Bad Request]>.status_code\n\ntests/entity/test_media_player_lock_camera_group.py:244: AssertionError"}, "teardown": {"duration": 0.0008424548432230949, "outcome": "passed"}}, {"nodeid": "tests/entity/test_media_player_lock_camera_group.py::test_generic_turn_on_unknown_domain", "lineno": 251, "outcome": "failed", "keywords": ["test_generic_turn_on_unknown_domain", "test_media_player_lock_camera_group.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005946243181824684, "outcome": "passed"}, "call": {"duration": 0.0042903367429971695, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/entity/test_media_player_lock_camera_group.py", "lineno": 263, "message": "assert 400 == 200\n +  where 400 = <Response [400 Bad Request]>.status_code"}, "traceback": [{"path": "tests/entity/test_media_player_lock_camera_group.py", "lineno": 263, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47ab66aee0>\n\n    async def test_generic_turn_on_unknown_domain(rest):\n        \"\"\"Generic turn_on fallback works on any domain.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"custom_domain.entity_{tag}\"\n        await rest.set_state(eid, \"off\")\n    \n        resp = await rest.client.post(\n            f\"{rest.base_url}/api/services/custom_domain/turn_on\",\n            json={\"entity_id\": eid},\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 400 == 200\nE        +  where 400 = <Response [400 Bad Request]>.status_code\n\ntests/entity/test_media_player_lock_camera_group.py:263: AssertionError"}, "teardown": {"duration": 0.0008705561049282551, "outcome": "passed"}}, {"nodeid": "tests/entity/test_media_player_lock_camera_group.py::test_generic_turn_off_unknown_domain", "lineno": 268, "outcome": "failed", "keywords": ["test_generic_turn_off_unknown_domain", "test_media_player_lock_camera_group.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.007581922225654125, "outcome": "passed"}, "call": {"duration": 0.005494956858456135, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/entity/test_media_player_lock_camera_group.py", "lineno": 280, "message": "assert 400 == 200\n +  where 400 = <Response [400 Bad Request]>.status_code"}, "traceback": [{"path": "tests/entity/test_media_player_lock_camera_group.py", "lineno": 280, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47ab613700>\n\n    async def test_generic_turn_off_unknown_domain(rest):\n        \"\"\"Generic turn_off fallback works on any domain.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"custom_domain.entity2_{tag}\"\n        await rest.set_state(eid, \"on\")\n    \n        resp = await rest.client.post(\n            f\"{rest.base_url}/api/services/custom_domain/turn_off\",\n            json={\"entity_id\": eid},\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 400 == 200\nE        +  where 400 = <Response [400 Bad Request]>.status_code\n\ntests/entity/test_media_player_lock_camera_group.py:280: AssertionError"}, "teardown": {"duration": 0.000650383997708559, "outcome": "passed"}}, {"nodeid": "tests/entity/test_media_player_lock_camera_group.py::test_generic_toggle_unknown_domain", "lineno": 285, "outcome": "failed", "keywords": ["test_generic_toggle_unknown_domain", "test_media_player_lock_camera_group.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.006212921813130379, "outcome": "passed"}, "call": {"duration": 0.004326946102082729, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/entity/test_media_player_lock_camera_group.py", "lineno": 297, "message": "assert 400 == 200\n +  where 400 = <Response [400 Bad Request]>.status_code"}, "traceback": [{"path": "tests/entity/test_media_player_lock_camera_group.py", "lineno": 297, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47ab692d00>\n\n    async def test_generic_toggle_unknown_domain(rest):\n        \"\"\"Generic toggle fallback flips on\u2192off.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"custom_domain.entity3_{tag}\"\n        await rest.set_state(eid, \"on\")\n    \n        resp = await rest.client.post(\n            f\"{rest.base_url}/api/services/custom_domain/toggle\",\n            json={\"entity_id\": eid},\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 400 == 200\nE        +  where 400 = <Response [400 Bad Request]>.status_code\n\ntests/entity/test_media_player_lock_camera_group.py:297: AssertionError"}, "teardown": {"duration": 0.0005796607583761215, "outcome": "passed"}}, {"nodeid": "tests/entity/test_media_player_state_transitions.py::test_media_player_play", "lineno": 15, "outcome": "failed", "keywords": ["test_media_player_play", "test_media_player_state_transitions.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.006069777067750692, "outcome": "passed"}, "call": {"duration": 0.005660915747284889, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/media_player/media_play'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_media_player_state_transitions.py", "lineno": 22, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b2244c10>\n\n    async def test_media_player_play(rest):\n        \"\"\"media_player.media_play sets state to 'playing'.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"media_player.mp_{tag}\"\n        await rest.set_state(eid, \"idle\")\n    \n>       await rest.call_service(\"media_player\", \"media_play\", {\"entity_id\": eid})\n\ntests/entity/test_media_player_state_transitions.py:22: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/media_player/media_play'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0006846636533737183, "outcome": "passed"}}, {"nodeid": "tests/entity/test_media_player_state_transitions.py::test_media_player_pause", "lineno": 25, "outcome": "failed", "keywords": ["test_media_player_pause", "test_media_player_state_transitions.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005898579955101013, "outcome": "passed"}, "call": {"duration": 0.004009418189525604, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/media_player/media_pause'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_media_player_state_transitions.py", "lineno": 32, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b03d6760>\n\n    async def test_media_player_pause(rest):\n        \"\"\"media_player.media_pause sets state to 'paused'.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"media_player.mp_p_{tag}\"\n        await rest.set_state(eid, \"playing\")\n    \n>       await rest.call_service(\"media_player\", \"media_pause\", {\"entity_id\": eid})\n\ntests/entity/test_media_player_state_transitions.py:32: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/media_player/media_pause'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0006313538178801537, "outcome": "passed"}}, {"nodeid": "tests/entity/test_media_player_state_transitions.py::test_media_player_stop", "lineno": 35, "outcome": "failed", "keywords": ["test_media_player_stop", "test_media_player_state_transitions.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005105355754494667, "outcome": "passed"}, "call": {"duration": 0.005586124956607819, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/media_player/media_stop'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_media_player_state_transitions.py", "lineno": 42, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0b58670>\n\n    async def test_media_player_stop(rest):\n        \"\"\"media_player.media_stop sets state to 'idle'.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"media_player.mp_s_{tag}\"\n        await rest.set_state(eid, \"playing\")\n    \n>       await rest.call_service(\"media_player\", \"media_stop\", {\"entity_id\": eid})\n\ntests/entity/test_media_player_state_transitions.py:42: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/media_player/media_stop'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0008458979427814484, "outcome": "passed"}}, {"nodeid": "tests/entity/test_media_player_state_transitions.py::test_media_player_next_track", "lineno": 45, "outcome": "failed", "keywords": ["test_media_player_next_track", "test_media_player_state_transitions.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005618795286864042, "outcome": "passed"}, "call": {"duration": 0.004970123991370201, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/media_player/media_next_track'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_media_player_state_transitions.py", "lineno": 52, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0045220>\n\n    async def test_media_player_next_track(rest):\n        \"\"\"media_player.media_next_track preserves playing state.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"media_player.mp_n_{tag}\"\n        await rest.set_state(eid, \"playing\")\n    \n>       await rest.call_service(\"media_player\", \"media_next_track\", {\"entity_id\": eid})\n\ntests/entity/test_media_player_state_transitions.py:52: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/media_player/media_next_track'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0008335206657648087, "outcome": "passed"}}, {"nodeid": "tests/entity/test_media_player_state_transitions.py::test_media_player_previous_track", "lineno": 55, "outcome": "failed", "keywords": ["test_media_player_previous_track", "test_media_player_state_transitions.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.009098845068365335, "outcome": "passed"}, "call": {"duration": 0.006183866877108812, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/media_player/media_previous_track'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_media_player_state_transitions.py", "lineno": 62, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47ab79a340>\n\n    async def test_media_player_previous_track(rest):\n        \"\"\"media_player.media_previous_track preserves playing state.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"media_player.mp_prev_{tag}\"\n        await rest.set_state(eid, \"playing\")\n    \n>       await rest.call_service(\"media_player\", \"media_previous_track\", {\"entity_id\": eid})\n\ntests/entity/test_media_player_state_transitions.py:62: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/media_player/media_previous_track'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0007897834293544292, "outcome": "passed"}}, {"nodeid": "tests/entity/test_media_player_state_transitions.py::test_media_player_turn_on", "lineno": 65, "outcome": "failed", "keywords": ["test_media_player_turn_on", "test_media_player_state_transitions.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005267877131700516, "outcome": "passed"}, "call": {"duration": 0.004677680321037769, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/media_player/turn_on'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_media_player_state_transitions.py", "lineno": 72, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b00a4430>\n\n    async def test_media_player_turn_on(rest):\n        \"\"\"media_player.turn_on sets state to 'on'.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"media_player.mp_on_{tag}\"\n        await rest.set_state(eid, \"off\")\n    \n>       await rest.call_service(\"media_player\", \"turn_on\", {\"entity_id\": eid})\n\ntests/entity/test_media_player_state_transitions.py:72: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/media_player/turn_on'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0007539759390056133, "outcome": "passed"}}, {"nodeid": "tests/entity/test_media_player_state_transitions.py::test_media_player_turn_off", "lineno": 75, "outcome": "failed", "keywords": ["test_media_player_turn_off", "test_media_player_state_transitions.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.00514936400577426, "outcome": "passed"}, "call": {"duration": 0.004230315797030926, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/media_player/turn_off'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_media_player_state_transitions.py", "lineno": 82, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47ab5b61c0>\n\n    async def test_media_player_turn_off(rest):\n        \"\"\"media_player.turn_off sets state to 'off'.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"media_player.mp_off_{tag}\"\n        await rest.set_state(eid, \"playing\")\n    \n>       await rest.call_service(\"media_player\", \"turn_off\", {\"entity_id\": eid})\n\ntests/entity/test_media_player_state_transitions.py:82: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/media_player/turn_off'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0008519161492586136, "outcome": "passed"}}, {"nodeid": "tests/entity/test_media_player_state_transitions.py::test_media_player_volume_mute", "lineno": 85, "outcome": "failed", "keywords": ["test_media_player_volume_mute", "test_media_player_state_transitions.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.0053103272803127766, "outcome": "passed"}, "call": {"duration": 0.0042535993270576, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/media_player/volume_mute'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_media_player_state_transitions.py", "lineno": 92, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b2208b20>\n\n    async def test_media_player_volume_mute(rest):\n        \"\"\"media_player.volume_mute stores is_volume_muted attribute.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"media_player.mp_mute_{tag}\"\n        await rest.set_state(eid, \"on\")\n    \n>       await rest.call_service(\"media_player\", \"volume_mute\", {\n            \"entity_id\": eid,\n            \"is_volume_muted\": True,\n        })\n\ntests/entity/test_media_player_state_transitions.py:92: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/media_player/volume_mute'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0007703248411417007, "outcome": "passed"}}, {"nodeid": "tests/entity/test_media_player_state_transitions.py::test_media_player_repeat_set", "lineno": 99, "outcome": "failed", "keywords": ["test_media_player_repeat_set", "test_media_player_state_transitions.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005294726230204105, "outcome": "passed"}, "call": {"duration": 0.004544273018836975, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/media_player/repeat_set'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_media_player_state_transitions.py", "lineno": 106, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b22c3d60>\n\n    async def test_media_player_repeat_set(rest):\n        \"\"\"media_player.repeat_set stores repeat attribute.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"media_player.mp_rep_{tag}\"\n        await rest.set_state(eid, \"playing\")\n    \n>       await rest.call_service(\"media_player\", \"repeat_set\", {\n            \"entity_id\": eid,\n            \"repeat\": \"all\",\n        })\n\ntests/entity/test_media_player_state_transitions.py:106: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/media_player/repeat_set'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0007717162370681763, "outcome": "passed"}}, {"nodeid": "tests/entity/test_media_player_state_transitions.py::test_media_player_lifecycle", "lineno": 113, "outcome": "failed", "keywords": ["test_media_player_lifecycle", "test_media_player_state_transitions.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005779088009148836, "outcome": "passed"}, "call": {"duration": 0.004810484126210213, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/media_player/turn_on'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_media_player_state_transitions.py", "lineno": 120, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b22f1c10>\n\n    async def test_media_player_lifecycle(rest):\n        \"\"\"Full media player lifecycle: off \u2192 on \u2192 playing \u2192 paused \u2192 idle \u2192 off.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"media_player.mp_lc_{tag}\"\n        await rest.set_state(eid, \"off\")\n    \n>       await rest.call_service(\"media_player\", \"turn_on\", {\"entity_id\": eid})\n\ntests/entity/test_media_player_state_transitions.py:120: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/media_player/turn_on'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0008902451954782009, "outcome": "passed"}}, {"nodeid": "tests/entity/test_multi_entity_operations.py::test_turn_on_multiple_lights", "lineno": 16, "outcome": "failed", "keywords": ["test_turn_on_multiple_lights", "test_multi_entity_operations.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005674379412084818, "outcome": "passed"}, "call": {"duration": 0.008570634759962559, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/light/turn_on'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_multi_entity_operations.py", "lineno": 23, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b04f4400>\n\n    async def test_turn_on_multiple_lights(rest):\n        \"\"\"Turn on multiple lights in one service call.\"\"\"\n        for i in range(3):\n            await rest.set_state(f\"light.multi_{i}\", \"off\")\n    \n        for i in range(3):\n>           await rest.call_service(\"light\", \"turn_on\", {\n                \"entity_id\": f\"light.multi_{i}\",\n            })\n\ntests/entity/test_multi_entity_operations.py:23: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/light/turn_on'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0007644202560186386, "outcome": "passed"}}, {"nodeid": "tests/entity/test_multi_entity_operations.py::test_turn_off_multiple_switches", "lineno": 31, "outcome": "failed", "keywords": ["test_turn_off_multiple_switches", "test_multi_entity_operations.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005273960065096617, "outcome": "passed"}, "call": {"duration": 0.007169380784034729, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/switch/turn_off'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_multi_entity_operations.py", "lineno": 38, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47ab6133a0>\n\n    async def test_turn_off_multiple_switches(rest):\n        \"\"\"Turn off multiple switches.\"\"\"\n        for i in range(3):\n            await rest.set_state(f\"switch.multi_sw_{i}\", \"on\")\n    \n        for i in range(3):\n>           await rest.call_service(\"switch\", \"turn_off\", {\n                \"entity_id\": f\"switch.multi_sw_{i}\",\n            })\n\ntests/entity/test_multi_entity_operations.py:38: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/switch/turn_off'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0006697038188576698, "outcome": "passed"}}, {"nodeid": "tests/entity/test_multi_entity_operations.py::test_toggle_multiple_entities", "lineno": 46, "outcome": "failed", "keywords": ["test_toggle_multiple_entities", "test_multi_entity_operations.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005232109688222408, "outcome": "passed"}, "call": {"duration": 0.005206621717661619, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/switch/toggle'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_multi_entity_operations.py", "lineno": 52, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b009c520>\n\n    async def test_toggle_multiple_entities(rest):\n        \"\"\"Toggle multiple entities of different starting states.\"\"\"\n        await rest.set_state(\"switch.multi_tog_a\", \"on\")\n        await rest.set_state(\"switch.multi_tog_b\", \"off\")\n    \n>       await rest.call_service(\"switch\", \"toggle\", {\"entity_id\": \"switch.multi_tog_a\"})\n\ntests/entity/test_multi_entity_operations.py:52: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/switch/toggle'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0006723790429532528, "outcome": "passed"}}, {"nodeid": "tests/entity/test_multi_entity_operations.py::test_get_all_states_includes_created", "lineno": 62, "outcome": "passed", "keywords": ["test_get_all_states_includes_created", "test_multi_entity_operations.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005218519829213619, "outcome": "passed"}, "call": {"duration": 0.0042015607468783855, "outcome": "passed"}, "teardown": {"duration": 0.0004532639868557453, "outcome": "passed"}}, {"nodeid": "tests/entity/test_multi_entity_operations.py::test_get_states_returns_all_fields", "lineno": 72, "outcome": "passed", "keywords": ["test_get_states_returns_all_fields", "test_multi_entity_operations.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005397049244493246, "outcome": "passed"}, "call": {"duration": 0.00371741084381938, "outcome": "passed"}, "teardown": {"duration": 0.0004713260568678379, "outcome": "passed"}}, {"nodeid": "tests/entity/test_multi_entity_operations.py::test_create_many_entities", "lineno": 84, "outcome": "passed", "keywords": ["test_create_many_entities", "test_multi_entity_operations.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005086036399006844, "outcome": "passed"}, "call": {"duration": 0.027507244143635035, "outcome": "passed"}, "teardown": {"duration": 0.0004907590337097645, "outcome": "passed"}}, {"nodeid": "tests/entity/test_multi_entity_operations.py::test_homeassistant_turn_on_multiple_domains", "lineno": 98, "outcome": "failed", "keywords": ["test_homeassistant_turn_on_multiple_domains", "test_multi_entity_operations.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005106295924633741, "outcome": "passed"}, "call": {"duration": 0.01080505084246397, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/entity/test_multi_entity_operations.py", "lineno": 110, "message": "AssertionError: light.multi_ha_lt should be on\nassert 'off' == 'on'\n  \n  - on\n  + off"}, "traceback": [{"path": "tests/entity/test_multi_entity_operations.py", "lineno": 110, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0046b80>\n\n    async def test_homeassistant_turn_on_multiple_domains(rest):\n        \"\"\"homeassistant.turn_on works across multiple domains.\"\"\"\n        await rest.set_state(\"light.multi_ha_lt\", \"off\")\n        await rest.set_state(\"switch.multi_ha_sw\", \"off\")\n        await rest.set_state(\"fan.multi_ha_fan\", \"off\")\n    \n        for eid in [\"light.multi_ha_lt\", \"switch.multi_ha_sw\", \"fan.multi_ha_fan\"]:\n            await rest.call_service(\"homeassistant\", \"turn_on\", {\"entity_id\": eid})\n    \n        for eid in [\"light.multi_ha_lt\", \"switch.multi_ha_sw\", \"fan.multi_ha_fan\"]:\n            state = await rest.get_state(eid)\n>           assert state[\"state\"] == \"on\", f\"{eid} should be on\"\nE           AssertionError: light.multi_ha_lt should be on\nE           assert 'off' == 'on'\nE             \nE             - on\nE             + off\n\ntests/entity/test_multi_entity_operations.py:110: AssertionError"}, "teardown": {"duration": 0.0005902210250496864, "outcome": "passed"}}, {"nodeid": "tests/entity/test_multi_entity_operations.py::test_homeassistant_turn_off_multiple_domains", "lineno": 112, "outcome": "failed", "keywords": ["test_homeassistant_turn_off_multiple_domains", "test_multi_entity_operations.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005269316025078297, "outcome": "passed"}, "call": {"duration": 0.00806910078972578, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/entity/test_multi_entity_operations.py", "lineno": 123, "message": "AssertionError: light.multi_ha_off_lt should be off\nassert 'on' == 'off'\n  \n  - off\n  + on"}, "traceback": [{"path": "tests/entity/test_multi_entity_operations.py", "lineno": 123, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b03c3d90>\n\n    async def test_homeassistant_turn_off_multiple_domains(rest):\n        \"\"\"homeassistant.turn_off works across multiple domains.\"\"\"\n        await rest.set_state(\"light.multi_ha_off_lt\", \"on\")\n        await rest.set_state(\"switch.multi_ha_off_sw\", \"on\")\n    \n        for eid in [\"light.multi_ha_off_lt\", \"switch.multi_ha_off_sw\"]:\n            await rest.call_service(\"homeassistant\", \"turn_off\", {\"entity_id\": eid})\n    \n        for eid in [\"light.multi_ha_off_lt\", \"switch.multi_ha_off_sw\"]:\n            state = await rest.get_state(eid)\n>           assert state[\"state\"] == \"off\", f\"{eid} should be off\"\nE           AssertionError: light.multi_ha_off_lt should be off\nE           assert 'on' == 'off'\nE             \nE             - off\nE             + on\n\ntests/entity/test_multi_entity_operations.py:123: AssertionError"}, "teardown": {"duration": 0.0005829357542097569, "outcome": "passed"}}, {"nodeid": "tests/entity/test_multi_entity_operations.py::test_entities_are_isolated", "lineno": 127, "outcome": "passed", "keywords": ["test_entities_are_isolated", "test_multi_entity_operations.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005026212893426418, "outcome": "passed"}, "call": {"duration": 0.008087941911071539, "outcome": "passed"}, "teardown": {"duration": 0.0006296830251812935, "outcome": "passed"}}, {"nodeid": "tests/entity/test_multi_entity_operations.py::test_attributes_are_isolated", "lineno": 140, "outcome": "passed", "keywords": ["test_attributes_are_isolated", "test_multi_entity_operations.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005174879916012287, "outcome": "passed"}, "call": {"duration": 0.006761068943887949, "outcome": "passed"}, "teardown": {"duration": 0.00047713564708828926, "outcome": "passed"}}, {"nodeid": "tests/entity/test_multi_entity_operations.py::test_service_calls_are_isolated", "lineno": 151, "outcome": "failed", "keywords": ["test_service_calls_are_isolated", "test_multi_entity_operations.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005222118925303221, "outcome": "passed"}, "call": {"duration": 0.005816624965518713, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/light/turn_off'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_multi_entity_operations.py", "lineno": 157, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b222e4f0>\n\n    async def test_service_calls_are_isolated(rest):\n        \"\"\"Service call on one entity doesn't change another.\"\"\"\n        await rest.set_state(\"light.multi_svc_a\", \"on\")\n        await rest.set_state(\"light.multi_svc_b\", \"on\")\n    \n>       await rest.call_service(\"light\", \"turn_off\", {\"entity_id\": \"light.multi_svc_a\"})\n\ntests/entity/test_multi_entity_operations.py:157: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/light/turn_off'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0006513423286378384, "outcome": "passed"}}, {"nodeid": "tests/entity/test_new_domains.py::test_water_heater_set_temperature", "lineno": 13, "outcome": "failed", "keywords": ["test_water_heater_set_temperature", "test_new_domains.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.00540011003613472, "outcome": "passed"}, "call": {"duration": 0.0038654659874737263, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/water_heater/set_temperature'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_new_domains.py", "lineno": 17, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b03d22b0>\n\n    async def test_water_heater_set_temperature(rest):\n        \"\"\"water_heater.set_temperature sets temperature attribute.\"\"\"\n        await rest.set_state(\"water_heater.main\", \"eco\")\n>       await rest.call_service(\"water_heater\", \"set_temperature\", {\n            \"entity_id\": \"water_heater.main\",\n            \"temperature\": 120,\n        })\n\ntests/entity/test_new_domains.py:17: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/water_heater/set_temperature'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0006701699458062649, "outcome": "passed"}}, {"nodeid": "tests/entity/test_new_domains.py::test_water_heater_set_operation_mode", "lineno": 24, "outcome": "failed", "keywords": ["test_water_heater_set_operation_mode", "test_new_domains.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.006148310843855143, "outcome": "passed"}, "call": {"duration": 0.004073784686625004, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/water_heater/set_operation_mode'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_new_domains.py", "lineno": 28, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47ab66b8b0>\n\n    async def test_water_heater_set_operation_mode(rest):\n        \"\"\"water_heater.set_operation_mode sets state to mode.\"\"\"\n        await rest.set_state(\"water_heater.main\", \"eco\")\n>       await rest.call_service(\"water_heater\", \"set_operation_mode\", {\n            \"entity_id\": \"water_heater.main\",\n            \"operation_mode\": \"performance\",\n        })\n\ntests/entity/test_new_domains.py:28: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/water_heater/set_operation_mode'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0006976439617574215, "outcome": "passed"}}, {"nodeid": "tests/entity/test_new_domains.py::test_water_heater_turn_on", "lineno": 35, "outcome": "failed", "keywords": ["test_water_heater_turn_on", "test_new_domains.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005289108958095312, "outcome": "passed"}, "call": {"duration": 0.007018876727670431, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/water_heater/turn_on'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_new_domains.py", "lineno": 39, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47ab7ac160>\n\n    async def test_water_heater_turn_on(rest):\n        \"\"\"water_heater.turn_on sets state to eco.\"\"\"\n        await rest.set_state(\"water_heater.main\", \"off\")\n>       await rest.call_service(\"water_heater\", \"turn_on\", {\n            \"entity_id\": \"water_heater.main\",\n        })\n\ntests/entity/test_new_domains.py:39: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/water_heater/turn_on'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0007477160543203354, "outcome": "passed"}}, {"nodeid": "tests/entity/test_new_domains.py::test_water_heater_turn_off", "lineno": 45, "outcome": "failed", "keywords": ["test_water_heater_turn_off", "test_new_domains.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005813701078295708, "outcome": "passed"}, "call": {"duration": 0.005172586999833584, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/water_heater/turn_off'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_new_domains.py", "lineno": 49, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b2209340>\n\n    async def test_water_heater_turn_off(rest):\n        \"\"\"water_heater.turn_off sets state to off.\"\"\"\n        await rest.set_state(\"water_heater.main\", \"eco\")\n>       await rest.call_service(\"water_heater\", \"turn_off\", {\n            \"entity_id\": \"water_heater.main\",\n        })\n\ntests/entity/test_new_domains.py:49: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/water_heater/turn_off'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.000787063967436552, "outcome": "passed"}}, {"nodeid": "tests/entity/test_new_domains.py::test_lawn_mower_start", "lineno": 57, "outcome": "failed", "keywords": ["test_lawn_mower_start", "test_new_domains.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005472279153764248, "outcome": "passed"}, "call": {"duration": 0.0041796076111495495, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/lawn_mower/start_mowing'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_new_domains.py", "lineno": 61, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0c7c880>\n\n    async def test_lawn_mower_start(rest):\n        \"\"\"lawn_mower.start_mowing sets state to mowing.\"\"\"\n        await rest.set_state(\"lawn_mower.backyard\", \"docked\")\n>       await rest.call_service(\"lawn_mower\", \"start_mowing\", {\n            \"entity_id\": \"lawn_mower.backyard\",\n        })\n\ntests/entity/test_new_domains.py:61: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/lawn_mower/start_mowing'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0006961547769606113, "outcome": "passed"}}, {"nodeid": "tests/entity/test_new_domains.py::test_lawn_mower_pause", "lineno": 67, "outcome": "failed", "keywords": ["test_lawn_mower_pause", "test_new_domains.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.00540361599996686, "outcome": "passed"}, "call": {"duration": 0.004076926037669182, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/lawn_mower/pause'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_new_domains.py", "lineno": 71, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0c7cac0>\n\n    async def test_lawn_mower_pause(rest):\n        \"\"\"lawn_mower.pause sets state to paused.\"\"\"\n        await rest.set_state(\"lawn_mower.backyard\", \"mowing\")\n>       await rest.call_service(\"lawn_mower\", \"pause\", {\n            \"entity_id\": \"lawn_mower.backyard\",\n        })\n\ntests/entity/test_new_domains.py:71: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/lawn_mower/pause'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0006434470415115356, "outcome": "passed"}}, {"nodeid": "tests/entity/test_new_domains.py::test_lawn_mower_dock", "lineno": 77, "outcome": "failed", "keywords": ["test_lawn_mower_dock", "test_new_domains.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005262496881186962, "outcome": "passed"}, "call": {"duration": 0.003886721096932888, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/lawn_mower/dock'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_new_domains.py", "lineno": 81, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b00465e0>\n\n    async def test_lawn_mower_dock(rest):\n        \"\"\"lawn_mower.dock sets state to docked.\"\"\"\n        await rest.set_state(\"lawn_mower.backyard\", \"mowing\")\n>       await rest.call_service(\"lawn_mower\", \"dock\", {\n            \"entity_id\": \"lawn_mower.backyard\",\n        })\n\ntests/entity/test_new_domains.py:81: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/lawn_mower/dock'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0006489013321697712, "outcome": "passed"}}, {"nodeid": "tests/entity/test_new_domains.py::test_remote_turn_on", "lineno": 89, "outcome": "failed", "keywords": ["test_remote_turn_on", "test_new_domains.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005437646061182022, "outcome": "passed"}, "call": {"duration": 0.005006845574826002, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/remote/turn_on'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_new_domains.py", "lineno": 93, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0d6d580>\n\n    async def test_remote_turn_on(rest):\n        \"\"\"remote.turn_on sets state to on.\"\"\"\n        await rest.set_state(\"remote.tv_remote\", \"off\")\n>       await rest.call_service(\"remote\", \"turn_on\", {\n            \"entity_id\": \"remote.tv_remote\",\n        })\n\ntests/entity/test_new_domains.py:93: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/remote/turn_on'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0006632087752223015, "outcome": "passed"}}, {"nodeid": "tests/entity/test_new_domains.py::test_remote_turn_off", "lineno": 99, "outcome": "failed", "keywords": ["test_remote_turn_off", "test_new_domains.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005569754168391228, "outcome": "passed"}, "call": {"duration": 0.003959367983043194, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/remote/turn_off'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_new_domains.py", "lineno": 103, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47ab5f0d60>\n\n    async def test_remote_turn_off(rest):\n        \"\"\"remote.turn_off sets state to off.\"\"\"\n        await rest.set_state(\"remote.tv_remote\", \"on\")\n>       await rest.call_service(\"remote\", \"turn_off\", {\n            \"entity_id\": \"remote.tv_remote\",\n        })\n\ntests/entity/test_new_domains.py:103: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/remote/turn_off'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0008129128254950047, "outcome": "passed"}}, {"nodeid": "tests/entity/test_new_domains.py::test_remote_send_command", "lineno": 109, "outcome": "failed", "keywords": ["test_remote_send_command", "test_new_domains.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005381208844482899, "outcome": "passed"}, "call": {"duration": 0.0038458388298749924, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/remote/send_command'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_new_domains.py", "lineno": 113, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0491940>\n\n    async def test_remote_send_command(rest):\n        \"\"\"remote.send_command stores last_command attribute.\"\"\"\n        await rest.set_state(\"remote.tv_remote\", \"on\")\n>       await rest.call_service(\"remote\", \"send_command\", {\n            \"entity_id\": \"remote.tv_remote\",\n            \"command\": \"volume_up\",\n        })\n\ntests/entity/test_new_domains.py:113: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/remote/send_command'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0007442799396812916, "outcome": "passed"}}, {"nodeid": "tests/entity/test_new_domains.py::test_services_include_water_heater", "lineno": 122, "outcome": "failed", "keywords": ["test_services_include_water_heater", "test_new_domains.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005939860828220844, "outcome": "passed"}, "call": {"duration": 0.10574535187333822, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/entity/test_new_domains.py", "lineno": 130, "message": "AssertionError: assert 'water_heater' in ['persistent_notification', 'homeassistant', 'logger', 'system_log', 'person', 'frontend', ...]"}, "traceback": [{"path": "tests/entity/test_new_domains.py", "lineno": 130, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47ab6510a0>\n\n    async def test_services_include_water_heater(rest):\n        \"\"\"GET /api/services includes water_heater domain.\"\"\"\n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/services\",\n            headers=rest._headers(),\n        )\n        domains = [s[\"domain\"] for s in resp.json()]\n>       assert \"water_heater\" in domains\nE       AssertionError: assert 'water_heater' in ['persistent_notification', 'homeassistant', 'logger', 'system_log', 'person', 'frontend', ...]\n\ntests/entity/test_new_domains.py:130: AssertionError"}, "teardown": {"duration": 0.0043429723009467125, "outcome": "passed"}}, {"nodeid": "tests/entity/test_new_domains.py::test_services_include_humidifier", "lineno": 132, "outcome": "failed", "keywords": ["test_services_include_humidifier", "test_new_domains.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.006761372089385986, "outcome": "passed"}, "call": {"duration": 0.003515817690640688, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/entity/test_new_domains.py", "lineno": 140, "message": "AssertionError: assert 'humidifier' in ['persistent_notification', 'homeassistant', 'logger', 'system_log', 'person', 'frontend', ...]"}, "traceback": [{"path": "tests/entity/test_new_domains.py", "lineno": 140, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b005be20>\n\n    async def test_services_include_humidifier(rest):\n        \"\"\"GET /api/services includes humidifier domain.\"\"\"\n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/services\",\n            headers=rest._headers(),\n        )\n        domains = [s[\"domain\"] for s in resp.json()]\n>       assert \"humidifier\" in domains\nE       AssertionError: assert 'humidifier' in ['persistent_notification', 'homeassistant', 'logger', 'system_log', 'person', 'frontend', ...]\n\ntests/entity/test_new_domains.py:140: AssertionError"}, "teardown": {"duration": 0.0006243651732802391, "outcome": "passed"}}, {"nodeid": "tests/entity/test_new_domains.py::test_services_include_lawn_mower", "lineno": 142, "outcome": "failed", "keywords": ["test_services_include_lawn_mower", "test_new_domains.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005815715994685888, "outcome": "passed"}, "call": {"duration": 0.003552807029336691, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/entity/test_new_domains.py", "lineno": 150, "message": "AssertionError: assert 'lawn_mower' in ['persistent_notification', 'homeassistant', 'logger', 'system_log', 'person', 'frontend', ...]"}, "traceback": [{"path": "tests/entity/test_new_domains.py", "lineno": 150, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b222bc40>\n\n    async def test_services_include_lawn_mower(rest):\n        \"\"\"GET /api/services includes lawn_mower domain.\"\"\"\n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/services\",\n            headers=rest._headers(),\n        )\n        domains = [s[\"domain\"] for s in resp.json()]\n>       assert \"lawn_mower\" in domains\nE       AssertionError: assert 'lawn_mower' in ['persistent_notification', 'homeassistant', 'logger', 'system_log', 'person', 'frontend', ...]\n\ntests/entity/test_new_domains.py:150: AssertionError"}, "teardown": {"duration": 0.0005442011170089245, "outcome": "passed"}}, {"nodeid": "tests/entity/test_new_domains.py::test_services_include_remote", "lineno": 152, "outcome": "failed", "keywords": ["test_services_include_remote", "test_new_domains.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005804684013128281, "outcome": "passed"}, "call": {"duration": 0.0035566692240536213, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/entity/test_new_domains.py", "lineno": 160, "message": "AssertionError: assert 'remote' in ['persistent_notification', 'homeassistant', 'logger', 'system_log', 'person', 'frontend', ...]"}, "traceback": [{"path": "tests/entity/test_new_domains.py", "lineno": 160, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0ce8a00>\n\n    async def test_services_include_remote(rest):\n        \"\"\"GET /api/services includes remote domain.\"\"\"\n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/services\",\n            headers=rest._headers(),\n        )\n        domains = [s[\"domain\"] for s in resp.json()]\n>       assert \"remote\" in domains\nE       AssertionError: assert 'remote' in ['persistent_notification', 'homeassistant', 'logger', 'system_log', 'person', 'frontend', ...]\n\ntests/entity/test_new_domains.py:160: AssertionError"}, "teardown": {"duration": 0.000545065850019455, "outcome": "passed"}}, {"nodeid": "tests/entity/test_new_domains.py::test_services_total_at_least_40", "lineno": 162, "outcome": "failed", "keywords": ["test_services_total_at_least_40", "test_new_domains.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005038022063672543, "outcome": "passed"}, "call": {"duration": 0.0041869571432471275, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/entity/test_new_domains.py", "lineno": 170, "message": "AssertionError: Expected 40+ domains, got 28\nassert 28 >= 40\n +  where 28 = len([{'domain': 'persistent_notification', 'services': {'create': {'description': 'Shows a notification on the notificatio... of a theme.', 'example': 'default', 'name': 'Theme', 'required': True, ...}}, 'name': 'Set the default theme'}}}, ...])"}, "traceback": [{"path": "tests/entity/test_new_domains.py", "lineno": 170, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b2243670>\n\n    async def test_services_total_at_least_40(rest):\n        \"\"\"GET /api/services returns at least 40 domains.\"\"\"\n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/services\",\n            headers=rest._headers(),\n        )\n        services = resp.json()\n>       assert len(services) >= 40, f\"Expected 40+ domains, got {len(services)}\"\nE       AssertionError: Expected 40+ domains, got 28\nE       assert 28 >= 40\nE        +  where 28 = len([{'domain': 'persistent_notification', 'services': {'create': {'description': 'Shows a notification on the notificatio... of a theme.', 'example': 'default', 'name': 'Theme', 'required': True, ...}}, 'name': 'Set the default theme'}}}, ...])\n\ntests/entity/test_new_domains.py:170: AssertionError"}, "teardown": {"duration": 0.0006644302047789097, "outcome": "passed"}}, {"nodeid": "tests/entity/test_number_select.py::test_number_set_value", "lineno": 14, "outcome": "failed", "keywords": ["test_number_set_value", "test_number_select.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.0051109809428453445, "outcome": "passed"}, "call": {"duration": 0.004636663943529129, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/number/set_value'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_number_select.py", "lineno": 19, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47ab7bba90>\n\n    async def test_number_set_value(rest):\n        \"\"\"number.set_value updates state.\"\"\"\n        entity_id = \"number.test_val\"\n        await rest.set_state(entity_id, \"0\", {\"min\": 0, \"max\": 100, \"step\": 1})\n>       await rest.call_service(\"number\", \"set_value\", {\n            \"entity_id\": entity_id,\n            \"value\": 55,\n        })\n\ntests/entity/test_number_select.py:19: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/number/set_value'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0006975168362259865, "outcome": "passed"}}, {"nodeid": "tests/entity/test_number_select.py::test_number_set_float_value", "lineno": 27, "outcome": "failed", "keywords": ["test_number_set_float_value", "test_number_select.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.0052301641553640366, "outcome": "passed"}, "call": {"duration": 0.0039044679142534733, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/number/set_value'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_number_select.py", "lineno": 32, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b03fb730>\n\n    async def test_number_set_float_value(rest):\n        \"\"\"number.set_value handles float values.\"\"\"\n        entity_id = \"number.test_float\"\n        await rest.set_state(entity_id, \"0\", {\"min\": 0, \"max\": 10, \"step\": 0.1})\n>       await rest.call_service(\"number\", \"set_value\", {\n            \"entity_id\": entity_id,\n            \"value\": 3.14,\n        })\n\ntests/entity/test_number_select.py:32: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/number/set_value'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0006781159900128841, "outcome": "passed"}}, {"nodeid": "tests/entity/test_number_select.py::test_select_option", "lineno": 43, "outcome": "failed", "keywords": ["test_select_option", "test_number_select.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005928413942456245, "outcome": "passed"}, "call": {"duration": 0.004558826331049204, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/select/select_option'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_number_select.py", "lineno": 48, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47ab72d9d0>\n\n    async def test_select_option(rest):\n        \"\"\"select.select_option changes state.\"\"\"\n        entity_id = \"select.test_sel\"\n        await rest.set_state(entity_id, \"auto\", {\"options\": [\"auto\", \"manual\", \"eco\"]})\n>       await rest.call_service(\"select\", \"select_option\", {\n            \"entity_id\": entity_id,\n            \"option\": \"eco\",\n        })\n\ntests/entity/test_number_select.py:48: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/select/select_option'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0007628868333995342, "outcome": "passed"}}, {"nodeid": "tests/entity/test_number_select.py::test_select_preserves_options", "lineno": 56, "outcome": "failed", "keywords": ["test_select_preserves_options", "test_number_select.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.006465202197432518, "outcome": "passed"}, "call": {"duration": 0.004225185140967369, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/select/select_option'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_number_select.py", "lineno": 62, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47ab604910>\n\n    async def test_select_preserves_options(rest):\n        \"\"\"select.select_option preserves the options attribute.\"\"\"\n        entity_id = \"select.test_opts\"\n        options = [\"low\", \"medium\", \"high\"]\n        await rest.set_state(entity_id, \"low\", {\"options\": options})\n>       await rest.call_service(\"select\", \"select_option\", {\n            \"entity_id\": entity_id,\n            \"option\": \"high\",\n        })\n\ntests/entity/test_number_select.py:62: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/select/select_option'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.000860174186527729, "outcome": "passed"}}, {"nodeid": "tests/entity/test_person_zone_weather.py::test_person_set_state", "lineno": 13, "outcome": "passed", "keywords": ["test_person_set_state", "test_person_zone_weather.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005686127580702305, "outcome": "passed"}, "call": {"duration": 0.005066697020083666, "outcome": "passed"}, "teardown": {"duration": 0.0005522868596017361, "outcome": "passed"}}, {"nodeid": "tests/entity/test_person_zone_weather.py::test_person_state_transitions", "lineno": 23, "outcome": "passed", "keywords": ["test_person_state_transitions", "test_person_zone_weather.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005194301251322031, "outcome": "passed"}, "call": {"duration": 0.009701767936348915, "outcome": "passed"}, "teardown": {"duration": 0.0005985656753182411, "outcome": "passed"}}, {"nodeid": "tests/entity/test_person_zone_weather.py::test_zone_entity", "lineno": 38, "outcome": "passed", "keywords": ["test_zone_entity", "test_person_zone_weather.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005263634026050568, "outcome": "passed"}, "call": {"duration": 0.0036965711042284966, "outcome": "passed"}, "teardown": {"duration": 0.0004879571497440338, "outcome": "passed"}}, {"nodeid": "tests/entity/test_person_zone_weather.py::test_zone_multiple", "lineno": 54, "outcome": "passed", "keywords": ["test_zone_multiple", "test_person_zone_weather.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.006025299895554781, "outcome": "passed"}, "call": {"duration": 0.009422537870705128, "outcome": "passed"}, "teardown": {"duration": 0.0004930100403726101, "outcome": "passed"}}, {"nodeid": "tests/entity/test_person_zone_weather.py::test_weather_entity", "lineno": 68, "outcome": "passed", "keywords": ["test_weather_entity", "test_person_zone_weather.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.0060395789332687855, "outcome": "passed"}, "call": {"duration": 0.0037314598448574543, "outcome": "passed"}, "teardown": {"duration": 0.00046546896919608116, "outcome": "passed"}}, {"nodeid": "tests/entity/test_person_zone_weather.py::test_weather_state_changes", "lineno": 84, "outcome": "passed", "keywords": ["test_weather_state_changes", "test_person_zone_weather.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005326027981936932, "outcome": "passed"}, "call": {"duration": 0.005451126955449581, "outcome": "passed"}, "teardown": {"duration": 0.0005067023448646069, "outcome": "passed"}}, {"nodeid": "tests/entity/test_person_zone_weather.py::test_image_entity", "lineno": 94, "outcome": "passed", "keywords": ["test_image_entity", "test_person_zone_weather.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.0051491339690983295, "outcome": "passed"}, "call": {"duration": 0.006198252085596323, "outcome": "passed"}, "teardown": {"duration": 0.0004794248379766941, "outcome": "passed"}}, {"nodeid": "tests/entity/test_person_zone_weather.py::test_script_entity", "lineno": 107, "outcome": "passed", "keywords": ["test_script_entity", "test_person_zone_weather.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005512143950909376, "outcome": "passed"}, "call": {"duration": 0.003535639028996229, "outcome": "passed"}, "teardown": {"duration": 0.0004593399353325367, "outcome": "passed"}}, {"nodeid": "tests/entity/test_person_zone_weather.py::test_group_entity", "lineno": 116, "outcome": "passed", "keywords": ["test_group_entity", "test_person_zone_weather.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005173996090888977, "outcome": "passed"}, "call": {"duration": 0.0036162491887807846, "outcome": "passed"}, "teardown": {"duration": 0.0004638060927391052, "outcome": "passed"}}, {"nodeid": "tests/entity/test_person_zone_weather.py::test_number_entity_set_value", "lineno": 130, "outcome": "failed", "keywords": ["test_number_entity_set_value", "test_person_zone_weather.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.0051610348746180534, "outcome": "passed"}, "call": {"duration": 0.007314130198210478, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/entity/test_person_zone_weather.py", "lineno": 142, "message": "assert 400 == 200\n +  where 400 = <Response [400 Bad Request]>.status_code"}, "traceback": [{"path": "tests/entity/test_person_zone_weather.py", "lineno": 142, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47ab6188e0>\n\n    async def test_number_entity_set_value(rest):\n        \"\"\"number entity set_value service.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"number.volume_{tag}\"\n        await rest.set_state(eid, \"50\")\n    \n        resp = await rest.client.post(\n            f\"{rest.base_url}/api/services/number/set_value\",\n            json={\"entity_id\": eid, \"value\": 75},\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 400 == 200\nE        +  where 400 = <Response [400 Bad Request]>.status_code\n\ntests/entity/test_person_zone_weather.py:142: AssertionError"}, "teardown": {"duration": 0.0005928920581936836, "outcome": "passed"}}, {"nodeid": "tests/entity/test_person_zone_weather.py::test_select_entity_select_option", "lineno": 147, "outcome": "failed", "keywords": ["test_select_entity_select_option", "test_person_zone_weather.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005391063168644905, "outcome": "passed"}, "call": {"duration": 0.0040009659714996815, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/entity/test_person_zone_weather.py", "lineno": 159, "message": "assert 400 == 200\n +  where 400 = <Response [400 Bad Request]>.status_code"}, "traceback": [{"path": "tests/entity/test_person_zone_weather.py", "lineno": 159, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47ab584a30>\n\n    async def test_select_entity_select_option(rest):\n        \"\"\"select entity select_option service.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"select.mode_{tag}\"\n        await rest.set_state(eid, \"auto\", {\"options\": [\"auto\", \"heat\", \"cool\"]})\n    \n        resp = await rest.client.post(\n            f\"{rest.base_url}/api/services/select/select_option\",\n            json={\"entity_id\": eid, \"option\": \"heat\"},\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 400 == 200\nE        +  where 400 = <Response [400 Bad Request]>.status_code\n\ntests/entity/test_person_zone_weather.py:159: AssertionError"}, "teardown": {"duration": 0.0005012103356420994, "outcome": "passed"}}, {"nodeid": "tests/entity/test_person_zone_weather.py::test_button_press", "lineno": 164, "outcome": "passed", "keywords": ["test_button_press", "test_person_zone_weather.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005405924282968044, "outcome": "passed"}, "call": {"duration": 0.004153452347964048, "outcome": "passed"}, "teardown": {"duration": 0.00047351373359560966, "outcome": "passed"}}, {"nodeid": "tests/entity/test_scene_activation.py::test_evening_scene_activates", "lineno": 13, "outcome": "failed", "keywords": ["test_evening_scene_activates", "test_scene_activation.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005225002765655518, "outcome": "passed"}, "call": {"duration": 0.007159125059843063, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/scene/turn_on'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_scene_activation.py", "lineno": 19, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0098ca0>\n\n    async def test_evening_scene_activates(rest):\n        \"\"\"scene.turn_on for evening scene sets expected states.\"\"\"\n        await rest.set_state(\"light.living_room_main\", \"off\")\n        await rest.set_state(\"light.living_room_accent\", \"off\")\n    \n>       await rest.call_service(\"scene\", \"turn_on\", {\n            \"entity_id\": \"scene.evening\",\n        })\n\ntests/entity/test_scene_activation.py:19: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/scene/turn_on'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0006529167294502258, "outcome": "passed"}}, {"nodeid": "tests/entity/test_scene_activation.py::test_evening_scene_sets_accent_light", "lineno": 29, "outcome": "failed", "keywords": ["test_evening_scene_sets_accent_light", "test_scene_activation.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005726628936827183, "outcome": "passed"}, "call": {"duration": 0.005012128036469221, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/scene/turn_on'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_scene_activation.py", "lineno": 34, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47ab6e3ca0>\n\n    async def test_evening_scene_sets_accent_light(rest):\n        \"\"\"Evening scene sets accent light with rgb_color.\"\"\"\n        await rest.set_state(\"light.living_room_accent\", \"off\")\n    \n>       await rest.call_service(\"scene\", \"turn_on\", {\n            \"entity_id\": \"scene.evening\",\n        })\n\ntests/entity/test_scene_activation.py:34: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/scene/turn_on'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0006460351869463921, "outcome": "passed"}}, {"nodeid": "tests/entity/test_scene_activation.py::test_goodnight_scene_turns_off_lights", "lineno": 43, "outcome": "failed", "keywords": ["test_goodnight_scene_turns_off_lights", "test_scene_activation.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005454726982861757, "outcome": "passed"}, "call": {"duration": 0.007364195305854082, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/scene/turn_on'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_scene_activation.py", "lineno": 50, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47ab584940>\n\n    async def test_goodnight_scene_turns_off_lights(rest):\n        \"\"\"Goodnight scene turns off all lights.\"\"\"\n        await rest.set_state(\"light.bedroom\", \"on\")\n        await rest.set_state(\"light.kitchen\", \"on\")\n        await rest.set_state(\"light.living_room_main\", \"on\")\n    \n>       await rest.call_service(\"scene\", \"turn_on\", {\n            \"entity_id\": \"scene.goodnight\",\n        })\n\ntests/entity/test_scene_activation.py:50: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/scene/turn_on'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0006232652813196182, "outcome": "passed"}}, {"nodeid": "tests/entity/test_scene_activation.py::test_scene_merges_attributes", "lineno": 59, "outcome": "failed", "keywords": ["test_scene_merges_attributes", "test_scene_activation.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005256445147097111, "outcome": "passed"}, "call": {"duration": 0.005699369125068188, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/scene/turn_on'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_scene_activation.py", "lineno": 64, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0472cd0>\n\n    async def test_scene_merges_attributes(rest):\n        \"\"\"Scene activation merges attributes from scene definition.\"\"\"\n        await rest.set_state(\"light.living_room_main\", \"off\", {\"color\": \"blue\"})\n    \n>       await rest.call_service(\"scene\", \"turn_on\", {\n            \"entity_id\": \"scene.evening\",\n        })\n\ntests/entity/test_scene_activation.py:64: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/scene/turn_on'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0006850487552583218, "outcome": "passed"}}, {"nodeid": "tests/entity/test_scene_activation.py::test_scene_reactivation_idempotent", "lineno": 73, "outcome": "failed", "keywords": ["test_scene_reactivation_idempotent", "test_scene_activation.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005136423744261265, "outcome": "passed"}, "call": {"duration": 0.004212753847241402, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/scene/turn_on'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_scene_activation.py", "lineno": 76, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b00394c0>\n\n    async def test_scene_reactivation_idempotent(rest):\n        \"\"\"Activating the same scene twice produces consistent results.\"\"\"\n>       await rest.call_service(\"scene\", \"turn_on\", {\n            \"entity_id\": \"scene.evening\",\n        })\n\ntests/entity/test_scene_activation.py:76: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/scene/turn_on'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0006549800746142864, "outcome": "passed"}}, {"nodeid": "tests/entity/test_scene_activation.py::test_scene_via_ws", "lineno": 91, "outcome": "failed", "keywords": ["test_scene_via_ws", "test_scene_activation.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.007214579731225967, "outcome": "passed"}, "call": {"duration": 0.003632584121078253, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/entity/test_scene_activation.py", "lineno": 101, "message": "assert False is True"}, "traceback": [{"path": "tests/entity/test_scene_activation.py", "lineno": 101, "message": "AssertionError"}], "longrepr": "ws = <conftest.WSClient object at 0x7f47b0039ac0>\nrest = <conftest.RESTClient object at 0x7f47ab703f40>\n\n    async def test_scene_via_ws(ws, rest):\n        \"\"\"Scene activation via WebSocket works.\"\"\"\n        await rest.set_state(\"light.living_room_main\", \"off\")\n        resp = await ws.send_command(\n            \"call_service\",\n            domain=\"scene\",\n            service=\"turn_on\",\n            service_data={\"entity_id\": \"scene.evening\"},\n        )\n>       assert resp[\"success\"] is True\nE       assert False is True\n\ntests/entity/test_scene_activation.py:101: AssertionError"}, "teardown": {"duration": 0.0009399349801242352, "outcome": "passed"}}, {"nodeid": "tests/entity/test_scene_activation.py::test_scene_entity_exists", "lineno": 106, "outcome": "passed", "keywords": ["test_scene_entity_exists", "test_scene_activation.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.0049769580364227295, "outcome": "passed"}, "call": {"duration": 0.0031262957490980625, "outcome": "passed"}, "teardown": {"duration": 0.0005337870679795742, "outcome": "passed"}}, {"nodeid": "tests/entity/test_scene_activation.py::test_scene_sets_media_player", "lineno": 113, "outcome": "failed", "keywords": ["test_scene_sets_media_player", "test_scene_activation.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005237401928752661, "outcome": "passed"}, "call": {"duration": 0.0050248317420482635, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/scene/turn_on'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_scene_activation.py", "lineno": 118, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47ab703430>\n\n    async def test_scene_sets_media_player(rest):\n        \"\"\"Evening scene sets media_player state and source.\"\"\"\n        await rest.set_state(\"media_player.living_room\", \"off\")\n    \n>       await rest.call_service(\"scene\", \"turn_on\", {\n            \"entity_id\": \"scene.evening\",\n        })\n\ntests/entity/test_scene_activation.py:118: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/scene/turn_on'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0007165032438933849, "outcome": "passed"}}, {"nodeid": "tests/entity/test_service_attribute_passthrough.py::test_light_brightness_stored", "lineno": 16, "outcome": "failed", "keywords": ["test_light_brightness_stored", "test_service_attribute_passthrough.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.0056215920485556126, "outcome": "passed"}, "call": {"duration": 0.0040486534126102924, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/light/turn_on'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_service_attribute_passthrough.py", "lineno": 23, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47ab683fd0>\n\n    async def test_light_brightness_stored(rest):\n        \"\"\"light.turn_on with brightness stores it as attribute.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"light.attr_bright_{tag}\"\n        await rest.set_state(eid, \"off\")\n    \n>       await rest.call_service(\"light\", \"turn_on\", {\n            \"entity_id\": eid,\n            \"brightness\": 200,\n        })\n\ntests/entity/test_service_attribute_passthrough.py:23: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/light/turn_on'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.000694790855050087, "outcome": "passed"}}, {"nodeid": "tests/entity/test_service_attribute_passthrough.py::test_light_color_temp_stored", "lineno": 31, "outcome": "failed", "keywords": ["test_light_color_temp_stored", "test_service_attribute_passthrough.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005587689112871885, "outcome": "passed"}, "call": {"duration": 0.0041010621935129166, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/light/turn_on'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_service_attribute_passthrough.py", "lineno": 38, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47ab747310>\n\n    async def test_light_color_temp_stored(rest):\n        \"\"\"light.turn_on with color_temp stores it as attribute.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"light.attr_ct_{tag}\"\n        await rest.set_state(eid, \"off\")\n    \n>       await rest.call_service(\"light\", \"turn_on\", {\n            \"entity_id\": eid,\n            \"color_temp\": 370,\n        })\n\ntests/entity/test_service_attribute_passthrough.py:38: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/light/turn_on'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0006715105846524239, "outcome": "passed"}}, {"nodeid": "tests/entity/test_service_attribute_passthrough.py::test_light_rgb_color_stored", "lineno": 45, "outcome": "failed", "keywords": ["test_light_rgb_color_stored", "test_service_attribute_passthrough.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005561073310673237, "outcome": "passed"}, "call": {"duration": 0.004740688018500805, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/light/turn_on'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_service_attribute_passthrough.py", "lineno": 52, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b03d22b0>\n\n    async def test_light_rgb_color_stored(rest):\n        \"\"\"light.turn_on with rgb_color stores it as attribute.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"light.attr_rgb_{tag}\"\n        await rest.set_state(eid, \"off\")\n    \n>       await rest.call_service(\"light\", \"turn_on\", {\n            \"entity_id\": eid,\n            \"rgb_color\": [255, 128, 0],\n        })\n\ntests/entity/test_service_attribute_passthrough.py:52: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/light/turn_on'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0006991643458604813, "outcome": "passed"}}, {"nodeid": "tests/entity/test_service_attribute_passthrough.py::test_light_multiple_attrs_at_once", "lineno": 59, "outcome": "failed", "keywords": ["test_light_multiple_attrs_at_once", "test_service_attribute_passthrough.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005452857818454504, "outcome": "passed"}, "call": {"duration": 0.004173964262008667, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/light/turn_on'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_service_attribute_passthrough.py", "lineno": 66, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47ab6b55e0>\n\n    async def test_light_multiple_attrs_at_once(rest):\n        \"\"\"light.turn_on with multiple attributes stores all.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"light.attr_multi_{tag}\"\n        await rest.set_state(eid, \"off\")\n    \n>       await rest.call_service(\"light\", \"turn_on\", {\n            \"entity_id\": eid,\n            \"brightness\": 128,\n            \"color_temp\": 300,\n        })\n\ntests/entity/test_service_attribute_passthrough.py:66: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/light/turn_on'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0007083662785589695, "outcome": "passed"}}, {"nodeid": "tests/entity/test_service_attribute_passthrough.py::test_fan_percentage_stored", "lineno": 77, "outcome": "failed", "keywords": ["test_fan_percentage_stored", "test_service_attribute_passthrough.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.006228205282241106, "outcome": "passed"}, "call": {"duration": 0.004972108174115419, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/fan/turn_on'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_service_attribute_passthrough.py", "lineno": 84, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47ab79a4c0>\n\n    async def test_fan_percentage_stored(rest):\n        \"\"\"fan.turn_on with percentage stores it.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"fan.attr_pct_{tag}\"\n        await rest.set_state(eid, \"off\")\n    \n>       await rest.call_service(\"fan\", \"turn_on\", {\n            \"entity_id\": eid,\n            \"percentage\": 75,\n        })\n\ntests/entity/test_service_attribute_passthrough.py:84: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/fan/turn_on'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0008707595989108086, "outcome": "passed"}}, {"nodeid": "tests/entity/test_service_attribute_passthrough.py::test_media_player_select_source", "lineno": 94, "outcome": "failed", "keywords": ["test_media_player_select_source", "test_service_attribute_passthrough.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005468826275318861, "outcome": "passed"}, "call": {"duration": 0.00432559521868825, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/media_player/select_source'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_service_attribute_passthrough.py", "lineno": 101, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b22a6bb0>\n\n    async def test_media_player_select_source(rest):\n        \"\"\"media_player.select_source stores source attribute.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"media_player.attr_src_{tag}\"\n        await rest.set_state(eid, \"on\")\n    \n>       await rest.call_service(\"media_player\", \"select_source\", {\n            \"entity_id\": eid,\n            \"source\": \"Spotify\",\n        })\n\ntests/entity/test_service_attribute_passthrough.py:101: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/media_player/select_source'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0006805863231420517, "outcome": "passed"}}, {"nodeid": "tests/entity/test_service_data_validation.py::test_light_brightness_int", "lineno": 13, "outcome": "failed", "keywords": ["test_light_brightness_int", "test_service_data_validation.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005933618173003197, "outcome": "passed"}, "call": {"duration": 0.004153782036155462, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/entity/test_service_data_validation.py", "lineno": 25, "message": "assert 400 == 200\n +  where 400 = <Response [400 Bad Request]>.status_code"}, "traceback": [{"path": "tests/entity/test_service_data_validation.py", "lineno": 25, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0b74ee0>\n\n    async def test_light_brightness_int(rest):\n        \"\"\"light.turn_on with integer brightness.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"light.svc_data_int_{tag}\"\n        await rest.set_state(eid, \"off\")\n    \n        resp = await rest.client.post(\n            f\"{rest.base_url}/api/services/light/turn_on\",\n            json={\"entity_id\": eid, \"brightness\": 128},\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 400 == 200\nE        +  where 400 = <Response [400 Bad Request]>.status_code\n\ntests/entity/test_service_data_validation.py:25: AssertionError"}, "teardown": {"duration": 0.0005289153195917606, "outcome": "passed"}}, {"nodeid": "tests/entity/test_service_data_validation.py::test_light_brightness_float", "lineno": 31, "outcome": "failed", "keywords": ["test_light_brightness_float", "test_service_data_validation.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.0053235930390655994, "outcome": "passed"}, "call": {"duration": 0.00454408023506403, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/entity/test_service_data_validation.py", "lineno": 43, "message": "assert 400 == 200\n +  where 400 = <Response [400 Bad Request]>.status_code"}, "traceback": [{"path": "tests/entity/test_service_data_validation.py", "lineno": 43, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b22ec8b0>\n\n    async def test_light_brightness_float(rest):\n        \"\"\"light.turn_on with float brightness rounds/stores.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"light.svc_data_float_{tag}\"\n        await rest.set_state(eid, \"off\")\n    \n        resp = await rest.client.post(\n            f\"{rest.base_url}/api/services/light/turn_on\",\n            json={\"entity_id\": eid, \"brightness\": 128.5},\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 400 == 200\nE        +  where 400 = <Response [400 Bad Request]>.status_code\n\ntests/entity/test_service_data_validation.py:43: AssertionError"}, "teardown": {"duration": 0.0005374206230044365, "outcome": "passed"}}, {"nodeid": "tests/entity/test_service_data_validation.py::test_light_rgb_array", "lineno": 48, "outcome": "failed", "keywords": ["test_light_rgb_array", "test_service_data_validation.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005170465912669897, "outcome": "passed"}, "call": {"duration": 0.004357175435870886, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/entity/test_service_data_validation.py", "lineno": 60, "message": "assert 400 == 200\n +  where 400 = <Response [400 Bad Request]>.status_code"}, "traceback": [{"path": "tests/entity/test_service_data_validation.py", "lineno": 60, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47ab678430>\n\n    async def test_light_rgb_array(rest):\n        \"\"\"light.turn_on with rgb_color as [R, G, B] array.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"light.svc_rgb_{tag}\"\n        await rest.set_state(eid, \"off\")\n    \n        resp = await rest.client.post(\n            f\"{rest.base_url}/api/services/light/turn_on\",\n            json={\"entity_id\": eid, \"rgb_color\": [255, 128, 0]},\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 400 == 200\nE        +  where 400 = <Response [400 Bad Request]>.status_code\n\ntests/entity/test_service_data_validation.py:60: AssertionError"}, "teardown": {"duration": 0.00049606803804636, "outcome": "passed"}}, {"nodeid": "tests/entity/test_service_data_validation.py::test_climate_temperature_int", "lineno": 65, "outcome": "failed", "keywords": ["test_climate_temperature_int", "test_service_data_validation.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005242116283625364, "outcome": "passed"}, "call": {"duration": 0.004505074582993984, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/entity/test_service_data_validation.py", "lineno": 77, "message": "assert 400 == 200\n +  where 400 = <Response [400 Bad Request]>.status_code"}, "traceback": [{"path": "tests/entity/test_service_data_validation.py", "lineno": 77, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0b9cc40>\n\n    async def test_climate_temperature_int(rest):\n        \"\"\"climate.set_temperature with integer temperature.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"climate.svc_temp_{tag}\"\n        await rest.set_state(eid, \"heat\")\n    \n        resp = await rest.client.post(\n            f\"{rest.base_url}/api/services/climate/set_temperature\",\n            json={\"entity_id\": eid, \"temperature\": 72},\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 400 == 200\nE        +  where 400 = <Response [400 Bad Request]>.status_code\n\ntests/entity/test_service_data_validation.py:77: AssertionError"}, "teardown": {"duration": 0.0005973917432129383, "outcome": "passed"}}, {"nodeid": "tests/entity/test_service_data_validation.py::test_climate_temperature_float", "lineno": 82, "outcome": "failed", "keywords": ["test_climate_temperature_float", "test_service_data_validation.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005169167649000883, "outcome": "passed"}, "call": {"duration": 0.004056176170706749, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/entity/test_service_data_validation.py", "lineno": 94, "message": "assert 400 == 200\n +  where 400 = <Response [400 Bad Request]>.status_code"}, "traceback": [{"path": "tests/entity/test_service_data_validation.py", "lineno": 94, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0b9cd90>\n\n    async def test_climate_temperature_float(rest):\n        \"\"\"climate.set_temperature with float temperature.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"climate.svc_temp_f_{tag}\"\n        await rest.set_state(eid, \"cool\")\n    \n        resp = await rest.client.post(\n            f\"{rest.base_url}/api/services/climate/set_temperature\",\n            json={\"entity_id\": eid, \"temperature\": 22.5},\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 400 == 200\nE        +  where 400 = <Response [400 Bad Request]>.status_code\n\ntests/entity/test_service_data_validation.py:94: AssertionError"}, "teardown": {"duration": 0.0006574457511305809, "outcome": "passed"}}, {"nodeid": "tests/entity/test_service_data_validation.py::test_fan_percentage_boundary_0", "lineno": 99, "outcome": "failed", "keywords": ["test_fan_percentage_boundary_0", "test_service_data_validation.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005102918017655611, "outcome": "passed"}, "call": {"duration": 0.004274544771760702, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/entity/test_service_data_validation.py", "lineno": 111, "message": "assert 400 == 200\n +  where 400 = <Response [400 Bad Request]>.status_code"}, "traceback": [{"path": "tests/entity/test_service_data_validation.py", "lineno": 111, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47ab747700>\n\n    async def test_fan_percentage_boundary_0(rest):\n        \"\"\"fan.set_percentage with 0 (minimum).\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"fan.svc_pct_0_{tag}\"\n        await rest.set_state(eid, \"on\")\n    \n        resp = await rest.client.post(\n            f\"{rest.base_url}/api/services/fan/set_percentage\",\n            json={\"entity_id\": eid, \"percentage\": 0},\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 400 == 200\nE        +  where 400 = <Response [400 Bad Request]>.status_code\n\ntests/entity/test_service_data_validation.py:111: AssertionError"}, "teardown": {"duration": 0.0006858492270112038, "outcome": "passed"}}, {"nodeid": "tests/entity/test_service_data_validation.py::test_fan_percentage_boundary_100", "lineno": 113, "outcome": "failed", "keywords": ["test_fan_percentage_boundary_100", "test_service_data_validation.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.00536931911483407, "outcome": "passed"}, "call": {"duration": 0.004126149695366621, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/entity/test_service_data_validation.py", "lineno": 125, "message": "assert 400 == 200\n +  where 400 = <Response [400 Bad Request]>.status_code"}, "traceback": [{"path": "tests/entity/test_service_data_validation.py", "lineno": 125, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47ab6c5ac0>\n\n    async def test_fan_percentage_boundary_100(rest):\n        \"\"\"fan.set_percentage with 100 (maximum).\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"fan.svc_pct_100_{tag}\"\n        await rest.set_state(eid, \"on\")\n    \n        resp = await rest.client.post(\n            f\"{rest.base_url}/api/services/fan/set_percentage\",\n            json={\"entity_id\": eid, \"percentage\": 100},\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 400 == 200\nE        +  where 400 = <Response [400 Bad Request]>.status_code\n\ntests/entity/test_service_data_validation.py:125: AssertionError"}, "teardown": {"duration": 0.0007041590288281441, "outcome": "passed"}}, {"nodeid": "tests/entity/test_service_data_validation.py::test_cover_position_boundary", "lineno": 130, "outcome": "failed", "keywords": ["test_cover_position_boundary", "test_service_data_validation.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005527779925614595, "outcome": "passed"}, "call": {"duration": 0.005158883985131979, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/entity/test_service_data_validation.py", "lineno": 143, "message": "assert 400 == 200\n +  where 400 = <Response [400 Bad Request]>.status_code"}, "traceback": [{"path": "tests/entity/test_service_data_validation.py", "lineno": 143, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47ab754910>\n\n    async def test_cover_position_boundary(rest):\n        \"\"\"cover.set_cover_position with 0 and 100.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"cover.svc_pos_{tag}\"\n        await rest.set_state(eid, \"open\")\n    \n        # Set to 0\n        resp = await rest.client.post(\n            f\"{rest.base_url}/api/services/cover/set_cover_position\",\n            json={\"entity_id\": eid, \"position\": 0},\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 400 == 200\nE        +  where 400 = <Response [400 Bad Request]>.status_code\n\ntests/entity/test_service_data_validation.py:143: AssertionError"}, "teardown": {"duration": 0.0006949650123715401, "outcome": "passed"}}, {"nodeid": "tests/entity/test_service_data_validation.py::test_media_player_volume_float", "lineno": 157, "outcome": "failed", "keywords": ["test_media_player_volume_float", "test_service_data_validation.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005308511201292276, "outcome": "passed"}, "call": {"duration": 0.004040238913148642, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/entity/test_service_data_validation.py", "lineno": 169, "message": "assert 400 == 200\n +  where 400 = <Response [400 Bad Request]>.status_code"}, "traceback": [{"path": "tests/entity/test_service_data_validation.py", "lineno": 169, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b2257dc0>\n\n    async def test_media_player_volume_float(rest):\n        \"\"\"media_player.volume_set with float 0.0-1.0.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"media_player.svc_vol_{tag}\"\n        await rest.set_state(eid, \"playing\")\n    \n        resp = await rest.client.post(\n            f\"{rest.base_url}/api/services/media_player/volume_set\",\n            json={\"entity_id\": eid, \"volume_level\": 0.75},\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 400 == 200\nE        +  where 400 = <Response [400 Bad Request]>.status_code\n\ntests/entity/test_service_data_validation.py:169: AssertionError"}, "teardown": {"duration": 0.0010222820565104485, "outcome": "passed"}}, {"nodeid": "tests/entity/test_service_data_validation.py::test_extra_service_data_ignored", "lineno": 174, "outcome": "failed", "keywords": ["test_extra_service_data_ignored", "test_service_data_validation.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.00536954402923584, "outcome": "passed"}, "call": {"duration": 0.004678815137594938, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/entity/test_service_data_validation.py", "lineno": 191, "message": "assert 400 == 200\n +  where 400 = <Response [400 Bad Request]>.status_code"}, "traceback": [{"path": "tests/entity/test_service_data_validation.py", "lineno": 191, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47ab7aca00>\n\n    async def test_extra_service_data_ignored(rest):\n        \"\"\"Extra fields in service data don't cause errors.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"light.svc_extra_{tag}\"\n        await rest.set_state(eid, \"off\")\n    \n        resp = await rest.client.post(\n            f\"{rest.base_url}/api/services/light/turn_on\",\n            json={\n                \"entity_id\": eid,\n                \"brightness\": 200,\n                \"nonexistent_field\": \"should be ignored\",\n                \"another_junk\": 42,\n            },\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 400 == 200\nE        +  where 400 = <Response [400 Bad Request]>.status_code\n\ntests/entity/test_service_data_validation.py:191: AssertionError"}, "teardown": {"duration": 0.0006455471739172935, "outcome": "passed"}}, {"nodeid": "tests/entity/test_service_data_validation.py::test_service_with_no_entity_id", "lineno": 195, "outcome": "failed", "keywords": ["test_service_with_no_entity_id", "test_service_data_validation.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005555124022066593, "outcome": "passed"}, "call": {"duration": 0.0027910592034459114, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/entity/test_service_data_validation.py", "lineno": 203, "message": "assert 400 == 200\n +  where 400 = <Response [400 Bad Request]>.status_code"}, "traceback": [{"path": "tests/entity/test_service_data_validation.py", "lineno": 203, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47ab726310>\n\n    async def test_service_with_no_entity_id(rest):\n        \"\"\"Service call with no entity_id doesn't crash.\"\"\"\n        resp = await rest.client.post(\n            f\"{rest.base_url}/api/services/light/turn_on\",\n            json={\"brightness\": 100},\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 400 == 200\nE        +  where 400 = <Response [400 Bad Request]>.status_code\n\ntests/entity/test_service_data_validation.py:203: AssertionError"}, "teardown": {"duration": 0.0005492763593792915, "outcome": "passed"}}, {"nodeid": "tests/entity/test_service_data_validation.py::test_target_pattern_entity_id", "lineno": 205, "outcome": "failed", "keywords": ["test_target_pattern_entity_id", "test_service_data_validation.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005978706292808056, "outcome": "passed"}, "call": {"duration": 0.0041916221380233765, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/entity/test_service_data_validation.py", "lineno": 217, "message": "assert 400 == 200\n +  where 400 = <Response [400 Bad Request]>.status_code"}, "traceback": [{"path": "tests/entity/test_service_data_validation.py", "lineno": 217, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47ab726250>\n\n    async def test_target_pattern_entity_id(rest):\n        \"\"\"Service call with target.entity_id pattern.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"switch.svc_target_{tag}\"\n        await rest.set_state(eid, \"off\")\n    \n        resp = await rest.client.post(\n            f\"{rest.base_url}/api/services/switch/turn_on\",\n            json={\"target\": {\"entity_id\": eid}},\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 400 == 200\nE        +  where 400 = <Response [400 Bad Request]>.status_code\n\ntests/entity/test_service_data_validation.py:217: AssertionError"}, "teardown": {"duration": 0.0005435789935290813, "outcome": "passed"}}, {"nodeid": "tests/entity/test_service_edge_cases.py::test_service_call_nonexistent_entity", "lineno": 14, "outcome": "failed", "keywords": ["test_service_call_nonexistent_entity", "test_service_edge_cases.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.0059553273022174835, "outcome": "passed"}, "call": {"duration": 0.0028744209557771683, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/entity/test_service_edge_cases.py", "lineno": 24, "message": "assert 400 == 200\n +  where 400 = <Response [400 Bad Request]>.status_code"}, "traceback": [{"path": "tests/entity/test_service_edge_cases.py", "lineno": 24, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47ab613a30>\n\n    async def test_service_call_nonexistent_entity(rest):\n        \"\"\"Service call on nonexistent entity still returns 200.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        resp = await rest.client.post(\n            f\"{rest.base_url}/api/services/light/turn_on\",\n            json={\"entity_id\": f\"light.nonexist_{tag}\"},\n            headers=rest._headers(),\n        )\n        # Marge returns 200 even if entity doesn't exist (matches HA behavior)\n>       assert resp.status_code == 200\nE       assert 400 == 200\nE        +  where 400 = <Response [400 Bad Request]>.status_code\n\ntests/entity/test_service_edge_cases.py:24: AssertionError"}, "teardown": {"duration": 0.0005259476602077484, "outcome": "passed"}}, {"nodeid": "tests/entity/test_service_edge_cases.py::test_service_call_empty_entity_id", "lineno": 26, "outcome": "failed", "keywords": ["test_service_call_empty_entity_id", "test_service_edge_cases.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005346170626580715, "outcome": "passed"}, "call": {"duration": 0.003120088018476963, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/entity/test_service_edge_cases.py", "lineno": 34, "message": "assert 400 == 200\n +  where 400 = <Response [400 Bad Request]>.status_code"}, "traceback": [{"path": "tests/entity/test_service_edge_cases.py", "lineno": 34, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47ab755580>\n\n    async def test_service_call_empty_entity_id(rest):\n        \"\"\"Service call with empty entity_id returns 200.\"\"\"\n        resp = await rest.client.post(\n            f\"{rest.base_url}/api/services/light/turn_on\",\n            json={\"entity_id\": \"\"},\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 400 == 200\nE        +  where 400 = <Response [400 Bad Request]>.status_code\n\ntests/entity/test_service_edge_cases.py:34: AssertionError"}, "teardown": {"duration": 0.0006264736875891685, "outcome": "passed"}}, {"nodeid": "tests/entity/test_service_edge_cases.py::test_light_turn_on_preserves_brightness", "lineno": 36, "outcome": "failed", "keywords": ["test_light_turn_on_preserves_brightness", "test_service_edge_cases.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005342382006347179, "outcome": "passed"}, "call": {"duration": 0.004577415995299816, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/light/turn_on'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_service_edge_cases.py", "lineno": 43, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b033f8b0>\n\n    async def test_light_turn_on_preserves_brightness(rest):\n        \"\"\"Turning light on preserves brightness attribute.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"light.pres_{tag}\"\n        await rest.set_state(eid, \"off\", {\"brightness\": 200})\n    \n>       await rest.call_service(\"light\", \"turn_on\", {\"entity_id\": eid})\n\ntests/entity/test_service_edge_cases.py:43: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/light/turn_on'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0007134350016713142, "outcome": "passed"}}, {"nodeid": "tests/entity/test_service_edge_cases.py::test_light_turn_on_sets_brightness", "lineno": 49, "outcome": "failed", "keywords": ["test_light_turn_on_sets_brightness", "test_service_edge_cases.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005248344037681818, "outcome": "passed"}, "call": {"duration": 0.004393772222101688, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/light/turn_on'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_service_edge_cases.py", "lineno": 56, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b22465e0>\n\n    async def test_light_turn_on_sets_brightness(rest):\n        \"\"\"Turning light on with brightness sets the attribute.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"light.brt_{tag}\"\n        await rest.set_state(eid, \"off\")\n    \n>       await rest.call_service(\"light\", \"turn_on\", {\n            \"entity_id\": eid,\n            \"brightness\": 128,\n        })\n\ntests/entity/test_service_edge_cases.py:56: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/light/turn_on'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0007401430048048496, "outcome": "passed"}}, {"nodeid": "tests/entity/test_service_edge_cases.py::test_light_turn_on_sets_color_temp", "lineno": 65, "outcome": "failed", "keywords": ["test_light_turn_on_sets_color_temp", "test_service_edge_cases.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005153621081262827, "outcome": "passed"}, "call": {"duration": 0.003925428260117769, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/light/turn_on'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_service_edge_cases.py", "lineno": 72, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b03b8a60>\n\n    async def test_light_turn_on_sets_color_temp(rest):\n        \"\"\"Turning light on with color_temp sets the attribute.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"light.ct_{tag}\"\n        await rest.set_state(eid, \"off\")\n    \n>       await rest.call_service(\"light\", \"turn_on\", {\n            \"entity_id\": eid,\n            \"color_temp\": 350,\n        })\n\ntests/entity/test_service_edge_cases.py:72: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/light/turn_on'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0008159191347658634, "outcome": "passed"}}, {"nodeid": "tests/entity/test_service_edge_cases.py::test_light_turn_on_sets_rgb", "lineno": 80, "outcome": "failed", "keywords": ["test_light_turn_on_sets_rgb", "test_service_edge_cases.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005083722993731499, "outcome": "passed"}, "call": {"duration": 0.004570026881992817, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/light/turn_on'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_service_edge_cases.py", "lineno": 87, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b04a4fa0>\n\n    async def test_light_turn_on_sets_rgb(rest):\n        \"\"\"Turning light on with rgb_color sets the attribute.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"light.rgb_{tag}\"\n        await rest.set_state(eid, \"off\")\n    \n>       await rest.call_service(\"light\", \"turn_on\", {\n            \"entity_id\": eid,\n            \"rgb_color\": [255, 0, 128],\n        })\n\ntests/entity/test_service_edge_cases.py:87: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/light/turn_on'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0007128771394491196, "outcome": "passed"}}, {"nodeid": "tests/entity/test_service_edge_cases.py::test_climate_set_temperature", "lineno": 95, "outcome": "failed", "keywords": ["test_climate_set_temperature", "test_service_edge_cases.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005526239983737469, "outcome": "passed"}, "call": {"duration": 0.00431442866101861, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/climate/set_temperature'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_service_edge_cases.py", "lineno": 102, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b223ec40>\n\n    async def test_climate_set_temperature(rest):\n        \"\"\"Climate set_temperature stores temperature attribute.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"climate.temp_{tag}\"\n        await rest.set_state(eid, \"heat\")\n    \n>       await rest.call_service(\"climate\", \"set_temperature\", {\n            \"entity_id\": eid,\n            \"temperature\": 72,\n        })\n\ntests/entity/test_service_edge_cases.py:102: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/climate/set_temperature'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0007324954494833946, "outcome": "passed"}}, {"nodeid": "tests/entity/test_service_edge_cases.py::test_climate_set_hvac_mode", "lineno": 110, "outcome": "failed", "keywords": ["test_climate_set_hvac_mode", "test_service_edge_cases.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005384492687880993, "outcome": "passed"}, "call": {"duration": 0.004138275049626827, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/climate/set_hvac_mode'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_service_edge_cases.py", "lineno": 117, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47ab6bd970>\n\n    async def test_climate_set_hvac_mode(rest):\n        \"\"\"Climate set_hvac_mode changes state.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"climate.hvac_{tag}\"\n        await rest.set_state(eid, \"off\")\n    \n>       await rest.call_service(\"climate\", \"set_hvac_mode\", {\n            \"entity_id\": eid,\n            \"hvac_mode\": \"cool\",\n        })\n\ntests/entity/test_service_edge_cases.py:117: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/climate/set_hvac_mode'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0007147239521145821, "outcome": "passed"}}, {"nodeid": "tests/entity/test_service_edge_cases.py::test_fan_set_percentage", "lineno": 125, "outcome": "failed", "keywords": ["test_fan_set_percentage", "test_service_edge_cases.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005362511146813631, "outcome": "passed"}, "call": {"duration": 0.004166938364505768, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/fan/set_percentage'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_service_edge_cases.py", "lineno": 132, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47ab5e0670>\n\n    async def test_fan_set_percentage(rest):\n        \"\"\"Fan set_percentage updates speed and state.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"fan.pct_{tag}\"\n        await rest.set_state(eid, \"off\")\n    \n>       await rest.call_service(\"fan\", \"set_percentage\", {\n            \"entity_id\": eid,\n            \"percentage\": 75,\n        })\n\ntests/entity/test_service_edge_cases.py:132: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/fan/set_percentage'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0007005715742707253, "outcome": "passed"}}, {"nodeid": "tests/entity/test_service_edge_cases.py::test_fan_set_percentage_zero_turns_off", "lineno": 141, "outcome": "failed", "keywords": ["test_fan_set_percentage_zero_turns_off", "test_service_edge_cases.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005347076337784529, "outcome": "passed"}, "call": {"duration": 0.004195173736661673, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/fan/set_percentage'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_service_edge_cases.py", "lineno": 148, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0393220>\n\n    async def test_fan_set_percentage_zero_turns_off(rest):\n        \"\"\"Fan set_percentage(0) turns fan off.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"fan.zero_{tag}\"\n        await rest.set_state(eid, \"on\", {\"percentage\": 50})\n    \n>       await rest.call_service(\"fan\", \"set_percentage\", {\n            \"entity_id\": eid,\n            \"percentage\": 0,\n        })\n\ntests/entity/test_service_edge_cases.py:148: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/fan/set_percentage'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0007543289102613926, "outcome": "passed"}}, {"nodeid": "tests/entity/test_service_edge_cases.py::test_cover_open_close", "lineno": 156, "outcome": "failed", "keywords": ["test_cover_open_close", "test_service_edge_cases.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005423303227871656, "outcome": "passed"}, "call": {"duration": 0.0044385939836502075, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/cover/open_cover'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_service_edge_cases.py", "lineno": 163, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b222e6a0>\n\n    async def test_cover_open_close(rest):\n        \"\"\"Cover open/close changes state.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"cover.oc_{tag}\"\n        await rest.set_state(eid, \"closed\")\n    \n>       await rest.call_service(\"cover\", \"open_cover\", {\"entity_id\": eid})\n\ntests/entity/test_service_edge_cases.py:163: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/cover/open_cover'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0007384554482996464, "outcome": "passed"}}, {"nodeid": "tests/entity/test_service_edge_cases.py::test_cover_set_position", "lineno": 171, "outcome": "failed", "keywords": ["test_cover_set_position", "test_service_edge_cases.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005501939915120602, "outcome": "passed"}, "call": {"duration": 0.005063890013843775, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/cover/set_cover_position'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_service_edge_cases.py", "lineno": 178, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47ab79bee0>\n\n    async def test_cover_set_position(rest):\n        \"\"\"Cover set_cover_position sets position attribute.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"cover.pos_{tag}\"\n        await rest.set_state(eid, \"closed\")\n    \n>       await rest.call_service(\"cover\", \"set_cover_position\", {\n            \"entity_id\": eid,\n            \"position\": 50,\n        })\n\ntests/entity/test_service_edge_cases.py:178: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/cover/set_cover_position'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0007138056680560112, "outcome": "passed"}}, {"nodeid": "tests/entity/test_service_edge_cases.py::test_cover_set_position_zero_closes", "lineno": 187, "outcome": "failed", "keywords": ["test_cover_set_position_zero_closes", "test_service_edge_cases.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.0057983361184597015, "outcome": "passed"}, "call": {"duration": 0.0040186019614338875, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/cover/set_cover_position'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_service_edge_cases.py", "lineno": 194, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47ab706160>\n\n    async def test_cover_set_position_zero_closes(rest):\n        \"\"\"Cover set_cover_position(0) closes cover.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"cover.z_{tag}\"\n        await rest.set_state(eid, \"open\", {\"current_position\": 100})\n    \n>       await rest.call_service(\"cover\", \"set_cover_position\", {\n            \"entity_id\": eid,\n            \"position\": 0,\n        })\n\ntests/entity/test_service_edge_cases.py:194: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/cover/set_cover_position'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0006099129095673561, "outcome": "passed"}}, {"nodeid": "tests/entity/test_service_edge_cases.py::test_lock_lock_unlock", "lineno": 202, "outcome": "failed", "keywords": ["test_lock_lock_unlock", "test_service_edge_cases.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.0056120408698916435, "outcome": "passed"}, "call": {"duration": 0.004695418756455183, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/lock/lock'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_service_edge_cases.py", "lineno": 209, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47ab618ac0>\n\n    async def test_lock_lock_unlock(rest):\n        \"\"\"Lock lock/unlock toggles state.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"lock.lu_{tag}\"\n        await rest.set_state(eid, \"unlocked\")\n    \n>       await rest.call_service(\"lock\", \"lock\", {\"entity_id\": eid})\n\ntests/entity/test_service_edge_cases.py:209: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/lock/lock'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0006338469684123993, "outcome": "passed"}}, {"nodeid": "tests/entity/test_service_edge_cases.py::test_number_set_value", "lineno": 217, "outcome": "failed", "keywords": ["test_number_set_value", "test_service_edge_cases.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005442150868475437, "outcome": "passed"}, "call": {"duration": 0.0045558190904557705, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/number/set_value'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_service_edge_cases.py", "lineno": 224, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47ab584dc0>\n\n    async def test_number_set_value(rest):\n        \"\"\"Number set_value stores numeric state.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"number.nv_{tag}\"\n        await rest.set_state(eid, \"0\")\n    \n>       await rest.call_service(\"number\", \"set_value\", {\n            \"entity_id\": eid,\n            \"value\": 42,\n        })\n\ntests/entity/test_service_edge_cases.py:224: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/number/set_value'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0006597032770514488, "outcome": "passed"}}, {"nodeid": "tests/entity/test_service_edge_cases.py::test_select_select_option", "lineno": 232, "outcome": "failed", "keywords": ["test_select_select_option", "test_service_edge_cases.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005360755138099194, "outcome": "passed"}, "call": {"duration": 0.005393067374825478, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/select/select_option'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_service_edge_cases.py", "lineno": 239, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b22088e0>\n\n    async def test_select_select_option(rest):\n        \"\"\"Select select_option changes state.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"select.opt_{tag}\"\n        await rest.set_state(eid, \"option_a\")\n    \n>       await rest.call_service(\"select\", \"select_option\", {\n            \"entity_id\": eid,\n            \"option\": \"option_b\",\n        })\n\ntests/entity/test_service_edge_cases.py:239: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/select/select_option'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0006968979723751545, "outcome": "passed"}}, {"nodeid": "tests/entity/test_service_edge_cases.py::test_toggle_generic_entity", "lineno": 247, "outcome": "failed", "keywords": ["test_toggle_generic_entity", "test_service_edge_cases.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005395962856709957, "outcome": "passed"}, "call": {"duration": 0.005115295294672251, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/switch/toggle'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_service_edge_cases.py", "lineno": 254, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b22356a0>\n\n    async def test_toggle_generic_entity(rest):\n        \"\"\"Generic toggle works on switch.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"switch.tgl_{tag}\"\n        await rest.set_state(eid, \"off\")\n    \n>       await rest.call_service(\"switch\", \"toggle\", {\"entity_id\": eid})\n\ntests/entity/test_service_edge_cases.py:254: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/switch/toggle'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0007524299435317516, "outcome": "passed"}}, {"nodeid": "tests/entity/test_service_edge_cases.py::test_service_call_multiple_entities", "lineno": 262, "outcome": "failed", "keywords": ["test_service_call_multiple_entities", "test_service_edge_cases.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005129886791110039, "outcome": "passed"}, "call": {"duration": 0.00662714010104537, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/light/turn_on'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_service_edge_cases.py", "lineno": 272, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0bd9c70>\n\n    async def test_service_call_multiple_entities(rest):\n        \"\"\"Service call with entity_id array affects all entities.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eids = [f\"light.multi_{tag}_{i}\" for i in range(3)]\n    \n        # Pre-create all off\n        for eid in eids:\n            await rest.set_state(eid, \"off\")\n    \n>       await rest.call_service(\"light\", \"turn_on\", {\n            \"entity_id\": eids,\n        })\n\ntests/entity/test_service_edge_cases.py:272: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/light/turn_on'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0010704188607633114, "outcome": "passed"}}, {"nodeid": "tests/entity/test_service_edge_cases.py::test_input_boolean_toggle", "lineno": 280, "outcome": "failed", "keywords": ["test_input_boolean_toggle", "test_service_edge_cases.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.0057882522232830524, "outcome": "passed"}, "call": {"duration": 0.005736315622925758, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/entity/test_service_edge_cases.py", "lineno": 289, "message": "AssertionError: assert 'off' == 'on'\n  \n  - on\n  + off"}, "traceback": [{"path": "tests/entity/test_service_edge_cases.py", "lineno": 289, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47ab604a00>\n\n    async def test_input_boolean_toggle(rest):\n        \"\"\"Input boolean toggle works.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"input_boolean.ib_{tag}\"\n        await rest.set_state(eid, \"off\")\n    \n        await rest.call_service(\"input_boolean\", \"toggle\", {\"entity_id\": eid})\n        state = await rest.get_state(eid)\n>       assert state[\"state\"] == \"on\"\nE       AssertionError: assert 'off' == 'on'\nE         \nE         - on\nE         + off\n\ntests/entity/test_service_edge_cases.py:289: AssertionError"}, "teardown": {"duration": 0.0006602122448384762, "outcome": "passed"}}, {"nodeid": "tests/entity/test_service_interactions.py::test_light_turn_on_with_brightness", "lineno": 14, "outcome": "failed", "keywords": ["test_light_turn_on_with_brightness", "test_service_interactions.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005373380612581968, "outcome": "passed"}, "call": {"duration": 0.004061847925186157, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/light/turn_on'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_service_interactions.py", "lineno": 18, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b2284d60>\n\n    async def test_light_turn_on_with_brightness(rest):\n        \"\"\"light.turn_on with brightness sets attribute.\"\"\"\n        await rest.set_state(\"light.svc_int_bright\", \"off\")\n>       await rest.call_service(\"light\", \"turn_on\", {\n            \"entity_id\": \"light.svc_int_bright\",\n            \"brightness\": 200,\n        })\n\ntests/entity/test_service_interactions.py:18: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/light/turn_on'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0007077483460307121, "outcome": "passed"}}, {"nodeid": "tests/entity/test_service_interactions.py::test_light_turn_on_with_color", "lineno": 26, "outcome": "failed", "keywords": ["test_light_turn_on_with_color", "test_service_interactions.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005576671566814184, "outcome": "passed"}, "call": {"duration": 0.0043940977193415165, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/light/turn_on'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_service_interactions.py", "lineno": 30, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0491df0>\n\n    async def test_light_turn_on_with_color(rest):\n        \"\"\"light.turn_on with rgb_color sets attribute.\"\"\"\n        await rest.set_state(\"light.svc_int_color\", \"off\")\n>       await rest.call_service(\"light\", \"turn_on\", {\n            \"entity_id\": \"light.svc_int_color\",\n            \"rgb_color\": [255, 0, 0],\n        })\n\ntests/entity/test_service_interactions.py:30: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/light/turn_on'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0007240748964250088, "outcome": "passed"}}, {"nodeid": "tests/entity/test_service_interactions.py::test_light_toggle_from_on", "lineno": 38, "outcome": "failed", "keywords": ["test_light_toggle_from_on", "test_service_interactions.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005279187113046646, "outcome": "passed"}, "call": {"duration": 0.004874506965279579, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/light/toggle'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_service_interactions.py", "lineno": 42, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47ab77d880>\n\n    async def test_light_toggle_from_on(rest):\n        \"\"\"light.toggle from on switches to off.\"\"\"\n        await rest.set_state(\"light.svc_int_toggle\", \"on\")\n>       await rest.call_service(\"light\", \"toggle\", {\n            \"entity_id\": \"light.svc_int_toggle\",\n        })\n\ntests/entity/test_service_interactions.py:42: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/light/toggle'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0007094736211001873, "outcome": "passed"}}, {"nodeid": "tests/entity/test_service_interactions.py::test_light_toggle_from_off", "lineno": 48, "outcome": "failed", "keywords": ["test_light_toggle_from_off", "test_service_interactions.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.00524417357519269, "outcome": "passed"}, "call": {"duration": 0.004773730877786875, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/light/toggle'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_service_interactions.py", "lineno": 52, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47ab5e09d0>\n\n    async def test_light_toggle_from_off(rest):\n        \"\"\"light.toggle from off switches to on.\"\"\"\n        await rest.set_state(\"light.svc_int_toggle2\", \"off\")\n>       await rest.call_service(\"light\", \"toggle\", {\n            \"entity_id\": \"light.svc_int_toggle2\",\n        })\n\ntests/entity/test_service_interactions.py:52: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/light/toggle'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0007292232476174831, "outcome": "passed"}}, {"nodeid": "tests/entity/test_service_interactions.py::test_climate_set_multiple_attributes", "lineno": 60, "outcome": "failed", "keywords": ["test_climate_set_multiple_attributes", "test_service_interactions.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.0050733741372823715, "outcome": "passed"}, "call": {"duration": 0.00399759178981185, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/climate/set_temperature'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_service_interactions.py", "lineno": 64, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0393790>\n\n    async def test_climate_set_multiple_attributes(rest):\n        \"\"\"climate.set_temperature sets temperature attribute.\"\"\"\n        await rest.set_state(\"climate.svc_int_multi\", \"heat\")\n>       await rest.call_service(\"climate\", \"set_temperature\", {\n            \"entity_id\": \"climate.svc_int_multi\",\n            \"temperature\": 68,\n        })\n\ntests/entity/test_service_interactions.py:64: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/climate/set_temperature'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0006890399381518364, "outcome": "passed"}}, {"nodeid": "tests/entity/test_service_interactions.py::test_cover_toggle_from_open", "lineno": 73, "outcome": "failed", "keywords": ["test_cover_toggle_from_open", "test_service_interactions.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005202766973525286, "outcome": "passed"}, "call": {"duration": 0.004801187198609114, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/cover/toggle'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_service_interactions.py", "lineno": 77, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b004ce50>\n\n    async def test_cover_toggle_from_open(rest):\n        \"\"\"cover.toggle from open switches to closed.\"\"\"\n        await rest.set_state(\"cover.svc_int_ctoggle\", \"open\")\n>       await rest.call_service(\"cover\", \"toggle\", {\n            \"entity_id\": \"cover.svc_int_ctoggle\",\n        })\n\ntests/entity/test_service_interactions.py:77: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/cover/toggle'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0007029189728200436, "outcome": "passed"}}, {"nodeid": "tests/entity/test_service_interactions.py::test_media_player_volume_set", "lineno": 85, "outcome": "failed", "keywords": ["test_media_player_volume_set", "test_service_interactions.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.00571376271545887, "outcome": "passed"}, "call": {"duration": 0.004594807978719473, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/media_player/volume_set'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_service_interactions.py", "lineno": 89, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b04a2b20>\n\n    async def test_media_player_volume_set(rest):\n        \"\"\"media_player.volume_set sets volume_level attribute.\"\"\"\n        await rest.set_state(\"media_player.svc_int_vol\", \"playing\")\n>       await rest.call_service(\"media_player\", \"volume_set\", {\n            \"entity_id\": \"media_player.svc_int_vol\",\n            \"volume_level\": 0.75,\n        })\n\ntests/entity/test_service_interactions.py:89: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/media_player/volume_set'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0007841102778911591, "outcome": "passed"}}, {"nodeid": "tests/entity/test_service_interactions.py::test_media_player_shuffle_set", "lineno": 96, "outcome": "failed", "keywords": ["test_media_player_shuffle_set", "test_service_interactions.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.00533905066549778, "outcome": "passed"}, "call": {"duration": 0.004905638750642538, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/media_player/shuffle_set'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_service_interactions.py", "lineno": 100, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b009c610>\n\n    async def test_media_player_shuffle_set(rest):\n        \"\"\"media_player.shuffle_set sets shuffle attribute.\"\"\"\n        await rest.set_state(\"media_player.svc_int_shuf\", \"playing\")\n>       await rest.call_service(\"media_player\", \"shuffle_set\", {\n            \"entity_id\": \"media_player.svc_int_shuf\",\n            \"shuffle\": True,\n        })\n\ntests/entity/test_service_interactions.py:100: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/media_player/shuffle_set'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0007003797218203545, "outcome": "passed"}}, {"nodeid": "tests/entity/test_service_interactions.py::test_media_player_source", "lineno": 107, "outcome": "failed", "keywords": ["test_media_player_source", "test_service_interactions.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005207941401749849, "outcome": "passed"}, "call": {"duration": 0.004149344749748707, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/media_player/select_source'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_service_interactions.py", "lineno": 111, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b22a6940>\n\n    async def test_media_player_source(rest):\n        \"\"\"media_player.select_source sets source attribute.\"\"\"\n        await rest.set_state(\"media_player.svc_int_src\", \"playing\")\n>       await rest.call_service(\"media_player\", \"select_source\", {\n            \"entity_id\": \"media_player.svc_int_src\",\n            \"source\": \"HDMI 1\",\n        })\n\ntests/entity/test_service_interactions.py:111: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/media_player/select_source'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0008513489738106728, "outcome": "passed"}}, {"nodeid": "tests/entity/test_service_interactions.py::test_media_player_state_transitions", "lineno": 118, "outcome": "failed", "keywords": ["test_media_player_state_transitions", "test_service_interactions.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005496534984558821, "outcome": "passed"}, "call": {"duration": 0.0042487382888793945, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/media_player/media_play'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_service_interactions.py", "lineno": 123, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b2209610>\n\n    async def test_media_player_state_transitions(rest):\n        \"\"\"media_player state transitions: play -> pause -> stop.\"\"\"\n        entity = \"media_player.svc_int_trans\"\n        await rest.set_state(entity, \"idle\")\n>       await rest.call_service(\"media_player\", \"media_play\", {\"entity_id\": entity})\n\ntests/entity/test_service_interactions.py:123: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/media_player/media_play'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0007797251455485821, "outcome": "passed"}}, {"nodeid": "tests/entity/test_service_interactions.py::test_input_select_option", "lineno": 137, "outcome": "failed", "keywords": ["test_input_select_option", "test_service_interactions.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005232625175267458, "outcome": "passed"}, "call": {"duration": 0.006182139739394188, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/entity/test_service_interactions.py", "lineno": 146, "message": "AssertionError: assert 'A' == 'B'\n  \n  - B\n  + A"}, "traceback": [{"path": "tests/entity/test_service_interactions.py", "lineno": 146, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0030130>\n\n    async def test_input_select_option(rest):\n        \"\"\"input_select.select_option sets state to option.\"\"\"\n        await rest.set_state(\"input_select.svc_int_is\", \"A\")\n        await rest.call_service(\"input_select\", \"select_option\", {\n            \"entity_id\": \"input_select.svc_int_is\",\n            \"option\": \"B\",\n        })\n        state = await rest.get_state(\"input_select.svc_int_is\")\n>       assert state[\"state\"] == \"B\"\nE       AssertionError: assert 'A' == 'B'\nE         \nE         - B\nE         + A\n\ntests/entity/test_service_interactions.py:146: AssertionError"}, "teardown": {"duration": 0.000651251059025526, "outcome": "passed"}}, {"nodeid": "tests/entity/test_service_response_format.py::test_service_response_is_list", "lineno": 12, "outcome": "failed", "keywords": ["test_service_response_is_list", "test_service_response_format.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005100292153656483, "outcome": "passed"}, "call": {"duration": 0.004797216970473528, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/entity/test_service_response_format.py", "lineno": 21, "message": "assert 400 == 200\n +  where 400 = <Response [400 Bad Request]>.status_code"}, "traceback": [{"path": "tests/entity/test_service_response_format.py", "lineno": 21, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0bb9a30>\n\n    async def test_service_response_is_list(rest):\n        \"\"\"Service call response is a flat JSON array.\"\"\"\n        await rest.set_state(\"light.svc_resp_1\", \"off\")\n        resp = await rest.client.post(\n            f\"{rest.base_url}/api/services/light/turn_on\",\n            json={\"entity_id\": \"light.svc_resp_1\"},\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 400 == 200\nE        +  where 400 = <Response [400 Bad Request]>.status_code\n\ntests/entity/test_service_response_format.py:21: AssertionError"}, "teardown": {"duration": 0.0006164070218801498, "outcome": "passed"}}, {"nodeid": "tests/entity/test_service_response_format.py::test_service_response_changed_has_entity_id", "lineno": 25, "outcome": "failed", "keywords": ["test_service_response_changed_has_entity_id", "test_service_response_format.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005092942155897617, "outcome": "passed"}, "call": {"duration": 0.00410083495080471, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)"}, "traceback": [{"path": "tests/entity/test_service_response_format.py", "lineno": 34, "message": ""}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 832, "message": "in json"}, {"path": "../../anaconda3/lib/python3.9/json/__init__.py", "lineno": 346, "message": "in loads"}, {"path": "../../anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "JSONDecodeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b03b77c0>\n\n    async def test_service_response_changed_has_entity_id(rest):\n        \"\"\"Changed state entries have entity_id field.\"\"\"\n        await rest.set_state(\"light.svc_resp_2\", \"off\")\n        resp = await rest.client.post(\n            f\"{rest.base_url}/api/services/light/turn_on\",\n            json={\"entity_id\": \"light.svc_resp_2\"},\n            headers=rest._headers(),\n        )\n>       data = resp.json()\n\ntests/entity/test_service_response_format.py:34: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:832: in json\n    return jsonlib.loads(self.content, **kwargs)\n../../anaconda3/lib/python3.9/json/__init__.py:346: in loads\n    return _default_decoder.decode(s)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <json.decoder.JSONDecoder object at 0x7f47b2e5fe50>\ns = '400: Bad Request'\n_w = <built-in method match of re.Pattern object at 0x7f47b3015cf0>\n\n    def decode(self, s, _w=WHITESPACE.match):\n        \"\"\"Return the Python representation of ``s`` (a ``str`` instance\n        containing a JSON document).\n    \n        \"\"\"\n        obj, end = self.raw_decode(s, idx=_w(s, 0).end())\n        end = _w(s, end).end()\n        if end != len(s):\n>           raise JSONDecodeError(\"Extra data\", s, end)\nE           json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)\n\n../../anaconda3/lib/python3.9/json/decoder.py:340: JSONDecodeError"}, "teardown": {"duration": 0.0007723919115960598, "outcome": "passed"}}, {"nodeid": "tests/entity/test_service_response_format.py::test_service_response_changed_has_state", "lineno": 40, "outcome": "failed", "keywords": ["test_service_response_changed_has_state", "test_service_response_format.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005209088791161776, "outcome": "passed"}, "call": {"duration": 0.004265691619366407, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)"}, "traceback": [{"path": "tests/entity/test_service_response_format.py", "lineno": 49, "message": ""}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 832, "message": "in json"}, {"path": "../../anaconda3/lib/python3.9/json/__init__.py", "lineno": 346, "message": "in loads"}, {"path": "../../anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "JSONDecodeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b03acd30>\n\n    async def test_service_response_changed_has_state(rest):\n        \"\"\"Changed state entries have state field.\"\"\"\n        await rest.set_state(\"switch.svc_resp_3\", \"off\")\n        resp = await rest.client.post(\n            f\"{rest.base_url}/api/services/switch/turn_on\",\n            json={\"entity_id\": \"switch.svc_resp_3\"},\n            headers=rest._headers(),\n        )\n>       data = resp.json()\n\ntests/entity/test_service_response_format.py:49: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:832: in json\n    return jsonlib.loads(self.content, **kwargs)\n../../anaconda3/lib/python3.9/json/__init__.py:346: in loads\n    return _default_decoder.decode(s)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <json.decoder.JSONDecoder object at 0x7f47b2e5fe50>\ns = '400: Bad Request'\n_w = <built-in method match of re.Pattern object at 0x7f47b3015cf0>\n\n    def decode(self, s, _w=WHITESPACE.match):\n        \"\"\"Return the Python representation of ``s`` (a ``str`` instance\n        containing a JSON document).\n    \n        \"\"\"\n        obj, end = self.raw_decode(s, idx=_w(s, 0).end())\n        end = _w(s, end).end()\n        if end != len(s):\n>           raise JSONDecodeError(\"Extra data\", s, end)\nE           json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)\n\n../../anaconda3/lib/python3.9/json/decoder.py:340: JSONDecodeError"}, "teardown": {"duration": 0.0007450510747730732, "outcome": "passed"}}, {"nodeid": "tests/entity/test_service_response_format.py::test_service_response_changed_has_attributes", "lineno": 54, "outcome": "failed", "keywords": ["test_service_response_changed_has_attributes", "test_service_response_format.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005812154151499271, "outcome": "passed"}, "call": {"duration": 0.004943918902426958, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)"}, "traceback": [{"path": "tests/entity/test_service_response_format.py", "lineno": 63, "message": ""}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 832, "message": "in json"}, {"path": "../../anaconda3/lib/python3.9/json/__init__.py", "lineno": 346, "message": "in loads"}, {"path": "../../anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "JSONDecodeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b21cc970>\n\n    async def test_service_response_changed_has_attributes(rest):\n        \"\"\"Changed state entries have attributes field.\"\"\"\n        await rest.set_state(\"light.svc_resp_4\", \"off\")\n        resp = await rest.client.post(\n            f\"{rest.base_url}/api/services/light/turn_on\",\n            json={\"entity_id\": \"light.svc_resp_4\", \"brightness\": 128},\n            headers=rest._headers(),\n        )\n>       data = resp.json()\n\ntests/entity/test_service_response_format.py:63: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:832: in json\n    return jsonlib.loads(self.content, **kwargs)\n../../anaconda3/lib/python3.9/json/__init__.py:346: in loads\n    return _default_decoder.decode(s)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <json.decoder.JSONDecoder object at 0x7f47b2e5fe50>\ns = '400: Bad Request'\n_w = <built-in method match of re.Pattern object at 0x7f47b3015cf0>\n\n    def decode(self, s, _w=WHITESPACE.match):\n        \"\"\"Return the Python representation of ``s`` (a ``str`` instance\n        containing a JSON document).\n    \n        \"\"\"\n        obj, end = self.raw_decode(s, idx=_w(s, 0).end())\n        end = _w(s, end).end()\n        if end != len(s):\n>           raise JSONDecodeError(\"Extra data\", s, end)\nE           json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)\n\n../../anaconda3/lib/python3.9/json/decoder.py:340: JSONDecodeError"}, "teardown": {"duration": 0.0006736321374773979, "outcome": "passed"}}, {"nodeid": "tests/entity/test_service_response_format.py::test_service_response_changed_has_timestamps", "lineno": 67, "outcome": "failed", "keywords": ["test_service_response_changed_has_timestamps", "test_service_response_format.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005388076417148113, "outcome": "passed"}, "call": {"duration": 0.004034870769828558, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)"}, "traceback": [{"path": "tests/entity/test_service_response_format.py", "lineno": 76, "message": ""}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 832, "message": "in json"}, {"path": "../../anaconda3/lib/python3.9/json/__init__.py", "lineno": 346, "message": "in loads"}, {"path": "../../anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "JSONDecodeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47ab58bfa0>\n\n    async def test_service_response_changed_has_timestamps(rest):\n        \"\"\"Changed state entries have timestamp fields.\"\"\"\n        await rest.set_state(\"light.svc_resp_5\", \"off\")\n        resp = await rest.client.post(\n            f\"{rest.base_url}/api/services/light/turn_on\",\n            json={\"entity_id\": \"light.svc_resp_5\"},\n            headers=rest._headers(),\n        )\n>       data = resp.json()\n\ntests/entity/test_service_response_format.py:76: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:832: in json\n    return jsonlib.loads(self.content, **kwargs)\n../../anaconda3/lib/python3.9/json/__init__.py:346: in loads\n    return _default_decoder.decode(s)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <json.decoder.JSONDecoder object at 0x7f47b2e5fe50>\ns = '400: Bad Request'\n_w = <built-in method match of re.Pattern object at 0x7f47b3015cf0>\n\n    def decode(self, s, _w=WHITESPACE.match):\n        \"\"\"Return the Python representation of ``s`` (a ``str`` instance\n        containing a JSON document).\n    \n        \"\"\"\n        obj, end = self.raw_decode(s, idx=_w(s, 0).end())\n        end = _w(s, end).end()\n        if end != len(s):\n>           raise JSONDecodeError(\"Extra data\", s, end)\nE           json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)\n\n../../anaconda3/lib/python3.9/json/decoder.py:340: JSONDecodeError"}, "teardown": {"duration": 0.000655770767480135, "outcome": "passed"}}, {"nodeid": "tests/entity/test_service_response_format.py::test_service_response_changed_has_context", "lineno": 81, "outcome": "failed", "keywords": ["test_service_response_changed_has_context", "test_service_response_format.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005310958717018366, "outcome": "passed"}, "call": {"duration": 0.0039046183228492737, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)"}, "traceback": [{"path": "tests/entity/test_service_response_format.py", "lineno": 90, "message": ""}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 832, "message": "in json"}, {"path": "../../anaconda3/lib/python3.9/json/__init__.py", "lineno": 346, "message": "in loads"}, {"path": "../../anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "JSONDecodeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b00a0c70>\n\n    async def test_service_response_changed_has_context(rest):\n        \"\"\"Changed state entries have context field.\"\"\"\n        await rest.set_state(\"light.svc_resp_6\", \"off\")\n        resp = await rest.client.post(\n            f\"{rest.base_url}/api/services/light/turn_on\",\n            json={\"entity_id\": \"light.svc_resp_6\"},\n            headers=rest._headers(),\n        )\n>       data = resp.json()\n\ntests/entity/test_service_response_format.py:90: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:832: in json\n    return jsonlib.loads(self.content, **kwargs)\n../../anaconda3/lib/python3.9/json/__init__.py:346: in loads\n    return _default_decoder.decode(s)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <json.decoder.JSONDecoder object at 0x7f47b2e5fe50>\ns = '400: Bad Request'\n_w = <built-in method match of re.Pattern object at 0x7f47b3015cf0>\n\n    def decode(self, s, _w=WHITESPACE.match):\n        \"\"\"Return the Python representation of ``s`` (a ``str`` instance\n        containing a JSON document).\n    \n        \"\"\"\n        obj, end = self.raw_decode(s, idx=_w(s, 0).end())\n        end = _w(s, end).end()\n        if end != len(s):\n>           raise JSONDecodeError(\"Extra data\", s, end)\nE           json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)\n\n../../anaconda3/lib/python3.9/json/decoder.py:340: JSONDecodeError"}, "teardown": {"duration": 0.0006755618378520012, "outcome": "passed"}}, {"nodeid": "tests/entity/test_service_response_format.py::test_toggle_returns_changed_state", "lineno": 95, "outcome": "failed", "keywords": ["test_toggle_returns_changed_state", "test_service_response_format.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.00532752787694335, "outcome": "passed"}, "call": {"duration": 0.00394915696233511, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)"}, "traceback": [{"path": "tests/entity/test_service_response_format.py", "lineno": 104, "message": ""}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 832, "message": "in json"}, {"path": "../../anaconda3/lib/python3.9/json/__init__.py", "lineno": 346, "message": "in loads"}, {"path": "../../anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "JSONDecodeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b22718b0>\n\n    async def test_toggle_returns_changed_state(rest):\n        \"\"\"Toggle service returns the changed state.\"\"\"\n        await rest.set_state(\"switch.svc_resp_tog\", \"on\")\n        resp = await rest.client.post(\n            f\"{rest.base_url}/api/services/switch/toggle\",\n            json={\"entity_id\": \"switch.svc_resp_tog\"},\n            headers=rest._headers(),\n        )\n>       data = resp.json()\n\ntests/entity/test_service_response_format.py:104: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:832: in json\n    return jsonlib.loads(self.content, **kwargs)\n../../anaconda3/lib/python3.9/json/__init__.py:346: in loads\n    return _default_decoder.decode(s)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <json.decoder.JSONDecoder object at 0x7f47b2e5fe50>\ns = '400: Bad Request'\n_w = <built-in method match of re.Pattern object at 0x7f47b3015cf0>\n\n    def decode(self, s, _w=WHITESPACE.match):\n        \"\"\"Return the Python representation of ``s`` (a ``str`` instance\n        containing a JSON document).\n    \n        \"\"\"\n        obj, end = self.raw_decode(s, idx=_w(s, 0).end())\n        end = _w(s, end).end()\n        if end != len(s):\n>           raise JSONDecodeError(\"Extra data\", s, end)\nE           json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)\n\n../../anaconda3/lib/python3.9/json/decoder.py:340: JSONDecodeError"}, "teardown": {"duration": 0.0006502126343548298, "outcome": "passed"}}, {"nodeid": "tests/entity/test_service_response_format.py::test_turn_off_returns_changed_state", "lineno": 108, "outcome": "failed", "keywords": ["test_turn_off_returns_changed_state", "test_service_response_format.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005300611257553101, "outcome": "passed"}, "call": {"duration": 0.0039146048948168755, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)"}, "traceback": [{"path": "tests/entity/test_service_response_format.py", "lineno": 117, "message": ""}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 832, "message": "in json"}, {"path": "../../anaconda3/lib/python3.9/json/__init__.py", "lineno": 346, "message": "in loads"}, {"path": "../../anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "JSONDecodeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b2284610>\n\n    async def test_turn_off_returns_changed_state(rest):\n        \"\"\"Turn off service returns the changed state.\"\"\"\n        await rest.set_state(\"light.svc_resp_off\", \"on\")\n        resp = await rest.client.post(\n            f\"{rest.base_url}/api/services/light/turn_off\",\n            json={\"entity_id\": \"light.svc_resp_off\"},\n            headers=rest._headers(),\n        )\n>       data = resp.json()\n\ntests/entity/test_service_response_format.py:117: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:832: in json\n    return jsonlib.loads(self.content, **kwargs)\n../../anaconda3/lib/python3.9/json/__init__.py:346: in loads\n    return _default_decoder.decode(s)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <json.decoder.JSONDecoder object at 0x7f47b2e5fe50>\ns = '400: Bad Request'\n_w = <built-in method match of re.Pattern object at 0x7f47b3015cf0>\n\n    def decode(self, s, _w=WHITESPACE.match):\n        \"\"\"Return the Python representation of ``s`` (a ``str`` instance\n        containing a JSON document).\n    \n        \"\"\"\n        obj, end = self.raw_decode(s, idx=_w(s, 0).end())\n        end = _w(s, end).end()\n        if end != len(s):\n>           raise JSONDecodeError(\"Extra data\", s, end)\nE           json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)\n\n../../anaconda3/lib/python3.9/json/decoder.py:340: JSONDecodeError"}, "teardown": {"duration": 0.000731911975890398, "outcome": "passed"}}, {"nodeid": "tests/entity/test_service_response_format.py::test_climate_service_returns_changed", "lineno": 121, "outcome": "failed", "keywords": ["test_climate_service_returns_changed", "test_service_response_format.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.00505799101665616, "outcome": "passed"}, "call": {"duration": 0.00389926228672266, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)"}, "traceback": [{"path": "tests/entity/test_service_response_format.py", "lineno": 130, "message": ""}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 832, "message": "in json"}, {"path": "../../anaconda3/lib/python3.9/json/__init__.py", "lineno": 346, "message": "in loads"}, {"path": "../../anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "JSONDecodeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b04a0d00>\n\n    async def test_climate_service_returns_changed(rest):\n        \"\"\"Climate service returns changed state with attributes.\"\"\"\n        await rest.set_state(\"climate.svc_resp_clim\", \"off\")\n        resp = await rest.client.post(\n            f\"{rest.base_url}/api/services/climate/set_temperature\",\n            json={\"entity_id\": \"climate.svc_resp_clim\", \"temperature\": 72},\n            headers=rest._headers(),\n        )\n>       data = resp.json()\n\ntests/entity/test_service_response_format.py:130: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:832: in json\n    return jsonlib.loads(self.content, **kwargs)\n../../anaconda3/lib/python3.9/json/__init__.py:346: in loads\n    return _default_decoder.decode(s)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <json.decoder.JSONDecoder object at 0x7f47b2e5fe50>\ns = '400: Bad Request'\n_w = <built-in method match of re.Pattern object at 0x7f47b3015cf0>\n\n    def decode(self, s, _w=WHITESPACE.match):\n        \"\"\"Return the Python representation of ``s`` (a ``str`` instance\n        containing a JSON document).\n    \n        \"\"\"\n        obj, end = self.raw_decode(s, idx=_w(s, 0).end())\n        end = _w(s, end).end()\n        if end != len(s):\n>           raise JSONDecodeError(\"Extra data\", s, end)\nE           json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)\n\n../../anaconda3/lib/python3.9/json/decoder.py:340: JSONDecodeError"}, "teardown": {"duration": 0.0008024098351597786, "outcome": "passed"}}, {"nodeid": "tests/entity/test_service_response_format.py::test_lock_service_returns_changed", "lineno": 136, "outcome": "failed", "keywords": ["test_lock_service_returns_changed", "test_service_response_format.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.006083614658564329, "outcome": "passed"}, "call": {"duration": 0.005635750945657492, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)"}, "traceback": [{"path": "tests/entity/test_service_response_format.py", "lineno": 145, "message": ""}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 832, "message": "in json"}, {"path": "../../anaconda3/lib/python3.9/json/__init__.py", "lineno": 346, "message": "in loads"}, {"path": "../../anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "JSONDecodeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0bf1670>\n\n    async def test_lock_service_returns_changed(rest):\n        \"\"\"Lock service returns changed state.\"\"\"\n        await rest.set_state(\"lock.svc_resp_lock\", \"unlocked\")\n        resp = await rest.client.post(\n            f\"{rest.base_url}/api/services/lock/lock\",\n            json={\"entity_id\": \"lock.svc_resp_lock\"},\n            headers=rest._headers(),\n        )\n>       data = resp.json()\n\ntests/entity/test_service_response_format.py:145: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:832: in json\n    return jsonlib.loads(self.content, **kwargs)\n../../anaconda3/lib/python3.9/json/__init__.py:346: in loads\n    return _default_decoder.decode(s)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <json.decoder.JSONDecoder object at 0x7f47b2e5fe50>\ns = '400: Bad Request'\n_w = <built-in method match of re.Pattern object at 0x7f47b3015cf0>\n\n    def decode(self, s, _w=WHITESPACE.match):\n        \"\"\"Return the Python representation of ``s`` (a ``str`` instance\n        containing a JSON document).\n    \n        \"\"\"\n        obj, end = self.raw_decode(s, idx=_w(s, 0).end())\n        end = _w(s, end).end()\n        if end != len(s):\n>           raise JSONDecodeError(\"Extra data\", s, end)\nE           json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)\n\n../../anaconda3/lib/python3.9/json/decoder.py:340: JSONDecodeError"}, "teardown": {"duration": 0.0006362749263644218, "outcome": "passed"}}, {"nodeid": "tests/entity/test_siren_valve.py::test_siren_turn_on", "lineno": 15, "outcome": "failed", "keywords": ["test_siren_turn_on", "test_siren_valve.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005501970183104277, "outcome": "passed"}, "call": {"duration": 0.004015505313873291, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/siren/turn_on'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_siren_valve.py", "lineno": 20, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b2231370>\n\n    async def test_siren_turn_on(rest):\n        \"\"\"siren.turn_on sets state to 'on'.\"\"\"\n        entity_id = \"siren.test_on\"\n        await rest.set_state(entity_id, \"off\")\n>       await rest.call_service(\"siren\", \"turn_on\", {\"entity_id\": entity_id})\n\ntests/entity/test_siren_valve.py:20: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/siren/turn_on'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0006731580942869186, "outcome": "passed"}}, {"nodeid": "tests/entity/test_siren_valve.py::test_siren_turn_off", "lineno": 25, "outcome": "failed", "keywords": ["test_siren_turn_off", "test_siren_valve.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005536478944122791, "outcome": "passed"}, "call": {"duration": 0.003922161180526018, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/siren/turn_off'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_siren_valve.py", "lineno": 30, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47ab6ff580>\n\n    async def test_siren_turn_off(rest):\n        \"\"\"siren.turn_off sets state to 'off'.\"\"\"\n        entity_id = \"siren.test_off\"\n        await rest.set_state(entity_id, \"on\")\n>       await rest.call_service(\"siren\", \"turn_off\", {\"entity_id\": entity_id})\n\ntests/entity/test_siren_valve.py:30: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/siren/turn_off'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0006577251479029655, "outcome": "passed"}}, {"nodeid": "tests/entity/test_siren_valve.py::test_siren_toggle", "lineno": 35, "outcome": "failed", "keywords": ["test_siren_toggle", "test_siren_valve.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005222479347139597, "outcome": "passed"}, "call": {"duration": 0.005079095717519522, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/siren/toggle'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_siren_valve.py", "lineno": 40, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0355820>\n\n    async def test_siren_toggle(rest):\n        \"\"\"siren.toggle flips state.\"\"\"\n        entity_id = \"siren.test_toggle\"\n        await rest.set_state(entity_id, \"off\")\n>       await rest.call_service(\"siren\", \"toggle\", {\"entity_id\": entity_id})\n\ntests/entity/test_siren_valve.py:40: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/siren/toggle'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0007889452390372753, "outcome": "passed"}}, {"nodeid": "tests/entity/test_siren_valve.py::test_valve_open", "lineno": 51, "outcome": "failed", "keywords": ["test_valve_open", "test_siren_valve.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005504165310412645, "outcome": "passed"}, "call": {"duration": 0.004561601206660271, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/valve/open_valve'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_siren_valve.py", "lineno": 56, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47ab6e97f0>\n\n    async def test_valve_open(rest):\n        \"\"\"valve.open_valve sets state to 'open'.\"\"\"\n        entity_id = \"valve.test_open\"\n        await rest.set_state(entity_id, \"closed\")\n>       await rest.call_service(\"valve\", \"open_valve\", {\"entity_id\": entity_id})\n\ntests/entity/test_siren_valve.py:56: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/valve/open_valve'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0006679808720946312, "outcome": "passed"}}, {"nodeid": "tests/entity/test_siren_valve.py::test_valve_close", "lineno": 61, "outcome": "failed", "keywords": ["test_valve_close", "test_siren_valve.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.0051932563073933125, "outcome": "passed"}, "call": {"duration": 0.0038211741484701633, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/valve/close_valve'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_siren_valve.py", "lineno": 66, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b03d2ca0>\n\n    async def test_valve_close(rest):\n        \"\"\"valve.close_valve sets state to 'closed'.\"\"\"\n        entity_id = \"valve.test_close\"\n        await rest.set_state(entity_id, \"open\")\n>       await rest.call_service(\"valve\", \"close_valve\", {\"entity_id\": entity_id})\n\ntests/entity/test_siren_valve.py:66: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/valve/close_valve'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.000646042637526989, "outcome": "passed"}}, {"nodeid": "tests/entity/test_siren_valve.py::test_valve_toggle", "lineno": 71, "outcome": "failed", "keywords": ["test_valve_toggle", "test_siren_valve.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005819946061819792, "outcome": "passed"}, "call": {"duration": 0.004331668373197317, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/valve/toggle'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_siren_valve.py", "lineno": 76, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47ab5b0c10>\n\n    async def test_valve_toggle(rest):\n        \"\"\"valve.toggle flips state.\"\"\"\n        entity_id = \"valve.test_toggle\"\n        await rest.set_state(entity_id, \"open\")\n>       await rest.call_service(\"valve\", \"toggle\", {\"entity_id\": entity_id})\n\ntests/entity/test_siren_valve.py:76: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/valve/toggle'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0006645522080361843, "outcome": "passed"}}, {"nodeid": "tests/entity/test_siren_valve.py::test_alarm_lifecycle", "lineno": 87, "outcome": "failed", "keywords": ["test_alarm_lifecycle", "test_siren_valve.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005446299910545349, "outcome": "passed"}, "call": {"duration": 0.006132891867309809, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/entity/test_siren_valve.py", "lineno": 107, "message": "AssertionError: After arm_home: expected armed_home\nassert 'disarmed' == 'armed_home'\n  \n  - armed_home\n  + disarmed"}, "traceback": [{"path": "tests/entity/test_siren_valve.py", "lineno": 107, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0393220>\n\n    async def test_alarm_lifecycle(rest):\n        \"\"\"Alarm full lifecycle: disarmed -> armed_home -> triggered -> disarmed.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"alarm_control_panel.alc_{tag}\"\n        await rest.set_state(eid, \"disarmed\")\n    \n        for service, expected in [\n            (\"arm_home\", \"armed_home\"),\n            (\"trigger\", \"triggered\"),\n            (\"disarm\", \"disarmed\"),\n            (\"arm_away\", \"armed_away\"),\n            (\"disarm\", \"disarmed\"),\n        ]:\n            await rest.client.post(\n                f\"{rest.base_url}/api/services/alarm_control_panel/{service}\",\n                json={\"entity_id\": eid},\n                headers=rest._headers(),\n            )\n            state = await rest.get_state(eid)\n>           assert state[\"state\"] == expected, f\"After {service}: expected {expected}\"\nE           AssertionError: After arm_home: expected armed_home\nE           assert 'disarmed' == 'armed_home'\nE             \nE             - armed_home\nE             + disarmed\n\ntests/entity/test_siren_valve.py:107: AssertionError"}, "teardown": {"duration": 0.0006023538298904896, "outcome": "passed"}}, {"nodeid": "tests/entity/test_state_edge_cases.py::test_state_with_spaces", "lineno": 18, "outcome": "passed", "keywords": ["test_state_with_spaces", "test_state_edge_cases.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.00541903218254447, "outcome": "passed"}, "call": {"duration": 0.004733433946967125, "outcome": "passed"}, "teardown": {"duration": 0.0005993754602968693, "outcome": "passed"}}, {"nodeid": "tests/entity/test_state_edge_cases.py::test_state_with_unicode", "lineno": 25, "outcome": "passed", "keywords": ["test_state_with_unicode", "test_state_edge_cases.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.00556786498054862, "outcome": "passed"}, "call": {"duration": 0.0037775137461721897, "outcome": "passed"}, "teardown": {"duration": 0.0004486897960305214, "outcome": "passed"}}, {"nodeid": "tests/entity/test_state_edge_cases.py::test_state_with_empty_string", "lineno": 32, "outcome": "passed", "keywords": ["test_state_with_empty_string", "test_state_edge_cases.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005668056663125753, "outcome": "passed"}, "call": {"duration": 0.005595081020146608, "outcome": "passed"}, "teardown": {"duration": 0.0004699132405221462, "outcome": "passed"}}, {"nodeid": "tests/entity/test_state_edge_cases.py::test_state_long_value", "lineno": 39, "outcome": "failed", "keywords": ["test_state_long_value", "test_state_edge_cases.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005187053233385086, "outcome": "passed"}, "call": {"duration": 0.0026497389189898968, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/states/sensor.edge_long'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_state_edge_cases.py", "lineno": 43, "message": ""}, {"path": "tests/conftest.py", "lineno": 94, "message": "in set_state"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47ab58b9d0>\n\n    async def test_state_long_value(rest):\n        \"\"\"Entity state handles long strings.\"\"\"\n        long_val = \"x\" * 1000\n>       await rest.set_state(\"sensor.edge_long\", long_val)\n\ntests/entity/test_state_edge_cases.py:43: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:94: in set_state\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/states/sensor.edge_long'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0007155048660933971, "outcome": "passed"}}, {"nodeid": "tests/entity/test_state_edge_cases.py::test_attributes_preserve_types", "lineno": 49, "outcome": "passed", "keywords": ["test_attributes_preserve_types", "test_state_edge_cases.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005788619630038738, "outcome": "passed"}, "call": {"duration": 0.00373396510258317, "outcome": "passed"}, "teardown": {"duration": 0.00045971712097525597, "outcome": "passed"}}, {"nodeid": "tests/entity/test_state_edge_cases.py::test_attributes_nested_object", "lineno": 69, "outcome": "passed", "keywords": ["test_attributes_nested_object", "test_state_edge_cases.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005468477960675955, "outcome": "passed"}, "call": {"duration": 0.004065348766744137, "outcome": "passed"}, "teardown": {"duration": 0.0006372621282935143, "outcome": "passed"}}, {"nodeid": "tests/entity/test_state_edge_cases.py::test_attributes_overwrite_on_update", "lineno": 77, "outcome": "passed", "keywords": ["test_attributes_overwrite_on_update", "test_state_edge_cases.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005714355036616325, "outcome": "passed"}, "call": {"duration": 0.007225818000733852, "outcome": "passed"}, "teardown": {"duration": 0.00048341182991862297, "outcome": "passed"}}, {"nodeid": "tests/entity/test_state_edge_cases.py::test_state_has_last_changed", "lineno": 90, "outcome": "passed", "keywords": ["test_state_has_last_changed", "test_state_edge_cases.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005718054715543985, "outcome": "passed"}, "call": {"duration": 0.004501132760196924, "outcome": "passed"}, "teardown": {"duration": 0.0005598790012300014, "outcome": "passed"}}, {"nodeid": "tests/entity/test_state_edge_cases.py::test_state_has_last_updated", "lineno": 98, "outcome": "passed", "keywords": ["test_state_has_last_updated", "test_state_edge_cases.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005397303961217403, "outcome": "passed"}, "call": {"duration": 0.005162159912288189, "outcome": "passed"}, "teardown": {"duration": 0.0006947931833565235, "outcome": "passed"}}, {"nodeid": "tests/entity/test_state_edge_cases.py::test_timestamps_update_on_change", "lineno": 105, "outcome": "passed", "keywords": ["test_timestamps_update_on_change", "test_state_edge_cases.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.0055141448974609375, "outcome": "passed"}, "call": {"duration": 0.060483439825475216, "outcome": "passed"}, "teardown": {"duration": 0.0007080845534801483, "outcome": "passed"}}, {"nodeid": "tests/entity/test_state_edge_cases.py::test_concurrent_state_updates", "lineno": 117, "outcome": "passed", "keywords": ["test_concurrent_state_updates", "test_state_edge_cases.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.008910653181374073, "outcome": "passed"}, "call": {"duration": 0.03634569002315402, "outcome": "passed"}, "teardown": {"duration": 0.0008819191716611385, "outcome": "passed"}}, {"nodeid": "tests/entity/test_state_edge_cases.py::test_entity_id_with_numbers", "lineno": 132, "outcome": "passed", "keywords": ["test_entity_id_with_numbers", "test_state_edge_cases.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005593308713287115, "outcome": "passed"}, "call": {"duration": 0.005669124890118837, "outcome": "passed"}, "teardown": {"duration": 0.0006648590788245201, "outcome": "passed"}}, {"nodeid": "tests/entity/test_state_edge_cases.py::test_entity_id_with_underscores", "lineno": 139, "outcome": "passed", "keywords": ["test_entity_id_with_underscores", "test_state_edge_cases.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.00924851419404149, "outcome": "passed"}, "call": {"duration": 0.005210462026298046, "outcome": "passed"}, "teardown": {"duration": 0.0006715999916195869, "outcome": "passed"}}, {"nodeid": "tests/entity/test_state_edge_cases.py::test_states_returns_all_entities", "lineno": 148, "outcome": "passed", "keywords": ["test_states_returns_all_entities", "test_state_edge_cases.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.009469932410866022, "outcome": "passed"}, "call": {"duration": 0.008542225696146488, "outcome": "passed"}, "teardown": {"duration": 0.0005088397301733494, "outcome": "passed"}}, {"nodeid": "tests/entity/test_state_edge_cases.py::test_states_entity_format", "lineno": 157, "outcome": "passed", "keywords": ["test_states_entity_format", "test_state_edge_cases.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005333799868822098, "outcome": "passed"}, "call": {"duration": 0.004103011917322874, "outcome": "passed"}, "teardown": {"duration": 0.0005090744234621525, "outcome": "passed"}}, {"nodeid": "tests/entity/test_state_edge_cases.py::test_set_state_returns_entity", "lineno": 170, "outcome": "passed", "keywords": ["test_set_state_returns_entity", "test_state_edge_cases.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005288406740874052, "outcome": "passed"}, "call": {"duration": 0.0025408179499208927, "outcome": "passed"}, "teardown": {"duration": 0.0004490260034799576, "outcome": "passed"}}, {"nodeid": "tests/entity/test_stub_services.py::test_script_turn_on", "lineno": 15, "outcome": "passed", "keywords": ["test_script_turn_on", "test_stub_services.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005208112765103579, "outcome": "passed"}, "call": {"duration": 0.003077329136431217, "outcome": "passed"}, "teardown": {"duration": 0.00047604506835341454, "outcome": "passed"}}, {"nodeid": "tests/entity/test_stub_services.py::test_script_reload", "lineno": 25, "outcome": "passed", "keywords": ["test_script_reload", "test_stub_services.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.0050727371126413345, "outcome": "passed"}, "call": {"duration": 0.009051308035850525, "outcome": "passed"}, "teardown": {"duration": 0.0005864179693162441, "outcome": "passed"}}, {"nodeid": "tests/entity/test_stub_services.py::test_notify_send_message", "lineno": 37, "outcome": "failed", "keywords": ["test_notify_send_message", "test_stub_services.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005168210715055466, "outcome": "passed"}, "call": {"duration": 0.002799245063215494, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/entity/test_stub_services.py", "lineno": 45, "message": "assert 400 == 200\n +  where 400 = <Response [400 Bad Request]>.status_code"}, "traceback": [{"path": "tests/entity/test_stub_services.py", "lineno": 45, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0393790>\n\n    async def test_notify_send_message(rest):\n        \"\"\"notify.send_message returns 200 (stub).\"\"\"\n        resp = await rest.client.post(\n            f\"{rest.base_url}/api/services/notify/send_message\",\n            json={\"message\": \"Hello from CTS\"},\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 400 == 200\nE        +  where 400 = <Response [400 Bad Request]>.status_code\n\ntests/entity/test_stub_services.py:45: AssertionError"}, "teardown": {"duration": 0.0005655069835484028, "outcome": "passed"}}, {"nodeid": "tests/entity/test_stub_services.py::test_weather_get_forecasts", "lineno": 49, "outcome": "failed", "keywords": ["test_weather_get_forecasts", "test_stub_services.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005390079226344824, "outcome": "passed"}, "call": {"duration": 0.0027738483622670174, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/entity/test_stub_services.py", "lineno": 57, "message": "assert 400 == 200\n +  where 400 = <Response [400 Bad Request]>.status_code"}, "traceback": [{"path": "tests/entity/test_stub_services.py", "lineno": 57, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47ab706700>\n\n    async def test_weather_get_forecasts(rest):\n        \"\"\"weather.get_forecasts returns 200 (stub).\"\"\"\n        resp = await rest.client.post(\n            f\"{rest.base_url}/api/services/weather/get_forecasts\",\n            json={\"entity_id\": \"weather.home\"},\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 400 == 200\nE        +  where 400 = <Response [400 Bad Request]>.status_code\n\ntests/entity/test_stub_services.py:57: AssertionError"}, "teardown": {"duration": 0.0006183651275932789, "outcome": "passed"}}, {"nodeid": "tests/entity/test_stub_services.py::test_image_reload", "lineno": 61, "outcome": "failed", "keywords": ["test_image_reload", "test_stub_services.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.0056749447248876095, "outcome": "passed"}, "call": {"duration": 0.002835584804415703, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/entity/test_stub_services.py", "lineno": 69, "message": "assert 400 == 200\n +  where 400 = <Response [400 Bad Request]>.status_code"}, "traceback": [{"path": "tests/entity/test_stub_services.py", "lineno": 69, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b00965e0>\n\n    async def test_image_reload(rest):\n        \"\"\"image.reload returns 200 (stub).\"\"\"\n        resp = await rest.client.post(\n            f\"{rest.base_url}/api/services/image/reload\",\n            json={},\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 400 == 200\nE        +  where 400 = <Response [400 Bad Request]>.status_code\n\ntests/entity/test_stub_services.py:69: AssertionError"}, "teardown": {"duration": 0.0004945010878145695, "outcome": "passed"}}, {"nodeid": "tests/entity/test_stub_services.py::test_person_reload", "lineno": 73, "outcome": "passed", "keywords": ["test_person_reload", "test_stub_services.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005279205739498138, "outcome": "passed"}, "call": {"duration": 0.0068079219199717045, "outcome": "passed"}, "teardown": {"duration": 0.0005216691642999649, "outcome": "passed"}}, {"nodeid": "tests/entity/test_stub_services.py::test_zone_reload", "lineno": 83, "outcome": "passed", "keywords": ["test_zone_reload", "test_stub_services.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.0052325669676065445, "outcome": "passed"}, "call": {"duration": 0.006928536109626293, "outcome": "passed"}, "teardown": {"duration": 0.0005301516503095627, "outcome": "passed"}}, {"nodeid": "tests/entity/test_stub_services.py::test_homeassistant_restart", "lineno": 95, "outcome": "passed", "keywords": ["test_homeassistant_restart", "test_stub_services.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005239800084382296, "outcome": "passed"}, "call": {"duration": 0.010458399076014757, "outcome": "passed"}, "teardown": {"duration": 0.000457090325653553, "outcome": "passed"}}, {"nodeid": "tests/entity/test_stub_services.py::test_homeassistant_stop", "lineno": 105, "outcome": "failed", "keywords": ["test_homeassistant_stop", "test_stub_services.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005131373647600412, "outcome": "passed"}, "call": {"duration": 0.004443174693733454, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py", "lineno": 118, "message": "httpx.ReadError"}, "traceback": [{"path": "tests/entity/test_stub_services.py", "lineno": 108, "message": ""}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1859, "message": "in post"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1540, "message": "in request"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1629, "message": "in send"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1657, "message": "in _send_handling_auth"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1694, "message": "in _send_handling_redirects"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1730, "message": "in _send_single_request"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py", "lineno": 394, "message": "in handle_async_request"}, {"path": "../../anaconda3/lib/python3.9/contextlib.py", "lineno": 137, "message": "in __exit__"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py", "lineno": 118, "message": "ReadError"}], "longrepr": "@contextlib.contextmanager\n    def map_httpcore_exceptions() -> typing.Iterator[None]:\n        global HTTPCORE_EXC_MAP\n        if len(HTTPCORE_EXC_MAP) == 0:\n            HTTPCORE_EXC_MAP = _load_httpcore_exceptions()\n        try:\n>           yield\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:101: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:394: in handle_async_request\n    resp = await self._pool.handle_async_request(req)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/connection_pool.py:256: in handle_async_request\n    raise exc from None\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/connection_pool.py:236: in handle_async_request\n    response = await connection.handle_async_request(\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/connection.py:103: in handle_async_request\n    return await self._connection.handle_async_request(request)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:136: in handle_async_request\n    raise exc\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:106: in handle_async_request\n    ) = await self._receive_response_headers(**kwargs)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:177: in _receive_response_headers\n    event = await self._receive_event(timeout=timeout)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:217: in _receive_event\n    data = await self._network_stream.read(\n../../anaconda3/lib/python3.9/site-packages/httpcore/_backends/anyio.py:37: in read\n    return b\"\"\n../../anaconda3/lib/python3.9/contextlib.py:137: in __exit__\n    self.gen.throw(typ, value, traceback)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nmap = {<class 'TimeoutError'>: <class 'httpcore.ReadTimeout'>, <class 'anyio.BrokenResourceError'>: <class 'httpcore.ReadErr... 'anyio.ClosedResourceError'>: <class 'httpcore.ReadError'>, <class 'anyio.EndOfStream'>: <class 'httpcore.ReadError'>}\n\n    @contextlib.contextmanager\n    def map_exceptions(map: ExceptionMapping) -> typing.Iterator[None]:\n        try:\n            yield\n        except Exception as exc:  # noqa: PIE786\n            for from_exc, to_exc in map.items():\n                if isinstance(exc, from_exc):\n>                   raise to_exc(exc) from exc\nE                   httpcore.ReadError\n\n../../anaconda3/lib/python3.9/site-packages/httpcore/_exceptions.py:14: ReadError\n\nThe above exception was the direct cause of the following exception:\n\nrest = <conftest.RESTClient object at 0x7f47b0470fd0>\n\n    async def test_homeassistant_stop(rest):\n        \"\"\"homeassistant.stop returns 200 (stub).\"\"\"\n>       resp = await rest.client.post(\n            f\"{rest.base_url}/api/services/homeassistant/stop\",\n            json={},\n            headers=rest._headers(),\n        )\n\ntests/entity/test_stub_services.py:108: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1859: in post\n    return await self.request(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1540: in request\n    return await self.send(request, auth=auth, follow_redirects=follow_redirects)\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1629: in send\n    response = await self._send_handling_auth(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1657: in _send_handling_auth\n    response = await self._send_handling_redirects(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1694: in _send_handling_redirects\n    response = await self._send_single_request(request)\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1730: in _send_single_request\n    response = await transport.handle_async_request(request)\n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:394: in handle_async_request\n    resp = await self._pool.handle_async_request(req)\n../../anaconda3/lib/python3.9/contextlib.py:137: in __exit__\n    self.gen.throw(typ, value, traceback)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\n    @contextlib.contextmanager\n    def map_httpcore_exceptions() -> typing.Iterator[None]:\n        global HTTPCORE_EXC_MAP\n        if len(HTTPCORE_EXC_MAP) == 0:\n            HTTPCORE_EXC_MAP = _load_httpcore_exceptions()\n        try:\n            yield\n        except Exception as exc:\n            mapped_exc = None\n    \n            for from_exc, to_exc in HTTPCORE_EXC_MAP.items():\n                if not isinstance(exc, from_exc):\n                    continue\n                # We want to map to the most specific exception we can find.\n                # Eg if `exc` is an `httpcore.ReadTimeout`, we want to map to\n                # `httpx.ReadTimeout`, not just `httpx.TimeoutException`.\n                if mapped_exc is None or issubclass(to_exc, mapped_exc):\n                    mapped_exc = to_exc\n    \n            if mapped_exc is None:  # pragma: no cover\n                raise\n    \n            message = str(exc)\n>           raise mapped_exc(message) from exc\nE           httpx.ReadError\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:118: ReadError"}, "teardown": {"duration": 0.0006277188658714294, "outcome": "passed"}}, {"nodeid": "tests/entity/test_stub_services.py::test_homeassistant_reload_core_config", "lineno": 115, "outcome": "failed", "keywords": ["test_homeassistant_reload_core_config", "test_stub_services.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005660539027303457, "outcome": "passed"}, "call": {"duration": 0.0023521119728684425, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py", "lineno": 118, "message": "httpx.ReadError"}, "traceback": [{"path": "tests/entity/test_stub_services.py", "lineno": 118, "message": ""}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1859, "message": "in post"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1540, "message": "in request"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1629, "message": "in send"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1657, "message": "in _send_handling_auth"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1694, "message": "in _send_handling_redirects"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1730, "message": "in _send_single_request"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py", "lineno": 394, "message": "in handle_async_request"}, {"path": "../../anaconda3/lib/python3.9/contextlib.py", "lineno": 137, "message": "in __exit__"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py", "lineno": 118, "message": "ReadError"}], "longrepr": "@contextlib.contextmanager\n    def map_httpcore_exceptions() -> typing.Iterator[None]:\n        global HTTPCORE_EXC_MAP\n        if len(HTTPCORE_EXC_MAP) == 0:\n            HTTPCORE_EXC_MAP = _load_httpcore_exceptions()\n        try:\n>           yield\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:101: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:394: in handle_async_request\n    resp = await self._pool.handle_async_request(req)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/connection_pool.py:256: in handle_async_request\n    raise exc from None\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/connection_pool.py:236: in handle_async_request\n    response = await connection.handle_async_request(\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/connection.py:103: in handle_async_request\n    return await self._connection.handle_async_request(request)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:136: in handle_async_request\n    raise exc\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:106: in handle_async_request\n    ) = await self._receive_response_headers(**kwargs)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:177: in _receive_response_headers\n    event = await self._receive_event(timeout=timeout)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:217: in _receive_event\n    data = await self._network_stream.read(\n../../anaconda3/lib/python3.9/site-packages/httpcore/_backends/anyio.py:37: in read\n    return b\"\"\n../../anaconda3/lib/python3.9/contextlib.py:137: in __exit__\n    self.gen.throw(typ, value, traceback)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nmap = {<class 'TimeoutError'>: <class 'httpcore.ReadTimeout'>, <class 'anyio.BrokenResourceError'>: <class 'httpcore.ReadErr... 'anyio.ClosedResourceError'>: <class 'httpcore.ReadError'>, <class 'anyio.EndOfStream'>: <class 'httpcore.ReadError'>}\n\n    @contextlib.contextmanager\n    def map_exceptions(map: ExceptionMapping) -> typing.Iterator[None]:\n        try:\n            yield\n        except Exception as exc:  # noqa: PIE786\n            for from_exc, to_exc in map.items():\n                if isinstance(exc, from_exc):\n>                   raise to_exc(exc) from exc\nE                   httpcore.ReadError\n\n../../anaconda3/lib/python3.9/site-packages/httpcore/_exceptions.py:14: ReadError\n\nThe above exception was the direct cause of the following exception:\n\nrest = <conftest.RESTClient object at 0x7f47ab32b880>\n\n    async def test_homeassistant_reload_core_config(rest):\n        \"\"\"homeassistant.reload_core_config returns 200 (stub).\"\"\"\n>       resp = await rest.client.post(\n            f\"{rest.base_url}/api/services/homeassistant/reload_core_config\",\n            json={},\n            headers=rest._headers(),\n        )\n\ntests/entity/test_stub_services.py:118: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1859: in post\n    return await self.request(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1540: in request\n    return await self.send(request, auth=auth, follow_redirects=follow_redirects)\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1629: in send\n    response = await self._send_handling_auth(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1657: in _send_handling_auth\n    response = await self._send_handling_redirects(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1694: in _send_handling_redirects\n    response = await self._send_single_request(request)\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1730: in _send_single_request\n    response = await transport.handle_async_request(request)\n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:394: in handle_async_request\n    resp = await self._pool.handle_async_request(req)\n../../anaconda3/lib/python3.9/contextlib.py:137: in __exit__\n    self.gen.throw(typ, value, traceback)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\n    @contextlib.contextmanager\n    def map_httpcore_exceptions() -> typing.Iterator[None]:\n        global HTTPCORE_EXC_MAP\n        if len(HTTPCORE_EXC_MAP) == 0:\n            HTTPCORE_EXC_MAP = _load_httpcore_exceptions()\n        try:\n            yield\n        except Exception as exc:\n            mapped_exc = None\n    \n            for from_exc, to_exc in HTTPCORE_EXC_MAP.items():\n                if not isinstance(exc, from_exc):\n                    continue\n                # We want to map to the most specific exception we can find.\n                # Eg if `exc` is an `httpcore.ReadTimeout`, we want to map to\n                # `httpx.ReadTimeout`, not just `httpx.TimeoutException`.\n                if mapped_exc is None or issubclass(to_exc, mapped_exc):\n                    mapped_exc = to_exc\n    \n            if mapped_exc is None:  # pragma: no cover\n                raise\n    \n            message = str(exc)\n>           raise mapped_exc(message) from exc\nE           httpx.ReadError\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:118: ReadError"}, "teardown": {"duration": 0.000643471721559763, "outcome": "passed"}}, {"nodeid": "tests/entity/test_stub_services.py::test_button_press", "lineno": 127, "outcome": "failed", "keywords": ["test_button_press", "test_stub_services.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.006128150969743729, "outcome": "passed"}, "call": {"duration": 0.0019421717151999474, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py", "lineno": 118, "message": "httpx.ReadError"}, "traceback": [{"path": "tests/entity/test_stub_services.py", "lineno": 130, "message": ""}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1859, "message": "in post"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1540, "message": "in request"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1629, "message": "in send"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1657, "message": "in _send_handling_auth"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1694, "message": "in _send_handling_redirects"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1730, "message": "in _send_single_request"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py", "lineno": 394, "message": "in handle_async_request"}, {"path": "../../anaconda3/lib/python3.9/contextlib.py", "lineno": 137, "message": "in __exit__"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py", "lineno": 118, "message": "ReadError"}], "longrepr": "@contextlib.contextmanager\n    def map_httpcore_exceptions() -> typing.Iterator[None]:\n        global HTTPCORE_EXC_MAP\n        if len(HTTPCORE_EXC_MAP) == 0:\n            HTTPCORE_EXC_MAP = _load_httpcore_exceptions()\n        try:\n>           yield\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:101: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:394: in handle_async_request\n    resp = await self._pool.handle_async_request(req)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/connection_pool.py:256: in handle_async_request\n    raise exc from None\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/connection_pool.py:236: in handle_async_request\n    response = await connection.handle_async_request(\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/connection.py:103: in handle_async_request\n    return await self._connection.handle_async_request(request)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:136: in handle_async_request\n    raise exc\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:106: in handle_async_request\n    ) = await self._receive_response_headers(**kwargs)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:177: in _receive_response_headers\n    event = await self._receive_event(timeout=timeout)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:217: in _receive_event\n    data = await self._network_stream.read(\n../../anaconda3/lib/python3.9/site-packages/httpcore/_backends/anyio.py:37: in read\n    return b\"\"\n../../anaconda3/lib/python3.9/contextlib.py:137: in __exit__\n    self.gen.throw(typ, value, traceback)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nmap = {<class 'TimeoutError'>: <class 'httpcore.ReadTimeout'>, <class 'anyio.BrokenResourceError'>: <class 'httpcore.ReadErr... 'anyio.ClosedResourceError'>: <class 'httpcore.ReadError'>, <class 'anyio.EndOfStream'>: <class 'httpcore.ReadError'>}\n\n    @contextlib.contextmanager\n    def map_exceptions(map: ExceptionMapping) -> typing.Iterator[None]:\n        try:\n            yield\n        except Exception as exc:  # noqa: PIE786\n            for from_exc, to_exc in map.items():\n                if isinstance(exc, from_exc):\n>                   raise to_exc(exc) from exc\nE                   httpcore.ReadError\n\n../../anaconda3/lib/python3.9/site-packages/httpcore/_exceptions.py:14: ReadError\n\nThe above exception was the direct cause of the following exception:\n\nrest = <conftest.RESTClient object at 0x7f47ab6f0ca0>\n\n    async def test_button_press(rest):\n        \"\"\"button.press returns 200 (stub, logs press).\"\"\"\n>       resp = await rest.client.post(\n            f\"{rest.base_url}/api/services/button/press\",\n            json={\"entity_id\": \"button.test_doorbell\"},\n            headers=rest._headers(),\n        )\n\ntests/entity/test_stub_services.py:130: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1859: in post\n    return await self.request(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1540: in request\n    return await self.send(request, auth=auth, follow_redirects=follow_redirects)\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1629: in send\n    response = await self._send_handling_auth(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1657: in _send_handling_auth\n    response = await self._send_handling_redirects(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1694: in _send_handling_redirects\n    response = await self._send_single_request(request)\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1730: in _send_single_request\n    response = await transport.handle_async_request(request)\n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:394: in handle_async_request\n    resp = await self._pool.handle_async_request(req)\n../../anaconda3/lib/python3.9/contextlib.py:137: in __exit__\n    self.gen.throw(typ, value, traceback)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\n    @contextlib.contextmanager\n    def map_httpcore_exceptions() -> typing.Iterator[None]:\n        global HTTPCORE_EXC_MAP\n        if len(HTTPCORE_EXC_MAP) == 0:\n            HTTPCORE_EXC_MAP = _load_httpcore_exceptions()\n        try:\n            yield\n        except Exception as exc:\n            mapped_exc = None\n    \n            for from_exc, to_exc in HTTPCORE_EXC_MAP.items():\n                if not isinstance(exc, from_exc):\n                    continue\n                # We want to map to the most specific exception we can find.\n                # Eg if `exc` is an `httpcore.ReadTimeout`, we want to map to\n                # `httpx.ReadTimeout`, not just `httpx.TimeoutException`.\n                if mapped_exc is None or issubclass(to_exc, mapped_exc):\n                    mapped_exc = to_exc\n    \n            if mapped_exc is None:  # pragma: no cover\n                raise\n    \n            message = str(exc)\n>           raise mapped_exc(message) from exc\nE           httpx.ReadError\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:118: ReadError"}, "teardown": {"duration": 0.0006002620793879032, "outcome": "passed"}}, {"nodeid": "tests/entity/test_stub_services.py::test_input_datetime_set", "lineno": 139, "outcome": "failed", "keywords": ["test_input_datetime_set", "test_stub_services.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.00556911202147603, "outcome": "passed"}, "call": {"duration": 0.0020000850781798363, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py", "lineno": 118, "message": "httpx.ReadError"}, "traceback": [{"path": "tests/entity/test_stub_services.py", "lineno": 142, "message": ""}, {"path": "tests/conftest.py", "lineno": 89, "message": "in set_state"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1859, "message": "in post"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1540, "message": "in request"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1629, "message": "in send"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1657, "message": "in _send_handling_auth"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1694, "message": "in _send_handling_redirects"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1730, "message": "in _send_single_request"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py", "lineno": 394, "message": "in handle_async_request"}, {"path": "../../anaconda3/lib/python3.9/contextlib.py", "lineno": 137, "message": "in __exit__"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py", "lineno": 118, "message": "ReadError"}], "longrepr": "@contextlib.contextmanager\n    def map_httpcore_exceptions() -> typing.Iterator[None]:\n        global HTTPCORE_EXC_MAP\n        if len(HTTPCORE_EXC_MAP) == 0:\n            HTTPCORE_EXC_MAP = _load_httpcore_exceptions()\n        try:\n>           yield\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:101: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:394: in handle_async_request\n    resp = await self._pool.handle_async_request(req)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/connection_pool.py:256: in handle_async_request\n    raise exc from None\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/connection_pool.py:236: in handle_async_request\n    response = await connection.handle_async_request(\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/connection.py:103: in handle_async_request\n    return await self._connection.handle_async_request(request)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:136: in handle_async_request\n    raise exc\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:106: in handle_async_request\n    ) = await self._receive_response_headers(**kwargs)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:177: in _receive_response_headers\n    event = await self._receive_event(timeout=timeout)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:217: in _receive_event\n    data = await self._network_stream.read(\n../../anaconda3/lib/python3.9/site-packages/httpcore/_backends/anyio.py:37: in read\n    return b\"\"\n../../anaconda3/lib/python3.9/contextlib.py:137: in __exit__\n    self.gen.throw(typ, value, traceback)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nmap = {<class 'TimeoutError'>: <class 'httpcore.ReadTimeout'>, <class 'anyio.BrokenResourceError'>: <class 'httpcore.ReadErr... 'anyio.ClosedResourceError'>: <class 'httpcore.ReadError'>, <class 'anyio.EndOfStream'>: <class 'httpcore.ReadError'>}\n\n    @contextlib.contextmanager\n    def map_exceptions(map: ExceptionMapping) -> typing.Iterator[None]:\n        try:\n            yield\n        except Exception as exc:  # noqa: PIE786\n            for from_exc, to_exc in map.items():\n                if isinstance(exc, from_exc):\n>                   raise to_exc(exc) from exc\nE                   httpcore.ReadError\n\n../../anaconda3/lib/python3.9/site-packages/httpcore/_exceptions.py:14: ReadError\n\nThe above exception was the direct cause of the following exception:\n\nrest = <conftest.RESTClient object at 0x7f47ab6f06d0>\n\n    async def test_input_datetime_set(rest):\n        \"\"\"input_datetime.set_datetime sets state to datetime string.\"\"\"\n>       await rest.set_state(\"input_datetime.alarm_time\", \"00:00:00\")\n\ntests/entity/test_stub_services.py:142: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:89: in set_state\n    resp = await self.client.post(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1859: in post\n    return await self.request(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1540: in request\n    return await self.send(request, auth=auth, follow_redirects=follow_redirects)\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1629: in send\n    response = await self._send_handling_auth(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1657: in _send_handling_auth\n    response = await self._send_handling_redirects(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1694: in _send_handling_redirects\n    response = await self._send_single_request(request)\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1730: in _send_single_request\n    response = await transport.handle_async_request(request)\n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:394: in handle_async_request\n    resp = await self._pool.handle_async_request(req)\n../../anaconda3/lib/python3.9/contextlib.py:137: in __exit__\n    self.gen.throw(typ, value, traceback)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\n    @contextlib.contextmanager\n    def map_httpcore_exceptions() -> typing.Iterator[None]:\n        global HTTPCORE_EXC_MAP\n        if len(HTTPCORE_EXC_MAP) == 0:\n            HTTPCORE_EXC_MAP = _load_httpcore_exceptions()\n        try:\n            yield\n        except Exception as exc:\n            mapped_exc = None\n    \n            for from_exc, to_exc in HTTPCORE_EXC_MAP.items():\n                if not isinstance(exc, from_exc):\n                    continue\n                # We want to map to the most specific exception we can find.\n                # Eg if `exc` is an `httpcore.ReadTimeout`, we want to map to\n                # `httpx.ReadTimeout`, not just `httpx.TimeoutException`.\n                if mapped_exc is None or issubclass(to_exc, mapped_exc):\n                    mapped_exc = to_exc\n    \n            if mapped_exc is None:  # pragma: no cover\n                raise\n    \n            message = str(exc)\n>           raise mapped_exc(message) from exc\nE           httpx.ReadError\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:118: ReadError"}, "teardown": {"duration": 0.0007987469434738159, "outcome": "passed"}}, {"nodeid": "tests/entity/test_stub_services.py::test_input_datetime_set_time", "lineno": 150, "outcome": "failed", "keywords": ["test_input_datetime_set_time", "test_stub_services.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.0059655290096998215, "outcome": "passed"}, "call": {"duration": 0.0019376636482775211, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py", "lineno": 118, "message": "httpx.ReadError"}, "traceback": [{"path": "tests/entity/test_stub_services.py", "lineno": 153, "message": ""}, {"path": "tests/conftest.py", "lineno": 89, "message": "in set_state"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1859, "message": "in post"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1540, "message": "in request"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1629, "message": "in send"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1657, "message": "in _send_handling_auth"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1694, "message": "in _send_handling_redirects"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1730, "message": "in _send_single_request"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py", "lineno": 394, "message": "in handle_async_request"}, {"path": "../../anaconda3/lib/python3.9/contextlib.py", "lineno": 137, "message": "in __exit__"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py", "lineno": 118, "message": "ReadError"}], "longrepr": "@contextlib.contextmanager\n    def map_httpcore_exceptions() -> typing.Iterator[None]:\n        global HTTPCORE_EXC_MAP\n        if len(HTTPCORE_EXC_MAP) == 0:\n            HTTPCORE_EXC_MAP = _load_httpcore_exceptions()\n        try:\n>           yield\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:101: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:394: in handle_async_request\n    resp = await self._pool.handle_async_request(req)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/connection_pool.py:256: in handle_async_request\n    raise exc from None\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/connection_pool.py:236: in handle_async_request\n    response = await connection.handle_async_request(\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/connection.py:103: in handle_async_request\n    return await self._connection.handle_async_request(request)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:136: in handle_async_request\n    raise exc\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:106: in handle_async_request\n    ) = await self._receive_response_headers(**kwargs)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:177: in _receive_response_headers\n    event = await self._receive_event(timeout=timeout)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:217: in _receive_event\n    data = await self._network_stream.read(\n../../anaconda3/lib/python3.9/site-packages/httpcore/_backends/anyio.py:37: in read\n    return b\"\"\n../../anaconda3/lib/python3.9/contextlib.py:137: in __exit__\n    self.gen.throw(typ, value, traceback)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nmap = {<class 'TimeoutError'>: <class 'httpcore.ReadTimeout'>, <class 'anyio.BrokenResourceError'>: <class 'httpcore.ReadErr... 'anyio.ClosedResourceError'>: <class 'httpcore.ReadError'>, <class 'anyio.EndOfStream'>: <class 'httpcore.ReadError'>}\n\n    @contextlib.contextmanager\n    def map_exceptions(map: ExceptionMapping) -> typing.Iterator[None]:\n        try:\n            yield\n        except Exception as exc:  # noqa: PIE786\n            for from_exc, to_exc in map.items():\n                if isinstance(exc, from_exc):\n>                   raise to_exc(exc) from exc\nE                   httpcore.ReadError\n\n../../anaconda3/lib/python3.9/site-packages/httpcore/_exceptions.py:14: ReadError\n\nThe above exception was the direct cause of the following exception:\n\nrest = <conftest.RESTClient object at 0x7f47ab6f07c0>\n\n    async def test_input_datetime_set_time(rest):\n        \"\"\"input_datetime.set_datetime with time only.\"\"\"\n>       await rest.set_state(\"input_datetime.wakeup\", \"00:00:00\")\n\ntests/entity/test_stub_services.py:153: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:89: in set_state\n    resp = await self.client.post(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1859: in post\n    return await self.request(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1540: in request\n    return await self.send(request, auth=auth, follow_redirects=follow_redirects)\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1629: in send\n    response = await self._send_handling_auth(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1657: in _send_handling_auth\n    response = await self._send_handling_redirects(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1694: in _send_handling_redirects\n    response = await self._send_single_request(request)\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1730: in _send_single_request\n    response = await transport.handle_async_request(request)\n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:394: in handle_async_request\n    resp = await self._pool.handle_async_request(req)\n../../anaconda3/lib/python3.9/contextlib.py:137: in __exit__\n    self.gen.throw(typ, value, traceback)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\n    @contextlib.contextmanager\n    def map_httpcore_exceptions() -> typing.Iterator[None]:\n        global HTTPCORE_EXC_MAP\n        if len(HTTPCORE_EXC_MAP) == 0:\n            HTTPCORE_EXC_MAP = _load_httpcore_exceptions()\n        try:\n            yield\n        except Exception as exc:\n            mapped_exc = None\n    \n            for from_exc, to_exc in HTTPCORE_EXC_MAP.items():\n                if not isinstance(exc, from_exc):\n                    continue\n                # We want to map to the most specific exception we can find.\n                # Eg if `exc` is an `httpcore.ReadTimeout`, we want to map to\n                # `httpx.ReadTimeout`, not just `httpx.TimeoutException`.\n                if mapped_exc is None or issubclass(to_exc, mapped_exc):\n                    mapped_exc = to_exc\n    \n            if mapped_exc is None:  # pragma: no cover\n                raise\n    \n            message = str(exc)\n>           raise mapped_exc(message) from exc\nE           httpx.ReadError\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:118: ReadError"}, "teardown": {"duration": 0.0005529127083718777, "outcome": "passed"}}, {"nodeid": "tests/entity/test_stub_services.py::test_homeassistant_turn_on_generic", "lineno": 163, "outcome": "failed", "keywords": ["test_homeassistant_turn_on_generic", "test_stub_services.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.006201370153576136, "outcome": "passed"}, "call": {"duration": 0.0024146558716893196, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py", "lineno": 118, "message": "httpx.ReadError"}, "traceback": [{"path": "tests/entity/test_stub_services.py", "lineno": 166, "message": ""}, {"path": "tests/conftest.py", "lineno": 89, "message": "in set_state"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1859, "message": "in post"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1540, "message": "in request"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1629, "message": "in send"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1657, "message": "in _send_handling_auth"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1694, "message": "in _send_handling_redirects"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1730, "message": "in _send_single_request"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py", "lineno": 394, "message": "in handle_async_request"}, {"path": "../../anaconda3/lib/python3.9/contextlib.py", "lineno": 137, "message": "in __exit__"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py", "lineno": 118, "message": "ReadError"}], "longrepr": "@contextlib.contextmanager\n    def map_httpcore_exceptions() -> typing.Iterator[None]:\n        global HTTPCORE_EXC_MAP\n        if len(HTTPCORE_EXC_MAP) == 0:\n            HTTPCORE_EXC_MAP = _load_httpcore_exceptions()\n        try:\n>           yield\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:101: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:394: in handle_async_request\n    resp = await self._pool.handle_async_request(req)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/connection_pool.py:256: in handle_async_request\n    raise exc from None\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/connection_pool.py:236: in handle_async_request\n    response = await connection.handle_async_request(\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/connection.py:103: in handle_async_request\n    return await self._connection.handle_async_request(request)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:136: in handle_async_request\n    raise exc\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:106: in handle_async_request\n    ) = await self._receive_response_headers(**kwargs)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:177: in _receive_response_headers\n    event = await self._receive_event(timeout=timeout)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:217: in _receive_event\n    data = await self._network_stream.read(\n../../anaconda3/lib/python3.9/site-packages/httpcore/_backends/anyio.py:37: in read\n    return b\"\"\n../../anaconda3/lib/python3.9/contextlib.py:137: in __exit__\n    self.gen.throw(typ, value, traceback)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nmap = {<class 'TimeoutError'>: <class 'httpcore.ReadTimeout'>, <class 'anyio.BrokenResourceError'>: <class 'httpcore.ReadErr... 'anyio.ClosedResourceError'>: <class 'httpcore.ReadError'>, <class 'anyio.EndOfStream'>: <class 'httpcore.ReadError'>}\n\n    @contextlib.contextmanager\n    def map_exceptions(map: ExceptionMapping) -> typing.Iterator[None]:\n        try:\n            yield\n        except Exception as exc:  # noqa: PIE786\n            for from_exc, to_exc in map.items():\n                if isinstance(exc, from_exc):\n>                   raise to_exc(exc) from exc\nE                   httpcore.ReadError\n\n../../anaconda3/lib/python3.9/site-packages/httpcore/_exceptions.py:14: ReadError\n\nThe above exception was the direct cause of the following exception:\n\nrest = <conftest.RESTClient object at 0x7f47ab6ffd00>\n\n    async def test_homeassistant_turn_on_generic(rest):\n        \"\"\"homeassistant.turn_on sets entity to on.\"\"\"\n>       await rest.set_state(\"switch.ha_generic_test\", \"off\")\n\ntests/entity/test_stub_services.py:166: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:89: in set_state\n    resp = await self.client.post(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1859: in post\n    return await self.request(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1540: in request\n    return await self.send(request, auth=auth, follow_redirects=follow_redirects)\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1629: in send\n    response = await self._send_handling_auth(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1657: in _send_handling_auth\n    response = await self._send_handling_redirects(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1694: in _send_handling_redirects\n    response = await self._send_single_request(request)\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1730: in _send_single_request\n    response = await transport.handle_async_request(request)\n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:394: in handle_async_request\n    resp = await self._pool.handle_async_request(req)\n../../anaconda3/lib/python3.9/contextlib.py:137: in __exit__\n    self.gen.throw(typ, value, traceback)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\n    @contextlib.contextmanager\n    def map_httpcore_exceptions() -> typing.Iterator[None]:\n        global HTTPCORE_EXC_MAP\n        if len(HTTPCORE_EXC_MAP) == 0:\n            HTTPCORE_EXC_MAP = _load_httpcore_exceptions()\n        try:\n            yield\n        except Exception as exc:\n            mapped_exc = None\n    \n            for from_exc, to_exc in HTTPCORE_EXC_MAP.items():\n                if not isinstance(exc, from_exc):\n                    continue\n                # We want to map to the most specific exception we can find.\n                # Eg if `exc` is an `httpcore.ReadTimeout`, we want to map to\n                # `httpx.ReadTimeout`, not just `httpx.TimeoutException`.\n                if mapped_exc is None or issubclass(to_exc, mapped_exc):\n                    mapped_exc = to_exc\n    \n            if mapped_exc is None:  # pragma: no cover\n                raise\n    \n            message = str(exc)\n>           raise mapped_exc(message) from exc\nE           httpx.ReadError\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:118: ReadError"}, "teardown": {"duration": 0.0005371887236833572, "outcome": "passed"}}, {"nodeid": "tests/entity/test_stub_services.py::test_homeassistant_turn_off_generic", "lineno": 173, "outcome": "failed", "keywords": ["test_homeassistant_turn_off_generic", "test_stub_services.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005615409929305315, "outcome": "passed"}, "call": {"duration": 0.0019141552038490772, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py", "lineno": 118, "message": "httpx.ReadError"}, "traceback": [{"path": "tests/entity/test_stub_services.py", "lineno": 176, "message": ""}, {"path": "tests/conftest.py", "lineno": 89, "message": "in set_state"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1859, "message": "in post"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1540, "message": "in request"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1629, "message": "in send"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1657, "message": "in _send_handling_auth"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1694, "message": "in _send_handling_redirects"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1730, "message": "in _send_single_request"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py", "lineno": 394, "message": "in handle_async_request"}, {"path": "../../anaconda3/lib/python3.9/contextlib.py", "lineno": 137, "message": "in __exit__"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py", "lineno": 118, "message": "ReadError"}], "longrepr": "@contextlib.contextmanager\n    def map_httpcore_exceptions() -> typing.Iterator[None]:\n        global HTTPCORE_EXC_MAP\n        if len(HTTPCORE_EXC_MAP) == 0:\n            HTTPCORE_EXC_MAP = _load_httpcore_exceptions()\n        try:\n>           yield\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:101: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:394: in handle_async_request\n    resp = await self._pool.handle_async_request(req)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/connection_pool.py:256: in handle_async_request\n    raise exc from None\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/connection_pool.py:236: in handle_async_request\n    response = await connection.handle_async_request(\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/connection.py:103: in handle_async_request\n    return await self._connection.handle_async_request(request)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:136: in handle_async_request\n    raise exc\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:106: in handle_async_request\n    ) = await self._receive_response_headers(**kwargs)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:177: in _receive_response_headers\n    event = await self._receive_event(timeout=timeout)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:217: in _receive_event\n    data = await self._network_stream.read(\n../../anaconda3/lib/python3.9/site-packages/httpcore/_backends/anyio.py:37: in read\n    return b\"\"\n../../anaconda3/lib/python3.9/contextlib.py:137: in __exit__\n    self.gen.throw(typ, value, traceback)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nmap = {<class 'TimeoutError'>: <class 'httpcore.ReadTimeout'>, <class 'anyio.BrokenResourceError'>: <class 'httpcore.ReadErr... 'anyio.ClosedResourceError'>: <class 'httpcore.ReadError'>, <class 'anyio.EndOfStream'>: <class 'httpcore.ReadError'>}\n\n    @contextlib.contextmanager\n    def map_exceptions(map: ExceptionMapping) -> typing.Iterator[None]:\n        try:\n            yield\n        except Exception as exc:  # noqa: PIE786\n            for from_exc, to_exc in map.items():\n                if isinstance(exc, from_exc):\n>                   raise to_exc(exc) from exc\nE                   httpcore.ReadError\n\n../../anaconda3/lib/python3.9/site-packages/httpcore/_exceptions.py:14: ReadError\n\nThe above exception was the direct cause of the following exception:\n\nrest = <conftest.RESTClient object at 0x7f47ab66b670>\n\n    async def test_homeassistant_turn_off_generic(rest):\n        \"\"\"homeassistant.turn_off sets entity to off.\"\"\"\n>       await rest.set_state(\"switch.ha_generic_off\", \"on\")\n\ntests/entity/test_stub_services.py:176: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:89: in set_state\n    resp = await self.client.post(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1859: in post\n    return await self.request(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1540: in request\n    return await self.send(request, auth=auth, follow_redirects=follow_redirects)\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1629: in send\n    response = await self._send_handling_auth(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1657: in _send_handling_auth\n    response = await self._send_handling_redirects(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1694: in _send_handling_redirects\n    response = await self._send_single_request(request)\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1730: in _send_single_request\n    response = await transport.handle_async_request(request)\n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:394: in handle_async_request\n    resp = await self._pool.handle_async_request(req)\n../../anaconda3/lib/python3.9/contextlib.py:137: in __exit__\n    self.gen.throw(typ, value, traceback)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\n    @contextlib.contextmanager\n    def map_httpcore_exceptions() -> typing.Iterator[None]:\n        global HTTPCORE_EXC_MAP\n        if len(HTTPCORE_EXC_MAP) == 0:\n            HTTPCORE_EXC_MAP = _load_httpcore_exceptions()\n        try:\n            yield\n        except Exception as exc:\n            mapped_exc = None\n    \n            for from_exc, to_exc in HTTPCORE_EXC_MAP.items():\n                if not isinstance(exc, from_exc):\n                    continue\n                # We want to map to the most specific exception we can find.\n                # Eg if `exc` is an `httpcore.ReadTimeout`, we want to map to\n                # `httpx.ReadTimeout`, not just `httpx.TimeoutException`.\n                if mapped_exc is None or issubclass(to_exc, mapped_exc):\n                    mapped_exc = to_exc\n    \n            if mapped_exc is None:  # pragma: no cover\n                raise\n    \n            message = str(exc)\n>           raise mapped_exc(message) from exc\nE           httpx.ReadError\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:118: ReadError"}, "teardown": {"duration": 0.0005522118881344795, "outcome": "passed"}}, {"nodeid": "tests/entity/test_stub_services.py::test_homeassistant_toggle_generic", "lineno": 183, "outcome": "failed", "keywords": ["test_homeassistant_toggle_generic", "test_stub_services.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005284526851028204, "outcome": "passed"}, "call": {"duration": 0.0023777922615408897, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py", "lineno": 118, "message": "httpx.ReadError"}, "traceback": [{"path": "tests/entity/test_stub_services.py", "lineno": 186, "message": ""}, {"path": "tests/conftest.py", "lineno": 89, "message": "in set_state"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1859, "message": "in post"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1540, "message": "in request"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1629, "message": "in send"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1657, "message": "in _send_handling_auth"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1694, "message": "in _send_handling_redirects"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1730, "message": "in _send_single_request"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py", "lineno": 394, "message": "in handle_async_request"}, {"path": "../../anaconda3/lib/python3.9/contextlib.py", "lineno": 137, "message": "in __exit__"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py", "lineno": 118, "message": "ReadError"}], "longrepr": "@contextlib.contextmanager\n    def map_httpcore_exceptions() -> typing.Iterator[None]:\n        global HTTPCORE_EXC_MAP\n        if len(HTTPCORE_EXC_MAP) == 0:\n            HTTPCORE_EXC_MAP = _load_httpcore_exceptions()\n        try:\n>           yield\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:101: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:394: in handle_async_request\n    resp = await self._pool.handle_async_request(req)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/connection_pool.py:256: in handle_async_request\n    raise exc from None\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/connection_pool.py:236: in handle_async_request\n    response = await connection.handle_async_request(\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/connection.py:103: in handle_async_request\n    return await self._connection.handle_async_request(request)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:136: in handle_async_request\n    raise exc\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:106: in handle_async_request\n    ) = await self._receive_response_headers(**kwargs)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:177: in _receive_response_headers\n    event = await self._receive_event(timeout=timeout)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:217: in _receive_event\n    data = await self._network_stream.read(\n../../anaconda3/lib/python3.9/site-packages/httpcore/_backends/anyio.py:37: in read\n    return b\"\"\n../../anaconda3/lib/python3.9/contextlib.py:137: in __exit__\n    self.gen.throw(typ, value, traceback)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nmap = {<class 'TimeoutError'>: <class 'httpcore.ReadTimeout'>, <class 'anyio.BrokenResourceError'>: <class 'httpcore.ReadErr... 'anyio.ClosedResourceError'>: <class 'httpcore.ReadError'>, <class 'anyio.EndOfStream'>: <class 'httpcore.ReadError'>}\n\n    @contextlib.contextmanager\n    def map_exceptions(map: ExceptionMapping) -> typing.Iterator[None]:\n        try:\n            yield\n        except Exception as exc:  # noqa: PIE786\n            for from_exc, to_exc in map.items():\n                if isinstance(exc, from_exc):\n>                   raise to_exc(exc) from exc\nE                   httpcore.ReadError\n\n../../anaconda3/lib/python3.9/site-packages/httpcore/_exceptions.py:14: ReadError\n\nThe above exception was the direct cause of the following exception:\n\nrest = <conftest.RESTClient object at 0x7f47ab38ad60>\n\n    async def test_homeassistant_toggle_generic(rest):\n        \"\"\"homeassistant.toggle flips entity state.\"\"\"\n>       await rest.set_state(\"switch.ha_toggle_test\", \"off\")\n\ntests/entity/test_stub_services.py:186: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:89: in set_state\n    resp = await self.client.post(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1859: in post\n    return await self.request(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1540: in request\n    return await self.send(request, auth=auth, follow_redirects=follow_redirects)\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1629: in send\n    response = await self._send_handling_auth(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1657: in _send_handling_auth\n    response = await self._send_handling_redirects(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1694: in _send_handling_redirects\n    response = await self._send_single_request(request)\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1730: in _send_single_request\n    response = await transport.handle_async_request(request)\n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:394: in handle_async_request\n    resp = await self._pool.handle_async_request(req)\n../../anaconda3/lib/python3.9/contextlib.py:137: in __exit__\n    self.gen.throw(typ, value, traceback)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\n    @contextlib.contextmanager\n    def map_httpcore_exceptions() -> typing.Iterator[None]:\n        global HTTPCORE_EXC_MAP\n        if len(HTTPCORE_EXC_MAP) == 0:\n            HTTPCORE_EXC_MAP = _load_httpcore_exceptions()\n        try:\n            yield\n        except Exception as exc:\n            mapped_exc = None\n    \n            for from_exc, to_exc in HTTPCORE_EXC_MAP.items():\n                if not isinstance(exc, from_exc):\n                    continue\n                # We want to map to the most specific exception we can find.\n                # Eg if `exc` is an `httpcore.ReadTimeout`, we want to map to\n                # `httpx.ReadTimeout`, not just `httpx.TimeoutException`.\n                if mapped_exc is None or issubclass(to_exc, mapped_exc):\n                    mapped_exc = to_exc\n    \n            if mapped_exc is None:  # pragma: no cover\n                raise\n    \n            message = str(exc)\n>           raise mapped_exc(message) from exc\nE           httpx.ReadError\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:118: ReadError"}, "teardown": {"duration": 0.0005609961226582527, "outcome": "passed"}}, {"nodeid": "tests/entity/test_timer_counter.py::test_timer_service[idle-start-active]", "lineno": 14, "outcome": "failed", "keywords": ["test_timer_service[idle-start-active]", "parametrize", "pytestmark", "idle-start-active", "test_timer_counter.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005770792718976736, "outcome": "passed"}, "call": {"duration": 0.001971025951206684, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py", "lineno": 118, "message": "httpx.ReadError"}, "traceback": [{"path": "tests/entity/test_timer_counter.py", "lineno": 24, "message": ""}, {"path": "tests/conftest.py", "lineno": 89, "message": "in set_state"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1859, "message": "in post"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1540, "message": "in request"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1629, "message": "in send"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1657, "message": "in _send_handling_auth"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1694, "message": "in _send_handling_redirects"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1730, "message": "in _send_single_request"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py", "lineno": 394, "message": "in handle_async_request"}, {"path": "../../anaconda3/lib/python3.9/contextlib.py", "lineno": 137, "message": "in __exit__"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py", "lineno": 118, "message": "ReadError"}], "longrepr": "@contextlib.contextmanager\n    def map_httpcore_exceptions() -> typing.Iterator[None]:\n        global HTTPCORE_EXC_MAP\n        if len(HTTPCORE_EXC_MAP) == 0:\n            HTTPCORE_EXC_MAP = _load_httpcore_exceptions()\n        try:\n>           yield\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:101: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:394: in handle_async_request\n    resp = await self._pool.handle_async_request(req)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/connection_pool.py:256: in handle_async_request\n    raise exc from None\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/connection_pool.py:236: in handle_async_request\n    response = await connection.handle_async_request(\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/connection.py:103: in handle_async_request\n    return await self._connection.handle_async_request(request)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:136: in handle_async_request\n    raise exc\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:106: in handle_async_request\n    ) = await self._receive_response_headers(**kwargs)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:177: in _receive_response_headers\n    event = await self._receive_event(timeout=timeout)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:217: in _receive_event\n    data = await self._network_stream.read(\n../../anaconda3/lib/python3.9/site-packages/httpcore/_backends/anyio.py:37: in read\n    return b\"\"\n../../anaconda3/lib/python3.9/contextlib.py:137: in __exit__\n    self.gen.throw(typ, value, traceback)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nmap = {<class 'TimeoutError'>: <class 'httpcore.ReadTimeout'>, <class 'anyio.BrokenResourceError'>: <class 'httpcore.ReadErr... 'anyio.ClosedResourceError'>: <class 'httpcore.ReadError'>, <class 'anyio.EndOfStream'>: <class 'httpcore.ReadError'>}\n\n    @contextlib.contextmanager\n    def map_exceptions(map: ExceptionMapping) -> typing.Iterator[None]:\n        try:\n            yield\n        except Exception as exc:  # noqa: PIE786\n            for from_exc, to_exc in map.items():\n                if isinstance(exc, from_exc):\n>                   raise to_exc(exc) from exc\nE                   httpcore.ReadError\n\n../../anaconda3/lib/python3.9/site-packages/httpcore/_exceptions.py:14: ReadError\n\nThe above exception was the direct cause of the following exception:\n\nrest = <conftest.RESTClient object at 0x7f47b005bf40>, initial_state = 'idle'\nservice = 'start', expected_state = 'active'\n\n    @pytest.mark.parametrize(\"initial_state,service,expected_state\", [\n        (\"idle\", \"start\", \"active\"),\n        (\"active\", \"pause\", \"paused\"),\n        (\"active\", \"cancel\", \"idle\"),\n        (\"active\", \"finish\", \"idle\"),\n    ])\n    async def test_timer_service(rest, initial_state, service, expected_state):\n        \"\"\"Timer service sets expected state.\"\"\"\n        entity_id = f\"timer.test_{service}\"\n>       await rest.set_state(entity_id, initial_state)\n\ntests/entity/test_timer_counter.py:24: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:89: in set_state\n    resp = await self.client.post(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1859: in post\n    return await self.request(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1540: in request\n    return await self.send(request, auth=auth, follow_redirects=follow_redirects)\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1629: in send\n    response = await self._send_handling_auth(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1657: in _send_handling_auth\n    response = await self._send_handling_redirects(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1694: in _send_handling_redirects\n    response = await self._send_single_request(request)\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1730: in _send_single_request\n    response = await transport.handle_async_request(request)\n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:394: in handle_async_request\n    resp = await self._pool.handle_async_request(req)\n../../anaconda3/lib/python3.9/contextlib.py:137: in __exit__\n    self.gen.throw(typ, value, traceback)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\n    @contextlib.contextmanager\n    def map_httpcore_exceptions() -> typing.Iterator[None]:\n        global HTTPCORE_EXC_MAP\n        if len(HTTPCORE_EXC_MAP) == 0:\n            HTTPCORE_EXC_MAP = _load_httpcore_exceptions()\n        try:\n            yield\n        except Exception as exc:\n            mapped_exc = None\n    \n            for from_exc, to_exc in HTTPCORE_EXC_MAP.items():\n                if not isinstance(exc, from_exc):\n                    continue\n                # We want to map to the most specific exception we can find.\n                # Eg if `exc` is an `httpcore.ReadTimeout`, we want to map to\n                # `httpx.ReadTimeout`, not just `httpx.TimeoutException`.\n                if mapped_exc is None or issubclass(to_exc, mapped_exc):\n                    mapped_exc = to_exc\n    \n            if mapped_exc is None:  # pragma: no cover\n                raise\n    \n            message = str(exc)\n>           raise mapped_exc(message) from exc\nE           httpx.ReadError\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:118: ReadError"}, "teardown": {"duration": 0.0005821976810693741, "outcome": "passed"}}, {"nodeid": "tests/entity/test_timer_counter.py::test_timer_service[active-pause-paused]", "lineno": 14, "outcome": "failed", "keywords": ["test_timer_service[active-pause-paused]", "parametrize", "pytestmark", "active-pause-paused", "test_timer_counter.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.0062124282121658325, "outcome": "passed"}, "call": {"duration": 0.0019817347638309, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py", "lineno": 118, "message": "httpx.ReadError"}, "traceback": [{"path": "tests/entity/test_timer_counter.py", "lineno": 24, "message": ""}, {"path": "tests/conftest.py", "lineno": 89, "message": "in set_state"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1859, "message": "in post"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1540, "message": "in request"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1629, "message": "in send"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1657, "message": "in _send_handling_auth"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1694, "message": "in _send_handling_redirects"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1730, "message": "in _send_single_request"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py", "lineno": 394, "message": "in handle_async_request"}, {"path": "../../anaconda3/lib/python3.9/contextlib.py", "lineno": 137, "message": "in __exit__"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py", "lineno": 118, "message": "ReadError"}], "longrepr": "@contextlib.contextmanager\n    def map_httpcore_exceptions() -> typing.Iterator[None]:\n        global HTTPCORE_EXC_MAP\n        if len(HTTPCORE_EXC_MAP) == 0:\n            HTTPCORE_EXC_MAP = _load_httpcore_exceptions()\n        try:\n>           yield\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:101: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:394: in handle_async_request\n    resp = await self._pool.handle_async_request(req)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/connection_pool.py:256: in handle_async_request\n    raise exc from None\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/connection_pool.py:236: in handle_async_request\n    response = await connection.handle_async_request(\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/connection.py:103: in handle_async_request\n    return await self._connection.handle_async_request(request)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:136: in handle_async_request\n    raise exc\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:106: in handle_async_request\n    ) = await self._receive_response_headers(**kwargs)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:177: in _receive_response_headers\n    event = await self._receive_event(timeout=timeout)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:217: in _receive_event\n    data = await self._network_stream.read(\n../../anaconda3/lib/python3.9/site-packages/httpcore/_backends/anyio.py:37: in read\n    return b\"\"\n../../anaconda3/lib/python3.9/contextlib.py:137: in __exit__\n    self.gen.throw(typ, value, traceback)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nmap = {<class 'TimeoutError'>: <class 'httpcore.ReadTimeout'>, <class 'anyio.BrokenResourceError'>: <class 'httpcore.ReadErr... 'anyio.ClosedResourceError'>: <class 'httpcore.ReadError'>, <class 'anyio.EndOfStream'>: <class 'httpcore.ReadError'>}\n\n    @contextlib.contextmanager\n    def map_exceptions(map: ExceptionMapping) -> typing.Iterator[None]:\n        try:\n            yield\n        except Exception as exc:  # noqa: PIE786\n            for from_exc, to_exc in map.items():\n                if isinstance(exc, from_exc):\n>                   raise to_exc(exc) from exc\nE                   httpcore.ReadError\n\n../../anaconda3/lib/python3.9/site-packages/httpcore/_exceptions.py:14: ReadError\n\nThe above exception was the direct cause of the following exception:\n\nrest = <conftest.RESTClient object at 0x7f47b005b910>, initial_state = 'active'\nservice = 'pause', expected_state = 'paused'\n\n    @pytest.mark.parametrize(\"initial_state,service,expected_state\", [\n        (\"idle\", \"start\", \"active\"),\n        (\"active\", \"pause\", \"paused\"),\n        (\"active\", \"cancel\", \"idle\"),\n        (\"active\", \"finish\", \"idle\"),\n    ])\n    async def test_timer_service(rest, initial_state, service, expected_state):\n        \"\"\"Timer service sets expected state.\"\"\"\n        entity_id = f\"timer.test_{service}\"\n>       await rest.set_state(entity_id, initial_state)\n\ntests/entity/test_timer_counter.py:24: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:89: in set_state\n    resp = await self.client.post(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1859: in post\n    return await self.request(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1540: in request\n    return await self.send(request, auth=auth, follow_redirects=follow_redirects)\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1629: in send\n    response = await self._send_handling_auth(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1657: in _send_handling_auth\n    response = await self._send_handling_redirects(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1694: in _send_handling_redirects\n    response = await self._send_single_request(request)\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1730: in _send_single_request\n    response = await transport.handle_async_request(request)\n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:394: in handle_async_request\n    resp = await self._pool.handle_async_request(req)\n../../anaconda3/lib/python3.9/contextlib.py:137: in __exit__\n    self.gen.throw(typ, value, traceback)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\n    @contextlib.contextmanager\n    def map_httpcore_exceptions() -> typing.Iterator[None]:\n        global HTTPCORE_EXC_MAP\n        if len(HTTPCORE_EXC_MAP) == 0:\n            HTTPCORE_EXC_MAP = _load_httpcore_exceptions()\n        try:\n            yield\n        except Exception as exc:\n            mapped_exc = None\n    \n            for from_exc, to_exc in HTTPCORE_EXC_MAP.items():\n                if not isinstance(exc, from_exc):\n                    continue\n                # We want to map to the most specific exception we can find.\n                # Eg if `exc` is an `httpcore.ReadTimeout`, we want to map to\n                # `httpx.ReadTimeout`, not just `httpx.TimeoutException`.\n                if mapped_exc is None or issubclass(to_exc, mapped_exc):\n                    mapped_exc = to_exc\n    \n            if mapped_exc is None:  # pragma: no cover\n                raise\n    \n            message = str(exc)\n>           raise mapped_exc(message) from exc\nE           httpx.ReadError\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:118: ReadError"}, "teardown": {"duration": 0.0005797520279884338, "outcome": "passed"}}, {"nodeid": "tests/entity/test_timer_counter.py::test_timer_service[active-cancel-idle]", "lineno": 14, "outcome": "failed", "keywords": ["test_timer_service[active-cancel-idle]", "parametrize", "pytestmark", "active-cancel-idle", "test_timer_counter.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.0052872770465910435, "outcome": "passed"}, "call": {"duration": 0.001775376033037901, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py", "lineno": 118, "message": "httpx.ReadError"}, "traceback": [{"path": "tests/entity/test_timer_counter.py", "lineno": 24, "message": ""}, {"path": "tests/conftest.py", "lineno": 89, "message": "in set_state"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1859, "message": "in post"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1540, "message": "in request"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1629, "message": "in send"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1657, "message": "in _send_handling_auth"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1694, "message": "in _send_handling_redirects"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1730, "message": "in _send_single_request"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py", "lineno": 394, "message": "in handle_async_request"}, {"path": "../../anaconda3/lib/python3.9/contextlib.py", "lineno": 137, "message": "in __exit__"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py", "lineno": 118, "message": "ReadError"}], "longrepr": "@contextlib.contextmanager\n    def map_httpcore_exceptions() -> typing.Iterator[None]:\n        global HTTPCORE_EXC_MAP\n        if len(HTTPCORE_EXC_MAP) == 0:\n            HTTPCORE_EXC_MAP = _load_httpcore_exceptions()\n        try:\n>           yield\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:101: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:394: in handle_async_request\n    resp = await self._pool.handle_async_request(req)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/connection_pool.py:256: in handle_async_request\n    raise exc from None\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/connection_pool.py:236: in handle_async_request\n    response = await connection.handle_async_request(\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/connection.py:103: in handle_async_request\n    return await self._connection.handle_async_request(request)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:136: in handle_async_request\n    raise exc\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:106: in handle_async_request\n    ) = await self._receive_response_headers(**kwargs)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:177: in _receive_response_headers\n    event = await self._receive_event(timeout=timeout)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:217: in _receive_event\n    data = await self._network_stream.read(\n../../anaconda3/lib/python3.9/site-packages/httpcore/_backends/anyio.py:37: in read\n    return b\"\"\n../../anaconda3/lib/python3.9/contextlib.py:137: in __exit__\n    self.gen.throw(typ, value, traceback)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nmap = {<class 'TimeoutError'>: <class 'httpcore.ReadTimeout'>, <class 'anyio.BrokenResourceError'>: <class 'httpcore.ReadErr... 'anyio.ClosedResourceError'>: <class 'httpcore.ReadError'>, <class 'anyio.EndOfStream'>: <class 'httpcore.ReadError'>}\n\n    @contextlib.contextmanager\n    def map_exceptions(map: ExceptionMapping) -> typing.Iterator[None]:\n        try:\n            yield\n        except Exception as exc:  # noqa: PIE786\n            for from_exc, to_exc in map.items():\n                if isinstance(exc, from_exc):\n>                   raise to_exc(exc) from exc\nE                   httpcore.ReadError\n\n../../anaconda3/lib/python3.9/site-packages/httpcore/_exceptions.py:14: ReadError\n\nThe above exception was the direct cause of the following exception:\n\nrest = <conftest.RESTClient object at 0x7f47ab768430>, initial_state = 'active'\nservice = 'cancel', expected_state = 'idle'\n\n    @pytest.mark.parametrize(\"initial_state,service,expected_state\", [\n        (\"idle\", \"start\", \"active\"),\n        (\"active\", \"pause\", \"paused\"),\n        (\"active\", \"cancel\", \"idle\"),\n        (\"active\", \"finish\", \"idle\"),\n    ])\n    async def test_timer_service(rest, initial_state, service, expected_state):\n        \"\"\"Timer service sets expected state.\"\"\"\n        entity_id = f\"timer.test_{service}\"\n>       await rest.set_state(entity_id, initial_state)\n\ntests/entity/test_timer_counter.py:24: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:89: in set_state\n    resp = await self.client.post(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1859: in post\n    return await self.request(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1540: in request\n    return await self.send(request, auth=auth, follow_redirects=follow_redirects)\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1629: in send\n    response = await self._send_handling_auth(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1657: in _send_handling_auth\n    response = await self._send_handling_redirects(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1694: in _send_handling_redirects\n    response = await self._send_single_request(request)\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1730: in _send_single_request\n    response = await transport.handle_async_request(request)\n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:394: in handle_async_request\n    resp = await self._pool.handle_async_request(req)\n../../anaconda3/lib/python3.9/contextlib.py:137: in __exit__\n    self.gen.throw(typ, value, traceback)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\n    @contextlib.contextmanager\n    def map_httpcore_exceptions() -> typing.Iterator[None]:\n        global HTTPCORE_EXC_MAP\n        if len(HTTPCORE_EXC_MAP) == 0:\n            HTTPCORE_EXC_MAP = _load_httpcore_exceptions()\n        try:\n            yield\n        except Exception as exc:\n            mapped_exc = None\n    \n            for from_exc, to_exc in HTTPCORE_EXC_MAP.items():\n                if not isinstance(exc, from_exc):\n                    continue\n                # We want to map to the most specific exception we can find.\n                # Eg if `exc` is an `httpcore.ReadTimeout`, we want to map to\n                # `httpx.ReadTimeout`, not just `httpx.TimeoutException`.\n                if mapped_exc is None or issubclass(to_exc, mapped_exc):\n                    mapped_exc = to_exc\n    \n            if mapped_exc is None:  # pragma: no cover\n                raise\n    \n            message = str(exc)\n>           raise mapped_exc(message) from exc\nE           httpx.ReadError\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:118: ReadError"}, "teardown": {"duration": 0.0006192517466843128, "outcome": "passed"}}, {"nodeid": "tests/entity/test_timer_counter.py::test_timer_service[active-finish-idle]", "lineno": 14, "outcome": "failed", "keywords": ["test_timer_service[active-finish-idle]", "parametrize", "pytestmark", "active-finish-idle", "test_timer_counter.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005820902995765209, "outcome": "passed"}, "call": {"duration": 0.0018300367519259453, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py", "lineno": 118, "message": "httpx.ReadError"}, "traceback": [{"path": "tests/entity/test_timer_counter.py", "lineno": 24, "message": ""}, {"path": "tests/conftest.py", "lineno": 89, "message": "in set_state"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1859, "message": "in post"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1540, "message": "in request"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1629, "message": "in send"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1657, "message": "in _send_handling_auth"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1694, "message": "in _send_handling_redirects"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1730, "message": "in _send_single_request"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py", "lineno": 394, "message": "in handle_async_request"}, {"path": "../../anaconda3/lib/python3.9/contextlib.py", "lineno": 137, "message": "in __exit__"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py", "lineno": 118, "message": "ReadError"}], "longrepr": "@contextlib.contextmanager\n    def map_httpcore_exceptions() -> typing.Iterator[None]:\n        global HTTPCORE_EXC_MAP\n        if len(HTTPCORE_EXC_MAP) == 0:\n            HTTPCORE_EXC_MAP = _load_httpcore_exceptions()\n        try:\n>           yield\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:101: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:394: in handle_async_request\n    resp = await self._pool.handle_async_request(req)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/connection_pool.py:256: in handle_async_request\n    raise exc from None\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/connection_pool.py:236: in handle_async_request\n    response = await connection.handle_async_request(\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/connection.py:103: in handle_async_request\n    return await self._connection.handle_async_request(request)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:136: in handle_async_request\n    raise exc\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:106: in handle_async_request\n    ) = await self._receive_response_headers(**kwargs)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:177: in _receive_response_headers\n    event = await self._receive_event(timeout=timeout)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:217: in _receive_event\n    data = await self._network_stream.read(\n../../anaconda3/lib/python3.9/site-packages/httpcore/_backends/anyio.py:37: in read\n    return b\"\"\n../../anaconda3/lib/python3.9/contextlib.py:137: in __exit__\n    self.gen.throw(typ, value, traceback)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nmap = {<class 'TimeoutError'>: <class 'httpcore.ReadTimeout'>, <class 'anyio.BrokenResourceError'>: <class 'httpcore.ReadErr... 'anyio.ClosedResourceError'>: <class 'httpcore.ReadError'>, <class 'anyio.EndOfStream'>: <class 'httpcore.ReadError'>}\n\n    @contextlib.contextmanager\n    def map_exceptions(map: ExceptionMapping) -> typing.Iterator[None]:\n        try:\n            yield\n        except Exception as exc:  # noqa: PIE786\n            for from_exc, to_exc in map.items():\n                if isinstance(exc, from_exc):\n>                   raise to_exc(exc) from exc\nE                   httpcore.ReadError\n\n../../anaconda3/lib/python3.9/site-packages/httpcore/_exceptions.py:14: ReadError\n\nThe above exception was the direct cause of the following exception:\n\nrest = <conftest.RESTClient object at 0x7f47ab38a670>, initial_state = 'active'\nservice = 'finish', expected_state = 'idle'\n\n    @pytest.mark.parametrize(\"initial_state,service,expected_state\", [\n        (\"idle\", \"start\", \"active\"),\n        (\"active\", \"pause\", \"paused\"),\n        (\"active\", \"cancel\", \"idle\"),\n        (\"active\", \"finish\", \"idle\"),\n    ])\n    async def test_timer_service(rest, initial_state, service, expected_state):\n        \"\"\"Timer service sets expected state.\"\"\"\n        entity_id = f\"timer.test_{service}\"\n>       await rest.set_state(entity_id, initial_state)\n\ntests/entity/test_timer_counter.py:24: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:89: in set_state\n    resp = await self.client.post(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1859: in post\n    return await self.request(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1540: in request\n    return await self.send(request, auth=auth, follow_redirects=follow_redirects)\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1629: in send\n    response = await self._send_handling_auth(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1657: in _send_handling_auth\n    response = await self._send_handling_redirects(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1694: in _send_handling_redirects\n    response = await self._send_single_request(request)\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1730: in _send_single_request\n    response = await transport.handle_async_request(request)\n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:394: in handle_async_request\n    resp = await self._pool.handle_async_request(req)\n../../anaconda3/lib/python3.9/contextlib.py:137: in __exit__\n    self.gen.throw(typ, value, traceback)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\n    @contextlib.contextmanager\n    def map_httpcore_exceptions() -> typing.Iterator[None]:\n        global HTTPCORE_EXC_MAP\n        if len(HTTPCORE_EXC_MAP) == 0:\n            HTTPCORE_EXC_MAP = _load_httpcore_exceptions()\n        try:\n            yield\n        except Exception as exc:\n            mapped_exc = None\n    \n            for from_exc, to_exc in HTTPCORE_EXC_MAP.items():\n                if not isinstance(exc, from_exc):\n                    continue\n                # We want to map to the most specific exception we can find.\n                # Eg if `exc` is an `httpcore.ReadTimeout`, we want to map to\n                # `httpx.ReadTimeout`, not just `httpx.TimeoutException`.\n                if mapped_exc is None or issubclass(to_exc, mapped_exc):\n                    mapped_exc = to_exc\n    \n            if mapped_exc is None:  # pragma: no cover\n                raise\n    \n            message = str(exc)\n>           raise mapped_exc(message) from exc\nE           httpx.ReadError\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:118: ReadError"}, "teardown": {"duration": 0.0005780607461929321, "outcome": "passed"}}, {"nodeid": "tests/entity/test_timer_counter.py::test_timer_lifecycle", "lineno": 29, "outcome": "failed", "keywords": ["test_timer_lifecycle", "test_timer_counter.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005338834132999182, "outcome": "passed"}, "call": {"duration": 0.0018065860494971275, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py", "lineno": 118, "message": "httpx.ReadError"}, "traceback": [{"path": "tests/entity/test_timer_counter.py", "lineno": 33, "message": ""}, {"path": "tests/conftest.py", "lineno": 89, "message": "in set_state"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1859, "message": "in post"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1540, "message": "in request"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1629, "message": "in send"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1657, "message": "in _send_handling_auth"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1694, "message": "in _send_handling_redirects"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1730, "message": "in _send_single_request"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py", "lineno": 394, "message": "in handle_async_request"}, {"path": "../../anaconda3/lib/python3.9/contextlib.py", "lineno": 137, "message": "in __exit__"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py", "lineno": 118, "message": "ReadError"}], "longrepr": "@contextlib.contextmanager\n    def map_httpcore_exceptions() -> typing.Iterator[None]:\n        global HTTPCORE_EXC_MAP\n        if len(HTTPCORE_EXC_MAP) == 0:\n            HTTPCORE_EXC_MAP = _load_httpcore_exceptions()\n        try:\n>           yield\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:101: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:394: in handle_async_request\n    resp = await self._pool.handle_async_request(req)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/connection_pool.py:256: in handle_async_request\n    raise exc from None\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/connection_pool.py:236: in handle_async_request\n    response = await connection.handle_async_request(\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/connection.py:103: in handle_async_request\n    return await self._connection.handle_async_request(request)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:136: in handle_async_request\n    raise exc\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:106: in handle_async_request\n    ) = await self._receive_response_headers(**kwargs)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:177: in _receive_response_headers\n    event = await self._receive_event(timeout=timeout)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:217: in _receive_event\n    data = await self._network_stream.read(\n../../anaconda3/lib/python3.9/site-packages/httpcore/_backends/anyio.py:37: in read\n    return b\"\"\n../../anaconda3/lib/python3.9/contextlib.py:137: in __exit__\n    self.gen.throw(typ, value, traceback)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nmap = {<class 'TimeoutError'>: <class 'httpcore.ReadTimeout'>, <class 'anyio.BrokenResourceError'>: <class 'httpcore.ReadErr... 'anyio.ClosedResourceError'>: <class 'httpcore.ReadError'>, <class 'anyio.EndOfStream'>: <class 'httpcore.ReadError'>}\n\n    @contextlib.contextmanager\n    def map_exceptions(map: ExceptionMapping) -> typing.Iterator[None]:\n        try:\n            yield\n        except Exception as exc:  # noqa: PIE786\n            for from_exc, to_exc in map.items():\n                if isinstance(exc, from_exc):\n>                   raise to_exc(exc) from exc\nE                   httpcore.ReadError\n\n../../anaconda3/lib/python3.9/site-packages/httpcore/_exceptions.py:14: ReadError\n\nThe above exception was the direct cause of the following exception:\n\nrest = <conftest.RESTClient object at 0x7f47ab38a220>\n\n    async def test_timer_lifecycle(rest):\n        \"\"\"Timer goes through lifecycle: idle -> active -> paused -> active -> idle.\"\"\"\n        entity_id = \"timer.lifecycle\"\n>       await rest.set_state(entity_id, \"idle\")\n\ntests/entity/test_timer_counter.py:33: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:89: in set_state\n    resp = await self.client.post(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1859: in post\n    return await self.request(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1540: in request\n    return await self.send(request, auth=auth, follow_redirects=follow_redirects)\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1629: in send\n    response = await self._send_handling_auth(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1657: in _send_handling_auth\n    response = await self._send_handling_redirects(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1694: in _send_handling_redirects\n    response = await self._send_single_request(request)\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1730: in _send_single_request\n    response = await transport.handle_async_request(request)\n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:394: in handle_async_request\n    resp = await self._pool.handle_async_request(req)\n../../anaconda3/lib/python3.9/contextlib.py:137: in __exit__\n    self.gen.throw(typ, value, traceback)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\n    @contextlib.contextmanager\n    def map_httpcore_exceptions() -> typing.Iterator[None]:\n        global HTTPCORE_EXC_MAP\n        if len(HTTPCORE_EXC_MAP) == 0:\n            HTTPCORE_EXC_MAP = _load_httpcore_exceptions()\n        try:\n            yield\n        except Exception as exc:\n            mapped_exc = None\n    \n            for from_exc, to_exc in HTTPCORE_EXC_MAP.items():\n                if not isinstance(exc, from_exc):\n                    continue\n                # We want to map to the most specific exception we can find.\n                # Eg if `exc` is an `httpcore.ReadTimeout`, we want to map to\n                # `httpx.ReadTimeout`, not just `httpx.TimeoutException`.\n                if mapped_exc is None or issubclass(to_exc, mapped_exc):\n                    mapped_exc = to_exc\n    \n            if mapped_exc is None:  # pragma: no cover\n                raise\n    \n            message = str(exc)\n>           raise mapped_exc(message) from exc\nE           httpx.ReadError\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:118: ReadError"}, "teardown": {"duration": 0.0005914820358157158, "outcome": "passed"}}, {"nodeid": "tests/entity/test_timer_counter.py::test_counter_increment", "lineno": 53, "outcome": "failed", "keywords": ["test_counter_increment", "test_timer_counter.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005525385029613972, "outcome": "passed"}, "call": {"duration": 0.002639716025441885, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py", "lineno": 118, "message": "httpx.ReadError"}, "traceback": [{"path": "tests/entity/test_timer_counter.py", "lineno": 57, "message": ""}, {"path": "tests/conftest.py", "lineno": 89, "message": "in set_state"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1859, "message": "in post"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1540, "message": "in request"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1629, "message": "in send"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1657, "message": "in _send_handling_auth"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1694, "message": "in _send_handling_redirects"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1730, "message": "in _send_single_request"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py", "lineno": 394, "message": "in handle_async_request"}, {"path": "../../anaconda3/lib/python3.9/contextlib.py", "lineno": 137, "message": "in __exit__"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py", "lineno": 118, "message": "ReadError"}], "longrepr": "@contextlib.contextmanager\n    def map_httpcore_exceptions() -> typing.Iterator[None]:\n        global HTTPCORE_EXC_MAP\n        if len(HTTPCORE_EXC_MAP) == 0:\n            HTTPCORE_EXC_MAP = _load_httpcore_exceptions()\n        try:\n>           yield\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:101: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:394: in handle_async_request\n    resp = await self._pool.handle_async_request(req)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/connection_pool.py:256: in handle_async_request\n    raise exc from None\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/connection_pool.py:236: in handle_async_request\n    response = await connection.handle_async_request(\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/connection.py:103: in handle_async_request\n    return await self._connection.handle_async_request(request)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:136: in handle_async_request\n    raise exc\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:106: in handle_async_request\n    ) = await self._receive_response_headers(**kwargs)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:177: in _receive_response_headers\n    event = await self._receive_event(timeout=timeout)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:217: in _receive_event\n    data = await self._network_stream.read(\n../../anaconda3/lib/python3.9/site-packages/httpcore/_backends/anyio.py:37: in read\n    return b\"\"\n../../anaconda3/lib/python3.9/contextlib.py:137: in __exit__\n    self.gen.throw(typ, value, traceback)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nmap = {<class 'TimeoutError'>: <class 'httpcore.ReadTimeout'>, <class 'anyio.BrokenResourceError'>: <class 'httpcore.ReadErr... 'anyio.ClosedResourceError'>: <class 'httpcore.ReadError'>, <class 'anyio.EndOfStream'>: <class 'httpcore.ReadError'>}\n\n    @contextlib.contextmanager\n    def map_exceptions(map: ExceptionMapping) -> typing.Iterator[None]:\n        try:\n            yield\n        except Exception as exc:  # noqa: PIE786\n            for from_exc, to_exc in map.items():\n                if isinstance(exc, from_exc):\n>                   raise to_exc(exc) from exc\nE                   httpcore.ReadError\n\n../../anaconda3/lib/python3.9/site-packages/httpcore/_exceptions.py:14: ReadError\n\nThe above exception was the direct cause of the following exception:\n\nrest = <conftest.RESTClient object at 0x7f47b036ac10>\n\n    async def test_counter_increment(rest):\n        \"\"\"counter.increment increases counter by 1.\"\"\"\n        entity_id = \"counter.test_inc\"\n>       await rest.set_state(entity_id, \"0\")\n\ntests/entity/test_timer_counter.py:57: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:89: in set_state\n    resp = await self.client.post(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1859: in post\n    return await self.request(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1540: in request\n    return await self.send(request, auth=auth, follow_redirects=follow_redirects)\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1629: in send\n    response = await self._send_handling_auth(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1657: in _send_handling_auth\n    response = await self._send_handling_redirects(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1694: in _send_handling_redirects\n    response = await self._send_single_request(request)\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1730: in _send_single_request\n    response = await transport.handle_async_request(request)\n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:394: in handle_async_request\n    resp = await self._pool.handle_async_request(req)\n../../anaconda3/lib/python3.9/contextlib.py:137: in __exit__\n    self.gen.throw(typ, value, traceback)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\n    @contextlib.contextmanager\n    def map_httpcore_exceptions() -> typing.Iterator[None]:\n        global HTTPCORE_EXC_MAP\n        if len(HTTPCORE_EXC_MAP) == 0:\n            HTTPCORE_EXC_MAP = _load_httpcore_exceptions()\n        try:\n            yield\n        except Exception as exc:\n            mapped_exc = None\n    \n            for from_exc, to_exc in HTTPCORE_EXC_MAP.items():\n                if not isinstance(exc, from_exc):\n                    continue\n                # We want to map to the most specific exception we can find.\n                # Eg if `exc` is an `httpcore.ReadTimeout`, we want to map to\n                # `httpx.ReadTimeout`, not just `httpx.TimeoutException`.\n                if mapped_exc is None or issubclass(to_exc, mapped_exc):\n                    mapped_exc = to_exc\n    \n            if mapped_exc is None:  # pragma: no cover\n                raise\n    \n            message = str(exc)\n>           raise mapped_exc(message) from exc\nE           httpx.ReadError\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:118: ReadError"}, "teardown": {"duration": 0.0005600061267614365, "outcome": "passed"}}, {"nodeid": "tests/entity/test_timer_counter.py::test_counter_decrement", "lineno": 62, "outcome": "failed", "keywords": ["test_counter_decrement", "test_timer_counter.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005950134713202715, "outcome": "passed"}, "call": {"duration": 0.001931631937623024, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py", "lineno": 118, "message": "httpx.ReadError"}, "traceback": [{"path": "tests/entity/test_timer_counter.py", "lineno": 66, "message": ""}, {"path": "tests/conftest.py", "lineno": 89, "message": "in set_state"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1859, "message": "in post"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1540, "message": "in request"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1629, "message": "in send"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1657, "message": "in _send_handling_auth"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1694, "message": "in _send_handling_redirects"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1730, "message": "in _send_single_request"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py", "lineno": 394, "message": "in handle_async_request"}, {"path": "../../anaconda3/lib/python3.9/contextlib.py", "lineno": 137, "message": "in __exit__"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py", "lineno": 118, "message": "ReadError"}], "longrepr": "@contextlib.contextmanager\n    def map_httpcore_exceptions() -> typing.Iterator[None]:\n        global HTTPCORE_EXC_MAP\n        if len(HTTPCORE_EXC_MAP) == 0:\n            HTTPCORE_EXC_MAP = _load_httpcore_exceptions()\n        try:\n>           yield\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:101: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:394: in handle_async_request\n    resp = await self._pool.handle_async_request(req)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/connection_pool.py:256: in handle_async_request\n    raise exc from None\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/connection_pool.py:236: in handle_async_request\n    response = await connection.handle_async_request(\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/connection.py:103: in handle_async_request\n    return await self._connection.handle_async_request(request)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:136: in handle_async_request\n    raise exc\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:106: in handle_async_request\n    ) = await self._receive_response_headers(**kwargs)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:177: in _receive_response_headers\n    event = await self._receive_event(timeout=timeout)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:217: in _receive_event\n    data = await self._network_stream.read(\n../../anaconda3/lib/python3.9/site-packages/httpcore/_backends/anyio.py:37: in read\n    return b\"\"\n../../anaconda3/lib/python3.9/contextlib.py:137: in __exit__\n    self.gen.throw(typ, value, traceback)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nmap = {<class 'TimeoutError'>: <class 'httpcore.ReadTimeout'>, <class 'anyio.BrokenResourceError'>: <class 'httpcore.ReadErr... 'anyio.ClosedResourceError'>: <class 'httpcore.ReadError'>, <class 'anyio.EndOfStream'>: <class 'httpcore.ReadError'>}\n\n    @contextlib.contextmanager\n    def map_exceptions(map: ExceptionMapping) -> typing.Iterator[None]:\n        try:\n            yield\n        except Exception as exc:  # noqa: PIE786\n            for from_exc, to_exc in map.items():\n                if isinstance(exc, from_exc):\n>                   raise to_exc(exc) from exc\nE                   httpcore.ReadError\n\n../../anaconda3/lib/python3.9/site-packages/httpcore/_exceptions.py:14: ReadError\n\nThe above exception was the direct cause of the following exception:\n\nrest = <conftest.RESTClient object at 0x7f47ab2e7eb0>\n\n    async def test_counter_decrement(rest):\n        \"\"\"counter.decrement decreases counter by 1.\"\"\"\n        entity_id = \"counter.test_dec\"\n>       await rest.set_state(entity_id, \"5\")\n\ntests/entity/test_timer_counter.py:66: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:89: in set_state\n    resp = await self.client.post(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1859: in post\n    return await self.request(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1540: in request\n    return await self.send(request, auth=auth, follow_redirects=follow_redirects)\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1629: in send\n    response = await self._send_handling_auth(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1657: in _send_handling_auth\n    response = await self._send_handling_redirects(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1694: in _send_handling_redirects\n    response = await self._send_single_request(request)\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1730: in _send_single_request\n    response = await transport.handle_async_request(request)\n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:394: in handle_async_request\n    resp = await self._pool.handle_async_request(req)\n../../anaconda3/lib/python3.9/contextlib.py:137: in __exit__\n    self.gen.throw(typ, value, traceback)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\n    @contextlib.contextmanager\n    def map_httpcore_exceptions() -> typing.Iterator[None]:\n        global HTTPCORE_EXC_MAP\n        if len(HTTPCORE_EXC_MAP) == 0:\n            HTTPCORE_EXC_MAP = _load_httpcore_exceptions()\n        try:\n            yield\n        except Exception as exc:\n            mapped_exc = None\n    \n            for from_exc, to_exc in HTTPCORE_EXC_MAP.items():\n                if not isinstance(exc, from_exc):\n                    continue\n                # We want to map to the most specific exception we can find.\n                # Eg if `exc` is an `httpcore.ReadTimeout`, we want to map to\n                # `httpx.ReadTimeout`, not just `httpx.TimeoutException`.\n                if mapped_exc is None or issubclass(to_exc, mapped_exc):\n                    mapped_exc = to_exc\n    \n            if mapped_exc is None:  # pragma: no cover\n                raise\n    \n            message = str(exc)\n>           raise mapped_exc(message) from exc\nE           httpx.ReadError\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:118: ReadError"}, "teardown": {"duration": 0.0005647488869726658, "outcome": "passed"}}, {"nodeid": "tests/entity/test_timer_counter.py::test_counter_reset[42-initial_attr0-0]", "lineno": 71, "outcome": "failed", "keywords": ["test_counter_reset[42-initial_attr0-0]", "parametrize", "pytestmark", "42-initial_attr0-0", "test_timer_counter.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005517332814633846, "outcome": "passed"}, "call": {"duration": 0.001821562647819519, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py", "lineno": 118, "message": "httpx.ReadError"}, "traceback": [{"path": "tests/entity/test_timer_counter.py", "lineno": 81, "message": ""}, {"path": "tests/conftest.py", "lineno": 89, "message": "in set_state"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1859, "message": "in post"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1540, "message": "in request"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1629, "message": "in send"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1657, "message": "in _send_handling_auth"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1694, "message": "in _send_handling_redirects"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1730, "message": "in _send_single_request"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py", "lineno": 394, "message": "in handle_async_request"}, {"path": "../../anaconda3/lib/python3.9/contextlib.py", "lineno": 137, "message": "in __exit__"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py", "lineno": 118, "message": "ReadError"}], "longrepr": "@contextlib.contextmanager\n    def map_httpcore_exceptions() -> typing.Iterator[None]:\n        global HTTPCORE_EXC_MAP\n        if len(HTTPCORE_EXC_MAP) == 0:\n            HTTPCORE_EXC_MAP = _load_httpcore_exceptions()\n        try:\n>           yield\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:101: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:394: in handle_async_request\n    resp = await self._pool.handle_async_request(req)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/connection_pool.py:256: in handle_async_request\n    raise exc from None\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/connection_pool.py:236: in handle_async_request\n    response = await connection.handle_async_request(\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/connection.py:103: in handle_async_request\n    return await self._connection.handle_async_request(request)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:136: in handle_async_request\n    raise exc\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:106: in handle_async_request\n    ) = await self._receive_response_headers(**kwargs)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:177: in _receive_response_headers\n    event = await self._receive_event(timeout=timeout)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:217: in _receive_event\n    data = await self._network_stream.read(\n../../anaconda3/lib/python3.9/site-packages/httpcore/_backends/anyio.py:37: in read\n    return b\"\"\n../../anaconda3/lib/python3.9/contextlib.py:137: in __exit__\n    self.gen.throw(typ, value, traceback)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nmap = {<class 'TimeoutError'>: <class 'httpcore.ReadTimeout'>, <class 'anyio.BrokenResourceError'>: <class 'httpcore.ReadErr... 'anyio.ClosedResourceError'>: <class 'httpcore.ReadError'>, <class 'anyio.EndOfStream'>: <class 'httpcore.ReadError'>}\n\n    @contextlib.contextmanager\n    def map_exceptions(map: ExceptionMapping) -> typing.Iterator[None]:\n        try:\n            yield\n        except Exception as exc:  # noqa: PIE786\n            for from_exc, to_exc in map.items():\n                if isinstance(exc, from_exc):\n>                   raise to_exc(exc) from exc\nE                   httpcore.ReadError\n\n../../anaconda3/lib/python3.9/site-packages/httpcore/_exceptions.py:14: ReadError\n\nThe above exception was the direct cause of the following exception:\n\nrest = <conftest.RESTClient object at 0x7f47b22c39a0>, initial_value = '42'\ninitial_attr = {}, expected = '0'\n\n    @pytest.mark.parametrize(\"initial_value,initial_attr,expected\", [\n        (\"42\", {}, \"0\"),\n        (\"99\", {\"initial\": 10}, \"10\"),\n        (\"10\", {\"initial\": 5}, \"5\"),\n        (\"5\", {\"initial\": 0}, \"0\"),\n    ])\n    async def test_counter_reset(rest, initial_value, initial_attr, expected):\n        \"\"\"counter.reset returns counter to initial value (default 0).\"\"\"\n        entity_id = f\"counter.test_reset_{initial_value}_{expected}\"\n>       await rest.set_state(entity_id, initial_value, initial_attr if initial_attr else None)\n\ntests/entity/test_timer_counter.py:81: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:89: in set_state\n    resp = await self.client.post(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1859: in post\n    return await self.request(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1540: in request\n    return await self.send(request, auth=auth, follow_redirects=follow_redirects)\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1629: in send\n    response = await self._send_handling_auth(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1657: in _send_handling_auth\n    response = await self._send_handling_redirects(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1694: in _send_handling_redirects\n    response = await self._send_single_request(request)\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1730: in _send_single_request\n    response = await transport.handle_async_request(request)\n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:394: in handle_async_request\n    resp = await self._pool.handle_async_request(req)\n../../anaconda3/lib/python3.9/contextlib.py:137: in __exit__\n    self.gen.throw(typ, value, traceback)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\n    @contextlib.contextmanager\n    def map_httpcore_exceptions() -> typing.Iterator[None]:\n        global HTTPCORE_EXC_MAP\n        if len(HTTPCORE_EXC_MAP) == 0:\n            HTTPCORE_EXC_MAP = _load_httpcore_exceptions()\n        try:\n            yield\n        except Exception as exc:\n            mapped_exc = None\n    \n            for from_exc, to_exc in HTTPCORE_EXC_MAP.items():\n                if not isinstance(exc, from_exc):\n                    continue\n                # We want to map to the most specific exception we can find.\n                # Eg if `exc` is an `httpcore.ReadTimeout`, we want to map to\n                # `httpx.ReadTimeout`, not just `httpx.TimeoutException`.\n                if mapped_exc is None or issubclass(to_exc, mapped_exc):\n                    mapped_exc = to_exc\n    \n            if mapped_exc is None:  # pragma: no cover\n                raise\n    \n            message = str(exc)\n>           raise mapped_exc(message) from exc\nE           httpx.ReadError\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:118: ReadError"}, "teardown": {"duration": 0.0006399848498404026, "outcome": "passed"}}, {"nodeid": "tests/entity/test_timer_counter.py::test_counter_reset[99-initial_attr1-10]", "lineno": 71, "outcome": "failed", "keywords": ["test_counter_reset[99-initial_attr1-10]", "parametrize", "pytestmark", "99-initial_attr1-10", "test_timer_counter.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005489157047122717, "outcome": "passed"}, "call": {"duration": 0.0019707418978214264, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py", "lineno": 118, "message": "httpx.ReadError"}, "traceback": [{"path": "tests/entity/test_timer_counter.py", "lineno": 81, "message": ""}, {"path": "tests/conftest.py", "lineno": 89, "message": "in set_state"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1859, "message": "in post"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1540, "message": "in request"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1629, "message": "in send"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1657, "message": "in _send_handling_auth"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1694, "message": "in _send_handling_redirects"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1730, "message": "in _send_single_request"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py", "lineno": 394, "message": "in handle_async_request"}, {"path": "../../anaconda3/lib/python3.9/contextlib.py", "lineno": 137, "message": "in __exit__"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py", "lineno": 118, "message": "ReadError"}], "longrepr": "@contextlib.contextmanager\n    def map_httpcore_exceptions() -> typing.Iterator[None]:\n        global HTTPCORE_EXC_MAP\n        if len(HTTPCORE_EXC_MAP) == 0:\n            HTTPCORE_EXC_MAP = _load_httpcore_exceptions()\n        try:\n>           yield\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:101: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:394: in handle_async_request\n    resp = await self._pool.handle_async_request(req)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/connection_pool.py:256: in handle_async_request\n    raise exc from None\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/connection_pool.py:236: in handle_async_request\n    response = await connection.handle_async_request(\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/connection.py:103: in handle_async_request\n    return await self._connection.handle_async_request(request)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:136: in handle_async_request\n    raise exc\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:106: in handle_async_request\n    ) = await self._receive_response_headers(**kwargs)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:177: in _receive_response_headers\n    event = await self._receive_event(timeout=timeout)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:217: in _receive_event\n    data = await self._network_stream.read(\n../../anaconda3/lib/python3.9/site-packages/httpcore/_backends/anyio.py:37: in read\n    return b\"\"\n../../anaconda3/lib/python3.9/contextlib.py:137: in __exit__\n    self.gen.throw(typ, value, traceback)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nmap = {<class 'TimeoutError'>: <class 'httpcore.ReadTimeout'>, <class 'anyio.BrokenResourceError'>: <class 'httpcore.ReadErr... 'anyio.ClosedResourceError'>: <class 'httpcore.ReadError'>, <class 'anyio.EndOfStream'>: <class 'httpcore.ReadError'>}\n\n    @contextlib.contextmanager\n    def map_exceptions(map: ExceptionMapping) -> typing.Iterator[None]:\n        try:\n            yield\n        except Exception as exc:  # noqa: PIE786\n            for from_exc, to_exc in map.items():\n                if isinstance(exc, from_exc):\n>                   raise to_exc(exc) from exc\nE                   httpcore.ReadError\n\n../../anaconda3/lib/python3.9/site-packages/httpcore/_exceptions.py:14: ReadError\n\nThe above exception was the direct cause of the following exception:\n\nrest = <conftest.RESTClient object at 0x7f47b22c3eb0>, initial_value = '99'\ninitial_attr = {'initial': 10}, expected = '10'\n\n    @pytest.mark.parametrize(\"initial_value,initial_attr,expected\", [\n        (\"42\", {}, \"0\"),\n        (\"99\", {\"initial\": 10}, \"10\"),\n        (\"10\", {\"initial\": 5}, \"5\"),\n        (\"5\", {\"initial\": 0}, \"0\"),\n    ])\n    async def test_counter_reset(rest, initial_value, initial_attr, expected):\n        \"\"\"counter.reset returns counter to initial value (default 0).\"\"\"\n        entity_id = f\"counter.test_reset_{initial_value}_{expected}\"\n>       await rest.set_state(entity_id, initial_value, initial_attr if initial_attr else None)\n\ntests/entity/test_timer_counter.py:81: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:89: in set_state\n    resp = await self.client.post(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1859: in post\n    return await self.request(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1540: in request\n    return await self.send(request, auth=auth, follow_redirects=follow_redirects)\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1629: in send\n    response = await self._send_handling_auth(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1657: in _send_handling_auth\n    response = await self._send_handling_redirects(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1694: in _send_handling_redirects\n    response = await self._send_single_request(request)\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1730: in _send_single_request\n    response = await transport.handle_async_request(request)\n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:394: in handle_async_request\n    resp = await self._pool.handle_async_request(req)\n../../anaconda3/lib/python3.9/contextlib.py:137: in __exit__\n    self.gen.throw(typ, value, traceback)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\n    @contextlib.contextmanager\n    def map_httpcore_exceptions() -> typing.Iterator[None]:\n        global HTTPCORE_EXC_MAP\n        if len(HTTPCORE_EXC_MAP) == 0:\n            HTTPCORE_EXC_MAP = _load_httpcore_exceptions()\n        try:\n            yield\n        except Exception as exc:\n            mapped_exc = None\n    \n            for from_exc, to_exc in HTTPCORE_EXC_MAP.items():\n                if not isinstance(exc, from_exc):\n                    continue\n                # We want to map to the most specific exception we can find.\n                # Eg if `exc` is an `httpcore.ReadTimeout`, we want to map to\n                # `httpx.ReadTimeout`, not just `httpx.TimeoutException`.\n                if mapped_exc is None or issubclass(to_exc, mapped_exc):\n                    mapped_exc = to_exc\n    \n            if mapped_exc is None:  # pragma: no cover\n                raise\n    \n            message = str(exc)\n>           raise mapped_exc(message) from exc\nE           httpx.ReadError\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:118: ReadError"}, "teardown": {"duration": 0.0005744630470871925, "outcome": "passed"}}, {"nodeid": "tests/entity/test_timer_counter.py::test_counter_reset[10-initial_attr2-5]", "lineno": 71, "outcome": "failed", "keywords": ["test_counter_reset[10-initial_attr2-5]", "parametrize", "pytestmark", "10-initial_attr2-5", "test_timer_counter.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005802257917821407, "outcome": "passed"}, "call": {"duration": 0.0019462988711893559, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py", "lineno": 118, "message": "httpx.ReadError"}, "traceback": [{"path": "tests/entity/test_timer_counter.py", "lineno": 81, "message": ""}, {"path": "tests/conftest.py", "lineno": 89, "message": "in set_state"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1859, "message": "in post"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1540, "message": "in request"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1629, "message": "in send"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1657, "message": "in _send_handling_auth"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1694, "message": "in _send_handling_redirects"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1730, "message": "in _send_single_request"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py", "lineno": 394, "message": "in handle_async_request"}, {"path": "../../anaconda3/lib/python3.9/contextlib.py", "lineno": 137, "message": "in __exit__"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py", "lineno": 118, "message": "ReadError"}], "longrepr": "@contextlib.contextmanager\n    def map_httpcore_exceptions() -> typing.Iterator[None]:\n        global HTTPCORE_EXC_MAP\n        if len(HTTPCORE_EXC_MAP) == 0:\n            HTTPCORE_EXC_MAP = _load_httpcore_exceptions()\n        try:\n>           yield\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:101: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:394: in handle_async_request\n    resp = await self._pool.handle_async_request(req)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/connection_pool.py:256: in handle_async_request\n    raise exc from None\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/connection_pool.py:236: in handle_async_request\n    response = await connection.handle_async_request(\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/connection.py:103: in handle_async_request\n    return await self._connection.handle_async_request(request)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:136: in handle_async_request\n    raise exc\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:106: in handle_async_request\n    ) = await self._receive_response_headers(**kwargs)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:177: in _receive_response_headers\n    event = await self._receive_event(timeout=timeout)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:217: in _receive_event\n    data = await self._network_stream.read(\n../../anaconda3/lib/python3.9/site-packages/httpcore/_backends/anyio.py:37: in read\n    return b\"\"\n../../anaconda3/lib/python3.9/contextlib.py:137: in __exit__\n    self.gen.throw(typ, value, traceback)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nmap = {<class 'TimeoutError'>: <class 'httpcore.ReadTimeout'>, <class 'anyio.BrokenResourceError'>: <class 'httpcore.ReadErr... 'anyio.ClosedResourceError'>: <class 'httpcore.ReadError'>, <class 'anyio.EndOfStream'>: <class 'httpcore.ReadError'>}\n\n    @contextlib.contextmanager\n    def map_exceptions(map: ExceptionMapping) -> typing.Iterator[None]:\n        try:\n            yield\n        except Exception as exc:  # noqa: PIE786\n            for from_exc, to_exc in map.items():\n                if isinstance(exc, from_exc):\n>                   raise to_exc(exc) from exc\nE                   httpcore.ReadError\n\n../../anaconda3/lib/python3.9/site-packages/httpcore/_exceptions.py:14: ReadError\n\nThe above exception was the direct cause of the following exception:\n\nrest = <conftest.RESTClient object at 0x7f47ab72d940>, initial_value = '10'\ninitial_attr = {'initial': 5}, expected = '5'\n\n    @pytest.mark.parametrize(\"initial_value,initial_attr,expected\", [\n        (\"42\", {}, \"0\"),\n        (\"99\", {\"initial\": 10}, \"10\"),\n        (\"10\", {\"initial\": 5}, \"5\"),\n        (\"5\", {\"initial\": 0}, \"0\"),\n    ])\n    async def test_counter_reset(rest, initial_value, initial_attr, expected):\n        \"\"\"counter.reset returns counter to initial value (default 0).\"\"\"\n        entity_id = f\"counter.test_reset_{initial_value}_{expected}\"\n>       await rest.set_state(entity_id, initial_value, initial_attr if initial_attr else None)\n\ntests/entity/test_timer_counter.py:81: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:89: in set_state\n    resp = await self.client.post(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1859: in post\n    return await self.request(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1540: in request\n    return await self.send(request, auth=auth, follow_redirects=follow_redirects)\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1629: in send\n    response = await self._send_handling_auth(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1657: in _send_handling_auth\n    response = await self._send_handling_redirects(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1694: in _send_handling_redirects\n    response = await self._send_single_request(request)\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1730: in _send_single_request\n    response = await transport.handle_async_request(request)\n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:394: in handle_async_request\n    resp = await self._pool.handle_async_request(req)\n../../anaconda3/lib/python3.9/contextlib.py:137: in __exit__\n    self.gen.throw(typ, value, traceback)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\n    @contextlib.contextmanager\n    def map_httpcore_exceptions() -> typing.Iterator[None]:\n        global HTTPCORE_EXC_MAP\n        if len(HTTPCORE_EXC_MAP) == 0:\n            HTTPCORE_EXC_MAP = _load_httpcore_exceptions()\n        try:\n            yield\n        except Exception as exc:\n            mapped_exc = None\n    \n            for from_exc, to_exc in HTTPCORE_EXC_MAP.items():\n                if not isinstance(exc, from_exc):\n                    continue\n                # We want to map to the most specific exception we can find.\n                # Eg if `exc` is an `httpcore.ReadTimeout`, we want to map to\n                # `httpx.ReadTimeout`, not just `httpx.TimeoutException`.\n                if mapped_exc is None or issubclass(to_exc, mapped_exc):\n                    mapped_exc = to_exc\n    \n            if mapped_exc is None:  # pragma: no cover\n                raise\n    \n            message = str(exc)\n>           raise mapped_exc(message) from exc\nE           httpx.ReadError\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:118: ReadError"}, "teardown": {"duration": 0.0007057702168822289, "outcome": "passed"}}, {"nodeid": "tests/entity/test_timer_counter.py::test_counter_reset[5-initial_attr3-0]", "lineno": 71, "outcome": "failed", "keywords": ["test_counter_reset[5-initial_attr3-0]", "parametrize", "pytestmark", "5-initial_attr3-0", "test_timer_counter.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.006390524562448263, "outcome": "passed"}, "call": {"duration": 0.002047461923211813, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py", "lineno": 118, "message": "httpx.ReadError"}, "traceback": [{"path": "tests/entity/test_timer_counter.py", "lineno": 81, "message": ""}, {"path": "tests/conftest.py", "lineno": 89, "message": "in set_state"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1859, "message": "in post"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1540, "message": "in request"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1629, "message": "in send"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1657, "message": "in _send_handling_auth"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1694, "message": "in _send_handling_redirects"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1730, "message": "in _send_single_request"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py", "lineno": 394, "message": "in handle_async_request"}, {"path": "../../anaconda3/lib/python3.9/contextlib.py", "lineno": 137, "message": "in __exit__"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py", "lineno": 118, "message": "ReadError"}], "longrepr": "@contextlib.contextmanager\n    def map_httpcore_exceptions() -> typing.Iterator[None]:\n        global HTTPCORE_EXC_MAP\n        if len(HTTPCORE_EXC_MAP) == 0:\n            HTTPCORE_EXC_MAP = _load_httpcore_exceptions()\n        try:\n>           yield\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:101: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:394: in handle_async_request\n    resp = await self._pool.handle_async_request(req)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/connection_pool.py:256: in handle_async_request\n    raise exc from None\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/connection_pool.py:236: in handle_async_request\n    response = await connection.handle_async_request(\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/connection.py:103: in handle_async_request\n    return await self._connection.handle_async_request(request)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:136: in handle_async_request\n    raise exc\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:106: in handle_async_request\n    ) = await self._receive_response_headers(**kwargs)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:177: in _receive_response_headers\n    event = await self._receive_event(timeout=timeout)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:217: in _receive_event\n    data = await self._network_stream.read(\n../../anaconda3/lib/python3.9/site-packages/httpcore/_backends/anyio.py:37: in read\n    return b\"\"\n../../anaconda3/lib/python3.9/contextlib.py:137: in __exit__\n    self.gen.throw(typ, value, traceback)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nmap = {<class 'TimeoutError'>: <class 'httpcore.ReadTimeout'>, <class 'anyio.BrokenResourceError'>: <class 'httpcore.ReadErr... 'anyio.ClosedResourceError'>: <class 'httpcore.ReadError'>, <class 'anyio.EndOfStream'>: <class 'httpcore.ReadError'>}\n\n    @contextlib.contextmanager\n    def map_exceptions(map: ExceptionMapping) -> typing.Iterator[None]:\n        try:\n            yield\n        except Exception as exc:  # noqa: PIE786\n            for from_exc, to_exc in map.items():\n                if isinstance(exc, from_exc):\n>                   raise to_exc(exc) from exc\nE                   httpcore.ReadError\n\n../../anaconda3/lib/python3.9/site-packages/httpcore/_exceptions.py:14: ReadError\n\nThe above exception was the direct cause of the following exception:\n\nrest = <conftest.RESTClient object at 0x7f47ab4adcd0>, initial_value = '5'\ninitial_attr = {'initial': 0}, expected = '0'\n\n    @pytest.mark.parametrize(\"initial_value,initial_attr,expected\", [\n        (\"42\", {}, \"0\"),\n        (\"99\", {\"initial\": 10}, \"10\"),\n        (\"10\", {\"initial\": 5}, \"5\"),\n        (\"5\", {\"initial\": 0}, \"0\"),\n    ])\n    async def test_counter_reset(rest, initial_value, initial_attr, expected):\n        \"\"\"counter.reset returns counter to initial value (default 0).\"\"\"\n        entity_id = f\"counter.test_reset_{initial_value}_{expected}\"\n>       await rest.set_state(entity_id, initial_value, initial_attr if initial_attr else None)\n\ntests/entity/test_timer_counter.py:81: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:89: in set_state\n    resp = await self.client.post(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1859: in post\n    return await self.request(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1540: in request\n    return await self.send(request, auth=auth, follow_redirects=follow_redirects)\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1629: in send\n    response = await self._send_handling_auth(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1657: in _send_handling_auth\n    response = await self._send_handling_redirects(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1694: in _send_handling_redirects\n    response = await self._send_single_request(request)\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1730: in _send_single_request\n    response = await transport.handle_async_request(request)\n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:394: in handle_async_request\n    resp = await self._pool.handle_async_request(req)\n../../anaconda3/lib/python3.9/contextlib.py:137: in __exit__\n    self.gen.throw(typ, value, traceback)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\n    @contextlib.contextmanager\n    def map_httpcore_exceptions() -> typing.Iterator[None]:\n        global HTTPCORE_EXC_MAP\n        if len(HTTPCORE_EXC_MAP) == 0:\n            HTTPCORE_EXC_MAP = _load_httpcore_exceptions()\n        try:\n            yield\n        except Exception as exc:\n            mapped_exc = None\n    \n            for from_exc, to_exc in HTTPCORE_EXC_MAP.items():\n                if not isinstance(exc, from_exc):\n                    continue\n                # We want to map to the most specific exception we can find.\n                # Eg if `exc` is an `httpcore.ReadTimeout`, we want to map to\n                # `httpx.ReadTimeout`, not just `httpx.TimeoutException`.\n                if mapped_exc is None or issubclass(to_exc, mapped_exc):\n                    mapped_exc = to_exc\n    \n            if mapped_exc is None:  # pragma: no cover\n                raise\n    \n            message = str(exc)\n>           raise mapped_exc(message) from exc\nE           httpx.ReadError\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:118: ReadError"}, "teardown": {"duration": 0.0005790800787508488, "outcome": "passed"}}, {"nodeid": "tests/entity/test_timer_counter.py::test_counter_multiple_increments", "lineno": 86, "outcome": "failed", "keywords": ["test_counter_multiple_increments", "test_timer_counter.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005377653986215591, "outcome": "passed"}, "call": {"duration": 0.0019224327988922596, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py", "lineno": 118, "message": "httpx.ReadError"}, "traceback": [{"path": "tests/entity/test_timer_counter.py", "lineno": 90, "message": ""}, {"path": "tests/conftest.py", "lineno": 89, "message": "in set_state"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1859, "message": "in post"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1540, "message": "in request"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1629, "message": "in send"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1657, "message": "in _send_handling_auth"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1694, "message": "in _send_handling_redirects"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1730, "message": "in _send_single_request"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py", "lineno": 394, "message": "in handle_async_request"}, {"path": "../../anaconda3/lib/python3.9/contextlib.py", "lineno": 137, "message": "in __exit__"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py", "lineno": 118, "message": "ReadError"}], "longrepr": "@contextlib.contextmanager\n    def map_httpcore_exceptions() -> typing.Iterator[None]:\n        global HTTPCORE_EXC_MAP\n        if len(HTTPCORE_EXC_MAP) == 0:\n            HTTPCORE_EXC_MAP = _load_httpcore_exceptions()\n        try:\n>           yield\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:101: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:394: in handle_async_request\n    resp = await self._pool.handle_async_request(req)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/connection_pool.py:256: in handle_async_request\n    raise exc from None\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/connection_pool.py:236: in handle_async_request\n    response = await connection.handle_async_request(\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/connection.py:103: in handle_async_request\n    return await self._connection.handle_async_request(request)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:136: in handle_async_request\n    raise exc\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:106: in handle_async_request\n    ) = await self._receive_response_headers(**kwargs)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:177: in _receive_response_headers\n    event = await self._receive_event(timeout=timeout)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:217: in _receive_event\n    data = await self._network_stream.read(\n../../anaconda3/lib/python3.9/site-packages/httpcore/_backends/anyio.py:37: in read\n    return b\"\"\n../../anaconda3/lib/python3.9/contextlib.py:137: in __exit__\n    self.gen.throw(typ, value, traceback)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nmap = {<class 'TimeoutError'>: <class 'httpcore.ReadTimeout'>, <class 'anyio.BrokenResourceError'>: <class 'httpcore.ReadErr... 'anyio.ClosedResourceError'>: <class 'httpcore.ReadError'>, <class 'anyio.EndOfStream'>: <class 'httpcore.ReadError'>}\n\n    @contextlib.contextmanager\n    def map_exceptions(map: ExceptionMapping) -> typing.Iterator[None]:\n        try:\n            yield\n        except Exception as exc:  # noqa: PIE786\n            for from_exc, to_exc in map.items():\n                if isinstance(exc, from_exc):\n>                   raise to_exc(exc) from exc\nE                   httpcore.ReadError\n\n../../anaconda3/lib/python3.9/site-packages/httpcore/_exceptions.py:14: ReadError\n\nThe above exception was the direct cause of the following exception:\n\nrest = <conftest.RESTClient object at 0x7f47b22c34f0>\n\n    async def test_counter_multiple_increments(rest):\n        \"\"\"Multiple increments accumulate correctly.\"\"\"\n        entity_id = \"counter.multi_inc\"\n>       await rest.set_state(entity_id, \"0\")\n\ntests/entity/test_timer_counter.py:90: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:89: in set_state\n    resp = await self.client.post(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1859: in post\n    return await self.request(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1540: in request\n    return await self.send(request, auth=auth, follow_redirects=follow_redirects)\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1629: in send\n    response = await self._send_handling_auth(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1657: in _send_handling_auth\n    response = await self._send_handling_redirects(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1694: in _send_handling_redirects\n    response = await self._send_single_request(request)\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1730: in _send_single_request\n    response = await transport.handle_async_request(request)\n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:394: in handle_async_request\n    resp = await self._pool.handle_async_request(req)\n../../anaconda3/lib/python3.9/contextlib.py:137: in __exit__\n    self.gen.throw(typ, value, traceback)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\n    @contextlib.contextmanager\n    def map_httpcore_exceptions() -> typing.Iterator[None]:\n        global HTTPCORE_EXC_MAP\n        if len(HTTPCORE_EXC_MAP) == 0:\n            HTTPCORE_EXC_MAP = _load_httpcore_exceptions()\n        try:\n            yield\n        except Exception as exc:\n            mapped_exc = None\n    \n            for from_exc, to_exc in HTTPCORE_EXC_MAP.items():\n                if not isinstance(exc, from_exc):\n                    continue\n                # We want to map to the most specific exception we can find.\n                # Eg if `exc` is an `httpcore.ReadTimeout`, we want to map to\n                # `httpx.ReadTimeout`, not just `httpx.TimeoutException`.\n                if mapped_exc is None or issubclass(to_exc, mapped_exc):\n                    mapped_exc = to_exc\n    \n            if mapped_exc is None:  # pragma: no cover\n                raise\n    \n            message = str(exc)\n>           raise mapped_exc(message) from exc\nE           httpx.ReadError\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:118: ReadError"}, "teardown": {"duration": 0.0006537400186061859, "outcome": "passed"}}, {"nodeid": "tests/entity/test_timer_counter.py::test_counter_negative", "lineno": 96, "outcome": "failed", "keywords": ["test_counter_negative", "test_timer_counter.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.006022087763994932, "outcome": "passed"}, "call": {"duration": 0.002061803825199604, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py", "lineno": 118, "message": "httpx.ReadError"}, "traceback": [{"path": "tests/entity/test_timer_counter.py", "lineno": 100, "message": ""}, {"path": "tests/conftest.py", "lineno": 89, "message": "in set_state"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1859, "message": "in post"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1540, "message": "in request"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1629, "message": "in send"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1657, "message": "in _send_handling_auth"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1694, "message": "in _send_handling_redirects"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1730, "message": "in _send_single_request"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py", "lineno": 394, "message": "in handle_async_request"}, {"path": "../../anaconda3/lib/python3.9/contextlib.py", "lineno": 137, "message": "in __exit__"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py", "lineno": 118, "message": "ReadError"}], "longrepr": "@contextlib.contextmanager\n    def map_httpcore_exceptions() -> typing.Iterator[None]:\n        global HTTPCORE_EXC_MAP\n        if len(HTTPCORE_EXC_MAP) == 0:\n            HTTPCORE_EXC_MAP = _load_httpcore_exceptions()\n        try:\n>           yield\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:101: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:394: in handle_async_request\n    resp = await self._pool.handle_async_request(req)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/connection_pool.py:256: in handle_async_request\n    raise exc from None\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/connection_pool.py:236: in handle_async_request\n    response = await connection.handle_async_request(\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/connection.py:103: in handle_async_request\n    return await self._connection.handle_async_request(request)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:136: in handle_async_request\n    raise exc\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:106: in handle_async_request\n    ) = await self._receive_response_headers(**kwargs)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:177: in _receive_response_headers\n    event = await self._receive_event(timeout=timeout)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:217: in _receive_event\n    data = await self._network_stream.read(\n../../anaconda3/lib/python3.9/site-packages/httpcore/_backends/anyio.py:37: in read\n    return b\"\"\n../../anaconda3/lib/python3.9/contextlib.py:137: in __exit__\n    self.gen.throw(typ, value, traceback)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nmap = {<class 'TimeoutError'>: <class 'httpcore.ReadTimeout'>, <class 'anyio.BrokenResourceError'>: <class 'httpcore.ReadErr... 'anyio.ClosedResourceError'>: <class 'httpcore.ReadError'>, <class 'anyio.EndOfStream'>: <class 'httpcore.ReadError'>}\n\n    @contextlib.contextmanager\n    def map_exceptions(map: ExceptionMapping) -> typing.Iterator[None]:\n        try:\n            yield\n        except Exception as exc:  # noqa: PIE786\n            for from_exc, to_exc in map.items():\n                if isinstance(exc, from_exc):\n>                   raise to_exc(exc) from exc\nE                   httpcore.ReadError\n\n../../anaconda3/lib/python3.9/site-packages/httpcore/_exceptions.py:14: ReadError\n\nThe above exception was the direct cause of the following exception:\n\nrest = <conftest.RESTClient object at 0x7f47b22ec0d0>\n\n    async def test_counter_negative(rest):\n        \"\"\"Counter can go negative with decrement.\"\"\"\n        entity_id = \"counter.negative\"\n>       await rest.set_state(entity_id, \"0\")\n\ntests/entity/test_timer_counter.py:100: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:89: in set_state\n    resp = await self.client.post(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1859: in post\n    return await self.request(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1540: in request\n    return await self.send(request, auth=auth, follow_redirects=follow_redirects)\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1629: in send\n    response = await self._send_handling_auth(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1657: in _send_handling_auth\n    response = await self._send_handling_redirects(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1694: in _send_handling_redirects\n    response = await self._send_single_request(request)\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1730: in _send_single_request\n    response = await transport.handle_async_request(request)\n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:394: in handle_async_request\n    resp = await self._pool.handle_async_request(req)\n../../anaconda3/lib/python3.9/contextlib.py:137: in __exit__\n    self.gen.throw(typ, value, traceback)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\n    @contextlib.contextmanager\n    def map_httpcore_exceptions() -> typing.Iterator[None]:\n        global HTTPCORE_EXC_MAP\n        if len(HTTPCORE_EXC_MAP) == 0:\n            HTTPCORE_EXC_MAP = _load_httpcore_exceptions()\n        try:\n            yield\n        except Exception as exc:\n            mapped_exc = None\n    \n            for from_exc, to_exc in HTTPCORE_EXC_MAP.items():\n                if not isinstance(exc, from_exc):\n                    continue\n                # We want to map to the most specific exception we can find.\n                # Eg if `exc` is an `httpcore.ReadTimeout`, we want to map to\n                # `httpx.ReadTimeout`, not just `httpx.TimeoutException`.\n                if mapped_exc is None or issubclass(to_exc, mapped_exc):\n                    mapped_exc = to_exc\n    \n            if mapped_exc is None:  # pragma: no cover\n                raise\n    \n            message = str(exc)\n>           raise mapped_exc(message) from exc\nE           httpx.ReadError\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:118: ReadError"}, "teardown": {"duration": 0.0006466200575232506, "outcome": "passed"}}, {"nodeid": "tests/entity/test_timer_counter.py::test_counter_preserves_attrs", "lineno": 107, "outcome": "failed", "keywords": ["test_counter_preserves_attrs", "test_timer_counter.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005464332643896341, "outcome": "passed"}, "call": {"duration": 0.0018410072661936283, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py", "lineno": 118, "message": "httpx.ReadError"}, "traceback": [{"path": "tests/entity/test_timer_counter.py", "lineno": 110, "message": ""}, {"path": "tests/conftest.py", "lineno": 89, "message": "in set_state"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1859, "message": "in post"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1540, "message": "in request"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1629, "message": "in send"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1657, "message": "in _send_handling_auth"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1694, "message": "in _send_handling_redirects"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1730, "message": "in _send_single_request"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py", "lineno": 394, "message": "in handle_async_request"}, {"path": "../../anaconda3/lib/python3.9/contextlib.py", "lineno": 137, "message": "in __exit__"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py", "lineno": 118, "message": "ReadError"}], "longrepr": "@contextlib.contextmanager\n    def map_httpcore_exceptions() -> typing.Iterator[None]:\n        global HTTPCORE_EXC_MAP\n        if len(HTTPCORE_EXC_MAP) == 0:\n            HTTPCORE_EXC_MAP = _load_httpcore_exceptions()\n        try:\n>           yield\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:101: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:394: in handle_async_request\n    resp = await self._pool.handle_async_request(req)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/connection_pool.py:256: in handle_async_request\n    raise exc from None\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/connection_pool.py:236: in handle_async_request\n    response = await connection.handle_async_request(\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/connection.py:103: in handle_async_request\n    return await self._connection.handle_async_request(request)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:136: in handle_async_request\n    raise exc\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:106: in handle_async_request\n    ) = await self._receive_response_headers(**kwargs)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:177: in _receive_response_headers\n    event = await self._receive_event(timeout=timeout)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:217: in _receive_event\n    data = await self._network_stream.read(\n../../anaconda3/lib/python3.9/site-packages/httpcore/_backends/anyio.py:37: in read\n    return b\"\"\n../../anaconda3/lib/python3.9/contextlib.py:137: in __exit__\n    self.gen.throw(typ, value, traceback)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nmap = {<class 'TimeoutError'>: <class 'httpcore.ReadTimeout'>, <class 'anyio.BrokenResourceError'>: <class 'httpcore.ReadErr... 'anyio.ClosedResourceError'>: <class 'httpcore.ReadError'>, <class 'anyio.EndOfStream'>: <class 'httpcore.ReadError'>}\n\n    @contextlib.contextmanager\n    def map_exceptions(map: ExceptionMapping) -> typing.Iterator[None]:\n        try:\n            yield\n        except Exception as exc:  # noqa: PIE786\n            for from_exc, to_exc in map.items():\n                if isinstance(exc, from_exc):\n>                   raise to_exc(exc) from exc\nE                   httpcore.ReadError\n\n../../anaconda3/lib/python3.9/site-packages/httpcore/_exceptions.py:14: ReadError\n\nThe above exception was the direct cause of the following exception:\n\nrest = <conftest.RESTClient object at 0x7f47b00302e0>\n\n    async def test_counter_preserves_attrs(rest):\n        \"\"\"Counter operations preserve attributes.\"\"\"\n>       await rest.set_state(\"counter.depth_c7\", \"0\", {\"step\": 1, \"minimum\": 0})\n\ntests/entity/test_timer_counter.py:110: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:89: in set_state\n    resp = await self.client.post(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1859: in post\n    return await self.request(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1540: in request\n    return await self.send(request, auth=auth, follow_redirects=follow_redirects)\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1629: in send\n    response = await self._send_handling_auth(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1657: in _send_handling_auth\n    response = await self._send_handling_redirects(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1694: in _send_handling_redirects\n    response = await self._send_single_request(request)\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1730: in _send_single_request\n    response = await transport.handle_async_request(request)\n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:394: in handle_async_request\n    resp = await self._pool.handle_async_request(req)\n../../anaconda3/lib/python3.9/contextlib.py:137: in __exit__\n    self.gen.throw(typ, value, traceback)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\n    @contextlib.contextmanager\n    def map_httpcore_exceptions() -> typing.Iterator[None]:\n        global HTTPCORE_EXC_MAP\n        if len(HTTPCORE_EXC_MAP) == 0:\n            HTTPCORE_EXC_MAP = _load_httpcore_exceptions()\n        try:\n            yield\n        except Exception as exc:\n            mapped_exc = None\n    \n            for from_exc, to_exc in HTTPCORE_EXC_MAP.items():\n                if not isinstance(exc, from_exc):\n                    continue\n                # We want to map to the most specific exception we can find.\n                # Eg if `exc` is an `httpcore.ReadTimeout`, we want to map to\n                # `httpx.ReadTimeout`, not just `httpx.TimeoutException`.\n                if mapped_exc is None or issubclass(to_exc, mapped_exc):\n                    mapped_exc = to_exc\n    \n            if mapped_exc is None:  # pragma: no cover\n                raise\n    \n            message = str(exc)\n>           raise mapped_exc(message) from exc\nE           httpx.ReadError\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:118: ReadError"}, "teardown": {"duration": 0.0005767159163951874, "outcome": "passed"}}, {"nodeid": "tests/entity/test_timer_counter_humidifier_text.py::test_timer_start", "lineno": 16, "outcome": "failed", "keywords": ["test_timer_start", "test_timer_counter_humidifier_text.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.00525599904358387, "outcome": "passed"}, "call": {"duration": 0.0018170112743973732, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py", "lineno": 118, "message": "httpx.ReadError"}, "traceback": [{"path": "tests/entity/test_timer_counter_humidifier_text.py", "lineno": 21, "message": ""}, {"path": "tests/conftest.py", "lineno": 89, "message": "in set_state"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1859, "message": "in post"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1540, "message": "in request"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1629, "message": "in send"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1657, "message": "in _send_handling_auth"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1694, "message": "in _send_handling_redirects"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1730, "message": "in _send_single_request"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py", "lineno": 394, "message": "in handle_async_request"}, {"path": "../../anaconda3/lib/python3.9/contextlib.py", "lineno": 137, "message": "in __exit__"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py", "lineno": 118, "message": "ReadError"}], "longrepr": "@contextlib.contextmanager\n    def map_httpcore_exceptions() -> typing.Iterator[None]:\n        global HTTPCORE_EXC_MAP\n        if len(HTTPCORE_EXC_MAP) == 0:\n            HTTPCORE_EXC_MAP = _load_httpcore_exceptions()\n        try:\n>           yield\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:101: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:394: in handle_async_request\n    resp = await self._pool.handle_async_request(req)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/connection_pool.py:256: in handle_async_request\n    raise exc from None\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/connection_pool.py:236: in handle_async_request\n    response = await connection.handle_async_request(\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/connection.py:103: in handle_async_request\n    return await self._connection.handle_async_request(request)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:136: in handle_async_request\n    raise exc\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:106: in handle_async_request\n    ) = await self._receive_response_headers(**kwargs)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:177: in _receive_response_headers\n    event = await self._receive_event(timeout=timeout)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:217: in _receive_event\n    data = await self._network_stream.read(\n../../anaconda3/lib/python3.9/site-packages/httpcore/_backends/anyio.py:37: in read\n    return b\"\"\n../../anaconda3/lib/python3.9/contextlib.py:137: in __exit__\n    self.gen.throw(typ, value, traceback)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nmap = {<class 'TimeoutError'>: <class 'httpcore.ReadTimeout'>, <class 'anyio.BrokenResourceError'>: <class 'httpcore.ReadErr... 'anyio.ClosedResourceError'>: <class 'httpcore.ReadError'>, <class 'anyio.EndOfStream'>: <class 'httpcore.ReadError'>}\n\n    @contextlib.contextmanager\n    def map_exceptions(map: ExceptionMapping) -> typing.Iterator[None]:\n        try:\n            yield\n        except Exception as exc:  # noqa: PIE786\n            for from_exc, to_exc in map.items():\n                if isinstance(exc, from_exc):\n>                   raise to_exc(exc) from exc\nE                   httpcore.ReadError\n\n../../anaconda3/lib/python3.9/site-packages/httpcore/_exceptions.py:14: ReadError\n\nThe above exception was the direct cause of the following exception:\n\nrest = <conftest.RESTClient object at 0x7f47b00302b0>\n\n    async def test_timer_start(rest):\n        \"\"\"timer.start sets state to active.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"timer.t_{tag}\"\n>       await rest.set_state(eid, \"idle\")\n\ntests/entity/test_timer_counter_humidifier_text.py:21: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:89: in set_state\n    resp = await self.client.post(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1859: in post\n    return await self.request(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1540: in request\n    return await self.send(request, auth=auth, follow_redirects=follow_redirects)\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1629: in send\n    response = await self._send_handling_auth(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1657: in _send_handling_auth\n    response = await self._send_handling_redirects(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1694: in _send_handling_redirects\n    response = await self._send_single_request(request)\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1730: in _send_single_request\n    response = await transport.handle_async_request(request)\n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:394: in handle_async_request\n    resp = await self._pool.handle_async_request(req)\n../../anaconda3/lib/python3.9/contextlib.py:137: in __exit__\n    self.gen.throw(typ, value, traceback)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\n    @contextlib.contextmanager\n    def map_httpcore_exceptions() -> typing.Iterator[None]:\n        global HTTPCORE_EXC_MAP\n        if len(HTTPCORE_EXC_MAP) == 0:\n            HTTPCORE_EXC_MAP = _load_httpcore_exceptions()\n        try:\n            yield\n        except Exception as exc:\n            mapped_exc = None\n    \n            for from_exc, to_exc in HTTPCORE_EXC_MAP.items():\n                if not isinstance(exc, from_exc):\n                    continue\n                # We want to map to the most specific exception we can find.\n                # Eg if `exc` is an `httpcore.ReadTimeout`, we want to map to\n                # `httpx.ReadTimeout`, not just `httpx.TimeoutException`.\n                if mapped_exc is None or issubclass(to_exc, mapped_exc):\n                    mapped_exc = to_exc\n    \n            if mapped_exc is None:  # pragma: no cover\n                raise\n    \n            message = str(exc)\n>           raise mapped_exc(message) from exc\nE           httpx.ReadError\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:118: ReadError"}, "teardown": {"duration": 0.0006169797852635384, "outcome": "passed"}}, {"nodeid": "tests/entity/test_timer_counter_humidifier_text.py::test_timer_pause", "lineno": 33, "outcome": "failed", "keywords": ["test_timer_pause", "test_timer_counter_humidifier_text.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005490180104970932, "outcome": "passed"}, "call": {"duration": 0.0029331231489777565, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py", "lineno": 118, "message": "httpx.ReadError"}, "traceback": [{"path": "tests/entity/test_timer_counter_humidifier_text.py", "lineno": 38, "message": ""}, {"path": "tests/conftest.py", "lineno": 89, "message": "in set_state"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1859, "message": "in post"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1540, "message": "in request"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1629, "message": "in send"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1657, "message": "in _send_handling_auth"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1694, "message": "in _send_handling_redirects"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1730, "message": "in _send_single_request"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py", "lineno": 394, "message": "in handle_async_request"}, {"path": "../../anaconda3/lib/python3.9/contextlib.py", "lineno": 137, "message": "in __exit__"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py", "lineno": 118, "message": "ReadError"}], "longrepr": "@contextlib.contextmanager\n    def map_httpcore_exceptions() -> typing.Iterator[None]:\n        global HTTPCORE_EXC_MAP\n        if len(HTTPCORE_EXC_MAP) == 0:\n            HTTPCORE_EXC_MAP = _load_httpcore_exceptions()\n        try:\n>           yield\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:101: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:394: in handle_async_request\n    resp = await self._pool.handle_async_request(req)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/connection_pool.py:256: in handle_async_request\n    raise exc from None\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/connection_pool.py:236: in handle_async_request\n    response = await connection.handle_async_request(\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/connection.py:103: in handle_async_request\n    return await self._connection.handle_async_request(request)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:136: in handle_async_request\n    raise exc\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:106: in handle_async_request\n    ) = await self._receive_response_headers(**kwargs)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:177: in _receive_response_headers\n    event = await self._receive_event(timeout=timeout)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:217: in _receive_event\n    data = await self._network_stream.read(\n../../anaconda3/lib/python3.9/site-packages/httpcore/_backends/anyio.py:37: in read\n    return b\"\"\n../../anaconda3/lib/python3.9/contextlib.py:137: in __exit__\n    self.gen.throw(typ, value, traceback)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nmap = {<class 'TimeoutError'>: <class 'httpcore.ReadTimeout'>, <class 'anyio.BrokenResourceError'>: <class 'httpcore.ReadErr... 'anyio.ClosedResourceError'>: <class 'httpcore.ReadError'>, <class 'anyio.EndOfStream'>: <class 'httpcore.ReadError'>}\n\n    @contextlib.contextmanager\n    def map_exceptions(map: ExceptionMapping) -> typing.Iterator[None]:\n        try:\n            yield\n        except Exception as exc:  # noqa: PIE786\n            for from_exc, to_exc in map.items():\n                if isinstance(exc, from_exc):\n>                   raise to_exc(exc) from exc\nE                   httpcore.ReadError\n\n../../anaconda3/lib/python3.9/site-packages/httpcore/_exceptions.py:14: ReadError\n\nThe above exception was the direct cause of the following exception:\n\nrest = <conftest.RESTClient object at 0x7f47b0030190>\n\n    async def test_timer_pause(rest):\n        \"\"\"timer.pause sets state to paused.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"timer.tp_{tag}\"\n>       await rest.set_state(eid, \"active\")\n\ntests/entity/test_timer_counter_humidifier_text.py:38: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:89: in set_state\n    resp = await self.client.post(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1859: in post\n    return await self.request(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1540: in request\n    return await self.send(request, auth=auth, follow_redirects=follow_redirects)\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1629: in send\n    response = await self._send_handling_auth(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1657: in _send_handling_auth\n    response = await self._send_handling_redirects(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1694: in _send_handling_redirects\n    response = await self._send_single_request(request)\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1730: in _send_single_request\n    response = await transport.handle_async_request(request)\n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:394: in handle_async_request\n    resp = await self._pool.handle_async_request(req)\n../../anaconda3/lib/python3.9/contextlib.py:137: in __exit__\n    self.gen.throw(typ, value, traceback)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\n    @contextlib.contextmanager\n    def map_httpcore_exceptions() -> typing.Iterator[None]:\n        global HTTPCORE_EXC_MAP\n        if len(HTTPCORE_EXC_MAP) == 0:\n            HTTPCORE_EXC_MAP = _load_httpcore_exceptions()\n        try:\n            yield\n        except Exception as exc:\n            mapped_exc = None\n    \n            for from_exc, to_exc in HTTPCORE_EXC_MAP.items():\n                if not isinstance(exc, from_exc):\n                    continue\n                # We want to map to the most specific exception we can find.\n                # Eg if `exc` is an `httpcore.ReadTimeout`, we want to map to\n                # `httpx.ReadTimeout`, not just `httpx.TimeoutException`.\n                if mapped_exc is None or issubclass(to_exc, mapped_exc):\n                    mapped_exc = to_exc\n    \n            if mapped_exc is None:  # pragma: no cover\n                raise\n    \n            message = str(exc)\n>           raise mapped_exc(message) from exc\nE           httpx.ReadError\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:118: ReadError"}, "teardown": {"duration": 0.0005477271042764187, "outcome": "passed"}}, {"nodeid": "tests/entity/test_timer_counter_humidifier_text.py::test_timer_cancel", "lineno": 50, "outcome": "failed", "keywords": ["test_timer_cancel", "test_timer_counter_humidifier_text.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.00580739788711071, "outcome": "passed"}, "call": {"duration": 0.0019420590251684189, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py", "lineno": 118, "message": "httpx.ReadError"}, "traceback": [{"path": "tests/entity/test_timer_counter_humidifier_text.py", "lineno": 55, "message": ""}, {"path": "tests/conftest.py", "lineno": 89, "message": "in set_state"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1859, "message": "in post"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1540, "message": "in request"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1629, "message": "in send"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1657, "message": "in _send_handling_auth"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1694, "message": "in _send_handling_redirects"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1730, "message": "in _send_single_request"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py", "lineno": 394, "message": "in handle_async_request"}, {"path": "../../anaconda3/lib/python3.9/contextlib.py", "lineno": 137, "message": "in __exit__"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py", "lineno": 118, "message": "ReadError"}], "longrepr": "@contextlib.contextmanager\n    def map_httpcore_exceptions() -> typing.Iterator[None]:\n        global HTTPCORE_EXC_MAP\n        if len(HTTPCORE_EXC_MAP) == 0:\n            HTTPCORE_EXC_MAP = _load_httpcore_exceptions()\n        try:\n>           yield\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:101: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:394: in handle_async_request\n    resp = await self._pool.handle_async_request(req)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/connection_pool.py:256: in handle_async_request\n    raise exc from None\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/connection_pool.py:236: in handle_async_request\n    response = await connection.handle_async_request(\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/connection.py:103: in handle_async_request\n    return await self._connection.handle_async_request(request)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:136: in handle_async_request\n    raise exc\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:106: in handle_async_request\n    ) = await self._receive_response_headers(**kwargs)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:177: in _receive_response_headers\n    event = await self._receive_event(timeout=timeout)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:217: in _receive_event\n    data = await self._network_stream.read(\n../../anaconda3/lib/python3.9/site-packages/httpcore/_backends/anyio.py:37: in read\n    return b\"\"\n../../anaconda3/lib/python3.9/contextlib.py:137: in __exit__\n    self.gen.throw(typ, value, traceback)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nmap = {<class 'TimeoutError'>: <class 'httpcore.ReadTimeout'>, <class 'anyio.BrokenResourceError'>: <class 'httpcore.ReadErr... 'anyio.ClosedResourceError'>: <class 'httpcore.ReadError'>, <class 'anyio.EndOfStream'>: <class 'httpcore.ReadError'>}\n\n    @contextlib.contextmanager\n    def map_exceptions(map: ExceptionMapping) -> typing.Iterator[None]:\n        try:\n            yield\n        except Exception as exc:  # noqa: PIE786\n            for from_exc, to_exc in map.items():\n                if isinstance(exc, from_exc):\n>                   raise to_exc(exc) from exc\nE                   httpcore.ReadError\n\n../../anaconda3/lib/python3.9/site-packages/httpcore/_exceptions.py:14: ReadError\n\nThe above exception was the direct cause of the following exception:\n\nrest = <conftest.RESTClient object at 0x7f47b0030760>\n\n    async def test_timer_cancel(rest):\n        \"\"\"timer.cancel sets state to idle.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"timer.tc_{tag}\"\n>       await rest.set_state(eid, \"active\")\n\ntests/entity/test_timer_counter_humidifier_text.py:55: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:89: in set_state\n    resp = await self.client.post(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1859: in post\n    return await self.request(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1540: in request\n    return await self.send(request, auth=auth, follow_redirects=follow_redirects)\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1629: in send\n    response = await self._send_handling_auth(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1657: in _send_handling_auth\n    response = await self._send_handling_redirects(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1694: in _send_handling_redirects\n    response = await self._send_single_request(request)\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1730: in _send_single_request\n    response = await transport.handle_async_request(request)\n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:394: in handle_async_request\n    resp = await self._pool.handle_async_request(req)\n../../anaconda3/lib/python3.9/contextlib.py:137: in __exit__\n    self.gen.throw(typ, value, traceback)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\n    @contextlib.contextmanager\n    def map_httpcore_exceptions() -> typing.Iterator[None]:\n        global HTTPCORE_EXC_MAP\n        if len(HTTPCORE_EXC_MAP) == 0:\n            HTTPCORE_EXC_MAP = _load_httpcore_exceptions()\n        try:\n            yield\n        except Exception as exc:\n            mapped_exc = None\n    \n            for from_exc, to_exc in HTTPCORE_EXC_MAP.items():\n                if not isinstance(exc, from_exc):\n                    continue\n                # We want to map to the most specific exception we can find.\n                # Eg if `exc` is an `httpcore.ReadTimeout`, we want to map to\n                # `httpx.ReadTimeout`, not just `httpx.TimeoutException`.\n                if mapped_exc is None or issubclass(to_exc, mapped_exc):\n                    mapped_exc = to_exc\n    \n            if mapped_exc is None:  # pragma: no cover\n                raise\n    \n            message = str(exc)\n>           raise mapped_exc(message) from exc\nE           httpx.ReadError\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:118: ReadError"}, "teardown": {"duration": 0.0006546033546328545, "outcome": "passed"}}, {"nodeid": "tests/entity/test_timer_counter_humidifier_text.py::test_timer_finish", "lineno": 67, "outcome": "failed", "keywords": ["test_timer_finish", "test_timer_counter_humidifier_text.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.0056584421545267105, "outcome": "passed"}, "call": {"duration": 0.0020668846555054188, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py", "lineno": 118, "message": "httpx.ReadError"}, "traceback": [{"path": "tests/entity/test_timer_counter_humidifier_text.py", "lineno": 72, "message": ""}, {"path": "tests/conftest.py", "lineno": 89, "message": "in set_state"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1859, "message": "in post"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1540, "message": "in request"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1629, "message": "in send"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1657, "message": "in _send_handling_auth"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1694, "message": "in _send_handling_redirects"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1730, "message": "in _send_single_request"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py", "lineno": 394, "message": "in handle_async_request"}, {"path": "../../anaconda3/lib/python3.9/contextlib.py", "lineno": 137, "message": "in __exit__"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py", "lineno": 118, "message": "ReadError"}], "longrepr": "@contextlib.contextmanager\n    def map_httpcore_exceptions() -> typing.Iterator[None]:\n        global HTTPCORE_EXC_MAP\n        if len(HTTPCORE_EXC_MAP) == 0:\n            HTTPCORE_EXC_MAP = _load_httpcore_exceptions()\n        try:\n>           yield\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:101: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:394: in handle_async_request\n    resp = await self._pool.handle_async_request(req)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/connection_pool.py:256: in handle_async_request\n    raise exc from None\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/connection_pool.py:236: in handle_async_request\n    response = await connection.handle_async_request(\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/connection.py:103: in handle_async_request\n    return await self._connection.handle_async_request(request)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:136: in handle_async_request\n    raise exc\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:106: in handle_async_request\n    ) = await self._receive_response_headers(**kwargs)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:177: in _receive_response_headers\n    event = await self._receive_event(timeout=timeout)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:217: in _receive_event\n    data = await self._network_stream.read(\n../../anaconda3/lib/python3.9/site-packages/httpcore/_backends/anyio.py:37: in read\n    return b\"\"\n../../anaconda3/lib/python3.9/contextlib.py:137: in __exit__\n    self.gen.throw(typ, value, traceback)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nmap = {<class 'TimeoutError'>: <class 'httpcore.ReadTimeout'>, <class 'anyio.BrokenResourceError'>: <class 'httpcore.ReadErr... 'anyio.ClosedResourceError'>: <class 'httpcore.ReadError'>, <class 'anyio.EndOfStream'>: <class 'httpcore.ReadError'>}\n\n    @contextlib.contextmanager\n    def map_exceptions(map: ExceptionMapping) -> typing.Iterator[None]:\n        try:\n            yield\n        except Exception as exc:  # noqa: PIE786\n            for from_exc, to_exc in map.items():\n                if isinstance(exc, from_exc):\n>                   raise to_exc(exc) from exc\nE                   httpcore.ReadError\n\n../../anaconda3/lib/python3.9/site-packages/httpcore/_exceptions.py:14: ReadError\n\nThe above exception was the direct cause of the following exception:\n\nrest = <conftest.RESTClient object at 0x7f47ab331820>\n\n    async def test_timer_finish(rest):\n        \"\"\"timer.finish sets state to idle.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"timer.tf_{tag}\"\n>       await rest.set_state(eid, \"active\")\n\ntests/entity/test_timer_counter_humidifier_text.py:72: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:89: in set_state\n    resp = await self.client.post(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1859: in post\n    return await self.request(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1540: in request\n    return await self.send(request, auth=auth, follow_redirects=follow_redirects)\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1629: in send\n    response = await self._send_handling_auth(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1657: in _send_handling_auth\n    response = await self._send_handling_redirects(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1694: in _send_handling_redirects\n    response = await self._send_single_request(request)\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1730: in _send_single_request\n    response = await transport.handle_async_request(request)\n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:394: in handle_async_request\n    resp = await self._pool.handle_async_request(req)\n../../anaconda3/lib/python3.9/contextlib.py:137: in __exit__\n    self.gen.throw(typ, value, traceback)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\n    @contextlib.contextmanager\n    def map_httpcore_exceptions() -> typing.Iterator[None]:\n        global HTTPCORE_EXC_MAP\n        if len(HTTPCORE_EXC_MAP) == 0:\n            HTTPCORE_EXC_MAP = _load_httpcore_exceptions()\n        try:\n            yield\n        except Exception as exc:\n            mapped_exc = None\n    \n            for from_exc, to_exc in HTTPCORE_EXC_MAP.items():\n                if not isinstance(exc, from_exc):\n                    continue\n                # We want to map to the most specific exception we can find.\n                # Eg if `exc` is an `httpcore.ReadTimeout`, we want to map to\n                # `httpx.ReadTimeout`, not just `httpx.TimeoutException`.\n                if mapped_exc is None or issubclass(to_exc, mapped_exc):\n                    mapped_exc = to_exc\n    \n            if mapped_exc is None:  # pragma: no cover\n                raise\n    \n            message = str(exc)\n>           raise mapped_exc(message) from exc\nE           httpx.ReadError\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:118: ReadError"}, "teardown": {"duration": 0.0007853750139474869, "outcome": "passed"}}, {"nodeid": "tests/entity/test_timer_counter_humidifier_text.py::test_counter_increment", "lineno": 86, "outcome": "failed", "keywords": ["test_counter_increment", "test_timer_counter_humidifier_text.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.009984084870666265, "outcome": "passed"}, "call": {"duration": 0.0029993047937750816, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py", "lineno": 118, "message": "httpx.ReadError"}, "traceback": [{"path": "tests/entity/test_timer_counter_humidifier_text.py", "lineno": 91, "message": ""}, {"path": "tests/conftest.py", "lineno": 89, "message": "in set_state"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1859, "message": "in post"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1540, "message": "in request"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1629, "message": "in send"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1657, "message": "in _send_handling_auth"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1694, "message": "in _send_handling_redirects"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_client.py", "lineno": 1730, "message": "in _send_single_request"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py", "lineno": 394, "message": "in handle_async_request"}, {"path": "../../anaconda3/lib/python3.9/contextlib.py", "lineno": 137, "message": "in __exit__"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py", "lineno": 118, "message": "ReadError"}], "longrepr": "@contextlib.contextmanager\n    def map_httpcore_exceptions() -> typing.Iterator[None]:\n        global HTTPCORE_EXC_MAP\n        if len(HTTPCORE_EXC_MAP) == 0:\n            HTTPCORE_EXC_MAP = _load_httpcore_exceptions()\n        try:\n>           yield\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:101: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:394: in handle_async_request\n    resp = await self._pool.handle_async_request(req)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/connection_pool.py:256: in handle_async_request\n    raise exc from None\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/connection_pool.py:236: in handle_async_request\n    response = await connection.handle_async_request(\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/connection.py:103: in handle_async_request\n    return await self._connection.handle_async_request(request)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:136: in handle_async_request\n    raise exc\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:106: in handle_async_request\n    ) = await self._receive_response_headers(**kwargs)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:177: in _receive_response_headers\n    event = await self._receive_event(timeout=timeout)\n../../anaconda3/lib/python3.9/site-packages/httpcore/_async/http11.py:217: in _receive_event\n    data = await self._network_stream.read(\n../../anaconda3/lib/python3.9/site-packages/httpcore/_backends/anyio.py:37: in read\n    return b\"\"\n../../anaconda3/lib/python3.9/contextlib.py:137: in __exit__\n    self.gen.throw(typ, value, traceback)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nmap = {<class 'TimeoutError'>: <class 'httpcore.ReadTimeout'>, <class 'anyio.BrokenResourceError'>: <class 'httpcore.ReadErr... 'anyio.ClosedResourceError'>: <class 'httpcore.ReadError'>, <class 'anyio.EndOfStream'>: <class 'httpcore.ReadError'>}\n\n    @contextlib.contextmanager\n    def map_exceptions(map: ExceptionMapping) -> typing.Iterator[None]:\n        try:\n            yield\n        except Exception as exc:  # noqa: PIE786\n            for from_exc, to_exc in map.items():\n                if isinstance(exc, from_exc):\n>                   raise to_exc(exc) from exc\nE                   httpcore.ReadError\n\n../../anaconda3/lib/python3.9/site-packages/httpcore/_exceptions.py:14: ReadError\n\nThe above exception was the direct cause of the following exception:\n\nrest = <conftest.RESTClient object at 0x7f47ab388520>\n\n    async def test_counter_increment(rest):\n        \"\"\"counter.increment adds 1 to current value.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"counter.c_{tag}\"\n>       await rest.set_state(eid, \"5\")\n\ntests/entity/test_timer_counter_humidifier_text.py:91: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:89: in set_state\n    resp = await self.client.post(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1859: in post\n    return await self.request(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1540: in request\n    return await self.send(request, auth=auth, follow_redirects=follow_redirects)\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1629: in send\n    response = await self._send_handling_auth(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1657: in _send_handling_auth\n    response = await self._send_handling_redirects(\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1694: in _send_handling_redirects\n    response = await self._send_single_request(request)\n../../anaconda3/lib/python3.9/site-packages/httpx/_client.py:1730: in _send_single_request\n    response = await transport.handle_async_request(request)\n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:394: in handle_async_request\n    resp = await self._pool.handle_async_request(req)\n../../anaconda3/lib/python3.9/contextlib.py:137: in __exit__\n    self.gen.throw(typ, value, traceback)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\n    @contextlib.contextmanager\n    def map_httpcore_exceptions() -> typing.Iterator[None]:\n        global HTTPCORE_EXC_MAP\n        if len(HTTPCORE_EXC_MAP) == 0:\n            HTTPCORE_EXC_MAP = _load_httpcore_exceptions()\n        try:\n            yield\n        except Exception as exc:\n            mapped_exc = None\n    \n            for from_exc, to_exc in HTTPCORE_EXC_MAP.items():\n                if not isinstance(exc, from_exc):\n                    continue\n                # We want to map to the most specific exception we can find.\n                # Eg if `exc` is an `httpcore.ReadTimeout`, we want to map to\n                # `httpx.ReadTimeout`, not just `httpx.TimeoutException`.\n                if mapped_exc is None or issubclass(to_exc, mapped_exc):\n                    mapped_exc = to_exc\n    \n            if mapped_exc is None:  # pragma: no cover\n                raise\n    \n            message = str(exc)\n>           raise mapped_exc(message) from exc\nE           httpx.ReadError\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_transports/default.py:118: ReadError"}, "teardown": {"duration": 0.0005702837370336056, "outcome": "passed"}}, {"nodeid": "tests/entity/test_timer_counter_humidifier_text.py::test_counter_decrement", "lineno": 103, "outcome": "failed", "keywords": ["test_counter_decrement", "test_timer_counter_humidifier_text.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005490246694535017, "outcome": "passed"}, "call": {"duration": 0.008209924679249525, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/entity/test_timer_counter_humidifier_text.py", "lineno": 115, "message": "assert 400 == 200\n +  where 400 = <Response [400 Bad Request]>.status_code"}, "traceback": [{"path": "tests/entity/test_timer_counter_humidifier_text.py", "lineno": 115, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47ab3b6550>\n\n    async def test_counter_decrement(rest):\n        \"\"\"counter.decrement subtracts 1 from current value.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"counter.cd_{tag}\"\n        await rest.set_state(eid, \"10\")\n    \n        resp = await rest.client.post(\n            f\"{rest.base_url}/api/services/counter/decrement\",\n            json={\"entity_id\": eid},\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 400 == 200\nE        +  where 400 = <Response [400 Bad Request]>.status_code\n\ntests/entity/test_timer_counter_humidifier_text.py:115: AssertionError"}, "teardown": {"duration": 0.0007171551696956158, "outcome": "passed"}}, {"nodeid": "tests/entity/test_timer_counter_humidifier_text.py::test_counter_reset_with_initial", "lineno": 120, "outcome": "failed", "keywords": ["test_counter_reset_with_initial", "test_timer_counter_humidifier_text.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005323566030710936, "outcome": "passed"}, "call": {"duration": 0.006768392864614725, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/entity/test_timer_counter_humidifier_text.py", "lineno": 132, "message": "assert 400 == 200\n +  where 400 = <Response [400 Bad Request]>.status_code"}, "traceback": [{"path": "tests/entity/test_timer_counter_humidifier_text.py", "lineno": 132, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47ab79a100>\n\n    async def test_counter_reset_with_initial(rest):\n        \"\"\"counter.reset sets to initial attribute value.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"counter.cr_{tag}\"\n        await rest.set_state(eid, \"42\", {\"initial\": 0})\n    \n        resp = await rest.client.post(\n            f\"{rest.base_url}/api/services/counter/reset\",\n            json={\"entity_id\": eid},\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 400 == 200\nE        +  where 400 = <Response [400 Bad Request]>.status_code\n\ntests/entity/test_timer_counter_humidifier_text.py:132: AssertionError"}, "teardown": {"duration": 0.0006752158515155315, "outcome": "passed"}}, {"nodeid": "tests/entity/test_timer_counter_humidifier_text.py::test_counter_reset_default_zero", "lineno": 137, "outcome": "failed", "keywords": ["test_counter_reset_default_zero", "test_timer_counter_humidifier_text.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005285681691020727, "outcome": "passed"}, "call": {"duration": 0.009086654055863619, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/entity/test_timer_counter_humidifier_text.py", "lineno": 151, "message": "AssertionError: assert '99' == '0'\n  \n  - 0\n  + 99"}, "traceback": [{"path": "tests/entity/test_timer_counter_humidifier_text.py", "lineno": 151, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b222dcd0>\n\n    async def test_counter_reset_default_zero(rest):\n        \"\"\"counter.reset defaults to 0 without initial attribute.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"counter.crz_{tag}\"\n        await rest.set_state(eid, \"99\")\n    \n        await rest.client.post(\n            f\"{rest.base_url}/api/services/counter/reset\",\n            json={\"entity_id\": eid},\n            headers=rest._headers(),\n        )\n    \n        state = await rest.get_state(eid)\n>       assert state[\"state\"] == \"0\"\nE       AssertionError: assert '99' == '0'\nE         \nE         - 0\nE         + 99\n\ntests/entity/test_timer_counter_humidifier_text.py:151: AssertionError"}, "teardown": {"duration": 0.0012978320010006428, "outcome": "passed"}}, {"nodeid": "tests/entity/test_timer_counter_humidifier_text.py::test_counter_increment_from_zero", "lineno": 153, "outcome": "failed", "keywords": ["test_counter_increment_from_zero", "test_timer_counter_humidifier_text.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005559131037443876, "outcome": "passed"}, "call": {"duration": 0.010020714718848467, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/entity/test_timer_counter_humidifier_text.py", "lineno": 167, "message": "AssertionError: assert '0' == '1'\n  \n  - 1\n  + 0"}, "traceback": [{"path": "tests/entity/test_timer_counter_humidifier_text.py", "lineno": 167, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b00459d0>\n\n    async def test_counter_increment_from_zero(rest):\n        \"\"\"counter.increment from 0 gives 1.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"counter.c0_{tag}\"\n        await rest.set_state(eid, \"0\")\n    \n        await rest.client.post(\n            f\"{rest.base_url}/api/services/counter/increment\",\n            json={\"entity_id\": eid},\n            headers=rest._headers(),\n        )\n    \n        state = await rest.get_state(eid)\n>       assert state[\"state\"] == \"1\"\nE       AssertionError: assert '0' == '1'\nE         \nE         - 1\nE         + 0\n\ntests/entity/test_timer_counter_humidifier_text.py:167: AssertionError"}, "teardown": {"duration": 0.000554306898266077, "outcome": "passed"}}, {"nodeid": "tests/entity/test_timer_counter_humidifier_text.py::test_counter_decrement_below_zero", "lineno": 169, "outcome": "failed", "keywords": ["test_counter_decrement_below_zero", "test_timer_counter_humidifier_text.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005813934374600649, "outcome": "passed"}, "call": {"duration": 0.011134651023894548, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/entity/test_timer_counter_humidifier_text.py", "lineno": 183, "message": "AssertionError: assert '0' == '-1'\n  \n  - -1\n  + 0"}, "traceback": [{"path": "tests/entity/test_timer_counter_humidifier_text.py", "lineno": 183, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47ab703c70>\n\n    async def test_counter_decrement_below_zero(rest):\n        \"\"\"counter.decrement below zero gives negative.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"counter.cn_{tag}\"\n        await rest.set_state(eid, \"0\")\n    \n        await rest.client.post(\n            f\"{rest.base_url}/api/services/counter/decrement\",\n            json={\"entity_id\": eid},\n            headers=rest._headers(),\n        )\n    \n        state = await rest.get_state(eid)\n>       assert state[\"state\"] == \"-1\"\nE       AssertionError: assert '0' == '-1'\nE         \nE         - -1\nE         + 0\n\ntests/entity/test_timer_counter_humidifier_text.py:183: AssertionError"}, "teardown": {"duration": 0.0006416821852326393, "outcome": "passed"}}, {"nodeid": "tests/entity/test_timer_counter_humidifier_text.py::test_humidifier_turn_on", "lineno": 187, "outcome": "failed", "keywords": ["test_humidifier_turn_on", "test_timer_counter_humidifier_text.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005323140881955624, "outcome": "passed"}, "call": {"duration": 0.010840216185897589, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/entity/test_timer_counter_humidifier_text.py", "lineno": 201, "message": "AssertionError: assert 'off' == 'on'\n  \n  - on\n  + off"}, "traceback": [{"path": "tests/entity/test_timer_counter_humidifier_text.py", "lineno": 201, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47ab5d0a60>\n\n    async def test_humidifier_turn_on(rest):\n        \"\"\"humidifier.turn_on sets state to on.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"humidifier.h_{tag}\"\n        await rest.set_state(eid, \"off\")\n    \n        await rest.client.post(\n            f\"{rest.base_url}/api/services/humidifier/turn_on\",\n            json={\"entity_id\": eid},\n            headers=rest._headers(),\n        )\n    \n        state = await rest.get_state(eid)\n>       assert state[\"state\"] == \"on\"\nE       AssertionError: assert 'off' == 'on'\nE         \nE         - on\nE         + off\n\ntests/entity/test_timer_counter_humidifier_text.py:201: AssertionError"}, "teardown": {"duration": 0.0007629240863025188, "outcome": "passed"}}, {"nodeid": "tests/entity/test_timer_counter_humidifier_text.py::test_humidifier_turn_off", "lineno": 203, "outcome": "failed", "keywords": ["test_humidifier_turn_off", "test_timer_counter_humidifier_text.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.00600952934473753, "outcome": "passed"}, "call": {"duration": 0.009134759660810232, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/entity/test_timer_counter_humidifier_text.py", "lineno": 217, "message": "AssertionError: assert 'on' == 'off'\n  \n  - off\n  + on"}, "traceback": [{"path": "tests/entity/test_timer_counter_humidifier_text.py", "lineno": 217, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0475430>\n\n    async def test_humidifier_turn_off(rest):\n        \"\"\"humidifier.turn_off sets state to off.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"humidifier.ho_{tag}\"\n        await rest.set_state(eid, \"on\")\n    \n        await rest.client.post(\n            f\"{rest.base_url}/api/services/humidifier/turn_off\",\n            json={\"entity_id\": eid},\n            headers=rest._headers(),\n        )\n    \n        state = await rest.get_state(eid)\n>       assert state[\"state\"] == \"off\"\nE       AssertionError: assert 'on' == 'off'\nE         \nE         - off\nE         + on\n\ntests/entity/test_timer_counter_humidifier_text.py:217: AssertionError"}, "teardown": {"duration": 0.0008190642111003399, "outcome": "passed"}}, {"nodeid": "tests/entity/test_timer_counter_humidifier_text.py::test_humidifier_toggle", "lineno": 219, "outcome": "failed", "keywords": ["test_humidifier_toggle", "test_timer_counter_humidifier_text.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005238507874310017, "outcome": "passed"}, "call": {"duration": 0.03392461966723204, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/entity/test_timer_counter_humidifier_text.py", "lineno": 233, "message": "AssertionError: assert 'on' == 'off'\n  \n  - off\n  + on"}, "traceback": [{"path": "tests/entity/test_timer_counter_humidifier_text.py", "lineno": 233, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0d6d7c0>\n\n    async def test_humidifier_toggle(rest):\n        \"\"\"humidifier.toggle flips on\u2194off.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"humidifier.ht_{tag}\"\n        await rest.set_state(eid, \"on\")\n    \n        await rest.client.post(\n            f\"{rest.base_url}/api/services/humidifier/toggle\",\n            json={\"entity_id\": eid},\n            headers=rest._headers(),\n        )\n    \n        state = await rest.get_state(eid)\n>       assert state[\"state\"] == \"off\"\nE       AssertionError: assert 'on' == 'off'\nE         \nE         - off\nE         + on\n\ntests/entity/test_timer_counter_humidifier_text.py:233: AssertionError"}, "teardown": {"duration": 0.0007374980486929417, "outcome": "passed"}}, {"nodeid": "tests/entity/test_timer_counter_humidifier_text.py::test_humidifier_set_humidity", "lineno": 235, "outcome": "failed", "keywords": ["test_humidifier_set_humidity", "test_timer_counter_humidifier_text.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.00707262521609664, "outcome": "passed"}, "call": {"duration": 0.009330075234174728, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/entity/test_timer_counter_humidifier_text.py", "lineno": 249, "message": "KeyError: 'humidity'"}, "traceback": [{"path": "tests/entity/test_timer_counter_humidifier_text.py", "lineno": 249, "message": "KeyError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47ab7bdcd0>\n\n    async def test_humidifier_set_humidity(rest):\n        \"\"\"humidifier.set_humidity stores humidity attribute.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"humidifier.hh_{tag}\"\n        await rest.set_state(eid, \"on\")\n    \n        await rest.client.post(\n            f\"{rest.base_url}/api/services/humidifier/set_humidity\",\n            json={\"entity_id\": eid, \"humidity\": 55},\n            headers=rest._headers(),\n        )\n    \n        state = await rest.get_state(eid)\n>       assert state[\"attributes\"][\"humidity\"] == 55\nE       KeyError: 'humidity'\n\ntests/entity/test_timer_counter_humidifier_text.py:249: KeyError"}, "teardown": {"duration": 0.0013225860893726349, "outcome": "passed"}}, {"nodeid": "tests/entity/test_timer_counter_humidifier_text.py::test_humidifier_set_mode", "lineno": 251, "outcome": "failed", "keywords": ["test_humidifier_set_mode", "test_timer_counter_humidifier_text.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.00519385002553463, "outcome": "passed"}, "call": {"duration": 0.0056871590204536915, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/entity/test_timer_counter_humidifier_text.py", "lineno": 265, "message": "KeyError: 'mode'"}, "traceback": [{"path": "tests/entity/test_timer_counter_humidifier_text.py", "lineno": 265, "message": "KeyError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47ab450700>\n\n    async def test_humidifier_set_mode(rest):\n        \"\"\"humidifier.set_mode stores mode attribute.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"humidifier.hm_{tag}\"\n        await rest.set_state(eid, \"on\")\n    \n        await rest.client.post(\n            f\"{rest.base_url}/api/services/humidifier/set_mode\",\n            json={\"entity_id\": eid, \"mode\": \"silent\"},\n            headers=rest._headers(),\n        )\n    \n        state = await rest.get_state(eid)\n>       assert state[\"attributes\"][\"mode\"] == \"silent\"\nE       KeyError: 'mode'\n\ntests/entity/test_timer_counter_humidifier_text.py:265: KeyError"}, "teardown": {"duration": 0.0007144557312130928, "outcome": "passed"}}, {"nodeid": "tests/entity/test_timer_counter_humidifier_text.py::test_text_set_value", "lineno": 269, "outcome": "failed", "keywords": ["test_text_set_value", "test_timer_counter_humidifier_text.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005050790961831808, "outcome": "passed"}, "call": {"duration": 0.005557377822697163, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/entity/test_timer_counter_humidifier_text.py", "lineno": 283, "message": "AssertionError: assert 'old' == 'new text'\n  \n  - new text\n  + old"}, "traceback": [{"path": "tests/entity/test_timer_counter_humidifier_text.py", "lineno": 283, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47ab66a370>\n\n    async def test_text_set_value(rest):\n        \"\"\"text.set_value changes entity state to provided value.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"text.t_{tag}\"\n        await rest.set_state(eid, \"old\")\n    \n        await rest.client.post(\n            f\"{rest.base_url}/api/services/text/set_value\",\n            json={\"entity_id\": eid, \"value\": \"new text\"},\n            headers=rest._headers(),\n        )\n    \n        state = await rest.get_state(eid)\n>       assert state[\"state\"] == \"new text\"\nE       AssertionError: assert 'old' == 'new text'\nE         \nE         - new text\nE         + old\n\ntests/entity/test_timer_counter_humidifier_text.py:283: AssertionError"}, "teardown": {"duration": 0.0006733769550919533, "outcome": "passed"}}, {"nodeid": "tests/entity/test_timer_counter_humidifier_text.py::test_text_set_empty_value", "lineno": 285, "outcome": "failed", "keywords": ["test_text_set_empty_value", "test_timer_counter_humidifier_text.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005353510845452547, "outcome": "passed"}, "call": {"duration": 0.006693265866488218, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/entity/test_timer_counter_humidifier_text.py", "lineno": 299, "message": "AssertionError: assert 'content' == ''\n  \n  + content"}, "traceback": [{"path": "tests/entity/test_timer_counter_humidifier_text.py", "lineno": 299, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47ab7162b0>\n\n    async def test_text_set_empty_value(rest):\n        \"\"\"text.set_value with empty string.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"text.te_{tag}\"\n        await rest.set_state(eid, \"content\")\n    \n        await rest.client.post(\n            f\"{rest.base_url}/api/services/text/set_value\",\n            json={\"entity_id\": eid, \"value\": \"\"},\n            headers=rest._headers(),\n        )\n    \n        state = await rest.get_state(eid)\n>       assert state[\"state\"] == \"\"\nE       AssertionError: assert 'content' == ''\nE         \nE         + content\n\ntests/entity/test_timer_counter_humidifier_text.py:299: AssertionError"}, "teardown": {"duration": 0.0007477840408682823, "outcome": "passed"}}, {"nodeid": "tests/entity/test_timer_counter_humidifier_text.py::test_input_datetime_set_datetime", "lineno": 303, "outcome": "failed", "keywords": ["test_input_datetime_set_datetime", "test_timer_counter_humidifier_text.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005040143150836229, "outcome": "passed"}, "call": {"duration": 0.007332914043217897, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/entity/test_timer_counter_humidifier_text.py", "lineno": 317, "message": "AssertionError: assert 'unknown' == '2026-02-13T08:30:00'\n  \n  - 2026-02-13T08:30:00\n  + unknown"}, "traceback": [{"path": "tests/entity/test_timer_counter_humidifier_text.py", "lineno": 317, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47ab32b9d0>\n\n    async def test_input_datetime_set_datetime(rest):\n        \"\"\"input_datetime.set_datetime sets state to provided datetime string.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"input_datetime.dt_{tag}\"\n        await rest.set_state(eid, \"unknown\")\n    \n        await rest.client.post(\n            f\"{rest.base_url}/api/services/input_datetime/set_datetime\",\n            json={\"entity_id\": eid, \"datetime\": \"2026-02-13T08:30:00\"},\n            headers=rest._headers(),\n        )\n    \n        state = await rest.get_state(eid)\n>       assert state[\"state\"] == \"2026-02-13T08:30:00\"\nE       AssertionError: assert 'unknown' == '2026-02-13T08:30:00'\nE         \nE         - 2026-02-13T08:30:00\nE         + unknown\n\ntests/entity/test_timer_counter_humidifier_text.py:317: AssertionError"}, "teardown": {"duration": 0.0011686659418046474, "outcome": "passed"}}, {"nodeid": "tests/entity/test_timer_counter_humidifier_text.py::test_input_datetime_set_date", "lineno": 319, "outcome": "failed", "keywords": ["test_input_datetime_set_date", "test_timer_counter_humidifier_text.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.0054685031063854694, "outcome": "passed"}, "call": {"duration": 0.008084545843303204, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/entity/test_timer_counter_humidifier_text.py", "lineno": 333, "message": "AssertionError: assert 'unknown' == '2026-02-13'\n  \n  - 2026-02-13\n  + unknown"}, "traceback": [{"path": "tests/entity/test_timer_counter_humidifier_text.py", "lineno": 333, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47ab6f8490>\n\n    async def test_input_datetime_set_date(rest):\n        \"\"\"input_datetime.set_datetime with date field.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"input_datetime.dd_{tag}\"\n        await rest.set_state(eid, \"unknown\")\n    \n        await rest.client.post(\n            f\"{rest.base_url}/api/services/input_datetime/set_datetime\",\n            json={\"entity_id\": eid, \"date\": \"2026-02-13\"},\n            headers=rest._headers(),\n        )\n    \n        state = await rest.get_state(eid)\n>       assert state[\"state\"] == \"2026-02-13\"\nE       AssertionError: assert 'unknown' == '2026-02-13'\nE         \nE         - 2026-02-13\nE         + unknown\n\ntests/entity/test_timer_counter_humidifier_text.py:333: AssertionError"}, "teardown": {"duration": 0.0005575059913098812, "outcome": "passed"}}, {"nodeid": "tests/entity/test_timer_counter_humidifier_text.py::test_input_datetime_set_time", "lineno": 335, "outcome": "failed", "keywords": ["test_input_datetime_set_time", "test_timer_counter_humidifier_text.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.0053731403313577175, "outcome": "passed"}, "call": {"duration": 0.006675985176116228, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/entity/test_timer_counter_humidifier_text.py", "lineno": 349, "message": "AssertionError: assert 'unknown' == '14:30:00'\n  \n  - 14:30:00\n  + unknown"}, "traceback": [{"path": "tests/entity/test_timer_counter_humidifier_text.py", "lineno": 349, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0442ac0>\n\n    async def test_input_datetime_set_time(rest):\n        \"\"\"input_datetime.set_datetime with time field.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"input_datetime.dt2_{tag}\"\n        await rest.set_state(eid, \"unknown\")\n    \n        await rest.client.post(\n            f\"{rest.base_url}/api/services/input_datetime/set_datetime\",\n            json={\"entity_id\": eid, \"time\": \"14:30:00\"},\n            headers=rest._headers(),\n        )\n    \n        state = await rest.get_state(eid)\n>       assert state[\"state\"] == \"14:30:00\"\nE       AssertionError: assert 'unknown' == '14:30:00'\nE         \nE         - 14:30:00\nE         + unknown\n\ntests/entity/test_timer_counter_humidifier_text.py:349: AssertionError"}, "teardown": {"duration": 0.0007956530898809433, "outcome": "passed"}}, {"nodeid": "tests/entity/test_toggle_semantics.py::test_light_toggle_on_to_off", "lineno": 14, "outcome": "failed", "keywords": ["test_light_toggle_on_to_off", "test_toggle_semantics.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005278986878693104, "outcome": "passed"}, "call": {"duration": 0.004613501951098442, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/light/toggle'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_toggle_semantics.py", "lineno": 20, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b222d520>\n\n    async def test_light_toggle_on_to_off(rest):\n        \"\"\"light.toggle: on \u2192 off.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"light.tog_{tag}\"\n        await rest.set_state(eid, \"on\")\n>       await rest.call_service(\"light\", \"toggle\", {\"entity_id\": eid})\n\ntests/entity/test_toggle_semantics.py:20: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/light/toggle'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0007466264069080353, "outcome": "passed"}}, {"nodeid": "tests/entity/test_toggle_semantics.py::test_light_toggle_off_to_on", "lineno": 23, "outcome": "failed", "keywords": ["test_light_toggle_off_to_on", "test_toggle_semantics.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005980549845844507, "outcome": "passed"}, "call": {"duration": 0.004271700978279114, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/light/toggle'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_toggle_semantics.py", "lineno": 29, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47ab678f10>\n\n    async def test_light_toggle_off_to_on(rest):\n        \"\"\"light.toggle: off \u2192 on.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"light.tog2_{tag}\"\n        await rest.set_state(eid, \"off\")\n>       await rest.call_service(\"light\", \"toggle\", {\"entity_id\": eid})\n\ntests/entity/test_toggle_semantics.py:29: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/light/toggle'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0006893179379403591, "outcome": "passed"}}, {"nodeid": "tests/entity/test_toggle_semantics.py::test_switch_toggle_roundtrip", "lineno": 32, "outcome": "failed", "keywords": ["test_switch_toggle_roundtrip", "test_toggle_semantics.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005775452125817537, "outcome": "passed"}, "call": {"duration": 0.0050590462051332, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/switch/toggle'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_toggle_semantics.py", "lineno": 38, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b00445e0>\n\n    async def test_switch_toggle_roundtrip(rest):\n        \"\"\"switch.toggle: off \u2192 on \u2192 off.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"switch.tog_{tag}\"\n        await rest.set_state(eid, \"off\")\n>       await rest.call_service(\"switch\", \"toggle\", {\"entity_id\": eid})\n\ntests/entity/test_toggle_semantics.py:38: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/switch/toggle'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0006632274016737938, "outcome": "passed"}}, {"nodeid": "tests/entity/test_toggle_semantics.py::test_fan_toggle_roundtrip", "lineno": 43, "outcome": "failed", "keywords": ["test_fan_toggle_roundtrip", "test_toggle_semantics.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005548506043851376, "outcome": "passed"}, "call": {"duration": 0.004831964150071144, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/fan/toggle'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_toggle_semantics.py", "lineno": 49, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47ab459ca0>\n\n    async def test_fan_toggle_roundtrip(rest):\n        \"\"\"fan.toggle: off \u2192 on \u2192 off.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"fan.tog_{tag}\"\n        await rest.set_state(eid, \"off\")\n>       await rest.call_service(\"fan\", \"toggle\", {\"entity_id\": eid})\n\ntests/entity/test_toggle_semantics.py:49: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/fan/toggle'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0007127569988369942, "outcome": "passed"}}, {"nodeid": "tests/entity/test_toggle_semantics.py::test_siren_toggle_roundtrip", "lineno": 54, "outcome": "failed", "keywords": ["test_siren_toggle_roundtrip", "test_toggle_semantics.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005184134002774954, "outcome": "passed"}, "call": {"duration": 0.004185202997177839, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/siren/toggle'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_toggle_semantics.py", "lineno": 60, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0c660a0>\n\n    async def test_siren_toggle_roundtrip(rest):\n        \"\"\"siren.toggle: off \u2192 on \u2192 off.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"siren.tog_{tag}\"\n        await rest.set_state(eid, \"off\")\n>       await rest.call_service(\"siren\", \"toggle\", {\"entity_id\": eid})\n\ntests/entity/test_toggle_semantics.py:60: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/siren/toggle'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0007851249538362026, "outcome": "passed"}}, {"nodeid": "tests/entity/test_toggle_semantics.py::test_cover_toggle_roundtrip", "lineno": 65, "outcome": "failed", "keywords": ["test_cover_toggle_roundtrip", "test_toggle_semantics.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005444848909974098, "outcome": "passed"}, "call": {"duration": 0.004315408878028393, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/cover/toggle'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_toggle_semantics.py", "lineno": 71, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b226e0a0>\n\n    async def test_cover_toggle_roundtrip(rest):\n        \"\"\"cover.toggle: closed \u2192 open \u2192 closed.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"cover.tog_{tag}\"\n        await rest.set_state(eid, \"closed\")\n>       await rest.call_service(\"cover\", \"toggle\", {\"entity_id\": eid})\n\ntests/entity/test_toggle_semantics.py:71: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/cover/toggle'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.000795222818851471, "outcome": "passed"}}, {"nodeid": "tests/entity/test_toggle_semantics.py::test_valve_toggle_roundtrip", "lineno": 76, "outcome": "failed", "keywords": ["test_valve_toggle_roundtrip", "test_toggle_semantics.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005572228226810694, "outcome": "passed"}, "call": {"duration": 0.004308178089559078, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/valve/toggle'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_toggle_semantics.py", "lineno": 82, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b2246d00>\n\n    async def test_valve_toggle_roundtrip(rest):\n        \"\"\"valve.toggle: closed \u2192 open \u2192 closed.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"valve.tog_{tag}\"\n        await rest.set_state(eid, \"closed\")\n>       await rest.call_service(\"valve\", \"toggle\", {\"entity_id\": eid})\n\ntests/entity/test_toggle_semantics.py:82: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/valve/toggle'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0007613431662321091, "outcome": "passed"}}, {"nodeid": "tests/entity/test_toggle_semantics.py::test_humidifier_toggle_roundtrip", "lineno": 87, "outcome": "failed", "keywords": ["test_humidifier_toggle_roundtrip", "test_toggle_semantics.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005650837905704975, "outcome": "passed"}, "call": {"duration": 0.004829247947782278, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/humidifier/toggle'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_toggle_semantics.py", "lineno": 93, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47ab450130>\n\n    async def test_humidifier_toggle_roundtrip(rest):\n        \"\"\"humidifier.toggle: off \u2192 on \u2192 off.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"humidifier.tog_{tag}\"\n        await rest.set_state(eid, \"off\")\n>       await rest.call_service(\"humidifier\", \"toggle\", {\"entity_id\": eid})\n\ntests/entity/test_toggle_semantics.py:93: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/humidifier/toggle'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0008094660006463528, "outcome": "passed"}}, {"nodeid": "tests/entity/test_toggle_semantics.py::test_input_boolean_toggle_roundtrip", "lineno": 98, "outcome": "failed", "keywords": ["test_input_boolean_toggle_roundtrip", "test_toggle_semantics.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.0060845958068966866, "outcome": "passed"}, "call": {"duration": 0.006047425791621208, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/entity/test_toggle_semantics.py", "lineno": 105, "message": "AssertionError: assert 'off' == 'on'\n  \n  - on\n  + off"}, "traceback": [{"path": "tests/entity/test_toggle_semantics.py", "lineno": 105, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47ab3f0b20>\n\n    async def test_input_boolean_toggle_roundtrip(rest):\n        \"\"\"input_boolean.toggle: off \u2192 on \u2192 off.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"input_boolean.tog_{tag}\"\n        await rest.set_state(eid, \"off\")\n        await rest.call_service(\"input_boolean\", \"toggle\", {\"entity_id\": eid})\n>       assert (await rest.get_state(eid))[\"state\"] == \"on\"\nE       AssertionError: assert 'off' == 'on'\nE         \nE         - on\nE         + off\n\ntests/entity/test_toggle_semantics.py:105: AssertionError"}, "teardown": {"duration": 0.00060639763250947, "outcome": "passed"}}, {"nodeid": "tests/entity/test_toggle_semantics.py::test_homeassistant_toggle_roundtrip", "lineno": 109, "outcome": "failed", "keywords": ["test_homeassistant_toggle_roundtrip", "test_toggle_semantics.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005518901627510786, "outcome": "passed"}, "call": {"duration": 0.005744496826082468, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/entity/test_toggle_semantics.py", "lineno": 116, "message": "AssertionError: assert 'off' == 'on'\n  \n  - on\n  + off"}, "traceback": [{"path": "tests/entity/test_toggle_semantics.py", "lineno": 116, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47ab7bbd90>\n\n    async def test_homeassistant_toggle_roundtrip(rest):\n        \"\"\"homeassistant.toggle: off \u2192 on \u2192 off.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"switch.ha_tog_{tag}\"\n        await rest.set_state(eid, \"off\")\n        await rest.call_service(\"homeassistant\", \"toggle\", {\"entity_id\": eid})\n>       assert (await rest.get_state(eid))[\"state\"] == \"on\"\nE       AssertionError: assert 'off' == 'on'\nE         \nE         - on\nE         + off\n\ntests/entity/test_toggle_semantics.py:116: AssertionError"}, "teardown": {"duration": 0.0006492007523775101, "outcome": "passed"}}, {"nodeid": "tests/entity/test_toggle_semantics.py::test_generic_fallback_toggle", "lineno": 120, "outcome": "failed", "keywords": ["test_generic_fallback_toggle", "test_toggle_semantics.py", "asyncio", "entity", "tests", "marge", ""], "setup": {"duration": 0.005698673892766237, "outcome": "passed"}, "call": {"duration": 0.004384700208902359, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/custom_domain/toggle'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/entity/test_toggle_semantics.py", "lineno": 126, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47ab651af0>\n\n    async def test_generic_fallback_toggle(rest):\n        \"\"\"Toggle on unknown domain uses generic fallback.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"custom_domain.tog_{tag}\"\n        await rest.set_state(eid, \"off\")\n>       await rest.call_service(\"custom_domain\", \"toggle\", {\"entity_id\": eid})\n\ntests/entity/test_toggle_semantics.py:126: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/custom_domain/toggle'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0007753740064799786, "outcome": "passed"}}, {"nodeid": "tests/integration/test_cross_api.py::test_rest_set_ws_read", "lineno": 14, "outcome": "passed", "keywords": ["test_rest_set_ws_read", "test_cross_api.py", "asyncio", "integration", "tests", "marge", ""], "setup": {"duration": 0.008175335824489594, "outcome": "passed"}, "call": {"duration": 0.0034750672057271004, "outcome": "passed"}, "teardown": {"duration": 0.0010033692233264446, "outcome": "passed"}}, {"nodeid": "tests/integration/test_cross_api.py::test_ws_service_rest_read", "lineno": 24, "outcome": "failed", "keywords": ["test_ws_service_rest_read", "test_cross_api.py", "asyncio", "integration", "tests", "marge", ""], "setup": {"duration": 0.007422036025673151, "outcome": "passed"}, "call": {"duration": 0.005961311981081963, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/integration/test_cross_api.py", "lineno": 35, "message": "AssertionError: assert 'off' == 'on'\n  \n  - on\n  + off"}, "traceback": [{"path": "tests/integration/test_cross_api.py", "lineno": 35, "message": "AssertionError"}], "longrepr": "ws = <conftest.WSClient object at 0x7f47b222dbb0>\nrest = <conftest.RESTClient object at 0x7f47ab6440a0>\n\n    async def test_ws_service_rest_read(ws, rest):\n        \"\"\"State changed via WS service call readable via REST.\"\"\"\n        await rest.set_state(\"light.cross_wr\", \"off\")\n        await ws.send_command(\n            \"call_service\",\n            domain=\"light\",\n            service=\"turn_on\",\n            service_data={\"entity_id\": \"light.cross_wr\"},\n        )\n        state = await rest.get_state(\"light.cross_wr\")\n>       assert state[\"state\"] == \"on\"\nE       AssertionError: assert 'off' == 'on'\nE         \nE         - on\nE         + off\n\ntests/integration/test_cross_api.py:35: AssertionError"}, "teardown": {"duration": 0.0010955329053103924, "outcome": "passed"}}, {"nodeid": "tests/integration/test_cross_api.py::test_rest_service_ws_event", "lineno": 37, "outcome": "passed", "keywords": ["test_rest_service_ws_event", "test_cross_api.py", "asyncio", "integration", "tests", "marge", ""], "setup": {"duration": 0.007745416834950447, "outcome": "passed"}, "call": {"duration": 0.0037864791229367256, "outcome": "passed"}, "teardown": {"duration": 0.00103717390447855, "outcome": "passed"}}, {"nodeid": "tests/integration/test_cross_api.py::test_scene_via_rest_ws_verify", "lineno": 48, "outcome": "passed", "keywords": ["test_scene_via_rest_ws_verify", "test_cross_api.py", "asyncio", "integration", "tests", "marge", ""], "setup": {"duration": 0.009484737180173397, "outcome": "passed"}, "call": {"duration": 0.006636008154600859, "outcome": "passed"}, "teardown": {"duration": 0.0011982708238065243, "outcome": "passed"}}, {"nodeid": "tests/integration/test_cross_api.py::test_config_consistent_rest_ws", "lineno": 60, "outcome": "passed", "keywords": ["test_config_consistent_rest_ws", "test_cross_api.py", "asyncio", "integration", "tests", "marge", ""], "setup": {"duration": 0.007566581014543772, "outcome": "passed"}, "call": {"duration": 0.0033341599628329277, "outcome": "passed"}, "teardown": {"duration": 0.0012169177643954754, "outcome": "passed"}}, {"nodeid": "tests/integration/test_cross_api.py::test_services_consistent_rest_ws", "lineno": 71, "outcome": "failed", "keywords": ["test_services_consistent_rest_ws", "test_cross_api.py", "asyncio", "integration", "tests", "marge", ""], "setup": {"duration": 0.0074712373316287994, "outcome": "passed"}, "call": {"duration": 0.13757693814113736, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/integration/test_cross_api.py", "lineno": 84, "message": "TypeError: string indices must be integers"}, "traceback": [{"path": "tests/integration/test_cross_api.py", "lineno": 84, "message": ""}, {"path": "tests/integration/test_cross_api.py", "lineno": 84, "message": "TypeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47ab74f4c0>\nws = <conftest.WSClient object at 0x7f47b0063a90>\n\n    async def test_services_consistent_rest_ws(rest, ws):\n        \"\"\"Service listing consistent between REST and WS.\"\"\"\n        rest_resp = await rest.client.get(\n            f\"{rest.base_url}/api/services\",\n            headers=rest._headers(),\n        )\n        rest_data = rest_resp.json()\n    \n        ws_resp = await ws.send_command(\"get_services\")\n        ws_data = ws_resp[\"result\"]\n    \n        rest_domains = sorted([e[\"domain\"] for e in rest_data])\n>       ws_domains = sorted([e[\"domain\"] for e in ws_data])\n\ntests/integration/test_cross_api.py:84: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\n.0 = <dict_keyiterator object at 0x7f47ab263310>\n\n>   ws_domains = sorted([e[\"domain\"] for e in ws_data])\nE   TypeError: string indices must be integers\n\ntests/integration/test_cross_api.py:84: TypeError"}, "teardown": {"duration": 0.0015872297808527946, "outcome": "passed"}}, {"nodeid": "tests/integration/test_cross_api.py::test_delete_via_rest_invisible_ws", "lineno": 87, "outcome": "passed", "keywords": ["test_delete_via_rest_invisible_ws", "test_cross_api.py", "asyncio", "integration", "tests", "marge", ""], "setup": {"duration": 0.007624694146215916, "outcome": "passed"}, "call": {"duration": 0.004687509965151548, "outcome": "passed"}, "teardown": {"duration": 0.0011029280722141266, "outcome": "passed"}}, {"nodeid": "tests/integration/test_cross_api.py::test_health_ws_connections_accurate", "lineno": 101, "outcome": "failed", "keywords": ["test_health_ws_connections_accurate", "test_cross_api.py", "asyncio", "integration", "tests", "marge", ""], "setup": {"duration": 0.007458032574504614, "outcome": "passed"}, "call": {"duration": 0.0037053790874779224, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '404 Not Found' for url 'http://localhost:8123/api/health'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/404"}, "traceback": [{"path": "tests/integration/test_cross_api.py", "lineno": 104, "message": ""}, {"path": "tests/conftest.py", "lineno": 122, "message": "in get_health"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b22909a0>\nws = <conftest.WSClient object at 0x7f47ab66a550>\n\n    async def test_health_ws_connections_accurate(rest, ws):\n        \"\"\"Health endpoint reflects at least 1 WS connection.\"\"\"\n>       health = await rest.get_health()\n\ntests/integration/test_cross_api.py:104: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:122: in get_health\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [404 Not Found]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '404 Not Found' for url 'http://localhost:8123/api/health'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/404\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0013640518300235271, "outcome": "passed"}}, {"nodeid": "tests/integration/test_cross_feature.py::test_state_change_recorded_in_history", "lineno": 18, "outcome": "failed", "keywords": ["test_state_change_recorded_in_history", "test_cross_feature.py", "asyncio", "integration", "tests", "marge", ""], "setup": {"duration": 0.005313539877533913, "outcome": "passed"}, "call": {"duration": 0.30827614199370146, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)"}, "traceback": [{"path": "tests/integration/test_cross_feature.py", "lineno": 31, "message": ""}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 832, "message": "in json"}, {"path": "../../anaconda3/lib/python3.9/json/__init__.py", "lineno": 346, "message": "in loads"}, {"path": "../../anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "JSONDecodeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47ab71f2b0>\n\n    async def test_state_change_recorded_in_history(rest):\n        \"\"\"State change via REST is recorded in history.\"\"\"\n        entity = \"sensor.xfeat_hist\"\n        await rest.set_state(entity, \"initial\")\n        await asyncio.sleep(_FLUSH)\n        await rest.set_state(entity, \"updated\")\n        await asyncio.sleep(_FLUSH)\n    \n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/history/period/{entity}\",\n            headers=rest._headers(),\n        )\n>       data = resp.json()\n\ntests/integration/test_cross_feature.py:31: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:832: in json\n    return jsonlib.loads(self.content, **kwargs)\n../../anaconda3/lib/python3.9/json/__init__.py:346: in loads\n    return _default_decoder.decode(s)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <json.decoder.JSONDecoder object at 0x7f47b2e5fe50>, s = '404: Not Found'\n_w = <built-in method match of re.Pattern object at 0x7f47b3015cf0>\n\n    def decode(self, s, _w=WHITESPACE.match):\n        \"\"\"Return the Python representation of ``s`` (a ``str`` instance\n        containing a JSON document).\n    \n        \"\"\"\n        obj, end = self.raw_decode(s, idx=_w(s, 0).end())\n        end = _w(s, end).end()\n        if end != len(s):\n>           raise JSONDecodeError(\"Extra data\", s, end)\nE           json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)\n\n../../anaconda3/lib/python3.9/json/decoder.py:340: JSONDecodeError"}, "teardown": {"duration": 0.0008674990385770798, "outcome": "passed"}}, {"nodeid": "tests/integration/test_cross_feature.py::test_service_call_appears_in_history", "lineno": 35, "outcome": "failed", "keywords": ["test_service_call_appears_in_history", "test_cross_feature.py", "asyncio", "integration", "tests", "marge", ""], "setup": {"duration": 0.005794174037873745, "outcome": "passed"}, "call": {"duration": 0.15668797492980957, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/light/turn_on'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/integration/test_cross_feature.py", "lineno": 41, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47ab4b3760>\n\n    async def test_service_call_appears_in_history(rest):\n        \"\"\"Service call that changes state is recorded in history.\"\"\"\n        entity = \"light.xfeat_svc_hist\"\n        await rest.set_state(entity, \"off\")\n        await asyncio.sleep(_FLUSH)\n>       await rest.call_service(\"light\", \"turn_on\", {\"entity_id\": entity})\n\ntests/integration/test_cross_feature.py:41: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/light/turn_on'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0014104838483035564, "outcome": "passed"}}, {"nodeid": "tests/integration/test_cross_feature.py::test_service_call_triggers_ws_event", "lineno": 54, "outcome": "failed", "keywords": ["test_service_call_triggers_ws_event", "test_cross_feature.py", "asyncio", "integration", "tests", "marge", ""], "setup": {"duration": 0.012510137166827917, "outcome": "passed"}, "call": {"duration": 0.0061769201420247555, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/switch/turn_on'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/integration/test_cross_feature.py", "lineno": 60, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "ws = <conftest.WSClient object at 0x7f47ab53ebe0>\nrest = <conftest.RESTClient object at 0x7f47ab53e7f0>\n\n    async def test_service_call_triggers_ws_event(ws, rest):\n        \"\"\"Service call generates state_changed WS event.\"\"\"\n        entity = \"switch.xfeat_ws_svc\"\n        await rest.set_state(entity, \"off\")\n        sub_id = await ws.subscribe_events(\"state_changed\")\n>       await rest.call_service(\"switch\", \"turn_on\", {\"entity_id\": entity})\n\ntests/integration/test_cross_feature.py:60: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/switch/turn_on'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0013251202180981636, "outcome": "passed"}}, {"nodeid": "tests/integration/test_cross_feature.py::test_automation_trigger_changes_state", "lineno": 68, "outcome": "failed", "keywords": ["test_automation_trigger_changes_state", "test_cross_feature.py", "asyncio", "integration", "tests", "marge", ""], "setup": {"duration": 0.006273679435253143, "outcome": "passed"}, "call": {"duration": 0.7106443191878498, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/integration/test_cross_feature.py", "lineno": 81, "message": "AssertionError: assert 'locked' == 'unlocked'\n  \n  - unlocked\n  ? --\n  + locked"}, "traceback": [{"path": "tests/integration/test_cross_feature.py", "lineno": 81, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47ab2ccb50>\n\n    async def test_automation_trigger_changes_state(rest):\n        \"\"\"Triggering automation modifies state via service calls.\"\"\"\n        await rest.set_state(\"lock.front_door\", \"locked\")\n        await rest.set_state(\"binary_sensor.smoke_detector\", \"off\")\n        await asyncio.sleep(0.2)\n    \n        # Fire smoke automation\n        await rest.set_state(\"binary_sensor.smoke_detector\", \"on\")\n        await asyncio.sleep(0.5)\n    \n        # Automation should have unlocked doors\n        state = await rest.get_state(\"lock.front_door\")\n>       assert state[\"state\"] == \"unlocked\"\nE       AssertionError: assert 'locked' == 'unlocked'\nE         \nE         - unlocked\nE         ? --\nE         + locked\n\ntests/integration/test_cross_feature.py:81: AssertionError"}, "teardown": {"duration": 0.001449556089937687, "outcome": "passed"}}, {"nodeid": "tests/integration/test_cross_feature.py::test_scene_activation_triggers_ws_events", "lineno": 85, "outcome": "failed", "keywords": ["test_scene_activation_triggers_ws_events", "test_cross_feature.py", "asyncio", "integration", "tests", "marge", ""], "setup": {"duration": 0.01290910318493843, "outcome": "passed"}, "call": {"duration": 0.010469990782439709, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/scene/turn_on'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/integration/test_cross_feature.py", "lineno": 91, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "ws = <conftest.WSClient object at 0x7f47ab534850>\nrest = <conftest.RESTClient object at 0x7f47ab534f40>\n\n    async def test_scene_activation_triggers_ws_events(ws, rest):\n        \"\"\"Scene activation triggers WS state_changed events.\"\"\"\n        await rest.set_state(\"light.living_room_main\", \"off\")\n        sub_id = await ws.subscribe_events(\"state_changed\")\n    \n>       await rest.call_service(\"scene\", \"turn_on\", {\"entity_id\": \"scene.evening\"})\n\ntests/integration/test_cross_feature.py:91: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/scene/turn_on'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0018399478867650032, "outcome": "passed"}}, {"nodeid": "tests/integration/test_cross_feature.py::test_template_reflects_service_change", "lineno": 107, "outcome": "failed", "keywords": ["test_template_reflects_service_change", "test_cross_feature.py", "asyncio", "integration", "tests", "marge", ""], "setup": {"duration": 0.00897818198427558, "outcome": "passed"}, "call": {"duration": 0.00900079682469368, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/integration/test_cross_feature.py", "lineno": 119, "message": "AssertionError: assert '50' == 'off'\n  \n  - off\n  + 50"}, "traceback": [{"path": "tests/integration/test_cross_feature.py", "lineno": 119, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47ab6ff790>\n\n    async def test_template_reflects_service_change(rest):\n        \"\"\"Template rendering reflects state changed by service call.\"\"\"\n        entity = \"sensor.xfeat_tmpl\"\n        await rest.set_state(entity, \"50\")\n        await rest.call_service(\"homeassistant\", \"turn_off\", {\"entity_id\": entity})\n    \n        resp = await rest.client.post(\n            f\"{rest.base_url}/api/template\",\n            json={\"template\": f\"{{{{ states('{entity}') }}}}\"},\n            headers=rest._headers(),\n        )\n>       assert resp.text.strip() == \"off\"\nE       AssertionError: assert '50' == 'off'\nE         \nE         - off\nE         + 50\n\ntests/integration/test_cross_feature.py:119: AssertionError"}, "teardown": {"duration": 0.0006950628012418747, "outcome": "passed"}}, {"nodeid": "tests/integration/test_cross_feature.py::test_area_search_reflects_state_changes", "lineno": 123, "outcome": "failed", "keywords": ["test_area_search_reflects_state_changes", "test_cross_feature.py", "asyncio", "integration", "tests", "marge", ""], "setup": {"duration": 0.006341835018247366, "outcome": "passed"}, "call": {"duration": 0.008235305082052946, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/integration/test_cross_feature.py", "lineno": 147, "message": "TypeError: string indices must be integers"}, "traceback": [{"path": "tests/integration/test_cross_feature.py", "lineno": 147, "message": ""}, {"path": "tests/integration/test_cross_feature.py", "lineno": 147, "message": "TypeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0bf1580>\n\n    async def test_area_search_reflects_state_changes(rest):\n        \"\"\"Search by area returns entities with current state.\"\"\"\n        entity = \"sensor.xfeat_area_search\"\n        area_id = \"xfeat_room\"\n        await rest.set_state(entity, \"42\")\n        await rest.client.post(\n            f\"{rest.base_url}/api/areas\",\n            json={\"area_id\": area_id, \"name\": \"XFeat Room\"},\n            headers=rest._headers(),\n        )\n        await rest.client.post(\n            f\"{rest.base_url}/api/areas/{area_id}/entities/{entity}\",\n            headers=rest._headers(),\n        )\n    \n        # Update state\n        await rest.set_state(entity, \"99\")\n    \n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/states/search?area={area_id}\",\n            headers=rest._headers(),\n        )\n        data = resp.json()\n>       found = next(e for e in data if e[\"entity_id\"] == entity)\n\ntests/integration/test_cross_feature.py:147: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\n.0 = <dict_keyiterator object at 0x7f47ab5701d0>\n\n>   found = next(e for e in data if e[\"entity_id\"] == entity)\nE   TypeError: string indices must be integers\n\ntests/integration/test_cross_feature.py:147: TypeError"}, "teardown": {"duration": 0.000664970837533474, "outcome": "passed"}}, {"nodeid": "tests/integration/test_cross_feature.py::test_webhook_state_triggers_ws_event", "lineno": 152, "outcome": "failed", "keywords": ["test_webhook_state_triggers_ws_event", "test_cross_feature.py", "asyncio", "integration", "tests", "marge", ""], "setup": {"duration": 0.007506050169467926, "outcome": "passed"}, "call": {"duration": 3.0094701847992837, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/asyncio/tasks.py", "lineno": 492, "message": "asyncio.exceptions.TimeoutError"}, "traceback": [{"path": "tests/integration/test_cross_feature.py", "lineno": 164, "message": ""}, {"path": "tests/conftest.py", "lineno": 185, "message": "in recv_event"}, {"path": "../../anaconda3/lib/python3.9/asyncio/tasks.py", "lineno": 492, "message": "TimeoutError"}], "longrepr": "self = <websockets.asyncio.client.ClientConnection object at 0x7f47b0066040>\ndecode = None\n\n    async def recv(self, decode: bool | None = None) -> Data:\n        \"\"\"\n        Receive the next message.\n    \n        When the connection is closed, :meth:`recv` raises\n        :exc:`~websockets.exceptions.ConnectionClosed`. Specifically, it raises\n        :exc:`~websockets.exceptions.ConnectionClosedOK` after a normal closure\n        and :exc:`~websockets.exceptions.ConnectionClosedError` after a protocol\n        error or a network failure. This is how you detect the end of the\n        message stream.\n    \n        Canceling :meth:`recv` is safe. There's no risk of losing data. The next\n        invocation of :meth:`recv` will return the next message.\n    \n        This makes it possible to enforce a timeout by wrapping :meth:`recv` in\n        :func:`~asyncio.timeout` or :func:`~asyncio.wait_for`.\n    \n        When the message is fragmented, :meth:`recv` waits until all fragments\n        are received, reassembles them, and returns the whole message.\n    \n        Args:\n            decode: Set this flag to override the default behavior of returning\n                :class:`str` or :class:`bytes`. See below for details.\n    \n        Returns:\n            A string (:class:`str`) for a Text_ frame or a bytestring\n            (:class:`bytes`) for a Binary_ frame.\n    \n            .. _Text: https://datatracker.ietf.org/doc/html/rfc6455#section-5.6\n            .. _Binary: https://datatracker.ietf.org/doc/html/rfc6455#section-5.6\n    \n            You may override this behavior with the ``decode`` argument:\n    \n            * Set ``decode=False`` to disable UTF-8 decoding of Text_ frames and\n              return a bytestring (:class:`bytes`). This improves performance\n              when decoding isn't needed, for example if the message contains\n              JSON and you're using a JSON library that expects a bytestring.\n            * Set ``decode=True`` to force UTF-8 decoding of Binary_ frames\n              and return a string (:class:`str`). This may be useful for\n              servers that send binary frames instead of text frames.\n    \n        Raises:\n            ConnectionClosed: When the connection is closed.\n            ConcurrencyError: If two coroutines call :meth:`recv` or\n                :meth:`recv_streaming` concurrently.\n    \n        \"\"\"\n        try:\n>           return await self.recv_messages.get(decode)\n\n../../anaconda3/lib/python3.9/site-packages/websockets/asyncio/connection.py:303: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/websockets/asyncio/messages.py:159: in get\n    frame = await self.frames.get(not self.closed)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <websockets.asyncio.messages.SimpleQueue object at 0x7f47b0066520>\nblock = True\n\n    async def get(self, block: bool = True) -> T:\n        \"\"\"Remove and return an item from the queue, waiting if necessary.\"\"\"\n        if not self.queue:\n            if not block:\n                raise EOFError(\"stream of frames ended\")\n            assert self.get_waiter is None, \"cannot call get() concurrently\"\n            self.get_waiter = self.loop.create_future()\n            try:\n>               await self.get_waiter\nE               asyncio.exceptions.CancelledError\n\n../../anaconda3/lib/python3.9/site-packages/websockets/asyncio/messages.py:51: CancelledError\n\nDuring handling of the above exception, another exception occurred:\n\nfut = <Task cancelled name='Task-7080' coro=<Connection.recv() done, defined at /home/jcrigby/anaconda3/lib/python3.9/site-packages/websockets/asyncio/connection.py:255>>\ntimeout = 3.0\n\n    async def wait_for(fut, timeout, *, loop=None):\n        \"\"\"Wait for the single Future or coroutine to complete, with timeout.\n    \n        Coroutine will be wrapped in Task.\n    \n        Returns result of the Future or coroutine.  When a timeout occurs,\n        it cancels the task and raises TimeoutError.  To avoid the task\n        cancellation, wrap it in shield().\n    \n        If the wait is cancelled, the task is also cancelled.\n    \n        This function is a coroutine.\n        \"\"\"\n        if loop is None:\n            loop = events.get_running_loop()\n        else:\n            warnings.warn(\"The loop argument is deprecated since Python 3.8, \"\n                          \"and scheduled for removal in Python 3.10.\",\n                          DeprecationWarning, stacklevel=2)\n    \n        if timeout is None:\n            return await fut\n    \n        if timeout <= 0:\n            fut = ensure_future(fut, loop=loop)\n    \n            if fut.done():\n                return fut.result()\n    \n            await _cancel_and_wait(fut, loop=loop)\n            try:\n                return fut.result()\n            except exceptions.CancelledError as exc:\n                raise exceptions.TimeoutError() from exc\n    \n        waiter = loop.create_future()\n        timeout_handle = loop.call_later(timeout, _release_waiter, waiter)\n        cb = functools.partial(_release_waiter, waiter)\n    \n        fut = ensure_future(fut, loop=loop)\n        fut.add_done_callback(cb)\n    \n        try:\n            # wait until the future completes or the timeout\n            try:\n                await waiter\n            except exceptions.CancelledError:\n                if fut.done():\n                    return fut.result()\n                else:\n                    fut.remove_done_callback(cb)\n                    # We must ensure that the task is not running\n                    # after wait_for() returns.\n                    # See https://bugs.python.org/issue32751\n                    await _cancel_and_wait(fut, loop=loop)\n                    raise\n    \n            if fut.done():\n                return fut.result()\n            else:\n                fut.remove_done_callback(cb)\n                # We must ensure that the task is not running\n                # after wait_for() returns.\n                # See https://bugs.python.org/issue32751\n                await _cancel_and_wait(fut, loop=loop)\n                # In case task cancellation failed with some\n                # exception, we should re-raise it\n                # See https://bugs.python.org/issue40607\n                try:\n>                   return fut.result()\nE                   asyncio.exceptions.CancelledError\n\n../../anaconda3/lib/python3.9/asyncio/tasks.py:490: CancelledError\n\nThe above exception was the direct cause of the following exception:\n\nws = <conftest.WSClient object at 0x7f47b22a2c10>\nrest = <conftest.RESTClient object at 0x7f47ab5b6f70>\n\n    async def test_webhook_state_triggers_ws_event(ws, rest):\n        \"\"\"Webhook state change triggers WS event.\"\"\"\n        entity = \"sensor.xfeat_webhook_ws\"\n        await rest.set_state(entity, \"idle\")\n        sub_id = await ws.subscribe_events(\"state_changed\")\n    \n        await rest.client.post(\n            f\"{rest.base_url}/api/webhook/xfeat_hook\",\n            json={\"entity_id\": entity, \"state\": \"active\"},\n        )\n    \n>       event = await ws.recv_event(timeout=3.0)\n\ntests/integration/test_cross_feature.py:164: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:185: in recv_event\n    return json.loads(await asyncio.wait_for(self.ws.recv(), timeout))\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nfut = <Task cancelled name='Task-7080' coro=<Connection.recv() done, defined at /home/jcrigby/anaconda3/lib/python3.9/site-packages/websockets/asyncio/connection.py:255>>\ntimeout = 3.0\n\n    async def wait_for(fut, timeout, *, loop=None):\n        \"\"\"Wait for the single Future or coroutine to complete, with timeout.\n    \n        Coroutine will be wrapped in Task.\n    \n        Returns result of the Future or coroutine.  When a timeout occurs,\n        it cancels the task and raises TimeoutError.  To avoid the task\n        cancellation, wrap it in shield().\n    \n        If the wait is cancelled, the task is also cancelled.\n    \n        This function is a coroutine.\n        \"\"\"\n        if loop is None:\n            loop = events.get_running_loop()\n        else:\n            warnings.warn(\"The loop argument is deprecated since Python 3.8, \"\n                          \"and scheduled for removal in Python 3.10.\",\n                          DeprecationWarning, stacklevel=2)\n    \n        if timeout is None:\n            return await fut\n    \n        if timeout <= 0:\n            fut = ensure_future(fut, loop=loop)\n    \n            if fut.done():\n                return fut.result()\n    \n            await _cancel_and_wait(fut, loop=loop)\n            try:\n                return fut.result()\n            except exceptions.CancelledError as exc:\n                raise exceptions.TimeoutError() from exc\n    \n        waiter = loop.create_future()\n        timeout_handle = loop.call_later(timeout, _release_waiter, waiter)\n        cb = functools.partial(_release_waiter, waiter)\n    \n        fut = ensure_future(fut, loop=loop)\n        fut.add_done_callback(cb)\n    \n        try:\n            # wait until the future completes or the timeout\n            try:\n                await waiter\n            except exceptions.CancelledError:\n                if fut.done():\n                    return fut.result()\n                else:\n                    fut.remove_done_callback(cb)\n                    # We must ensure that the task is not running\n                    # after wait_for() returns.\n                    # See https://bugs.python.org/issue32751\n                    await _cancel_and_wait(fut, loop=loop)\n                    raise\n    \n            if fut.done():\n                return fut.result()\n            else:\n                fut.remove_done_callback(cb)\n                # We must ensure that the task is not running\n                # after wait_for() returns.\n                # See https://bugs.python.org/issue32751\n                await _cancel_and_wait(fut, loop=loop)\n                # In case task cancellation failed with some\n                # exception, we should re-raise it\n                # See https://bugs.python.org/issue40607\n                try:\n                    return fut.result()\n                except exceptions.CancelledError as exc:\n>                   raise exceptions.TimeoutError() from exc\nE                   asyncio.exceptions.TimeoutError\n\n../../anaconda3/lib/python3.9/asyncio/tasks.py:492: TimeoutError"}, "teardown": {"duration": 0.0012855040840804577, "outcome": "passed"}}, {"nodeid": "tests/integration/test_cross_feature.py::test_logbook_records_service_changes", "lineno": 170, "outcome": "failed", "keywords": ["test_logbook_records_service_changes", "test_cross_feature.py", "asyncio", "integration", "tests", "marge", ""], "setup": {"duration": 0.005365877877920866, "outcome": "passed"}, "call": {"duration": 0.15550366137176752, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/light/turn_on'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/integration/test_cross_feature.py", "lineno": 176, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b22a25b0>\n\n    async def test_logbook_records_service_changes(rest):\n        \"\"\"Service call state changes appear in logbook.\"\"\"\n        entity = \"light.xfeat_logbook\"\n        await rest.set_state(entity, \"off\")\n        await asyncio.sleep(_FLUSH)\n>       await rest.call_service(\"light\", \"turn_on\", {\"entity_id\": entity})\n\ntests/integration/test_cross_feature.py:176: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/light/turn_on'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.000687343068420887, "outcome": "passed"}}, {"nodeid": "tests/integration/test_cross_feature.py::test_health_state_changes_increment", "lineno": 188, "outcome": "failed", "keywords": ["test_health_state_changes_increment", "test_cross_feature.py", "asyncio", "integration", "tests", "marge", ""], "setup": {"duration": 0.005237680859863758, "outcome": "passed"}, "call": {"duration": 0.002829133067280054, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)"}, "traceback": [{"path": "tests/integration/test_cross_feature.py", "lineno": 191, "message": ""}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 832, "message": "in json"}, {"path": "../../anaconda3/lib/python3.9/json/__init__.py", "lineno": 346, "message": "in loads"}, {"path": "../../anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "JSONDecodeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b04a0280>\n\n    async def test_health_state_changes_increment(rest):\n        \"\"\"State changes counter increments with operations.\"\"\"\n>       h1 = (await rest.client.get(f\"{rest.base_url}/api/health\")).json()\n\ntests/integration/test_cross_feature.py:191: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:832: in json\n    return jsonlib.loads(self.content, **kwargs)\n../../anaconda3/lib/python3.9/json/__init__.py:346: in loads\n    return _default_decoder.decode(s)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <json.decoder.JSONDecoder object at 0x7f47b2e5fe50>, s = '404: Not Found'\n_w = <built-in method match of re.Pattern object at 0x7f47b3015cf0>\n\n    def decode(self, s, _w=WHITESPACE.match):\n        \"\"\"Return the Python representation of ``s`` (a ``str`` instance\n        containing a JSON document).\n    \n        \"\"\"\n        obj, end = self.raw_decode(s, idx=_w(s, 0).end())\n        end = _w(s, end).end()\n        if end != len(s):\n>           raise JSONDecodeError(\"Extra data\", s, end)\nE           json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)\n\n../../anaconda3/lib/python3.9/json/decoder.py:340: JSONDecodeError"}, "teardown": {"duration": 0.0008264351636171341, "outcome": "passed"}}, {"nodeid": "tests/integration/test_end_to_end.py::test_set_state_and_read_back", "lineno": 44, "outcome": "passed", "keywords": ["test_set_state_and_read_back", "test_end_to_end.py", "asyncio", "integration", "tests", "marge", ""], "setup": {"duration": 0.005259879864752293, "outcome": "passed"}, "call": {"duration": 0.004049819894134998, "outcome": "passed"}, "teardown": {"duration": 0.0004951418377459049, "outcome": "passed"}}, {"nodeid": "tests/integration/test_end_to_end.py::test_service_call_changes_state", "lineno": 55, "outcome": "failed", "keywords": ["test_service_call_changes_state", "test_end_to_end.py", "asyncio", "integration", "tests", "marge", ""], "setup": {"duration": 0.005339585244655609, "outcome": "passed"}, "call": {"duration": 0.005364874843508005, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/light/turn_on'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/integration/test_end_to_end.py", "lineno": 59, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47ab73f2e0>\n\n    async def test_service_call_changes_state(rest):\n        \"\"\"Service call through REST changes entity state.\"\"\"\n        await rest.set_state(\"light.e2e_svc\", \"off\")\n>       await rest.call_service(\"light\", \"turn_on\", {\n            \"entity_id\": \"light.e2e_svc\",\n            \"brightness\": 200,\n        })\n\ntests/integration/test_end_to_end.py:59: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/light/turn_on'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0007372586987912655, "outcome": "passed"}}, {"nodeid": "tests/integration/test_end_to_end.py::test_ws_receives_state_change", "lineno": 67, "outcome": "passed", "keywords": ["test_ws_receives_state_change", "test_end_to_end.py", "asyncio", "integration", "tests", "marge", ""], "setup": {"duration": 0.0077325752936303616, "outcome": "passed"}, "call": {"duration": 0.003925562836229801, "outcome": "passed"}, "teardown": {"duration": 0.001074336003512144, "outcome": "passed"}}, {"nodeid": "tests/integration/test_end_to_end.py::test_discovery_creates_entity_then_service_controls", "lineno": 77, "outcome": "passed", "keywords": ["test_discovery_creates_entity_then_service_controls", "test_end_to_end.py", "asyncio", "integration", "tests", "marge", ""], "setup": {"duration": 0.0003923051990568638, "outcome": "passed"}, "call": {"duration": 1.5351389558054507, "outcome": "passed"}, "teardown": {"duration": 0.000464610755443573, "outcome": "passed"}}, {"nodeid": "tests/integration/test_end_to_end.py::test_mqtt_bridge_updates_state", "lineno": 107, "outcome": "passed", "keywords": ["test_mqtt_bridge_updates_state", "test_end_to_end.py", "asyncio", "integration", "tests", "marge", ""], "setup": {"duration": 0.0005603600293397903, "outcome": "passed"}, "call": {"duration": 1.5107272048480809, "outcome": "passed"}, "teardown": {"duration": 0.0003569582477211952, "outcome": "passed"}}, {"nodeid": "tests/integration/test_end_to_end.py::test_discovery_state_update_with_template", "lineno": 117, "outcome": "passed", "keywords": ["test_discovery_state_update_with_template", "test_end_to_end.py", "asyncio", "integration", "tests", "marge", ""], "setup": {"duration": 0.00038402900099754333, "outcome": "passed"}, "call": {"duration": 3.0156877669505775, "outcome": "passed"}, "teardown": {"duration": 0.0005650143139064312, "outcome": "passed"}}, {"nodeid": "tests/integration/test_end_to_end.py::test_automation_trigger_fires_actions", "lineno": 137, "outcome": "failed", "keywords": ["test_automation_trigger_fires_actions", "test_end_to_end.py", "asyncio", "integration", "tests", "marge", ""], "setup": {"duration": 0.005040669813752174, "outcome": "passed"}, "call": {"duration": 0.20895739970728755, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/integration/test_end_to_end.py", "lineno": 145, "message": "TypeError: 'NoneType' object is not subscriptable"}, "traceback": [{"path": "tests/integration/test_end_to_end.py", "lineno": 145, "message": "TypeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47ab771d30>\n\n    async def test_automation_trigger_fires_actions(rest):\n        \"\"\"State change triggers automation that fires actions.\"\"\"\n        # smoke_co_emergency triggers on binary_sensor.smoke_detector -> on\n        await rest.set_state(\"binary_sensor.smoke_detector\", \"off\")\n        await asyncio.sleep(0.2)\n    \n        s1 = await rest.get_state(\"automation.smoke_co_emergency\")\n>       count_before = s1[\"attributes\"].get(\"current\", 0)\nE       TypeError: 'NoneType' object is not subscriptable\n\ntests/integration/test_end_to_end.py:145: TypeError"}, "teardown": {"duration": 0.0006316001527011395, "outcome": "passed"}}, {"nodeid": "tests/integration/test_end_to_end.py::test_scene_activation_multiple_entities", "lineno": 155, "outcome": "failed", "keywords": ["test_scene_activation_multiple_entities", "test_end_to_end.py", "asyncio", "integration", "tests", "marge", ""], "setup": {"duration": 0.005211643874645233, "outcome": "passed"}, "call": {"duration": 0.00841889576986432, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/scene/turn_on'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/integration/test_end_to_end.py", "lineno": 163, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47ab75df70>\n\n    async def test_scene_activation_multiple_entities(rest):\n        \"\"\"Scene activation sets multiple entity states at once.\"\"\"\n        # Reset states\n        for eid in [\"light.living_room_main\", \"light.living_room_accent\",\n                    \"light.living_room_lamp\", \"light.living_room_floor\"]:\n            await rest.set_state(eid, \"off\")\n    \n>       await rest.call_service(\"scene\", \"turn_on\", {\n            \"entity_id\": \"scene.evening\"\n        })\n\ntests/integration/test_end_to_end.py:163: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/scene/turn_on'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0007056477479636669, "outcome": "passed"}}, {"nodeid": "tests/integration/test_end_to_end.py::test_health_after_operations", "lineno": 174, "outcome": "failed", "keywords": ["test_health_after_operations", "test_end_to_end.py", "asyncio", "integration", "tests", "marge", ""], "setup": {"duration": 0.005574531387537718, "outcome": "passed"}, "call": {"duration": 0.0028770570643246174, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '404 Not Found' for url 'http://localhost:8123/api/health'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/404"}, "traceback": [{"path": "tests/integration/test_end_to_end.py", "lineno": 177, "message": ""}, {"path": "tests/conftest.py", "lineno": 122, "message": "in get_health"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b21ed190>\n\n    async def test_health_after_operations(rest):\n        \"\"\"Health endpoint reflects accumulated metrics.\"\"\"\n>       health = await rest.get_health()\n\ntests/integration/test_end_to_end.py:177: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:122: in get_health\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [404 Not Found]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '404 Not Found' for url 'http://localhost:8123/api/health'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/404\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0008275876753032207, "outcome": "passed"}}, {"nodeid": "tests/integration/test_esphome_zwave_bridge.py::test_zwave_node_update", "lineno": 44, "outcome": "skipped", "keywords": ["test_zwave_node_update", "test_esphome_zwave_bridge.py", "asyncio", "marge_only", "integration", "tests", "marge", ""], "setup": {"duration": 0.00024686288088560104, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/integration/test_esphome_zwave_bridge.py', 45, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00012663286179304123, "outcome": "passed"}}, {"nodeid": "tests/integration/test_esphome_zwave_bridge.py::test_zwave_node_value", "lineno": 58, "outcome": "skipped", "keywords": ["test_zwave_node_value", "test_esphome_zwave_bridge.py", "asyncio", "marge_only", "integration", "tests", "marge", ""], "setup": {"duration": 0.00019664503633975983, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/integration/test_esphome_zwave_bridge.py', 59, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00012546079233288765, "outcome": "passed"}}, {"nodeid": "tests/integration/test_esphome_zwave_bridge.py::test_zwave_gateway_status", "lineno": 68, "outcome": "skipped", "keywords": ["test_zwave_gateway_status", "test_esphome_zwave_bridge.py", "asyncio", "marge_only", "integration", "tests", "marge", ""], "setup": {"duration": 0.0001899711787700653, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/integration/test_esphome_zwave_bridge.py', 69, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.0001645139418542385, "outcome": "passed"}}, {"nodeid": "tests/integration/test_esphome_zwave_bridge.py::test_zwave_node_list", "lineno": 74, "outcome": "skipped", "keywords": ["test_zwave_node_list", "test_esphome_zwave_bridge.py", "asyncio", "marge_only", "integration", "tests", "marge", ""], "setup": {"duration": 0.00019122101366519928, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/integration/test_esphome_zwave_bridge.py', 75, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.0002529430203139782, "outcome": "passed"}}, {"nodeid": "tests/integration/test_esphome_zwave_bridge.py::test_esphome_status_online", "lineno": 87, "outcome": "skipped", "keywords": ["test_esphome_status_online", "test_esphome_zwave_bridge.py", "asyncio", "marge_only", "integration", "tests", "marge", ""], "setup": {"duration": 0.00018975697457790375, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/integration/test_esphome_zwave_bridge.py', 88, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00012393854558467865, "outcome": "passed"}}, {"nodeid": "tests/integration/test_esphome_zwave_bridge.py::test_esphome_status_offline", "lineno": 95, "outcome": "skipped", "keywords": ["test_esphome_status_offline", "test_esphome_zwave_bridge.py", "asyncio", "marge_only", "integration", "tests", "marge", ""], "setup": {"duration": 0.0001865178346633911, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/integration/test_esphome_zwave_bridge.py', 96, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00012542866170406342, "outcome": "passed"}}, {"nodeid": "tests/integration/test_esphome_zwave_bridge.py::test_esphome_sensor_state", "lineno": 105, "outcome": "skipped", "keywords": ["test_esphome_sensor_state", "test_esphome_zwave_bridge.py", "asyncio", "marge_only", "integration", "tests", "marge", ""], "setup": {"duration": 0.0001905849203467369, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/integration/test_esphome_zwave_bridge.py', 106, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00012514321133494377, "outcome": "passed"}}, {"nodeid": "tests/integration/test_esphome_zwave_bridge.py::test_esphome_switch_state", "lineno": 117, "outcome": "skipped", "keywords": ["test_esphome_switch_state", "test_esphome_zwave_bridge.py", "asyncio", "marge_only", "integration", "tests", "marge", ""], "setup": {"duration": 0.00018886802718043327, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/integration/test_esphome_zwave_bridge.py', 118, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00012527918443083763, "outcome": "passed"}}, {"nodeid": "tests/integration/test_esphome_zwave_bridge.py::test_esphome_binary_sensor", "lineno": 127, "outcome": "skipped", "keywords": ["test_esphome_binary_sensor", "test_esphome_zwave_bridge.py", "asyncio", "marge_only", "integration", "tests", "marge", ""], "setup": {"duration": 0.00022392813116312027, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/integration/test_esphome_zwave_bridge.py', 128, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.0001275939866900444, "outcome": "passed"}}, {"nodeid": "tests/integration/test_history_logbook_integration.py::test_history_returns_200", "lineno": 17, "outcome": "failed", "keywords": ["test_history_returns_200", "test_history_logbook_integration.py", "asyncio", "integration", "tests", "marge", ""], "setup": {"duration": 0.005626988131552935, "outcome": "passed"}, "call": {"duration": 0.306009154766798, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/integration/test_history_logbook_integration.py", "lineno": 29, "message": "assert 404 == 200\n +  where 404 = <Response [404 Not Found]>.status_code"}, "traceback": [{"path": "tests/integration/test_history_logbook_integration.py", "lineno": 29, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b21ed400>\n\n    async def test_history_returns_200(rest):\n        \"\"\"GET /api/history/period/:entity_id returns 200.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"sensor.hist_{tag}\"\n        await rest.set_state(eid, \"42\")\n        await asyncio.sleep(0.3)\n    \n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/history/period/{eid}\",\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 404 == 200\nE        +  where 404 = <Response [404 Not Found]>.status_code\n\ntests/integration/test_history_logbook_integration.py:29: AssertionError"}, "teardown": {"duration": 0.0008165487088263035, "outcome": "passed"}}, {"nodeid": "tests/integration/test_history_logbook_integration.py::test_history_returns_list", "lineno": 31, "outcome": "failed", "keywords": ["test_history_returns_list", "test_history_logbook_integration.py", "asyncio", "integration", "tests", "marge", ""], "setup": {"duration": 0.007449009921401739, "outcome": "passed"}, "call": {"duration": 0.30579771380871534, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)"}, "traceback": [{"path": "tests/integration/test_history_logbook_integration.py", "lineno": 43, "message": ""}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 832, "message": "in json"}, {"path": "../../anaconda3/lib/python3.9/json/__init__.py", "lineno": 346, "message": "in loads"}, {"path": "../../anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "JSONDecodeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47ab738460>\n\n    async def test_history_returns_list(rest):\n        \"\"\"History returns a JSON array of state entries.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"sensor.hist_list_{tag}\"\n        await rest.set_state(eid, \"first\")\n        await asyncio.sleep(0.3)\n    \n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/history/period/{eid}\",\n            headers=rest._headers(),\n        )\n>       data = resp.json()\n\ntests/integration/test_history_logbook_integration.py:43: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:832: in json\n    return jsonlib.loads(self.content, **kwargs)\n../../anaconda3/lib/python3.9/json/__init__.py:346: in loads\n    return _default_decoder.decode(s)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <json.decoder.JSONDecoder object at 0x7f47b2e5fe50>, s = '404: Not Found'\n_w = <built-in method match of re.Pattern object at 0x7f47b3015cf0>\n\n    def decode(self, s, _w=WHITESPACE.match):\n        \"\"\"Return the Python representation of ``s`` (a ``str`` instance\n        containing a JSON document).\n    \n        \"\"\"\n        obj, end = self.raw_decode(s, idx=_w(s, 0).end())\n        end = _w(s, end).end()\n        if end != len(s):\n>           raise JSONDecodeError(\"Extra data\", s, end)\nE           json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)\n\n../../anaconda3/lib/python3.9/json/decoder.py:340: JSONDecodeError"}, "teardown": {"duration": 0.0007469924166798592, "outcome": "passed"}}, {"nodeid": "tests/integration/test_history_logbook_integration.py::test_history_entry_has_fields", "lineno": 46, "outcome": "failed", "keywords": ["test_history_entry_has_fields", "test_history_logbook_integration.py", "asyncio", "integration", "tests", "marge", ""], "setup": {"duration": 0.005738785956054926, "outcome": "passed"}, "call": {"duration": 0.30600863602012396, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)"}, "traceback": [{"path": "tests/integration/test_history_logbook_integration.py", "lineno": 58, "message": ""}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 832, "message": "in json"}, {"path": "../../anaconda3/lib/python3.9/json/__init__.py", "lineno": 346, "message": "in loads"}, {"path": "../../anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "JSONDecodeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47ab532910>\n\n    async def test_history_entry_has_fields(rest):\n        \"\"\"History entries have entity_id, state, attributes, timestamps.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"sensor.hist_fields_{tag}\"\n        await rest.set_state(eid, \"val\")\n        await asyncio.sleep(0.3)\n    \n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/history/period/{eid}\",\n            headers=rest._headers(),\n        )\n>       data = resp.json()\n\ntests/integration/test_history_logbook_integration.py:58: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:832: in json\n    return jsonlib.loads(self.content, **kwargs)\n../../anaconda3/lib/python3.9/json/__init__.py:346: in loads\n    return _default_decoder.decode(s)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <json.decoder.JSONDecoder object at 0x7f47b2e5fe50>, s = '404: Not Found'\n_w = <built-in method match of re.Pattern object at 0x7f47b3015cf0>\n\n    def decode(self, s, _w=WHITESPACE.match):\n        \"\"\"Return the Python representation of ``s`` (a ``str`` instance\n        containing a JSON document).\n    \n        \"\"\"\n        obj, end = self.raw_decode(s, idx=_w(s, 0).end())\n        end = _w(s, end).end()\n        if end != len(s):\n>           raise JSONDecodeError(\"Extra data\", s, end)\nE           json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)\n\n../../anaconda3/lib/python3.9/json/decoder.py:340: JSONDecodeError"}, "teardown": {"duration": 0.0010476387105882168, "outcome": "passed"}}, {"nodeid": "tests/integration/test_history_logbook_integration.py::test_history_records_state_change", "lineno": 66, "outcome": "failed", "keywords": ["test_history_records_state_change", "test_history_logbook_integration.py", "asyncio", "integration", "tests", "marge", ""], "setup": {"duration": 0.007706617936491966, "outcome": "passed"}, "call": {"duration": 0.5141560263000429, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)"}, "traceback": [{"path": "tests/integration/test_history_logbook_integration.py", "lineno": 82, "message": ""}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 832, "message": "in json"}, {"path": "../../anaconda3/lib/python3.9/json/__init__.py", "lineno": 346, "message": "in loads"}, {"path": "../../anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "JSONDecodeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b22a6220>\n\n    async def test_history_records_state_change(rest):\n        \"\"\"State changes appear in history.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"sensor.hist_change_{tag}\"\n        await rest.set_state(eid, \"one\")\n        await asyncio.sleep(0.1)\n        await rest.set_state(eid, \"two\")\n        await asyncio.sleep(0.1)\n        await rest.set_state(eid, \"three\")\n        await asyncio.sleep(0.3)\n    \n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/history/period/{eid}\",\n            headers=rest._headers(),\n        )\n>       data = resp.json()\n\ntests/integration/test_history_logbook_integration.py:82: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:832: in json\n    return jsonlib.loads(self.content, **kwargs)\n../../anaconda3/lib/python3.9/json/__init__.py:346: in loads\n    return _default_decoder.decode(s)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <json.decoder.JSONDecoder object at 0x7f47b2e5fe50>, s = '404: Not Found'\n_w = <built-in method match of re.Pattern object at 0x7f47b3015cf0>\n\n    def decode(self, s, _w=WHITESPACE.match):\n        \"\"\"Return the Python representation of ``s`` (a ``str`` instance\n        containing a JSON document).\n    \n        \"\"\"\n        obj, end = self.raw_decode(s, idx=_w(s, 0).end())\n        end = _w(s, end).end()\n        if end != len(s):\n>           raise JSONDecodeError(\"Extra data\", s, end)\nE           json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)\n\n../../anaconda3/lib/python3.9/json/decoder.py:340: JSONDecodeError"}, "teardown": {"duration": 0.0006836410611867905, "outcome": "passed"}}, {"nodeid": "tests/integration/test_history_logbook_integration.py::test_history_preserves_order", "lineno": 87, "outcome": "failed", "keywords": ["test_history_preserves_order", "test_history_logbook_integration.py", "asyncio", "integration", "tests", "marge", ""], "setup": {"duration": 0.005245104897767305, "outcome": "passed"}, "call": {"duration": 0.5679348139092326, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)"}, "traceback": [{"path": "tests/integration/test_history_logbook_integration.py", "lineno": 101, "message": ""}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 832, "message": "in json"}, {"path": "../../anaconda3/lib/python3.9/json/__init__.py", "lineno": 346, "message": "in loads"}, {"path": "../../anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "JSONDecodeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47ab618700>\n\n    async def test_history_preserves_order(rest):\n        \"\"\"History entries are in chronological order.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"sensor.hist_order_{tag}\"\n        for i in range(5):\n            await rest.set_state(eid, str(i))\n            await asyncio.sleep(0.05)\n        await asyncio.sleep(0.3)\n    \n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/history/period/{eid}\",\n            headers=rest._headers(),\n        )\n>       data = resp.json()\n\ntests/integration/test_history_logbook_integration.py:101: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:832: in json\n    return jsonlib.loads(self.content, **kwargs)\n../../anaconda3/lib/python3.9/json/__init__.py:346: in loads\n    return _default_decoder.decode(s)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <json.decoder.JSONDecoder object at 0x7f47b2e5fe50>, s = '404: Not Found'\n_w = <built-in method match of re.Pattern object at 0x7f47b3015cf0>\n\n    def decode(self, s, _w=WHITESPACE.match):\n        \"\"\"Return the Python representation of ``s`` (a ``str`` instance\n        containing a JSON document).\n    \n        \"\"\"\n        obj, end = self.raw_decode(s, idx=_w(s, 0).end())\n        end = _w(s, end).end()\n        if end != len(s):\n>           raise JSONDecodeError(\"Extra data\", s, end)\nE           json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)\n\n../../anaconda3/lib/python3.9/json/decoder.py:340: JSONDecodeError"}, "teardown": {"duration": 0.0007147300057113171, "outcome": "passed"}}, {"nodeid": "tests/integration/test_history_logbook_integration.py::test_history_empty_for_unknown_entity", "lineno": 106, "outcome": "failed", "keywords": ["test_history_empty_for_unknown_entity", "test_history_logbook_integration.py", "asyncio", "integration", "tests", "marge", ""], "setup": {"duration": 0.005670785903930664, "outcome": "passed"}, "call": {"duration": 0.0026821219362318516, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)"}, "traceback": [{"path": "tests/integration/test_history_logbook_integration.py", "lineno": 113, "message": ""}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 832, "message": "in json"}, {"path": "../../anaconda3/lib/python3.9/json/__init__.py", "lineno": 346, "message": "in loads"}, {"path": "../../anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "JSONDecodeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47ab4a4130>\n\n    async def test_history_empty_for_unknown_entity(rest):\n        \"\"\"History for non-existent entity returns empty list.\"\"\"\n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/history/period/sensor.nonexistent_xyz_99\",\n            headers=rest._headers(),\n        )\n>       data = resp.json()\n\ntests/integration/test_history_logbook_integration.py:113: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:832: in json\n    return jsonlib.loads(self.content, **kwargs)\n../../anaconda3/lib/python3.9/json/__init__.py:346: in loads\n    return _default_decoder.decode(s)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <json.decoder.JSONDecoder object at 0x7f47b2e5fe50>, s = '404: Not Found'\n_w = <built-in method match of re.Pattern object at 0x7f47b3015cf0>\n\n    def decode(self, s, _w=WHITESPACE.match):\n        \"\"\"Return the Python representation of ``s`` (a ``str`` instance\n        containing a JSON document).\n    \n        \"\"\"\n        obj, end = self.raw_decode(s, idx=_w(s, 0).end())\n        end = _w(s, end).end()\n        if end != len(s):\n>           raise JSONDecodeError(\"Extra data\", s, end)\nE           json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)\n\n../../anaconda3/lib/python3.9/json/decoder.py:340: JSONDecodeError"}, "teardown": {"duration": 0.0009159371256828308, "outcome": "passed"}}, {"nodeid": "tests/integration/test_history_logbook_integration.py::test_global_logbook_returns_200", "lineno": 119, "outcome": "failed", "keywords": ["test_global_logbook_returns_200", "test_history_logbook_integration.py", "asyncio", "integration", "tests", "marge", ""], "setup": {"duration": 0.005760025233030319, "outcome": "passed"}, "call": {"duration": 0.002737036906182766, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/integration/test_history_logbook_integration.py", "lineno": 126, "message": "assert 404 == 200\n +  where 404 = <Response [404 Not Found]>.status_code"}, "traceback": [{"path": "tests/integration/test_history_logbook_integration.py", "lineno": 126, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47ab4a4d00>\n\n    async def test_global_logbook_returns_200(rest):\n        \"\"\"GET /api/logbook returns 200.\"\"\"\n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/logbook\",\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 404 == 200\nE        +  where 404 = <Response [404 Not Found]>.status_code\n\ntests/integration/test_history_logbook_integration.py:126: AssertionError"}, "teardown": {"duration": 0.0004775822162628174, "outcome": "passed"}}, {"nodeid": "tests/integration/test_history_logbook_integration.py::test_global_logbook_returns_list", "lineno": 128, "outcome": "failed", "keywords": ["test_global_logbook_returns_list", "test_history_logbook_integration.py", "asyncio", "integration", "tests", "marge", ""], "setup": {"duration": 0.005709787830710411, "outcome": "passed"}, "call": {"duration": 0.0028045079670846462, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)"}, "traceback": [{"path": "tests/integration/test_history_logbook_integration.py", "lineno": 135, "message": ""}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 832, "message": "in json"}, {"path": "../../anaconda3/lib/python3.9/json/__init__.py", "lineno": 346, "message": "in loads"}, {"path": "../../anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "JSONDecodeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0378220>\n\n    async def test_global_logbook_returns_list(rest):\n        \"\"\"Global logbook returns a JSON array.\"\"\"\n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/logbook\",\n            headers=rest._headers(),\n        )\n>       data = resp.json()\n\ntests/integration/test_history_logbook_integration.py:135: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:832: in json\n    return jsonlib.loads(self.content, **kwargs)\n../../anaconda3/lib/python3.9/json/__init__.py:346: in loads\n    return _default_decoder.decode(s)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <json.decoder.JSONDecoder object at 0x7f47b2e5fe50>, s = '404: Not Found'\n_w = <built-in method match of re.Pattern object at 0x7f47b3015cf0>\n\n    def decode(self, s, _w=WHITESPACE.match):\n        \"\"\"Return the Python representation of ``s`` (a ``str`` instance\n        containing a JSON document).\n    \n        \"\"\"\n        obj, end = self.raw_decode(s, idx=_w(s, 0).end())\n        end = _w(s, end).end()\n        if end != len(s):\n>           raise JSONDecodeError(\"Extra data\", s, end)\nE           json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)\n\n../../anaconda3/lib/python3.9/json/decoder.py:340: JSONDecodeError"}, "teardown": {"duration": 0.0006402670405805111, "outcome": "passed"}}, {"nodeid": "tests/integration/test_history_logbook_integration.py::test_global_logbook_entry_has_fields", "lineno": 138, "outcome": "failed", "keywords": ["test_global_logbook_entry_has_fields", "test_history_logbook_integration.py", "asyncio", "integration", "tests", "marge", ""], "setup": {"duration": 0.006619933061301708, "outcome": "passed"}, "call": {"duration": 0.40762063302099705, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)"}, "traceback": [{"path": "tests/integration/test_history_logbook_integration.py", "lineno": 152, "message": ""}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 832, "message": "in json"}, {"path": "../../anaconda3/lib/python3.9/json/__init__.py", "lineno": 346, "message": "in loads"}, {"path": "../../anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "JSONDecodeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47ab6f8610>\n\n    async def test_global_logbook_entry_has_fields(rest):\n        \"\"\"Logbook entries have entity_id, state, when.\"\"\"\n        # Create some state changes first\n        tag = uuid.uuid4().hex[:8]\n        await rest.set_state(f\"sensor.logbook_{tag}\", \"first\")\n        await asyncio.sleep(0.1)\n        await rest.set_state(f\"sensor.logbook_{tag}\", \"second\")\n        await asyncio.sleep(0.3)\n    \n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/logbook\",\n            headers=rest._headers(),\n        )\n>       data = resp.json()\n\ntests/integration/test_history_logbook_integration.py:152: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:832: in json\n    return jsonlib.loads(self.content, **kwargs)\n../../anaconda3/lib/python3.9/json/__init__.py:346: in loads\n    return _default_decoder.decode(s)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <json.decoder.JSONDecoder object at 0x7f47b2e5fe50>, s = '404: Not Found'\n_w = <built-in method match of re.Pattern object at 0x7f47b3015cf0>\n\n    def decode(self, s, _w=WHITESPACE.match):\n        \"\"\"Return the Python representation of ``s`` (a ``str`` instance\n        containing a JSON document).\n    \n        \"\"\"\n        obj, end = self.raw_decode(s, idx=_w(s, 0).end())\n        end = _w(s, end).end()\n        if end != len(s):\n>           raise JSONDecodeError(\"Extra data\", s, end)\nE           json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)\n\n../../anaconda3/lib/python3.9/json/decoder.py:340: JSONDecodeError"}, "teardown": {"duration": 0.0007652495987713337, "outcome": "passed"}}, {"nodeid": "tests/integration/test_history_logbook_integration.py::test_entity_logbook_returns_200", "lineno": 161, "outcome": "failed", "keywords": ["test_entity_logbook_returns_200", "test_history_logbook_integration.py", "asyncio", "integration", "tests", "marge", ""], "setup": {"duration": 0.0055251759476959705, "outcome": "passed"}, "call": {"duration": 0.3074349840171635, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/integration/test_history_logbook_integration.py", "lineno": 173, "message": "assert 404 == 200\n +  where 404 = <Response [404 Not Found]>.status_code"}, "traceback": [{"path": "tests/integration/test_history_logbook_integration.py", "lineno": 173, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b22ec370>\n\n    async def test_entity_logbook_returns_200(rest):\n        \"\"\"GET /api/logbook/:entity_id returns 200.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"sensor.elog_{tag}\"\n        await rest.set_state(eid, \"val\")\n        await asyncio.sleep(0.3)\n    \n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/logbook/{eid}\",\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 404 == 200\nE        +  where 404 = <Response [404 Not Found]>.status_code\n\ntests/integration/test_history_logbook_integration.py:173: AssertionError"}, "teardown": {"duration": 0.002210918813943863, "outcome": "passed"}}, {"nodeid": "tests/integration/test_history_logbook_integration.py::test_entity_logbook_only_shows_changes", "lineno": 175, "outcome": "failed", "keywords": ["test_entity_logbook_only_shows_changes", "test_history_logbook_integration.py", "asyncio", "integration", "tests", "marge", ""], "setup": {"duration": 0.013443175237625837, "outcome": "passed"}, "call": {"duration": 0.41436372976750135, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)"}, "traceback": [{"path": "tests/integration/test_history_logbook_integration.py", "lineno": 191, "message": ""}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 832, "message": "in json"}, {"path": "../../anaconda3/lib/python3.9/json/__init__.py", "lineno": 346, "message": "in loads"}, {"path": "../../anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "JSONDecodeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47ab3ea580>\n\n    async def test_entity_logbook_only_shows_changes(rest):\n        \"\"\"Entity logbook only includes actual state changes, not same-state updates.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"sensor.elog_dedup_{tag}\"\n        await rest.set_state(eid, \"val_a\")\n        await asyncio.sleep(0.05)\n        await rest.set_state(eid, \"val_a\")  # Same state\n        await asyncio.sleep(0.05)\n        await rest.set_state(eid, \"val_b\")\n        await asyncio.sleep(0.3)\n    \n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/logbook/{eid}\",\n            headers=rest._headers(),\n        )\n>       data = resp.json()\n\ntests/integration/test_history_logbook_integration.py:191: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:832: in json\n    return jsonlib.loads(self.content, **kwargs)\n../../anaconda3/lib/python3.9/json/__init__.py:346: in loads\n    return _default_decoder.decode(s)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <json.decoder.JSONDecoder object at 0x7f47b2e5fe50>, s = '404: Not Found'\n_w = <built-in method match of re.Pattern object at 0x7f47b3015cf0>\n\n    def decode(self, s, _w=WHITESPACE.match):\n        \"\"\"Return the Python representation of ``s`` (a ``str`` instance\n        containing a JSON document).\n    \n        \"\"\"\n        obj, end = self.raw_decode(s, idx=_w(s, 0).end())\n        end = _w(s, end).end()\n        if end != len(s):\n>           raise JSONDecodeError(\"Extra data\", s, end)\nE           json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)\n\n../../anaconda3/lib/python3.9/json/decoder.py:340: JSONDecodeError"}, "teardown": {"duration": 0.0008589699864387512, "outcome": "passed"}}, {"nodeid": "tests/integration/test_mqtt_discovery_entities.py::test_discovery_sensor_creates_entity", "lineno": 42, "outcome": "passed", "keywords": ["test_discovery_sensor_creates_entity", "test_mqtt_discovery_entities.py", "asyncio", "integration", "tests", "marge", ""], "setup": {"duration": 0.0004879441112279892, "outcome": "passed"}, "call": {"duration": 2.0142642208375037, "outcome": "passed"}, "teardown": {"duration": 0.0005513927899301052, "outcome": "passed"}}, {"nodeid": "tests/integration/test_mqtt_discovery_entities.py::test_discovery_binary_sensor", "lineno": 62, "outcome": "passed", "keywords": ["test_discovery_binary_sensor", "test_mqtt_discovery_entities.py", "asyncio", "integration", "tests", "marge", ""], "setup": {"duration": 0.0005957521498203278, "outcome": "passed"}, "call": {"duration": 2.0150232780724764, "outcome": "passed"}, "teardown": {"duration": 0.0004892549477517605, "outcome": "passed"}}, {"nodeid": "tests/integration/test_mqtt_discovery_entities.py::test_discovery_switch", "lineno": 83, "outcome": "passed", "keywords": ["test_discovery_switch", "test_mqtt_discovery_entities.py", "asyncio", "integration", "tests", "marge", ""], "setup": {"duration": 0.0005800961516797543, "outcome": "passed"}, "call": {"duration": 2.010325388982892, "outcome": "passed"}, "teardown": {"duration": 0.0003563789650797844, "outcome": "passed"}}, {"nodeid": "tests/integration/test_mqtt_discovery_entities.py::test_discovery_light", "lineno": 104, "outcome": "passed", "keywords": ["test_discovery_light", "test_mqtt_discovery_entities.py", "asyncio", "integration", "tests", "marge", ""], "setup": {"duration": 0.00038149161264300346, "outcome": "passed"}, "call": {"duration": 2.0146436407230794, "outcome": "passed"}, "teardown": {"duration": 0.00040111225098371506, "outcome": "passed"}}, {"nodeid": "tests/integration/test_mqtt_discovery_entities.py::test_discovery_empty_payload_removes_entity", "lineno": 125, "outcome": "passed", "keywords": ["test_discovery_empty_payload_removes_entity", "test_mqtt_discovery_entities.py", "asyncio", "integration", "tests", "marge", ""], "setup": {"duration": 0.0004208809696137905, "outcome": "passed"}, "call": {"duration": 4.017570597119629, "outcome": "passed"}, "teardown": {"duration": 0.0005328231491148472, "outcome": "passed"}}, {"nodeid": "tests/integration/test_mqtt_discovery_entities.py::test_discovery_with_device_info", "lineno": 149, "outcome": "passed", "keywords": ["test_discovery_with_device_info", "test_mqtt_discovery_entities.py", "asyncio", "integration", "tests", "marge", ""], "setup": {"duration": 0.0006020180881023407, "outcome": "passed"}, "call": {"duration": 2.004319022875279, "outcome": "passed"}, "teardown": {"duration": 0.0006295717321336269, "outcome": "passed"}}, {"nodeid": "tests/integration/test_mqtt_discovery_entities.py::test_discovery_with_value_template", "lineno": 170, "outcome": "passed", "keywords": ["test_discovery_with_value_template", "test_mqtt_discovery_entities.py", "asyncio", "integration", "tests", "marge", ""], "setup": {"duration": 0.0008137370459735394, "outcome": "passed"}, "call": {"duration": 3.5178340622223914, "outcome": "passed"}, "teardown": {"duration": 0.0004798811860382557, "outcome": "passed"}}, {"nodeid": "tests/integration/test_mqtt_discovery_entities.py::test_discovery_climate", "lineno": 197, "outcome": "passed", "keywords": ["test_discovery_climate", "test_mqtt_discovery_entities.py", "asyncio", "integration", "tests", "marge", ""], "setup": {"duration": 0.0005577802658081055, "outcome": "passed"}, "call": {"duration": 2.0181222460232675, "outcome": "passed"}, "teardown": {"duration": 0.00046653207391500473, "outcome": "passed"}}, {"nodeid": "tests/integration/test_mqtt_discovery_entities.py::test_discovery_cover", "lineno": 219, "outcome": "passed", "keywords": ["test_discovery_cover", "test_mqtt_discovery_entities.py", "asyncio", "integration", "tests", "marge", ""], "setup": {"duration": 0.0005216351710259914, "outcome": "passed"}, "call": {"duration": 2.0264959083870053, "outcome": "passed"}, "teardown": {"duration": 0.0005852356553077698, "outcome": "passed"}}, {"nodeid": "tests/integration/test_mqtt_discovery_entities.py::test_discovery_with_availability", "lineno": 240, "outcome": "passed", "keywords": ["test_discovery_with_availability", "test_mqtt_discovery_entities.py", "asyncio", "integration", "tests", "marge", ""], "setup": {"duration": 0.000656450167298317, "outcome": "passed"}, "call": {"duration": 2.004233410116285, "outcome": "passed"}, "teardown": {"duration": 0.0005903849378228188, "outcome": "passed"}}, {"nodeid": "tests/integration/test_mqtt_discovery_entities.py::test_discovery_four_level_topic", "lineno": 255, "outcome": "passed", "keywords": ["test_discovery_four_level_topic", "test_mqtt_discovery_entities.py", "asyncio", "integration", "tests", "marge", ""], "setup": {"duration": 0.0007532872259616852, "outcome": "passed"}, "call": {"duration": 2.00490549672395, "outcome": "passed"}, "teardown": {"duration": 0.0013130749575793743, "outcome": "passed"}}, {"nodeid": "tests/integration/test_service_history_flow.py::test_service_state_in_history", "lineno": 17, "outcome": "failed", "keywords": ["test_service_state_in_history", "test_service_history_flow.py", "asyncio", "integration", "tests", "marge", ""], "setup": {"duration": 0.02238280512392521, "outcome": "passed"}, "call": {"duration": 0.6085671735927463, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/light/turn_on'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/integration/test_service_history_flow.py", "lineno": 25, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b22428b0>\n\n    async def test_service_state_in_history(rest):\n        \"\"\"Service call state change appears in history.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"light.shf_{tag}\"\n        await rest.set_state(eid, \"off\")\n        await asyncio.sleep(_FLUSH)\n    \n>       await rest.call_service(\"light\", \"turn_on\", {\"entity_id\": eid})\n\ntests/integration/test_service_history_flow.py:25: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/light/turn_on'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0007634595967829227, "outcome": "passed"}}, {"nodeid": "tests/integration/test_service_history_flow.py::test_multiple_service_calls_in_history", "lineno": 38, "outcome": "failed", "keywords": ["test_multiple_service_calls_in_history", "test_service_history_flow.py", "asyncio", "integration", "tests", "marge", ""], "setup": {"duration": 0.005689886398613453, "outcome": "passed"}, "call": {"duration": 0.608004157897085, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/switch/turn_on'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/integration/test_service_history_flow.py", "lineno": 46, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b2272160>\n\n    async def test_multiple_service_calls_in_history(rest):\n        \"\"\"Multiple service calls produce multiple history entries.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"switch.shf_multi_{tag}\"\n        await rest.set_state(eid, \"off\")\n        await asyncio.sleep(_FLUSH)\n    \n>       await rest.call_service(\"switch\", \"turn_on\", {\"entity_id\": eid})\n\ntests/integration/test_service_history_flow.py:46: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/switch/turn_on'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.0007206141017377377, "outcome": "passed"}}, {"nodeid": "tests/integration/test_service_history_flow.py::test_history_entry_has_required_fields", "lineno": 61, "outcome": "failed", "keywords": ["test_history_entry_has_required_fields", "test_service_history_flow.py", "asyncio", "integration", "tests", "marge", ""], "setup": {"duration": 0.005633767228573561, "outcome": "passed"}, "call": {"duration": 0.6061746845953166, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)"}, "traceback": [{"path": "tests/integration/test_service_history_flow.py", "lineno": 74, "message": ""}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 832, "message": "in json"}, {"path": "../../anaconda3/lib/python3.9/json/__init__.py", "lineno": 346, "message": "in loads"}, {"path": "../../anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "JSONDecodeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b00a0cd0>\n\n    async def test_history_entry_has_required_fields(rest):\n        \"\"\"History entries have entity_id, state, last_changed, last_updated.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"sensor.shf_fields_{tag}\"\n        await rest.set_state(eid, \"val1\")\n        await asyncio.sleep(_FLUSH)\n    \n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/history/period/{eid}\",\n            params={\"start\": \"2020-01-01T00:00:00Z\", \"end\": \"2030-01-01T00:00:00Z\"},\n            headers=rest._headers(),\n        )\n>       data = resp.json()\n\ntests/integration/test_service_history_flow.py:74: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:832: in json\n    return jsonlib.loads(self.content, **kwargs)\n../../anaconda3/lib/python3.9/json/__init__.py:346: in loads\n    return _default_decoder.decode(s)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <json.decoder.JSONDecoder object at 0x7f47b2e5fe50>, s = '404: Not Found'\n_w = <built-in method match of re.Pattern object at 0x7f47b3015cf0>\n\n    def decode(self, s, _w=WHITESPACE.match):\n        \"\"\"Return the Python representation of ``s`` (a ``str`` instance\n        containing a JSON document).\n    \n        \"\"\"\n        obj, end = self.raw_decode(s, idx=_w(s, 0).end())\n        end = _w(s, end).end()\n        if end != len(s):\n>           raise JSONDecodeError(\"Extra data\", s, end)\nE           json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)\n\n../../anaconda3/lib/python3.9/json/decoder.py:340: JSONDecodeError"}, "teardown": {"duration": 0.001009517814964056, "outcome": "passed"}}, {"nodeid": "tests/integration/test_service_history_flow.py::test_history_attributes_preserved", "lineno": 81, "outcome": "failed", "keywords": ["test_history_attributes_preserved", "test_service_history_flow.py", "asyncio", "integration", "tests", "marge", ""], "setup": {"duration": 0.00845483411103487, "outcome": "passed"}, "call": {"duration": 0.60653694299981, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)"}, "traceback": [{"path": "tests/integration/test_service_history_flow.py", "lineno": 94, "message": ""}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 832, "message": "in json"}, {"path": "../../anaconda3/lib/python3.9/json/__init__.py", "lineno": 346, "message": "in loads"}, {"path": "../../anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "JSONDecodeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47ab6c0670>\n\n    async def test_history_attributes_preserved(rest):\n        \"\"\"History entries preserve attributes from state changes.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"sensor.shf_attrs_{tag}\"\n        await rest.set_state(eid, \"72\", {\"unit\": \"F\", \"friendly_name\": f\"Temp {tag}\"})\n        await asyncio.sleep(_FLUSH)\n    \n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/history/period/{eid}\",\n            params={\"start\": \"2020-01-01T00:00:00Z\", \"end\": \"2030-01-01T00:00:00Z\"},\n            headers=rest._headers(),\n        )\n>       data = resp.json()\n\ntests/integration/test_service_history_flow.py:94: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:832: in json\n    return jsonlib.loads(self.content, **kwargs)\n../../anaconda3/lib/python3.9/json/__init__.py:346: in loads\n    return _default_decoder.decode(s)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <json.decoder.JSONDecoder object at 0x7f47b2e5fe50>, s = '404: Not Found'\n_w = <built-in method match of re.Pattern object at 0x7f47b3015cf0>\n\n    def decode(self, s, _w=WHITESPACE.match):\n        \"\"\"Return the Python representation of ``s`` (a ``str`` instance\n        containing a JSON document).\n    \n        \"\"\"\n        obj, end = self.raw_decode(s, idx=_w(s, 0).end())\n        end = _w(s, end).end()\n        if end != len(s):\n>           raise JSONDecodeError(\"Extra data\", s, end)\nE           json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)\n\n../../anaconda3/lib/python3.9/json/decoder.py:340: JSONDecodeError"}, "teardown": {"duration": 0.0007060980424284935, "outcome": "passed"}}, {"nodeid": "tests/integration/test_service_history_flow.py::test_history_empty_for_nonexistent", "lineno": 104, "outcome": "failed", "keywords": ["test_history_empty_for_nonexistent", "test_service_history_flow.py", "asyncio", "integration", "tests", "marge", ""], "setup": {"duration": 0.006257970817387104, "outcome": "passed"}, "call": {"duration": 0.003073776140809059, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/integration/test_service_history_flow.py", "lineno": 112, "message": "assert 404 == 200\n +  where 404 = <Response [404 Not Found]>.status_code"}, "traceback": [{"path": "tests/integration/test_service_history_flow.py", "lineno": 112, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47ab79b400>\n\n    async def test_history_empty_for_nonexistent(rest):\n        \"\"\"History for nonexistent entity returns empty list.\"\"\"\n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/history/period/sensor.shf_nonexist_999\",\n            params={\"start\": \"2020-01-01T00:00:00Z\", \"end\": \"2030-01-01T00:00:00Z\"},\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 404 == 200\nE        +  where 404 = <Response [404 Not Found]>.status_code\n\ntests/integration/test_service_history_flow.py:112: AssertionError"}, "teardown": {"duration": 0.0006592962890863419, "outcome": "passed"}}, {"nodeid": "tests/integration/test_service_history_flow.py::test_statistics_after_numeric_states", "lineno": 117, "outcome": "failed", "keywords": ["test_statistics_after_numeric_states", "test_service_history_flow.py", "asyncio", "integration", "tests", "marge", ""], "setup": {"duration": 0.005257425829768181, "outcome": "passed"}, "call": {"duration": 0.8648288422264159, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/integration/test_service_history_flow.py", "lineno": 132, "message": "assert 404 == 200\n +  where 404 = <Response [404 Not Found]>.status_code"}, "traceback": [{"path": "tests/integration/test_service_history_flow.py", "lineno": 132, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47ab79ba60>\n\n    async def test_statistics_after_numeric_states(rest):\n        \"\"\"Statistics endpoint shows aggregates after numeric state writes.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"sensor.shf_stat_{tag}\"\n        for val in [\"10\", \"20\", \"30\", \"40\", \"50\"]:\n            await rest.set_state(eid, val)\n            await asyncio.sleep(0.05)\n        await asyncio.sleep(_FLUSH)\n    \n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/statistics/{eid}\",\n            params={\"start\": \"2020-01-01T00:00:00Z\", \"end\": \"2030-01-01T00:00:00Z\"},\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 404 == 200\nE        +  where 404 = <Response [404 Not Found]>.status_code\n\ntests/integration/test_service_history_flow.py:132: AssertionError"}, "teardown": {"duration": 0.0008083800785243511, "outcome": "passed"}}, {"nodeid": "tests/integration/test_service_history_flow.py::test_logbook_after_service_call", "lineno": 143, "outcome": "failed", "keywords": ["test_logbook_after_service_call", "test_service_history_flow.py", "asyncio", "integration", "tests", "marge", ""], "setup": {"duration": 0.008968570735305548, "outcome": "passed"}, "call": {"duration": 0.15612584305927157, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/light/turn_on'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"}, "traceback": [{"path": "tests/integration/test_service_history_flow.py", "lineno": 150, "message": ""}, {"path": "tests/conftest.py", "lineno": 104, "message": "in call_service"}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 829, "message": "HTTPStatusError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47ab3695b0>\n\n    async def test_logbook_after_service_call(rest):\n        \"\"\"Logbook captures entries from service-driven state changes.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"light.shf_logb_{tag}\"\n        await rest.set_state(eid, \"off\")\n        await asyncio.sleep(0.15)\n>       await rest.call_service(\"light\", \"turn_on\", {\"entity_id\": eid})\n\ntests/integration/test_service_history_flow.py:150: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/conftest.py:104: in call_service\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400 Bad Request]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '400 Bad Request' for url 'http://localhost:8123/api/services/light/turn_on'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400\n\n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:829: HTTPStatusError"}, "teardown": {"duration": 0.000906812958419323, "outcome": "passed"}}, {"nodeid": "tests/integration/test_service_history_flow.py::test_history_ordered_chronologically", "lineno": 161, "outcome": "failed", "keywords": ["test_history_ordered_chronologically", "test_service_history_flow.py", "asyncio", "integration", "tests", "marge", ""], "setup": {"duration": 0.006045435089617968, "outcome": "passed"}, "call": {"duration": 0.8669708971865475, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)"}, "traceback": [{"path": "tests/integration/test_service_history_flow.py", "lineno": 176, "message": ""}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 832, "message": "in json"}, {"path": "../../anaconda3/lib/python3.9/json/__init__.py", "lineno": 346, "message": "in loads"}, {"path": "../../anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "JSONDecodeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47ab72d190>\n\n    async def test_history_ordered_chronologically(rest):\n        \"\"\"History entries are ordered by time.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"sensor.shf_order_{tag}\"\n        for i in range(5):\n            await rest.set_state(eid, str(i))\n            await asyncio.sleep(0.05)\n        await asyncio.sleep(_FLUSH)\n    \n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/history/period/{eid}\",\n            params={\"start\": \"2020-01-01T00:00:00Z\", \"end\": \"2030-01-01T00:00:00Z\"},\n            headers=rest._headers(),\n        )\n>       data = resp.json()\n\ntests/integration/test_service_history_flow.py:176: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:832: in json\n    return jsonlib.loads(self.content, **kwargs)\n../../anaconda3/lib/python3.9/json/__init__.py:346: in loads\n    return _default_decoder.decode(s)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <json.decoder.JSONDecoder object at 0x7f47b2e5fe50>, s = '404: Not Found'\n_w = <built-in method match of re.Pattern object at 0x7f47b3015cf0>\n\n    def decode(self, s, _w=WHITESPACE.match):\n        \"\"\"Return the Python representation of ``s`` (a ``str`` instance\n        containing a JSON document).\n    \n        \"\"\"\n        obj, end = self.raw_decode(s, idx=_w(s, 0).end())\n        end = _w(s, end).end()\n        if end != len(s):\n>           raise JSONDecodeError(\"Extra data\", s, end)\nE           json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)\n\n../../anaconda3/lib/python3.9/json/decoder.py:340: JSONDecodeError"}, "teardown": {"duration": 0.0008607651107013226, "outcome": "passed"}}, {"nodeid": "tests/integration/test_service_history_flow.py::test_delete_entity_history_persists", "lineno": 181, "outcome": "failed", "keywords": ["test_delete_entity_history_persists", "test_service_history_flow.py", "asyncio", "integration", "tests", "marge", ""], "setup": {"duration": 0.007843805011361837, "outcome": "passed"}, "call": {"duration": 0.6083070328459144, "outcome": "failed", "crash": {"path": "/home/jcrigby/anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)"}, "traceback": [{"path": "tests/integration/test_service_history_flow.py", "lineno": 202, "message": ""}, {"path": "../../anaconda3/lib/python3.9/site-packages/httpx/_models.py", "lineno": 832, "message": "in json"}, {"path": "../../anaconda3/lib/python3.9/json/__init__.py", "lineno": 346, "message": "in loads"}, {"path": "../../anaconda3/lib/python3.9/json/decoder.py", "lineno": 340, "message": "JSONDecodeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b036a160>\n\n    async def test_delete_entity_history_persists(rest):\n        \"\"\"Deleting entity does not remove its history entries.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"sensor.shf_del_{tag}\"\n        await rest.set_state(eid, \"before_delete\")\n        await asyncio.sleep(_FLUSH)\n    \n        # Delete the entity\n        resp = await rest.client.delete(\n            f\"{rest.base_url}/api/states/{eid}\",\n            headers=rest._headers(),\n        )\n        assert resp.status_code == 200\n    \n        # History should still have entries\n        resp = await rest.client.get(\n            f\"{rest.base_url}/api/history/period/{eid}\",\n            params={\"start\": \"2020-01-01T00:00:00Z\", \"end\": \"2030-01-01T00:00:00Z\"},\n            headers=rest._headers(),\n        )\n>       data = resp.json()\n\ntests/integration/test_service_history_flow.py:202: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../anaconda3/lib/python3.9/site-packages/httpx/_models.py:832: in json\n    return jsonlib.loads(self.content, **kwargs)\n../../anaconda3/lib/python3.9/json/__init__.py:346: in loads\n    return _default_decoder.decode(s)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <json.decoder.JSONDecoder object at 0x7f47b2e5fe50>, s = '404: Not Found'\n_w = <built-in method match of re.Pattern object at 0x7f47b3015cf0>\n\n    def decode(self, s, _w=WHITESPACE.match):\n        \"\"\"Return the Python representation of ``s`` (a ``str`` instance\n        containing a JSON document).\n    \n        \"\"\"\n        obj, end = self.raw_decode(s, idx=_w(s, 0).end())\n        end = _w(s, end).end()\n        if end != len(s):\n>           raise JSONDecodeError(\"Extra data\", s, end)\nE           json.decoder.JSONDecodeError: Extra data: line 1 column 4 (char 3)\n\n../../anaconda3/lib/python3.9/json/decoder.py:340: JSONDecodeError"}, "teardown": {"duration": 0.0006745490245521069, "outcome": "passed"}}, {"nodeid": "tests/integration/test_tasmota_bridge.py::test_tasmota_lwt_online", "lineno": 41, "outcome": "skipped", "keywords": ["test_tasmota_lwt_online", "test_tasmota_bridge.py", "asyncio", "marge_only", "integration", "tests", "marge", ""], "setup": {"duration": 0.00023748213425278664, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/integration/test_tasmota_bridge.py', 42, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.0001277080737054348, "outcome": "passed"}}, {"nodeid": "tests/integration/test_tasmota_bridge.py::test_tasmota_power_on", "lineno": 54, "outcome": "skipped", "keywords": ["test_tasmota_power_on", "test_tasmota_bridge.py", "asyncio", "marge_only", "integration", "tests", "marge", ""], "setup": {"duration": 0.00019438285380601883, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/integration/test_tasmota_bridge.py', 55, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00012814998626708984, "outcome": "passed"}}, {"nodeid": "tests/integration/test_tasmota_bridge.py::test_tasmota_power_off", "lineno": 71, "outcome": "skipped", "keywords": ["test_tasmota_power_off", "test_tasmota_bridge.py", "asyncio", "marge_only", "integration", "tests", "marge", ""], "setup": {"duration": 0.0002056388184428215, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/integration/test_tasmota_bridge.py', 72, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.0001300252042710781, "outcome": "passed"}}, {"nodeid": "tests/integration/test_tasmota_bridge.py::test_tasmota_tele_state", "lineno": 86, "outcome": "skipped", "keywords": ["test_tasmota_tele_state", "test_tasmota_bridge.py", "asyncio", "marge_only", "integration", "tests", "marge", ""], "setup": {"duration": 0.00019505200907588005, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/integration/test_tasmota_bridge.py', 87, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00026885373517870903, "outcome": "passed"}}, {"nodeid": "tests/integration/test_tasmota_bridge.py::test_tasmota_tele_sensor", "lineno": 99, "outcome": "skipped", "keywords": ["test_tasmota_tele_sensor", "test_tasmota_bridge.py", "asyncio", "marge_only", "integration", "tests", "marge", ""], "setup": {"duration": 0.00019324105232954025, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/integration/test_tasmota_bridge.py', 100, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00012541934847831726, "outcome": "passed"}}, {"nodeid": "tests/integration/test_tasmota_bridge.py::test_tasmota_lwt_offline", "lineno": 114, "outcome": "skipped", "keywords": ["test_tasmota_lwt_offline", "test_tasmota_bridge.py", "asyncio", "marge_only", "integration", "tests", "marge", ""], "setup": {"duration": 0.00019203126430511475, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/integration/test_tasmota_bridge.py', 115, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00012509291991591454, "outcome": "passed"}}, {"nodeid": "tests/integration/test_tasmota_bridge.py::test_tasmota_multi_relay", "lineno": 127, "outcome": "skipped", "keywords": ["test_tasmota_multi_relay", "test_tasmota_bridge.py", "asyncio", "marge_only", "integration", "tests", "marge", ""], "setup": {"duration": 0.00018928991630673409, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/integration/test_tasmota_bridge.py', 128, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00012792693451046944, "outcome": "passed"}}, {"nodeid": "tests/integration/test_webhook_event_integration.py::test_webhook_sets_entity_state", "lineno": 20, "outcome": "failed", "keywords": ["test_webhook_sets_entity_state", "test_webhook_event_integration.py", "asyncio", "integration", "tests", "marge", ""], "setup": {"duration": 0.005828164052218199, "outcome": "passed"}, "call": {"duration": 0.0033187116496264935, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/integration/test_webhook_event_integration.py", "lineno": 30, "message": "assert 404 == 200\n +  where 404 = <Response [404 Not Found]>.status_code"}, "traceback": [{"path": "tests/integration/test_webhook_event_integration.py", "lineno": 30, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0475340>\n\n    async def test_webhook_sets_entity_state(rest):\n        \"\"\"Webhook with entity_id + state sets entity state.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"sensor.webhook_{tag}\"\n        resp = await rest.client.post(\n            f\"{rest.base_url}/api/webhook/test_hook_{tag}\",\n            json={\"entity_id\": eid, \"state\": \"42\"},\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 404 == 200\nE        +  where 404 = <Response [404 Not Found]>.status_code\n\ntests/integration/test_webhook_event_integration.py:30: AssertionError"}, "teardown": {"duration": 0.0006593568250536919, "outcome": "passed"}}, {"nodeid": "tests/integration/test_webhook_event_integration.py::test_webhook_sets_state_with_attributes", "lineno": 38, "outcome": "failed", "keywords": ["test_webhook_sets_state_with_attributes", "test_webhook_event_integration.py", "asyncio", "integration", "tests", "marge", ""], "setup": {"duration": 0.005645152181386948, "outcome": "passed"}, "call": {"duration": 0.0027818288654088974, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/integration/test_webhook_event_integration.py", "lineno": 52, "message": "assert 404 == 200\n +  where 404 = <Response [404 Not Found]>.status_code"}, "traceback": [{"path": "tests/integration/test_webhook_event_integration.py", "lineno": 52, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b0475fa0>\n\n    async def test_webhook_sets_state_with_attributes(rest):\n        \"\"\"Webhook with attributes sets entity attributes.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"sensor.webhook_attr_{tag}\"\n        resp = await rest.client.post(\n            f\"{rest.base_url}/api/webhook/attr_hook_{tag}\",\n            json={\n                \"entity_id\": eid,\n                \"state\": \"23.5\",\n                \"attributes\": {\"unit_of_measurement\": \"C\", \"friendly_name\": \"Webhook Temp\"},\n            },\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 404 == 200\nE        +  where 404 = <Response [404 Not Found]>.status_code\n\ntests/integration/test_webhook_event_integration.py:52: AssertionError"}, "teardown": {"duration": 0.0007995450869202614, "outcome": "passed"}}, {"nodeid": "tests/integration/test_webhook_event_integration.py::test_webhook_overwrites_existing_state", "lineno": 59, "outcome": "failed", "keywords": ["test_webhook_overwrites_existing_state", "test_webhook_event_integration.py", "asyncio", "integration", "tests", "marge", ""], "setup": {"duration": 0.009764405433088541, "outcome": "passed"}, "call": {"duration": 0.005636292044073343, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/integration/test_webhook_event_integration.py", "lineno": 71, "message": "assert 404 == 200\n +  where 404 = <Response [404 Not Found]>.status_code"}, "traceback": [{"path": "tests/integration/test_webhook_event_integration.py", "lineno": 71, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47ab57b550>\n\n    async def test_webhook_overwrites_existing_state(rest):\n        \"\"\"Webhook updates an already-existing entity.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"sensor.webhook_ow_{tag}\"\n        await rest.set_state(eid, \"old_value\")\n    \n        resp = await rest.client.post(\n            f\"{rest.base_url}/api/webhook/overwrite_{tag}\",\n            json={\"entity_id\": eid, \"state\": \"new_value\"},\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 404 == 200\nE        +  where 404 = <Response [404 Not Found]>.status_code\n\ntests/integration/test_webhook_event_integration.py:71: AssertionError"}, "teardown": {"duration": 0.0008722771890461445, "outcome": "passed"}}, {"nodeid": "tests/integration/test_webhook_event_integration.py::test_webhook_fires_event", "lineno": 78, "outcome": "failed", "keywords": ["test_webhook_fires_event", "test_webhook_event_integration.py", "asyncio", "integration", "tests", "marge", ""], "setup": {"duration": 0.007591045927256346, "outcome": "passed"}, "call": {"duration": 0.002958374097943306, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/integration/test_webhook_event_integration.py", "lineno": 87, "message": "assert 404 == 200\n +  where 404 = <Response [404 Not Found]>.status_code"}, "traceback": [{"path": "tests/integration/test_webhook_event_integration.py", "lineno": 87, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47ab479730>\n\n    async def test_webhook_fires_event(rest):\n        \"\"\"Webhook with event_type fires an event.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        resp = await rest.client.post(\n            f\"{rest.base_url}/api/webhook/event_hook_{tag}\",\n            json={\"event_type\": f\"test_webhook_event_{tag}\"},\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 404 == 200\nE        +  where 404 = <Response [404 Not Found]>.status_code\n\ntests/integration/test_webhook_event_integration.py:87: AssertionError"}, "teardown": {"duration": 0.0006645279936492443, "outcome": "passed"}}, {"nodeid": "tests/integration/test_webhook_event_integration.py::test_webhook_default_fires_webhook_event", "lineno": 91, "outcome": "failed", "keywords": ["test_webhook_default_fires_webhook_event", "test_webhook_event_integration.py", "asyncio", "integration", "tests", "marge", ""], "setup": {"duration": 0.005180200096219778, "outcome": "passed"}, "call": {"duration": 0.00298873009160161, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/integration/test_webhook_event_integration.py", "lineno": 100, "message": "assert 404 == 200\n +  where 404 = <Response [404 Not Found]>.status_code"}, "traceback": [{"path": "tests/integration/test_webhook_event_integration.py", "lineno": 100, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47ab4790d0>\n\n    async def test_webhook_default_fires_webhook_event(rest):\n        \"\"\"Webhook with no entity_id or event_type fires webhook.<id> event.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        resp = await rest.client.post(\n            f\"{rest.base_url}/api/webhook/default_{tag}\",\n            json={\"some_data\": \"value\"},\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 404 == 200\nE        +  where 404 = <Response [404 Not Found]>.status_code\n\ntests/integration/test_webhook_event_integration.py:100: AssertionError"}, "teardown": {"duration": 0.0005582170560956001, "outcome": "passed"}}, {"nodeid": "tests/integration/test_webhook_event_integration.py::test_webhook_empty_body", "lineno": 105, "outcome": "failed", "keywords": ["test_webhook_empty_body", "test_webhook_event_integration.py", "asyncio", "integration", "tests", "marge", ""], "setup": {"duration": 0.00560521986335516, "outcome": "passed"}, "call": {"duration": 0.0031276619993150234, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/integration/test_webhook_event_integration.py", "lineno": 114, "message": "assert 404 == 200\n +  where 404 = <Response [404 Not Found]>.status_code"}, "traceback": [{"path": "tests/integration/test_webhook_event_integration.py", "lineno": 114, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47ab66a7f0>\n\n    async def test_webhook_empty_body(rest):\n        \"\"\"Webhook with empty/no body fires default event.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        resp = await rest.client.post(\n            f\"{rest.base_url}/api/webhook/empty_{tag}\",\n            json={},\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 404 == 200\nE        +  where 404 = <Response [404 Not Found]>.status_code\n\ntests/integration/test_webhook_event_integration.py:114: AssertionError"}, "teardown": {"duration": 0.0006611519493162632, "outcome": "passed"}}, {"nodeid": "tests/integration/test_webhook_event_integration.py::test_webhook_event_triggers_automation", "lineno": 120, "outcome": "failed", "keywords": ["test_webhook_event_triggers_automation", "test_webhook_event_integration.py", "asyncio", "integration", "tests", "marge", ""], "setup": {"duration": 0.005866424646228552, "outcome": "passed"}, "call": {"duration": 0.10958819603547454, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/integration/test_webhook_event_integration.py", "lineno": 140, "message": "assert 404 == 200\n +  where 404 = <Response [404 Not Found]>.status_code"}, "traceback": [{"path": "tests/integration/test_webhook_event_integration.py", "lineno": 140, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47ab66a100>\n\n    async def test_webhook_event_triggers_automation(rest):\n        \"\"\"Webhook firing bedside_button_pressed triggers goodnight.\"\"\"\n        # Set up lights on so we can verify goodnight turns them off\n        await rest.set_state(\"light.bedroom\", \"on\")\n        await rest.set_state(\"lock.front_door\", \"unlocked\")\n        await rest.call_service(\"automation\", \"turn_on\", {\n            \"entity_id\": \"automation.goodnight_routine\"\n        })\n        await asyncio.sleep(0.1)\n    \n        s1 = await rest.get_state(\"automation.goodnight_routine\")\n        count_before = s1[\"attributes\"].get(\"current\", 0)\n    \n        # Fire event via webhook\n        resp = await rest.client.post(\n            f\"{rest.base_url}/api/webhook/bedside\",\n            json={\"event_type\": \"bedside_button_pressed\"},\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 404 == 200\nE        +  where 404 = <Response [404 Not Found]>.status_code\n\ntests/integration/test_webhook_event_integration.py:140: AssertionError"}, "teardown": {"duration": 0.0006789015606045723, "outcome": "passed"}}, {"nodeid": "tests/integration/test_webhook_event_integration.py::test_webhook_state_set_triggers_automation", "lineno": 146, "outcome": "failed", "keywords": ["test_webhook_state_set_triggers_automation", "test_webhook_event_integration.py", "asyncio", "integration", "tests", "marge", ""], "setup": {"duration": 0.005254459101706743, "outcome": "passed"}, "call": {"duration": 0.10817223321646452, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/integration/test_webhook_event_integration.py", "lineno": 163, "message": "assert 404 == 200\n +  where 404 = <Response [404 Not Found]>.status_code"}, "traceback": [{"path": "tests/integration/test_webhook_event_integration.py", "lineno": 163, "message": "AssertionError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b035e8e0>\n\n    async def test_webhook_state_set_triggers_automation(rest):\n        \"\"\"Webhook setting smoke_detector to on triggers emergency automation.\"\"\"\n        # Set up baseline\n        await rest.set_state(\"binary_sensor.smoke_detector\", \"off\")\n        await rest.set_state(\"lock.front_door\", \"locked\")\n        await rest.call_service(\"automation\", \"turn_on\", {\n            \"entity_id\": \"automation.smoke_co_emergency\"\n        })\n        await asyncio.sleep(0.1)\n    \n        # Set state via webhook\n        resp = await rest.client.post(\n            f\"{rest.base_url}/api/webhook/smoke_test\",\n            json={\"entity_id\": \"binary_sensor.smoke_detector\", \"state\": \"on\"},\n            headers=rest._headers(),\n        )\n>       assert resp.status_code == 200\nE       assert 404 == 200\nE        +  where 404 = <Response [404 Not Found]>.status_code\n\ntests/integration/test_webhook_event_integration.py:163: AssertionError"}, "teardown": {"duration": 0.0006668479181826115, "outcome": "passed"}}, {"nodeid": "tests/integration/test_webhook_event_integration.py::test_rapid_webhook_state_updates", "lineno": 172, "outcome": "failed", "keywords": ["test_rapid_webhook_state_updates", "test_webhook_event_integration.py", "asyncio", "integration", "tests", "marge", ""], "setup": {"duration": 0.005142238922417164, "outcome": "passed"}, "call": {"duration": 0.0157042290084064, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/integration/test_webhook_event_integration.py", "lineno": 184, "message": "TypeError: 'NoneType' object is not subscriptable"}, "traceback": [{"path": "tests/integration/test_webhook_event_integration.py", "lineno": 184, "message": "TypeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47b03b81f0>\n\n    async def test_rapid_webhook_state_updates(rest):\n        \"\"\"Multiple rapid webhook state updates, last one wins.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid = f\"sensor.webhook_rapid_{tag}\"\n        for i in range(10):\n            await rest.client.post(\n                f\"{rest.base_url}/api/webhook/rapid_{tag}\",\n                json={\"entity_id\": eid, \"state\": str(i)},\n                headers=rest._headers(),\n            )\n        state = await rest.get_state(eid)\n>       assert state[\"state\"] == \"9\"\nE       TypeError: 'NoneType' object is not subscriptable\n\ntests/integration/test_webhook_event_integration.py:184: TypeError"}, "teardown": {"duration": 0.0006485790945589542, "outcome": "passed"}}, {"nodeid": "tests/integration/test_webhook_event_integration.py::test_webhook_different_ids_independent", "lineno": 186, "outcome": "failed", "keywords": ["test_webhook_different_ids_independent", "test_webhook_event_integration.py", "asyncio", "integration", "tests", "marge", ""], "setup": {"duration": 0.005065422039479017, "outcome": "passed"}, "call": {"duration": 0.0060978545807302, "outcome": "failed", "crash": {"path": "/home/jcrigby/fun/marge/tests/integration/test_webhook_event_integration.py", "lineno": 206, "message": "TypeError: 'NoneType' object is not subscriptable"}, "traceback": [{"path": "tests/integration/test_webhook_event_integration.py", "lineno": 206, "message": "TypeError"}], "longrepr": "rest = <conftest.RESTClient object at 0x7f47ab5a5220>\n\n    async def test_webhook_different_ids_independent(rest):\n        \"\"\"Different webhook IDs are independent endpoints.\"\"\"\n        tag = uuid.uuid4().hex[:8]\n        eid1 = f\"sensor.wh_a_{tag}\"\n        eid2 = f\"sensor.wh_b_{tag}\"\n    \n        await rest.client.post(\n            f\"{rest.base_url}/api/webhook/hook_a_{tag}\",\n            json={\"entity_id\": eid1, \"state\": \"from_a\"},\n            headers=rest._headers(),\n        )\n        await rest.client.post(\n            f\"{rest.base_url}/api/webhook/hook_b_{tag}\",\n            json={\"entity_id\": eid2, \"state\": \"from_b\"},\n            headers=rest._headers(),\n        )\n    \n        s1 = await rest.get_state(eid1)\n        s2 = await rest.get_state(eid2)\n>       assert s1[\"state\"] == \"from_a\"\nE       TypeError: 'NoneType' object is not subscriptable\n\ntests/integration/test_webhook_event_integration.py:206: TypeError"}, "teardown": {"duration": 0.0006510168313980103, "outcome": "passed"}}, {"nodeid": "tests/integration/test_zigbee2mqtt_bridge.py::test_z2m_bridge_state_online", "lineno": 42, "outcome": "skipped", "keywords": ["test_z2m_bridge_state_online", "test_zigbee2mqtt_bridge.py", "asyncio", "marge_only", "integration", "tests", "marge", ""], "setup": {"duration": 0.00023859506472945213, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/integration/test_zigbee2mqtt_bridge.py', 43, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00012533040717244148, "outcome": "passed"}}, {"nodeid": "tests/integration/test_zigbee2mqtt_bridge.py::test_z2m_bridge_state_offline", "lineno": 52, "outcome": "skipped", "keywords": ["test_z2m_bridge_state_offline", "test_zigbee2mqtt_bridge.py", "asyncio", "marge_only", "integration", "tests", "marge", ""], "setup": {"duration": 0.00018603913486003876, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/integration/test_zigbee2mqtt_bridge.py', 53, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00012202514335513115, "outcome": "passed"}}, {"nodeid": "tests/integration/test_zigbee2mqtt_bridge.py::test_z2m_device_state_update", "lineno": 61, "outcome": "skipped", "keywords": ["test_z2m_device_state_update", "test_zigbee2mqtt_bridge.py", "asyncio", "marge_only", "integration", "tests", "marge", ""], "setup": {"duration": 0.00018540490418672562, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/integration/test_zigbee2mqtt_bridge.py', 62, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00012467196211218834, "outcome": "passed"}}, {"nodeid": "tests/integration/test_zigbee2mqtt_bridge.py::test_z2m_bridge_devices_message", "lineno": 78, "outcome": "skipped", "keywords": ["test_z2m_bridge_devices_message", "test_zigbee2mqtt_bridge.py", "asyncio", "marge_only", "integration", "tests", "marge", ""], "setup": {"duration": 0.00018807081505656242, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/integration/test_zigbee2mqtt_bridge.py', 79, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.0001264140009880066, "outcome": "passed"}}, {"nodeid": "tests/integration/test_zigbee2mqtt_bridge.py::test_z2m_device_availability", "lineno": 107, "outcome": "skipped", "keywords": ["test_z2m_device_availability", "test_zigbee2mqtt_bridge.py", "asyncio", "marge_only", "integration", "tests", "marge", ""], "setup": {"duration": 0.00018625101074576378, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/integration/test_zigbee2mqtt_bridge.py', 108, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00012481212615966797, "outcome": "passed"}}, {"nodeid": "tests/integration/test_zigbee2mqtt_bridge.py::test_z2m_bridge_groups", "lineno": 116, "outcome": "skipped", "keywords": ["test_z2m_bridge_groups", "test_zigbee2mqtt_bridge.py", "asyncio", "marge_only", "integration", "tests", "marge", ""], "setup": {"duration": 0.00018533924594521523, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/integration/test_zigbee2mqtt_bridge.py', 117, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00012214714661240578, "outcome": "passed"}}, {"nodeid": "tests/integration/test_zigbee2mqtt_bridge.py::test_z2m_device_set_command", "lineno": 132, "outcome": "skipped", "keywords": ["test_z2m_device_set_command", "test_zigbee2mqtt_bridge.py", "asyncio", "marge_only", "integration", "tests", "marge", ""], "setup": {"duration": 0.00018400466069579124, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/integration/test_zigbee2mqtt_bridge.py', 133, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.0001254510134458542, "outcome": "passed"}}, {"nodeid": "tests/performance/test_health_metric_accuracy.py::test_state_changes_increments_on_set", "lineno": 15, "outcome": "skipped", "keywords": ["test_state_changes_increments_on_set", "test_health_metric_accuracy.py", "asyncio", "marge_only", "performance", "tests", "marge", ""], "setup": {"duration": 0.0003267931751906872, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/performance/test_health_metric_accuracy.py', 16, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.0001227199099957943, "outcome": "passed"}}, {"nodeid": "tests/performance/test_health_metric_accuracy.py::test_entity_count_increases_on_create", "lineno": 34, "outcome": "skipped", "keywords": ["test_entity_count_increases_on_create", "test_health_metric_accuracy.py", "asyncio", "marge_only", "performance", "tests", "marge", ""], "setup": {"duration": 0.0001902780495584011, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/performance/test_health_metric_accuracy.py', 35, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.0001232130452990532, "outcome": "passed"}}, {"nodeid": "tests/performance/test_health_metric_accuracy.py::test_uptime_increases", "lineno": 53, "outcome": "skipped", "keywords": ["test_uptime_increases", "test_health_metric_accuracy.py", "asyncio", "marge_only", "performance", "tests", "marge", ""], "setup": {"duration": 0.0001898137852549553, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/performance/test_health_metric_accuracy.py', 54, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00012502819299697876, "outcome": "passed"}}, {"nodeid": "tests/performance/test_health_metric_accuracy.py::test_health_has_status_ok", "lineno": 71, "outcome": "skipped", "keywords": ["test_health_has_status_ok", "test_health_metric_accuracy.py", "asyncio", "marge_only", "performance", "tests", "marge", ""], "setup": {"duration": 0.00022449111565947533, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/performance/test_health_metric_accuracy.py', 72, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00012247683480381966, "outcome": "passed"}}, {"nodeid": "tests/performance/test_health_metric_accuracy.py::test_health_has_version", "lineno": 80, "outcome": "skipped", "keywords": ["test_health_has_version", "test_health_metric_accuracy.py", "asyncio", "marge_only", "performance", "tests", "marge", ""], "setup": {"duration": 0.00018586032092571259, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/performance/test_health_metric_accuracy.py', 81, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00012176530435681343, "outcome": "passed"}}, {"nodeid": "tests/performance/test_health_metric_accuracy.py::test_health_has_startup_us", "lineno": 91, "outcome": "skipped", "keywords": ["test_health_has_startup_us", "test_health_metric_accuracy.py", "asyncio", "marge_only", "performance", "tests", "marge", ""], "setup": {"duration": 0.00018756696954369545, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/performance/test_health_metric_accuracy.py', 92, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.0001234053634107113, "outcome": "passed"}}, {"nodeid": "tests/performance/test_health_metric_accuracy.py::test_health_has_startup_ms", "lineno": 102, "outcome": "skipped", "keywords": ["test_health_has_startup_ms", "test_health_metric_accuracy.py", "asyncio", "marge_only", "performance", "tests", "marge", ""], "setup": {"duration": 0.000189133919775486, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/performance/test_health_metric_accuracy.py', 103, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.0001227622851729393, "outcome": "passed"}}, {"nodeid": "tests/performance/test_health_metric_accuracy.py::test_health_has_latency_metrics", "lineno": 113, "outcome": "skipped", "keywords": ["test_health_has_latency_metrics", "test_health_metric_accuracy.py", "asyncio", "marge_only", "performance", "tests", "marge", ""], "setup": {"duration": 0.00018910784274339676, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/performance/test_health_metric_accuracy.py', 114, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00012354087084531784, "outcome": "passed"}}, {"nodeid": "tests/performance/test_health_metric_accuracy.py::test_health_has_ws_connections", "lineno": 126, "outcome": "skipped", "keywords": ["test_health_has_ws_connections", "test_health_metric_accuracy.py", "asyncio", "marge_only", "performance", "tests", "marge", ""], "setup": {"duration": 0.00018769409507513046, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/performance/test_health_metric_accuracy.py', 127, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00016295909881591797, "outcome": "passed"}}, {"nodeid": "tests/performance/test_health_metric_accuracy.py::test_health_has_memory_metrics", "lineno": 137, "outcome": "skipped", "keywords": ["test_health_has_memory_metrics", "test_health_metric_accuracy.py", "asyncio", "marge_only", "performance", "tests", "marge", ""], "setup": {"duration": 0.000187641941010952, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/performance/test_health_metric_accuracy.py', 138, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.0001226537860929966, "outcome": "passed"}}, {"nodeid": "tests/performance/test_health_metric_accuracy.py::test_health_rss_mb_matches_kb", "lineno": 149, "outcome": "skipped", "keywords": ["test_health_rss_mb_matches_kb", "test_health_metric_accuracy.py", "asyncio", "marge_only", "performance", "tests", "marge", ""], "setup": {"duration": 0.00018745800480246544, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/performance/test_health_metric_accuracy.py', 150, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00012176297605037689, "outcome": "passed"}}, {"nodeid": "tests/performance/test_health_metric_accuracy.py::test_health_events_fired_nonnegative", "lineno": 160, "outcome": "skipped", "keywords": ["test_health_events_fired_nonnegative", "test_health_metric_accuracy.py", "asyncio", "marge_only", "performance", "tests", "marge", ""], "setup": {"duration": 0.000188400037586689, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/performance/test_health_metric_accuracy.py', 161, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00012332294136285782, "outcome": "passed"}}, {"nodeid": "tests/performance/test_health_metric_accuracy.py::test_health_sim_fields_present", "lineno": 171, "outcome": "skipped", "keywords": ["test_health_sim_fields_present", "test_health_metric_accuracy.py", "asyncio", "marge_only", "performance", "tests", "marge", ""], "setup": {"duration": 0.00018945802003145218, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/performance/test_health_metric_accuracy.py', 172, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00012506823986768723, "outcome": "passed"}}, {"nodeid": "tests/performance/test_latency_throughput.py::test_state_set_latency", "lineno": 20, "outcome": "passed", "keywords": ["test_state_set_latency", "test_latency_throughput.py", "asyncio", "performance", "tests", "marge", ""], "setup": {"duration": 0.0003775511868298054, "outcome": "passed"}, "call": {"duration": 0.007518390193581581, "outcome": "passed"}, "teardown": {"duration": 0.0002887668088078499, "outcome": "passed"}}, {"nodeid": "tests/performance/test_latency_throughput.py::test_state_get_latency", "lineno": 35, "outcome": "passed", "keywords": ["test_state_get_latency", "test_latency_throughput.py", "asyncio", "performance", "tests", "marge", ""], "setup": {"duration": 0.00039536505937576294, "outcome": "passed"}, "call": {"duration": 0.0076213739812374115, "outcome": "passed"}, "teardown": {"duration": 0.0002837306819856167, "outcome": "passed"}}, {"nodeid": "tests/performance/test_latency_throughput.py::test_sequential_state_throughput", "lineno": 54, "outcome": "passed", "keywords": ["test_sequential_state_throughput", "test_latency_throughput.py", "asyncio", "performance", "tests", "marge", ""], "setup": {"duration": 0.00035285577178001404, "outcome": "passed"}, "call": {"duration": 0.10401670029386878, "outcome": "passed"}, "teardown": {"duration": 0.00042368099093437195, "outcome": "passed"}}, {"nodeid": "tests/performance/test_latency_throughput.py::test_concurrent_state_throughput", "lineno": 70, "outcome": "passed", "keywords": ["test_concurrent_state_throughput", "test_latency_throughput.py", "asyncio", "performance", "tests", "marge", ""], "setup": {"duration": 0.0004946538247168064, "outcome": "passed"}, "call": {"duration": 0.07548891194164753, "outcome": "passed"}, "teardown": {"duration": 0.0004987968131899834, "outcome": "passed"}}, {"nodeid": "tests/performance/test_latency_throughput.py::test_service_call_latency", "lineno": 92, "outcome": "passed", "keywords": ["test_service_call_latency", "test_latency_throughput.py", "asyncio", "performance", "tests", "marge", ""], "setup": {"duration": 0.0004949197173118591, "outcome": "passed"}, "call": {"duration": 0.008222388103604317, "outcome": "passed"}, "teardown": {"duration": 0.0003449711948633194, "outcome": "passed"}}, {"nodeid": "tests/performance/test_latency_throughput.py::test_health_endpoint_latency", "lineno": 112, "outcome": "passed", "keywords": ["test_health_endpoint_latency", "test_latency_throughput.py", "asyncio", "performance", "tests", "marge", ""], "setup": {"duration": 0.0004140818491578102, "outcome": "passed"}, "call": {"duration": 0.007227208930999041, "outcome": "passed"}, "teardown": {"duration": 0.00032937899231910706, "outcome": "passed"}}, {"nodeid": "tests/performance/test_latency_throughput.py::test_config_endpoint_latency", "lineno": 122, "outcome": "passed", "keywords": ["test_config_endpoint_latency", "test_latency_throughput.py", "asyncio", "performance", "tests", "marge", ""], "setup": {"duration": 0.0003867419436573982, "outcome": "passed"}, "call": {"duration": 0.0071867392398417, "outcome": "passed"}, "teardown": {"duration": 0.0003263717517256737, "outcome": "passed"}}, {"nodeid": "tests/performance/test_latency_throughput.py::test_search_latency", "lineno": 132, "outcome": "passed", "keywords": ["test_search_latency", "test_latency_throughput.py", "asyncio", "performance", "tests", "marge", ""], "setup": {"duration": 0.00038660410791635513, "outcome": "passed"}, "call": {"duration": 0.011558663100004196, "outcome": "passed"}, "teardown": {"duration": 0.00042353570461273193, "outcome": "passed"}}, {"nodeid": "tests/performance/test_latency_throughput.py::test_template_render_latency", "lineno": 146, "outcome": "passed", "keywords": ["test_template_render_latency", "test_latency_throughput.py", "asyncio", "performance", "tests", "marge", ""], "setup": {"duration": 0.00044603412970900536, "outcome": "passed"}, "call": {"duration": 0.007675852160900831, "outcome": "passed"}, "teardown": {"duration": 0.00035150907933712006, "outcome": "passed"}}, {"nodeid": "tests/performance/test_throughput.py::test_state_set_throughput", "lineno": 19, "outcome": "passed", "keywords": ["test_state_set_throughput", "test_throughput.py", "asyncio", "performance", "tests", "marge", ""], "setup": {"duration": 0.0004027080722153187, "outcome": "passed"}, "call": {"duration": 0.1154126450419426, "outcome": "passed", "stdout": "\n  100 state sets: 0.12s (869/sec)\n"}, "teardown": {"duration": 0.0003494960255920887, "outcome": "passed"}}, {"nodeid": "tests/performance/test_throughput.py::test_state_get_throughput", "lineno": 35, "outcome": "passed", "keywords": ["test_state_get_throughput", "test_throughput.py", "asyncio", "performance", "tests", "marge", ""], "setup": {"duration": 0.0003852788358926773, "outcome": "passed"}, "call": {"duration": 0.2078692722134292, "outcome": "passed", "stdout": "\n  100 state gets: 0.10s (1015/sec)\n"}, "teardown": {"duration": 0.0003405907191336155, "outcome": "passed"}}, {"nodeid": "tests/performance/test_throughput.py::test_concurrent_state_sets", "lineno": 58, "outcome": "passed", "keywords": ["test_concurrent_state_sets", "test_throughput.py", "asyncio", "performance", "tests", "marge", ""], "setup": {"duration": 0.000388098880648613, "outcome": "passed"}, "call": {"duration": 0.07612225180491805, "outcome": "passed"}, "teardown": {"duration": 0.0005883388221263885, "outcome": "passed"}}, {"nodeid": "tests/performance/test_throughput.py::test_health_endpoint_fast", "lineno": 72, "outcome": "passed", "keywords": ["test_health_endpoint_fast", "test_throughput.py", "asyncio", "performance", "tests", "marge", ""], "setup": {"duration": 0.0004891986027359962, "outcome": "passed"}, "call": {"duration": 0.007385266944766045, "outcome": "passed"}, "teardown": {"duration": 0.000322684645652771, "outcome": "passed"}}, {"nodeid": "tests/performance/test_throughput.py::test_service_call_throughput", "lineno": 82, "outcome": "passed", "keywords": ["test_service_call_throughput", "test_throughput.py", "asyncio", "performance", "tests", "marge", ""], "setup": {"duration": 0.00039677880704402924, "outcome": "passed"}, "call": {"duration": 0.03118657786399126, "outcome": "passed", "stdout": "\n  10 service calls: 0.01s (668/sec)\n"}, "teardown": {"duration": 0.0003501167520880699, "outcome": "passed"}}, {"nodeid": "tests/performance/test_throughput.py::test_template_render_throughput", "lineno": 106, "outcome": "passed", "keywords": ["test_template_render_throughput", "test_throughput.py", "asyncio", "performance", "tests", "marge", ""], "setup": {"duration": 0.0003911638632416725, "outcome": "passed"}, "call": {"duration": 0.026928018778562546, "outcome": "passed", "stdout": "\n  20 template renders: 0.02s (912/sec)\n"}, "teardown": {"duration": 0.0003913729451596737, "outcome": "passed"}}, {"nodeid": "tests/performance/test_throughput.py::test_search_throughput", "lineno": 123, "outcome": "passed", "keywords": ["test_search_throughput", "test_throughput.py", "asyncio", "performance", "tests", "marge", ""], "setup": {"duration": 0.0004333117976784706, "outcome": "passed"}, "call": {"duration": 0.00947762792930007, "outcome": "passed"}, "teardown": {"duration": 0.00033091334626078606, "outcome": "passed"}}, {"nodeid": "tests/test_cast.py::test_cast_appears_in_integration_list", "lineno": 20, "outcome": "skipped", "keywords": ["test_cast_appears_in_integration_list", "test_cast.py", "asyncio", "marge_only", "tests", "marge", ""], "setup": {"duration": 0.00024500302970409393, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/test_cast.py', 21, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00012967782095074654, "outcome": "passed"}}, {"nodeid": "tests/test_cast.py::test_cast_integration_entry_has_required_fields", "lineno": 32, "outcome": "skipped", "keywords": ["test_cast_integration_entry_has_required_fields", "test_cast.py", "asyncio", "marge_only", "tests", "marge", ""], "setup": {"duration": 0.00020550424233078957, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/test_cast.py', 33, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00012652436271309853, "outcome": "passed"}}, {"nodeid": "tests/test_cast.py::test_cast_integration_inactive_when_no_devices", "lineno": 47, "outcome": "skipped", "keywords": ["test_cast_integration_inactive_when_no_devices", "test_cast.py", "asyncio", "marge_only", "tests", "marge", ""], "setup": {"duration": 0.0001963968388736248, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/test_cast.py', 48, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.0001275390386581421, "outcome": "passed"}}, {"nodeid": "tests/test_cast.py::test_cast_status_endpoint_returns_200", "lineno": 61, "outcome": "skipped", "keywords": ["test_cast_status_endpoint_returns_200", "test_cast.py", "asyncio", "marge_only", "tests", "marge", ""], "setup": {"duration": 0.00019680708646774292, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/test_cast.py', 62, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00026180222630500793, "outcome": "passed"}}, {"nodeid": "tests/test_cast.py::test_cast_status_has_device_count", "lineno": 70, "outcome": "skipped", "keywords": ["test_cast_status_has_device_count", "test_cast.py", "asyncio", "marge_only", "tests", "marge", ""], "setup": {"duration": 0.00019496679306030273, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/test_cast.py', 71, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00012877490371465683, "outcome": "passed"}}, {"nodeid": "tests/test_cast.py::test_cast_status_has_devices_list", "lineno": 81, "outcome": "skipped", "keywords": ["test_cast_status_has_devices_list", "test_cast.py", "asyncio", "marge_only", "tests", "marge", ""], "setup": {"duration": 0.0001947358250617981, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/test_cast.py', 82, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00012726383283734322, "outcome": "passed"}}, {"nodeid": "tests/test_cast.py::test_cast_status_empty_when_no_devices", "lineno": 92, "outcome": "skipped", "keywords": ["test_cast_status_empty_when_no_devices", "test_cast.py", "asyncio", "marge_only", "tests", "marge", ""], "setup": {"duration": 0.00019650673493742943, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/test_cast.py', 93, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.000128941610455513, "outcome": "passed"}}, {"nodeid": "tests/test_cast.py::test_cast_status_device_count_matches_devices_length", "lineno": 103, "outcome": "skipped", "keywords": ["test_cast_status_device_count_matches_devices_length", "test_cast.py", "asyncio", "marge_only", "tests", "marge", ""], "setup": {"duration": 0.00020439596846699715, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/test_cast.py', 104, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.000131221953779459, "outcome": "passed"}}, {"nodeid": "tests/test_cast.py::test_cast_discover_missing_ip_returns_400", "lineno": 115, "outcome": "skipped", "keywords": ["test_cast_discover_missing_ip_returns_400", "test_cast.py", "asyncio", "marge_only", "tests", "marge", ""], "setup": {"duration": 0.00020345905795693398, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/test_cast.py', 116, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00013213278725743294, "outcome": "passed"}}, {"nodeid": "tests/test_cast.py::test_cast_discover_null_ip_returns_400", "lineno": 125, "outcome": "skipped", "keywords": ["test_cast_discover_null_ip_returns_400", "test_cast.py", "asyncio", "marge_only", "tests", "marge", ""], "setup": {"duration": 0.0001920037902891636, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/test_cast.py', 126, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00012762611731886864, "outcome": "passed"}}, {"nodeid": "tests/test_cast.py::test_cast_discover_numeric_ip_returns_400", "lineno": 135, "outcome": "skipped", "keywords": ["test_cast_discover_numeric_ip_returns_400", "test_cast.py", "asyncio", "marge_only", "tests", "marge", ""], "setup": {"duration": 0.0001957947388291359, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/test_cast.py', 136, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.0001279902644455433, "outcome": "passed"}}, {"nodeid": "tests/test_cast.py::test_cast_media_player_entity_naming", "lineno": 147, "outcome": "skipped", "keywords": ["test_cast_media_player_entity_naming", "test_cast.py", "asyncio", "marge_only", "tests", "marge", ""], "setup": {"duration": 0.00019327830523252487, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/test_cast.py', 148, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00012710969895124435, "outcome": "passed"}}, {"nodeid": "tests/test_cast.py::test_cast_entities_appear_in_global_state_list", "lineno": 163, "outcome": "skipped", "keywords": ["test_cast_entities_appear_in_global_state_list", "test_cast.py", "asyncio", "marge_only", "tests", "marge", ""], "setup": {"duration": 0.00019509391859173775, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/test_cast.py', 164, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00012804102152585983, "outcome": "passed"}}, {"nodeid": "tests/test_cast.py::test_cast_entity_services_work", "lineno": 173, "outcome": "skipped", "keywords": ["test_cast_entity_services_work", "test_cast.py", "asyncio", "marge_only", "tests", "marge", ""], "setup": {"duration": 0.00019864877685904503, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/test_cast.py', 174, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00018222862854599953, "outcome": "passed"}}, {"nodeid": "tests/test_hue.py::test_hue_appears_in_integration_list", "lineno": 21, "outcome": "skipped", "keywords": ["test_hue_appears_in_integration_list", "test_hue.py", "asyncio", "marge_only", "tests", "marge", ""], "setup": {"duration": 0.00020287418738007545, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/test_hue.py', 22, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00012684985995292664, "outcome": "passed"}}, {"nodeid": "tests/test_hue.py::test_hue_integration_entry_has_required_fields", "lineno": 33, "outcome": "skipped", "keywords": ["test_hue_integration_entry_has_required_fields", "test_hue.py", "asyncio", "marge_only", "tests", "marge", ""], "setup": {"duration": 0.00019580963999032974, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/test_hue.py', 34, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00012732716277241707, "outcome": "passed"}}, {"nodeid": "tests/test_hue.py::test_hue_integration_inactive_when_no_bridges", "lineno": 48, "outcome": "skipped", "keywords": ["test_hue_integration_inactive_when_no_bridges", "test_hue.py", "asyncio", "marge_only", "tests", "marge", ""], "setup": {"duration": 0.0001935139298439026, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/test_hue.py', 49, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00012633111327886581, "outcome": "passed"}}, {"nodeid": "tests/test_hue.py::test_hue_status_endpoint_returns_200", "lineno": 62, "outcome": "skipped", "keywords": ["test_hue_status_endpoint_returns_200", "test_hue.py", "asyncio", "marge_only", "tests", "marge", ""], "setup": {"duration": 0.00019529880955815315, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/test_hue.py', 63, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00012709666043519974, "outcome": "passed"}}, {"nodeid": "tests/test_hue.py::test_hue_status_has_bridges_list", "lineno": 71, "outcome": "skipped", "keywords": ["test_hue_status_has_bridges_list", "test_hue.py", "asyncio", "marge_only", "tests", "marge", ""], "setup": {"duration": 0.0001954338513314724, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/test_hue.py', 72, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00014191912487149239, "outcome": "passed"}}, {"nodeid": "tests/test_hue.py::test_hue_status_has_bridge_count", "lineno": 82, "outcome": "skipped", "keywords": ["test_hue_status_has_bridge_count", "test_hue.py", "asyncio", "marge_only", "tests", "marge", ""], "setup": {"duration": 0.0001950003206729889, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/test_hue.py', 83, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.0001256028190255165, "outcome": "passed"}}, {"nodeid": "tests/test_hue.py::test_hue_status_empty_when_no_bridges", "lineno": 93, "outcome": "skipped", "keywords": ["test_hue_status_empty_when_no_bridges", "test_hue.py", "asyncio", "marge_only", "tests", "marge", ""], "setup": {"duration": 0.00019305571913719177, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/test_hue.py', 94, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00012572389096021652, "outcome": "passed"}}, {"nodeid": "tests/test_hue.py::test_hue_pair_missing_ip_returns_400", "lineno": 106, "outcome": "skipped", "keywords": ["test_hue_pair_missing_ip_returns_400", "test_hue.py", "asyncio", "marge_only", "tests", "marge", ""], "setup": {"duration": 0.0001923050731420517, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/test_hue.py', 107, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.0001249760389328003, "outcome": "passed"}}, {"nodeid": "tests/test_hue.py::test_hue_pair_null_ip_returns_400", "lineno": 116, "outcome": "skipped", "keywords": ["test_hue_pair_null_ip_returns_400", "test_hue.py", "asyncio", "marge_only", "tests", "marge", ""], "setup": {"duration": 0.00019689695909619331, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/test_hue.py', 117, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.0001271367073059082, "outcome": "passed"}}, {"nodeid": "tests/test_hue.py::test_hue_add_missing_fields_returns_400", "lineno": 128, "outcome": "skipped", "keywords": ["test_hue_add_missing_fields_returns_400", "test_hue.py", "asyncio", "marge_only", "tests", "marge", ""], "setup": {"duration": 0.00019649509340524673, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/test_hue.py', 129, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00013020914047956467, "outcome": "passed"}}, {"nodeid": "tests/test_hue.py::test_hue_add_missing_username_returns_400", "lineno": 138, "outcome": "skipped", "keywords": ["test_hue_add_missing_username_returns_400", "test_hue.py", "asyncio", "marge_only", "tests", "marge", ""], "setup": {"duration": 0.00020224228501319885, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/test_hue.py', 139, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.0001259869895875454, "outcome": "passed"}}, {"nodeid": "tests/test_hue.py::test_hue_light_entity_naming", "lineno": 150, "outcome": "skipped", "keywords": ["test_hue_light_entity_naming", "test_hue.py", "asyncio", "marge_only", "tests", "marge", ""], "setup": {"duration": 0.00019269296899437904, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/test_hue.py', 151, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00012562889605760574, "outcome": "passed"}}, {"nodeid": "tests/test_hue.py::test_hue_sensor_entity_naming", "lineno": 168, "outcome": "skipped", "keywords": ["test_hue_sensor_entity_naming", "test_hue.py", "asyncio", "marge_only", "tests", "marge", ""], "setup": {"duration": 0.00019603921100497246, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/test_hue.py', 169, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00013109389692544937, "outcome": "passed"}}, {"nodeid": "tests/test_hue.py::test_hue_entities_appear_in_global_state_list", "lineno": 184, "outcome": "skipped", "keywords": ["test_hue_entities_appear_in_global_state_list", "test_hue.py", "asyncio", "marge_only", "tests", "marge", ""], "setup": {"duration": 0.00020261015743017197, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/test_hue.py', 185, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00013174116611480713, "outcome": "passed"}}, {"nodeid": "tests/test_matter.py::test_matter_appears_in_integration_list", "lineno": 19, "outcome": "skipped", "keywords": ["test_matter_appears_in_integration_list", "test_matter.py", "asyncio", "marge_only", "tests", "marge", ""], "setup": {"duration": 0.00020714011043310165, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/test_matter.py', 20, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00012919865548610687, "outcome": "passed"}}, {"nodeid": "tests/test_matter.py::test_matter_integration_entry_has_required_fields", "lineno": 31, "outcome": "skipped", "keywords": ["test_matter_integration_entry_has_required_fields", "test_matter.py", "asyncio", "marge_only", "tests", "marge", ""], "setup": {"duration": 0.00021476810798048973, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/test_matter.py', 32, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00012762891128659248, "outcome": "passed"}}, {"nodeid": "tests/test_matter.py::test_matter_integration_inactive_when_no_sidecar", "lineno": 46, "outcome": "skipped", "keywords": ["test_matter_integration_inactive_when_no_sidecar", "test_matter.py", "asyncio", "marge_only", "tests", "marge", ""], "setup": {"duration": 0.00019611604511737823, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/test_matter.py', 47, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00012711761519312859, "outcome": "passed"}}, {"nodeid": "tests/test_matter.py::test_matter_status_endpoint_returns_200", "lineno": 60, "outcome": "skipped", "keywords": ["test_matter_status_endpoint_returns_200", "test_matter.py", "asyncio", "marge_only", "tests", "marge", ""], "setup": {"duration": 0.0001940196380019188, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/test_matter.py', 61, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00012566614896059036, "outcome": "passed"}}, {"nodeid": "tests/test_matter.py::test_matter_status_has_device_count", "lineno": 69, "outcome": "skipped", "keywords": ["test_matter_status_has_device_count", "test_matter.py", "asyncio", "marge_only", "tests", "marge", ""], "setup": {"duration": 0.0001944536343216896, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/test_matter.py', 70, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00012668082490563393, "outcome": "passed"}}, {"nodeid": "tests/test_matter.py::test_matter_status_has_devices_list", "lineno": 80, "outcome": "skipped", "keywords": ["test_matter_status_has_devices_list", "test_matter.py", "asyncio", "marge_only", "tests", "marge", ""], "setup": {"duration": 0.0001954277977347374, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/test_matter.py', 81, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00012720702216029167, "outcome": "passed"}}, {"nodeid": "tests/test_matter.py::test_matter_status_has_status_field", "lineno": 91, "outcome": "skipped", "keywords": ["test_matter_status_has_status_field", "test_matter.py", "asyncio", "marge_only", "tests", "marge", ""], "setup": {"duration": 0.00019210390746593475, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/test_matter.py', 92, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00014341622591018677, "outcome": "passed"}}, {"nodeid": "tests/test_matter.py::test_matter_status_has_server_version", "lineno": 102, "outcome": "skipped", "keywords": ["test_matter_status_has_server_version", "test_matter.py", "asyncio", "marge_only", "tests", "marge", ""], "setup": {"duration": 0.0002011200413107872, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/test_matter.py', 103, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00013350835070014, "outcome": "passed"}}, {"nodeid": "tests/test_matter.py::test_matter_status_empty_when_no_sidecar", "lineno": 114, "outcome": "skipped", "keywords": ["test_matter_status_empty_when_no_sidecar", "test_matter.py", "asyncio", "marge_only", "tests", "marge", ""], "setup": {"duration": 0.0002012397162616253, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/test_matter.py', 115, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00013369275256991386, "outcome": "passed"}}, {"nodeid": "tests/test_matter.py::test_matter_status_device_count_matches_devices_length", "lineno": 125, "outcome": "skipped", "keywords": ["test_matter_status_device_count_matches_devices_length", "test_matter.py", "asyncio", "marge_only", "tests", "marge", ""], "setup": {"duration": 0.00020115403458476067, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/test_matter.py', 126, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00013140402734279633, "outcome": "passed"}}, {"nodeid": "tests/test_matter.py::test_matter_status_via_alias_path", "lineno": 135, "outcome": "skipped", "keywords": ["test_matter_status_via_alias_path", "test_matter.py", "asyncio", "marge_only", "tests", "marge", ""], "setup": {"duration": 0.00020039081573486328, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/test_matter.py', 136, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00013285130262374878, "outcome": "passed"}}, {"nodeid": "tests/test_matter.py::test_matter_light_entity_naming", "lineno": 149, "outcome": "skipped", "keywords": ["test_matter_light_entity_naming", "test_matter.py", "asyncio", "marge_only", "tests", "marge", ""], "setup": {"duration": 0.00019766390323638916, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/test_matter.py', 150, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.0001323837786912918, "outcome": "passed"}}, {"nodeid": "tests/test_matter.py::test_matter_lock_entity_naming", "lineno": 167, "outcome": "skipped", "keywords": ["test_matter_lock_entity_naming", "test_matter.py", "asyncio", "marge_only", "tests", "marge", ""], "setup": {"duration": 0.000200559850782156, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/test_matter.py', 168, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.0001324131153523922, "outcome": "passed"}}, {"nodeid": "tests/test_matter.py::test_matter_climate_entity_naming", "lineno": 182, "outcome": "skipped", "keywords": ["test_matter_climate_entity_naming", "test_matter.py", "asyncio", "marge_only", "tests", "marge", ""], "setup": {"duration": 0.00019916100427508354, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/test_matter.py', 183, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.0001316247507929802, "outcome": "passed"}}, {"nodeid": "tests/test_matter.py::test_matter_entities_appear_in_global_state_list", "lineno": 198, "outcome": "skipped", "keywords": ["test_matter_entities_appear_in_global_state_list", "test_matter.py", "asyncio", "marge_only", "tests", "marge", ""], "setup": {"duration": 0.0001995610073208809, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/test_matter.py', 199, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00013257935643196106, "outcome": "passed"}}, {"nodeid": "tests/test_matter.py::test_matter_entity_services_work", "lineno": 208, "outcome": "skipped", "keywords": ["test_matter_entity_services_work", "test_matter.py", "asyncio", "marge_only", "tests", "marge", ""], "setup": {"duration": 0.00019999872893095016, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/test_matter.py', 209, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00013430602848529816, "outcome": "passed"}}, {"nodeid": "tests/test_shelly.py::test_shelly_appears_in_integration_list", "lineno": 20, "outcome": "skipped", "keywords": ["test_shelly_appears_in_integration_list", "test_shelly.py", "asyncio", "marge_only", "tests", "marge", ""], "setup": {"duration": 0.0002032378688454628, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/test_shelly.py', 21, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00013097235932946205, "outcome": "passed"}}, {"nodeid": "tests/test_shelly.py::test_shelly_integration_entry_has_required_fields", "lineno": 32, "outcome": "skipped", "keywords": ["test_shelly_integration_entry_has_required_fields", "test_shelly.py", "asyncio", "marge_only", "tests", "marge", ""], "setup": {"duration": 0.00020910520106554031, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/test_shelly.py', 33, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.0001308242790400982, "outcome": "passed"}}, {"nodeid": "tests/test_shelly.py::test_shelly_integration_status_inactive_when_no_devices", "lineno": 47, "outcome": "skipped", "keywords": ["test_shelly_integration_status_inactive_when_no_devices", "test_shelly.py", "asyncio", "marge_only", "tests", "marge", ""], "setup": {"duration": 0.0001987200230360031, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/test_shelly.py', 48, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00013171415776014328, "outcome": "passed"}}, {"nodeid": "tests/test_shelly.py::test_shelly_status_endpoint_returns_200", "lineno": 63, "outcome": "skipped", "keywords": ["test_shelly_status_endpoint_returns_200", "test_shelly.py", "asyncio", "marge_only", "tests", "marge", ""], "setup": {"duration": 0.00020125694572925568, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/test_shelly.py', 64, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00013390881940722466, "outcome": "passed"}}, {"nodeid": "tests/test_shelly.py::test_shelly_status_has_device_count", "lineno": 72, "outcome": "skipped", "keywords": ["test_shelly_status_has_device_count", "test_shelly.py", "asyncio", "marge_only", "tests", "marge", ""], "setup": {"duration": 0.0002027377486228943, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/test_shelly.py', 73, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00013611279428005219, "outcome": "passed"}}, {"nodeid": "tests/test_shelly.py::test_shelly_status_has_devices_list", "lineno": 83, "outcome": "skipped", "keywords": ["test_shelly_status_has_devices_list", "test_shelly.py", "asyncio", "marge_only", "tests", "marge", ""], "setup": {"duration": 0.00020833918824791908, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/test_shelly.py', 84, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.0001361621543765068, "outcome": "passed"}}, {"nodeid": "tests/test_shelly.py::test_shelly_status_empty_when_no_devices", "lineno": 94, "outcome": "skipped", "keywords": ["test_shelly_status_empty_when_no_devices", "test_shelly.py", "asyncio", "marge_only", "tests", "marge", ""], "setup": {"duration": 0.0002080160193145275, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/test_shelly.py', 95, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00013338914141058922, "outcome": "passed"}}, {"nodeid": "tests/test_shelly.py::test_shelly_status_device_count_matches_devices_length", "lineno": 105, "outcome": "skipped", "keywords": ["test_shelly_status_device_count_matches_devices_length", "test_shelly.py", "asyncio", "marge_only", "tests", "marge", ""], "setup": {"duration": 0.0001993267796933651, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/test_shelly.py', 106, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00015474995598196983, "outcome": "passed"}}, {"nodeid": "tests/test_shelly.py::test_shelly_discover_missing_ip_returns_400", "lineno": 117, "outcome": "skipped", "keywords": ["test_shelly_discover_missing_ip_returns_400", "test_shelly.py", "asyncio", "marge_only", "tests", "marge", ""], "setup": {"duration": 0.00020294031128287315, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/test_shelly.py', 118, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.0001324317418038845, "outcome": "passed"}}, {"nodeid": "tests/test_shelly.py::test_shelly_discover_null_ip_returns_400", "lineno": 127, "outcome": "skipped", "keywords": ["test_shelly_discover_null_ip_returns_400", "test_shelly.py", "asyncio", "marge_only", "tests", "marge", ""], "setup": {"duration": 0.00020102784037590027, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/test_shelly.py', 128, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00013159867376089096, "outcome": "passed"}}, {"nodeid": "tests/test_shelly.py::test_shelly_discover_numeric_ip_returns_400", "lineno": 137, "outcome": "skipped", "keywords": ["test_shelly_discover_numeric_ip_returns_400", "test_shelly.py", "asyncio", "marge_only", "tests", "marge", ""], "setup": {"duration": 0.0001987861469388008, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/test_shelly.py', 138, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00013141194358468056, "outcome": "passed"}}, {"nodeid": "tests/test_shelly.py::test_shelly_entity_naming_switch", "lineno": 153, "outcome": "skipped", "keywords": ["test_shelly_entity_naming_switch", "test_shelly.py", "asyncio", "marge_only", "tests", "marge", ""], "setup": {"duration": 0.0001993938349187374, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/test_shelly.py', 154, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00013717496767640114, "outcome": "passed"}}, {"nodeid": "tests/test_shelly.py::test_shelly_entity_naming_light", "lineno": 172, "outcome": "skipped", "keywords": ["test_shelly_entity_naming_light", "test_shelly.py", "asyncio", "marge_only", "tests", "marge", ""], "setup": {"duration": 0.00019905995577573776, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/test_shelly.py', 173, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00013135885819792747, "outcome": "passed"}}, {"nodeid": "tests/test_shelly.py::test_shelly_entity_naming_sensor", "lineno": 189, "outcome": "skipped", "keywords": ["test_shelly_entity_naming_sensor", "test_shelly.py", "asyncio", "marge_only", "tests", "marge", ""], "setup": {"duration": 0.0001994059421122074, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/test_shelly.py', 190, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.0001302417367696762, "outcome": "passed"}}, {"nodeid": "tests/test_shelly.py::test_shelly_entities_appear_in_global_state_list", "lineno": 206, "outcome": "skipped", "keywords": ["test_shelly_entities_appear_in_global_state_list", "test_shelly.py", "asyncio", "marge_only", "tests", "marge", ""], "setup": {"duration": 0.00020077917724847794, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/test_shelly.py', 207, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00013191206380724907, "outcome": "passed"}}, {"nodeid": "tests/test_shelly.py::test_shelly_entity_services_work", "lineno": 216, "outcome": "skipped", "keywords": ["test_shelly_entity_services_work", "test_shelly.py", "asyncio", "marge_only", "tests", "marge", ""], "setup": {"duration": 0.00019640522077679634, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/test_shelly.py', 217, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00013324525207281113, "outcome": "passed"}}, {"nodeid": "tests/test_sonos.py::test_sonos_appears_in_integration_list", "lineno": 20, "outcome": "skipped", "keywords": ["test_sonos_appears_in_integration_list", "test_sonos.py", "asyncio", "marge_only", "tests", "marge", ""], "setup": {"duration": 0.00020487932488322258, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/test_sonos.py', 21, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00013307062909007072, "outcome": "passed"}}, {"nodeid": "tests/test_sonos.py::test_sonos_integration_entry_has_required_fields", "lineno": 32, "outcome": "skipped", "keywords": ["test_sonos_integration_entry_has_required_fields", "test_sonos.py", "asyncio", "marge_only", "tests", "marge", ""], "setup": {"duration": 0.00020124297589063644, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/test_sonos.py', 33, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.0001319199800491333, "outcome": "passed"}}, {"nodeid": "tests/test_sonos.py::test_sonos_integration_inactive_when_no_devices", "lineno": 47, "outcome": "skipped", "keywords": ["test_sonos_integration_inactive_when_no_devices", "test_sonos.py", "asyncio", "marge_only", "tests", "marge", ""], "setup": {"duration": 0.00019822223111987114, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/test_sonos.py', 48, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00013019610196352005, "outcome": "passed"}}, {"nodeid": "tests/test_sonos.py::test_sonos_status_endpoint_returns_200", "lineno": 61, "outcome": "skipped", "keywords": ["test_sonos_status_endpoint_returns_200", "test_sonos.py", "asyncio", "marge_only", "tests", "marge", ""], "setup": {"duration": 0.00020049000158905983, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/test_sonos.py', 62, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00013200612738728523, "outcome": "passed"}}, {"nodeid": "tests/test_sonos.py::test_sonos_status_has_device_count", "lineno": 70, "outcome": "skipped", "keywords": ["test_sonos_status_has_device_count", "test_sonos.py", "asyncio", "marge_only", "tests", "marge", ""], "setup": {"duration": 0.00019853562116622925, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/test_sonos.py', 71, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00013076886534690857, "outcome": "passed"}}, {"nodeid": "tests/test_sonos.py::test_sonos_status_has_devices_list", "lineno": 81, "outcome": "skipped", "keywords": ["test_sonos_status_has_devices_list", "test_sonos.py", "asyncio", "marge_only", "tests", "marge", ""], "setup": {"duration": 0.00019759126007556915, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/test_sonos.py', 82, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.000131119042634964, "outcome": "passed"}}, {"nodeid": "tests/test_sonos.py::test_sonos_status_empty_when_no_devices", "lineno": 92, "outcome": "skipped", "keywords": ["test_sonos_status_empty_when_no_devices", "test_sonos.py", "asyncio", "marge_only", "tests", "marge", ""], "setup": {"duration": 0.00019925087690353394, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/test_sonos.py', 93, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00013520801439881325, "outcome": "passed"}}, {"nodeid": "tests/test_sonos.py::test_sonos_status_device_count_matches_devices_length", "lineno": 103, "outcome": "skipped", "keywords": ["test_sonos_status_device_count_matches_devices_length", "test_sonos.py", "asyncio", "marge_only", "tests", "marge", ""], "setup": {"duration": 0.00020045321434736252, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/test_sonos.py', 104, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00013186316937208176, "outcome": "passed"}}, {"nodeid": "tests/test_sonos.py::test_sonos_discover_missing_ip_returns_400", "lineno": 115, "outcome": "skipped", "keywords": ["test_sonos_discover_missing_ip_returns_400", "test_sonos.py", "asyncio", "marge_only", "tests", "marge", ""], "setup": {"duration": 0.000200705137103796, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/test_sonos.py', 116, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00013258354738354683, "outcome": "passed"}}, {"nodeid": "tests/test_sonos.py::test_sonos_discover_null_ip_returns_400", "lineno": 125, "outcome": "skipped", "keywords": ["test_sonos_discover_null_ip_returns_400", "test_sonos.py", "asyncio", "marge_only", "tests", "marge", ""], "setup": {"duration": 0.00019920198246836662, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/test_sonos.py', 126, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00013327505439519882, "outcome": "passed"}}, {"nodeid": "tests/test_sonos.py::test_sonos_discover_numeric_ip_returns_400", "lineno": 135, "outcome": "skipped", "keywords": ["test_sonos_discover_numeric_ip_returns_400", "test_sonos.py", "asyncio", "marge_only", "tests", "marge", ""], "setup": {"duration": 0.00020161131396889687, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/test_sonos.py', 136, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00013549579307436943, "outcome": "passed"}}, {"nodeid": "tests/test_sonos.py::test_sonos_media_player_entity_naming", "lineno": 147, "outcome": "skipped", "keywords": ["test_sonos_media_player_entity_naming", "test_sonos.py", "asyncio", "marge_only", "tests", "marge", ""], "setup": {"duration": 0.00020410818979144096, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/test_sonos.py', 148, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00014569982886314392, "outcome": "passed"}}, {"nodeid": "tests/test_sonos.py::test_sonos_entities_appear_in_global_state_list", "lineno": 166, "outcome": "skipped", "keywords": ["test_sonos_entities_appear_in_global_state_list", "test_sonos.py", "asyncio", "marge_only", "tests", "marge", ""], "setup": {"duration": 0.000206703320145607, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/test_sonos.py', 167, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.00013209879398345947, "outcome": "passed"}}, {"nodeid": "tests/test_sonos.py::test_sonos_entity_services_work", "lineno": 176, "outcome": "skipped", "keywords": ["test_sonos_entity_services_work", "test_sonos.py", "asyncio", "marge_only", "tests", "marge", ""], "setup": {"duration": 0.0002017100341618061, "outcome": "skipped", "longrepr": "('/home/jcrigby/fun/marge/tests/test_sonos.py', 177, 'Skipped: marge_only test \u2014 skipped against HA')"}, "teardown": {"duration": 0.008838313166052103, "outcome": "passed"}}]}